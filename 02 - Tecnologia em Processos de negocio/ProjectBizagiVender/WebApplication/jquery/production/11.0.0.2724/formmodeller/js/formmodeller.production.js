$.extend($.ui.tabs.prototype,{paging:function(n){function y(){var y,n;if(a(),l=0,r=0,s=0,o=0,f=[],e=[],selectedTabWidths=[],v=t.element.width(),y=0,t.lis.each(function(n){n==t.options.selected?(selectedTabWidths[n]=$(this).outerWidth({margin:!0}),e[n]=t.lis.eq(n).removeClass("ui-tabs-selected").outerWidth({margin:!0}),t.lis.eq(n).addClass("ui-tabs-selected"),y=Math.min(y,Math.abs(selectedTabWidths[n]-e[n])),l+=e[n]):(e[n]=$(this).outerWidth({margin:!0}),selectedTabWidths[n]=t.lis.eq(n).addClass("ui-tabs-selected").outerWidth({margin:!0}),t.lis.eq(n).removeClass("ui-tabs-selected"),y=Math.max(y,Math.abs(selectedTabWidths[n]-e[n])),l+=e[n])}),l+=y+($.browser.msie?4:0)+9,l>v){li=$("<li><\/li>").addClass("ui-state-default ui-tabs-paging-next").append($('<a href="#"><\/a>').click(function(){return d("next"),!1}).html(u.nextButton));t.lis.eq(t.length()-1).after(li);o=li.outerWidth({margin:!0});li=$("<li><\/li>").addClass("ui-state-default ui-tabs-paging-prev").append($('<a href="#"><\/a>').click(function(){return d("prev"),!1}).html(u.prevButton));t.lis.eq(0).before(li);o+=li.outerWidth({margin:!0});o+=19;var p=0,i=0,w=0;for(n=0;n<e.length;n++)(i==0||selectedTabWidths[n]-e[n]>w)&&(w=selectedTabWidths[n]-e[n]),f[p]==null?f[p]={start:n}:(n>0&&n%u.tabsPerPage==0||e[n]+i+o+12>v)&&(i+w>s&&(s=i+w),p++,f[p]={start:n},i=0),f[p].end=n+1,i+=e[n],n==t.options.selected&&(r=p);i+w>s&&(s=i+w);t.lis.hide().slice(f[r].start,f[r].end).show();r!=f.length-1||u.cycle||h("next");r!=0||u.cycle||h("prev");buttonPadding=v-s-o;buttonPadding>0&&$(".ui-tabs-paging-next",t.element).css({paddingRight:buttonPadding+"px"});c=!0}else a();$(window).bind("resize",g)}function d(n){r=r+(n=="prev"?-1:1);n=="prev"&&r<0&&u.cycle||n=="next"&&r>=f.length&&!u.cycle?r=f.length-1:(n=="prev"&&r<0||n=="next"&&r>=f.length&&u.cycle)&&(r=0);var i=f[r].start,e=f[r].end;t.lis.hide().slice(i,e).show();n=="prev"?(p("next"),u.follow&&(t.options.selected<i||t.options.selected>e-1)&&t.select(e-1),!u.cycle&&i<=0&&h("prev")):(p("prev"),u.follow&&(t.options.selected<i||t.options.selected>e-1)&&t.select(i),!u.cycle&&e>=t.length()&&h("next"))}function h(n){$(".ui-tabs-paging-"+n,t.element).addClass("ui-tabs-paging-disabled")}function p(n){$(".ui-tabs-paging-"+n,t.element).removeClass("ui-tabs-paging-disabled")}function g(){w&&clearTimeout(w);(b!=$(window).height()||k!=$(window).width())&&(w=setTimeout(rt,100))}function rt(){b=$(window).height();k=$(window).width();y()}function a(){$(".ui-tabs-paging-next",t.element).remove();$(".ui-tabs-paging-prev",t.element).remove();t.lis.show();c=!1;$(window).unbind("resize",g)}var u={tabsPerPage:0,nextButton:"&#187;",prevButton:"&#171;",follow:!1,cycle:!1,selectOnAdd:!1,followOnSelect:!1},nt,tt,it;u=$.extend(u,n);var t=this,c=!1,r,o,v,l,e,s,f,w=null,b=$(window).height(),k=$(window).width();nt=t.add;t.add=function(n,t,i){c&&a();nt.apply(this,[n,t,i]);u.selectOnAdd&&(i==undefined&&(i=this.lis.length-1),this.select(i));y()};tt=t.remove;t.remove=function(n){c&&a();tt.apply(this,[n]);y()};it=t.select;t.select=function(n){if(it.apply(this,[n]),c&&u.followOnSelect)for(i in f){var e=f[i].start,o=f[i].end;if(n>=e&&n<o){i!=r&&(t.lis.hide().slice(e,o).show(),r=parseInt(i),r==0?(p("next"),!u.cycle&&e<=0&&h("prev")):(p("prev"),!u.cycle&&o>=t.length()&&h("next")));break}}};$.extend($.ui.tabs.prototype,{pagingDestroy:function(){a()}});y()}});
(function(n){function i(n){return t.inWords(r(n))}function r(n){return(new Date).getTime()-n.getTime()}n.timeago=function(r){return t.settings={refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:bizagi.localization.getResource("bizagi-editor-form-timeago-ago"),suffixFromNow:bizagi.localization.getResource("bizagi-editor-form-timeago-from-now"),seconds:bizagi.localization.getResource("bizagi-editor-form-timeago-seconds"),minute:bizagi.localization.getResource("bizagi-editor-form-timeago-minute"),minutes:bizagi.localization.getResource("bizagi-editor-form-timeago-minutes"),hour:bizagi.localization.getResource("bizagi-editor-form-timeago-hour"),hours:bizagi.localization.getResource("bizagi-editor-form-timeago-hours"),day:bizagi.localization.getResource("bizagi-editor-form-timeago-day"),days:bizagi.localization.getResource("bizagi-editor-form-timeago-days"),month:bizagi.localization.getResource("bizagi-editor-form-timeago-month"),months:bizagi.localization.getResource("bizagi-editor-form-timeago-months"),year:bizagi.localization.getResource("bizagi-editor-form-timeago-year"),years:bizagi.localization.getResource("bizagi-editor-form-timeago-years"),wordSeparator:" ",numbers:[]}},r instanceof Date?i(r):typeof r=="string"?i(n.timeago.parse(r)):typeof r=="number"?i(new Date(r)):i(n.timeago.datetime(r))};var t=n.timeago;n.extend(n.timeago,{inWords:function(t){function r(r,u){var f=n.isFunction(r)?r(u,t):r,e=i.numbers&&i.numbers[u]||u;return f.replace(/%d/i,e)}var i=this.settings.strings,h=i.prefixAgo,c=i.suffixAgo,a,s;this.settings.allowFuture&&t<0&&(h=i.prefixFromNow,c=i.suffixFromNow);var f=Math.abs(t)/1e3,e=f/60,o=e/60,u=o/24,l=u/365;return a=f<45&&r(i.seconds,Math.round(f))||f<90&&r(i.minute,1)||e<45&&r(i.minutes,Math.round(e))||e<90&&r(i.hour,1)||o<24&&r(i.hours,Math.round(o))||o<42&&r(i.day,1)||u<30&&r(i.days,Math.round(u))||u<45&&r(i.month,1)||u<365&&r(i.months,Math.round(u/30))||l<1.5&&r(i.year,1)||r(i.years,Math.round(l)),s=i.wordSeparator||"",i.wordSeparator===undefined&&(s=" "),n.trim([h,a,c].join(s))},parse:function(t){var i=n.trim(t);return i=i.replace(/\.\d+/,""),i=i.replace(/-/,"/").replace(/-/,"/"),i=i.replace(/T/," ").replace(/Z/," UTC"),i=i.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),i=i.replace(/([\+\-]\d\d)$/," $100"),new Date(i)},datetime:function(i){var r=t.isTime(i)?n(i).attr("datetime"):n(i).attr("title");return t.parse(r)},isTime:function(t){return n(t).get(0).tagName.toLowerCase()==="time"}})})(jQuery);
(function(n){function t(){this.regional=[];this.regional[""]={currentText:"Now",closeText:"Done",ampm:!1,amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"hh:mm tt",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",timezoneText:"Time Zone"};this._defaults={showButtonPanel:!0,timeOnly:!1,showHour:!0,showMinute:!0,showSecond:!1,showMillisec:!1,showTimezone:!1,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:"+0000",hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,showTimepicker:!0,timezoneIso8609:!1,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null};n.extend(this._defaults,this.regional[""])}function i(t,i){n.extend(t,i);for(var r in i)(i[r]===null||i[r]===undefined)&&(t[r]=i[r]);return t}(n.ui.timepicker=n.ui.timepicker||{},n.ui.timepicker.version)||(n.extend(n.ui,{timepicker:{version:"1.0.0"}}),n.extend(t.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:"+0000",hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,setDefaults:function(n){return i(this._defaults,n||{}),this},_newInst:function(i,r){var u=new t,h={},o,s,f,e;for(o in this._defaults)if(s=i.attr("time:"+o),s)try{h[o]=eval(s)}catch(c){h[o]=s}if(u._defaults=n.extend({},this._defaults,h,r,{beforeShow:function(t,i){if(n.isFunction(r.beforeShow))return r.beforeShow(t,i,u)},onChangeMonthYear:function(t,f,e){u._updateDateTime(e);n.isFunction(r.onChangeMonthYear)&&r.onChangeMonthYear.call(i[0],t,f,e,u)},onClose:function(t,f){u.timeDefined===!0&&i.val()!=""&&u._updateDateTime(f);n.isFunction(r.onClose)&&r.onClose.call(i[0],t,f,u)},timepicker:u}),u.amNames=n.map(u._defaults.amNames,function(n){return n.toUpperCase()}),u.pmNames=n.map(u._defaults.pmNames,function(n){return n.toUpperCase()}),u._defaults.timezoneList===null){for(f=[],e=-11;e<=12;e++)f.push((e>=0?"+":"-")+("0"+Math.abs(e).toString()).slice(-2)+"00");u._defaults.timezoneIso8609&&(f=n.map(f,function(n){return n=="+0000"?"Z":n.substring(0,3)+":"+n.substring(3)}));u._defaults.timezoneList=f}return u.hour=u._defaults.hour,u.minute=u._defaults.minute,u.second=u._defaults.second,u.millisec=u._defaults.millisec,u.ampm="",u.$input=i,r.altField&&(u.$altInput=n(r.altField).css({cursor:"pointer"}).focus(function(){i.trigger("focus")})),(u._defaults.minDate==0||u._defaults.minDateTime==0)&&(u._defaults.minDate=new Date),(u._defaults.maxDate==0||u._defaults.maxDateTime==0)&&(u._defaults.maxDate=new Date),u._defaults.minDate!==undefined&&u._defaults.minDate instanceof Date&&(u._defaults.minDateTime=new Date(u._defaults.minDate.getTime())),u._defaults.minDateTime!==undefined&&u._defaults.minDateTime instanceof Date&&(u._defaults.minDate=new Date(u._defaults.minDateTime.getTime())),u._defaults.maxDate!==undefined&&u._defaults.maxDate instanceof Date&&(u._defaults.maxDateTime=new Date(u._defaults.maxDate.getTime())),u._defaults.maxDateTime!==undefined&&u._defaults.maxDateTime instanceof Date&&(u._defaults.maxDate=new Date(u._defaults.maxDateTime.getTime())),u},_addTimePicker:function(n){var t=this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(t);this._limitMinMaxDateTime(n,!1);this._injectTimePicker()},_parseTime:function(t,i){var o=this._defaults.timeFormat.toString().replace(/h{1,2}/ig,"(\\d?\\d)").replace(/m{1,2}/ig,"(\\d?\\d)").replace(/s{1,2}/ig,"(\\d?\\d)").replace(/l{1}/ig,"(\\d?\\d?\\d)").replace(/t{1,2}/ig,this._getPatternAmpm()).replace(/z{1}/ig,"(z|[-+]\\d\\d:?\\d\\d)?").replace(/\s/g,"\\s?")+this._defaults.timeSuffix+"$",r=this._getFormatPositions(),e="",u,s,h,f;if(this.inst||(this.inst=n.datepicker._getInst(this.$input[0])),(i||!this._defaults.timeOnly)&&(s=n.datepicker._get(this.inst,"dateFormat"),h=new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),o="^.{"+s.length+",}?"+this._defaults.separator.replace(h,"\\$&")+o),u=t.match(new RegExp(o,"i")),u){if(r.t!==-1&&(u[r.t]===undefined||u[r.t].length===0?(e="",this.ampm=""):(e=n.inArray(u[r.t].toUpperCase(),this.amNames)!==-1?"AM":"PM",this.ampm=this._defaults[e=="AM"?"amNames":"pmNames"][0])),r.h!==-1&&(this.hour=e=="AM"&&u[r.h]=="12"?0:e=="PM"&&u[r.h]!="12"?(parseFloat(u[r.h])+12).toFixed(0):Number(u[r.h])),r.m!==-1&&(this.minute=Number(u[r.m])),r.s!==-1&&(this.second=Number(u[r.s])),r.l!==-1&&(this.millisec=Number(u[r.l])),r.z!==-1&&u[r.z]!==undefined){f=u[r.z].toUpperCase();switch(f.length){case 1:f=this._defaults.timezoneIso8609?"Z":"+0000";break;case 5:this._defaults.timezoneIso8609&&(f=f.substring(1)=="0000"?"Z":f.substring(0,3)+":"+f.substring(3));break;case 6:this._defaults.timezoneIso8609?f.substring(1)=="00:00"&&(f="Z"):f=f=="Z"||f.substring(1)=="00:00"?"+0000":f.replace(/:/,"")}this.timezone=f}return!0}return!1},_getPatternAmpm:function(){var t=[],i=this._defaults;return i.amNames&&n.merge(t,i.amNames),i.pmNames&&n.merge(t,i.pmNames),t=n.map(t,function(n){return n.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")}),"("+t.join("|")+")?"},_getFormatPositions:function(){var t=this._defaults.timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g),i={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1},n;if(t)for(n=0;n<t.length;n++)i[t[n].toString().charAt(0)]==-1&&(i[t[n].toString().charAt(0)]=n+1);return i},_injectTimePicker:function(){var v=this.inst.dpDiv,t=this._defaults,r=this,w=parseInt(t.hourMax-(t.hourMax-t.hourMin)%t.stepHour,10),b=parseInt(t.minuteMax-(t.minuteMax-t.minuteMin)%t.stepMinute,10),nt=parseInt(t.secondMax-(t.secondMax-t.secondMin)%t.stepSecond,10),tt=parseInt(t.millisecMax-(t.millisecMax-t.millisecMin)%t.stepMillisec,10),u=this.inst.id.toString().replace(/([^A-Za-z0-9_])/g,""),o,s,h,c,l,g,it,a,rt;if(v.find("div#ui-timepicker-div-"+u).length===0&&t.showTimepicker){var f=' style="display:none;"',i='<div class="ui-timepicker-div" id="ui-timepicker-div-'+u+'"><dl><dt class="ui_tpicker_time_label" id="ui_tpicker_time_label_'+u+'"'+(t.showTime?"":f)+">"+t.timeText+'<\/dt><dd class="ui_tpicker_time" id="ui_tpicker_time_'+u+'"'+(t.showTime?"":f)+'><\/dd><dt class="ui_tpicker_hour_label" id="ui_tpicker_hour_label_'+u+'"'+(t.showHour?"":f)+">"+t.hourText+"<\/dt>",y=0,p=0,k=0,d=0,e=null;if(i+='<dd class="ui_tpicker_hour"><div id="ui_tpicker_hour_'+u+'"'+(t.showHour?"":f)+"><\/div>",t.showHour&&t.hourGrid>0){for(i+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>',o=t.hourMin;o<=w;o+=parseInt(t.hourGrid,10))y++,s=t.ampm&&o>12?o-12:o,s<10&&(s="0"+s),t.ampm&&(o==0?s="12a":s+=o<12?"a":"p"),i+="<td>"+s+"<\/td>";i+="<\/tr><\/table><\/div>"}if(i+="<\/dd>",i+='<dt class="ui_tpicker_minute_label" id="ui_tpicker_minute_label_'+u+'"'+(t.showMinute?"":f)+">"+t.minuteText+'<\/dt><dd class="ui_tpicker_minute"><div id="ui_tpicker_minute_'+u+'"'+(t.showMinute?"":f)+"><\/div>",t.showMinute&&t.minuteGrid>0){for(i+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>',h=t.minuteMin;h<=b;h+=parseInt(t.minuteGrid,10))p++,i+="<td>"+(h<10?"0":"")+h+"<\/td>";i+="<\/tr><\/table><\/div>"}if(i+="<\/dd>",i+='<dt class="ui_tpicker_second_label" id="ui_tpicker_second_label_'+u+'"'+(t.showSecond?"":f)+">"+t.secondText+'<\/dt><dd class="ui_tpicker_second"><div id="ui_tpicker_second_'+u+'"'+(t.showSecond?"":f)+"><\/div>",t.showSecond&&t.secondGrid>0){for(i+='<div style="padding-left: 1px"><table><tr>',c=t.secondMin;c<=nt;c+=parseInt(t.secondGrid,10))k++,i+="<td>"+(c<10?"0":"")+c+"<\/td>";i+="<\/tr><\/table><\/div>"}if(i+="<\/dd>",i+='<dt class="ui_tpicker_millisec_label" id="ui_tpicker_millisec_label_'+u+'"'+(t.showMillisec?"":f)+">"+t.millisecText+'<\/dt><dd class="ui_tpicker_millisec"><div id="ui_tpicker_millisec_'+u+'"'+(t.showMillisec?"":f)+"><\/div>",t.showMillisec&&t.millisecGrid>0){for(i+='<div style="padding-left: 1px"><table><tr>',l=t.millisecMin;l<=tt;l+=parseInt(t.millisecGrid,10))d++,i+="<td>"+(l<10?"0":"")+l+"<\/td>";i+="<\/tr><\/table><\/div>"}i+="<\/dd>";i+='<dt class="ui_tpicker_timezone_label" id="ui_tpicker_timezone_label_'+u+'"'+(t.showTimezone?"":f)+">"+t.timezoneText+"<\/dt>";i+='<dd class="ui_tpicker_timezone" id="ui_tpicker_timezone_'+u+'"'+(t.showTimezone?"":f)+"><\/dd>";i+="<\/dl><\/div>";$tp=n(i);t.timeOnly===!0&&($tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+t.timeOnlyTitle+"<\/div><\/div>"),v.find(".ui-datepicker-header, .ui-datepicker-calendar").hide());this.hour_slider=$tp.find("#ui_tpicker_hour_"+u).slider({orientation:"horizontal",value:this.hour,min:t.hourMin,max:w,step:t.stepHour,slide:function(n,t){r.hour_slider.slider("option","value",t.value);r._onTimeChange()}});this.minute_slider=$tp.find("#ui_tpicker_minute_"+u).slider({orientation:"horizontal",value:this.minute,min:t.minuteMin,max:b,step:t.stepMinute,slide:function(n,t){r.minute_slider.slider("option","value",t.value);r._onTimeChange()}});this.second_slider=$tp.find("#ui_tpicker_second_"+u).slider({orientation:"horizontal",value:this.second,min:t.secondMin,max:nt,step:t.stepSecond,slide:function(n,t){r.second_slider.slider("option","value",t.value);r._onTimeChange()}});this.millisec_slider=$tp.find("#ui_tpicker_millisec_"+u).slider({orientation:"horizontal",value:this.millisec,min:t.millisecMin,max:tt,step:t.stepMillisec,slide:function(n,t){r.millisec_slider.slider("option","value",t.value);r._onTimeChange()}});this.timezone_select=$tp.find("#ui_tpicker_timezone_"+u).append("<select><\/select>").find("select");n.fn.append.apply(this.timezone_select,n.map(t.timezoneList,function(t){return n("<option />").val(typeof t=="object"?t.value:t).text(typeof t=="object"?t.label:t)}));this.timezone_select.val(typeof this.timezone!="undefined"&&this.timezone!=null&&this.timezone!=""?this.timezone:t.timezone);this.timezone_select.change(function(){r._onTimeChange()});t.showHour&&t.hourGrid>0&&(e=100*y*t.hourGrid/(w-t.hourMin),$tp.find(".ui_tpicker_hour table").css({width:e+"%",marginLeft:e/(-2*y)+"%",borderCollapse:"collapse"}).find("td").each(function(){n(this).click(function(){var u=n(this).html(),f,i;t.ampm&&(f=u.substring(2).toLowerCase(),i=parseInt(u.substring(0,2),10),u=f=="a"?i==12?0:i:i==12?12:i+12);r.hour_slider.slider("option","value",u);r._onTimeChange();r._onSelectHandler()}).css({cursor:"pointer",width:100/y+"%",textAlign:"center",overflow:"hidden"})}));t.showMinute&&t.minuteGrid>0&&(e=100*p*t.minuteGrid/(b-t.minuteMin),$tp.find(".ui_tpicker_minute table").css({width:e+"%",marginLeft:e/(-2*p)+"%",borderCollapse:"collapse"}).find("td").each(function(){n(this).click(function(){r.minute_slider.slider("option","value",n(this).html());r._onTimeChange();r._onSelectHandler()}).css({cursor:"pointer",width:100/p+"%",textAlign:"center",overflow:"hidden"})}));t.showSecond&&t.secondGrid>0&&$tp.find(".ui_tpicker_second table").css({width:e+"%",marginLeft:e/(-2*k)+"%",borderCollapse:"collapse"}).find("td").each(function(){n(this).click(function(){r.second_slider.slider("option","value",n(this).html());r._onTimeChange();r._onSelectHandler()}).css({cursor:"pointer",width:100/k+"%",textAlign:"center",overflow:"hidden"})});t.showMillisec&&t.millisecGrid>0&&$tp.find(".ui_tpicker_millisec table").css({width:e+"%",marginLeft:e/(-2*d)+"%",borderCollapse:"collapse"}).find("td").each(function(){n(this).click(function(){r.millisec_slider.slider("option","value",n(this).html());r._onTimeChange();r._onSelectHandler()}).css({cursor:"pointer",width:100/d+"%",textAlign:"center",overflow:"hidden"})});g=v.find(".ui-datepicker-buttonpane");g.length?g.before($tp):v.append($tp);this.$timeObj=$tp.find("#ui_tpicker_time_"+u);this.inst!==null&&(it=this.timeDefined,this._onTimeChange(),this.timeDefined=it);a=function(){r._onSelectHandler()};this.hour_slider.bind("slidestop",a);this.minute_slider.bind("slidestop",a);this.second_slider.bind("slidestop",a);this.millisec_slider.bind("slidestop",a);this._defaults.addSliderAccess&&(rt=this._defaults.sliderAccessArgs,setTimeout(function(){if($tp.find(".ui-slider-access").length==0){$tp.find(".ui-slider:visible").sliderAccess(rt);var t=$tp.find(".ui-slider-access:eq(0)").outerWidth(!0);t&&$tp.find("table:visible").each(function(){var i=n(this),r=i.outerWidth(),f=i.css("marginLeft").toString().replace("%",""),u=r-t,e=f*u/r+"%";i.css({width:u,marginLeft:e})})}},0))}},_limitMinMaxDateTime:function(t,i){var r=this._defaults,e=new Date(t.selectedYear,t.selectedMonth,t.selectedDay),u,o,f,s;if(this._defaults.showTimepicker&&(n.datepicker._get(t,"minDateTime")!==null&&n.datepicker._get(t,"minDateTime")!==undefined&&e&&(u=n.datepicker._get(t,"minDateTime"),o=new Date(u.getFullYear(),u.getMonth(),u.getDate(),0,0,0,0),(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null||this.millisecMinOriginal===null)&&(this.hourMinOriginal=r.hourMin,this.minuteMinOriginal=r.minuteMin,this.secondMinOriginal=r.secondMin,this.millisecMinOriginal=r.millisecMin),t.settings.timeOnly||o.getTime()==e.getTime()?(this._defaults.hourMin=u.getHours(),this.hour<=this._defaults.hourMin?(this.hour=this._defaults.hourMin,this._defaults.minuteMin=u.getMinutes(),this.minute<=this._defaults.minuteMin?(this.minute=this._defaults.minuteMin,this._defaults.secondMin=u.getSeconds()):this.second<=this._defaults.secondMin?(this.second=this._defaults.secondMin,this._defaults.millisecMin=u.getMilliseconds()):(this.millisec<this._defaults.millisecMin&&(this.millisec=this._defaults.millisecMin),this._defaults.millisecMin=this.millisecMinOriginal)):(this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal)):(this._defaults.hourMin=this.hourMinOriginal,this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal)),n.datepicker._get(t,"maxDateTime")!==null&&n.datepicker._get(t,"maxDateTime")!==undefined&&e&&(f=n.datepicker._get(t,"maxDateTime"),s=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0,0),(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null)&&(this.hourMaxOriginal=r.hourMax,this.minuteMaxOriginal=r.minuteMax,this.secondMaxOriginal=r.secondMax,this.millisecMaxOriginal=r.millisecMax),t.settings.timeOnly||s.getTime()==e.getTime()?(this._defaults.hourMax=f.getHours(),this.hour>=this._defaults.hourMax?(this.hour=this._defaults.hourMax,this._defaults.minuteMax=f.getMinutes(),this.minute>=this._defaults.minuteMax?(this.minute=this._defaults.minuteMax,this._defaults.secondMax=f.getSeconds()):this.second>=this._defaults.secondMax?(this.second=this._defaults.secondMax,this._defaults.millisecMax=f.getMilliseconds()):(this.millisec>this._defaults.millisecMax&&(this.millisec=this._defaults.millisecMax),this._defaults.millisecMax=this.millisecMaxOriginal)):(this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal)):(this._defaults.hourMax=this.hourMaxOriginal,this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal)),i!==undefined&&i===!0)){var h=parseInt(this._defaults.hourMax-(this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour,10),c=parseInt(this._defaults.minuteMax-(this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute,10),l=parseInt(this._defaults.secondMax-(this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond,10),a=parseInt(this._defaults.millisecMax-(this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec,10);this.hour_slider&&this.hour_slider.slider("option",{min:this._defaults.hourMin,max:h}).slider("value",this.hour);this.minute_slider&&this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:c}).slider("value",this.minute);this.second_slider&&this.second_slider.slider("option",{min:this._defaults.secondMin,max:l}).slider("value",this.second);this.millisec_slider&&this.millisec_slider.slider("option",{min:this._defaults.millisecMin,max:a}).slider("value",this.millisec)}},_onTimeChange:function(){var t=this.hour_slider?this.hour_slider.slider("value"):!1,i=this.minute_slider?this.minute_slider.slider("value"):!1,r=this.second_slider?this.second_slider.slider("value"):!1,u=this.millisec_slider?this.millisec_slider.slider("value"):!1,f=this.timezone_select?this.timezone_select.val():!1,e=this._defaults,s,o;typeof t=="object"&&(t=!1);typeof i=="object"&&(i=!1);typeof r=="object"&&(r=!1);typeof u=="object"&&(u=!1);typeof f=="object"&&(f=!1);t!==!1&&(t=parseInt(t,10));i!==!1&&(i=parseInt(i,10));r!==!1&&(r=parseInt(r,10));u!==!1&&(u=parseInt(u,10));s=e[t<12?"amNames":"pmNames"][0];o=t!=this.hour||i!=this.minute||r!=this.second||u!=this.millisec||this.ampm.length>0&&t<12!=(n.inArray(this.ampm.toUpperCase(),this.amNames)!==-1)||f!=this.timezone;o&&(t!==!1&&(this.hour=t),i!==!1&&(this.minute=i),r!==!1&&(this.second=r),u!==!1&&(this.millisec=u),f!==!1&&(this.timezone=f),this.inst||(this.inst=n.datepicker._getInst(this.$input[0])),this._limitMinMaxDateTime(this.inst,!0));e.ampm&&(this.ampm=s);this.formattedTime=n.datepicker.formatTime(this._defaults.timeFormat,this,this._defaults);this.$timeObj&&this.$timeObj.text(this.formattedTime+e.timeSuffix);this.timeDefined=!0;o&&this._updateDateTime()},_onSelectHandler:function(){var n=this._defaults.onSelect,t=this.$input?this.$input[0]:null;n&&t&&n.apply(t,[this.formattedDateTime,this])},_formatTime:function(t,i){t=t||{hour:this.hour,minute:this.minute,second:this.second,millisec:this.millisec,ampm:this.ampm,timezone:this.timezone};var r=(i||this._defaults.timeFormat).toString();if(r=n.datepicker.formatTime(r,t,this._defaults),arguments.length)return r;this.formattedTime=r},_updateDateTime:function(t){var i;t=this.inst||t;var r=n.datepicker._daylightSavingAdjust(new Date(t.selectedYear,t.selectedMonth,t.selectedDay)),u=n.datepicker._get(t,"dateFormat"),f=n.datepicker._getFormatConfig(t),e=r!==null&&this.timeDefined;(this.formattedDate=n.datepicker.formatDate(u,r===null?new Date:r,f),i=this.formattedDate,t.lastVal!==undefined&&t.lastVal.length>0&&this.$input.val().length===0)||(this._defaults.timeOnly===!0?i=this.formattedTime:this._defaults.timeOnly!==!0&&(this._defaults.alwaysSetTime||e)&&(i+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=i,this._defaults.showTimepicker?this.$altInput&&this._defaults.altFieldTimeOnly===!0?(this.$altInput.val(this.formattedTime),this.$input.val(this.formattedDate)):this.$altInput?(this.$altInput.val(i),this.$input.val(i)):this.$input.val(i):this.$input.val(this.formattedDate),this.$input.trigger("change"))}}),n.fn.extend({timepicker:function(t){t=t||{};var i=arguments;return typeof t=="object"&&(i[0]=n.extend(t,{timeOnly:!0})),n(this).each(function(){n.fn.datetimepicker.apply(n(this),i)})},datetimepicker:function(t){return t=t||{},tmp_args=arguments,typeof t=="string"?t=="getDate"?n.fn.datepicker.apply(n(this[0]),tmp_args):this.each(function(){var t=n(this);t.datepicker.apply(t,tmp_args)}):this.each(function(){var i=n(this);i.datepicker(n.timepicker._newInst(i,t)._defaults)})}}),n.datepicker.formatTime=function(t,i,r){r=r||{};r=n.extend(n.timepicker._defaults,r);i=n.extend({hour:0,minute:0,second:0,millisec:0,timezone:"+0000"},i);var e=t,f=r.amNames[0],u=parseInt(i.hour,10);return r.ampm&&(u>11&&(f=r.pmNames[0],u>12&&(u=u%12)),u===0&&(u=12)),e=e.replace(/(?:hh?|HH?|mm?|ss?|[tT]{1,2}|[lz])/g,function(n){switch(n.toLowerCase()){case"hh":return("0"+u).slice(-2);case"h":return u;case"mm":return("0"+i.minute).slice(-2);case"m":return i.minute;case"ss":return("0"+i.second).slice(-2);case"s":return i.second;case"l":return("00"+i.millisec).slice(-3);case"z":return i.timezone;case"t":case"tt":return r.ampm?(n.length==1&&(f=f.charAt(0)),n.charAt(0)=="T"?f.toUpperCase():f.toLowerCase()):""}}),n.trim(e)},n.datepicker._base_selectDate=n.datepicker._selectDate,n.datepicker._selectDate=function(t,i){var r=this._getInst(n(t)[0]),u=this._get(r,"timepicker");u?(u._limitMinMaxDateTime(r,!0),r.inline=r.stay_open=!0,this._base_selectDate(t,i),r.inline=r.stay_open=!1,this._notifyChange(r),this._updateDatepicker(r)):this._base_selectDate(t,i)},n.datepicker._base_updateDatepicker=n.datepicker._updateDatepicker,n.datepicker._updateDatepicker=function(t){var r=t.input[0],i;n.datepicker._curInst&&n.datepicker._curInst!=t&&n.datepicker._datepickerShowing&&n.datepicker._lastInput!=r||(typeof t.stay_open!="boolean"||t.stay_open===!1)&&(this._base_updateDatepicker(t),i=this._get(t,"timepicker"),i&&i._addTimePicker(t))},n.datepicker._base_doKeyPress=n.datepicker._doKeyPress,n.datepicker._doKeyPress=function(t){var u=n.datepicker._getInst(t.target),i=n.datepicker._get(u,"timepicker");if(i&&n.datepicker._get(u,"constrainInput")){var r=i._defaults.ampm,f=n.datepicker._possibleChars(n.datepicker._get(u,"dateFormat")),o=i._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,r?"APM":"").replace(/Tt/g,r?"AaPpMm":"").replace(/tT/g,r?"AaPpMm":"").replace(/T/g,r?"AP":"").replace(/tt/g,r?"apm":"").replace(/t/g,r?"ap":"")+" "+i._defaults.separator+i._defaults.timeSuffix+(i._defaults.showTimezone?i._defaults.timezoneList.join(""):"")+i._defaults.amNames.join("")+i._defaults.pmNames.join("")+f,e=String.fromCharCode(t.charCode===undefined?t.keyCode:t.charCode);return t.ctrlKey||e<" "||!f||o.indexOf(e)>-1}return n.datepicker._base_doKeyPress(t)},n.datepicker._base_doKeyUp=n.datepicker._doKeyUp,n.datepicker._doKeyUp=function(t){var i=n.datepicker._getInst(t.target),r=n.datepicker._get(i,"timepicker");if(r&&r._defaults.timeOnly&&i.input.val()!=i.lastVal)try{n.datepicker._updateDatepicker(i)}catch(u){n.datepicker.log(u)}return n.datepicker._base_doKeyUp(t)},n.datepicker._base_gotoToday=n.datepicker._gotoToday,n.datepicker._gotoToday=function(t){var u=this._getInst(n(t)[0]),s=u.dpDiv,f,r,i,o,e;this._base_gotoToday(t);f=new Date;r=this._get(u,"timepicker");r&&r._defaults.showTimezone&&r.timezone_select&&(i=f.getTimezoneOffset(),o=i>0?"-":"+",i=Math.abs(i),e=i%60,i=o+("0"+(i-e)/60).slice(-2)+("0"+e).slice(-2),r._defaults.timezoneIso8609&&(i=i.substring(0,3)+":"+i.substring(3)),r.timezone_select.val(i));this._setTime(u,f);n(".ui-datepicker-today",s).click()},n.datepicker._disableTimepickerDatepicker=function(t){var r=this._getInst(t),i=this._get(r,"timepicker");n(t).datepicker("getDate");i&&(i._defaults.showTimepicker=!1,i._updateDateTime(r))},n.datepicker._enableTimepickerDatepicker=function(t){var r=this._getInst(t),i=this._get(r,"timepicker");n(t).datepicker("getDate");i&&(i._defaults.showTimepicker=!0,i._addTimePicker(r),i._updateDateTime(r))},n.datepicker._setTime=function(n,t){var i=this._get(n,"timepicker");if(i){var r=i._defaults,u=t?t.getHours():r.hour,f=t?t.getMinutes():r.minute,e=t?t.getSeconds():r.second,o=t?t.getMilliseconds():r.millisec;(u<r.hourMin||u>r.hourMax||f<r.minuteMin||f>r.minuteMax||e<r.secondMin||e>r.secondMax||o<r.millisecMin||o>r.millisecMax)&&(u=r.hourMin,f=r.minuteMin,e=r.secondMin,o=r.millisecMin);i.hour=u;i.minute=f;i.second=e;i.millisec=o;i.hour_slider&&i.hour_slider.slider("value",u);i.minute_slider&&i.minute_slider.slider("value",f);i.second_slider&&i.second_slider.slider("value",e);i.millisec_slider&&i.millisec_slider.slider("value",o);i._onTimeChange();i._updateDateTime(n)}},n.datepicker._setTimeDatepicker=function(n,t,i){var f=this._getInst(n),r=this._get(f,"timepicker"),u;r&&(this._setDateFromField(f),t&&(typeof t=="string"?(r._parseTime(t,i),u=new Date,u.setHours(r.hour,r.minute,r.second,r.millisec)):u=new Date(t.getTime()),u.toString()=="Invalid Date"&&(u=undefined),this._setTime(f,u)))},n.datepicker._base_setDateDatepicker=n.datepicker._setDateDatepicker,n.datepicker._setDateDatepicker=function(n,t){var i=this._getInst(n),r=t instanceof Date?new Date(t.getTime()):t;this._updateDatepicker(i);this._base_setDateDatepicker.apply(this,arguments);this._setTimeDatepicker(n,r,!0)},n.datepicker._base_getDateDatepicker=n.datepicker._getDateDatepicker,n.datepicker._getDateDatepicker=function(t,i){var f=this._getInst(t),r=this._get(f,"timepicker"),u;return r?(this._setDateFromField(f,i),u=this._getDate(f),u&&r._parseTime(n(t).val(),r.timeOnly)&&u.setHours(r.hour,r.minute,r.second,r.millisec),u):this._base_getDateDatepicker(t,i)},n.datepicker._base_parseDate=n.datepicker.parseDate,n.datepicker.parseDate=function(n,t,i){var u;try{u=this._base_parseDate(n,t,i)}catch(r){if(r.indexOf(":")>=0)u=this._base_parseDate(n,t.substring(0,t.length-(r.length-r.indexOf(":")-2)),i);else throw r;}return u},n.datepicker._base_formatDate=n.datepicker._formatDate,n.datepicker._formatDate=function(n){var t=this._get(n,"timepicker");return t?(t._updateDateTime(n),t.$input.val()):this._base_formatDate(n)},n.datepicker._base_optionDatepicker=n.datepicker._optionDatepicker,n.datepicker._optionDatepicker=function(n,t,i){var o=this._getInst(n),f=this._get(o,"timepicker");if(f){var r=null,u=null,e=null;typeof t=="string"?t==="minDate"||t==="minDateTime"?r=i:t==="maxDate"||t==="maxDateTime"?u=i:t==="onSelect"&&(e=i):typeof t=="object"&&(t.minDate?r=t.minDate:t.minDateTime?r=t.minDateTime:t.maxDate?u=t.maxDate:t.maxDateTime&&(u=t.maxDateTime));r?(r=r==0?new Date:new Date(r),f._defaults.minDate=r,f._defaults.minDateTime=r):u?(u=u==0?new Date:new Date(u),f._defaults.maxDate=u,f._defaults.maxDateTime=u):e&&(f._defaults.onSelect=e)}return i===undefined?this._base_optionDatepicker(n,t):this._base_optionDatepicker(n,t,i)},n.timepicker=new t,n.timepicker.version="1.0.0")})(jQuery);
// 4.1.6 (2014-10-08) @notMinified 
!function (e, t) { "use strict"; function n(e, t) { for (var n, r = [], i = 0; i < e.length; ++i) { if (n = s[e[i]] || o(e[i]), !n) throw "module definition dependecy not found: " + e[i]; r.push(n) } t.apply(null, r) } function r(e, r, i) { if ("string" != typeof e) throw "invalid module definition, module id must be defined and be a string"; if (r === t) throw "invalid module definition, dependencies must be specified"; if (i === t) throw "invalid module definition, definition function must be specified"; n(r, function () { s[e] = i.apply(null, arguments) }) } function i(e) { return !!s[e] } function o(t) { for (var n = e, r = t.split(/[.\/]/), i = 0; i < r.length; ++i) { if (!n[r[i]]) return; n = n[r[i]] } return n } function a(n) { for (var r = 0; r < n.length; r++) { for (var i = e, o = n[r], a = o.split(/[.\/]/), l = 0; l < a.length - 1; ++l) i[a[l]] === t && (i[a[l]] = {}), i = i[a[l]]; i[a[a.length - 1]] = s[o] } } var s = {}, l = "tinymce/dom/EventUtils", c = "tinymce/dom/Sizzle", u = "tinymce/util/Tools", d = "tinymce/Env", f = "tinymce/dom/DomQuery", p = "tinymce/html/Styles", h = "tinymce/dom/TreeWalker", m = "tinymce/dom/Range", g = "tinymce/html/Entities", v = "tinymce/dom/StyleSheetLoader", y = "tinymce/dom/DOMUtils", b = "tinymce/dom/ScriptLoader", C = "tinymce/AddOnManager", x = "tinymce/dom/RangeUtils", w = "tinymce/NodeChange", _ = "tinymce/html/Node", E = "tinymce/html/Schema", N = "tinymce/html/SaxParser", k = "tinymce/html/DomParser", S = "tinymce/html/Writer", T = "tinymce/html/Serializer", R = "tinymce/dom/Serializer", A = "tinymce/dom/TridentSelection", B = "tinymce/util/VK", D = "tinymce/dom/ControlSelection", L = "tinymce/dom/BookmarkManager", H = "tinymce/dom/Selection", M = "tinymce/dom/ElementUtils", P = "tinymce/fmt/Preview", O = "tinymce/Formatter", I = "tinymce/UndoManager", F = "tinymce/EnterKey", z = "tinymce/ForceBlocks", W = "tinymce/EditorCommands", V = "tinymce/util/URI", U = "tinymce/util/Class", $ = "tinymce/util/EventDispatcher", q = "tinymce/ui/Selector", j = "tinymce/ui/Collection", Y = "tinymce/ui/DomUtils", K = "tinymce/ui/Control", G = "tinymce/ui/Factory", X = "tinymce/ui/KeyboardNavigation", J = "tinymce/ui/Container", Q = "tinymce/ui/DragHelper", Z = "tinymce/ui/Scrollable", et = "tinymce/ui/Panel", tt = "tinymce/ui/Movable", nt = "tinymce/ui/Resizable", rt = "tinymce/ui/FloatPanel", it = "tinymce/ui/Window", ot = "tinymce/ui/MessageBox", at = "tinymce/WindowManager", st = "tinymce/util/Quirks", lt = "tinymce/util/Observable", ct = "tinymce/EditorObservable", ut = "tinymce/Shortcuts", dt = "tinymce/Editor", ft = "tinymce/util/I18n", pt = "tinymce/FocusManager", ht = "tinymce/EditorManager", mt = "tinymce/LegacyInput", gt = "tinymce/util/XHR", vt = "tinymce/util/JSON", yt = "tinymce/util/JSONRequest", bt = "tinymce/util/JSONP", Ct = "tinymce/util/LocalStorage", xt = "tinymce/Compat", wt = "tinymce/ui/Layout", _t = "tinymce/ui/AbsoluteLayout", Et = "tinymce/ui/Tooltip", Nt = "tinymce/ui/Widget", kt = "tinymce/ui/Button", St = "tinymce/ui/ButtonGroup", Tt = "tinymce/ui/Checkbox", Rt = "tinymce/ui/ComboBox", At = "tinymce/ui/ColorBox", Bt = "tinymce/ui/PanelButton", Dt = "tinymce/ui/ColorButton", Lt = "tinymce/util/Color", Ht = "tinymce/ui/ColorPicker", Mt = "tinymce/ui/Path", Pt = "tinymce/ui/ElementPath", Ot = "tinymce/ui/FormItem", It = "tinymce/ui/Form", Ft = "tinymce/ui/FieldSet", zt = "tinymce/ui/FilePicker", Wt = "tinymce/ui/FitLayout", Vt = "tinymce/ui/FlexLayout", Ut = "tinymce/ui/FlowLayout", $t = "tinymce/ui/FormatControls", qt = "tinymce/ui/GridLayout", jt = "tinymce/ui/Iframe", Yt = "tinymce/ui/Label", Kt = "tinymce/ui/Toolbar", Gt = "tinymce/ui/MenuBar", Xt = "tinymce/ui/MenuButton", Jt = "tinymce/ui/ListBox", Qt = "tinymce/ui/MenuItem", Zt = "tinymce/ui/Menu", en = "tinymce/ui/Radio", tn = "tinymce/ui/ResizeHandle", nn = "tinymce/ui/Spacer", rn = "tinymce/ui/SplitButton", on = "tinymce/ui/StackLayout", an = "tinymce/ui/TabPanel", sn = "tinymce/ui/TextBox", ln = "tinymce/ui/Throbber"; r(l, [], function () { function e(e, t, n, r) { e.addEventListener ? e.addEventListener(t, n, r || !1) : e.attachEvent && e.attachEvent("on" + t, n) } function t(e, t, n, r) { e.removeEventListener ? e.removeEventListener(t, n, r || !1) : e.detachEvent && e.detachEvent("on" + t, n) } function n(e, t) { function n() { return !1 } function r() { return !0 } var i, o = t || {}, l; for (i in e) s[i] || (o[i] = e[i]); if (o.target || (o.target = o.srcElement || document), e && a.test(e.type) && e.pageX === l && e.clientX !== l) { var c = o.target.ownerDocument || document, u = c.documentElement, d = c.body; o.pageX = e.clientX + (u && u.scrollLeft || d && d.scrollLeft || 0) - (u && u.clientLeft || d && d.clientLeft || 0), o.pageY = e.clientY + (u && u.scrollTop || d && d.scrollTop || 0) - (u && u.clientTop || d && d.clientTop || 0) } return o.preventDefault = function () { o.isDefaultPrevented = r, e && (e.preventDefault ? e.preventDefault() : e.returnValue = !1) }, o.stopPropagation = function () { o.isPropagationStopped = r, e && (e.stopPropagation ? e.stopPropagation() : e.cancelBubble = !0) }, o.stopImmediatePropagation = function () { o.isImmediatePropagationStopped = r, o.stopPropagation() }, o.isDefaultPrevented || (o.isDefaultPrevented = n, o.isPropagationStopped = n, o.isImmediatePropagationStopped = n), o } function r(n, r, i) { function o() { i.domLoaded || (i.domLoaded = !0, r(c)) } function a() { ("complete" === l.readyState || "interactive" === l.readyState && l.body) && (t(l, "readystatechange", a), o()) } function s() { try { l.documentElement.doScroll("left") } catch (e) { return void setTimeout(s, 0) } o() } var l = n.document, c = { type: "ready" }; return i.domLoaded ? void r(c) : (l.addEventListener ? "complete" === l.readyState ? o() : e(n, "DOMContentLoaded", o) : (e(l, "readystatechange", a), l.documentElement.doScroll && n.self === n.top && s()), void e(n, "load", o)) } function i() { function i(e, t) { var n, r, i, o, a = s[t]; if (n = a && a[e.type]) for (r = 0, i = n.length; i > r; r++) if (o = n[r], o && o.func.call(o.scope, e) === !1 && e.preventDefault(), e.isImmediatePropagationStopped()) return } var a = this, s = {}, l, c, u, d, f; c = o + (+new Date).toString(32), d = "onmouseenter" in document.documentElement, u = "onfocusin" in document.documentElement, f = { mouseenter: "mouseover", mouseleave: "mouseout" }, l = 1, a.domLoaded = !1, a.events = s, a.bind = function (t, o, p, h) { function m(e) { i(n(e || _.event), g) } var g, v, y, b, C, x, w, _ = window; if (t && 3 !== t.nodeType && 8 !== t.nodeType) { for (t[c] ? g = t[c] : (g = l++, t[c] = g, s[g] = {}), h = h || t, o = o.split(" "), y = o.length; y--; ) b = o[y], x = m, C = w = !1, "DOMContentLoaded" === b && (b = "ready"), a.domLoaded && "ready" === b && "complete" == t.readyState ? p.call(h, n({ type: b })) : (d || (C = f[b], C && (x = function (e) { var t, r; if (t = e.currentTarget, r = e.relatedTarget, r && t.contains) r = t.contains(r); else for (; r && r !== t; ) r = r.parentNode; r || (e = n(e || _.event), e.type = "mouseout" === e.type ? "mouseleave" : "mouseenter", e.target = t, i(e, g)) })), u || "focusin" !== b && "focusout" !== b || (w = !0, C = "focusin" === b ? "focus" : "blur", x = function (e) { e = n(e || _.event), e.type = "focus" === e.type ? "focusin" : "focusout", i(e, g) }), v = s[g][b], v ? "ready" === b && a.domLoaded ? p({ type: b }) : v.push({ func: p, scope: h }) : (s[g][b] = v = [{ func: p, scope: h}], v.fakeName = C, v.capture = w, v.nativeHandler = x, "ready" === b ? r(t, x, a) : e(t, C || b, x, w))); return t = v = 0, p } }, a.unbind = function (e, n, r) { var i, o, l, u, d, f; if (!e || 3 === e.nodeType || 8 === e.nodeType) return a; if (i = e[c]) { if (f = s[i], n) { for (n = n.split(" "), l = n.length; l--; ) if (d = n[l], o = f[d]) { if (r) for (u = o.length; u--; ) if (o[u].func === r) { var p = o.nativeHandler, h = o.fakeName, m = o.capture; o = o.slice(0, u).concat(o.slice(u + 1)), o.nativeHandler = p, o.fakeName = h, o.capture = m, f[d] = o } r && 0 !== o.length || (delete f[d], t(e, o.fakeName || d, o.nativeHandler, o.capture)) } } else { for (d in f) o = f[d], t(e, o.fakeName || d, o.nativeHandler, o.capture); f = {} } for (d in f) return a; delete s[i]; try { delete e[c] } catch (g) { e[c] = null } } return a }, a.fire = function (e, t, r) { var o; if (!e || 3 === e.nodeType || 8 === e.nodeType) return a; r = n(null, r), r.type = t, r.target = e; do o = e[c], o && i(r, o), e = e.parentNode || e.ownerDocument || e.defaultView || e.parentWindow; while (e && !r.isPropagationStopped()); return a }, a.clean = function (e) { var t, n, r = a.unbind; if (!e || 3 === e.nodeType || 8 === e.nodeType) return a; if (e[c] && r(e), e.getElementsByTagName || (e = e.document), e && e.getElementsByTagName) for (r(e), n = e.getElementsByTagName("*"), t = n.length; t--; ) e = n[t], e[c] && r(e); return a }, a.destroy = function () { s = {} }, a.cancel = function (e) { return e && (e.preventDefault(), e.stopImmediatePropagation()), !1 } } var o = "mce-data-", a = /^(?:mouse|contextmenu)|click/, s = { keyLocation: 1, layerX: 1, layerY: 1, returnValue: 1 }; return i.Event = new i, i.Event.bind(window, "ready", function () { }), i }), r(c, [], function () { function e(e, t, n, r) { var i, o, a, s, l, c, d, p, h, m; if ((t ? t.ownerDocument || t : z) !== D && B(t), t = t || D, n = n || [], !e || "string" != typeof e) return n; if (1 !== (s = t.nodeType) && 9 !== s) return []; if (H && !r) { if (i = vt.exec(e)) if (a = i[1]) { if (9 === s) { if (o = t.getElementById(a), !o || !o.parentNode) return n; if (o.id === a) return n.push(o), n } else if (t.ownerDocument && (o = t.ownerDocument.getElementById(a)) && I(t, o) && o.id === a) return n.push(o), n } else { if (i[2]) return Z.apply(n, t.getElementsByTagName(e)), n; if ((a = i[3]) && x.getElementsByClassName) return Z.apply(n, t.getElementsByClassName(a)), n } if (x.qsa && (!M || !M.test(e))) { if (p = d = F, h = t, m = 9 === s && e, 1 === s && "object" !== t.nodeName.toLowerCase()) { for (c = N(e), (d = t.getAttribute("id")) ? p = d.replace(bt, "\\$&") : t.setAttribute("id", p), p = "[id='" + p + "'] ", l = c.length; l--; ) c[l] = p + f(c[l]); h = yt.test(e) && u(t.parentNode) || t, m = c.join(",") } if (m) try { return Z.apply(n, h.querySelectorAll(m)), n } catch (g) { } finally { d || t.removeAttribute("id") } } } return S(e.replace(st, "$1"), t, n, r) } function n() { function e(n, r) { return t.push(n + " ") > w.cacheLength && delete e[t.shift()], e[n + " "] = r } var t = []; return e } function r(e) { return e[F] = !0, e } function i(e) { var t = D.createElement("div"); try { return !!e(t) } catch (n) { return !1 } finally { t.parentNode && t.parentNode.removeChild(t), t = null } } function o(e, t) { for (var n = e.split("|"), r = e.length; r--; ) w.attrHandle[n[r]] = t } function a(e, t) { var n = t && e, r = n && 1 === e.nodeType && 1 === t.nodeType && (~t.sourceIndex || K) - (~e.sourceIndex || K); if (r) return r; if (n) for (; n = n.nextSibling; ) if (n === t) return -1; return e ? 1 : -1 } function s(e) { return function (t) { var n = t.nodeName.toLowerCase(); return "input" === n && t.type === e } } function l(e) { return function (t) { var n = t.nodeName.toLowerCase(); return ("input" === n || "button" === n) && t.type === e } } function c(e) { return r(function (t) { return t = +t, r(function (n, r) { for (var i, o = e([], n.length, t), a = o.length; a--; ) n[i = o[a]] && (n[i] = !(r[i] = n[i])) }) }) } function u(e) { return e && typeof e.getElementsByTagName !== Y && e } function d() { } function f(e) { for (var t = 0, n = e.length, r = ""; n > t; t++) r += e[t].value; return r } function p(e, t, n) { var r = t.dir, i = n && "parentNode" === r, o = V++; return t.first ? function (t, n, o) { for (; t = t[r]; ) if (1 === t.nodeType || i) return e(t, n, o) } : function (t, n, a) { var s, l, c = [W, o]; if (a) { for (; t = t[r]; ) if ((1 === t.nodeType || i) && e(t, n, a)) return !0 } else for (; t = t[r]; ) if (1 === t.nodeType || i) { if (l = t[F] || (t[F] = {}), (s = l[r]) && s[0] === W && s[1] === o) return c[2] = s[2]; if (l[r] = c, c[2] = e(t, n, a)) return !0 } } } function h(e) { return e.length > 1 ? function (t, n, r) { for (var i = e.length; i--; ) if (!e[i](t, n, r)) return !1; return !0 } : e[0] } function m(t, n, r) { for (var i = 0, o = n.length; o > i; i++) e(t, n[i], r); return r } function g(e, t, n, r, i) { for (var o, a = [], s = 0, l = e.length, c = null != t; l > s; s++) (o = e[s]) && (!n || n(o, r, i)) && (a.push(o), c && t.push(s)); return a } function v(e, t, n, i, o, a) { return i && !i[F] && (i = v(i)), o && !o[F] && (o = v(o, a)), r(function (r, a, s, l) { var c, u, d, f = [], p = [], h = a.length, v = r || m(t || "*", s.nodeType ? [s] : s, []), y = !e || !r && t ? v : g(v, f, e, s, l), b = n ? o || (r ? e : h || i) ? [] : a : y; if (n && n(y, b, s, l), i) for (c = g(b, p), i(c, [], s, l), u = c.length; u--; ) (d = c[u]) && (b[p[u]] = !(y[p[u]] = d)); if (r) { if (o || e) { if (o) { for (c = [], u = b.length; u--; ) (d = b[u]) && c.push(y[u] = d); o(null, b = [], c, l) } for (u = b.length; u--; ) (d = b[u]) && (c = o ? tt.call(r, d) : f[u]) > -1 && (r[c] = !(a[c] = d)) } } else b = g(b === a ? b.splice(h, b.length) : b), o ? o(null, a, b, l) : Z.apply(a, b) }) } function y(e) { for (var t, n, r, i = e.length, o = w.relative[e[0].type], a = o || w.relative[" "], s = o ? 1 : 0, l = p(function (e) { return e === t }, a, !0), c = p(function (e) { return tt.call(t, e) > -1 }, a, !0), u = [function (e, n, r) { return !o && (r || n !== T) || ((t = n).nodeType ? l(e, n, r) : c(e, n, r)) } ]; i > s; s++) if (n = w.relative[e[s].type]) u = [p(h(u), n)]; else { if (n = w.filter[e[s].type].apply(null, e[s].matches), n[F]) { for (r = ++s; i > r && !w.relative[e[r].type]; r++); return v(s > 1 && h(u), s > 1 && f(e.slice(0, s - 1).concat({ value: " " === e[s - 2].type ? "*" : "" })).replace(st, "$1"), n, r > s && y(e.slice(s, r)), i > r && y(e = e.slice(r)), i > r && f(e)) } u.push(n) } return h(u) } function b(t, n) { var i = n.length > 0, o = t.length > 0, a = function (r, a, s, l, c) { var u, d, f, p = 0, h = "0", m = r && [], v = [], y = T, b = r || o && w.find.TAG("*", c), C = W += null == y ? 1 : Math.random() || .1, x = b.length; for (c && (T = a !== D && a); h !== x && null != (u = b[h]); h++) { if (o && u) { for (d = 0; f = t[d++]; ) if (f(u, a, s)) { l.push(u); break } c && (W = C) } i && ((u = !f && u) && p--, r && m.push(u)) } if (p += h, i && h !== p) { for (d = 0; f = n[d++]; ) f(m, v, a, s); if (r) { if (p > 0) for (; h--; ) m[h] || v[h] || (v[h] = J.call(l)); v = g(v) } Z.apply(l, v), c && !r && v.length > 0 && p + n.length > 1 && e.uniqueSort(l) } return c && (W = C, T = y), m }; return i ? r(a) : a } var C, x, w, _, E, N, k, S, T, R, A, B, D, L, H, M, P, O, I, F = "sizzle" + -new Date, z = window.document, W = 0, V = 0, U = n(), $ = n(), q = n(), j = function (e, t) { return e === t && (A = !0), 0 }, Y = typeof t, K = 1 << 31, G = {}.hasOwnProperty, X = [], J = X.pop, Q = X.push, Z = X.push, et = X.slice, tt = X.indexOf || function (e) { for (var t = 0, n = this.length; n > t; t++) if (this[t] === e) return t; return -1 }, nt = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", rt = "[\\x20\\t\\r\\n\\f]", it = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", ot = "\\[" + rt + "*(" + it + ")(?:" + rt + "*([*^$|!~]?=)" + rt + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + it + "))|)" + rt + "*\\]", at = ":(" + it + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + ot + ")*)|.*)\\)|)", st = new RegExp("^" + rt + "+|((?:^|[^\\\\])(?:\\\\.)*)" + rt + "+$", "g"), lt = new RegExp("^" + rt + "*," + rt + "*"), ct = new RegExp("^" + rt + "*([>+~]|" + rt + ")" + rt + "*"), ut = new RegExp("=" + rt + "*([^\\]'\"]*?)" + rt + "*\\]", "g"), dt = new RegExp(at), ft = new RegExp("^" + it + "$"), pt = { ID: new RegExp("^#(" + it + ")"), CLASS: new RegExp("^\\.(" + it + ")"), TAG: new RegExp("^(" + it + "|[*])"), ATTR: new RegExp("^" + ot), PSEUDO: new RegExp("^" + at), CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + rt + "*(even|odd|(([+-]|)(\\d*)n|)" + rt + "*(?:([+-]|)" + rt + "*(\\d+)|))" + rt + "*\\)|)", "i"), bool: new RegExp("^(?:" + nt + ")$", "i"), needsContext: new RegExp("^" + rt + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + rt + "*((?:-\\d)?\\d*)" + rt + "*\\)|)(?=[^-]|$)", "i") }, ht = /^(?:input|select|textarea|button)$/i, mt = /^h\d$/i, gt = /^[^{]+\{\s*\[native \w/, vt = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, yt = /[+~]/, bt = /'|\\/g, Ct = new RegExp("\\\\([\\da-f]{1,6}" + rt + "?|(" + rt + ")|.)", "ig"), xt = function (e, t, n) { var r = "0x" + t - 65536; return r !== r || n ? t : 0 > r ? String.fromCharCode(r + 65536) : String.fromCharCode(r >> 10 | 55296, 1023 & r | 56320) }; try { Z.apply(X = et.call(z.childNodes), z.childNodes), X[z.childNodes.length].nodeType } catch (wt) { Z = { apply: X.length ? function (e, t) { Q.apply(e, et.call(t)) } : function (e, t) { for (var n = e.length, r = 0; e[n++] = t[r++]; ); e.length = n - 1 } } } x = e.support = {}, E = e.isXML = function (e) { var t = e && (e.ownerDocument || e).documentElement; return t ? "HTML" !== t.nodeName : !1 }, B = e.setDocument = function (e) { var t, n = e ? e.ownerDocument || e : z, r = n.defaultView; return n !== D && 9 === n.nodeType && n.documentElement ? (D = n, L = n.documentElement, H = !E(n), r && r !== r.top && (r.addEventListener ? r.addEventListener("unload", function () { B() }, !1) : r.attachEvent && r.attachEvent("onunload", function () { B() })), x.attributes = i(function (e) { return e.className = "i", !e.getAttribute("className") }), x.getElementsByTagName = i(function (e) { return e.appendChild(n.createComment("")), !e.getElementsByTagName("*").length }), x.getElementsByClassName = gt.test(n.getElementsByClassName), x.getById = i(function (e) { return L.appendChild(e).id = F, !n.getElementsByName || !n.getElementsByName(F).length }), x.getById ? (w.find.ID = function (e, t) { if (typeof t.getElementById !== Y && H) { var n = t.getElementById(e); return n && n.parentNode ? [n] : [] } }, w.filter.ID = function (e) { var t = e.replace(Ct, xt); return function (e) { return e.getAttribute("id") === t } }) : (delete w.find.ID, w.filter.ID = function (e) { var t = e.replace(Ct, xt); return function (e) { var n = typeof e.getAttributeNode !== Y && e.getAttributeNode("id"); return n && n.value === t } }), w.find.TAG = x.getElementsByTagName ? function (e, t) { return typeof t.getElementsByTagName !== Y ? t.getElementsByTagName(e) : void 0 } : function (e, t) { var n, r = [], i = 0, o = t.getElementsByTagName(e); if ("*" === e) { for (; n = o[i++]; ) 1 === n.nodeType && r.push(n); return r } return o }, w.find.CLASS = x.getElementsByClassName && function (e, t) { return H ? t.getElementsByClassName(e) : void 0 }, P = [], M = [], (x.qsa = gt.test(n.querySelectorAll)) && (i(function (e) { e.innerHTML = "<select msallowcapture=''><option selected=''></option></select>", e.querySelectorAll("[msallowcapture^='']").length && M.push("[*^$]=" + rt + "*(?:''|\"\")"), e.querySelectorAll("[selected]").length || M.push("\\[" + rt + "*(?:value|" + nt + ")"), e.querySelectorAll(":checked").length || M.push(":checked") }), i(function (e) { var t = n.createElement("input"); t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("name", "D"), e.querySelectorAll("[name=d]").length && M.push("name" + rt + "*[*^$|!~]?="), e.querySelectorAll(":enabled").length || M.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), M.push(",.*:") })), (x.matchesSelector = gt.test(O = L.matches || L.webkitMatchesSelector || L.mozMatchesSelector || L.oMatchesSelector || L.msMatchesSelector)) && i(function (e) { x.disconnectedMatch = O.call(e, "div"), O.call(e, "[s!='']:x"), P.push("!=", at) }), M = M.length && new RegExp(M.join("|")), P = P.length && new RegExp(P.join("|")), t = gt.test(L.compareDocumentPosition), I = t || gt.test(L.contains) ? function (e, t) { var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode; return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r))) } : function (e, t) { if (t) for (; t = t.parentNode; ) if (t === e) return !0; return !1 }, j = t ? function (e, t) { if (e === t) return A = !0, 0; var r = !e.compareDocumentPosition - !t.compareDocumentPosition; return r ? r : (r = (e.ownerDocument || e) === (t.ownerDocument || t) ? e.compareDocumentPosition(t) : 1, 1 & r || !x.sortDetached && t.compareDocumentPosition(e) === r ? e === n || e.ownerDocument === z && I(z, e) ? -1 : t === n || t.ownerDocument === z && I(z, t) ? 1 : R ? tt.call(R, e) - tt.call(R, t) : 0 : 4 & r ? -1 : 1) } : function (e, t) { if (e === t) return A = !0, 0; var r, i = 0, o = e.parentNode, s = t.parentNode, l = [e], c = [t]; if (!o || !s) return e === n ? -1 : t === n ? 1 : o ? -1 : s ? 1 : R ? tt.call(R, e) - tt.call(R, t) : 0; if (o === s) return a(e, t); for (r = e; r = r.parentNode; ) l.unshift(r); for (r = t; r = r.parentNode; ) c.unshift(r); for (; l[i] === c[i]; ) i++; return i ? a(l[i], c[i]) : l[i] === z ? -1 : c[i] === z ? 1 : 0 }, n) : D }, e.matches = function (t, n) { return e(t, null, null, n) }, e.matchesSelector = function (t, n) { if ((t.ownerDocument || t) !== D && B(t), n = n.replace(ut, "='$1']"), !(!x.matchesSelector || !H || P && P.test(n) || M && M.test(n))) try { var r = O.call(t, n); if (r || x.disconnectedMatch || t.document && 11 !== t.document.nodeType) return r } catch (i) { } return e(n, D, null, [t]).length > 0 }, e.contains = function (e, t) { return (e.ownerDocument || e) !== D && B(e), I(e, t) }, e.attr = function (e, n) { (e.ownerDocument || e) !== D && B(e); var r = w.attrHandle[n.toLowerCase()], i = r && G.call(w.attrHandle, n.toLowerCase()) ? r(e, n, !H) : t; return i !== t ? i : x.attributes || !H ? e.getAttribute(n) : (i = e.getAttributeNode(n)) && i.specified ? i.value : null }, e.error = function (e) { throw new Error("Syntax error, unrecognized expression: " + e) }, e.uniqueSort = function (e) { var t, n = [], r = 0, i = 0; if (A = !x.detectDuplicates, R = !x.sortStable && e.slice(0), e.sort(j), A) { for (; t = e[i++]; ) t === e[i] && (r = n.push(i)); for (; r--; ) e.splice(n[r], 1) } return R = null, e }, _ = e.getText = function (e) { var t, n = "", r = 0, i = e.nodeType; if (i) { if (1 === i || 9 === i || 11 === i) { if ("string" == typeof e.textContent) return e.textContent; for (e = e.firstChild; e; e = e.nextSibling) n += _(e) } else if (3 === i || 4 === i) return e.nodeValue } else for (; t = e[r++]; ) n += _(t); return n }, w = e.selectors = { cacheLength: 50, createPseudo: r, match: pt, attrHandle: {}, find: {}, relative: { ">": { dir: "parentNode", first: !0 }, " ": { dir: "parentNode" }, "+": { dir: "previousSibling", first: !0 }, "~": { dir: "previousSibling"} }, preFilter: { ATTR: function (e) { return e[1] = e[1].replace(Ct, xt), e[3] = (e[3] || e[4] || e[5] || "").replace(Ct, xt), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4) }, CHILD: function (t) { return t[1] = t[1].toLowerCase(), "nth" === t[1].slice(0, 3) ? (t[3] || e.error(t[0]), t[4] = +(t[4] ? t[5] + (t[6] || 1) : 2 * ("even" === t[3] || "odd" === t[3])), t[5] = +(t[7] + t[8] || "odd" === t[3])) : t[3] && e.error(t[0]), t }, PSEUDO: function (e) { var t, n = !e[6] && e[2]; return pt.CHILD.test(e[0]) ? null : (e[3] ? e[2] = e[4] || e[5] || "" : n && dt.test(n) && (t = N(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3)) } }, filter: { TAG: function (e) { var t = e.replace(Ct, xt).toLowerCase(); return "*" === e ? function () { return !0 } : function (e) { return e.nodeName && e.nodeName.toLowerCase() === t } }, CLASS: function (e) { var t = U[e + " "]; return t || (t = new RegExp("(^|" + rt + ")" + e + "(" + rt + "|$)")) && U(e, function (e) { return t.test("string" == typeof e.className && e.className || typeof e.getAttribute !== Y && e.getAttribute("class") || "") }) }, ATTR: function (t, n, r) { return function (i) { var o = e.attr(i, t); return null == o ? "!=" === n : n ? (o += "", "=" === n ? o === r : "!=" === n ? o !== r : "^=" === n ? r && 0 === o.indexOf(r) : "*=" === n ? r && o.indexOf(r) > -1 : "$=" === n ? r && o.slice(-r.length) === r : "~=" === n ? (" " + o + " ").indexOf(r) > -1 : "|=" === n ? o === r || o.slice(0, r.length + 1) === r + "-" : !1) : !0 } }, CHILD: function (e, t, n, r, i) { var o = "nth" !== e.slice(0, 3), a = "last" !== e.slice(-4), s = "of-type" === t; return 1 === r && 0 === i ? function (e) { return !!e.parentNode } : function (t, n, l) { var c, u, d, f, p, h, m = o !== a ? "nextSibling" : "previousSibling", g = t.parentNode, v = s && t.nodeName.toLowerCase(), y = !l && !s; if (g) { if (o) { for (; m; ) { for (d = t; d = d[m]; ) if (s ? d.nodeName.toLowerCase() === v : 1 === d.nodeType) return !1; h = m = "only" === e && !h && "nextSibling" } return !0 } if (h = [a ? g.firstChild : g.lastChild], a && y) { for (u = g[F] || (g[F] = {}), c = u[e] || [], p = c[0] === W && c[1], f = c[0] === W && c[2], d = p && g.childNodes[p]; d = ++p && d && d[m] || (f = p = 0) || h.pop(); ) if (1 === d.nodeType && ++f && d === t) { u[e] = [W, p, f]; break } } else if (y && (c = (t[F] || (t[F] = {}))[e]) && c[0] === W) f = c[1]; else for (; (d = ++p && d && d[m] || (f = p = 0) || h.pop()) && ((s ? d.nodeName.toLowerCase() !== v : 1 !== d.nodeType) || ! ++f || (y && ((d[F] || (d[F] = {}))[e] = [W, f]), d !== t)); ); return f -= i, f === r || f % r === 0 && f / r >= 0 } } }, PSEUDO: function (t, n) { var i, o = w.pseudos[t] || w.setFilters[t.toLowerCase()] || e.error("unsupported pseudo: " + t); return o[F] ? o(n) : o.length > 1 ? (i = [t, t, "", n], w.setFilters.hasOwnProperty(t.toLowerCase()) ? r(function (e, t) { for (var r, i = o(e, n), a = i.length; a--; ) r = tt.call(e, i[a]), e[r] = !(t[r] = i[a]) }) : function (e) { return o(e, 0, i) }) : o } }, pseudos: { not: r(function (e) { var t = [], n = [], i = k(e.replace(st, "$1")); return i[F] ? r(function (e, t, n, r) { for (var o, a = i(e, null, r, []), s = e.length; s--; ) (o = a[s]) && (e[s] = !(t[s] = o)) }) : function (e, r, o) { return t[0] = e, i(t, null, o, n), !n.pop() } }), has: r(function (t) { return function (n) { return e(t, n).length > 0 } }), contains: r(function (e) { return e = e.replace(Ct, xt), function (t) { return (t.textContent || t.innerText || _(t)).indexOf(e) > -1 } }), lang: r(function (t) { return ft.test(t || "") || e.error("unsupported lang: " + t), t = t.replace(Ct, xt).toLowerCase(), function (e) { var n; do if (n = H ? e.lang : e.getAttribute("xml:lang") || e.getAttribute("lang")) return n = n.toLowerCase(), n === t || 0 === n.indexOf(t + "-"); while ((e = e.parentNode) && 1 === e.nodeType); return !1 } }), target: function (e) { var t = window.location && window.location.hash; return t && t.slice(1) === e.id }, root: function (e) { return e === L }, focus: function (e) { return e === D.activeElement && (!D.hasFocus || D.hasFocus()) && !!(e.type || e.href || ~e.tabIndex) }, enabled: function (e) { return e.disabled === !1 }, disabled: function (e) { return e.disabled === !0 }, checked: function (e) { var t = e.nodeName.toLowerCase(); return "input" === t && !!e.checked || "option" === t && !!e.selected }, selected: function (e) { return e.parentNode && e.parentNode.selectedIndex, e.selected === !0 }, empty: function (e) { for (e = e.firstChild; e; e = e.nextSibling) if (e.nodeType < 6) return !1; return !0 }, parent: function (e) { return !w.pseudos.empty(e) }, header: function (e) { return mt.test(e.nodeName) }, input: function (e) { return ht.test(e.nodeName) }, button: function (e) { var t = e.nodeName.toLowerCase(); return "input" === t && "button" === e.type || "button" === t }, text: function (e) { var t; return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || "text" === t.toLowerCase()) }, first: c(function () { return [0] }), last: c(function (e, t) { return [t - 1] }), eq: c(function (e, t, n) { return [0 > n ? n + t : n] }), even: c(function (e, t) { for (var n = 0; t > n; n += 2) e.push(n); return e }), odd: c(function (e, t) { for (var n = 1; t > n; n += 2) e.push(n); return e }), lt: c(function (e, t, n) { for (var r = 0 > n ? n + t : n; --r >= 0; ) e.push(r); return e }), gt: c(function (e, t, n) { for (var r = 0 > n ? n + t : n; ++r < t; ) e.push(r); return e })} }, w.pseudos.nth = w.pseudos.eq; for (C in { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }) w.pseudos[C] = s(C); for (C in { submit: !0, reset: !0 }) w.pseudos[C] = l(C); return d.prototype = w.filters = w.pseudos, w.setFilters = new d, N = e.tokenize = function (t, n) { var r, i, o, a, s, l, c, u = $[t + " "]; if (u) return n ? 0 : u.slice(0); for (s = t, l = [], c = w.preFilter; s; ) { (!r || (i = lt.exec(s))) && (i && (s = s.slice(i[0].length) || s), l.push(o = [])), r = !1, (i = ct.exec(s)) && (r = i.shift(), o.push({ value: r, type: i[0].replace(st, " ") }), s = s.slice(r.length)); for (a in w.filter) !(i = pt[a].exec(s)) || c[a] && !(i = c[a](i)) || (r = i.shift(), o.push({ value: r, type: a, matches: i }), s = s.slice(r.length)); if (!r) break } return n ? s.length : s ? e.error(t) : $(t, l).slice(0) }, k = e.compile = function (e, t) { var n, r = [], i = [], o = q[e + " "]; if (!o) { for (t || (t = N(e)), n = t.length; n--; ) o = y(t[n]), o[F] ? r.push(o) : i.push(o); o = q(e, b(i, r)), o.selector = e } return o }, S = e.select = function (e, t, n, r) { var i, o, a, s, l, c = "function" == typeof e && e, d = !r && N(e = c.selector || e); if (n = n || [], 1 === d.length) { if (o = d[0] = d[0].slice(0), o.length > 2 && "ID" === (a = o[0]).type && x.getById && 9 === t.nodeType && H && w.relative[o[1].type]) { if (t = (w.find.ID(a.matches[0].replace(Ct, xt), t) || [])[0], !t) return n; c && (t = t.parentNode), e = e.slice(o.shift().value.length) } for (i = pt.needsContext.test(e) ? 0 : o.length; i-- && (a = o[i], !w.relative[s = a.type]); ) if ((l = w.find[s]) && (r = l(a.matches[0].replace(Ct, xt), yt.test(o[0].type) && u(t.parentNode) || t))) { if (o.splice(i, 1), e = r.length && f(o), !e) return Z.apply(n, r), n; break } } return (c || k(e, d))(r, t, !H, n, yt.test(e) && u(t.parentNode) || t), n }, x.sortStable = F.split("").sort(j).join("") === F, x.detectDuplicates = !!A, B(), x.sortDetached = i(function (e) { return 1 & e.compareDocumentPosition(D.createElement("div")) }), i(function (e) { return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href") }) || o("type|href|height|width", function (e, t, n) { return n ? void 0 : e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2) }), x.attributes && i(function (e) { return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value") }) || o("value", function (e, t, n) { return n || "input" !== e.nodeName.toLowerCase() ? void 0 : e.defaultValue }), i(function (e) { return null == e.getAttribute("disabled") }) || o(nt, function (e, t, n) { var r; return n ? void 0 : e[t] === !0 ? t.toLowerCase() : (r = e.getAttributeNode(t)) && r.specified ? r.value : null }), e }), r(u, [], function () { function e(e) { return null === e || e === t ? "" : ("" + e).replace(m, "") } function n(e, n) { return n ? "array" == n && g(e) ? !0 : typeof e == n : e !== t } function r(e) { var t = e, n, r; if (!g(e)) for (t = [], n = 0, r = e.length; r > n; n++) t[n] = e[n]; return t } function i(e, t, n) { var r; for (e = e || [], t = t || ",", "string" == typeof e && (e = e.split(t)), n = n || {}, r = e.length; r--; ) n[e[r]] = {}; return n } function o(e, n, r) { var i, o; if (!e) return 0; if (r = r || e, e.length !== t) { for (i = 0, o = e.length; o > i; i++) if (n.call(r, e[i], i, e) === !1) return 0 } else for (i in e) if (e.hasOwnProperty(i) && n.call(r, e[i], i, e) === !1) return 0; return 1 } function a(e, t) { var n = []; return o(e, function (e) { n.push(t(e)) }), n } function s(e, t) { var n = []; return o(e, function (e) { (!t || t(e)) && n.push(e) }), n } function l(e, t, n) { var r = this, i, o, a, s, l, c = 0; if (e = /^((static) )?([\w.]+)(:([\w.]+))?/.exec(e), a = e[3].match(/(^|\.)(\w+)$/i)[2], o = r.createNS(e[3].replace(/\.\w+$/, ""), n), !o[a]) { if ("static" == e[2]) return o[a] = t, void (this.onCreate && this.onCreate(e[2], e[3], o[a])); t[a] || (t[a] = function () { }, c = 1), o[a] = t[a], r.extend(o[a].prototype, t), e[5] && (i = r.resolve(e[5]).prototype, s = e[5].match(/\.(\w+)$/i)[1], l = o[a], o[a] = c ? function () { return i[s].apply(this, arguments) } : function () { return this.parent = i[s], l.apply(this, arguments) }, o[a].prototype[a] = o[a], r.each(i, function (e, t) { o[a].prototype[t] = i[t] }), r.each(t, function (e, t) { i[t] ? o[a].prototype[t] = function () { return this.parent = i[t], e.apply(this, arguments) } : t != a && (o[a].prototype[t] = e) })), r.each(t["static"], function (e, t) { o[a][t] = e }) } } function c(e, t) { var n, r; if (e) for (n = 0, r = e.length; r > n; n++) if (e[n] === t) return n; return -1 } function u(e, n) { var r, i, o, a = arguments, s; for (r = 1, i = a.length; i > r; r++) { n = a[r]; for (o in n) n.hasOwnProperty(o) && (s = n[o], s !== t && (e[o] = s)) } return e } function d(e, t, n, r) { r = r || this, e && (n && (e = e[n]), o(e, function (e, i) { return t.call(r, e, i, n) === !1 ? !1 : void d(e, t, n, r) })) } function f(e, t) { var n, r; for (t = t || window, e = e.split("."), n = 0; n < e.length; n++) r = e[n], t[r] || (t[r] = {}), t = t[r]; return t } function p(e, t) { var n, r; for (t = t || window, e = e.split("."), n = 0, r = e.length; r > n && (t = t[e[n]], t); n++); return t } function h(t, r) { return !t || n(t, "array") ? t : a(t.split(r || ","), e) } var m = /^\s*|\s*$/g, g = Array.isArray || function (e) { return "[object Array]" === Object.prototype.toString.call(e) }; return { trim: e, isArray: g, is: n, toArray: r, makeMap: i, each: o, map: a, grep: s, inArray: c, extend: u, create: l, walk: d, createNS: f, resolve: p, explode: h} }), r(d, [], function () { var e = navigator, t = e.userAgent, n, r, i, o, a, s, l; n = window.opera && window.opera.buildNumber, r = /WebKit/.test(t), i = !r && !n && /MSIE/gi.test(t) && /Explorer/gi.test(e.appName), i = i && /MSIE (\w+)\./.exec(t)[1], o = -1 == t.indexOf("Trident/") || -1 == t.indexOf("rv:") && -1 == e.appName.indexOf("Netscape") ? !1 : 11, i = i || o, a = !r && !o && /Gecko/.test(t), s = -1 != t.indexOf("Mac"), l = /(iPad|iPhone)/.test(t); var c = !l || t.match(/AppleWebKit\/(\d*)/)[1] >= 534; return { opera: n, webkit: r, ie: i, gecko: a, mac: s, iOS: l, contentEditable: c, transparentSrc: "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7", caretAfter: 8 != i, range: window.getSelection && "Range" in window, documentMode: i ? document.documentMode || 7 : 10} }), r(f, [l, c, u, d], function (e, n, r, i) { function o(e) { return "undefined" != typeof e } function a(e) { return "string" == typeof e } function s(e, t) { var n, r, i; for (t = t || x, i = t.createElement("div"), n = t.createDocumentFragment(), i.innerHTML = e; r = i.firstChild; ) n.appendChild(r); return n } function l(e, t, n, r) { var i; if (a(t)) t = s(t, g(e[0])); else if (t.length && !t.nodeType) { if (t = d.makeArray(t), r) for (i = t.length - 1; i >= 0; i--) l(e, t[i], n, r); else for (i = 0; i < t.length; i++) l(e, t[i], n, r); return e } if (t.nodeType) for (i = e.length; i--; ) n.call(e[i], t); return e } function c(e, t) { return e && t && -1 !== (" " + e.className + " ").indexOf(" " + t + " ") } function u(e, t, n) { var r, i; return t = d(t)[0], e.each(function () { var e = this; n && r == e.parentNode ? i.appendChild(e) : (r = e.parentNode, i = t.cloneNode(!1), e.parentNode.insertBefore(i, e), i.appendChild(e)) }), e } function d(e, t) { return new d.fn.init(e, t) } function f(e, t) { var n; if (t.indexOf) return t.indexOf(e); for (n = t.length; n--; ) if (t[n] === e) return n; return -1 } function p(e) { return null === e || e === k ? "" : ("" + e).replace(L, "") } function h(e, t) { var n, r, i, o, a; if (e) if (n = e.length, n === o) { for (r in e) if (e.hasOwnProperty(r) && (a = e[r], t.call(a, r, a) === !1)) break } else for (i = 0; n > i && (a = e[i], t.call(a, i, a) !== !1); i++); return e } function m(e, t) { var n = []; return h(e, function (e, r) { t(r, e) && n.push(r) }), n } function g(e) { return e ? 9 == e.nodeType ? e : e.ownerDocument : x } function v(e, n, r) { var i = [], o = e[n]; for ("string" != typeof r && r instanceof d && (r = r[0]); o && 9 !== o.nodeType; ) { if (r !== t) { if (o === r) break; if ("string" == typeof r && d(o).is(r)) break } 1 === o.nodeType && i.push(o), o = o[n] } return i } function y(e, n, r, i) { var o = []; for (i instanceof d && (i = i[0]); e; e = e[n]) if (!r || e.nodeType === r) { if (i !== t) { if (e === i) break; if ("string" == typeof i && d(e).is(i)) break } o.push(e) } return o } function b(e, t, n) { for (e = e[t]; e; e = e[t]) if (e.nodeType == n) return e; return null } function C(e, t, n) { h(n, function (n, r) { e[n] = e[n] || {}, e[n][t] = r }) } var x = document, w = Array.prototype.push, _ = Array.prototype.slice, E = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/, N = e.Event, k, S = r.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom", " "), T = r.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected", " "), R = { "for": "htmlFor", "class": "className", readonly: "readOnly" }, A = { "float": "cssFloat" }, B = {}, D = {}, L = /^\s*|\s*$/g; return d.fn = d.prototype = { constructor: d, selector: "", context: null, length: 0, init: function (e, t) { var n = this, r, i; if (!e) return n; if (e.nodeType) return n.context = n[0] = e, n.length = 1, n; if (t && t.nodeType) n.context = t; else { if (t) return d(e).attr(t); n.context = t = document } if (a(e)) { if (n.selector = e, r = "<" === e.charAt(0) && ">" === e.charAt(e.length - 1) && e.length >= 3 ? [null, e, null] : E.exec(e), !r) return d(t).find(e); if (r[1]) for (i = s(e, g(t)).firstChild; i; ) w.call(n, i), i = i.nextSibling; else { if (i = g(t).getElementById(r[2]), !i) return n; if (i.id !== r[2]) return n.find(e); n.length = 1, n[0] = i } } else this.add(e, !1); return n }, toArray: function () { return r.toArray(this) }, add: function (e, t) { var n = this, r, i; if (a(e)) return n.add(d(e)); if (e.nodeType) return n.add([e]); if (t !== !1) for (r = d.unique(n.toArray().concat(d.makeArray(e))), n.length = r.length, i = 0; i < r.length; i++) n[i] = r[i]; else w.apply(n, d.makeArray(e)); return n }, attr: function (e, t) { var n = this, r; if ("object" == typeof e) h(e, function (e, t) { n.attr(e, t) }); else { if (!o(t)) { if (n[0] && 1 === n[0].nodeType) { if (r = B[e], r && r.get) return r.get(n[0], e); if (T[e]) return n.prop(e) ? e : k; t = n[0].getAttribute(e, 2), null === t && (t = k) } return t } this.each(function () { var n; if (1 === this.nodeType) { if (n = B[e], n && n.set) return void n.set(this, t); null === t ? this.removeAttribute(e, 2) : this.setAttribute(e, t, 2) } }) } return n }, removeAttr: function (e) { return this.attr(e, null) }, prop: function (e, t) { var n = this; if (e = R[e] || e, "object" == typeof e) h(e, function (e, t) { n.prop(e, t) }); else { if (!o(t)) return n[0] && n[0].nodeType && e in n[0] ? n[0][e] : t; this.each(function () { 1 == this.nodeType && (this[e] = t) }) } return n }, css: function (e, t) { function n(e) { return e.replace(/-(\D)/g, function (e, t) { return t.toUpperCase() }) } function r(e) { return e.replace(/[A-Z]/g, function (e) { return "-" + e }) } var i = this, a, s; if ("object" == typeof e) h(e, function (e, t) { i.css(e, t) }); else if (o(t)) e = n(e), "number" != typeof t || S[e] || (t += "px"), i.each(function () { var n = this.style; if (s = D[e], s && s.set) return void s.set(this, t); try { this.style[A[e] || e] = t } catch (i) { } (null === t || "" === t) && (n.removeProperty ? n.removeProperty(r(e)) : n.removeAttribute(e)) }); else { if (a = i[0], s = D[e], s && s.get) return s.get(a); if (a.ownerDocument.defaultView) try { return a.ownerDocument.defaultView.getComputedStyle(a, null).getPropertyValue(r(e)) } catch (l) { return k } else if (a.currentStyle) return a.currentStyle[n(e)] } return i }, remove: function () { for (var e = this, t, n = this.length; n--; ) t = e[n], N.clean(t), t.parentNode && t.parentNode.removeChild(t); return this }, empty: function () { for (var e = this, t, n = this.length; n--; ) for (t = e[n]; t.firstChild; ) t.removeChild(t.firstChild); return this }, html: function (e) { var t = this, n; if (o(e)) { n = t.length; try { for (; n--; ) t[n].innerHTML = e } catch (r) { d(t[n]).empty().append(e) } return t } return t[0] ? t[0].innerHTML : "" }, text: function (e) { var t = this, n; if (o(e)) { for (n = t.length; n--; ) "innerText" in t[n] ? t[n].innerText = e : t[0].textContent = e; return t } return t[0] ? t[0].innerText || t[0].textContent : "" }, append: function () { return l(this, arguments, function (e) { 1 === this.nodeType && this.appendChild(e) }) }, prepend: function () { return l(this, arguments, function (e) { 1 === this.nodeType && this.insertBefore(e, this.firstChild) }, !0) }, before: function () { var e = this; return e[0] && e[0].parentNode ? l(e, arguments, function (e) { this.parentNode.insertBefore(e, this) }) : e }, after: function () { var e = this; return e[0] && e[0].parentNode ? l(e, arguments, function (e) { this.parentNode.insertBefore(e, this.nextSibling) }, !0) : e }, appendTo: function (e) { return d(e).append(this), this }, prependTo: function (e) { return d(e).prepend(this), this }, replaceWith: function (e) { return this.before(e).remove() }, wrap: function (e) { return u(this, e) }, wrapAll: function (e) { return u(this, e, !0) }, wrapInner: function (e) { return this.each(function () { d(this).contents().wrapAll(e) }), this }, unwrap: function () { return this.parent().each(function () { d(this).replaceWith(this.childNodes) }) }, clone: function () { var e = []; return this.each(function () { e.push(this.cloneNode(!0)) }), d(e) }, addClass: function (e) { return this.toggleClass(e, !0) }, removeClass: function (e) { return this.toggleClass(e, !1) }, toggleClass: function (e, t) { var n = this; return "string" != typeof e ? n : (-1 !== e.indexOf(" ") ? h(e.split(" "), function () { n.toggleClass(this, t) }) : n.each(function (n, r) { var i, o; o = c(r, e), o !== t && (i = r.className, o ? r.className = p((" " + i + " ").replace(" " + e + " ", " ")) : r.className += i ? " " + e : e) }), n) }, hasClass: function (e) { return c(this[0], e) }, each: function (e) { return h(this, e) }, on: function (e, t) { return this.each(function () { N.bind(this, e, t) }) }, off: function (e, t) { return this.each(function () { N.unbind(this, e, t) }) }, trigger: function (e) { return this.each(function () { "object" == typeof e ? N.fire(this, e.type, e) : N.fire(this, e) }) }, show: function () { return this.css("display", "") }, hide: function () { return this.css("display", "none") }, slice: function () { return new d(_.apply(this, arguments)) }, eq: function (e) { return -1 === e ? this.slice(e) : this.slice(e, +e + 1) }, first: function () { return this.eq(0) }, last: function () { return this.eq(-1) }, find: function (e) { var t, n, r = []; for (t = 0, n = this.length; n > t; t++) d.find(e, this[t], r); return d(r) }, filter: function (e) { return d("function" == typeof e ? m(this.toArray(), function (t, n) { return e(n, t) }) : d.filter(e, this.toArray())) }, closest: function (e) { var t = []; return e instanceof d && (e = e[0]), this.each(function (n, r) { for (; r; ) { if ("string" == typeof e && d(r).is(e)) { t.push(r); break } if (r == e) { t.push(r); break } r = r.parentNode } }), d(t) }, offset: function (e) { var t, n, r, i = 0, o = 0, a; return e ? this.css(e) : (t = this[0], t && (n = t.ownerDocument, r = n.documentElement, t.getBoundingClientRect && (a = t.getBoundingClientRect(), i = a.left + (r.scrollLeft || n.body.scrollLeft) - r.clientLeft, o = a.top + (r.scrollTop || n.body.scrollTop) - r.clientTop)), { left: i, top: o }) }, push: w, sort: [].sort, splice: [].splice }, r.extend(d, { extend: r.extend, makeArray: r.toArray, inArray: f, isArray: r.isArray, each: h, trim: p, grep: m, find: n, expr: n.selectors, unique: n.uniqueSort, text: n.getText, contains: n.contains, filter: function (e, t, n) { var r = t.length; for (n && (e = ":not(" + e + ")"); r--; ) 1 != t[r].nodeType && t.splice(r, 1); return t = 1 === t.length ? d.find.matchesSelector(t[0], e) ? [t[0]] : [] : d.find.matches(e, t) } }), h({ parent: function (e) { var t = e.parentNode; return t && 11 !== t.nodeType ? t : null }, parents: function (e) { return v(e, "parentNode") }, next: function (e) { return b(e, "nextSibling", 1) }, prev: function (e) { return b(e, "previousSibling", 1) }, children: function (e) { return y(e.firstChild, "nextSibling", 1) }, contents: function (e) { return r.toArray(("iframe" === e.nodeName ? e.contentDocument || e.contentWindow.document : e).childNodes) } }, function (e, t) { d.fn[e] = function (n) { var r = this, i = []; return r.each(function () { var e = t.call(i, this, n, i); e && (d.isArray(e) ? i.push.apply(i, e) : i.push(e)) }), this.length > 1 && (i = d.unique(i), 0 === e.indexOf("parents") && (i = i.reverse())), i = d(i), n ? i.filter(n) : i } }), h({ parentsUntil: function (e, t) { return v(e, "parentNode", t) }, nextUntil: function (e, t) { return y(e, "nextSibling", 1, t).slice(1) }, prevUntil: function (e, t) { return y(e, "previousSibling", 1, t).slice(1) } }, function (e, t) { d.fn[e] = function (n, r) { var i = this, o = []; return i.each(function () { var e = t.call(o, this, n, o); e && (d.isArray(e) ? o.push.apply(o, e) : o.push(e)) }), this.length > 1 && (o = d.unique(o), (0 === e.indexOf("parents") || "prevUntil" === e) && (o = o.reverse())), o = d(o), r ? o.filter(r) : o } }), d.fn.is = function (e) { return !!e && this.filter(e).length > 0 }, d.fn.init.prototype = d.fn, d.overrideDefaults = function (e) { function t(r, i) { return n = n || e(), 0 === arguments.length && (r = n.element), i || (i = n.context), new t.fn.init(r, i) } var n; return d.extend(t, this), t }, i.ie && i.ie < 8 && (C(B, "get", { maxlength: function (e) { var t = e.maxLength; return 2147483647 === t ? k : t }, size: function (e) { var t = e.size; return 20 === t ? k : t }, "class": function (e) { return e.className }, style: function (e) { var t = e.style.cssText; return 0 === t.length ? k : t } }), C(B, "set", { "class": function (e, t) { e.className = t }, style: function (e, t) { e.style.cssText = t } })), i.ie && i.ie < 9 && (A["float"] = "styleFloat", C(D, "set", { opacity: function (e, t) { var n = e.style; null === t || "" === t ? n.removeAttribute("filter") : (n.zoom = 1, n.filter = "alpha(opacity=" + 100 * t + ")") } })), d.attrHooks = B, d.cssHooks = D, d }), r(p, [], function () { return function (e, t) { function n(e, t, n, r) { function i(e) { return e = parseInt(e, 10).toString(16), e.length > 1 ? e : "0" + e } return "#" + i(t) + i(n) + i(r) } var r = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi, i = /(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi, o = /\s*([^:]+):\s*([^;]+);?/g, a = /\s+$/, s, l, c = {}, u, d, f, p = "\ufeff"; for (e = e || {}, t && (d = t.getValidStyles(), f = t.getInvalidStyles()), u = ("\\\" \\' \\; \\: ; : " + p).split(" "), l = 0; l < u.length; l++) c[u[l]] = p + l, c[p + l] = u[l]; return { toHex: function (e) { return e.replace(r, n) }, parse: function (t) { function s(e, t, n) { var r, i, o, a; if (r = m[e + "-top" + t], r && (i = m[e + "-right" + t], i && (o = m[e + "-bottom" + t], o && (a = m[e + "-left" + t])))) { var s = [r, i, o, a]; for (l = s.length - 1; l-- && s[l] === s[l + 1]; ); l > -1 && n || (m[e + t] = -1 == l ? s[0] : s.join(" "), delete m[e + "-top" + t], delete m[e + "-right" + t], delete m[e + "-bottom" + t], delete m[e + "-left" + t]) } } function u(e) { var t = m[e], n; if (t) { for (t = t.split(" "), n = t.length; n--; ) if (t[n] !== t[0]) return !1; return m[e] = t[0], !0 } } function d(e, t, n, r) { u(t) && u(n) && u(r) && (m[e] = m[t] + " " + m[n] + " " + m[r], delete m[t], delete m[n], delete m[r]) } function f(e) { return b = !0, c[e] } function p(e, t) { return b && (e = e.replace(/\uFEFF[0-9]/g, function (e) { return c[e] })), t || (e = e.replace(/\\([\'\";:])/g, "$1")), e } function h(t, n, r, i, o, a) { if (o = o || a) return o = p(o), "'" + o.replace(/\'/g, "\\'") + "'"; if (n = p(n || r || i), !e.allow_script_urls) { var s = n.replace(/[\s\r\n]+/, ""); if (/(java|vb)script:/i.test(s)) return ""; if (!e.allow_svg_data_urls && /^data:image\/svg/i.test(s)) return "" } return C && (n = C.call(x, n, "style")), "url('" + n.replace(/\'/g, "\\'") + "')" } var m = {}, g, v, y, b, C = e.url_converter, x = e.url_converter_scope || this; if (t) { for (t = t.replace(/[\u0000-\u001F]/g, ""), t = t.replace(/\\[\"\';:\uFEFF]/g, f).replace(/\"[^\"]+\"|\'[^\']+\'/g, function (e) { return e.replace(/[;:]/g, f) }); g = o.exec(t); ) { if (v = g[1].replace(a, "").toLowerCase(), y = g[2].replace(a, ""), y = y.replace(/\\[0-9a-f]+/g, function (e) { return String.fromCharCode(parseInt(e.substr(1), 16)) }), v && y.length > 0) { if (!e.allow_script_urls && ("behavior" == v || /expression\s*\(|\/\*|\*\//.test(y))) continue; "font-weight" === v && "700" === y ? y = "bold" : ("color" === v || "background-color" === v) && (y = y.toLowerCase()), y = y.replace(r, n), y = y.replace(i, h), m[v] = b ? p(y, !0) : y } o.lastIndex = g.index + g[0].length } s("border", "", !0), s("border", "-width"), s("border", "-color"), s("border", "-style"), s("padding", ""), s("margin", ""), d("border", "border-width", "border-style", "border-color"), "medium none" === m.border && delete m.border, "none" === m["border-image"] && delete m["border-image"] } return m }, serialize: function (e, t) { function n(t) { var n, r, o, a; if (n = d[t]) for (r = 0, o = n.length; o > r; r++) t = n[r], a = e[t], a !== s && a.length > 0 && (i += (i.length > 0 ? " " : "") + t + ": " + a + ";") } function r(e, t) { var n; return n = f["*"], n && n[e] ? !1 : (n = f[t], n && n[e] ? !1 : !0) } var i = "", o, a; if (t && d) n("*"), n(t); else for (o in e) a = e[o], a !== s && a.length > 0 && (!f || r(o, t)) && (i += (i.length > 0 ? " " : "") + o + ": " + a + ";"); return i } } } }), r(h, [], function () { return function (e, t) { function n(e, n, r, i) { var o, a; if (e) { if (!i && e[n]) return e[n]; if (e != t) { if (o = e[r]) return o; for (a = e.parentNode; a && a != t; a = a.parentNode) if (o = a[r]) return o } } } var r = e; this.current = function () { return r }, this.next = function (e) { return r = n(r, "firstChild", "nextSibling", e) }, this.prev = function (e) { return r = n(r, "lastChild", "previousSibling", e) } } }), r(m, [u], function (e) { function t(n) { function r() { return M.createDocumentFragment() } function i(e, t) { _(F, e, t) } function o(e, t) { _(z, e, t) } function a(e) { i(e.parentNode, j(e)) } function s(e) { i(e.parentNode, j(e) + 1) } function l(e) { o(e.parentNode, j(e)) } function c(e) { o(e.parentNode, j(e) + 1) } function u(e) { e ? (H[U] = H[V], H[$] = H[W]) : (H[V] = H[U], H[W] = H[$]), H.collapsed = F } function d(e) { a(e), c(e) } function f(e) { i(e, 0), o(e, 1 === e.nodeType ? e.childNodes.length : e.nodeValue.length) } function p(e, t) { var n = H[V], r = H[W], i = H[U], o = H[$], a = t.startContainer, s = t.startOffset, l = t.endContainer, c = t.endOffset; return 0 === e ? w(n, r, a, s) : 1 === e ? w(i, o, a, s) : 2 === e ? w(i, o, l, c) : 3 === e ? w(n, r, l, c) : void 0 } function h() { E(I) } function m() { return E(P) } function g() { return E(O) } function v(e) { var t = this[V], r = this[W], i, o; 3 !== t.nodeType && 4 !== t.nodeType || !t.nodeValue ? (t.childNodes.length > 0 && (o = t.childNodes[r]), o ? t.insertBefore(e, o) : 3 == t.nodeType ? n.insertAfter(e, t) : t.appendChild(e)) : r ? r >= t.nodeValue.length ? n.insertAfter(e, t) : (i = t.splitText(r), t.parentNode.insertBefore(e, i)) : t.parentNode.insertBefore(e, t) } function y(e) { var t = H.extractContents(); H.insertNode(e), e.appendChild(t), H.selectNode(e) } function b() { return q(new t(n), { startContainer: H[V], startOffset: H[W], endContainer: H[U], endOffset: H[$], collapsed: H.collapsed, commonAncestorContainer: H.commonAncestorContainer }) } function C(e, t) { var n; if (3 == e.nodeType) return e; if (0 > t) return e; for (n = e.firstChild; n && t > 0; ) --t, n = n.nextSibling; return n ? n : e } function x() { return H[V] == H[U] && H[W] == H[$] } function w(e, t, r, i) { var o, a, s, l, c, u; if (e == r) return t == i ? 0 : i > t ? -1 : 1; for (o = r; o && o.parentNode != e; ) o = o.parentNode; if (o) { for (a = 0, s = e.firstChild; s != o && t > a; ) a++, s = s.nextSibling; return a >= t ? -1 : 1 } for (o = e; o && o.parentNode != r; ) o = o.parentNode; if (o) { for (a = 0, s = r.firstChild; s != o && i > a; ) a++, s = s.nextSibling; return i > a ? -1 : 1 } for (l = n.findCommonAncestor(e, r), c = e; c && c.parentNode != l; ) c = c.parentNode; for (c || (c = l), u = r; u && u.parentNode != l; ) u = u.parentNode; if (u || (u = l), c == u) return 0; for (s = l.firstChild; s; ) { if (s == c) return -1; if (s == u) return 1; s = s.nextSibling } } function _(e, t, r) { var i, o; for (e ? (H[V] = t, H[W] = r) : (H[U] = t, H[$] = r), i = H[U]; i.parentNode; ) i = i.parentNode; for (o = H[V]; o.parentNode; ) o = o.parentNode; o == i ? w(H[V], H[W], H[U], H[$]) > 0 && H.collapse(e) : H.collapse(e), H.collapsed = x(), H.commonAncestorContainer = n.findCommonAncestor(H[V], H[U]) } function E(e) { var t, n = 0, r = 0, i, o, a, s, l, c; if (H[V] == H[U]) return N(e); for (t = H[U], i = t.parentNode; i; t = i, i = i.parentNode) { if (i == H[V]) return k(t, e); ++n } for (t = H[V], i = t.parentNode; i; t = i, i = i.parentNode) { if (i == H[U]) return S(t, e); ++r } for (o = r - n, a = H[V]; o > 0; ) a = a.parentNode, o--; for (s = H[U]; 0 > o; ) s = s.parentNode, o++; for (l = a.parentNode, c = s.parentNode; l != c; l = l.parentNode, c = c.parentNode) a = l, s = c; return T(a, s, e) } function N(e) { var t, n, i, o, a, s, l, c, u; if (e != I && (t = r()), H[W] == H[$]) return t; if (3 == H[V].nodeType) { if (n = H[V].nodeValue, i = n.substring(H[W], H[$]), e != O && (o = H[V], c = H[W], u = H[$] - H[W], 0 === c && u >= o.nodeValue.length - 1 ? o.parentNode.removeChild(o) : o.deleteData(c, u), H.collapse(F)), e == I) return; return i.length > 0 && t.appendChild(M.createTextNode(i)), t } for (o = C(H[V], H[W]), a = H[$] - H[W]; o && a > 0; ) s = o.nextSibling, l = D(o, e), t && t.appendChild(l), --a, o = s; return e != O && H.collapse(F), t } function k(e, t) { var n, i, o, a, s, l; if (t != I && (n = r()), i = R(e, t), n && n.appendChild(i), o = j(e), a = o - H[W], 0 >= a) return t != O && (H.setEndBefore(e), H.collapse(z)), n; for (i = e.previousSibling; a > 0; ) s = i.previousSibling, l = D(i, t), n && n.insertBefore(l, n.firstChild), --a, i = s; return t != O && (H.setEndBefore(e), H.collapse(z)), n } function S(e, t) { var n, i, o, a, s, l; for (t != I && (n = r()), o = A(e, t), n && n.appendChild(o), i = j(e), ++i, a = H[$] - i, o = e.nextSibling; o && a > 0; ) s = o.nextSibling, l = D(o, t), n && n.appendChild(l), --a, o = s; return t != O && (H.setStartAfter(e), H.collapse(F)), n } function T(e, t, n) { var i, o, a, s, l, c, u; for (n != I && (o = r()), i = A(e, n), o && o.appendChild(i), a = j(e), s = j(t), ++a, l = s - a, c = e.nextSibling; l > 0; ) u = c.nextSibling, i = D(c, n), o && o.appendChild(i), c = u, --l; return i = R(t, n), o && o.appendChild(i), n != O && (H.setStartAfter(e), H.collapse(F)), o } function R(e, t) { var n = C(H[U], H[$] - 1), r, i, o, a, s, l = n != H[U]; if (n == e) return B(n, l, z, t); for (r = n.parentNode, i = B(r, z, z, t); r; ) { for (; n; ) o = n.previousSibling, a = B(n, l, z, t), t != I && i.insertBefore(a, i.firstChild), l = F, n = o; if (r == e) return i; n = r.previousSibling, r = r.parentNode, s = B(r, z, z, t), t != I && s.appendChild(i), i = s } } function A(e, t) { var n = C(H[V], H[W]), r = n != H[V], i, o, a, s, l; if (n == e) return B(n, r, F, t); for (i = n.parentNode, o = B(i, z, F, t); i; ) { for (; n; ) a = n.nextSibling, s = B(n, r, F, t), t != I && o.appendChild(s), r = F, n = a; if (i == e) return o; n = i.nextSibling, i = i.parentNode, l = B(i, z, F, t), t != I && l.appendChild(o), o = l } } function B(e, t, r, i) { var o, a, s, l, c; if (t) return D(e, i); if (3 == e.nodeType) { if (o = e.nodeValue, r ? (l = H[W], a = o.substring(l), s = o.substring(0, l)) : (l = H[$], a = o.substring(0, l), s = o.substring(l)), i != O && (e.nodeValue = s), i == I) return; return c = n.clone(e, z), c.nodeValue = a, c } if (i != I) return n.clone(e, z) } function D(e, t) { return t != I ? t == O ? n.clone(e, F) : e : void e.parentNode.removeChild(e) } function L() { return n.create("body", null, g()).outerText } var H = this, M = n.doc, P = 0, O = 1, I = 2, F = !0, z = !1, W = "startOffset", V = "startContainer", U = "endContainer", $ = "endOffset", q = e.extend, j = n.nodeIndex; return q(H, { startContainer: M, startOffset: 0, endContainer: M, endOffset: 0, collapsed: F, commonAncestorContainer: M, START_TO_START: 0, START_TO_END: 1, END_TO_END: 2, END_TO_START: 3, setStart: i, setEnd: o, setStartBefore: a, setStartAfter: s, setEndBefore: l, setEndAfter: c, collapse: u, selectNode: d, selectNodeContents: f, compareBoundaryPoints: p, deleteContents: h, extractContents: m, cloneContents: g, insertNode: v, surroundContents: y, cloneRange: b, toStringIE: L }), H } return t.prototype.toString = function () { return this.toStringIE() }, t }), r(g, [u], function (e) { function t(e) { var t; return t = document.createElement("div"), t.innerHTML = e, t.textContent || t.innerText || e } function n(e, t) { var n, r, i, a = {}; if (e) { for (e = e.split(","), t = t || 10, n = 0; n < e.length; n += 2) r = String.fromCharCode(parseInt(e[n], t)), o[r] || (i = "&" + e[n + 1] + ";", a[r] = i, a[i] = r); return a } } var r = e.makeMap, i, o, a, s = /[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g, l = /[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g, c = /[<>&\"\']/g, u = /&(#x|#)?([\w]+);/g, d = { 128: "\u20ac", 130: "\u201a", 131: "\u0192", 132: "\u201e", 133: "\u2026", 134: "\u2020", 135: "\u2021", 136: "\u02c6", 137: "\u2030", 138: "\u0160", 139: "\u2039", 140: "\u0152", 142: "\u017d", 145: "\u2018", 146: "\u2019", 147: "\u201c", 148: "\u201d", 149: "\u2022", 150: "\u2013", 151: "\u2014", 152: "\u02dc", 153: "\u2122", 154: "\u0161", 155: "\u203a", 156: "\u0153", 158: "\u017e", 159: "\u0178" }; o = { '"': "&quot;", "'": "&#39;", "<": "&lt;", ">": "&gt;", "&": "&amp;", "`": "&#96;" }, a = { "&lt;": "<", "&gt;": ">", "&amp;": "&", "&quot;": '"', "&apos;": "'" }, i = n("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro", 32); var f = { encodeRaw: function (e, t) { return e.replace(t ? s : l, function (e) { return o[e] || e }) }, encodeAllRaw: function (e) { return ("" + e).replace(c, function (e) { return o[e] || e }) }, encodeNumeric: function (e, t) { return e.replace(t ? s : l, function (e) { return e.length > 1 ? "&#" + (1024 * (e.charCodeAt(0) - 55296) + (e.charCodeAt(1) - 56320) + 65536) + ";" : o[e] || "&#" + e.charCodeAt(0) + ";" }) }, encodeNamed: function (e, t, n) { return n = n || i, e.replace(t ? s : l, function (e) { return o[e] || n[e] || e }) }, getEncodeFunc: function (e, t) { function a(e, n) { return e.replace(n ? s : l, function (e) { return o[e] || t[e] || "&#" + e.charCodeAt(0) + ";" || e }) } function c(e, n) { return f.encodeNamed(e, n, t) } return t = n(t) || i, e = r(e.replace(/\+/g, ",")), e.named && e.numeric ? a : e.named ? t ? c : f.encodeNamed : e.numeric ? f.encodeNumeric : f.encodeRaw }, decode: function (e) { return e.replace(u, function (e, n, r) { return n ? (r = parseInt(r, 2 === n.length ? 16 : 10), r > 65535 ? (r -= 65536, String.fromCharCode(55296 + (r >> 10), 56320 + (1023 & r))) : d[r] || String.fromCharCode(r)) : a[e] || i[e] || t(e) }) } }; return f }), r(v, [], function () { return function (e, t) { function n(t) { e.getElementsByTagName("head")[0].appendChild(t) } function r(t, r, s) { function l() { for (var e = v.passed, t = e.length; t--; ) e[t](); v.status = 2, v.passed = [], v.failed = [] } function c() { for (var e = v.failed, t = e.length; t--; ) e[t](); v.status = 3, v.passed = [], v.failed = [] } function u() { var e = navigator.userAgent.match(/WebKit\/(\d*)/); return !!(e && e[1] < 536) } function d(e, t) { e() || ((new Date).getTime() - g < a ? window.setTimeout(t, 0) : c()) } function f() { d(function () { for (var t = e.styleSheets, n, r = t.length, i; r--; ) if (n = t[r], i = n.ownerNode ? n.ownerNode : n.owningElement, i && i.id === h.id) return l(), !0 }, f) } function p() { d(function () { try { var e = m.sheet.cssRules; return l(), !!e } catch (t) { } }, p) } var h, m, g, v; if (o[t] ? v = o[t] : (v = { passed: [], failed: [] }, o[t] = v), r && v.passed.push(r), s && v.failed.push(s), 1 != v.status) { if (2 == v.status) return void l(); if (3 == v.status) return void c(); if (v.status = 1, h = e.createElement("link"), h.rel = "stylesheet", h.type = "text/css", h.id = "u" + i++, h.async = !1, h.defer = !1, g = (new Date).getTime(), "onload" in h && !u()) h.onload = f, h.onerror = c; else { if (navigator.userAgent.indexOf("Firefox") > 0) return m = e.createElement("style"), m.textContent = '@import "' + t + '"', p(), void n(m); f() } n(h), h.href = t } } var i = 0, o = {}, a; t = t || {}, a = t.maxLoadTime || 5e3, this.load = r } }), r(y, [c, f, p, l, h, m, g, d, u, v], function (e, n, r, i, o, a, s, l, c, u) { function d(e, t) { var n = {}, r = t.keep_values, i; return i = { set: function (n, r, i) { t.url_converter && (r = t.url_converter.call(t.url_converter_scope || e, r, i, n[0])), n.attr("data-mce-" + i, r).attr(i, r) }, get: function (e, t) { return e.attr("data-mce-" + t) || e.attr(t) } }, n = { style: { set: function (e, t) { return null !== t && "object" == typeof t ? void e.css(t) : (r && e.attr("data-mce-style", t), void e.attr("style", t)) }, get: function (t) { var n = t.attr("data-mce-style") || t.attr("style"); return n = e.serializeStyle(e.parseStyle(n), t[0].nodeName) } } }, r && (n.href = n.src = i), n } function f(e, t) { var o = this, a; o.doc = e, o.win = window, o.files = {}, o.counter = 0, o.stdMode = !v || e.documentMode >= 8, o.boxModel = !v || "CSS1Compat" == e.compatMode || o.stdMode, o.styleSheetLoader = new u(e), o.boundEvents = [], o.settings = t = t || {}, o.schema = t.schema, o.styles = new r({ url_converter: t.url_converter, url_converter_scope: t.url_converter_scope }, t.schema), o.fixDoc(e), o.events = t.ownEvents ? new i(t.proxy) : i.Event, o.attrHooks = d(o, t), a = t.schema ? t.schema.getBlockElements() : {}, o.$ = n.overrideDefaults(function () { return { context: e, element: o.getRoot()} }), o.isBlock = function (e) { if (!e) return !1; var t = e.nodeType; return t ? !(1 !== t || !a[e.nodeName]) : !!a[e] } } var p = c.each, h = c.is, m = c.grep, g = c.trim, v = l.ie, y = /^([a-z0-9],?)+$/i, b = /^[ \t\r\n]*$/; return f.prototype = { $$: function (e) { return "string" == typeof e && (e = this.get(e)), this.$(e) }, root: null, fixDoc: function (e) { var t = this.settings, n; if (v && t.schema) { "abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g, function (t) { e.createElement(t) }); for (n in t.schema.getCustomElements()) e.createElement(n) } }, clone: function (e, t) { var n = this, r, i; return !v || 1 !== e.nodeType || t ? e.cloneNode(t) : (i = n.doc, t ? r.firstChild : (r = i.createElement(e.nodeName), p(n.getAttribs(e), function (t) { n.setAttrib(r, t.nodeName, n.getAttrib(e, t.nodeName)) }), r)) }, getRoot: function () { var e = this; return e.settings.root_element || e.doc.body }, getViewPort: function (e) { var t, n; return e = e ? e : this.win, t = e.document, n = this.boxModel ? t.documentElement : t.body, { x: e.pageXOffset || n.scrollLeft, y: e.pageYOffset || n.scrollTop, w: e.innerWidth || n.clientWidth, h: e.innerHeight || n.clientHeight} }, getRect: function (e) { var t = this, n, r; return e = t.get(e), n = t.getPos(e), r = t.getSize(e), { x: n.x, y: n.y, w: r.w, h: r.h} }, getSize: function (e) { var t = this, n, r; return e = t.get(e), n = t.getStyle(e, "width"), r = t.getStyle(e, "height"), -1 === n.indexOf("px") && (n = 0), -1 === r.indexOf("px") && (r = 0), { w: parseInt(n, 10) || e.offsetWidth || e.clientWidth, h: parseInt(r, 10) || e.offsetHeight || e.clientHeight} }, getParent: function (e, t, n) { return this.getParents(e, t, n, !1) }, getParents: function (e, n, r, i) { var o = this, a, s = []; for (e = o.get(e), i = i === t, r = r || ("BODY" != o.getRoot().nodeName ? o.getRoot().parentNode : null), h(n, "string") && (a = n, n = "*" === n ? function (e) { return 1 == e.nodeType } : function (e) { return o.is(e, a) }); e && e != r && e.nodeType && 9 !== e.nodeType; ) { if (!n || n(e)) { if (!i) return e; s.push(e) } e = e.parentNode } return i ? s : null }, get: function (e) { var t; return e && this.doc && "string" == typeof e && (t = e, e = this.doc.getElementById(e), e && e.id !== t) ? this.doc.getElementsByName(t)[1] : e }, getNext: function (e, t) { return this._findSib(e, t, "nextSibling") }, getPrev: function (e, t) { return this._findSib(e, t, "previousSibling") }, select: function (t, n) { var r = this; return e(t, r.get(n) || r.settings.root_element || r.doc, []) }, is: function (n, r) { var i; if (n.length === t) { if ("*" === r) return 1 == n.nodeType; if (y.test(r)) { for (r = r.toLowerCase().split(/,/), n = n.nodeName.toLowerCase(), i = r.length - 1; i >= 0; i--) if (r[i] == n) return !0; return !1 } } if (n.nodeType && 1 != n.nodeType) return !1; var o = n.nodeType ? [n] : n; return e(r, o[0].ownerDocument || o[0], null, o).length > 0 }, add: function (e, t, n, r, i) { var o = this; return this.run(e, function (e) { var a; return a = h(t, "string") ? o.doc.createElement(t) : t, o.setAttribs(a, n), r && (r.nodeType ? a.appendChild(r) : o.setHTML(a, r)), i ? a : e.appendChild(a) }) }, create: function (e, t, n) { return this.add(this.doc.createElement(e), e, t, n, 1) }, createHTML: function (e, t, n) { var r = "", i; r += "<" + e; for (i in t) t.hasOwnProperty(i) && null !== t[i] && "undefined" != typeof t[i] && (r += " " + i + '="' + this.encode(t[i]) + '"'); return "undefined" != typeof n ? r + ">" + n + "</" + e + ">" : r + " />" }, createFragment: function (e) { var t, n, r = this.doc, i; for (i = r.createElement("div"), t = r.createDocumentFragment(), e && (i.innerHTML = e); n = i.firstChild; ) t.appendChild(n); return t }, remove: function (e, t) { return e = this.$$(e), t ? e.each(function () { for (var e; e = this.firstChild; ) 3 == e.nodeType && 0 === e.data.length ? this.removeChild(e) : this.parentNode.insertBefore(e, this) }).remove() : e.remove(), e.length > 1 ? e.toArray() : e[0] }, setStyle: function (e, t, n) { e = this.$$(e).css(t, n), this.settings.update_styles && e.attr("data-mce-style", null) }, getStyle: function (e, n, r) { return e = this.$$(e), r ? e.css(n) : (n = n.replace(/-(\D)/g, function (e, t) { return t.toUpperCase() }), "float" == n && (n = v ? "styleFloat" : "cssFloat"), e[0] && e[0].style ? e[0].style[n] : t) }, setStyles: function (e, t) { e = this.$$(e).css(t), this.settings.update_styles && e.attr("data-mce-style", null) }, removeAllAttribs: function (e) { return this.run(e, function (e) { var t, n = e.attributes; for (t = n.length - 1; t >= 0; t--) e.removeAttributeNode(n.item(t)) }) }, setAttrib: function (e, t, n) { var r = this, i, o, a = r.settings; "" === n && (n = null), e = r.$$(e), i = e.attr(t), e.length && (o = r.attrHooks[t], o && o.set ? o.set(e, n, t) : e.attr(t, n), i != n && a.onSetAttrib && a.onSetAttrib({ attrElm: e, attrName: t, attrValue: n })) }, setAttribs: function (e, t) { var n = this; n.$$(e).each(function (e, r) { p(t, function (e, t) { n.setAttrib(r, t, e) }) }) }, getAttrib: function (e, t, n) { var r = this, i, o; return e = r.$$(e), e.length && (i = r.attrHooks[t], o = i && i.get ? i.get(e, t) : e.attr(t)), "undefined" == typeof o && (o = n || ""), o }, getPos: function (e, t) { var r = this, i = 0, o = 0, a, s = r.doc, l = s.body, c; if (e = r.get(e), t = t || l, e) { if (t === l && e.getBoundingClientRect && "static" === n(l).css("position")) return c = e.getBoundingClientRect(), t = r.boxModel ? s.documentElement : l, i = c.left + (s.documentElement.scrollLeft || l.scrollLeft) - t.clientLeft, o = c.top + (s.documentElement.scrollTop || l.scrollTop) - t.clientTop, { x: i, y: o }; for (a = e; a && a != t && a.nodeType; ) i += a.offsetLeft || 0, o += a.offsetTop || 0, a = a.offsetParent; for (a = e.parentNode; a && a != t && a.nodeType; ) i -= a.scrollLeft || 0, o -= a.scrollTop || 0, a = a.parentNode } return { x: i, y: o} }, parseStyle: function (e) { return this.styles.parse(e) }, serializeStyle: function (e, t) { return this.styles.serialize(e, t) }, addStyle: function (e) { var t = this, n = t.doc, r, i; if (t !== f.DOM && n === document) { var o = f.DOM.addedStyles; if (o = o || [], o[e]) return; o[e] = !0, f.DOM.addedStyles = o } i = n.getElementById("mceDefaultStyles"), i || (i = n.createElement("style"), i.id = "mceDefaultStyles", i.type = "text/css", r = n.getElementsByTagName("head")[0], r.firstChild ? r.insertBefore(i, r.firstChild) : r.appendChild(i)), i.styleSheet ? i.styleSheet.cssText += e : i.appendChild(n.createTextNode(e)) }, loadCSS: function (e) { var t = this, n = t.doc, r; return t !== f.DOM && n === document ? void f.DOM.loadCSS(e) : (e || (e = ""), r = n.getElementsByTagName("head")[0], void p(e.split(","), function (e) { var i; t.files[e] || (t.files[e] = !0, i = t.create("link", { rel: "stylesheet", href: e }), v && n.documentMode && n.recalc && (i.onload = function () { n.recalc && n.recalc(), i.onload = null }), r.appendChild(i)) })) }, addClass: function (e, t) { this.$$(e).addClass(t) }, removeClass: function (e, t) { this.toggleClass(e, t, !1) }, hasClass: function (e, t) { return this.$$(e).hasClass(t) }, toggleClass: function (e, t, r) { this.$$(e).toggleClass(t, r).each(function () { "" === this.className && n(this).attr("class", null) }) }, show: function (e) { this.$$(e).show() }, hide: function (e) { this.$$(e).hide() }, isHidden: function (e) { return "none" == this.$$(e).css("display") }, uniqueId: function (e) { return (e ? e : "mce_") + this.counter++ }, setHTML: function (e, t) { e = this.$$(e), v ? e.each(function (e, r) { if (r.canHaveHTML !== !1) { for (; r.firstChild; ) r.removeChild(r.firstChild); try { r.innerHTML = "<br>" + t, r.removeChild(r.firstChild) } catch (i) { n("<div>").html("<br>" + t).contents().slice(1).appendTo(r) } return t } }) : e.html(t) }, getOuterHTML: function (e) { return e = this.get(e), 1 == e.nodeType ? e.outerHTML : n("<div>").append(n(e).clone()).html() }, setOuterHTML: function (e, t) { var r = this; r.$$(e).each(function () { try { this.outerHTML = t } catch (e) { r.remove(n(this).html(t), !0) } }) }, decode: s.decode, encode: s.encodeAllRaw, insertAfter: function (e, t) { return t = this.get(t), this.run(e, function (e) { var n, r; return n = t.parentNode, r = t.nextSibling, r ? n.insertBefore(e, r) : n.appendChild(e), e }) }, replace: function (e, t, n) { var r = this; return r.run(t, function (t) { return h(t, "array") && (e = e.cloneNode(!0)), n && p(m(t.childNodes), function (t) { e.appendChild(t) }), t.parentNode.replaceChild(e, t) }) }, rename: function (e, t) { var n = this, r; return e.nodeName != t.toUpperCase() && (r = n.create(t), p(n.getAttribs(e), function (t) { n.setAttrib(r, t.nodeName, n.getAttrib(e, t.nodeName)) }), n.replace(r, e, 1)), r || e }, findCommonAncestor: function (e, t) { for (var n = e, r; n; ) { for (r = t; r && n != r; ) r = r.parentNode; if (n == r) break; n = n.parentNode } return !n && e.ownerDocument ? e.ownerDocument.documentElement : n }, toHex: function (e) { return this.styles.toHex(c.trim(e)) }, run: function (e, t, n) { var r = this, i; return "string" == typeof e && (e = r.get(e)), e ? (n = n || this, e.nodeType || !e.length && 0 !== e.length ? t.call(n, e) : (i = [], p(e, function (e, o) { e && ("string" == typeof e && (e = r.get(e)), i.push(t.call(n, e, o))) }), i)) : !1 }, getAttribs: function (e) { var t; if (e = this.get(e), !e) return []; if (v) { if (t = [], "OBJECT" == e.nodeName) return e.attributes; "OPTION" === e.nodeName && this.getAttrib(e, "selected") && t.push({ specified: 1, nodeName: "selected" }); var n = /<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi; return e.cloneNode(!1).outerHTML.replace(n, "").replace(/[\w:\-]+/gi, function (e) { t.push({ specified: 1, nodeName: e }) }), t } return e.attributes }, isEmpty: function (e, t) { var n = this, r, i, a, s, l, c = 0; if (e = e.firstChild) { s = new o(e, e.parentNode), t = t || (n.schema ? n.schema.getNonEmptyElements() : null); do { if (a = e.nodeType, 1 === a) { if (e.getAttribute("data-mce-bogus")) continue; if (l = e.nodeName.toLowerCase(), t && t[l]) { if ("br" === l) { c++; continue } return !1 } for (i = n.getAttribs(e), r = i.length; r--; ) if (l = i[r].nodeName, "name" === l || "data-mce-bookmark" === l) return !1 } if (8 == a) return !1; if (3 === a && !b.test(e.nodeValue)) return !1 } while (e = s.next()) } return 1 >= c }, createRng: function () { var e = this.doc; return e.createRange ? e.createRange() : new a(this) }, nodeIndex: function (e, t) { var n = 0, r, i; if (e) for (r = e.nodeType, e = e.previousSibling; e; e = e.previousSibling) i = e.nodeType, (!t || 3 != i || i != r && e.nodeValue.length) && (n++, r = i); return n }, split: function (e, t, n) { function r(e) { function t(e) { var t = e.previousSibling && "SPAN" == e.previousSibling.nodeName, n = e.nextSibling && "SPAN" == e.nextSibling.nodeName; return t && n } var n, o = e.childNodes, a = e.nodeType; if (1 != a || "bookmark" != e.getAttribute("data-mce-type")) { for (n = o.length - 1; n >= 0; n--) r(o[n]); if (9 != a) { if (3 == a && e.nodeValue.length > 0) { var s = g(e.nodeValue).length; if (!i.isBlock(e.parentNode) || s > 0 || 0 === s && t(e)) return } else if (1 == a && (o = e.childNodes, 1 == o.length && o[0] && 1 == o[0].nodeType && "bookmark" == o[0].getAttribute("data-mce-type") && e.parentNode.insertBefore(o[0], e), o.length || /^(br|hr|input|img)$/i.test(e.nodeName))) return; i.remove(e) } return e } } var i = this, o = i.createRng(), a, s, l; return e && t ? (o.setStart(e.parentNode, i.nodeIndex(e)), o.setEnd(t.parentNode, i.nodeIndex(t)), a = o.extractContents(), o = i.createRng(), o.setStart(t.parentNode, i.nodeIndex(t) + 1), o.setEnd(e.parentNode, i.nodeIndex(e) + 1), s = o.extractContents(), l = e.parentNode, l.insertBefore(r(a), e), n ? l.replaceChild(n, t) : l.insertBefore(t, e), l.insertBefore(r(s), e), i.remove(e), n || t) : void 0 }, bind: function (e, t, n, r) { var i = this; if (c.isArray(e)) { for (var o = e.length; o--; ) e[o] = i.bind(e[o], t, n, r); return e } return !i.settings.collect || e !== i.doc && e !== i.win || i.boundEvents.push([e, t, n, r]), i.events.bind(e, t, n, r || i) }, unbind: function (e, t, n) { var r = this, i; if (c.isArray(e)) { for (i = e.length; i--; ) e[i] = r.unbind(e[i], t, n); return e } if (r.boundEvents && (e === r.doc || e === r.win)) for (i = r.boundEvents.length; i--; ) { var o = r.boundEvents[i]; e != o[0] || t && t != o[1] || n && n != o[2] || this.events.unbind(o[0], o[1], o[2]) } return this.events.unbind(e, t, n) }, fire: function (e, t, n) { return this.events.fire(e, t, n) }, getContentEditable: function (e) { var t; return e && 1 == e.nodeType ? (t = e.getAttribute("data-mce-contenteditable"), t && "inherit" !== t ? t : "inherit" !== e.contentEditable ? e.contentEditable : null) : null }, getContentEditableParent: function (e) { for (var t = this.getRoot(), n = null; e && e !== t && (n = this.getContentEditable(e), null === n); e = e.parentNode); return n }, destroy: function () { var t = this; if (t.boundEvents) { for (var n = t.boundEvents.length; n--; ) { var r = t.boundEvents[n]; this.events.unbind(r[0], r[1], r[2]) } t.boundEvents = null } e.setDocument && e.setDocument(), t.win = t.doc = t.root = t.events = t.frag = null }, isChildOf: function (e, t) { for (; e; ) { if (t === e) return !0; e = e.parentNode } return !1 }, dumpRng: function (e) { return "startContainer: " + e.startContainer.nodeName + ", startOffset: " + e.startOffset + ", endContainer: " + e.endContainer.nodeName + ", endOffset: " + e.endOffset }, _findSib: function (e, t, n) { var r = this, i = t; if (e) for ("string" == typeof i && (i = function (e) { return r.is(e, t) }), e = e[n]; e; e = e[n]) if (i(e)) return e; return null } }, f.DOM = new f(document), f }), r(b, [y, u], function (e, t) { function n() { function e(e, t) { function n() { o.remove(s), a && (a.onreadystatechange = a.onload = a = null), t() } function i() { "undefined" != typeof console && console.log && console.log("Failed to load: " + e) } var o = r, a, s; s = o.uniqueId(), a = document.createElement("script"), a.id = s, a.type = "text/javascript", a.src = e, "onreadystatechange" in a ? a.onreadystatechange = function () { /loaded|complete/.test(a.readyState) && n() } : a.onload = n, a.onerror = i, (document.getElementsByTagName("head")[0] || document.body).appendChild(a) } var t = 0, n = 1, a = 2, s = {}, l = [], c = {}, u = [], d = 0, f; this.isDone = function (e) { return s[e] == a }, this.markDone = function (e) { s[e] = a }, this.add = this.load = function (e, n, r) { var i = s[e]; i == f && (l.push(e), s[e] = t), n && (c[e] || (c[e] = []), c[e].push({ func: n, scope: r || this })) }, this.loadQueue = function (e, t) { this.loadScripts(l, e, t) }, this.loadScripts = function (t, r, l) { function p(e) { i(c[e], function (e) { e.func.call(e.scope) }), c[e] = f } var h; u.push({ func: r, scope: l || this }), (h = function () { var r = o(t); t.length = 0, i(r, function (t) { return s[t] == a ? void p(t) : void (s[t] != n && (s[t] = n, d++, e(t, function () { s[t] = a, d--, p(t), h() }))) }), d || (i(u, function (e) { e.func.call(e.scope) }), u.length = 0) })() } } var r = e.DOM, i = t.each, o = t.grep; return n.ScriptLoader = new n, n }), r(C, [b, u], function (e, n) { function r() { var e = this; e.items = [], e.urls = {}, e.lookup = {} } var i = n.each; return r.prototype = { get: function (e) { return this.lookup[e] ? this.lookup[e].instance : t }, dependencies: function (e) { var t; return this.lookup[e] && (t = this.lookup[e].dependencies), t || [] }, requireLangPack: function (t, n) { var i = r.language; if (i && r.languageLoad !== !1) { if (n) if (n = "," + n + ",", -1 != n.indexOf("," + i.substr(0, 2) + ",")) i = i.substr(0, 2); else if (-1 == n.indexOf("," + i + ",")) return; e.ScriptLoader.add(this.urls[t] + "/langs/" + i + ".js") } }, add: function (e, t, n) { return this.items.push(t), this.lookup[e] = { instance: t, dependencies: n }, t }, createUrl: function (e, t) { return "object" == typeof t ? t : { prefix: e.prefix, resource: t, suffix: e.suffix} }, addComponents: function (t, n) { var r = this.urls[t]; i(n, function (t) { e.ScriptLoader.add(r + "/" + t) }) }, load: function (n, o, a, s) { function l() { var r = c.dependencies(n); i(r, function (e) { var n = c.createUrl(o, e); c.load(n.resource, n, t, t) }), a && a.call(s ? s : e) } var c = this, u = o; c.urls[n] || ("object" == typeof o && (u = o.prefix + o.resource + o.suffix), 0 !== u.indexOf("/") && -1 == u.indexOf("://") && (u = r.baseURL + "/" + u), c.urls[n] = u.substring(0, u.lastIndexOf("/")), c.lookup[n] ? l() : e.ScriptLoader.add(u, l, s)) } }, r.PluginManager = new r, r.ThemeManager = new r, r }), r(x, [u, h], function (e, t) { function n(e, t) { var n = e.childNodes; return t--, t > n.length - 1 ? t = n.length - 1 : 0 > t && (t = 0), n[t] || e } function r(e) { this.walk = function (t, r) { function o(e) { var t; return t = e[0], 3 === t.nodeType && t === c && u >= t.nodeValue.length && e.splice(0, 1), t = e[e.length - 1], 0 === f && e.length > 0 && t === d && 3 === t.nodeType && e.splice(e.length - 1, 1), e } function a(e, t, n) { for (var r = []; e && e != n; e = e[t]) r.push(e); return r } function s(e, t) { do { if (e.parentNode == t) return e; e = e.parentNode } while (e) } function l(e, t, n) { var i = n ? "nextSibling" : "previousSibling"; for (g = e, v = g.parentNode; g && g != t; g = v) v = g.parentNode, y = a(g == e ? g : g[i], i), y.length && (n || y.reverse(), r(o(y))) } var c = t.startContainer, u = t.startOffset, d = t.endContainer, f = t.endOffset, p, h, m, g, v, y, b; if (b = e.select("td.mce-item-selected,th.mce-item-selected"), b.length > 0) return void i(b, function (e) { r([e]) }); if (1 == c.nodeType && c.hasChildNodes() && (c = c.childNodes[u]), 1 == d.nodeType && d.hasChildNodes() && (d = n(d, f)), c == d) return r(o([c])); for (p = e.findCommonAncestor(c, d), g = c; g; g = g.parentNode) { if (g === d) return l(c, p, !0); if (g === p) break } for (g = d; g; g = g.parentNode) { if (g === c) return l(d, p); if (g === p) break } h = s(c, p) || c, m = s(d, p) || d, l(c, h, !0), y = a(h == c ? h : h.nextSibling, "nextSibling", m == d ? m.nextSibling : m), y.length && r(o(y)), l(d, m) }, this.split = function (e) { function t(e, t) { return e.splitText(t) } var n = e.startContainer, r = e.startOffset, i = e.endContainer, o = e.endOffset; return n == i && 3 == n.nodeType ? r > 0 && r < n.nodeValue.length && (i = t(n, r), n = i.previousSibling, o > r ? (o -= r, n = i = t(i, o).previousSibling, o = i.nodeValue.length, r = 0) : o = 0) : (3 == n.nodeType && r > 0 && r < n.nodeValue.length && (n = t(n, r), r = 0), 3 == i.nodeType && o > 0 && o < i.nodeValue.length && (i = t(i, o).previousSibling, o = i.nodeValue.length)), { startContainer: n, startOffset: r, endContainer: i, endOffset: o} }, this.normalize = function (n) { function r(r) { function a(n, r) { for (var i = new t(n, e.getParent(n.parentNode, e.isBlock) || f); n = i[r ? "prev" : "next"](); ) if ("BR" === n.nodeName) return !0 } function s(e, t) { return e.previousSibling && e.previousSibling.nodeName == t } function l(n, r) { var a, s, l; if (r = r || c, l = e.getParent(r.parentNode, e.isBlock) || f, n && "BR" == r.nodeName && g && e.isEmpty(l)) return c = r.parentNode, u = e.nodeIndex(r), void (i = !0); for (a = new t(r, l); p = a[n ? "prev" : "next"](); ) { if ("false" === e.getContentEditableParent(p)) return; if (3 === p.nodeType && p.nodeValue.length > 0) return c = p, u = n ? p.nodeValue.length : 0, void (i = !0); if (e.isBlock(p) || h[p.nodeName.toLowerCase()]) return; s = p } o && s && (c = s, i = !0, u = 0) } var c, u, d, f = e.getRoot(), p, h, m, g; if (c = n[(r ? "start" : "end") + "Container"], u = n[(r ? "start" : "end") + "Offset"], g = 1 == c.nodeType && u === c.childNodes.length, h = e.schema.getNonEmptyElements(), m = r, 1 == c.nodeType && u > c.childNodes.length - 1 && (m = !1), 9 === c.nodeType && (c = e.getRoot(), u = 0), c === f) { if (m && (p = c.childNodes[u > 0 ? u - 1 : 0], p && (h[p.nodeName] || "TABLE" == p.nodeName))) return; if (c.hasChildNodes() && (u = Math.min(!m && u > 0 ? u - 1 : u, c.childNodes.length - 1), c = c.childNodes[u], u = 0, c.hasChildNodes() && !/TABLE/.test(c.nodeName))) { p = c, d = new t(c, f); do { if (3 === p.nodeType && p.nodeValue.length > 0) { u = m ? 0 : p.nodeValue.length, c = p, i = !0; break } if (h[p.nodeName.toLowerCase()]) { u = e.nodeIndex(p), c = p.parentNode, "IMG" != p.nodeName || m || u++, i = !0; break } } while (p = m ? d.next() : d.prev()) } } o && (3 === c.nodeType && 0 === u && l(!0), 1 === c.nodeType && (p = c.childNodes[u], p || (p = c.childNodes[u - 1]), !p || "BR" !== p.nodeName || s(p, "A") || a(p) || a(p, !0) || l(!0, p))), m && !o && 3 === c.nodeType && u === c.nodeValue.length && l(!1), i && n["set" + (r ? "Start" : "End")](c, u) } var i, o; return o = n.collapsed, r(!0), o || r(), i && o && n.collapse(!0), i } } var i = e.each; return r.compareRanges = function (e, t) { if (e && t) { if (!e.item && !e.duplicate) return e.startContainer == t.startContainer && e.startOffset == t.startOffset; if (e.item && t.item && e.item(0) === t.item(0)) return !0; if (e.isEqual && t.isEqual && t.isEqual(e)) return !0 } return !1 }, r }), r(w, [x], function (e) { return function (t) { function n(e) { var n, r; if (r = t.$(e).parentsUntil(t.getBody()).add(e), r.length === i.length) { for (n = r.length; n >= 0 && r[n] === i[n]; n--); if (-1 === n) return i = r, !0 } return i = r, !1 } var r, i = []; "onselectionchange" in t.getDoc() || t.on("NodeChange Click MouseUp KeyUp Focus", function (n) { var i, o; i = t.selection.getRng(), o = { startContainer: i.startContainer, startOffset: i.startOffset, endContainer: i.endContainer, endOffset: i.endOffset }, "nodechange" != n.type && e.compareRanges(o, r) || t.fire("SelectionChange"), r = o }), t.on("contextmenu", function () { t.fire("SelectionChange") }), t.on("SelectionChange", function () { var e = t.selection.getStart(!0); t.selection.isCollapsed() || n(e) || !t.dom.isChildOf(e, t.getBody()) || t.nodeChanged({ selectionChange: !0 }) }), t.on("MouseUp", function (e) { e.isDefaultPrevented() || setTimeout(function () { t.nodeChanged() }, 0) }), this.nodeChanged = function (e) { var n = t.selection, r, i, o; t.initialized && n && !t.settings.disable_nodechange && !t.settings.readonly && (o = t.getBody(), r = n.getStart() || o, r = r.ownerDocument != t.getDoc() ? t.getBody() : r, "IMG" == r.nodeName && n.isCollapsed() && (r = r.parentNode), i = [], t.dom.getParent(r, function (e) { return e === o ? !0 : void i.push(e) }), e = e || {}, e.element = r, e.parents = i, t.fire("NodeChange", e)) } } }), r(_, [], function () { function e(e, t, n) { var r, i, o = n ? "lastChild" : "firstChild", a = n ? "prev" : "next"; if (e[o]) return e[o]; if (e !== t) { if (r = e[a]) return r; for (i = e.parent; i && i !== t; i = i.parent) if (r = i[a]) return r } } function t(e, t) { this.name = e, this.type = t, 1 === t && (this.attributes = [], this.attributes.map = {}) } var n = /^[ \t\r\n]*$/, r = { "#text": 3, "#comment": 8, "#cdata": 4, "#pi": 7, "#doctype": 10, "#document-fragment": 11 }; return t.prototype = { replace: function (e) { var t = this; return e.parent && e.remove(), t.insert(e, t), t.remove(), t }, attr: function (e, t) { var n = this, r, i, o; if ("string" != typeof e) { for (i in e) n.attr(i, e[i]); return n } if (r = n.attributes) { if (t !== o) { if (null === t) { if (e in r.map) for (delete r.map[e], i = r.length; i--; ) if (r[i].name === e) return r = r.splice(i, 1), n; return n } if (e in r.map) { for (i = r.length; i--; ) if (r[i].name === e) { r[i].value = t; break } } else r.push({ name: e, value: t }); return r.map[e] = t, n } return r.map[e] } }, clone: function () { var e = this, n = new t(e.name, e.type), r, i, o, a, s; if (o = e.attributes) { for (s = [], s.map = {}, r = 0, i = o.length; i > r; r++) a = o[r], "id" !== a.name && (s[s.length] = { name: a.name, value: a.value }, s.map[a.name] = a.value); n.attributes = s } return n.value = e.value, n.shortEnded = e.shortEnded, n }, wrap: function (e) { var t = this; return t.parent.insert(e, t), e.append(t), t }, unwrap: function () { var e = this, t, n; for (t = e.firstChild; t; ) n = t.next, e.insert(t, e, !0), t = n; e.remove() }, remove: function () { var e = this, t = e.parent, n = e.next, r = e.prev; return t && (t.firstChild === e ? (t.firstChild = n, n && (n.prev = null)) : r.next = n, t.lastChild === e ? (t.lastChild = r, r && (r.next = null)) : n.prev = r, e.parent = e.next = e.prev = null), e }, append: function (e) { var t = this, n; return e.parent && e.remove(), n = t.lastChild, n ? (n.next = e, e.prev = n, t.lastChild = e) : t.lastChild = t.firstChild = e, e.parent = t, e }, insert: function (e, t, n) { var r; return e.parent && e.remove(), r = t.parent || this, n ? (t === r.firstChild ? r.firstChild = e : t.prev.next = e, e.prev = t.prev, e.next = t, t.prev = e) : (t === r.lastChild ? r.lastChild = e : t.next.prev = e, e.next = t.next, e.prev = t, t.next = e), e.parent = r, e }, getAll: function (t) { var n = this, r, i = []; for (r = n.firstChild; r; r = e(r, n)) r.name === t && i.push(r); return i }, empty: function () { var t = this, n, r, i; if (t.firstChild) { for (n = [], i = t.firstChild; i; i = e(i, t)) n.push(i); for (r = n.length; r--; ) i = n[r], i.parent = i.firstChild = i.lastChild = i.next = i.prev = null } return t.firstChild = t.lastChild = null, t }, isEmpty: function (t) { var r = this, i = r.firstChild, o, a; if (i) do { if (1 === i.type) { if (i.attributes.map["data-mce-bogus"]) continue; if (t[i.name]) return !1; for (o = i.attributes.length; o--; ) if (a = i.attributes[o].name, "name" === a || 0 === a.indexOf("data-mce-bookmark")) return !1 } if (8 === i.type) return !1; if (3 === i.type && !n.test(i.value)) return !1 } while (i = e(i, r)); return !0 }, walk: function (t) { return e(this, null, t) } }, t.create = function (e, n) { var i, o; if (i = new t(e, r[e] || 1), n) for (o in n) i.attr(o, n[o]); return i }, t }), r(E, [u], function (e) { function t(e, t) { return e ? e.split(t || " ") : [] } function n(e) { function n(e, n, r) { function i(e, t) { var n = {}, r, i; for (r = 0, i = e.length; i > r; r++) n[e[r]] = t || {}; return n } var s, c, u, d = arguments; for (r = r || [], n = n || "", "string" == typeof r && (r = t(r)), c = 3; c < d.length; c++) "string" == typeof d[c] && (d[c] = t(d[c])), r.push.apply(r, d[c]); for (e = t(e), s = e.length; s--; ) u = [].concat(l, t(n)), a[e[s]] = { attributes: i(u), attributesOrder: u, children: i(r, o)} } function r(e, n) { var r, i, o, s; for (e = t(e), r = e.length, n = t(n); r--; ) for (i = a[e[r]], o = 0, s = n.length; s > o; o++) i.attributes[n[o]] = {}, i.attributesOrder.push(n[o]) } var a = {}, l, c, u, d, f, p; return i[e] ? i[e] : (l = t("id accesskey class dir lang style tabindex title"), c = t("address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul"), u = t("a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment"), "html4" != e && (l.push.apply(l, t("contenteditable contextmenu draggable dropzone hidden spellcheck translate")), c.push.apply(c, t("article aside details dialog figure header footer hgroup section nav")), u.push.apply(u, t("audio canvas command datalist mark meter output progress time wbr video ruby bdi keygen"))), "html5-strict" != e && (l.push("xml:lang"), p = t("acronym applet basefont big font strike tt"), u.push.apply(u, p), s(p, function (e) { n(e, "", u) }), f = t("center dir isindex noframes"), c.push.apply(c, f), d = [].concat(c, u), s(f, function (e) { n(e, "", d) })), d = d || [].concat(c, u), n("html", "manifest", "head body"), n("head", "", "base command link meta noscript script style title"), n("title hr noscript br"), n("base", "href target"), n("link", "href rel media hreflang type sizes hreflang"), n("meta", "name http-equiv content charset"), n("style", "media type scoped"), n("script", "src async defer type charset"), n("body", "onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload", d), n("address dt dd div caption", "", d), n("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn", "", u), n("blockquote", "cite", d), n("ol", "reversed start type", "li"), n("ul", "", "li"), n("li", "value", d), n("dl", "", "dt dd"), n("a", "href target rel media hreflang type", u), n("q", "cite", u), n("ins del", "cite datetime", d), n("img", "src alt usemap ismap width height"), n("iframe", "src name width height", d), n("embed", "src type width height"), n("object", "data type typemustmatch name usemap form width height", d, "param"), n("param", "name value"), n("map", "name", d, "area"), n("area", "alt coords shape href target rel media hreflang type"), n("table", "border", "caption colgroup thead tfoot tbody tr" + ("html4" == e ? " col" : "")), n("colgroup", "span", "col"), n("col", "span"), n("tbody thead tfoot", "", "tr"), n("tr", "", "td th"), n("td", "colspan rowspan headers", d), n("th", "colspan rowspan headers scope abbr", d), n("form", "accept-charset action autocomplete enctype method name novalidate target", d), n("fieldset", "disabled form name", d, "legend"), n("label", "form for", u), n("input", "accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"), n("button", "disabled form formaction formenctype formmethod formnovalidate formtarget name type value", "html4" == e ? d : u), n("select", "disabled form multiple name required size", "option optgroup"), n("optgroup", "disabled label", "option"), n("option", "disabled label selected value"), n("textarea", "cols dirname disabled form maxlength name readonly required rows wrap"), n("menu", "type label", d, "li"), n("noscript", "", d), "html4" != e && (n("wbr"), n("ruby", "", u, "rt rp"), n("figcaption", "", d), n("mark rt rp summary bdi", "", u), n("canvas", "width height", d), n("video", "src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered", d, "track source"), n("audio", "src crossorigin preload autoplay mediagroup loop muted controls buffered volume", d, "track source"), n("source", "src type media"), n("track", "kind src srclang label default"), n("datalist", "", u, "option"), n("article section nav aside header footer", "", d), n("hgroup", "", "h1 h2 h3 h4 h5 h6"), n("figure", "", d, "figcaption"), n("time", "datetime", u), n("dialog", "open", d), n("command", "type label icon disabled checked radiogroup command"), n("output", "for form name", u), n("progress", "value max", u), n("meter", "value min max low high optimum", u), n("details", "open", d, "summary"), n("keygen", "autofocus challenge disabled form keytype name")), "html5-strict" != e && (r("script", "language xml:space"), r("style", "xml:space"), r("object", "declare classid code codebase codetype archive standby align border hspace vspace"), r("embed", "align name hspace vspace"), r("param", "valuetype type"), r("a", "charset name rev shape coords"), r("br", "clear"), r("applet", "codebase archive code object alt name width height align hspace vspace"), r("img", "name longdesc align border hspace vspace"), r("iframe", "longdesc frameborder marginwidth marginheight scrolling align"), r("font basefont", "size color face"), r("input", "usemap align"), r("select", "onchange"), r("textarea"), r("h1 h2 h3 h4 h5 h6 div p legend caption", "align"), r("ul", "type compact"), r("li", "type"), r("ol dl menu dir", "compact"), r("pre", "width xml:space"), r("hr", "align noshade size width"), r("isindex", "prompt"), r("table", "summary width frame rules cellspacing cellpadding align bgcolor"), r("col", "width align char charoff valign"), r("colgroup", "width align char charoff valign"), r("thead", "align char charoff valign"), r("tr", "align char charoff valign bgcolor"), r("th", "axis align char charoff valign nowrap bgcolor width height"), r("form", "accept"), r("td", "abbr axis scope align char charoff valign nowrap bgcolor width height"), r("tfoot", "align char charoff valign"), r("tbody", "align char charoff valign"), r("area", "nohref"), r("body", "background bgcolor text link vlink alink")), "html4" != e && (r("input button select textarea", "autofocus"), r("input textarea", "placeholder"), r("a", "download"), r("link script img", "crossorigin"), r("iframe", "sandbox seamless allowfullscreen")), s(t("a form meter progress dfn"), function (e) { a[e] && delete a[e].children[e] }), delete a.caption.children.table, i[e] = a, a) } function r(e, t) { var n; return e && (n = {}, "string" == typeof e && (e = { "*": e }), s(e, function (e, r) { n[r] = "map" == t ? a(e, /[, ]/) : c(e, /[, ]/) })), n } var i = {}, o = {}, a = e.makeMap, s = e.each, l = e.extend, c = e.explode, u = e.inArray; return function (e) { function o(t, n, r) { var o = e[t]; return o ? o = a(o, /[, ]/, a(o.toUpperCase(), /[, ]/)) : (o = i[t], o || (o = a(n, " ", a(n.toUpperCase(), " ")), o = l(o, r), i[t] = o)), o } function d(e) { return new RegExp("^" + e.replace(/([?+*])/g, ".$1") + "$") } function f(e) { var n, r, i, o, s, l, c, f, p, h, m, g, v, b, x, w, _, E, N, k = /^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/, S = /^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/, T = /[*?+]/; if (e) for (e = t(e, ","), y["@"] && (w = y["@"].attributes, _ = y["@"].attributesOrder), n = 0, r = e.length; r > n; n++) if (s = k.exec(e[n])) { if (b = s[1], p = s[2], x = s[3], f = s[5], g = {}, v = [], l = { attributes: g, attributesOrder: v }, "#" === b && (l.paddEmpty = !0), "-" === b && (l.removeEmpty = !0), "!" === s[4] && (l.removeEmptyAttrs = !0), w) { for (E in w) g[E] = w[E]; v.push.apply(v, _) } if (f) for (f = t(f, "|"), i = 0, o = f.length; o > i; i++) if (s = S.exec(f[i])) { if (c = {}, m = s[1], h = s[2].replace(/::/g, ":"), b = s[3], N = s[4], "!" === m && (l.attributesRequired = l.attributesRequired || [], l.attributesRequired.push(h), c.required = !0), "-" === m) { delete g[h], v.splice(u(v, h), 1); continue } b && ("=" === b && (l.attributesDefault = l.attributesDefault || [], l.attributesDefault.push({ name: h, value: N }), c.defaultValue = N), ":" === b && (l.attributesForced = l.attributesForced || [], l.attributesForced.push({ name: h, value: N }), c.forcedValue = N), "<" === b && (c.validValues = a(N, "?"))), T.test(h) ? (l.attributePatterns = l.attributePatterns || [], c.pattern = d(h), l.attributePatterns.push(c)) : (g[h] || v.push(h), g[h] = c) } w || "@" != p || (w = g, _ = v), x && (l.outputName = p, y[x] = l), T.test(p) ? (l.pattern = d(p), C.push(l)) : y[p] = l } } function p(e) { y = {}, C = [], f(e), s(_, function (e, t) { b[t] = e.children }) } function h(e) { var n = /^(~)?(.+)$/; e && (i.text_block_elements = i.block_elements = null, s(t(e, ","), function (e) { var t = n.exec(e), r = "~" === t[1], i = r ? "span" : "div", o = t[2]; if (b[o] = b[i], L[o] = i, r || (R[o.toUpperCase()] = {}, R[o] = {}), !y[o]) { var a = y[i]; a = l({}, a), delete a.removeEmptyAttrs, delete a.removeEmpty, y[o] = a } s(b, function (e, t) { e[i] && (b[t] = e = l({}, b[t]), e[o] = e[i]) }) })) } function m(e) { var n = /^([+\-]?)(\w+)\[([^\]]+)\]$/; e && s(t(e, ","), function (e) { var r = n.exec(e), i, o; r && (o = r[1], i = o ? b[r[2]] : b[r[2]] = { "#comment": {} }, i = b[r[2]], s(t(r[3], "|"), function (e) { "-" === o ? (b[r[2]] = i = l({}, b[r[2]]), delete i[e]) : i[e] = {} })) }) } function g(e) { var t = y[e], n; if (t) return t; for (n = C.length; n--; ) if (t = C[n], t.pattern.test(e)) return t } var v = this, y = {}, b = {}, C = [], x, w, _, E, N, k, S, T, R, A, B, D, L = {}, H = {}; e = e || {}, _ = n(e.schema), e.verify_html === !1 && (e.valid_elements = "*[*]"), x = r(e.valid_styles), w = r(e.invalid_styles, "map"), T = r(e.valid_classes, "map"), E = o("whitespace_elements", "pre script noscript style textarea video audio iframe object"), N = o("self_closing_elements", "colgroup dd dt li option p td tfoot th thead tr"), k = o("short_ended_elements", "area base basefont br col frame hr img input isindex link meta param embed source wbr track"), S = o("boolean_attributes", "checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"), A = o("non_empty_elements", "td th iframe video audio object script", k), B = o("text_block_elements", "h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"), R = o("block_elements", "hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup", B), D = o("text_inline_elements", "span strong b em i font strike u var cite dfn code mark q sup sub samp"), s((e.special || "script noscript style textarea").split(" "), function (e) { H[e] = new RegExp("</" + e + "[^>]*>", "gi") }), e.valid_elements ? p(e.valid_elements) : (s(_, function (e, t) { y[t] = { attributes: e.attributes, attributesOrder: e.attributesOrder }, b[t] = e.children }), "html5" != e.schema && s(t("strong/b em/i"), function (e) { e = t(e, "/"), y[e[1]].outputName = e[0] }), y.img.attributesDefault = [{ name: "alt", value: ""}], s(t("ol ul sub sup blockquote span font a table tbody tr strong em b i"), function (e) { y[e] && (y[e].removeEmpty = !0) }), s(t("p h1 h2 h3 h4 h5 h6 th td pre div address caption"), function (e) { y[e].paddEmpty = !0 }), s(t("span"), function (e) { y[e].removeEmptyAttrs = !0 })), h(e.custom_elements), m(e.valid_children), f(e.extended_valid_elements), m("+ol[ul|ol],+ul[ul|ol]"), e.invalid_elements && s(c(e.invalid_elements), function (e) { y[e] && delete y[e] }), g("span") || f("span[!data-mce-type|*]"), v.children = b, v.getValidStyles = function () { return x }, v.getInvalidStyles = function () { return w }, v.getValidClasses = function () { return T }, v.getBoolAttrs = function () { return S }, v.getBlockElements = function () { return R }, v.getTextBlockElements = function () { return B }, v.getTextInlineElements = function () { return D }, v.getShortEndedElements = function () { return k }, v.getSelfClosingElements = function () { return N }, v.getNonEmptyElements = function () { return A }, v.getWhiteSpaceElements = function () { return E }, v.getSpecialElements = function () { return H }, v.isValidChild = function (e, t) { var n = b[e]; return !(!n || !n[t]) }, v.isValid = function (e, t) { var n, r, i = g(e); if (i) { if (!t) return !0; if (i.attributes[t]) return !0; if (n = i.attributePatterns) for (r = n.length; r--; ) if (n[r].pattern.test(e)) return !0 } return !1 }, v.getElementRule = g, v.getCustomElements = function () { return L }, v.addValidElements = f, v.setValidElements = p, v.addCustomElements = h, v.addValidChildren = m, v.elements = y } }), r(N, [E, g, u], function (e, t, n) { function r(e, t, n) { var r = 1, i, o, a, s; for (s = e.getShortEndedElements(), a = /<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g, a.lastIndex = i = n; o = a.exec(t); ) { if (i = a.lastIndex, "/" === o[1]) r--; else if (!o[1]) { if (o[2] in s) continue; r++ } if (0 === r) break } return i } function i(i, a) { function s() { } var l = this; i = i || {}, l.schema = a = a || new e, i.fix_self_closing !== !1 && (i.fix_self_closing = !0), o("comment cdata text start end pi doctype".split(" "), function (e) { e && (l[e] = i[e] || s) }), l.parse = function (e) { function o(e) { var t, n; for (t = p.length; t-- && p[t].name !== e; ); if (t >= 0) { for (n = p.length - 1; n >= t; n--) e = p[n], e.valid && l.end(e.name); p.length = t } } function s(e, t, n, r, o) { var a, s, l = /[\s\u0000-\u001F]+/g; if (t = t.toLowerCase(), n = t in x ? t : z(n || r || o || ""), _ && !y && 0 !== t.indexOf("data-")) { if (a = T[t], !a && R) { for (s = R.length; s-- && (a = R[s], !a.pattern.test(t)); ); -1 === s && (a = null) } if (!a) return; if (a.validValues && !(n in a.validValues)) return } if (V[t] && !i.allow_script_urls) { var c = n.replace(l, ""); try { c = decodeURIComponent(c) } catch (u) { c = unescape(c) } if (U.test(c)) return; if (!i.allow_html_data_urls && $.test(c) && !/^data:image\//i.test(c)) return } h.map[t] = n, h.push({ name: t, value: n }) } var l = this, c, u = 0, d, f, p = [], h, m, g, v, y, b, C, x, w, _, E, N, k, S, T, R, A, B, D, L, H, M, P, O, I, F = 0, z = t.decode, W, V = n.makeMap("src,href,data,background,formaction,poster"), U = /((java|vb)script|mhtml):/i, $ = /^data:/i; for (M = new RegExp("<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))", "g"), P = /([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g, C = a.getShortEndedElements(), H = i.self_closing_elements || a.getSelfClosingElements(), x = a.getBoolAttrs(), _ = i.validate, b = i.remove_internals, W = i.fix_self_closing, O = a.getSpecialElements(); c = M.exec(e); ) { if (u < c.index && l.text(z(e.substr(u, c.index - u))), d = c[6]) d = d.toLowerCase(), ":" === d.charAt(0) && (d = d.substr(1)), o(d); else if (d = c[7]) { if (d = d.toLowerCase(), ":" === d.charAt(0) && (d = d.substr(1)), w = d in C, W && H[d] && p.length > 0 && p[p.length - 1].name === d && o(d), !_ || (E = a.getElementRule(d))) { if (N = !0, _ && (T = E.attributes, R = E.attributePatterns), (S = c[8]) ? (y = -1 !== S.indexOf("data-mce-type"), y && b && (N = !1), h = [], h.map = {}, S.replace(P, s)) : (h = [], h.map = {}), _ && !y) { if (A = E.attributesRequired, B = E.attributesDefault, D = E.attributesForced, L = E.removeEmptyAttrs, L && !h.length && (N = !1), D) for (m = D.length; m--; ) k = D[m], v = k.name, I = k.value, "{$uid}" === I && (I = "mce_" + F++), h.map[v] = I, h.push({ name: v, value: I }); if (B) for (m = B.length; m--; ) k = B[m], v = k.name, v in h.map || (I = k.value, "{$uid}" === I && (I = "mce_" + F++), h.map[v] = I, h.push({ name: v, value: I })); if (A) { for (m = A.length; m-- && !(A[m] in h.map); ); -1 === m && (N = !1) } if (k = h.map["data-mce-bogus"]) { if ("all" === k) { u = r(a, e, M.lastIndex), M.lastIndex = u; continue } N = !1 } } N && l.start(d, h, w) } else N = !1; if (f = O[d]) { f.lastIndex = u = c.index + c[0].length, (c = f.exec(e)) ? (N && (g = e.substr(u, c.index - u)), u = c.index + c[0].length) : (g = e.substr(u), u = e.length), N && (g.length > 0 && l.text(g, !0), l.end(d)), M.lastIndex = u; continue } w || (S && S.indexOf("/") == S.length - 1 ? N && l.end(d) : p.push({ name: d, valid: N })) } else (d = c[1]) ? (">" === d.charAt(0) && (d = " " + d), i.allow_conditional_comments || "[if" !== d.substr(0, 3) || (d = " " + d), l.comment(d)) : (d = c[2]) ? l.cdata(d) : (d = c[3]) ? l.doctype(d) : (d = c[4]) && l.pi(d, c[5]); u = c.index + c[0].length } for (u < e.length && l.text(z(e.substr(u))), m = p.length - 1; m >= 0; m--) d = p[m], d.valid && l.end(d.name) } } var o = n.each; return i.findEndTag = r, i }), r(k, [_, E, N, u], function (e, t, n, r) { var i = r.makeMap, o = r.each, a = r.explode, s = r.extend; return function (r, l) { function c(t) { var n, r, o, a, s, c, d, f, p, h, m, g, v, y; for (m = i("tr,td,th,tbody,thead,tfoot,table"), h = l.getNonEmptyElements(), g = l.getTextBlockElements(), n = 0; n < t.length; n++) if (r = t[n], r.parent && !r.fixed) if (g[r.name] && "li" == r.parent.name) { for (v = r.next; v && g[v.name]; ) v.name = "li", v.fixed = !0, r.parent.insert(v, r.parent), v = v.next; r.unwrap(r) } else { for (a = [r], o = r.parent; o && !l.isValidChild(o.name, r.name) && !m[o.name]; o = o.parent) a.push(o); if (o && a.length > 1) { for (a.reverse(), s = c = u.filterNode(a[0].clone()), p = 0; p < a.length - 1; p++) { for (l.isValidChild(c.name, a[p].name) ? (d = u.filterNode(a[p].clone()), c.append(d)) : d = c, f = a[p].firstChild; f && f != a[p + 1]; ) y = f.next, d.append(f), f = y; c = d } s.isEmpty(h) ? o.insert(r, a[0], !0) : (o.insert(s, a[0], !0), o.insert(r, s)), o = a[0], (o.isEmpty(h) || o.firstChild === o.lastChild && "br" === o.firstChild.name) && o.empty().remove() } else if (r.parent) { if ("li" === r.name) { if (v = r.prev, v && ("ul" === v.name || "ul" === v.name)) { v.append(r); continue } if (v = r.next, v && ("ul" === v.name || "ul" === v.name)) { v.insert(r, v.firstChild, !0); continue } r.wrap(u.filterNode(new e("ul", 1))); continue } l.isValidChild(r.parent.name, "div") && l.isValidChild("div", r.name) ? r.wrap(u.filterNode(new e("div", 1))) : "style" === r.name || "script" === r.name ? r.empty().remove() : r.unwrap() } } } var u = this, d = {}, f = [], p = {}, h = {}; r = r || {}, r.validate = "validate" in r ? r.validate : !0, r.root_name = r.root_name || "body", u.schema = l = l || new t, u.filterNode = function (e) { var t, n, r; n in d && (r = p[n], r ? r.push(e) : p[n] = [e]), t = f.length; for (; t--; ) n = f[t].name, n in e.attributes.map && (r = h[n], r ? r.push(e) : h[n] = [e]); return e }, u.addNodeFilter = function (e, t) { o(a(e), function (e) { var n = d[e]; n || (d[e] = n = []), n.push(t) }) }, u.addAttributeFilter = function (e, t) { o(a(e), function (e) { var n; for (n = 0; n < f.length; n++) if (f[n].name === e) return void f[n].callbacks.push(t); f.push({ name: e, callbacks: [t] }) }) }, u.parse = function (t, o) { function a() { function e(e) { e && (t = e.firstChild, t && 3 == t.type && (t.value = t.value.replace(R, "")), t = e.lastChild, t && 3 == t.type && (t.value = t.value.replace(D, ""))) } var t = y.firstChild, n, i; if (l.isValidChild(y.name, I.toLowerCase())) { for (; t; ) n = t.next, 3 == t.type || 1 == t.type && "p" !== t.name && !T[t.name] && !t.attr("data-mce-type") ? i ? i.append(t) : (i = u(I, 1), i.attr(r.forced_root_block_attrs), y.insert(i, t), i.append(t)) : (e(i), i = null), t = n; e(i) } } function u(t, n) { var r = new e(t, n), i; return t in d && (i = p[t], i ? i.push(r) : p[t] = [r]), r } function m(e) { var t, n, r; for (t = e.prev; t && 3 === t.type; ) n = t.value.replace(D, ""), n.length > 0 ? (t.value = n, t = t.prev) : (r = t.prev, t.remove(), t = r) } function g(e) { var t, n = {}; for (t in e) "li" !== t && "p" != t && (n[t] = e[t]); return n } var v, y, b, C, x, w, _, E, N, k, S, T, R, A = [], B, D, L, H, M, P, O, I; if (o = o || {}, p = {}, h = {}, T = s(i("script,style,head,html,body,title,meta,param"), l.getBlockElements()), O = l.getNonEmptyElements(), P = l.children, S = r.validate, I = "forced_root_block" in o ? o.forced_root_block : r.forced_root_block, M = l.getWhiteSpaceElements(), R = /^[ \t\r\n]+/, D = /[ \t\r\n]+$/, L = /[ \t\r\n]+/g, H = /^[ \t\r\n]+$/, v = new n({ validate: S, allow_script_urls: r.allow_script_urls, allow_conditional_comments: r.allow_conditional_comments, self_closing_elements: g(l.getSelfClosingElements()), cdata: function (e) { b.append(u("#cdata", 4)).value = e }, text: function (e, t) { var n; B || (e = e.replace(L, " "), b.lastChild && T[b.lastChild.name] && (e = e.replace(R, ""))), 0 !== e.length && (n = u("#text", 3), n.raw = !!t, b.append(n).value = e) }, comment: function (e) { b.append(u("#comment", 8)).value = e }, pi: function (e, t) { b.append(u(e, 7)).value = t, m(b) }, doctype: function (e) { var t; t = b.append(u("#doctype", 10)), t.value = e, m(b) }, start: function (e, t, n) { var r, i, o, a, s; if (o = S ? l.getElementRule(e) : {}) { for (r = u(o.outputName || e, 1), r.attributes = t, r.shortEnded = n, b.append(r), s = P[b.name], s && P[r.name] && !s[r.name] && A.push(r), i = f.length; i--; ) a = f[i].name, a in t.map && (N = h[a], N ? N.push(r) : h[a] = [r]); T[e] && m(r), n || (b = r), !B && M[e] && (B = !0) } }, end: function (t) { var n, r, i, o, a; if (r = S ? l.getElementRule(t) : {}) { if (T[t] && !B) { if (n = b.firstChild, n && 3 === n.type) if (i = n.value.replace(R, ""), i.length > 0) n.value = i, n = n.next; else for (o = n.next, n.remove(), n = o; n && 3 === n.type; ) i = n.value, o = n.next, (0 === i.length || H.test(i)) && (n.remove(), n = o), n = o; if (n = b.lastChild, n && 3 === n.type) if (i = n.value.replace(D, ""), i.length > 0) n.value = i, n = n.prev; else for (o = n.prev, n.remove(), n = o; n && 3 === n.type; ) i = n.value, o = n.prev, (0 === i.length || H.test(i)) && (n.remove(), n = o), n = o } if (B && M[t] && (B = !1), (r.removeEmpty || r.paddEmpty) && b.isEmpty(O)) if (r.paddEmpty) b.empty().append(new e("#text", "3")).value = "\xa0"; else if (!b.attributes.map.name && !b.attributes.map.id) return a = b.parent, T[b.name] ? b.empty().remove() : b.unwrap(), void (b = a); b = b.parent } } }, l), y = b = new e(o.context || r.root_name, 11), v.parse(t), S && A.length && (o.context ? o.invalid = !0 : c(A)), I && ("body" == y.name || o.isRootContent) && a(), !o.invalid) { for (k in p) { for (N = d[k], C = p[k], _ = C.length; _--; ) C[_].parent || C.splice(_, 1); for (x = 0, w = N.length; w > x; x++) N[x](C, k, o) } for (x = 0, w = f.length; w > x; x++) if (N = f[x], N.name in h) { for (C = h[N.name], _ = C.length; _--; ) C[_].parent || C.splice(_, 1); for (_ = 0, E = N.callbacks.length; E > _; _++) N.callbacks[_](C, N.name, o) } } return y }, r.remove_trailing_brs && u.addNodeFilter("br", function (t) { var n, r = t.length, i, o = s({}, l.getBlockElements()), a = l.getNonEmptyElements(), c, u, d, f, p, h; for (o.body = 1, n = 0; r > n; n++) if (i = t[n], c = i.parent, o[i.parent.name] && i === c.lastChild) { for (d = i.prev; d; ) { if (f = d.name, "span" !== f || "bookmark" !== d.attr("data-mce-type")) { if ("br" !== f) break; if ("br" === f) { i = null; break } } d = d.prev } i && (i.remove(), c.isEmpty(a) && (p = l.getElementRule(c.name), p && (p.removeEmpty ? c.remove() : p.paddEmpty && (c.empty().append(new e("#text", 3)).value = "\xa0")))) } else { for (u = i; c && c.firstChild === u && c.lastChild === u && (u = c, !o[c.name]); ) c = c.parent; u === c && (h = new e("#text", 3), h.value = "\xa0", i.replace(h)) } }), r.allow_html_in_named_anchor || u.addAttributeFilter("id,name", function (e) { for (var t = e.length, n, r, i, o; t--; ) if (o = e[t], "a" === o.name && o.firstChild && !o.attr("href")) { i = o.parent, n = o.lastChild; do r = n.prev, i.insert(n, o), n = r; while (n) } }), r.validate && l.getValidClasses() && u.addAttributeFilter("class", function (e) { for (var t = e.length, n, r, i, o, a, s = l.getValidClasses(), c, u; t--; ) { for (n = e[t], r = n.attr("class").split(" "), a = "", i = 0; i < r.length; i++) o = r[i], u = !1, c = s["*"], c && c[o] && (u = !0), c = s[n.name], u || !c || c[o] || (u = !0), u && (a && (a += " "), a += o); a.length || (a = null), n.attr("class", a) } }) } }), r(S, [g, u], function (e, t) { var n = t.makeMap; return function (t) { var r = [], i, o, a, s, l; return t = t || {}, i = t.indent, o = n(t.indent_before || ""), a = n(t.indent_after || ""), s = e.getEncodeFunc(t.entity_encoding || "raw", t.entities), l = "html" == t.element_format, { start: function (e, t, n) { var c, u, d, f; if (i && o[e] && r.length > 0 && (f = r[r.length - 1], f.length > 0 && "\n" !== f && r.push("\n")), r.push("<", e), t) for (c = 0, u = t.length; u > c; c++) d = t[c], r.push(" ", d.name, '="', s(d.value, !0), '"'); r[r.length] = !n || l ? ">" : " />", n && i && a[e] && r.length > 0 && (f = r[r.length - 1], f.length > 0 && "\n" !== f && r.push("\n")) }, end: function (e) { var t; r.push("</", e, ">"), i && a[e] && r.length > 0 && (t = r[r.length - 1], t.length > 0 && "\n" !== t && r.push("\n")) }, text: function (e, t) { e.length > 0 && (r[r.length] = t ? e : s(e)) }, cdata: function (e) { r.push("<![CDATA[", e, "]]>") }, comment: function (e) { r.push("<!--", e, "-->") }, pi: function (e, t) { t ? r.push("<?", e, " ", t, "?>") : r.push("<?", e, "?>"), i && r.push("\n") }, doctype: function (e) { r.push("<!DOCTYPE", e, ">", i ? "\n" : "") }, reset: function () { r.length = 0 }, getContent: function () { return r.join("").replace(/\n$/, "") } } } }), r(T, [S, E], function (e, t) { return function (n, r) { var i = this, o = new e(n); n = n || {}, n.validate = "validate" in n ? n.validate : !0, i.schema = r = r || new t, i.writer = o, i.serialize = function (e) { function t(e) { var n = i[e.type], s, l, c, u, d, f, p, h, m; if (n) n(e); else { if (s = e.name, l = e.shortEnded, c = e.attributes, a && c && c.length > 1) { for (f = [], f.map = {}, m = r.getElementRule(e.name), p = 0, h = m.attributesOrder.length; h > p; p++) u = m.attributesOrder[p], u in c.map && (d = c.map[u], f.map[u] = d, f.push({ name: u, value: d })); for (p = 0, h = c.length; h > p; p++) u = c[p].name, u in f.map || (d = c.map[u], f.map[u] = d, f.push({ name: u, value: d })); c = f } if (o.start(e.name, c, l), !l) { if (e = e.firstChild) do t(e); while (e = e.next); o.end(s) } } } var i, a; return a = n.validate, i = { 3: function (e) { o.text(e.value, e.raw) }, 8: function (e) { o.comment(e.value) }, 7: function (e) { o.pi(e.name, e.value) }, 10: function (e) { o.doctype(e.value) }, 4: function (e) { o.cdata(e.value) }, 11: function (e) { if (e = e.firstChild) do t(e); while (e = e.next) } }, o.reset(), 1 != e.type || n.inner ? i[11](e) : t(e), o.getContent() } } }), r(R, [y, k, g, T, _, E, d, u], function (e, t, n, r, i, o, a, s) { var l = s.each, c = s.trim, u = e.DOM; return function (e, i) { var s, d, f; return i && (s = i.dom, d = i.schema), s = s || u, d = d || new o(e), e.entity_encoding = e.entity_encoding || "named", e.remove_trailing_brs = "remove_trailing_brs" in e ? e.remove_trailing_brs : !0, f = new t(e, d), f.addAttributeFilter("data-mce-tabindex", function (e, t) { for (var n = e.length, r; n--; ) r = e[n], r.attr("tabindex", r.attributes.map["data-mce-tabindex"]), r.attr(t, null) }), f.addAttributeFilter("src,href,style", function (t, n) { for (var r = t.length, i, o, a = "data-mce-" + n, l = e.url_converter, c = e.url_converter_scope, u; r--; ) i = t[r], o = i.attributes.map[a], o !== u ? (i.attr(n, o.length > 0 ? o : null), i.attr(a, null)) : (o = i.attributes.map[n], "style" === n ? o = s.serializeStyle(s.parseStyle(o), i.name) : l && (o = l.call(c, o, n, i.name)), i.attr(n, o.length > 0 ? o : null)) }), f.addAttributeFilter("class", function (e) { for (var t = e.length, n, r; t--; ) n = e[t], r = n.attr("class"), r && (r = n.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g, ""), n.attr("class", r.length > 0 ? r : null)) }), f.addAttributeFilter("data-mce-type", function (e, t, n) { for (var r = e.length, i; r--; ) i = e[r], "bookmark" !== i.attributes.map["data-mce-type"] || n.cleanup || i.remove() }), f.addNodeFilter("noscript", function (e) { for (var t = e.length, r; t--; ) r = e[t].firstChild, r && (r.value = n.decode(r.value)) }), f.addNodeFilter("script,style", function (e, t) { function n(e) { return e.replace(/(<!--\[CDATA\[|\]\]-->)/g, "\n").replace(/^[\r\n]*|[\r\n]*$/g, "").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi, "").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g, "") } for (var r = e.length, i, o, a; r--; ) i = e[r], o = i.firstChild ? i.firstChild.value : "", "script" === t ? (a = i.attr("type"), a && i.attr("type", "mce-no/type" == a ? null : a.replace(/^mce\-/, "")), o.length > 0 && (i.firstChild.value = "// <![CDATA[\n" + n(o) + "\n// ]]>")) : o.length > 0 && (i.firstChild.value = "<!--\n" + n(o) + "\n-->") }), f.addNodeFilter("#comment", function (e) { for (var t = e.length, n; t--; ) n = e[t], 0 === n.value.indexOf("[CDATA[") ? (n.name = "#cdata", n.type = 4, n.value = n.value.replace(/^\[CDATA\[|\]\]$/g, "")) : 0 === n.value.indexOf("mce:protected ") && (n.name = "#text", n.type = 3, n.raw = !0, n.value = unescape(n.value).substr(14)) }), f.addNodeFilter("xml:namespace,input", function (e, t) { for (var n = e.length, r; n--; ) r = e[n], 7 === r.type ? r.remove() : 1 === r.type && ("input" !== t || "type" in r.attributes.map || r.attr("type", "text")) }), e.fix_list_elements && f.addNodeFilter("ul,ol", function (e) { for (var t = e.length, n, r; t--; ) n = e[t], r = n.parent, ("ul" === r.name || "ol" === r.name) && n.prev && "li" === n.prev.name && n.prev.append(n) }), f.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize", function (e, t) { for (var n = e.length; n--; ) e[n].attr(t, null) }), { schema: d, addNodeFilter: f.addNodeFilter, addAttributeFilter: f.addAttributeFilter, serialize: function (t, n) { var i = this, o, u, p, h, m; return a.ie && s.select("script,style,select,map").length > 0 ? (m = t.innerHTML, t = t.cloneNode(!1), s.setHTML(t, m)) : t = t.cloneNode(!0), o = t.ownerDocument.implementation, o.createHTMLDocument && (u = o.createHTMLDocument(""), l("BODY" == t.nodeName ? t.childNodes : [t], function (e) { u.body.appendChild(u.importNode(e, !0)) }), t = "BODY" != t.nodeName ? u.body.firstChild : u.body, p = s.doc, s.doc = u), n = n || {}, n.format = n.format || "html", n.selection && (n.forced_root_block = ""), n.no_events || (n.node = t, i.onPreProcess(n)), h = new r(e, d), n.content = h.serialize(f.parse(c(n.getInner ? t.innerHTML : s.getOuterHTML(t)), n)), n.cleanup || (n.content = n.content.replace(/\uFEFF/g, "")), n.no_events || i.onPostProcess(n), p && (s.doc = p), n.node = null, n.content }, addRules: function (e) { d.addValidElements(e) }, setRules: function (e) { d.setValidElements(e) }, onPreProcess: function (e) { i && i.fire("PreProcess", e) }, onPostProcess: function (e) { i && i.fire("PostProcess", e) } } } }), r(A, [], function () { function e(e) { function t(t, n) { var r, i = 0, o, a, s, l, c, u, d = -1, f; if (r = t.duplicate(), r.collapse(n), f = r.parentElement(), f.ownerDocument === e.dom.doc) { for (; "false" === f.contentEditable; ) f = f.parentNode; if (!f.hasChildNodes()) return { node: f, inside: 1 }; for (s = f.children, o = s.length - 1; o >= i; ) if (u = Math.floor((i + o) / 2), l = s[u], r.moveToElementText(l), d = r.compareEndPoints(n ? "StartToStart" : "EndToEnd", t), d > 0) o = u - 1; else { if (!(0 > d)) return { node: l }; i = u + 1 } if (0 > d) for (l ? r.collapse(!1) : (r.moveToElementText(f), r.collapse(!0), l = f, a = !0), c = 0; 0 !== r.compareEndPoints(n ? "StartToStart" : "StartToEnd", t) && 0 !== r.move("character", 1) && f == r.parentElement(); ) c++; else for (r.collapse(!0), c = 0; 0 !== r.compareEndPoints(n ? "StartToStart" : "StartToEnd", t) && 0 !== r.move("character", -1) && f == r.parentElement(); ) c++; return { node: l, position: d, offset: c, inside: a} } } function n() { function n(e) { var n = t(o, e), r, i, s = 0, l, c, u; if (r = n.node, i = n.offset, n.inside && !r.hasChildNodes()) return void a[e ? "setStart" : "setEnd"](r, 0); if (i === c) return void a[e ? "setStartBefore" : "setEndAfter"](r); if (n.position < 0) { if (l = n.inside ? r.firstChild : r.nextSibling, !l) return void a[e ? "setStartAfter" : "setEndAfter"](r); if (!i) return void (3 == l.nodeType ? a[e ? "setStart" : "setEnd"](l, 0) : a[e ? "setStartBefore" : "setEndBefore"](l)); for (; l; ) { if (3 == l.nodeType && (u = l.nodeValue, s += u.length, s >= i)) { r = l, s -= i, s = u.length - s; break } l = l.nextSibling } } else { if (l = r.previousSibling, !l) return a[e ? "setStartBefore" : "setEndBefore"](r); if (!i) return void (3 == r.nodeType ? a[e ? "setStart" : "setEnd"](l, r.nodeValue.length) : a[e ? "setStartAfter" : "setEndAfter"](l)); for (; l; ) { if (3 == l.nodeType && (s += l.nodeValue.length, s >= i)) { r = l, s -= i; break } l = l.previousSibling } } a[e ? "setStart" : "setEnd"](r, s) } var o = e.getRng(), a = i.createRng(), s, l, c, u, d; if (s = o.item ? o.item(0) : o.parentElement(), s.ownerDocument != i.doc) return a; if (l = e.isCollapsed(), o.item) return a.setStart(s.parentNode, i.nodeIndex(s)), a.setEnd(a.startContainer, a.startOffset + 1), a; try { n(!0), l || n() } catch (f) { if (-2147024809 != f.number) throw f; d = r.getBookmark(2), c = o.duplicate(), c.collapse(!0), s = c.parentElement(), l || (c = o.duplicate(), c.collapse(!1), u = c.parentElement(), u.innerHTML = u.innerHTML), s.innerHTML = s.innerHTML, r.moveToBookmark(d), o = e.getRng(), n(!0), l || n() } return a } var r = this, i = e.dom, o = !1; this.getBookmark = function (n) { function r(e) { var t, n, r, o, a = []; for (t = e.parentNode, n = i.getRoot().parentNode; t != n && 9 !== t.nodeType; ) { for (r = t.children, o = r.length; o--; ) if (e === r[o]) { a.push(o); break } e = t, t = t.parentNode } return a } function o(e) { var n; return n = t(a, e), n ? { position: n.position, offset: n.offset, indexes: r(n.node), inside: n.inside} : void 0 } var a = e.getRng(), s = {}; return 2 === n && (a.item ? s.start = { ctrl: !0, indexes: r(a.item(0))} : (s.start = o(!0), e.isCollapsed() || (s.end = o()))), s }, this.moveToBookmark = function (e) { function t(e) { var t, n, r, o; for (t = i.getRoot(), n = e.length - 1; n >= 0; n--) o = t.children, r = e[n], r <= o.length - 1 && (t = o[r]); return t } function n(n) { var i = e[n ? "start" : "end"], a, s, l, c; i && (a = i.position > 0, s = o.createTextRange(), s.moveToElementText(t(i.indexes)), c = i.offset, c !== l ? (s.collapse(i.inside || a), s.moveStart("character", a ? -c : c)) : s.collapse(n), r.setEndPoint(n ? "StartToStart" : "EndToStart", s), n && r.collapse(!0)) } var r, o = i.doc.body; e.start && (e.start.ctrl ? (r = o.createControlRange(), r.addElement(t(e.start.indexes)), r.select()) : (r = o.createTextRange(), n(!0), n(), r.select())) }, this.addRange = function (t) { function n(e) { var t, n, a, d, h; a = i.create("a"), t = e ? s : c, n = e ? l : u, d = r.duplicate(), (t == f || t == f.documentElement) && (t = p, n = 0), 3 == t.nodeType ? (t.parentNode.insertBefore(a, t), d.moveToElementText(a), d.moveStart("character", n), i.remove(a), r.setEndPoint(e ? "StartToStart" : "EndToEnd", d)) : (h = t.childNodes, h.length ? (n >= h.length ? i.insertAfter(a, h[h.length - 1]) : t.insertBefore(a, h[n]), d.moveToElementText(a)) : t.canHaveHTML && (t.innerHTML = "<span>&#xFEFF;</span>", a = t.firstChild, d.moveToElementText(a), d.collapse(o)), r.setEndPoint(e ? "StartToStart" : "EndToEnd", d), i.remove(a)) } var r, a, s, l, c, u, d, f = e.dom.doc, p = f.body, h, m; if (s = t.startContainer, l = t.startOffset, c = t.endContainer, u = t.endOffset, r = p.createTextRange(), s == c && 1 == s.nodeType) { if (l == u && !s.hasChildNodes()) { if (s.canHaveHTML) return d = s.previousSibling, d && !d.hasChildNodes() && i.isBlock(d) ? d.innerHTML = "&#xFEFF;" : d = null, s.innerHTML = "<span>&#xFEFF;</span><span>&#xFEFF;</span>", r.moveToElementText(s.lastChild), r.select(), i.doc.selection.clear(), s.innerHTML = "", void (d && (d.innerHTML = "")); l = i.nodeIndex(s), s = s.parentNode } if (l == u - 1) try { if (m = s.childNodes[l], a = p.createControlRange(), a.addElement(m), a.select(), h = e.getRng(), h.item && m === h.item(0)) return } catch (g) { } } n(!0), n(), r.select() }, this.getRangeAt = n } return e }), r(B, [d], function (e) { return { BACKSPACE: 8, DELETE: 46, DOWN: 40, ENTER: 13, LEFT: 37, RIGHT: 39, SPACEBAR: 32, TAB: 9, UP: 38, modifierPressed: function (e) { return e.shiftKey || e.ctrlKey || e.altKey }, metaKeyPressed: function (t) { return e.mac ? t.metaKey : t.ctrlKey && !t.altKey } } }), r(D, [B, u, d], function (e, t, n) { return function (r, i) { function o(e) { var t = i.settings.object_resizing; return t === !1 || n.iOS ? !1 : ("string" != typeof t && (t = "table,img,div"), "false" === e.getAttribute("data-mce-resize") ? !1 : i.dom.is(e, t)) } function a(t) { var n, r, o, a, s; n = t.screenX - T, r = t.screenY - R, P = n * k[2] + D, O = r * k[3] + L, P = 5 > P ? 5 : P, O = 5 > O ? 5 : O, o = "IMG" == w.nodeName && i.settings.resize_img_proportional !== !1 ? !e.modifierPressed(t) : e.modifierPressed(t) || "IMG" == w.nodeName && k[2] * k[3] !== 0, o && (W(n) > W(r) ? (O = V(P * H), P = V(O / H)) : (P = V(O / H), O = V(P * H))), C.setStyles(_, { width: P, height: O }), a = k.startPos.x + n, s = k.startPos.y + r, a = a > 0 ? a : 0, s = s > 0 ? s : 0, C.setStyles(E, { left: a, top: s, display: "block" }), E.innerHTML = P + " &times; " + O, k[2] < 0 && _.clientWidth <= P && C.setStyle(_, "left", A + (D - P)), k[3] < 0 && _.clientHeight <= O && C.setStyle(_, "top", B + (L - O)), n = U.scrollWidth - $, r = U.scrollHeight - q, n + r !== 0 && C.setStyles(E, { left: a - n, top: s - r }), M || (i.fire("ObjectResizeStart", { target: w, width: D, height: L }), M = !0) } function s() { function e(e, t) { t && (w.style[e] || !i.schema.isValid(w.nodeName.toLowerCase(), e) ? C.setStyle(w, e, t) : C.setAttrib(w, e, t)) } M = !1, e("width", P), e("height", O), C.unbind(I, "mousemove", a), C.unbind(I, "mouseup", s), F != I && (C.unbind(F, "mousemove", a), C.unbind(F, "mouseup", s)), C.remove(_), C.remove(E), z && "TABLE" != w.nodeName || l(w), i.fire("ObjectResized", { target: w, width: P, height: O }), C.setAttrib(w, "style", C.getAttrib(w, "style")), i.nodeChanged() } function l(e, t, r) { var l, u, d, f, p; g(), l = C.getPos(e, U), A = l.x, B = l.y, p = e.getBoundingClientRect(), u = p.width || p.right - p.left, d = p.height || p.bottom - p.top, w != e && (m(), w = e, P = O = 0), f = i.fire("ObjectSelected", { target: e }), o(e) && !f.isDefaultPrevented() ? x(N, function (e, i) { function o(t) { T = t.screenX, R = t.screenY, D = w.clientWidth, L = w.clientHeight, H = L / D, k = e, e.startPos = { x: u * e[0] + A, y: d * e[1] + B }, $ = U.scrollWidth, q = U.scrollHeight, _ = w.cloneNode(!0), C.addClass(_, "mce-clonedresizable"), C.setAttrib(_, "data-mce-bogus", "all"), _.contentEditable = !1, _.unSelectabe = !0, C.setStyles(_, { left: A, top: B, margin: 0 }), _.removeAttribute("data-mce-selected"), U.appendChild(_), C.bind(I, "mousemove", a), C.bind(I, "mouseup", s), F != I && (C.bind(F, "mousemove", a), C.bind(F, "mouseup", s)), E = C.add(U, "div", { "class": "mce-resize-helper", "data-mce-bogus": "all" }, D + " &times; " + L) } var l, c; return t ? void (i == t && o(r)) : (l = C.get("mceResizeHandle" + i), l ? C.show(l) : (c = U, l = C.add(c, "div", { id: "mceResizeHandle" + i, "data-mce-bogus": "all", "class": "mce-resizehandle", unselectable: !0, style: "cursor:" + i + "-resize; margin:0; padding:0" }), n.ie && (l.contentEditable = !1)), e.elm || (C.bind(l, "mousedown", function (e) { e.stopImmediatePropagation(), e.preventDefault(), o(e) }), e.elm = l), void C.setStyles(l, { left: u * e[0] + A - l.offsetWidth / 2, top: d * e[1] + B - l.offsetHeight / 2 })) }) : c(), w.setAttribute("data-mce-selected", "1") } function c() { var e, t; g(), w && w.removeAttribute("data-mce-selected"); for (e in N) t = C.get("mceResizeHandle" + e), t && (C.unbind(t), C.remove(t)) } function u(e) { function t(e, t) { if (e) do if (e === t) return !0; while (e = e.parentNode) } var n, i; if (!M) return x(C.select("img[data-mce-selected],hr[data-mce-selected]"), function (e) { e.removeAttribute("data-mce-selected") }), i = "mousedown" == e.type ? e.target : r.getNode(), i = C.$(i).closest(z ? "table" : "table,img,hr")[0], t(i, U) && (v(), n = r.getStart(!0), t(n, i) && t(r.getEnd(!0), i) && (!z || i != n && "IMG" !== n.nodeName)) ? void l(i) : void c() } function d(e, t, n) { e && e.attachEvent && e.attachEvent("on" + t, n) } function f(e, t, n) { e && e.detachEvent && e.detachEvent("on" + t, n) } function p(e) { var t = e.srcElement, n, r, o, a, s, c, u; n = t.getBoundingClientRect(), c = S.clientX - n.left, u = S.clientY - n.top; for (r in N) if (o = N[r], a = t.offsetWidth * o[0], s = t.offsetHeight * o[1], W(a - c) < 8 && W(s - u) < 8) { k = o; break } M = !0, i.fire("ObjectResizeStart", { target: w, width: w.clientWidth, height: w.clientHeight }), i.getDoc().selection.empty(), l(t, r, S) } function h(e) { var t = e.srcElement; if (t != w) { if (i.fire("ObjectSelected", { target: t }), m(), 0 === t.id.indexOf("mceResizeHandle")) return void (e.returnValue = !1); ("IMG" == t.nodeName || "TABLE" == t.nodeName) && (c(), w = t, d(t, "resizestart", p)) } } function m() { f(w, "resizestart", p) } function g() { for (var e in N) { var t = N[e]; t.elm && (C.unbind(t.elm), delete t.elm) } } function v() { try { i.getDoc().execCommand("enableObjectResizing", !1, !1) } catch (e) { } } function y(e) { var t; if (z) { t = I.body.createControlRange(); try { return t.addElement(e), t.select(), !0 } catch (n) { } } } function b() { w = _ = null, z && (m(), f(U, "controlselect", h)) } var C = i.dom, x = t.each, w, _, E, N, k, S, T, R, A, B, D, L, H, M, P, O, I = i.getDoc(), F = document, z = n.ie && n.ie < 11, W = Math.abs, V = Math.round, U = i.getBody(), $, q; N = { n: [.5, 0, 0, -1], e: [1, .5, 1, 0], s: [.5, 1, 0, 1], w: [0, .5, -1, 0], nw: [0, 0, -1, -1], ne: [1, 0, 1, -1], se: [1, 1, 1, 1], sw: [0, 1, -1, 1] }; var j = ".mce-content-body"; return i.contentStyles.push(j + " div.mce-resizehandle {position: absolute;border: 1px solid black;background: #FFF;width: 5px;height: 5px;z-index: 10000}" + j + " .mce-resizehandle:hover {background: #000}" + j + " img[data-mce-selected], hr[data-mce-selected] {outline: 1px solid black;resize: none}" + j + " .mce-clonedresizable {position: absolute;" + (n.gecko ? "" : "outline: 1px dashed black;") + "opacity: .5;filter: alpha(opacity=50);z-index: 10000}" + j + " .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}"), i.on("init", function () { z ? (i.on("ObjectResized", function (e) { "TABLE" != e.target.nodeName && (c(), y(e.target)) }), d(U, "controlselect", h), i.on("mousedown", function (e) { S = e })) : (v(), n.ie >= 11 && (i.on("mouseup", function (e) { var t = e.target.nodeName; !M && /^(TABLE|IMG|HR)$/.test(t) && (i.selection.select(e.target, "TABLE" == t), i.nodeChanged()) }), i.dom.bind(U, "mscontrolselect", function (e) { /^(TABLE|IMG|HR)$/.test(e.target.nodeName) && (e.preventDefault(), "IMG" == e.target.tagName && window.setTimeout(function () { i.selection.select(e.target) }, 0)) }))), i.on("nodechange ResizeEditor", u), i.on("keydown keyup", function (e) { w && "TABLE" == w.nodeName && u(e) }), i.on("hide", c) }), i.on("remove", g), { isResizable: o, showResizeRect: l, hideResizeRect: c, updateResizeRect: u, controlSelect: y, destroy: b} } }), r(L, [d, u], function (e, t) { function n(n) { var r = n.dom; this.getBookmark = function (e, i) { function o(e, n) { var i = 0; return t.each(r.select(e), function (e, t) { e == n && (i = t) }), i } function a(e) { function t(t) { var n, r, i, o = t ? "start" : "end"; n = e[o + "Container"], r = e[o + "Offset"], 1 == n.nodeType && "TR" == n.nodeName && (i = n.childNodes, n = i[Math.min(t ? r : r - 1, i.length - 1)], n && (r = t ? 0 : n.childNodes.length, e["set" + (t ? "Start" : "End")](n, r))) } return t(!0), t(), e } function s() { function e(e, t) { var n = e[t ? "startContainer" : "endContainer"], a = e[t ? "startOffset" : "endOffset"], s = [], l, c, u = 0; if (3 == n.nodeType) { if (i) for (l = n.previousSibling; l && 3 == l.nodeType; l = l.previousSibling) a += l.nodeValue.length; s.push(a) } else c = n.childNodes, a >= c.length && c.length && (u = 1, a = Math.max(0, c.length - 1)), s.push(r.nodeIndex(c[a], i) + u); for (; n && n != o; n = n.parentNode) s.push(r.nodeIndex(n, i)); return s } var t = n.getRng(!0), o = r.getRoot(), a = {}; return a.start = e(t, !0), n.isCollapsed() || (a.end = e(t)), a } var l, c, u, d, f, p, h = "&#xFEFF;", m; if (2 == e) return p = n.getNode(), f = p ? p.nodeName : null, "IMG" == f ? { name: f, index: o(f, p)} : n.tridentSel ? n.tridentSel.getBookmark(e) : s(); if (e) return { rng: n.getRng() }; if (l = n.getRng(), u = r.uniqueId(), d = n.isCollapsed(), m = "overflow:hidden;line-height:0px", l.duplicate || l.item) { if (l.item) return p = l.item(0), f = p.nodeName, { name: f, index: o(f, p) }; c = l.duplicate(); try { l.collapse(), l.pasteHTML('<span data-mce-type="bookmark" id="' + u + '_start" style="' + m + '">' + h + "</span>"), d || (c.collapse(!1), l.moveToElementText(c.parentElement()), 0 === l.compareEndPoints("StartToEnd", c) && c.move("character", -1), c.pasteHTML('<span data-mce-type="bookmark" id="' + u + '_end" style="' + m + '">' + h + "</span>")) } catch (g) { return null } } else { if (p = n.getNode(), f = p.nodeName, "IMG" == f) return { name: f, index: o(f, p) }; c = a(l.cloneRange()), d || (c.collapse(!1), c.insertNode(r.create("span", { "data-mce-type": "bookmark", id: u + "_end", style: m }, h))), l = a(l), l.collapse(!0), l.insertNode(r.create("span", { "data-mce-type": "bookmark", id: u + "_start", style: m }, h)) } return n.moveToBookmark({ id: u, keep: 1 }), { id: u} }, this.moveToBookmark = function (i) { function o(e) { var t = i[e ? "start" : "end"], n, r, o, a; if (t) { for (o = t[0], r = c, n = t.length - 1; n >= 1; n--) { if (a = r.childNodes, t[n] > a.length - 1) return; r = a[t[n]] } 3 === r.nodeType && (o = Math.min(t[0], r.nodeValue.length)), 1 === r.nodeType && (o = Math.min(t[0], r.childNodes.length)), e ? l.setStart(r, o) : l.setEnd(r, o) } return !0 } function a(n) { var o = r.get(i.id + "_" + n), a, s, l, c, h = i.keep; if (o && (a = o.parentNode, "start" == n ? (h ? (a = o.firstChild, s = 1) : s = r.nodeIndex(o), u = d = a, f = p = s) : (h ? (a = o.firstChild, s = 1) : s = r.nodeIndex(o), d = a, p = s), !h)) { for (c = o.previousSibling, l = o.nextSibling, t.each(t.grep(o.childNodes), function (e) { 3 == e.nodeType && (e.nodeValue = e.nodeValue.replace(/\uFEFF/g, "")) }); o = r.get(i.id + "_" + n); ) r.remove(o, 1); c && l && c.nodeType == l.nodeType && 3 == c.nodeType && !e.opera && (s = c.nodeValue.length, c.appendData(l.nodeValue), r.remove(l), "start" == n ? (u = d = c, f = p = s) : (d = c, p = s)) } } function s(t) { return !r.isBlock(t) || t.innerHTML || e.ie || (t.innerHTML = '<br data-mce-bogus="1" />'), t } var l, c, u, d, f, p; if (i) if (i.start) { if (l = r.createRng(), c = r.getRoot(), n.tridentSel) return n.tridentSel.moveToBookmark(i); o(!0) && o() && n.setRng(l) } else i.id ? (a("start"), a("end"), u && (l = r.createRng(), l.setStart(s(u), f), l.setEnd(s(d), p), n.setRng(l))) : i.name ? n.select(r.select(i.name)[i.index]) : i.rng && n.setRng(i.rng) } } return n.isBookmarkNode = function (e) { return e && "SPAN" === e.tagName && "bookmark" === e.getAttribute("data-mce-type") }, n }), r(H, [h, A, D, x, L, d, u], function (e, n, r, i, o, a, s) { function l(e, t, i, a) { var s = this; s.dom = e, s.win = t, s.serializer = i, s.editor = a, s.bookmarkManager = new o(s), s.controlSelection = new r(s, a), s.win.getSelection || (s.tridentSel = new n(s)) } var c = s.each, u = s.trim, d = a.ie; return l.prototype = { setCursorLocation: function (e, t) { var n = this, r = n.dom.createRng(); e ? (r.setStart(e, t), r.setEnd(e, t), n.setRng(r), n.collapse(!1)) : (n._moveEndPoint(r, n.editor.getBody(), !0), n.setRng(r)) }, getContent: function (e) { var n = this, r = n.getRng(), i = n.dom.create("body"), o = n.getSel(), a, s, l; return e = e || {}, a = s = "", e.get = !0, e.format = e.format || "html", e.selection = !0, n.editor.fire("BeforeGetContent", e), "text" == e.format ? n.isCollapsed() ? "" : r.text || (o.toString ? o.toString() : "") : (r.cloneContents ? (l = r.cloneContents(), l && i.appendChild(l)) : r.item !== t || r.htmlText !== t ? (i.innerHTML = "<br>" + (r.item ? r.item(0).outerHTML : r.htmlText), i.removeChild(i.firstChild)) : i.innerHTML = r.toString(), /^\s/.test(i.innerHTML) && (a = " "), /\s+$/.test(i.innerHTML) && (s = " "), e.getInner = !0, e.content = n.isCollapsed() ? "" : a + n.serializer.serialize(i, e) + s, n.editor.fire("GetContent", e), e.content) }, setContent: function (e, t) { var n = this, r = n.getRng(), i, o = n.win.document, a, s; if (t = t || { format: "html" }, t.set = !0, t.selection = !0, e = t.content = e, t.no_events || n.editor.fire("BeforeSetContent", t), e = t.content, r.insertNode) { e += '<span id="__caret">_</span>', r.startContainer == o && r.endContainer == o ? o.body.innerHTML = e : (r.deleteContents(), 0 === o.body.childNodes.length ? o.body.innerHTML = e : r.createContextualFragment ? r.insertNode(r.createContextualFragment(e)) : (a = o.createDocumentFragment(), s = o.createElement("div"), a.appendChild(s), s.outerHTML = e, r.insertNode(a))), i = n.dom.get("__caret"), r = o.createRange(), r.setStartBefore(i), r.setEndBefore(i), n.setRng(r), n.dom.remove("__caret"); try { n.setRng(r) } catch (l) { } } else r.item && (o.execCommand("Delete", !1, null), r = n.getRng()), /^\s+/.test(e) ? (r.pasteHTML('<span id="__mce_tmp">_</span>' + e), n.dom.remove("__mce_tmp")) : r.pasteHTML(e); t.no_events || n.editor.fire("SetContent", t) }, getStart: function (e) { var t = this, n = t.getRng(), r, i, o, a; if (n.duplicate || n.item) { if (n.item) return n.item(0); for (o = n.duplicate(), o.collapse(1), r = o.parentElement(), r.ownerDocument !== t.dom.doc && (r = t.dom.getRoot()), i = a = n.parentElement(); a = a.parentNode; ) if (a == r) { r = i; break } return r } return r = n.startContainer, 1 == r.nodeType && r.hasChildNodes() && (e && n.collapsed || (r = r.childNodes[Math.min(r.childNodes.length - 1, n.startOffset)])), r && 3 == r.nodeType ? r.parentNode : r }, getEnd: function (e) { var t = this, n = t.getRng(), r, i; return n.duplicate || n.item ? n.item ? n.item(0) : (n = n.duplicate(), n.collapse(0), r = n.parentElement(), r.ownerDocument !== t.dom.doc && (r = t.dom.getRoot()), r && "BODY" == r.nodeName ? r.lastChild || r : r) : (r = n.endContainer, i = n.endOffset, 1 == r.nodeType && r.hasChildNodes() && (e && n.collapsed || (r = r.childNodes[i > 0 ? i - 1 : i])), r && 3 == r.nodeType ? r.parentNode : r) }, getBookmark: function (e, t) { return this.bookmarkManager.getBookmark(e, t) }, moveToBookmark: function (e) { return this.bookmarkManager.moveToBookmark(e) }, select: function (e, t) { var n = this, r = n.dom, i = r.createRng(), o; if (n.lastFocusBookmark = null, e) { if (!t && n.controlSelection.controlSelect(e)) return; o = r.nodeIndex(e), i.setStart(e.parentNode, o), i.setEnd(e.parentNode, o + 1), t && (n._moveEndPoint(i, e, !0), n._moveEndPoint(i, e)), n.setRng(i) } return e }, isCollapsed: function () { var e = this, t = e.getRng(), n = e.getSel(); return !t || t.item ? !1 : t.compareEndPoints ? 0 === t.compareEndPoints("StartToEnd", t) : !n || t.collapsed }, collapse: function (e) { var t = this, n = t.getRng(), r; n.item && (r = n.item(0), n = t.win.document.body.createTextRange(), n.moveToElementText(r)), n.collapse(!!e), t.setRng(n) }, getSel: function () { var e = this.win; return e.getSelection ? e.getSelection() : e.document.selection }, getRng: function (e) { function t(e, t, n) { try { return t.compareBoundaryPoints(e, n) } catch (r) { return -1 } } var n = this, r, i, o, a = n.win.document, s; if (!e && n.lastFocusBookmark) { var l = n.lastFocusBookmark; return l.startContainer ? (i = a.createRange(), i.setStart(l.startContainer, l.startOffset), i.setEnd(l.endContainer, l.endOffset)) : i = l, i } if (e && n.tridentSel) return n.tridentSel.getRangeAt(0); try { (r = n.getSel()) && (i = r.rangeCount > 0 ? r.getRangeAt(0) : r.createRange ? r.createRange() : a.createRange()) } catch (c) { } if (d && i && i.setStart && a.selection) { try { s = a.selection.createRange() } catch (c) { } s && s.item && (o = s.item(0), i = a.createRange(), i.setStartBefore(o), i.setEndAfter(o)) } return i || (i = a.createRange ? a.createRange() : a.body.createTextRange()), i.setStart && 9 === i.startContainer.nodeType && i.collapsed && (o = n.dom.getRoot(), i.setStart(o, 0), i.setEnd(o, 0)), n.selectedRange && n.explicitRange && (0 === t(i.START_TO_START, i, n.selectedRange) && 0 === t(i.END_TO_END, i, n.selectedRange) ? i = n.explicitRange : (n.selectedRange = null, n.explicitRange = null)), i }, setRng: function (e, t) { var n = this, r; if (e) if (e.select) try { e.select() } catch (i) { } else if (n.tridentSel) { if (e.cloneRange) try { return void n.tridentSel.addRange(e) } catch (i) { } } else if (r = n.getSel()) { n.explicitRange = e; try { r.removeAllRanges(), r.addRange(e) } catch (i) { } t === !1 && r.extend && (r.collapse(e.endContainer, e.endOffset), r.extend(e.startContainer, e.startOffset)), n.selectedRange = r.rangeCount > 0 ? r.getRangeAt(0) : null } }, setNode: function (e) { var t = this; return t.setContent(t.dom.getOuterHTML(e)), e }, getNode: function () { function e(e, t) { for (var n = e; e && 3 === e.nodeType && 0 === e.length; ) e = t ? e.nextSibling : e.previousSibling; return e || n } var t = this, n = t.getRng(), r, i = n.startContainer, o = n.endContainer, a = n.startOffset, s = n.endOffset, l = t.dom.getRoot(); return n ? n.setStart ? (r = n.commonAncestorContainer, !n.collapsed && (i == o && 2 > s - a && i.hasChildNodes() && (r = i.childNodes[a]), 3 === i.nodeType && 3 === o.nodeType && (i = i.length === a ? e(i.nextSibling, !0) : i.parentNode, o = 0 === s ? e(o.previousSibling, !1) : o.parentNode, i && i === o)) ? i : r && 3 == r.nodeType ? r.parentNode : r) : (r = n.item ? n.item(0) : n.parentElement(), r.ownerDocument !== t.win.document && (r = l), r) : l }, getSelectedBlocks: function (t, n) { var r = this, i = r.dom, o, a, s = []; if (a = i.getRoot(), t = i.getParent(t || r.getStart(), i.isBlock), n = i.getParent(n || r.getEnd(), i.isBlock), t && t != a && s.push(t), t && n && t != n) { o = t; for (var l = new e(t, a); (o = l.next()) && o != n; ) i.isBlock(o) && s.push(o) } return n && t != n && n != a && s.push(n), s }, isForward: function () { var e = this.dom, t = this.getSel(), n, r; return t && t.anchorNode && t.focusNode ? (n = e.createRng(), n.setStart(t.anchorNode, t.anchorOffset), n.collapse(!0), r = e.createRng(), r.setStart(t.focusNode, t.focusOffset), r.collapse(!0), n.compareBoundaryPoints(n.START_TO_START, r) <= 0) : !0 }, normalize: function () { var e = this, t = e.getRng(); return !d && new i(e.dom).normalize(t) && e.setRng(t, e.isForward()), t }, selectorChanged: function (e, t) { var n = this, r; return n.selectorChangedData || (n.selectorChangedData = {}, r = {}, n.editor.on("NodeChange", function (e) { var t = e.element, i = n.dom, o = i.getParents(t, null, i.getRoot()), a = {}; c(n.selectorChangedData, function (e, t) { c(o, function (n) { return i.is(n, t) ? (r[t] || (c(e, function (e) { e(!0, { node: n, selector: t, parents: o }) }), r[t] = e), a[t] = e, !1) : void 0 }) }), c(r, function (e, n) { a[n] || (delete r[n], c(e, function (e) { e(!1, { node: t, selector: n, parents: o }) })) }) })), n.selectorChangedData[e] || (n.selectorChangedData[e] = []), n.selectorChangedData[e].push(t), n }, getScrollContainer: function () { for (var e, t = this.dom.getRoot(); t && "BODY" != t.nodeName; ) { if (t.scrollHeight > t.clientHeight) { e = t; break } t = t.parentNode } return e }, scrollIntoView: function (e) { function t(e) { for (var t = 0, n = 0, r = e; r && r.nodeType; ) t += r.offsetLeft || 0, n += r.offsetTop || 0, r = r.offsetParent; return { x: t, y: n} } var n, r, i = this, o = i.dom, a = o.getRoot(), s, l; if ("BODY" != a.nodeName) { var c = i.getScrollContainer(); if (c) return n = t(e).y - t(c).y, l = c.clientHeight, s = c.scrollTop, void ((s > n || n + 25 > s + l) && (c.scrollTop = s > n ? n : n - l + 25)) } r = o.getViewPort(i.editor.getWin()), n = o.getPos(e).y, s = r.y, l = r.h, (n < r.y || n + 25 > s + l) && i.editor.getWin().scrollTo(0, s > n ? n : n - l + 25) }, placeCaretAt: function (e, t) { var n = this.editor.getDoc(), r, i; if (n.caretPositionFromPoint) i = n.caretPositionFromPoint(e, t), r = n.createRange(), r.setStart(i.offsetNode, i.offset), r.collapse(!0); else if (n.caretRangeFromPoint) r = n.caretRangeFromPoint(e, t); else if (n.body.createTextRange) { r = n.body.createTextRange(); try { r.moveToPoint(e, t), r.collapse(!0) } catch (o) { r.collapse(t < n.body.clientHeight) } } this.setRng(r) }, _moveEndPoint: function (t, n, r) { var i = n, o = new e(n, i), s = this.dom.schema.getNonEmptyElements(); do { if (3 == n.nodeType && 0 !== u(n.nodeValue).length) return void (r ? t.setStart(n, 0) : t.setEnd(n, n.nodeValue.length)); if (s[n.nodeName] && !/^(TD|TH)$/.test(n.nodeName)) return void (r ? t.setStartBefore(n) : "BR" == n.nodeName ? t.setEndBefore(n) : t.setEndAfter(n)); if (a.ie && a.ie < 11 && this.dom.isBlock(n) && this.dom.isEmpty(n)) return void (r ? t.setStart(n, 0) : t.setEnd(n, 0)) } while (n = r ? o.next() : o.prev()); "BODY" == i.nodeName && (r ? t.setStart(i, 0) : t.setEnd(i, i.childNodes.length)) }, destroy: function () { this.win = null, this.controlSelection.destroy() } }, l }), r(M, [L, u], function (e, t) { function n(t) { this.compare = function (n, i) { function o(e) { var n = {}; return r(t.getAttribs(e), function (r) { var i = r.nodeName.toLowerCase(); 0 !== i.indexOf("_") && "style" !== i && "data-mce-style" !== i && (n[i] = t.getAttrib(e, i)) }), n } function a(e, t) { var n, r; for (r in e) if (e.hasOwnProperty(r)) { if (n = t[r], "undefined" == typeof n) return !1; if (e[r] != n) return !1; delete t[r] } for (r in t) if (t.hasOwnProperty(r)) return !1; return !0 } return n.nodeName != i.nodeName ? !1 : a(o(n), o(i)) && a(t.parseStyle(t.getAttrib(n, "style")), t.parseStyle(t.getAttrib(i, "style"))) ? !e.isBookmarkNode(n) && !e.isBookmarkNode(i) : !1 } } var r = t.each; return n }), r(P, [u], function (e) { function t(e, t) { function r(e) { return e.replace(/%(\w+)/g, "") } var i, o, a = e.dom, s = "", l, c; if (c = e.settings.preview_styles, c === !1) return ""; if (c || (c = "font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow"), "string" == typeof t) { if (t = e.formatter.get(t), !t) return; t = t[0] } return i = t.block || t.inline || "span", o = a.create(i), n(t.styles, function (e, t) { e = r(e), e && a.setStyle(o, t, e) }), n(t.attributes, function (e, t) { e = r(e), e && a.setAttrib(o, t, e) }), n(t.classes, function (e) { e = r(e), a.hasClass(o, e) || a.addClass(o, e) }), e.fire("PreviewFormats"), a.setStyles(o, { position: "absolute", left: -65535 }), e.getBody().appendChild(o), l = a.getStyle(e.getBody(), "fontSize", !0), l = /px$/.test(l) ? parseInt(l, 10) : 0, n(c.split(" "), function (t) { var n = a.getStyle(o, t, !0); if (!("background-color" == t && /transparent|rgba\s*\([^)]+,\s*0\)/.test(n) && (n = a.getStyle(e.getBody(), t, !0), "#ffffff" == a.toHex(n).toLowerCase()) || "color" == t && "#000000" == a.toHex(n).toLowerCase())) { if ("font-size" == t && /em|%$/.test(n)) { if (0 === l) return; n = parseFloat(n, 10) / (/%$/.test(n) ? 100 : 1), n = n * l + "px" } "border" == t && n && (s += "padding:0 2px;"), s += t + ":" + n + ";" } }), e.fire("AfterPreviewFormats"), a.remove(o), s } var n = e.each; return { getCssText: t} }), r(O, [h, x, L, M, u, P], function (e, t, n, r, i, o) { return function (a) { function s(e) { return e.nodeType && (e = e.nodeName), !!a.schema.getTextBlockElements()[e.toLowerCase()] } function l(e, t) { return U.getParents(e, t, U.getRoot()) } function c(e) { return 1 === e.nodeType && "_mce_caret" === e.id } function u() { p({ valigntop: [{ selector: "td,th", styles: { verticalAlign: "top"}}], valignmiddle: [{ selector: "td,th", styles: { verticalAlign: "middle"}}], valignbottom: [{ selector: "td,th", styles: { verticalAlign: "bottom"}}], alignleft: [{ selector: "figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li", styles: { textAlign: "left" }, defaultBlock: "div" }, { selector: "img,table", collapsed: !1, styles: { "float": "left"}}], aligncenter: [{ selector: "figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li", styles: { textAlign: "center" }, defaultBlock: "div" }, { selector: "img", collapsed: !1, styles: { display: "block", marginLeft: "auto", marginRight: "auto"} }, { selector: "table", collapsed: !1, styles: { marginLeft: "auto", marginRight: "auto"}}], alignright: [{ selector: "figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li", styles: { textAlign: "right" }, defaultBlock: "div" }, { selector: "img,table", collapsed: !1, styles: { "float": "right"}}], alignjustify: [{ selector: "figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li", styles: { textAlign: "justify" }, defaultBlock: "div"}], bold: [{ inline: "strong", remove: "all" }, { inline: "span", styles: { fontWeight: "bold"} }, { inline: "b", remove: "all"}], italic: [{ inline: "em", remove: "all" }, { inline: "span", styles: { fontStyle: "italic"} }, { inline: "i", remove: "all"}], underline: [{ inline: "span", styles: { textDecoration: "underline" }, exact: !0 }, { inline: "u", remove: "all"}], strikethrough: [{ inline: "span", styles: { textDecoration: "line-through" }, exact: !0 }, { inline: "strike", remove: "all"}], forecolor: { inline: "span", styles: { color: "%value" }, links: !0, remove_similar: !0 }, hilitecolor: { inline: "span", styles: { backgroundColor: "%value" }, links: !0, remove_similar: !0 }, fontname: { inline: "span", styles: { fontFamily: "%value"} }, fontsize: { inline: "span", styles: { fontSize: "%value"} }, fontsize_class: { inline: "span", attributes: { "class": "%value"} }, blockquote: { block: "blockquote", wrapper: 1, remove: "all" }, subscript: { inline: "sub" }, superscript: { inline: "sup" }, code: { inline: "code" }, link: { inline: "a", selector: "a", remove: "all", split: !0, deep: !0, onmatch: function () { return !0 }, onformat: function (e, t, n) { at(n, function (t, n) { U.setAttrib(e, n, t) }) } }, removeformat: [{ selector: "b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q", remove: "all", split: !0, expand: !1, block_expand: !0, deep: !0 }, { selector: "span", attributes: ["style", "class"], remove: "empty", split: !0, expand: !1, deep: !0 }, { selector: "*", attributes: ["style", "class"], split: !1, expand: !1, deep: !0}] }), at("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/), function (e) { p(e, { block: e, remove: "all" }) }), p(a.settings.formats) } function d() { a.addShortcut("ctrl+b", "bold_desc", "Bold"), a.addShortcut("ctrl+i", "italic_desc", "Italic"), a.addShortcut("ctrl+u", "underline_desc", "Underline"); for (var e = 1; 6 >= e; e++) a.addShortcut("ctrl+" + e, "", ["FormatBlock", !1, "h" + e]); a.addShortcut("ctrl+7", "", ["FormatBlock", !1, "p"]), a.addShortcut("ctrl+8", "", ["FormatBlock", !1, "div"]), a.addShortcut("ctrl+9", "", ["FormatBlock", !1, "address"]) } function f(e) { return e ? V[e] : V } function p(e, t) { e && ("string" != typeof e ? at(e, function (e, t) { p(t, e) }) : (t = t.length ? t : [t], at(t, function (e) { e.deep === tt && (e.deep = !e.selector), e.split === tt && (e.split = !e.selector || e.inline), e.remove === tt && e.selector && !e.inline && (e.remove = "none"), e.selector && e.inline && (e.mixed = !0, e.block_expand = !0), "string" == typeof e.classes && (e.classes = e.classes.split(/\s+/)) }), V[e] = t)) } function h(e) { return e && V[e] && delete V[e], V } function m(e) { var t; return a.dom.getParent(e, function (e) { return t = a.dom.getStyle(e, "text-decoration"), t && "none" !== t }), t } function g(e) { var t; 1 === e.nodeType && e.parentNode && 1 === e.parentNode.nodeType && (t = m(e.parentNode), a.dom.getStyle(e, "color") && t ? a.dom.setStyle(e, "text-decoration", t) : a.dom.getStyle(e, "textdecoration") === t && a.dom.setStyle(e, "text-decoration", null)) } function v(t, n, r) { function i(e, t) { if (t = t || d, e) { if (t.onformat && t.onformat(e, t, n, r), at(t.styles, function (t, r) { U.setStyle(e, r, A(t, n)) }), t.styles) { var i = U.getAttrib(e, "style"); i && e.setAttribute("data-mce-style", i) } at(t.attributes, function (t, r) { U.setAttrib(e, r, A(t, n)) }), at(t.classes, function (t) { t = A(t, n), U.hasClass(e, t) || U.addClass(e, t) }) } } function o() { function t(t, n) { var i = new e(n); for (r = i.current(); r; r = i.prev()) if (r.childNodes.length > 1 || r == t || "BR" == r.tagName) return r } var n = a.selection.getRng(), i = n.startContainer, o = n.endContainer; if (i != o && 0 === n.endOffset) { var s = t(i, o), l = 3 == s.nodeType ? s.length : s.childNodes.length; n.setEnd(s, l) } return n } function l(e, r, o) { var a = [], l, f, p = !0; l = d.inline || d.block, f = U.create(l), i(f), q.walk(e, function (e) { function r(e) { var g, v, y, b, x; return x = p, g = e.nodeName.toLowerCase(), v = e.parentNode.nodeName.toLowerCase(), 1 === e.nodeType && nt(e) && (x = p, p = "true" === nt(e), b = !0), S(g, "br") ? (h = 0, void (d.block && U.remove(e))) : d.wrapper && C(e, t, n) ? void (h = 0) : p && !b && d.block && !d.wrapper && s(g) && j(v, l) ? (e = U.rename(e, l), i(e), a.push(e), void (h = 0)) : d.selector && (at(u, function (t) { "collapsed" in t && t.collapsed !== m || U.is(e, t.selector) && !c(e) && (i(e, t), y = !0) }), !d.inline || y) ? void (h = 0) : void (!p || b || !j(l, g) || !j(v, l) || !o && 3 === e.nodeType && 1 === e.nodeValue.length && 65279 === e.nodeValue.charCodeAt(0) || c(e) || d.inline && Y(e) ? (h = 0, at(st(e.childNodes), r), b && (p = x), h = 0) : (h || (h = U.clone(f, Q), e.parentNode.insertBefore(h, e), a.push(h)), h.appendChild(e))) } var h; at(e, r) }), d.links === !0 && at(a, function (e) { function t(e) { "A" === e.nodeName && i(e, d), at(st(e.childNodes), t) } t(e) }), at(a, function (e) { function r(e) { var t = 0; return at(e.childNodes, function (e) { B(e) || ot(e) || t++ }), t } function o(e) { var t, n; return at(e.childNodes, function (e) { return 1 != e.nodeType || ot(e) || c(e) ? void 0 : (t = e, Q) }), t && !ot(t) && k(t, d) && (n = U.clone(t, Q), i(n), U.replace(n, e, Z), U.remove(t, 1)), n || e } var s; if (s = r(e), (a.length > 1 || !Y(e)) && 0 === s) return void U.remove(e, 1); if (d.inline || d.wrapper) { if (d.exact || 1 !== s || (e = o(e)), at(u, function (t) { at(U.select(t.inline, e), function (e) { ot(e) || M(t, n, e, t.exact ? e : null) }) }), C(e.parentNode, t, n)) return U.remove(e, 1), e = 0, Z; d.merge_with_parents && U.getParent(e.parentNode, function (r) { return C(r, t, n) ? (U.remove(e, 1), e = 0, Z) : void 0 }), e && d.merge_siblings !== !1 && (e = I(O(e), e), e = I(e, O(e, Z))) } }) } var u = f(t), d = u[0], p, h, m = !r && $.isCollapsed(); if (d) if (r) r.nodeType ? (h = U.createRng(), h.setStartBefore(r), h.setEndAfter(r), l(L(h, u), null, !0)) : l(r, null, !0); else if (m && d.inline && !U.select("td.mce-item-selected,th.mce-item-selected").length) z("apply", t, n); else { var y = a.selection.getNode(); K || !u[0].defaultBlock || U.getParent(y, U.isBlock) || v(u[0].defaultBlock), a.selection.setRng(o()), p = $.getBookmark(), l(L($.getRng(Z), u), p), d.styles && (d.styles.color || d.styles.textDecoration) && (lt(y, g, "childNodes"), g(y)), $.moveToBookmark(p), W($.getRng(Z)), a.nodeChanged() } } function y(e, t, n, r) { function i(e) { var n, r, o, a, s; if (1 === e.nodeType && nt(e) && (a = y, y = "true" === nt(e), s = !0), n = st(e.childNodes), y && !s) for (r = 0, o = p.length; o > r && !M(p[r], t, e, e); r++); if (h.deep && n.length) { for (r = 0, o = n.length; o > r; r++) i(n[r]); s && (y = a) } } function o(n) { var i; return at(l(n.parentNode).reverse(), function (n) { var o; i || "_start" == n.id || "_end" == n.id || (o = C(n, e, t, r), o && o.split !== !1 && (i = n)) }), i } function s(e, n, r, i) { var o, a, s, l, c, u; if (e) { for (u = e.parentNode, o = n.parentNode; o && o != u; o = o.parentNode) { for (a = U.clone(o, Q), c = 0; c < p.length; c++) if (M(p[c], t, a, a)) { a = 0; break } a && (s && a.appendChild(s), l || (l = a), s = a) } !i || h.mixed && Y(e) || (n = U.split(e, n)), s && (r.parentNode.insertBefore(s, r), l.appendChild(r)) } return n } function c(e) { return s(o(e), e, e, !0) } function u(e) { var t = U.get(e ? "_start" : "_end"), n = t[e ? "firstChild" : "lastChild"]; return ot(n) && (n = n[e ? "firstChild" : "lastChild"]), U.remove(t, !0), n } function d(e) { var t, n, r = e.commonAncestorContainer; e = L(e, p, Z), h.split && (t = F(e, Z), n = F(e), t != n ? (/^(TR|TH|TD)$/.test(t.nodeName) && t.firstChild && (t = "TR" == t.nodeName ? t.firstChild.firstChild || t : t.firstChild || t), r && /^T(HEAD|BODY|FOOT|R)$/.test(r.nodeName) && /^(TH|TD)$/.test(n.nodeName) && n.firstChild && (n = n.firstChild || n), t = D(t, "span", { id: "_start", "data-mce-type": "bookmark" }), n = D(n, "span", { id: "_end", "data-mce-type": "bookmark" }), c(t), c(n), t = u(Z), n = u()) : t = n = c(t), e.startContainer = t.parentNode, e.startOffset = G(t), e.endContainer = n.parentNode, e.endOffset = G(n) + 1), q.walk(e, function (e) { at(e, function (e) { i(e), 1 === e.nodeType && "underline" === a.dom.getStyle(e, "text-decoration") && e.parentNode && "underline" === m(e.parentNode) && M({ deep: !1, exact: !0, inline: "span", styles: { textDecoration: "underline"} }, null, e) }) }) } var p = f(e), h = p[0], g, v, y = !0; return n ? void (n.nodeType ? (v = U.createRng(), v.setStartBefore(n), v.setEndAfter(n), d(v)) : d(n)) : void ($.isCollapsed() && h.inline && !U.select("td.mce-item-selected,th.mce-item-selected").length ? z("remove", e, t, r) : (g = $.getBookmark(), d($.getRng(Z)), $.moveToBookmark(g), h.inline && x(e, t, $.getStart()) && W($.getRng(!0)), a.nodeChanged())) } function b(e, t, n) { var r = f(e); !x(e, t, n) || "toggle" in r[0] && !r[0].toggle ? v(e, t, n) : y(e, t, n) } function C(e, t, n, r) { function i(e, t, i) { var o, a, s = t[i], l; if (t.onmatch) return t.onmatch(e, t, i); if (s) if (s.length === tt) { for (o in s) if (s.hasOwnProperty(o)) { if (a = "attributes" === i ? U.getAttrib(e, o) : T(e, o), r && !a && !t.exact) return; if ((!r || t.exact) && !S(a, R(A(s[o], n), o))) return } } else for (l = 0; l < s.length; l++) if ("attributes" === i ? U.getAttrib(e, s[l]) : T(e, s[l])) return t; return t } var o = f(t), a, s, l; if (o && e) for (s = 0; s < o.length; s++) if (a = o[s], k(e, a) && i(e, a, "attributes") && i(e, a, "styles")) { if (l = a.classes) for (s = 0; s < l.length; s++) if (!U.hasClass(e, l[s])) return; return a } } function x(e, t, n) { function r(n) { var r = U.getRoot(); return n === r ? !1 : (n = U.getParent(n, function (n) { return n.parentNode === r || !!C(n, e, t, !0) }), C(n, e, t)) } var i; return n ? r(n) : (n = $.getNode(), r(n) ? Z : (i = $.getStart(), i != n && r(i) ? Z : Q)) } function w(e, t) { var n, r = [], i = {}; return n = $.getStart(), U.getParent(n, function (n) { var o, a; for (o = 0; o < e.length; o++) a = e[o], !i[a] && C(n, a, t) && (i[a] = !0, r.push(a)) }, U.getRoot()), r } function _(e) { var t = f(e), n, r, i, o, a; if (t) for (n = $.getStart(), r = l(n), o = t.length - 1; o >= 0; o--) { if (a = t[o].selector, !a || t[o].defaultBlock) return Z; for (i = r.length - 1; i >= 0; i--) if (U.is(r[i], a)) return Z } return Q } function E(e, t, n) { var r; return et || (et = {}, r = {}, a.on("NodeChange", function (e) { var t = l(e.element), n = {}; t = i.grep(t, function (e) { return 1 == e.nodeType && !e.getAttribute("data-mce-bogus") }), at(et, function (e, i) { at(t, function (o) { return C(o, i, {}, e.similar) ? (r[i] || (at(e, function (e) { e(!0, { node: o, format: i, parents: t }) }), r[i] = e), n[i] = e, !1) : void 0 }) }), at(r, function (i, o) { n[o] || (delete r[o], at(i, function (n) { n(!1, { node: e.element, format: o, parents: t }) })) }) })), at(e.split(","), function (e) { et[e] || (et[e] = [], et[e].similar = n), et[e].push(t) }), this } function N(e) { return o.getCssText(a, e) } function k(e, t) { return S(e, t.inline) ? Z : S(e, t.block) ? Z : t.selector ? 1 == e.nodeType && U.is(e, t.selector) : void 0 } function S(e, t) { return e = e || "", t = t || "", e = "" + (e.nodeName || e), t = "" + (t.nodeName || t), e.toLowerCase() == t.toLowerCase() } function T(e, t) { return R(U.getStyle(e, t), t) } function R(e, t) { return ("color" == t || "backgroundColor" == t) && (e = U.toHex(e)), "fontWeight" == t && 700 == e && (e = "bold"), "fontFamily" == t && (e = e.replace(/[\'\"]/g, "").replace(/,\s+/g, ",")), "" + e } function A(e, t) { return "string" != typeof e ? e = e(t) : t && (e = e.replace(/%(\w+)/g, function (e, n) { return t[n] || e })), e } function B(e) { return e && 3 === e.nodeType && /^([\t \r\n]+|)$/.test(e.nodeValue) } function D(e, t, n) { var r = U.create(t, n); return e.parentNode.insertBefore(r, e), r.appendChild(e), r } function L(t, n, r) { function i(e) { function t(e) { return "BR" == e.nodeName && e.getAttribute("data-mce-bogus") && !e.nextSibling } var r, i, o, a, s; if (r = i = e ? g : y, a = e ? "previousSibling" : "nextSibling", s = U.getRoot(), 3 == r.nodeType && !B(r) && (e ? v > 0 : b < r.nodeValue.length)) return r; for (; ; ) { if (!n[0].block_expand && Y(i)) return i; for (o = i[a]; o; o = o[a]) if (!ot(o) && !B(o) && !t(o)) return i; if (i.parentNode == s) { r = i; break } i = i.parentNode } return r } function o(e, t) { for (t === tt && (t = 3 === e.nodeType ? e.length : e.childNodes.length); e && e.hasChildNodes(); ) e = e.childNodes[t], e && (t = 3 === e.nodeType ? e.length : e.childNodes.length); return { node: e, offset: t} } function c(e) { for (var t = e; t; ) { if (1 === t.nodeType && nt(t)) return "false" === nt(t) ? t : e; t = t.parentNode } return e } function u(t, n, i) { function o(e, t) { var n, o, a = e.nodeValue; return "undefined" == typeof t && (t = i ? a.length : 0), i ? (n = a.lastIndexOf(" ", t), o = a.lastIndexOf("\xa0", t), n = n > o ? n : o, -1 === n || r || n++) : (n = a.indexOf(" ", t), o = a.indexOf("\xa0", t), n = -1 !== n && (-1 === o || o > n) ? n : o), n } var s, l, c, u; if (3 === t.nodeType) { if (c = o(t, n), -1 !== c) return { container: t, offset: c }; u = t } for (s = new e(t, U.getParent(t, Y) || a.getBody()); l = s[i ? "prev" : "next"](); ) if (3 === l.nodeType) { if (u = l, c = o(l), -1 !== c) return { container: l, offset: c} } else if (Y(l)) break; return u ? (n = i ? 0 : u.length, { container: u, offset: n }) : void 0 } function d(e, r) { var i, o, a, s; for (3 == e.nodeType && 0 === e.nodeValue.length && e[r] && (e = e[r]), i = l(e), o = 0; o < i.length; o++) for (a = 0; a < n.length; a++) if (s = n[a], !("collapsed" in s && s.collapsed !== t.collapsed) && U.is(i[o], s.selector)) return i[o]; return e } function f(e, t) { var r, i = U.getRoot(); if (n[0].wrapper || (r = U.getParent(e, n[0].block, i)), r || (r = U.getParent(3 == e.nodeType ? e.parentNode : e, function (e) { return e != i && s(e) })), r && n[0].wrapper && (r = l(r, "ul,ol").reverse()[0] || r), !r) for (r = e; r[t] && !Y(r[t]) && (r = r[t], !S(r, "br")); ); return r || e } var p, h, m, g = t.startContainer, v = t.startOffset, y = t.endContainer, b = t.endOffset; if (1 == g.nodeType && g.hasChildNodes() && (p = g.childNodes.length - 1, g = g.childNodes[v > p ? p : v], 3 == g.nodeType && (v = 0)), 1 == y.nodeType && y.hasChildNodes() && (p = y.childNodes.length - 1, y = y.childNodes[b > p ? p : b - 1], 3 == y.nodeType && (b = y.nodeValue.length)), g = c(g), y = c(y), (ot(g.parentNode) || ot(g)) && (g = ot(g) ? g : g.parentNode, g = g.nextSibling || g, 3 == g.nodeType && (v = 0)), (ot(y.parentNode) || ot(y)) && (y = ot(y) ? y : y.parentNode, y = y.previousSibling || y, 3 == y.nodeType && (b = y.length)), n[0].inline && (t.collapsed && (m = u(g, v, !0), m && (g = m.container, v = m.offset), m = u(y, b), m && (y = m.container, b = m.offset)), h = o(y, b), h.node)) { for (; h.node && 0 === h.offset && h.node.previousSibling; ) h = o(h.node.previousSibling); h.node && h.offset > 0 && 3 === h.node.nodeType && " " === h.node.nodeValue.charAt(h.offset - 1) && h.offset > 1 && (y = h.node, y.splitText(h.offset - 1)) } return (n[0].inline || n[0].block_expand) && (n[0].inline && 3 == g.nodeType && 0 !== v || (g = i(!0)), n[0].inline && 3 == y.nodeType && b !== y.nodeValue.length || (y = i())), n[0].selector && n[0].expand !== Q && !n[0].inline && (g = d(g, "previousSibling"), y = d(y, "nextSibling")), (n[0].block || n[0].selector) && (g = f(g, "previousSibling"), y = f(y, "nextSibling"), n[0].block && (Y(g) || (g = i(!0)), Y(y) || (y = i()))), 1 == g.nodeType && (v = G(g), g = g.parentNode), 1 == y.nodeType && (b = G(y) + 1, y = y.parentNode), { startContainer: g, startOffset: v, endContainer: y, endOffset: b} } function H(e, t) { return t.links && "A" == e.tagName } function M(e, t, n, r) { var i, o, a; if (!k(n, e) && !H(n, e)) return Q; if ("all" != e.remove) for (at(e.styles, function (i, o) { i = R(A(i, t), o), "number" == typeof o && (o = i, r = 0), (e.remove_similar || !r || S(T(r, o), i)) && U.setStyle(n, o, ""), a = 1 }), a && "" === U.getAttrib(n, "style") && (n.removeAttribute("style"), n.removeAttribute("data-mce-style")), at(e.attributes, function (e, i) { var o; if (e = A(e, t), "number" == typeof i && (i = e, r = 0), !r || S(U.getAttrib(r, i), e)) { if ("class" == i && (e = U.getAttrib(n, i), e && (o = "", at(e.split(/\s+/), function (e) { /mce\w+/.test(e) && (o += (o ? " " : "") + e) }), o))) return void U.setAttrib(n, i, o); "class" == i && n.removeAttribute("className"), J.test(i) && n.removeAttribute("data-mce-" + i), n.removeAttribute(i) } }), at(e.classes, function (e) { e = A(e, t), (!r || U.hasClass(r, e)) && U.removeClass(n, e) }), o = U.getAttribs(n), i = 0; i < o.length; i++) if (0 !== o[i].nodeName.indexOf("_")) return Q; return "none" != e.remove ? (P(n, e), Z) : void 0 } function P(e, t) { function n(e, t, n) { return e = O(e, t, n), !e || "BR" == e.nodeName || Y(e) } var r = e.parentNode, i; t.block && (K ? r == U.getRoot() && (t.list_block && S(e, t.list_block) || at(st(e.childNodes), function (e) { j(K, e.nodeName.toLowerCase()) ? i ? i.appendChild(e) : (i = D(e, K), U.setAttribs(i, a.settings.forced_root_block_attrs)) : i = 0 })) : Y(e) && !Y(r) && (n(e, Q) || n(e.firstChild, Z, 1) || e.insertBefore(U.create("br"), e.firstChild), n(e, Z) || n(e.lastChild, Q, 1) || e.appendChild(U.create("br")))), t.selector && t.inline && !S(t.inline, e) || U.remove(e, 1) } function O(e, t, n) { if (e) for (t = t ? "nextSibling" : "previousSibling", e = n ? e : e[t]; e; e = e[t]) if (1 == e.nodeType || !B(e)) return e } function I(e, t) { function n(e, t) { for (i = e; i; i = i[t]) { if (3 == i.nodeType && 0 !== i.nodeValue.length) return e; if (1 == i.nodeType && !ot(i)) return i } return e } var i, o, a = new r(U); if (e && t && (e = n(e, "previousSibling"), t = n(t, "nextSibling"), a.compare(e, t))) { for (i = e.nextSibling; i && i != t; ) o = i, i = i.nextSibling, e.appendChild(o); return U.remove(t), at(st(t.childNodes), function (t) { e.appendChild(t) }), e } return t } function F(t, n) { var r, i, o; return r = t[n ? "startContainer" : "endContainer"], i = t[n ? "startOffset" : "endOffset"], 1 == r.nodeType && (o = r.childNodes.length - 1, !n && i && i--, r = r.childNodes[i > o ? o : i]), 3 === r.nodeType && n && i >= r.nodeValue.length && (r = new e(r, a.getBody()).next() || r), 3 !== r.nodeType || n || 0 !== i || (r = new e(r, a.getBody()).prev() || r), r } function z(t, n, r, i) { function o(e) { var t = U.create("span", { id: g, "data-mce-bogus": !0, style: b ? "color:red" : "" }); return e && t.appendChild(a.getDoc().createTextNode(X)), t } function l(e, t) { for (; e; ) { if (3 === e.nodeType && e.nodeValue !== X || e.childNodes.length > 1) return !1; t && 1 === e.nodeType && t.push(e), e = e.firstChild } return !0 } function c(e) { for (; e; ) { if (e.id === g) return e; e = e.parentNode } } function u(t) { var n; if (t) for (n = new e(t, t), t = n.current(); t; t = n.next()) if (3 === t.nodeType) return t } function d(e, t) { var n, r; if (e) r = $.getRng(!0), l(e) ? (t !== !1 && (r.setStartBefore(e), r.setEndBefore(e)), U.remove(e)) : (n = u(e), n.nodeValue.charAt(0) === X && (n.deleteData(0, 1), r.startContainer == n && r.startOffset > 0 && r.setStart(n, r.startOffset - 1), r.endContainer == n && r.endOffset > 0 && r.setEnd(n, r.endOffset - 1)), U.remove(e, 1)), $.setRng(r); else if (e = c($.getStart()), !e) for (; e = U.get(g); ) d(e, !1) } function p() { var e, t, i, a, s, l, d; e = $.getRng(!0), a = e.startOffset, l = e.startContainer, d = l.nodeValue, t = c($.getStart()), t && (i = u(t)), d && a > 0 && a < d.length && /\w/.test(d.charAt(a)) && /\w/.test(d.charAt(a - 1)) ? (s = $.getBookmark(), e.collapse(!0), e = L(e, f(n)), e = q.split(e), v(n, r, e), $.moveToBookmark(s)) : (t && i.nodeValue === X ? v(n, r, t) : (t = o(!0), i = t.firstChild, e.insertNode(t), a = 1, v(n, r, t)), $.setCursorLocation(i, a)) } function h() { var e = $.getRng(!0), t, a, l, c, u, d, p = [], h, m; for (t = e.startContainer, a = e.startOffset, u = t, 3 == t.nodeType && (a != t.nodeValue.length && (c = !0), u = u.parentNode); u; ) { if (C(u, n, r, i)) { d = u; break } u.nextSibling && (c = !0), p.push(u), u = u.parentNode } if (d) if (c) l = $.getBookmark(), e.collapse(!0), e = L(e, f(n), !0), e = q.split(e), y(n, r, e), $.moveToBookmark(l); else { for (m = o(), u = m, h = p.length - 1; h >= 0; h--) u.appendChild(U.clone(p[h], !1)), u = u.firstChild; u.appendChild(U.doc.createTextNode(X)), u = u.firstChild; var g = U.getParent(d, s); g && U.isEmpty(g) ? d.parentNode.replaceChild(m, d) : U.insertAfter(m, d), $.setCursorLocation(u, 1), U.isEmpty(d) && U.remove(d) } } function m() { var e; e = c($.getStart()), e && !U.isEmpty(e) && lt(e, function (e) { 1 != e.nodeType || e.id === g || U.isEmpty(e) || U.setAttrib(e, "data-mce-bogus", null) }, "childNodes") } var g = "_mce_caret", b = a.settings.caret_debug; a._hasCaretEvents || (it = function () { var e = [], t; if (l(c($.getStart()), e)) for (t = e.length; t--; ) U.setAttrib(e[t], "data-mce-bogus", "1") }, rt = function (e) { var t = e.keyCode; d(), (8 == t || 37 == t || 39 == t) && d(c($.getStart())), m() }, a.on("SetContent", function (e) { e.selection && m() }), a._hasCaretEvents = !0), "apply" == t ? p() : h() } function W(t) { var n = t.startContainer, r = t.startOffset, i, o, a, s, l; if (3 == n.nodeType && r >= n.nodeValue.length && (r = G(n), n = n.parentNode, i = !0), 1 == n.nodeType) for (s = n.childNodes, n = s[Math.min(r, s.length - 1)], o = new e(n, U.getParent(n, U.isBlock)), (r > s.length - 1 || i) && o.next(), a = o.current(); a; a = o.next()) if (3 == a.nodeType && !B(a)) return l = U.create("a", { "data-mce-bogus": "all" }, X), a.parentNode.insertBefore(l, a), t.setStart(a, 0), $.setRng(t), void U.remove(l) } var V = {}, U = a.dom, $ = a.selection, q = new t(U), j = a.schema.isValidChild, Y = U.isBlock, K = a.settings.forced_root_block, G = U.nodeIndex, X = "\ufeff", J = /^(src|href|style)$/, Q = !1, Z = !0, et, tt, nt = U.getContentEditable, rt, it, ot = n.isBookmarkNode, at = i.each, st = i.grep, lt = i.walk, ct = i.extend; ct(this, { get: f, register: p, unregister: h, apply: v, remove: y, toggle: b, match: x, matchAll: w, matchNode: C, canApply: _, formatChanged: E, getCssText: N }), u(), d(), a.on("BeforeGetContent", function (e) { it && "raw" != e.format && it() }), a.on("mouseup keydown", function (e) { rt && rt(e) }) } }), r(I, [d, u, N], function (e, t, n) { var r = t.trim, i; return i = new RegExp(["<span[^>]+data-mce-bogus[^>]+>[\u200b\ufeff]+<\\/span>", '\\s?data-mce-selected="[^"]+"'].join("|"), "gi"), function (t) { function o() { var e = t.getContent({ format: "raw", no_events: 1 }), o = /<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g, a, s, l, c, u, d = t.schema; for (e = e.replace(i, ""), u = d.getShortEndedElements(); c = o.exec(e); ) s = o.lastIndex, l = c[0].length, a = u[c[1]] ? s : n.findEndTag(d, e, s), e = e.substring(0, s - l) + e.substring(a), o.lastIndex = s - l; return r(e) } function a(e) { s.typing = !1, s.add({}, e) } var s = this, l = 0, c = [], u, d, f = 0; return t.on("init", function () { s.add() }), t.on("BeforeExecCommand", function (e) { var t = e.command; "Undo" != t && "Redo" != t && "mceRepaint" != t && s.beforeChange() }), t.on("ExecCommand", function (e) { var t = e.command; "Undo" != t && "Redo" != t && "mceRepaint" != t && a(e) }), t.on("ObjectResizeStart", function () { s.beforeChange() }), t.on("SaveContent ObjectResized blur", a), t.on("DragEnd", a), t.on("KeyUp", function (n) { var r = n.keyCode; (r >= 33 && 36 >= r || r >= 37 && 40 >= r || 45 == r || 13 == r || n.ctrlKey) && (a(), t.nodeChanged()), (46 == r || 8 == r || e.mac && (91 == r || 93 == r)) && t.nodeChanged(), d && s.typing && (t.isDirty() || (t.isNotDirty = !c[0] || o() == c[0].content, t.isNotDirty || t.fire("change", { level: c[0], lastLevel: null })), t.fire("TypingUndo"), d = !1, t.nodeChanged()) }), t.on("KeyDown", function (e) { var t = e.keyCode; return t >= 33 && 36 >= t || t >= 37 && 40 >= t || 45 == t ? void (s.typing && a(e)) : void ((16 > t || t > 20) && 224 != t && 91 != t && !s.typing && (s.beforeChange(), s.typing = !0, s.add({}, e), d = !0)) }), t.on("MouseDown", function (e) { s.typing && a(e) }), t.addShortcut("ctrl+z", "", "Undo"), t.addShortcut("ctrl+y,ctrl+shift+z", "", "Redo"), t.on("AddUndo Undo Redo ClearUndos", function (e) { e.isDefaultPrevented() || t.nodeChanged() }), s = { data: c, typing: !1, beforeChange: function () { f || (u = t.selection.getBookmark(2, !0)) }, add: function (e, n) { var r, i = t.settings, a; if (e = e || {}, e.content = o(), f || t.removed) return null; if (a = c[l], t.fire("BeforeAddUndo", { level: e, lastLevel: a, originalEvent: n }).isDefaultPrevented()) return null; if (a && a.content == e.content) return null; if (c[l] && (c[l].beforeBookmark = u), i.custom_undo_redo_levels && c.length > i.custom_undo_redo_levels) { for (r = 0; r < c.length - 1; r++) c[r] = c[r + 1]; c.length--, l = c.length } e.bookmark = t.selection.getBookmark(2, !0), l < c.length - 1 && (c.length = l + 1), c.push(e), l = c.length - 1; var s = { level: e, lastLevel: a, originalEvent: n }; return t.fire("AddUndo", s), l > 0 && (t.isNotDirty = !1, t.fire("change", s)), e }, undo: function () { var e; return s.typing && (s.add(), s.typing = !1), l > 0 && (e = c[--l], 0 === l && (t.isNotDirty = !0), t.setContent(e.content, { format: "raw" }), t.selection.moveToBookmark(e.beforeBookmark), t.fire("undo", { level: e })), e }, redo: function () { var e; return l < c.length - 1 && (e = c[++l], t.setContent(e.content, { format: "raw" }), t.selection.moveToBookmark(e.bookmark), t.fire("redo", { level: e })), e }, clear: function () { c = [], l = 0, s.typing = !1, t.fire("ClearUndos") }, hasUndo: function () { return l > 0 || s.typing && c[0] && o() != c[0].content }, hasRedo: function () { return l < c.length - 1 && !this.typing }, transact: function (e) { s.beforeChange(); try { f++, e() } finally { f-- } s.add() } } } }), r(F, [h, x, d], function (e, t, n) { var r = n.ie && n.ie < 11; return function (i) { function o(o) { function f(e) { return e && a.isBlock(e) && !/^(TD|TH|CAPTION|FORM)$/.test(e.nodeName) && !/^(fixed|absolute)/i.test(e.style.position) && "true" !== a.getContentEditable(e) } function p(e) { var t; a.isBlock(e) && (t = s.getRng(), e.appendChild(a.create("span", null, "\xa0")), s.select(e), e.lastChild.outerHTML = "", s.setRng(t)) } function h(e) { var t = e, n = [], r; if (t) { for (; t = t.firstChild; ) { if (a.isBlock(t)) return; 1 != t.nodeType || d[t.nodeName.toLowerCase()] || n.push(t) } for (r = n.length; r--; ) t = n[r], !t.hasChildNodes() || t.firstChild == t.lastChild && "" === t.firstChild.nodeValue ? a.remove(t) : "A" == t.nodeName && " " === (t.innerText || t.textContent) && a.remove(t) } } function m(t) { function r(e) { for (; e; ) { if (1 == e.nodeType || 3 == e.nodeType && e.data && /[\r\n\s]/.test(e.data)) return e; e = e.nextSibling } } var i, o, l, c = t, u; if (t) { if (n.ie && n.ie < 9 && A && A.firstChild && A.firstChild == A.lastChild && "BR" == A.firstChild.tagName && a.remove(A.firstChild), /^(LI|DT|DD)$/.test(t.nodeName)) { var f = r(t.firstChild); f && /^(UL|OL|DL)$/.test(f.nodeName) && t.insertBefore(a.doc.createTextNode("\xa0"), t.firstChild) } if (l = a.createRng(), n.ie || t.normalize(), t.hasChildNodes()) { for (i = new e(t, t); o = i.current(); ) { if (3 == o.nodeType) { l.setStart(o, 0), l.setEnd(o, 0); break } if (d[o.nodeName.toLowerCase()]) { l.setStartBefore(o), l.setEndBefore(o); break } c = o, o = i.next() } o || (l.setStart(c, 0), l.setEnd(c, 0)) } else "BR" == t.nodeName ? t.nextSibling && a.isBlock(t.nextSibling) ? ((!B || 9 > B) && (u = a.create("br"), t.parentNode.insertBefore(u, t)), l.setStartBefore(t), l.setEndBefore(t)) : (l.setStartAfter(t), l.setEndAfter(t)) : (l.setStart(t, 0), l.setEnd(t, 0)); s.setRng(l), a.remove(u), s.scrollIntoView(t) } } function g(e) { var t = l.forced_root_block; t && t.toLowerCase() === e.tagName.toLowerCase() && a.setAttribs(e, l.forced_root_block_attrs) } function v(e) { var t = T, n, i, o, s = u.getTextInlineElements(); if (e || "TABLE" == P ? (n = a.create(e || I), g(n)) : n = A.cloneNode(!1), o = n, l.keep_styles !== !1) do if (s[t.nodeName]) { if ("_mce_caret" == t.id) continue; i = t.cloneNode(!1), a.setAttrib(i, "id", ""), n.hasChildNodes() ? (i.appendChild(n.firstChild), n.appendChild(i)) : (o = i, n.appendChild(i)) } while (t = t.parentNode); return r || (o.innerHTML = '<br data-mce-bogus="1">'), n } function y(t) { var n, r, i; if (3 == T.nodeType && (t ? R > 0 : R < T.nodeValue.length)) return !1; if (T.parentNode == A && F && !t) return !0; if (t && 1 == T.nodeType && T == A.firstChild) return !0; if ("TABLE" === T.nodeName || T.previousSibling && "TABLE" == T.previousSibling.nodeName) return F && !t || !F && t; for (n = new e(T, A), 3 == T.nodeType && (t && 0 === R ? n.prev() : t || R != T.nodeValue.length || n.next()); r = n.current(); ) { if (1 === r.nodeType) { if (!r.getAttribute("data-mce-bogus") && (i = r.nodeName.toLowerCase(), d[i] && "br" !== i)) return !1 } else if (3 === r.nodeType && !/^[ \t\r\n]*$/.test(r.nodeValue)) return !1; t ? n.prev() : n.next() } return !0 } function b(e, t) { var n, r, o, s, l, c, d = I || "P"; if (r = a.getParent(e, a.isBlock), c = i.getBody().nodeName.toLowerCase(), !r || !f(r)) { if (r = r || S, !r.hasChildNodes()) return n = a.create(d), g(n), r.appendChild(n), N.setStart(n, 0), N.setEnd(n, 0), n; for (s = e; s.parentNode != r; ) s = s.parentNode; for (; s && !a.isBlock(s); ) o = s, s = s.previousSibling; if (o && u.isValidChild(c, d.toLowerCase())) { for (n = a.create(d), g(n), o.parentNode.insertBefore(n, o), s = o; s && !a.isBlock(s); ) l = s.nextSibling, n.appendChild(s), s = l; N.setStart(e, t), N.setEnd(e, t) } } return e } function C() { function e(e) { for (var t = M[e ? "firstChild" : "lastChild"]; t && 1 != t.nodeType; ) t = t[e ? "nextSibling" : "previousSibling"]; return t === A } function t() { var e = M.parentNode; return /^(LI|DT|DD)$/.test(e.nodeName) ? e : M } var n = M.parentNode.nodeName; /^(OL|UL|LI)$/.test(n) && (I = "LI"), L = I ? v(I) : a.create("BR"), e(!0) && e() ? "LI" == n ? a.insertAfter(L, t()) : a.replace(L, M) : e(!0) ? "LI" == n ? (a.insertAfter(L, t()), L.appendChild(a.doc.createTextNode(" ")), L.appendChild(M)) : M.parentNode.insertBefore(L, M) : e() ? (a.insertAfter(L, t()), p(L)) : (M = t(), k = N.cloneRange(), k.setStartAfter(A), k.setEndAfter(M), H = k.extractContents(), "LI" == I && "LI" == H.firstChild.nodeName ? (L = H.firstChild, a.insertAfter(H, M)) : (a.insertAfter(H, M), a.insertAfter(L, M))), a.remove(A), m(L), c.add() } function x() { i.execCommand("InsertLineBreak", !1, o) } function w(e) { do 3 === e.nodeType && (e.nodeValue = e.nodeValue.replace(/^[\r\n]+/, "")), e = e.firstChild; while (e) } function _(e) { var t = a.getRoot(), n, r; for (n = e; n !== t && "false" !== a.getContentEditable(n); ) "true" === a.getContentEditable(n) && (r = n), n = n.parentNode; return n !== t ? r : t } function E(e) { var t; r || (e.normalize(), t = e.lastChild, (!t || /^(left|right)$/gi.test(a.getStyle(t, "float", !0))) && a.add(e, "br")) } var N, k, S, T, R, A, B, D, L, H, M, P, O, I, F; if (N = s.getRng(!0), !o.isDefaultPrevented()) { if (!N.collapsed) return void i.execCommand("Delete"); if (new t(a).normalize(N), T = N.startContainer, R = N.startOffset, I = (l.force_p_newlines ? "p" : "") || l.forced_root_block, I = I ? I.toUpperCase() : "", B = a.doc.documentMode, D = o.shiftKey, 1 == T.nodeType && T.hasChildNodes() && (F = R > T.childNodes.length - 1, T = T.childNodes[Math.min(R, T.childNodes.length - 1)] || T, R = F && 3 == T.nodeType ? T.nodeValue.length : 0), S = _(T)) { if (c.beforeChange(), !a.isBlock(S) && S != a.getRoot()) return void ((!I || D) && x()); if ((I && !D || !I && D) && (T = b(T, R)), A = a.getParent(T, a.isBlock), M = A ? a.getParent(A.parentNode, a.isBlock) : null, P = A ? A.nodeName.toUpperCase() : "", O = M ? M.nodeName.toUpperCase() : "", "LI" != O || o.ctrlKey || (A = M, P = O), /^(LI|DT|DD)$/.test(P)) { if (!I && D) return void x(); if (a.isEmpty(A)) return void C() } if ("PRE" == P && l.br_in_pre !== !1) { if (!D) return void x() } else if (!I && !D && "LI" != P || I && D) return void x(); I && A === i.getBody() || (I = I || "P", y() ? (L = /^(H[1-6]|PRE|FIGURE)$/.test(P) && "HGROUP" != O ? v(I) : v(), l.end_container_on_empty_block && f(M) && a.isEmpty(A) ? L = a.split(M, A) : a.insertAfter(L, A), m(L)) : y(!0) ? (L = A.parentNode.insertBefore(v(), A), p(L), m(A)) : (k = N.cloneRange(), k.setEndAfter(A), H = k.extractContents(), w(H), L = H.firstChild, a.insertAfter(H, A), h(L), E(A), m(L)), a.setAttrib(L, "id", ""), i.fire("NewBlock", { newBlock: L }), c.add()) } } } var a = i.dom, s = i.selection, l = i.settings, c = i.undoManager, u = i.schema, d = u.getNonEmptyElements(); i.on("keydown", function (e) { 13 == e.keyCode && o(e) !== !1 && e.preventDefault() }) } }), r(z, [], function () { return function (e) { function t() { var t = i.getStart(), s = e.getBody(), l, c, u, d, f, p, h, m = -16777215, g, v, y, b, C; if (C = n.forced_root_block, t && 1 === t.nodeType && C) { for (; t && t != s; ) { if (a[t.nodeName]) return; t = t.parentNode } if (l = i.getRng(), l.setStart) { c = l.startContainer, u = l.startOffset, d = l.endContainer, f = l.endOffset; try { v = e.getDoc().activeElement === s } catch (x) { } } else l.item && (t = l.item(0), l = e.getDoc().body.createTextRange(), l.moveToElementText(t)), v = l.parentElement().ownerDocument === e.getDoc(), y = l.duplicate(), y.collapse(!0), u = -1 * y.move("character", m), y.collapsed || (y = l.duplicate(), y.collapse(!1), f = -1 * y.move("character", m) - u); for (t = s.firstChild, b = s.nodeName.toLowerCase(); t; ) if ((3 === t.nodeType || 1 == t.nodeType && !a[t.nodeName]) && o.isValidChild(b, C.toLowerCase())) { if (3 === t.nodeType && 0 === t.nodeValue.length) { h = t, t = t.nextSibling, r.remove(h); continue } p || (p = r.create(C, e.settings.forced_root_block_attrs), t.parentNode.insertBefore(p, t), g = !0), h = t, t = t.nextSibling, p.appendChild(h) } else p = null, t = t.nextSibling; if (g && v) { if (l.setStart) l.setStart(c, u), l.setEnd(d, f), i.setRng(l); else try { l = e.getDoc().body.createTextRange(), l.moveToElementText(s), l.collapse(!0), l.moveStart("character", u), f > 0 && l.moveEnd("character", f), l.select() } catch (x) { } e.nodeChanged() } } } var n = e.settings, r = e.dom, i = e.selection, o = e.schema, a = o.getBlockElements(); n.forced_root_block && e.on("NodeChange", t) } }), r(W, [T, d, u, M, x, h], function (e, n, r, i, o, a) { var s = r.each, l = r.extend, c = r.map, u = r.inArray, d = r.explode, f = n.gecko, p = n.ie, h = n.ie && n.ie < 11, m = !0, g = !1; return function (r) { function v(e, t, n) { var r; return e = e.toLowerCase(), (r = T.exec[e]) ? (r(e, t, n), m) : g } function y(e) { var t; return e = e.toLowerCase(), (t = T.state[e]) ? t(e) : -1 } function b(e) { var t; return e = e.toLowerCase(), (t = T.value[e]) ? t(e) : g } function C(e, t) { t = t || "exec", s(e, function (e, n) { s(n.toLowerCase().split(","), function (n) { T[t][n] = e }) }) } function x(e, n, i) { return n === t && (n = g), i === t && (i = null), r.getDoc().execCommand(e, n, i) } function w(e) { return A.match(e) } function _(e, n) { A.toggle(e, n ? { value: n} : t), r.nodeChanged() } function E(e) { B = S.getBookmark(e) } function N() { S.moveToBookmark(B) } var k = r.dom, S = r.selection, T = { state: {}, exec: {}, value: {} }, R = r.settings, A = r.formatter, B; l(this, { execCommand: v, queryCommandState: y, queryCommandValue: b, addCommands: C }), C({ "mceResetDesignMode,mceBeginUndoLevel": function () { }, "mceEndUndoLevel,mceAddUndoLevel": function () { r.undoManager.add() }, "Cut,Copy,Paste": function (e) { var t = r.getDoc(), i; try { x(e) } catch (o) { i = m } if (i || !t.queryCommandSupported(e)) { var a = r.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead."); n.mac && (a = a.replace(/Ctrl\+/g, "\u2318+")), r.windowManager.alert(a) } }, unlink: function () { if (S.isCollapsed()) { var e = S.getNode(); return void ("A" == e.tagName && r.dom.remove(e, !0)) } A.remove("link") }, "JustifyLeft,JustifyCenter,JustifyRight,JustifyFull": function (e) { var t = e.substring(7); "full" == t && (t = "justify"), s("left,center,right,justify".split(","), function (e) { t != e && A.remove("align" + e) }), _("align" + t), v("mceRepaint") }, "InsertUnorderedList,InsertOrderedList": function (e) { var t, n; x(e), t = k.getParent(S.getNode(), "ol,ul"), t && (n = t.parentNode, /^(H[1-6]|P|ADDRESS|PRE)$/.test(n.nodeName) && (E(), k.split(n, t), N())) }, "Bold,Italic,Underline,Strikethrough,Superscript,Subscript": function (e) { _(e) }, "ForeColor,HiliteColor,FontName": function (e, t, n) { _(e, n) }, FontSize: function (e, t, n) { var r, i; n >= 1 && 7 >= n && (i = d(R.font_size_style_values), r = d(R.font_size_classes), n = r ? r[n - 1] || n : i[n - 1] || n), _(e, n) }, RemoveFormat: function (e) { A.remove(e) }, mceBlockQuote: function () { _("blockquote") }, FormatBlock: function (e, t, n) { return _(n || "p") }, mceCleanup: function () { var e = S.getBookmark(); r.setContent(r.getContent({ cleanup: m }), { cleanup: m }), S.moveToBookmark(e) }, mceRemoveNode: function (e, t, n) { var i = n || S.getNode(); i != r.getBody() && (E(), r.dom.remove(i, m), N()) }, mceSelectNodeDepth: function (e, t, n) { var i = 0; k.getParent(S.getNode(), function (e) { return 1 == e.nodeType && i++ == n ? (S.select(e), g) : void 0 }, r.getBody()) }, mceSelectNode: function (e, t, n) { S.select(n) }, mceInsertContent: function (t, n, o) { function a(e) { function t(e) { return r[e] && 3 == r[e].nodeType } var n, r, i; return n = S.getRng(!0), r = n.startContainer, i = n.startOffset, 3 == r.nodeType && (i > 0 ? e = e.replace(/^&nbsp;/, " ") : t("previousSibling") || (e = e.replace(/^ /, "&nbsp;")), i < r.length ? e = e.replace(/&nbsp;(<br>|)$/, " ") : t("nextSibling") || (e = e.replace(/(&nbsp;| )(<br>|)$/, "&nbsp;"))), e } function l(e) { if (w) for (b = e.firstChild; b; b = b.walk(!0)) _[b.name] && b.attr("data-mce-new", "true") } function c() { if (w) { var e = r.getBody(), t = new i(k); s(k.select("*[data-mce-new]"), function (n) { n.removeAttribute("data-mce-new"); for (var r = n.parentNode; r && r != e; r = r.parentNode) t.compare(r, n) && k.remove(n, !0) }) } } var u, d, f, h, m, g, v, y, b, C, x, w, _ = r.schema.getTextInlineElements(); "string" != typeof o && (w = o.merge, o = o.content), /^ | $/.test(o) && (o = a(o)), u = r.parser, d = new e({}, r.schema), x = '<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>', g = { content: o, format: "html", selection: !0 }, r.fire("BeforeSetContent", g), o = g.content, -1 == o.indexOf("{$caret}") && (o += "{$caret}"), o = o.replace(/\{\$caret\}/, x), y = S.getRng(); var E = y.startContainer || (y.parentElement ? y.parentElement() : null), N = r.getBody(); E === N && S.isCollapsed() && k.isBlock(N.firstChild) && k.isEmpty(N.firstChild) && (y = k.createRng(), y.setStart(N.firstChild, 0), y.setEnd(N.firstChild, 0), S.setRng(y)), S.isCollapsed() || r.getDoc().execCommand("Delete", !1, null), f = S.getNode(); var T = { context: f.nodeName.toLowerCase() }; if (m = u.parse(o, T), l(m), b = m.lastChild, "mce_marker" == b.attr("id")) for (v = b, b = b.prev; b; b = b.walk(!0)) if (3 == b.type || !k.isBlock(b.name)) { r.schema.isValidChild(b.parent.name, "span") && b.parent.insert(v, b, "br" === b.name); break } if (T.invalid) { for (S.setContent(x), f = S.getNode(), h = r.getBody(), 9 == f.nodeType ? f = b = h : b = f; b !== h; ) f = b, b = b.parentNode; o = f == h ? h.innerHTML : k.getOuterHTML(f), o = d.serialize(u.parse(o.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i, function () { return d.serialize(m) }))), f == h ? k.setHTML(h, o) : k.setOuterHTML(f, o) } else o = d.serialize(m), b = f.firstChild, C = f.lastChild, !b || b === C && "BR" === b.nodeName ? k.setHTML(f, o) : S.setContent(o); c(), v = k.get("mce_marker"), S.scrollIntoView(v), y = k.createRng(), b = v.previousSibling, b && 3 == b.nodeType ? (y.setStart(b, b.nodeValue.length), p || (C = v.nextSibling, C && 3 == C.nodeType && (b.appendData(C.data), C.parentNode.removeChild(C)))) : (y.setStartBefore(v), y.setEndBefore(v)), k.remove(v), S.setRng(y), r.fire("SetContent", g), r.addVisual() }, mceInsertRawHTML: function (e, t, n) { S.setContent("tiny_mce_marker"), r.setContent(r.getContent().replace(/tiny_mce_marker/g, function () { return n })) }, mceToggleFormat: function (e, t, n) { _(n) }, mceSetContent: function (e, t, n) { r.setContent(n) }, "Indent,Outdent": function (e) { var t, n, i; t = R.indentation, n = /[a-z%]+$/i.exec(t), t = parseInt(t, 10), y("InsertUnorderedList") || y("InsertOrderedList") ? x(e) : (R.forced_root_block || k.getParent(S.getNode(), k.isBlock) || A.apply("div"), s(S.getSelectedBlocks(), function (o) { if ("LI" != o.nodeName) { var a = r.getParam("indent_use_margin", !1) ? "margin" : "padding"; a += "rtl" == k.getStyle(o, "direction", !0) ? "Right" : "Left", "outdent" == e ? (i = Math.max(0, parseInt(o.style[a] || 0, 10) - t), k.setStyle(o, a, i ? i + n : "")) : (i = parseInt(o.style[a] || 0, 10) + t + n, k.setStyle(o, a, i)) } })) }, mceRepaint: function () { if (f) try { E(m), S.getSel() && S.getSel().selectAllChildren(r.getBody()), S.collapse(m), N() } catch (e) { } }, InsertHorizontalRule: function () { r.execCommand("mceInsertContent", !1, "<hr />") }, mceToggleVisualAid: function () { r.hasVisual = !r.hasVisual, r.addVisual() }, mceReplaceContent: function (e, t, n) { r.execCommand("mceInsertContent", !1, n.replace(/\{\$selection\}/g, S.getContent({ format: "text" }))) }, mceInsertLink: function (e, t, n) { var r; "string" == typeof n && (n = { href: n }), r = k.getParent(S.getNode(), "a"), n.href = n.href.replace(" ", "%20"), r && n.href || A.remove("link"), n.href && A.apply("link", n, r) }, selectAll: function () { var e = k.getRoot(), t; S.getRng().setStart ? (t = k.createRng(), t.setStart(e, 0), t.setEnd(e, e.childNodes.length), S.setRng(t)) : (t = S.getRng(), t.item || (t.moveToElementText(e), t.select())) }, "delete": function () { x("Delete"); var e = r.getBody(); k.isEmpty(e) && (r.setContent(""), e.firstChild && k.isBlock(e.firstChild) ? r.selection.setCursorLocation(e.firstChild, 0) : r.selection.setCursorLocation(e, 0)) }, mceNewDocument: function () { r.setContent("") }, InsertLineBreak: function (e, t, n) { function i() { for (var e = new a(p, v), t, n = r.schema.getNonEmptyElements(); t = e.next(); ) if (n[t.nodeName.toLowerCase()] || t.length > 0) return !0 } var s = n, l, c, u, d = S.getRng(!0); new o(k).normalize(d); var f = d.startOffset, p = d.startContainer; if (1 == p.nodeType && p.hasChildNodes()) { var g = f > p.childNodes.length - 1; p = p.childNodes[Math.min(f, p.childNodes.length - 1)] || p, f = g && 3 == p.nodeType ? p.nodeValue.length : 0 } var v = k.getParent(p, k.isBlock), y = v ? v.nodeName.toUpperCase() : "", b = v ? k.getParent(v.parentNode, k.isBlock) : null, C = b ? b.nodeName.toUpperCase() : "", x = s && s.ctrlKey; "LI" != C || x || (v = b, y = C), p && 3 == p.nodeType && f >= p.nodeValue.length && (h || i() || (l = k.create("br"), d.insertNode(l), d.setStartAfter(l), d.setEndAfter(l), c = !0)), l = k.create("br"), d.insertNode(l); var w = k.doc.documentMode; return h && "PRE" == y && (!w || 8 > w) && l.parentNode.insertBefore(k.doc.createTextNode("\r"), l), u = k.create("span", {}, "&nbsp;"), l.parentNode.insertBefore(u, l), S.scrollIntoView(u), k.remove(u), c ? (d.setStartBefore(l), d.setEndBefore(l)) : (d.setStartAfter(l), d.setEndAfter(l)), S.setRng(d), r.undoManager.add(), m } }), C({ "JustifyLeft,JustifyCenter,JustifyRight,JustifyFull": function (e) { var t = "align" + e.substring(7), n = S.isCollapsed() ? [k.getParent(S.getNode(), k.isBlock)] : S.getSelectedBlocks(), r = c(n, function (e) { return !!A.matchNode(e, t) }); return -1 !== u(r, m) }, "Bold,Italic,Underline,Strikethrough,Superscript,Subscript": function (e) { return w(e) }, mceBlockQuote: function () { return w("blockquote") }, Outdent: function () { var e; if (R.inline_styles) { if ((e = k.getParent(S.getStart(), k.isBlock)) && parseInt(e.style.paddingLeft, 10) > 0) return m; if ((e = k.getParent(S.getEnd(), k.isBlock)) && parseInt(e.style.paddingLeft, 10) > 0) return m } return y("InsertUnorderedList") || y("InsertOrderedList") || !R.inline_styles && !!k.getParent(S.getNode(), "BLOCKQUOTE") }, "InsertUnorderedList,InsertOrderedList": function (e) { var t = k.getParent(S.getNode(), "ul,ol"); return t && ("insertunorderedlist" === e && "UL" === t.tagName || "insertorderedlist" === e && "OL" === t.tagName) } }, "state"), C({ "FontSize,FontName": function (e) { var t = 0, n; return (n = k.getParent(S.getNode(), "span")) && (t = "fontsize" == e ? n.style.fontSize : n.style.fontFamily.replace(/, /g, ",").replace(/[\'\"]/g, "").toLowerCase()), t } }, "value"), C({ Undo: function () { r.undoManager.undo() }, Redo: function () { r.undoManager.redo() } }) } }), r(V, [u], function (e) { function t(e, o) { var a = this, s, l; if (e = r(e), o = a.settings = o || {}, s = o.base_uri, /^([\w\-]+):([^\/]{2})/i.test(e) || /^\s*#/.test(e)) return void (a.source = e); var c = 0 === e.indexOf("//"); 0 !== e.indexOf("/") || c || (e = (s ? s.protocol || "http" : "http") + "://mce_host" + e), /^[\w\-]*:?\/\//.test(e) || (l = o.base_uri ? o.base_uri.path : new t(location.href).directory, "" === o.base_uri.protocol ? e = "//mce_host" + a.toAbsPath(l, e) : (e = /([^#?]*)([#?]?.*)/.exec(e), e = (s && s.protocol || "http") + "://mce_host" + a.toAbsPath(l, e[1]) + e[2])), e = e.replace(/@@/g, "(mce_at)"), e = /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e), n(i, function (t, n) { var r = e[n]; r && (r = r.replace(/\(mce_at\)/g, "@@")), a[t] = r }), s && (a.protocol || (a.protocol = s.protocol), a.userInfo || (a.userInfo = s.userInfo), a.port || "mce_host" !== a.host || (a.port = s.port), a.host && "mce_host" !== a.host || (a.host = s.host), a.source = ""), c && (a.protocol = "") } var n = e.each, r = e.trim, i = "source protocol authority userInfo user password host port relative path directory file query anchor".split(" "), o = { ftp: 21, http: 80, https: 443, mailto: 25 }; return t.prototype = { setPath: function (e) { var t = this; e = /^(.*?)\/?(\w+)?$/.exec(e), t.path = e[0], t.directory = e[1], t.file = e[2], t.source = "", t.getURI() }, toRelative: function (e) { var n = this, r; if ("./" === e) return e; if (e = new t(e, { base_uri: n }), "mce_host" != e.host && n.host != e.host && e.host || n.port != e.port || n.protocol != e.protocol && "" !== e.protocol) return e.getURI(); var i = n.getURI(), o = e.getURI(); return i == o || "/" == i.charAt(i.length - 1) && i.substr(0, i.length - 1) == o ? i : (r = n.toRelPath(n.path, e.path), e.query && (r += "?" + e.query), e.anchor && (r += "#" + e.anchor), r) }, toAbsolute: function (e, n) { return e = new t(e, { base_uri: this }), e.getURI(n && this.isSameOrigin(e)) }, isSameOrigin: function (e) { if (this.host == e.host && this.protocol == e.protocol) { if (this.port == e.port) return !0; var t = o[this.protocol]; if (t && (this.port || t) == (e.port || t)) return !0 } return !1 }, toRelPath: function (e, t) { var n, r = 0, i = "", o, a; if (e = e.substring(0, e.lastIndexOf("/")), e = e.split("/"), n = t.split("/"), e.length >= n.length) for (o = 0, a = e.length; a > o; o++) if (o >= n.length || e[o] != n[o]) { r = o + 1; break } if (e.length < n.length) for (o = 0, a = n.length; a > o; o++) if (o >= e.length || e[o] != n[o]) { r = o + 1; break } if (1 === r) return t; for (o = 0, a = e.length - (r - 1); a > o; o++) i += "../"; for (o = r - 1, a = n.length; a > o; o++) i += o != r - 1 ? "/" + n[o] : n[o]; return i }, toAbsPath: function (e, t) { var r, i = 0, o = [], a, s; for (a = /\/$/.test(t) ? "/" : "", e = e.split("/"), t = t.split("/"), n(e, function (e) { e && o.push(e) }), e = o, r = t.length - 1, o = []; r >= 0; r--) 0 !== t[r].length && "." !== t[r] && (".." !== t[r] ? i > 0 ? i-- : o.push(t[r]) : i++); return r = e.length - i, s = 0 >= r ? o.reverse().join("/") : e.slice(0, r).join("/") + "/" + o.reverse().join("/"), 0 !== s.indexOf("/") && (s = "/" + s), a && s.lastIndexOf("/") !== s.length - 1 && (s += a), s }, getURI: function (e) { var t, n = this; return (!n.source || e) && (t = "", e || (t += n.protocol ? n.protocol + "://" : "//", n.userInfo && (t += n.userInfo + "@"), n.host && (t += n.host), n.port && (t += ":" + n.port)), n.path && (t += n.path), n.query && (t += "?" + n.query), n.anchor && (t += "#" + n.anchor), n.source = t), n.source } }, t }), r(U, [u], function (e) { function t() { } var n = e.each, r = e.extend, i, o; return t.extend = i = function (e) { function t() { var e, t, n, r = this; if (!o && (r.init && r.init.apply(r, arguments), t = r.Mixins)) for (e = t.length; e--; ) n = t[e], n.init && n.init.apply(r, arguments) } function a() { return this } function s(e, t) { return function () { var n = this, r = n._super, i; return n._super = c[e], i = t.apply(n, arguments), n._super = r, i } } var l = this, c = l.prototype, u, d, f; o = !0, u = new l, o = !1, e.Mixins && (n(e.Mixins, function (t) { t = t; for (var n in t) "init" !== n && (e[n] = t[n]) }), c.Mixins && (e.Mixins = c.Mixins.concat(e.Mixins))), e.Methods && n(e.Methods.split(","), function (t) { e[t] = a }), e.Properties && n(e.Properties.split(","), function (t) { var n = "_" + t; e[t] = function (e) { var t = this, r; return e !== r ? (t[n] = e, t) : t[n] } }), e.Statics && n(e.Statics, function (e, n) { t[n] = e }), e.Defaults && c.Defaults && (e.Defaults = r({}, c.Defaults, e.Defaults)); for (d in e) f = e[d], u[d] = "function" == typeof f && c[d] ? s(d, f) : f; return t.prototype = u, t.constructor = t, t.extend = i, t }, t }), r($, [u], function (e) { function t(e) { function t() { return !1 } function n() { return !0 } function r(r, i) { var a, s, l, d; if (r = r.toLowerCase(), i = i || {}, i.type = r, i.target || (i.target = c), i.preventDefault || (i.preventDefault = function () { i.isDefaultPrevented = n }, i.stopPropagation = function () { i.isPropagationStopped = n }, i.stopImmediatePropagation = function () { i.isImmediatePropagationStopped = n }, i.isDefaultPrevented = t, i.isPropagationStopped = t, i.isImmediatePropagationStopped = t), e.beforeFire && e.beforeFire(i), a = u[r]) for (s = 0, l = a.length; l > s; s++) { if (a[s] = d = a[s], d.once && o(r, d), i.isImmediatePropagationStopped()) return i.stopPropagation(), i; if (d.call(c, i) === !1) return i.preventDefault(), i } return i } function i(e, n, r) { var i, o, a; if (n === !1 && (n = t), n) for (o = e.toLowerCase().split(" "), a = o.length; a--; ) e = o[a], i = u[e], i || (i = u[e] = [], d(e, !0)), r ? i.unshift(n) : i.push(n); return l } function o(e, t) { var n, r, i, o, a; if (e) for (o = e.toLowerCase().split(" "), n = o.length; n--; ) { if (e = o[n], r = u[e], !e) { for (i in u) d(i, !1), delete u[i]; return l } if (r) { if (t) for (a = r.length; a--; ) r[a] === t && (r = r.slice(0, a).concat(r.slice(a + 1)), u[e] = r); else r.length = 0; r.length || (d(e, !1), delete u[e]) } } else { for (e in u) d(e, !1); u = {} } return l } function a(e, t, n) { return t.once = !0, i(e, t, n) } function s(e) { return e = e.toLowerCase(), !(!u[e] || 0 === u[e].length) } var l = this, c, u = {}, d; e = e || {}, c = e.scope || l, d = e.toggleEvent || t, l.fire = r, l.on = i, l.off = o, l.once = a, l.has = s } var n = e.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchend", " "); return t.isNative = function (e) { return !!n[e.toLowerCase()] }, t }), r(q, [U], function (e) { function t(e) { for (var t = [], n = e.length, r; n--; ) r = e[n], r.__checked || (t.push(r), r.__checked = 1); for (n = t.length; n--; ) delete t[n].__checked; return t } var n = /^([\w\\*]+)?(?:#([\w\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i, r = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g, i = /^\s*|\s*$/g, o, a = e.extend({ init: function (e) { function t(e) { return e ? (e = e.toLowerCase(), function (t) { return "*" === e || t.type === e }) : void 0 } function o(e) { return e ? function (t) { return t._name === e } : void 0 } function a(e) { return e ? (e = e.split("."), function (t) { for (var n = e.length; n--; ) if (!t.hasClass(e[n])) return !1; return !0 }) : void 0 } function s(e, t, n) { return e ? function (r) { var i = r[e] ? r[e]() : ""; return t ? "=" === t ? i === n : "*=" === t ? i.indexOf(n) >= 0 : "~=" === t ? (" " + i + " ").indexOf(" " + n + " ") >= 0 : "!=" === t ? i != n : "^=" === t ? 0 === i.indexOf(n) : "$=" === t ? i.substr(i.length - n.length) === n : !1 : !!n } : void 0 } function l(e) { var t; return e ? (e = /(?:not\((.+)\))|(.+)/i.exec(e), e[1] ? (t = u(e[1], []), function (e) { return !d(e, t) }) : (e = e[2], function (t, n, r) { return "first" === e ? 0 === n : "last" === e ? n === r - 1 : "even" === e ? n % 2 === 0 : "odd" === e ? n % 2 === 1 : t[e] ? t[e]() : !1 })) : void 0 } function c(e, r, c) { function u(e) { e && r.push(e) } var d; return d = n.exec(e.replace(i, "")), u(t(d[1])), u(o(d[2])), u(a(d[3])), u(s(d[4], d[5], d[6])), u(l(d[7])), r.psuedo = !!d[7], r.direct = c, r } function u(e, t) { var n = [], i, o, a; do if (r.exec(""), o = r.exec(e), o && (e = o[3], n.push(o[1]), o[2])) { i = o[3]; break } while (o); for (i && u(i, t), e = [], a = 0; a < n.length; a++) ">" != n[a] && e.push(c(n[a], [], ">" === n[a - 1])); return t.push(e), t } var d = this.match; this._selectors = u(e, []) }, match: function (e, t) { var n, r, i, o, a, s, l, c, u, d, f, p, h; for (t = t || this._selectors, n = 0, r = t.length; r > n; n++) { for (a = t[n], o = a.length, h = e, p = 0, i = o - 1; i >= 0; i--) for (c = a[i]; h; ) { if (c.psuedo) for (f = h.parent().items(), u = d = f.length; u-- && f[u] !== h; ); for (s = 0, l = c.length; l > s; s++) if (!c[s](h, u, d)) { s = l + 1; break } if (s === l) { p++; break } if (i === o - 1) break; h = h.parent() } if (p === o) return !0 } return !1 }, find: function (e) { function n(e, t, i) { var o, a, s, l, c, u = t[i]; for (o = 0, a = e.length; a > o; o++) { for (c = e[o], s = 0, l = u.length; l > s; s++) if (!u[s](c, o, a)) { s = l + 1; break } if (s === l) i == t.length - 1 ? r.push(c) : c.items && n(c.items(), t, i + 1); else if (u.direct) return; c.items && n(c.items(), t, i) } } var r = [], i, s, l = this._selectors; if (e.items) { for (i = 0, s = l.length; s > i; i++) n(e.items(), l[i], 0); s > 1 && (r = t(r)) } return o || (o = a.Collection), new o(r) } }); return a }), r(j, [u, q, U], function (e, t, n) { var r, i, o = Array.prototype.push, a = Array.prototype.slice; return i = { length: 0, init: function (e) { e && this.add(e) }, add: function (t) { var n = this; return e.isArray(t) ? o.apply(n, t) : t instanceof r ? n.add(t.toArray()) : o.call(n, t), n }, set: function (e) { var t = this, n = t.length, r; for (t.length = 0, t.add(e), r = t.length; n > r; r++) delete t[r]; return t }, filter: function (e) { var n = this, i, o, a = [], s, l; for ("string" == typeof e ? (e = new t(e), l = function (t) { return e.match(t) }) : l = e, i = 0, o = n.length; o > i; i++) s = n[i], l(s) && a.push(s); return new r(a) }, slice: function () { return new r(a.apply(this, arguments)) }, eq: function (e) { return -1 === e ? this.slice(e) : this.slice(e, +e + 1) }, each: function (t) { return e.each(this, t), this }, toArray: function () { return e.toArray(this) }, indexOf: function (e) { for (var t = this, n = t.length; n-- && t[n] !== e; ); return n }, reverse: function () { return new r(e.toArray(this).reverse()) }, hasClass: function (e) { return this[0] ? this[0].hasClass(e) : !1 }, prop: function (e, t) { var n = this, r, i; return t !== r ? (n.each(function (n) { n[e] && n[e](t) }), n) : (i = n[0], i && i[e] ? i[e]() : void 0) }, exec: function (t) { var n = this, r = e.toArray(arguments).slice(1); return n.each(function (e) { e[t] && e[t].apply(e, r) }), n }, remove: function () { for (var e = this.length; e--; ) this[e].remove(); return this } }, e.each("fire on off show hide addClass removeClass append prepend before after reflow".split(" "), function (t) { i[t] = function () { var n = e.toArray(arguments); return this.each(function (e) { t in e && e[t].apply(e, n) }), this } }), e.each("text name disabled active selected checked visible parent value data".split(" "), function (e) { i[e] = function (t) { return this.prop(e, t) } }), r = n.extend(i), t.Collection = r, r }), r(Y, [u, y], function (e, t) { var n = 0; return { id: function () { return "mceu_" + n++ }, createFragment: function (e) { return t.DOM.createFragment(e) }, getWindowSize: function () { return t.DOM.getViewPort() }, getSize: function (e) { var t, n; if (e.getBoundingClientRect) { var r = e.getBoundingClientRect(); t = Math.max(r.width || r.right - r.left, e.offsetWidth), n = Math.max(r.height || r.bottom - r.bottom, e.offsetHeight) } else t = e.offsetWidth, n = e.offsetHeight; return { width: t, height: n} }, getPos: function (e, n) { return t.DOM.getPos(e, n) }, getViewPort: function (e) { return t.DOM.getViewPort(e) }, get: function (e) { return document.getElementById(e) }, addClass: function (e, n) { return t.DOM.addClass(e, n) }, removeClass: function (e, n) { return t.DOM.removeClass(e, n) }, hasClass: function (e, n) { return t.DOM.hasClass(e, n) }, toggleClass: function (e, n, r) { return t.DOM.toggleClass(e, n, r) }, css: function (e, n, r) { return t.DOM.setStyle(e, n, r) }, getRuntimeStyle: function (e, n) { return t.DOM.getStyle(e, n, !0) }, on: function (e, n, r, i) { return t.DOM.bind(e, n, r, i) }, off: function (e, n, r) { return t.DOM.unbind(e, n, r) }, fire: function (e, n, r) { return t.DOM.fire(e, n, r) }, innerHtml: function (e, n) { t.DOM.setHTML(e, n) } } }), r(K, [U, u, $, j, Y], function (e, t, n, r, i) { function o(e) { return e._eventDispatcher || (e._eventDispatcher = new n({ scope: e, toggleEvent: function (t, r) { r && n.isNative(t) && (e._nativeEvents || (e._nativeEvents = {}), e._nativeEvents[t] = !0, e._rendered && e.bindPendingEvents()) } })), e._eventDispatcher } var a = "onmousewheel" in document, s = !1, l = "mce-", c = e.extend({ Statics: { classPrefix: l }, isRtl: function () { return c.rtl }, classPrefix: l, init: function (e) { var n = this, r, o; if (n.settings = e = t.extend({}, n.Defaults, e), n._id = e.id || i.id(), n._text = n._name = "", n._width = n._height = 0, n._aria = { role: e.role }, this._elmCache = {}, r = e.classes) for (r = r.split(" "), r.map = {}, o = r.length; o--; ) r.map[r[o]] = !0; n._classes = r || [], n.visible(!0), t.each("title text width height name classes visible disabled active value".split(" "), function (t) { var r = e[t], i; r !== i ? n[t](r) : n["_" + t] === i && (n["_" + t] = !1) }), n.on("click", function () { return n.disabled() ? !1 : void 0 }), e.classes && t.each(e.classes.split(" "), function (e) { n.addClass(e) }), n.settings = e, n._borderBox = n.parseBox(e.border), n._paddingBox = n.parseBox(e.padding), n._marginBox = n.parseBox(e.margin), e.hidden && n.hide() }, Properties: "parent,title,text,width,height,disabled,active,name,value", Methods: "renderHtml", getContainerElm: function () { return document.body }, getParentCtrl: function (e) { for (var t, n = this.getRoot().controlIdLookup; e && n && !(t = n[e.id]); ) e = e.parentNode; return t }, parseBox: function (e) { var t, n = 10; if (e) return "number" == typeof e ? (e = e || 0, { top: e, left: e, bottom: e, right: e }) : (e = e.split(" "), t = e.length, 1 === t ? e[1] = e[2] = e[3] = e[0] : 2 === t ? (e[2] = e[0], e[3] = e[1]) : 3 === t && (e[3] = e[1]), { top: parseInt(e[0], n) || 0, right: parseInt(e[1], n) || 0, bottom: parseInt(e[2], n) || 0, left: parseInt(e[3], n) || 0 }) }, borderBox: function () { return this._borderBox }, paddingBox: function () { return this._paddingBox }, marginBox: function () { return this._marginBox }, measureBox: function (e, t) { function n(t) { var n = document.defaultView; return n ? (t = t.replace(/[A-Z]/g, function (e) { return "-" + e }), n.getComputedStyle(e, null).getPropertyValue(t)) : e.currentStyle[t] } function r(e) { var t = parseFloat(n(e), 10); return isNaN(t) ? 0 : t } return { top: r(t + "TopWidth"), right: r(t + "RightWidth"), bottom: r(t + "BottomWidth"), left: r(t + "LeftWidth")} }, initLayoutRect: function () { var e = this, t = e.settings, n, r, o = e.getEl(), a, s, l, c, u, d, f, p; n = e._borderBox = e._borderBox || e.measureBox(o, "border"), e._paddingBox = e._paddingBox || e.measureBox(o, "padding"), e._marginBox = e._marginBox || e.measureBox(o, "margin"), p = i.getSize(o), d = t.minWidth, f = t.minHeight, l = d || p.width, c = f || p.height, a = t.width, s = t.height, u = t.autoResize, u = "undefined" != typeof u ? u : !a && !s, a = a || l, s = s || c; var h = n.left + n.right, m = n.top + n.bottom, g = t.maxWidth || 65535, v = t.maxHeight || 65535; return e._layoutRect = r = { x: t.x || 0, y: t.y || 0, w: a, h: s, deltaW: h, deltaH: m, contentW: a - h, contentH: s - m, innerW: a - h, innerH: s - m, startMinWidth: d || 0, startMinHeight: f || 0, minW: Math.min(l, g), minH: Math.min(c, v), maxW: g, maxH: v, autoResize: u, scrollW: 0 }, e._lastLayoutRect = {}, r }, layoutRect: function (e) { var t = this, n = t._layoutRect, r, i, o, a, s, l; return n || (n = t.initLayoutRect()), e ? (o = n.deltaW, a = n.deltaH, e.x !== s && (n.x = e.x), e.y !== s && (n.y = e.y), e.minW !== s && (n.minW = e.minW), e.minH !== s && (n.minH = e.minH), i = e.w, i !== s && (i = i < n.minW ? n.minW : i, i = i > n.maxW ? n.maxW : i, n.w = i, n.innerW = i - o), i = e.h, i !== s && (i = i < n.minH ? n.minH : i, i = i > n.maxH ? n.maxH : i, n.h = i, n.innerH = i - a), i = e.innerW, i !== s && (i = i < n.minW - o ? n.minW - o : i, i = i > n.maxW - o ? n.maxW - o : i, n.innerW = i, n.w = i + o), i = e.innerH, i !== s && (i = i < n.minH - a ? n.minH - a : i, i = i > n.maxH - a ? n.maxH - a : i, n.innerH = i, n.h = i + a), e.contentW !== s && (n.contentW = e.contentW), e.contentH !== s && (n.contentH = e.contentH), r = t._lastLayoutRect, (r.x !== n.x || r.y !== n.y || r.w !== n.w || r.h !== n.h) && (l = c.repaintControls, l && l.map && !l.map[t._id] && (l.push(t), l.map[t._id] = !0), r.x = n.x, r.y = n.y, r.w = n.w, r.h = n.h), t) : n }, repaint: function () { var e = this, t, n, r, i, o = 0, a = 0, s, l; l = document.createRange ? function (e) { return e } : Math.round, t = e.getEl().style, r = e._layoutRect, s = e._lastRepaintRect || {}, i = e._borderBox, o = i.left + i.right, a = i.top + i.bottom, r.x !== s.x && (t.left = l(r.x) + "px", s.x = r.x), r.y !== s.y && (t.top = l(r.y) + "px", s.y = r.y), r.w !== s.w && (t.width = l(r.w - o) + "px", s.w = r.w), r.h !== s.h && (t.height = l(r.h - a) + "px", s.h = r.h), e._hasBody && r.innerW !== s.innerW && (n = e.getEl("body").style, n.width = l(r.innerW) + "px", s.innerW = r.innerW), e._hasBody && r.innerH !== s.innerH && (n = n || e.getEl("body").style, n.height = l(r.innerH) + "px", s.innerH = r.innerH), e._lastRepaintRect = s, e.fire("repaint", {}, !1) }, on: function (e, t) { function n(e) { var t, n; return "string" != typeof e ? e : function (i) { return t || r.parentsAndSelf().each(function (r) { var i = r.settings.callbacks; return i && (t = i[e]) ? (n = r, !1) : void 0 }), t.call(n, i) } } var r = this; return o(r).on(e, n(t)), r }, off: function (e, t) { return o(this).off(e, t), this }, fire: function (e, t, n) { var r = this; if (t = t || {}, t.control || (t.control = r), t = o(r).fire(e, t), n !== !1 && r.parent) for (var i = r.parent(); i && !t.isPropagationStopped(); ) i.fire(e, t, !1), i = i.parent(); return t }, hasEventListeners: function (e) { return o(this).has(e) }, parents: function (e) { var t = this, n, i = new r; for (n = t.parent(); n; n = n.parent()) i.add(n); return e && (i = i.filter(e)), i }, parentsAndSelf: function (e) { return new r(this).add(this.parents(e)) }, next: function () { var e = this.parent().items(); return e[e.indexOf(this) + 1] }, prev: function () { var e = this.parent().items(); return e[e.indexOf(this) - 1] }, findCommonAncestor: function (e, t) { for (var n; e; ) { for (n = t; n && e != n; ) n = n.parent(); if (e == n) break; e = e.parent() } return e }, hasClass: function (e, t) { var n = this._classes[t || "control"]; return e = this.classPrefix + e, n && !!n.map[e] }, addClass: function (e, t) { var n = this, r, i; return e = this.classPrefix + e, r = n._classes[t || "control"], r || (r = [], r.map = {}, n._classes[t || "control"] = r), r.map[e] || (r.map[e] = e, r.push(e), n._rendered && (i = n.getEl(t), i && (i.className = r.join(" ")))), n }, removeClass: function (e, t) { var n = this, r, i, o; if (e = this.classPrefix + e, r = n._classes[t || "control"], r && r.map[e]) for (delete r.map[e], i = r.length; i--; ) r[i] === e && r.splice(i, 1); return n._rendered && (o = n.getEl(t), o && (o.className = r.join(" "))), n }, toggleClass: function (e, t, n) { var r = this; return t ? r.addClass(e, n) : r.removeClass(e, n), r }, classes: function (e) { var t = this._classes[e || "control"]; return t ? t.join(" ") : "" }, innerHtml: function (e) { return i.innerHtml(this.getEl(), e), this }, getEl: function (e) { var t = e ? this._id + "-" + e : this._id; return this._elmCache[t] || (this._elmCache[t] = i.get(t)), this._elmCache[t] }, visible: function (e) { var t = this, n; return "undefined" != typeof e ? (t._visible !== e && (t._rendered && (t.getEl().style.display = e ? "" : "none"), t._visible = e, n = t.parent(), n && (n._lastRect = null), t.fire(e ? "show" : "hide")), t) : t._visible }, show: function () { return this.visible(!0) }, hide: function () { return this.visible(!1) }, focus: function () { try { this.getEl().focus() } catch (e) { } return this }, blur: function () { return this.getEl().blur(), this }, aria: function (e, t) { var n = this, r = n.getEl(n.ariaTarget); return "undefined" == typeof t ? n._aria[e] : (n._aria[e] = t, n._rendered && r.setAttribute("role" == e ? e : "aria-" + e, t), n) }, encode: function (e, t) { return t !== !1 && (e = this.translate(e)), (e || "").replace(/[&<>"]/g, function (e) { return "&#" + e.charCodeAt(0) + ";" }) }, translate: function (e) { return c.translate ? c.translate(e) : e }, before: function (e) { var t = this, n = t.parent(); return n && n.insert(e, n.items().indexOf(t), !0), t }, after: function (e) { var t = this, n = t.parent(); return n && n.insert(e, n.items().indexOf(t)), t }, remove: function () { var e = this, t = e.getEl(), n = e.parent(), r, o; if (e.items) { var a = e.items().toArray(); for (o = a.length; o--; ) a[o].remove() } n && n.items && (r = [], n.items().each(function (t) { t !== e && r.push(t) }), n.items().set(r), n._lastRect = null), e._eventsRoot && e._eventsRoot == e && i.off(t); var s = e.getRoot().controlIdLookup; return s && delete s[e._id], t && t.parentNode && t.parentNode.removeChild(t), e._rendered = !1, e }, renderBefore: function (e) { var t = this; return e.parentNode.insertBefore(i.createFragment(t.renderHtml()), e), t.postRender(), t }, renderTo: function (e) { var t = this; return e = e || t.getContainerElm(), e.appendChild(i.createFragment(t.renderHtml())), t.postRender(), t }, postRender: function () { var e = this, t = e.settings, n, r, o, a, s; for (a in t) 0 === a.indexOf("on") && e.on(a.substr(2), t[a]); if (e._eventsRoot) { for (o = e.parent(); !s && o; o = o.parent()) s = o._eventsRoot; if (s) for (a in s._nativeEvents) e._nativeEvents[a] = !0 } e.bindPendingEvents(), t.style && (n = e.getEl(), n && (n.setAttribute("style", t.style), n.style.cssText = t.style)), e._visible || i.css(e.getEl(), "display", "none"), e.settings.border && (r = e.borderBox(), i.css(e.getEl(), { "border-top-width": r.top, "border-right-width": r.right, "border-bottom-width": r.bottom, "border-left-width": r.left })); var l = e.getRoot(); l.controlIdLookup || (l.controlIdLookup = {}), l.controlIdLookup[e._id] = e; for (var c in e._aria) e.aria(c, e._aria[c]); e.fire("postrender", {}, !1) }, scrollIntoView: function (e) { function t(e, t) { var n, r, i = e; for (n = r = 0; i && i != t && i.nodeType; ) n += i.offsetLeft || 0, r += i.offsetTop || 0, i = i.offsetParent; return { x: n, y: r} } var n = this.getEl(), r = n.parentNode, i, o, a, s, l, c, u = t(n, r); return i = u.x, o = u.y, a = n.offsetWidth, s = n.offsetHeight, l = r.clientWidth, c = r.clientHeight, "end" == e ? (i -= l - a, o -= c - s) : "center" == e && (i -= l / 2 - a / 2, o -= c / 2 - s / 2), r.scrollLeft = i, r.scrollTop = o, this }, bindPendingEvents: function () { function e(e) { var t = o.getParentCtrl(e.target); t && t.fire(e.type, e) } function t() { var e = d._lastHoverCtrl; e && (e.fire("mouseleave", { target: e.getEl() }), e.parents().each(function (e) { e.fire("mouseleave", { target: e.getEl() }) }), d._lastHoverCtrl = null) } function n(e) { var t = o.getParentCtrl(e.target), n = d._lastHoverCtrl, r = 0, i, a, s; if (t !== n) { if (d._lastHoverCtrl = t, a = t.parents().toArray().reverse(), a.push(t), n) { for (s = n.parents().toArray().reverse(), s.push(n), r = 0; r < s.length && a[r] === s[r]; r++); for (i = s.length - 1; i >= r; i--) n = s[i], n.fire("mouseleave", { target: n.getEl() }) } for (i = r; i < a.length; i++) t = a[i], t.fire("mouseenter", { target: t.getEl() }) } } function r(e) { e.preventDefault(), "mousewheel" == e.type ? (e.deltaY = -1 / 40 * e.wheelDelta, e.wheelDeltaX && (e.deltaX = -1 / 40 * e.wheelDeltaX)) : (e.deltaX = 0, e.deltaY = e.detail), e = o.fire("wheel", e) } var o = this, l, c, u, d, f, p; if (o._rendered = !0, f = o._nativeEvents) { for (u = o.parents().toArray(), u.unshift(o), l = 0, c = u.length; !d && c > l; l++) d = u[l]._eventsRoot; for (d || (d = u[u.length - 1] || o), o._eventsRoot = d, c = l, l = 0; c > l; l++) u[l]._eventsRoot = d; var h = d._delegates; h || (h = d._delegates = {}); for (p in f) { if (!f) return !1; "wheel" !== p || s ? ("mouseenter" === p || "mouseleave" === p ? d._hasMouseEnter || (i.on(d.getEl(), "mouseleave", t), i.on(d.getEl(), "mouseover", n), d._hasMouseEnter = 1) : h[p] || (i.on(d.getEl(), p, e), h[p] = !0), f[p] = !1) : a ? i.on(o.getEl(), "mousewheel", r) : i.on(o.getEl(), "DOMMouseScroll", r) } } }, getRoot: function () { for (var e = this, t, n = []; e; ) { if (e.rootControl) { t = e.rootControl; break } n.push(e), t = e, e = e.parent() } t || (t = this); for (var r = n.length; r--; ) n[r].rootControl = t; return t }, reflow: function () { return this.repaint(), this } }); return c }), r(G, [], function () { var e = {}, t; return { add: function (t, n) { e[t.toLowerCase()] = n }, has: function (t) { return !!e[t.toLowerCase()] }, create: function (n, r) { var i, o, a; if (!t) { a = tinymce.ui; for (o in a) e[o.toLowerCase()] = a[o]; t = !0 } if ("string" == typeof n ? (r = r || {}, r.type = n) : (r = n, n = r.type), n = n.toLowerCase(), i = e[n], !i) throw new Error("Could not find control by type: " + n); return i = new i(r), i.type = n, i } } }), r(X, [], function () { return function (e) { function t(e) { return e = e || b, e && e.getAttribute("role") } function n(e) { for (var n, r = e || b; r = r.parentNode; ) if (n = t(r)) return n } function r(e) { var t = b; return t ? t.getAttribute("aria-" + e) : void 0 } function i(e) { var t = e.tagName.toUpperCase(); return "INPUT" == t || "TEXTAREA" == t } function o(e) { return i(e) && !e.hidden ? !0 : /^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell)$/.test(t(e)) ? !0 : !1 } function a(e) { function t(e) { if (1 == e.nodeType && "none" != e.style.display) { o(e) && n.push(e); for (var r = 0; r < e.childNodes.length; r++) t(e.childNodes[r]) } } var n = []; return t(e || y.getEl()), n } function s(e) { var t, n; e = e || C, n = e.parents().toArray(), n.unshift(e); for (var r = 0; r < n.length && (t = n[r], !t.settings.ariaRoot); r++); return t } function l(e) { var t = s(e), n = a(t.getEl()); t.settings.ariaRemember && "lastAriaIndex" in t ? c(t.lastAriaIndex, n) : c(0, n) } function c(e, t) { return 0 > e ? e = t.length - 1 : e >= t.length && (e = 0), t[e] && t[e].focus(), e } function u(e, t) { var n = -1, r = s(); t = t || a(r.getEl()); for (var i = 0; i < t.length; i++) t[i] === b && (n = i); n += e, r.lastAriaIndex = c(n, t) } function d() { var e = n(); "tablist" == e ? u(-1, a(b.parentNode)) : C.parent().submenu ? g() : u(-1) } function f() { var e = t(), i = n(); "tablist" == i ? u(1, a(b.parentNode)) : "menuitem" == e && "menu" == i && r("haspopup") ? v() : u(1) } function p() { u(-1) } function h() { var e = t(), i = n(); "menuitem" == e && "menubar" == i ? v() : "button" == e && r("haspopup") ? v({ key: "down" }) : u(1) } function m(e) { var t = n(); if ("tablist" == t) { var r = a(C.getEl("body"))[0]; r && r.focus() } else u(e.shiftKey ? -1 : 1) } function g() { C.fire("cancel") } function v(e) { e = e || {}, C.fire("click", { target: b, aria: e }) } var y = e.root, b, C; try { b = document.activeElement } catch (x) { b = document.body } return C = y.getParentCtrl(b), y.on("keydown", function (e) { function t(e, t) { i(b) || t(e) !== !1 && e.preventDefault() } if (!e.isDefaultPrevented()) switch (e.keyCode) { case 37: t(e, d); break; case 39: t(e, f); break; case 38: t(e, p); break; case 40: t(e, h); break; case 27: g(); break; case 14: case 13: case 32: t(e, v); break; case 9: m(e) !== !1 && e.preventDefault() } }), y.on("focusin", function (e) { b = e.target, C = e.control }), { focusFirst: l} } }), r(J, [K, j, q, G, X, u, Y], function (e, t, n, r, i, o, a) { var s = {}; return e.extend({ layout: "", innerClass: "container-inner", init: function (e) { var n = this; n._super(e), e = n.settings, n._fixed = e.fixed, n._items = new t, n.isRtl() && n.addClass("rtl"), n.addClass("container"), n.addClass("container-body", "body"), e.containerCls && n.addClass(e.containerCls), n._layout = r.create((e.layout || n.layout) + "layout"), n.settings.items && n.add(n.settings.items), n._hasBody = !0 }, items: function () { return this._items }, find: function (e) { return e = s[e] = s[e] || new n(e), e.find(this) }, add: function (e) { var t = this; return t.items().add(t.create(e)).parent(t), t }, focus: function (e) { var t = this, n, r, i; return e && (r = t.keyboardNav || t.parents().eq(-1)[0].keyboardNav) ? void r.focusFirst(t) : (i = t.find("*"), t.statusbar && i.add(t.statusbar.items()), i.each(function (e) { return e.settings.autofocus ? (n = null, !1) : void (e.canFocus && (n = n || e)) }), n && n.focus(), t) }, replace: function (e, t) { for (var n, r = this.items(), i = r.length; i--; ) if (r[i] === e) { r[i] = t; break } i >= 0 && (n = t.getEl(), n && n.parentNode.removeChild(n), n = e.getEl(), n && n.parentNode.removeChild(n)), t.parent(this) }, create: function (t) { var n = this, i, a = []; return o.isArray(t) || (t = [t]), o.each(t, function (t) { t && (t instanceof e || ("string" == typeof t && (t = { type: t }), i = o.extend({}, n.settings.defaults, t), t.type = i.type = i.type || t.type || n.settings.defaultType || (i.defaults ? i.defaults.type : null), t = r.create(i)), a.push(t)) }), a }, renderNew: function () { var e = this; return e.items().each(function (t, n) { var r, i; t.parent(e), t._rendered || (r = e.getEl("body"), i = a.createFragment(t.renderHtml()), r.hasChildNodes() && n <= r.childNodes.length - 1 ? r.insertBefore(i, r.childNodes[n]) : r.appendChild(i), t.postRender()) }), e._layout.applyClasses(e), e._lastRect = null, e }, append: function (e) { return this.add(e).renderNew() }, prepend: function (e) { var t = this; return t.items().set(t.create(e).concat(t.items().toArray())), t.renderNew() }, insert: function (e, t, n) { var r = this, i, o, a; return e = r.create(e), i = r.items(), !n && t < i.length - 1 && (t += 1), t >= 0 && t < i.length && (o = i.slice(0, t).toArray(), a = i.slice(t).toArray(), i.set(o.concat(e, a))), r.renderNew() }, fromJSON: function (e) { var t = this; for (var n in e) t.find("#" + n).value(e[n]); return t }, toJSON: function () { var e = this, t = {}; return e.find("*").each(function (e) { var n = e.name(), r = e.value(); n && "undefined" != typeof r && (t[n] = r) }), t }, preRender: function () { }, renderHtml: function () { var e = this, t = e._layout, n = this.settings.role; return e.preRender(), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes() + '"' + (n ? ' role="' + this.settings.role + '"' : "") + '><div id="' + e._id + '-body" class="' + e.classes("body") + '">' + (e.settings.html || "") + t.renderHtml(e) + "</div></div>" }, postRender: function () { var e = this, t; return e.items().exec("postRender"), e._super(), e._layout.postRender(e), e._rendered = !0, e.settings.style && a.css(e.getEl(), e.settings.style), e.settings.border && (t = e.borderBox(), a.css(e.getEl(), { "border-top-width": t.top, "border-right-width": t.right, "border-bottom-width": t.bottom, "border-left-width": t.left })), e.parent() || (e.keyboardNav = new i({ root: e })), e }, initLayoutRect: function () { var e = this, t = e._super(); return e._layout.recalc(e), t }, recalc: function () { var e = this, t = e._layoutRect, n = e._lastRect; return n && n.w == t.w && n.h == t.h ? void 0 : (e._layout.recalc(e), t = e.layoutRect(), e._lastRect = { x: t.x, y: t.y, w: t.w, h: t.h }, !0) }, reflow: function () { var t; if (this.visible()) { for (e.repaintControls = [], e.repaintControls.map = {}, this.recalc(), t = e.repaintControls.length; t--; ) e.repaintControls[t].repaint(); "flow" !== this.settings.layout && "stack" !== this.settings.layout && this.repaint(), e.repaintControls = [] } return this } }) }), r(Q, [Y], function (e) { function t() { var e = document, t, n, r, i, o, a, s, l, c = Math.max; return t = e.documentElement, n = e.body, r = c(t.scrollWidth, n.scrollWidth), i = c(t.clientWidth, n.clientWidth), o = c(t.offsetWidth, n.offsetWidth), a = c(t.scrollHeight, n.scrollHeight), s = c(t.clientHeight, n.clientHeight), l = c(t.offsetHeight, n.offsetHeight), { width: o > r ? i : r, height: l > a ? s : a} } return function (n, r) { function i() { return a.getElementById(r.handle || n) } var o, a = document, s, l, c, u, d, f; r = r || {}, l = function (n) { var l = t(), p, h; n.preventDefault(), s = n.button, p = i(), d = n.screenX, f = n.screenY, h = window.getComputedStyle ? window.getComputedStyle(p, null).getPropertyValue("cursor") : p.runtimeStyle.cursor, o = a.createElement("div"), e.css(o, { position: "absolute", top: 0, left: 0, width: l.width, height: l.height, zIndex: 2147483647, opacity: 1e-4, cursor: h }), a.body.appendChild(o), e.on(a, "mousemove", u), e.on(a, "mouseup", c), r.start(n) }, u = function (e) { return e.button !== s ? c(e) : (e.deltaX = e.screenX - d, e.deltaY = e.screenY - f, e.preventDefault(), void r.drag(e)) }, c = function (t) { e.off(a, "mousemove", u), e.off(a, "mouseup", c), o.parentNode.removeChild(o), r.stop && r.stop(t) }, this.destroy = function () { e.off(i()) }, e.on(i(), "mousedown", l) } }), r(Z, [Y, Q], function (e, t) { return { init: function () { var e = this; e.on("repaint", e.renderScroll) }, renderScroll: function () { function n() { function t(t, a, s, l, c, u) { var d, f, p, h, m, g, v, y, b; if (f = i.getEl("scroll" + t)) { if (y = a.toLowerCase(), b = s.toLowerCase(), i.getEl("absend") && e.css(i.getEl("absend"), y, i.layoutRect()[l] - 1), !c) return void e.css(f, "display", "none"); e.css(f, "display", "block"), d = i.getEl("body"), p = i.getEl("scroll" + t + "t"), h = d["client" + s] - 2 * o, h -= n && r ? f["client" + u] : 0, m = d["scroll" + s], g = h / m, v = {}, v[y] = d["offset" + a] + o, v[b] = h, e.css(f, v), v = {}, v[y] = d["scroll" + a] * g, v[b] = h * g, e.css(p, v) } } var n, r, a; a = i.getEl("body"), n = a.scrollWidth > a.clientWidth, r = a.scrollHeight > a.clientHeight, t("h", "Left", "Width", "contentW", n, "Height"), t("v", "Top", "Height", "contentH", r, "Width") } function r() { function n(n, r, a, s, l) { var c, u = i._id + "-scroll" + n, d = i.classPrefix; i.getEl().appendChild(e.createFragment('<div id="' + u + '" class="' + d + "scrollbar " + d + "scrollbar-" + n + '"><div id="' + u + 't" class="' + d + 'scrollbar-thumb"></div></div>')), i.draghelper = new t(u + "t", { start: function () { c = i.getEl("body")["scroll" + r], e.addClass(e.get(u), d + "active") }, drag: function (e) { var t, u, d, f, p = i.layoutRect(); u = p.contentW > p.innerW, d = p.contentH > p.innerH, f = i.getEl("body")["client" + a] - 2 * o, f -= u && d ? i.getEl("scroll" + n)["client" + l] : 0, t = f / i.getEl("body")["scroll" + a], i.getEl("body")["scroll" + r] = c + e["delta" + s] / t }, stop: function () { e.removeClass(e.get(u), d + "active") } }) } i.addClass("scroll"), n("v", "Top", "Height", "Y", "Width"), n("h", "Left", "Width", "X", "Height") } var i = this, o = 2; i.settings.autoScroll && (i._hasScroll || (i._hasScroll = !0, r(), i.on("wheel", function (e) { var t = i.getEl("body"); t.scrollLeft += 10 * (e.deltaX || 0), t.scrollTop += 10 * e.deltaY, n() }), e.on(i.getEl("body"), "scroll", n)), n()) } } }), r(et, [J, Z], function (e, t) { return e.extend({ Defaults: { layout: "fit", containerCls: "panel" }, Mixins: [t], renderHtml: function () { var e = this, t = e._layout, n = e.settings.html; return e.preRender(), t.preRender(e), "undefined" == typeof n ? n = '<div id="' + e._id + '-body" class="' + e.classes("body") + '">' + t.renderHtml(e) + "</div>" : ("function" == typeof n && (n = n.call(e)), e._hasBody = !1), '<div id="' + e._id + '" class="' + e.classes() + '" hidefocus="1" tabindex="-1" role="group">' + (e._preBodyHtml || "") + n + "</div>" } }) }), r(tt, [Y], function (e) { function t(t, n, r) { var i, o, a, s, l, c, u, d, f, p; return f = e.getViewPort(), o = e.getPos(n), a = o.x, s = o.y, t._fixed && "static" == e.getRuntimeStyle(document.body, "position") && (a -= f.x, s -= f.y), i = t.getEl(), p = e.getSize(i), l = p.width, c = p.height, p = e.getSize(n), u = p.width, d = p.height, r = (r || "").split(""), "b" === r[0] && (s += d), "r" === r[1] && (a += u), "c" === r[0] && (s += Math.round(d / 2)), "c" === r[1] && (a += Math.round(u / 2)), "b" === r[3] && (s -= c), "r" === r[4] && (a -= l), "c" === r[3] && (s -= Math.round(c / 2)), "c" === r[4] && (a -= Math.round(l / 2)), { x: a, y: s, w: l, h: c} } return { testMoveRel: function (n, r) { for (var i = e.getViewPort(), o = 0; o < r.length; o++) { var a = t(this, n, r[o]); if (this._fixed) { if (a.x > 0 && a.x + a.w < i.w && a.y > 0 && a.y + a.h < i.h) return r[o] } else if (a.x > i.x && a.x + a.w < i.w + i.x && a.y > i.y && a.y + a.h < i.h + i.y) return r[o] } return r[0] }, moveRel: function (e, n) { "string" != typeof n && (n = this.testMoveRel(e, n)); var r = t(this, e, n); return this.moveTo(r.x, r.y) }, moveBy: function (e, t) { var n = this, r = n.layoutRect(); return n.moveTo(r.x + e, r.y + t), n }, moveTo: function (t, n) { function r(e, t, n) { return 0 > e ? 0 : e + n > t ? (e = t - n, 0 > e ? 0 : e) : e } var i = this; if (i.settings.constrainToViewport) { var o = e.getViewPort(window), a = i.layoutRect(); t = r(t, o.w + o.x, a.w), n = r(n, o.h + o.y, a.h) } return i._rendered ? i.layoutRect({ x: t, y: n }).repaint() : (i.settings.x = t, i.settings.y = n), i.fire("move", { x: t, y: n }), i } } }), r(nt, [Y], function (e) { return { resizeToContent: function () { this._layoutRect.autoResize = !0, this._lastRect = null, this.reflow() }, resizeTo: function (t, n) { if (1 >= t || 1 >= n) { var r = e.getWindowSize(); t = 1 >= t ? t * r.w : t, n = 1 >= n ? n * r.h : n } return this._layoutRect.autoResize = !1, this.layoutRect({ minW: t, minH: n, w: t, h: n }).reflow() }, resizeBy: function (e, t) { var n = this, r = n.layoutRect(); return n.resizeTo(r.w + e, r.h + t) } } }), r(rt, [et, tt, nt, Y], function (e, t, n, r) { function i() { function e(e, t) { for (; e; ) { if (e == t) return !0; e = e.parent() } } u || (u = function (t) { if (2 != t.button) for (var n = p.length; n--; ) { var r = p[n], i = r.getParentCtrl(t.target); if (r.settings.autohide) { if (i && (e(i, r) || r.parent() === i)) continue; t = r.fire("autohide", { target: t.target }), t.isDefaultPrevented() || r.hide() } } }, r.on(document, "click", u)) } function o() { d || (d = function () { var e; for (e = p.length; e--; ) s(p[e]) }, r.on(window, "scroll", d)) } function a() { if (!f) { var e = document.documentElement, t = e.clientWidth, n = e.clientHeight; f = function () { document.all && t == e.clientWidth && n == e.clientHeight || (t = e.clientWidth, n = e.clientHeight, g.hideAll()) }, r.on(window, "resize", f) } } function s(e) { function t(t, n) { for (var r, i = 0; i < p.length; i++) if (p[i] != e) for (r = p[i].parent(); r && (r = r.parent()); ) r == e && p[i].fixed(t).moveBy(0, n).repaint() } var n = r.getViewPort().y; e.settings.autofix && (e._fixed ? e._autoFixY > n && (e.fixed(!1).layoutRect({ y: e._autoFixY }).repaint(), t(!1, e._autoFixY - n)) : (e._autoFixY = e.layoutRect().y, e._autoFixY < n && (e.fixed(!0).layoutRect({ y: 0 }).repaint(), t(!0, n - e._autoFixY)))) } function l(e, t) { var n, i = g.zIndex || 65535, o; if (e) h.push(t); else for (n = h.length; n--; ) h[n] === t && h.splice(n, 1); if (h.length) for (n = 0; n < h.length; n++) h[n].modal && (i++, o = h[n]), h[n].getEl().style.zIndex = i, h[n].zIndex = i, i++; var a = document.getElementById(t.classPrefix + "modal-block"); o ? r.css(a, "z-index", o.zIndex - 1) : a && (a.parentNode.removeChild(a), m = !1), g.currentZIndex = i } function c(e) { var t; for (t = p.length; t--; ) p[t] === e && p.splice(t, 1); for (t = h.length; t--; ) h[t] === e && h.splice(t, 1) } var u, d, f, p = [], h = [], m, g = e.extend({ Mixins: [t, n], init: function (e) { var t = this; t._super(e), t._eventsRoot = t, t.addClass("floatpanel"), e.autohide && (i(), a(), p.push(t)), e.autofix && (o(), t.on("move", function () { s(this) })), t.on("postrender show", function (e) { if (e.control == t) { var n, i = t.classPrefix; t.modal && !m && (n = r.createFragment('<div id="' + i + 'modal-block" class="' + i + "reset " + i + 'fade"></div>'), n = n.firstChild, t.getContainerElm().appendChild(n), setTimeout(function () { r.addClass(n, i + "in"), r.addClass(t.getEl(), i + "in") }, 0), m = !0), l(!0, t) } }), t.on("show", function () { t.parents().each(function (e) { return e._fixed ? (t.fixed(!0), !1) : void 0 }) }), e.popover && (t._preBodyHtml = '<div class="' + t.classPrefix + 'arrow"></div>', t.addClass("popover").addClass("bottom").addClass(t.isRtl() ? "end" : "start")) }, fixed: function (e) { var t = this; if (t._fixed != e) { if (t._rendered) { var n = r.getViewPort(); e ? t.layoutRect().y -= n.y : t.layoutRect().y += n.y } t.toggleClass("fixed", e), t._fixed = e } return t }, show: function () { var e = this, t, n = e._super(); for (t = p.length; t-- && p[t] !== e; ); return -1 === t && p.push(e), n }, hide: function () { return c(this), l(!1, this), this._super() }, hideAll: function () { g.hideAll() }, close: function () { var e = this; return e.fire("close").isDefaultPrevented() || (e.remove(), l(!1, e)), e }, remove: function () { c(this), this._super() }, postRender: function () { var e = this; return e.settings.bodyRole && this.getEl("body").setAttribute("role", e.settings.bodyRole), e._super() } }); return g.hideAll = function () { for (var e = p.length; e--; ) { var t = p[e]; t && t.settings.autohide && (t.hide(), p.splice(e, 1)) } }, g }), r(it, [rt, et, Y, Q], function (e, t, n, r) { var i = e.extend({ modal: !0, Defaults: { border: 1, layout: "flex", containerCls: "panel", role: "dialog", callbacks: { submit: function () { this.fire("submit", { data: this.toJSON() }) }, close: function () { this.close() } } }, init: function (e) { var n = this; n._super(e), n.isRtl() && n.addClass("rtl"), n.addClass("window"), n._fixed = !0, e.buttons && (n.statusbar = new t({ layout: "flex", border: "1 0 0 0", spacing: 3, padding: 10, align: "center", pack: n.isRtl() ? "start" : "end", defaults: { type: "button" }, items: e.buttons }), n.statusbar.addClass("foot"), n.statusbar.parent(n)), n.on("click", function (e) { -1 != e.target.className.indexOf(n.classPrefix + "close") && n.close() }), n.on("cancel", function () { n.close() }), n.aria("describedby", n.describedBy || n._id + "-none"), n.aria("label", e.title), n._fullscreen = !1 }, recalc: function () { var e = this, t = e.statusbar, r, i, o, a; e._fullscreen && (e.layoutRect(n.getWindowSize()), e.layoutRect().contentH = e.layoutRect().innerH), e._super(), r = e.layoutRect(), e.settings.title && !e._fullscreen && (i = r.headerW, i > r.w && (o = r.x - Math.max(0, i / 2), e.layoutRect({ w: i, x: o }), a = !0)), t && (t.layoutRect({ w: e.layoutRect().innerW }).recalc(), i = t.layoutRect().minW + r.deltaW, i > r.w && (o = r.x - Math.max(0, i - r.w), e.layoutRect({ w: i, x: o }), a = !0)), a && e.recalc() }, initLayoutRect: function () { var e = this, t = e._super(), r = 0, i; if (e.settings.title && !e._fullscreen) { i = e.getEl("head"); var o = n.getSize(i); t.headerW = o.width, t.headerH = o.height, r += t.headerH } e.statusbar && (r += e.statusbar.layoutRect().h), t.deltaH += r, t.minH += r, t.h += r; var a = n.getWindowSize(); return t.x = Math.max(0, a.w / 2 - t.w / 2), t.y = Math.max(0, a.h / 2 - t.h / 2), t }, renderHtml: function () { var e = this, t = e._layout, n = e._id, r = e.classPrefix, i = e.settings, o = "", a = "", s = i.html; return e.preRender(), t.preRender(e), i.title && (o = '<div id="' + n + '-head" class="' + r + 'window-head"><div id="' + n + '-title" class="' + r + 'title">' + e.encode(i.title) + '</div><button type="button" class="' + r + 'close" aria-hidden="true">\xd7</button><div id="' + n + '-dragh" class="' + r + 'dragh"></div></div>'), i.url && (s = '<iframe src="' + i.url + '" tabindex="-1"></iframe>'), "undefined" == typeof s && (s = t.renderHtml(e)), e.statusbar && (a = e.statusbar.renderHtml()), '<div id="' + n + '" class="' + e.classes() + '" hidefocus="1"><div class="' + e.classPrefix + 'reset" role="application">' + o + '<div id="' + n + '-body" class="' + e.classes("body") + '">' + s + "</div>" + a + "</div></div>" }, fullscreen: function (e) { var t = this, r = document.documentElement, i, o = t.classPrefix, a; if (e != t._fullscreen) if (n.on(window, "resize", function () { var e; if (t._fullscreen) if (i) t._timer || (t._timer = setTimeout(function () { var e = n.getWindowSize(); t.moveTo(0, 0).resizeTo(e.w, e.h), t._timer = 0 }, 50)); else { e = (new Date).getTime(); var r = n.getWindowSize(); t.moveTo(0, 0).resizeTo(r.w, r.h), (new Date).getTime() - e > 50 && (i = !0) } }), a = t.layoutRect(), t._fullscreen = e, e) { t._initial = { x: a.x, y: a.y, w: a.w, h: a.h }, t._borderBox = t.parseBox("0"), t.getEl("head").style.display = "none", a.deltaH -= a.headerH + 2, n.addClass(r, o + "fullscreen"), n.addClass(document.body, o + "fullscreen"), t.addClass("fullscreen"); var s = n.getWindowSize(); t.moveTo(0, 0).resizeTo(s.w, s.h) } else t._borderBox = t.parseBox(t.settings.border), t.getEl("head").style.display = "", a.deltaH += a.headerH, n.removeClass(r, o + "fullscreen"), n.removeClass(document.body, o + "fullscreen"), t.removeClass("fullscreen"), t.moveTo(t._initial.x, t._initial.y).resizeTo(t._initial.w, t._initial.h); return t.reflow() }, postRender: function () { var e = this, t; setTimeout(function () { e.addClass("in") }, 0), e._super(), e.statusbar && e.statusbar.postRender(), e.focus(), this.dragHelper = new r(e._id + "-dragh", { start: function () { t = { x: e.layoutRect().x, y: e.layoutRect().y} }, drag: function (n) { e.moveTo(t.x + n.deltaX, t.y + n.deltaY) } }), e.on("submit", function (t) { t.isDefaultPrevented() || e.close() }) }, submit: function () { return this.fire("submit", { data: this.toJSON() }) }, remove: function () { var e = this, t = e.classPrefix; e.dragHelper.destroy(), e._super(), e.statusbar && this.statusbar.remove(), e._fullscreen && (n.removeClass(document.documentElement, t + "fullscreen"), n.removeClass(document.body, t + "fullscreen")) }, getContentWindow: function () { var e = this.getEl().getElementsByTagName("iframe")[0]; return e ? e.contentWindow : null } }); return i }), r(ot, [it], function (e) { var t = e.extend({ init: function (e) { e = { border: 1, padding: 20, layout: "flex", pack: "center", align: "center", containerCls: "panel", autoScroll: !0, buttons: { type: "button", text: "Ok", action: "ok" }, items: { type: "label", multiline: !0, maxWidth: 500, maxHeight: 200} }, this._super(e) }, Statics: { OK: 1, OK_CANCEL: 2, YES_NO: 3, YES_NO_CANCEL: 4, msgBox: function (n) { function r(e, t, n) { return { type: "button", text: e, subtype: n ? "primary" : "", onClick: function (e) { e.control.parents()[1].close(), o(t) } } } var i, o = n.callback || function () { }; switch (n.buttons) { case t.OK_CANCEL: i = [r("Ok", !0, !0), r("Cancel", !1)]; break; case t.YES_NO: case t.YES_NO_CANCEL: i = [r("Yes", 1, !0), r("No", 0)], n.buttons == t.YES_NO_CANCEL && i.push(r("Cancel", -1)); break; default: i = [r("Ok", !0, !0)] } return new e({ padding: 20, x: n.x, y: n.y, minWidth: 300, minHeight: 100, layout: "flex", pack: "center", align: "center", buttons: i, title: n.title, role: "alertdialog", items: { type: "label", multiline: !0, maxWidth: 500, maxHeight: 200, text: n.text }, onPostRender: function () { this.aria("describedby", this.items()[0]._id) }, onClose: n.onClose, onCancel: function () { o(!1) } }).renderTo(document.body).reflow() }, alert: function (e, n) { return "string" == typeof e && (e = { text: e }), e.callback = n, t.msgBox(e) }, confirm: function (e, n) { return "string" == typeof e && (e = { text: e }), e.callback = n, e.buttons = t.OK_CANCEL, t.msgBox(e) } } }); return t }), r(at, [it, ot], function (e, t) { return function (n) { function r() { return o.length ? o[o.length - 1] : void 0 } var i = this, o = []; i.windows = o, n.on("remove", function () { for (var e = o.length; e--; ) o[e].close() }), i.open = function (t, r) { var i; return n.editorManager.setActive(n), t.title = t.title || " ", t.url = t.url || t.file, t.url && (t.width = parseInt(t.width || 320, 10), t.height = parseInt(t.height || 240, 10)), t.body && (t.items = { defaults: t.defaults, type: t.bodyType || "form", items: t.body }), t.url || t.buttons || (t.buttons = [{ text: "Ok", subtype: "primary", onclick: function () { i.find("form")[0].submit() } }, { text: "Cancel", onclick: function () { i.close() } }]), i = new e(t), o.push(i), i.on("close", function () { for (var e = o.length; e--; ) o[e] === i && o.splice(e, 1); o.length || n.focus() }), t.data && i.on("postRender", function () { this.find("*").each(function (e) { var n = e.name(); n in t.data && e.value(t.data[n]) }) }), i.features = t || {}, i.params = r || {}, 1 === o.length && n.nodeChanged(), i.renderTo().reflow() }, i.alert = function (e, r, i) { t.alert(e, function () { r ? r.call(i || this) : n.focus() }) }, i.confirm = function (e, n, r) { t.confirm(e, function (e) { n.call(r || this, e) }) }, i.close = function () { r() && r().close() }, i.getParams = function () { return r() ? r().params : null }, i.setParams = function (e) { r() && (r().params = e) }, i.getWindows = function () { return o } } }), r(st, [B, x, _, g, d, u], function (e, t, n, r, i, o) { return function (a) { function s(e, t) { try { a.getDoc().execCommand(e, !1, t) } catch (n) { } } function l() { var e = a.getDoc().documentMode; return e ? e : 6 } function c(e) { return e.isDefaultPrevented() } function u() { function t(e) { var t = new i(function () { }); o.each(a.getBody().getElementsByTagName("*"), function (e) { "SPAN" == e.tagName && e.setAttribute("mce-data-marked", 1), !e.hasAttribute("data-mce-style") && e.hasAttribute("style") && a.dom.setAttrib(e, "style", a.dom.getAttrib(e, "style")) }), t.observe(a.getDoc(), { childList: !0, attributes: !0, subtree: !0, attributeFilter: ["style"] }), a.getDoc().execCommand(e ? "ForwardDelete" : "Delete", !1, null); var n = a.selection.getRng(), r = n.startContainer.parentNode; o.each(t.takeRecords(), function (e) { if (q.isChildOf(e.target, a.getBody())) { if ("style" == e.attributeName) { var t = e.target.getAttribute("data-mce-style"); t ? e.target.setAttribute("style", t) : e.target.removeAttribute("style") } o.each(e.addedNodes, function (e) { if ("SPAN" == e.nodeName && !e.getAttribute("mce-data-marked")) { var t, i; e == r && (t = n.startOffset, i = e.firstChild), q.remove(e, !0), i && (n.setStart(i, t), n.setEnd(i, t), a.selection.setRng(n)) } }) } }), t.disconnect(), o.each(a.dom.select("span[mce-data-marked]"), function (e) { e.removeAttribute("mce-data-marked") }) } var n = a.getDoc(), r = "data:text/mce-internal,", i = window.MutationObserver, s, l; i || (s = !0, i = function () { function e(e) { var t = e.relatedNode || e.target; n.push({ target: t, addedNodes: [t] }) } function t(e) { var t = e.relatedNode || e.target; n.push({ target: t, attributeName: e.attrName }) } var n = [], r; this.observe = function (n) { r = n, r.addEventListener("DOMSubtreeModified", e, !1), r.addEventListener("DOMNodeInsertedIntoDocument", e, !1), r.addEventListener("DOMNodeInserted", e, !1), r.addEventListener("DOMAttrModified", t, !1) }, this.disconnect = function () { r.removeEventListener("DOMSubtreeModified", e, !1), r.removeEventListener("DOMNodeInsertedIntoDocument", e, !1), r.removeEventListener("DOMNodeInserted", e, !1), r.removeEventListener("DOMAttrModified", t, !1) }, this.takeRecords = function () { return n } }), a.on("keydown", function (n) { var r = n.keyCode == $, i = e.metaKeyPressed(n); if (!c(n) && (r || n.keyCode == U)) { var o = a.selection.getRng(), s = o.startContainer, l = o.startOffset; if (!i && o.collapsed && 3 == s.nodeType && (r ? l < s.data.length : l > 0)) return; n.preventDefault(), i && a.selection.getSel().modify("extend", r ? "forward" : "backward", "word"), t(r) } }), a.on("keypress", function (n) { c(n) || j.isCollapsed() || !n.charCode || e.metaKeyPressed(n) || (n.preventDefault(), t(!0), a.selection.setContent(String.fromCharCode(n.charCode))) }), a.addCommand("Delete", function () { t() }), a.addCommand("ForwardDelete", function () { t(!0) }), s || (a.on("dragstart", function (e) { var t; a.selection.isCollapsed() && "IMG" == e.target.tagName && j.select(e.target), l = j.getRng(), t = a.selection.getContent(), t.length > 0 && e.dataTransfer.setData("URL", "data:text/mce-internal," + escape(t)) }), a.on("drop", function (e) { if (!c(e)) { var i = e.dataTransfer.getData("URL"); if (!i || -1 == i.indexOf(r) || !n.caretRangeFromPoint) return; i = unescape(i.substr(r.length)), n.caretRangeFromPoint && (e.preventDefault(), window.setTimeout(function () { var r = n.caretRangeFromPoint(e.x, e.y); l && (j.setRng(l), l = null), t(), j.setRng(r), a.insertContent(i) }, 0)) } }), a.on("cut", function (e) { !c(e) && e.clipboardData && (e.preventDefault(), e.clipboardData.clearData(), e.clipboardData.setData("text/html", a.selection.getContent()), e.clipboardData.setData("text/plain", a.selection.getContent({ format: "text" })), t(!0)) })) } function d() { function e(e) { var t = q.create("body"), n = e.cloneContents(); return t.appendChild(n), j.serializer.serialize(t, { format: "html" }) } function n(n) { if (!n.setStart) { if (n.item) return !1; var r = n.duplicate(); return r.moveToElementText(a.getBody()), t.compareRanges(n, r) } var i = e(n), o = q.createRng(); o.selectNode(a.getBody()); var s = e(o); return i === s } a.on("keydown", function (e) { var t = e.keyCode, r, i; if (!c(e) && (t == $ || t == U)) { if (r = a.selection.isCollapsed(), i = a.getBody(), r && !q.isEmpty(i)) return; if (!r && !n(a.selection.getRng())) return; e.preventDefault(), a.setContent(""), i.firstChild && q.isBlock(i.firstChild) ? a.selection.setCursorLocation(i.firstChild, 0) : a.selection.setCursorLocation(i, 0), a.nodeChanged() } }) } function f() { a.shortcuts.add("ctrl+a", null, "SelectAll") } function p() { a.settings.content_editable || (q.bind(a.getDoc(), "focusin", function () { j.setRng(j.getRng()) }), q.bind(a.getDoc(), "mousedown mouseup", function (e) { e.target == a.getDoc().documentElement && (a.getBody().focus(), "mousedown" == e.type ? j.placeCaretAt(e.clientX, e.clientY) : j.setRng(j.getRng())) })) } function h() { a.on("keydown", function (e) { if (!c(e) && e.keyCode === U) { if (!a.getBody().getElementsByTagName("hr").length) return; if (j.isCollapsed() && 0 === j.getRng(!0).startOffset) { var t = j.getNode(), n = t.previousSibling; if ("HR" == t.nodeName) return q.remove(t), void e.preventDefault(); n && n.nodeName && "hr" === n.nodeName.toLowerCase() && (q.remove(n), e.preventDefault()) } } }) } function m() { window.Range.prototype.getClientRects || a.on("mousedown", function (e) { if (!c(e) && "HTML" === e.target.nodeName) { var t = a.getBody(); t.blur(), setTimeout(function () { t.focus() }, 0) } }) } function g() { a.on("click", function (e) { var t = e.target; /^(IMG|HR)$/.test(t.nodeName) && (e.preventDefault(), j.getSel().setBaseAndExtent(t, 0, t, 1), a.nodeChanged()), "A" == t.nodeName && q.hasClass(t, "mce-item-anchor") && (e.preventDefault(), j.select(t)) }) } function v() { function e() { var e = q.getAttribs(j.getStart().cloneNode(!1)); return function () { var t = j.getStart(); t !== a.getBody() && (q.setAttrib(t, "style", null), V(e, function (e) { t.setAttributeNode(e.cloneNode(!0)) })) } } function t() { return !j.isCollapsed() && q.getParent(j.getStart(), q.isBlock) != q.getParent(j.getEnd(), q.isBlock) } a.on("keypress", function (n) { var r; return c(n) || 8 != n.keyCode && 46 != n.keyCode || !t() ? void 0 : (r = e(), a.getDoc().execCommand("delete", !1, null), r(), n.preventDefault(), !1) }), q.bind(a.getDoc(), "cut", function (n) { var r; !c(n) && t() && (r = e(), setTimeout(function () { r() }, 0)) }) } function y() { document.body.setAttribute("role", "application") } function b() { a.on("keydown", function (e) { if (!c(e) && e.keyCode === U && j.isCollapsed() && 0 === j.getRng(!0).startOffset) { var t = j.getNode().previousSibling; if (t && t.nodeName && "table" === t.nodeName.toLowerCase()) return e.preventDefault(), !1 } }) } function C() { l() > 7 || (s("RespectVisibilityInDesign", !0), a.contentStyles.push(".mceHideBrInPre pre br {display: none}"), q.addClass(a.getBody(), "mceHideBrInPre"), K.addNodeFilter("pre", function (e) { for (var t = e.length, r, i, o, a; t--; ) for (r = e[t].getAll("br"), i = r.length; i--; ) o = r[i], a = o.prev, a && 3 === a.type && "\n" != a.value.charAt(a.value - 1) ? a.value += "\n" : o.parent.insert(new n("#text", 3), o, !0).value = "\n" }), G.addNodeFilter("pre", function (e) { for (var t = e.length, n, r, i, o; t--; ) for (n = e[t].getAll("br"), r = n.length; r--; ) i = n[r], o = i.prev, o && 3 == o.type && (o.value = o.value.replace(/\r?\n$/, "")) })) } function x() { q.bind(a.getBody(), "mouseup", function () { var e, t = j.getNode(); "IMG" == t.nodeName && ((e = q.getStyle(t, "width")) && (q.setAttrib(t, "width", e.replace(/[^0-9%]+/g, "")), q.setStyle(t, "width", "")), (e = q.getStyle(t, "height")) && (q.setAttrib(t, "height", e.replace(/[^0-9%]+/g, "")), q.setStyle(t, "height", ""))) }) } function w() { a.on("keydown", function (t) { var n, r, i, o, s; if (!c(t) && t.keyCode == e.BACKSPACE && (n = j.getRng(), r = n.startContainer, i = n.startOffset, o = q.getRoot(), s = r, n.collapsed && 0 === i)) { for (; s && s.parentNode && s.parentNode.firstChild == s && s.parentNode != o; ) s = s.parentNode; "BLOCKQUOTE" === s.tagName && (a.formatter.toggle("blockquote", null, s), n = q.createRng(), n.setStart(r, 0), n.setEnd(r, 0), j.setRng(n)) } }) } function _() { function e() { a._refreshContentEditable(), s("StyleWithCSS", !1), s("enableInlineTableEditing", !1), Y.object_resizing || s("enableObjectResizing", !1) } Y.readonly || a.on("BeforeExecCommand MouseDown", e) } function E() { function e() { V(q.select("a"), function (e) { var t = e.parentNode, n = q.getRoot(); if (t.lastChild === e) { for (; t && !q.isBlock(t); ) { if (t.parentNode.lastChild !== t || t === n) return; t = t.parentNode } q.add(t, "br", { "data-mce-bogus": 1 }) } }) } a.on("SetContent ExecCommand", function (t) { ("setcontent" == t.type || "mceInsertLink" === t.command) && e() }) } function N() { Y.forced_root_block && a.on("init", function () { s("DefaultParagraphSeparator", Y.forced_root_block) }) } function k() { a.on("Undo Redo SetContent", function (e) { e.initial || a.execCommand("mceRepaint") }) } function S() { a.on("keydown", function (e) { var t; c(e) || e.keyCode != U || (t = a.getDoc().selection.createRange(), t && t.item && (e.preventDefault(), a.undoManager.beforeChange(), q.remove(t.item(0)), a.undoManager.add())) }) } function T() { var e; l() >= 10 && (e = "", V("p div h1 h2 h3 h4 h5 h6".split(" "), function (t, n) { e += (n > 0 ? "," : "") + t + ":empty" }), a.contentStyles.push(e + "{padding-right: 1px !important}")) } function R() { l() < 9 && (K.addNodeFilter("noscript", function (e) { for (var t = e.length, n, r; t--; ) n = e[t], r = n.firstChild, r && n.attr("data-mce-innertext", r.value) }), G.addNodeFilter("noscript", function (e) { for (var t = e.length, i, o, a; t--; ) i = e[t], o = e[t].firstChild, o ? o.value = r.decode(o.value) : (a = i.attributes.map["data-mce-innertext"], a && (i.attr("data-mce-innertext", null), o = new n("#text", 3), o.value = a, o.raw = !0, i.append(o))) })) } function A() { function e(e, t) { var n = i.createTextRange(); try { n.moveToPoint(e, t) } catch (r) { n = null } return n } function t(t) { var r; t.button ? (r = e(t.x, t.y), r && (r.compareEndPoints("StartToStart", a) > 0 ? r.setEndPoint("StartToStart", a) : r.setEndPoint("EndToEnd", a), r.select())) : n() } function n() { var e = r.selection.createRange(); a && !e.item && 0 === e.compareEndPoints("StartToEnd", e) && a.select(), q.unbind(r, "mouseup", n), q.unbind(r, "mousemove", t), a = o = 0 } var r = q.doc, i = r.body, o, a, s; r.documentElement.unselectable = !0, q.bind(r, "mousedown contextmenu", function (i) { if ("HTML" === i.target.nodeName) { if (o && n(), s = r.documentElement, s.scrollHeight > s.clientHeight) return; o = 1, a = e(i.x, i.y), a && (q.bind(r, "mouseup", n), q.bind(r, "mousemove", t), q.getRoot().focus(), a.select()) } }) } function B() { a.on("keyup focusin mouseup", function (t) { 65 == t.keyCode && e.metaKeyPressed(t) || j.normalize() }, !0) } function D() { a.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}") } function L() { a.inline || a.on("keydown", function () { document.activeElement == document.body && a.getWin().focus() }) } function H() { a.inline || (a.contentStyles.push("body {min-height: 150px}"), a.on("click", function (e) { "HTML" == e.target.nodeName && (a.getBody().focus(), a.selection.normalize(), a.nodeChanged()) })) } function M() { i.mac && a.on("keydown", function (t) { !e.metaKeyPressed(t) || 37 != t.keyCode && 39 != t.keyCode || (t.preventDefault(), a.selection.getSel().modify("move", 37 == t.keyCode ? "backward" : "forward", "word")) }) } function P() { s("AutoUrlDetect", !1) } function O() { a.inline || a.on("focus blur beforegetcontent", function () { var e = a.dom.create("br"); a.getBody().appendChild(e), e.parentNode.removeChild(e) }, !0) } function I() { a.on("click", function (e) { var t = e.target; do if ("A" === t.tagName) return void e.preventDefault(); while (t = t.parentNode) }), a.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}") } function F() { a.on("touchstart", function (e) { var t, n, r, i; t = e.target, n = (new Date).getTime(), i = e.changedTouches, !i || i.length > 1 || (r = i[0], a.once("touchend", function (e) { var i = e.changedTouches[0], o; (new Date).getTime() - n > 500 || Math.abs(r.clientX - i.clientX) > 5 || Math.abs(r.clientY - i.clientY) > 5 || (o = { target: t }, V("pageX pageY clientX clientY screenX screenY".split(" "), function (e) { o[e] = i[e] }), o = a.fire("click", o), o.isDefaultPrevented() || (a.selection.placeCaretAt(i.clientX, i.clientY), a.nodeChanged())) })) }) } function z() { a.on("init", function () { a.dom.bind(a.getBody(), "submit", function (e) { e.preventDefault() }) }) } function W() { K.addNodeFilter("br", function (e) { for (var t = e.length; t--; ) "Apple-interchange-newline" == e[t].attr("class") && e[t].remove() }) } var V = o.each, U = e.BACKSPACE, $ = e.DELETE, q = a.dom, j = a.selection, Y = a.settings, K = a.parser, G = a.serializer, X = i.gecko, J = i.ie, Q = i.webkit; w(), d(), B(), Q && (u(), p(), g(), N(), z(), b(), W(), F(), i.iOS ? (L(), H(), I()) : f()), J && i.ie < 11 && (h(), y(), C(), x(), S(), T(), R(), A()), i.ie >= 11 && (H(), O(), b()), i.ie && (f(), P()), X && (h(), m(), v(), _(), E(), k(), D(), M(), b()) } }), r(lt, [$], function (e) { function t(t) { return t._eventDispatcher || (t._eventDispatcher = new e({ scope: t, toggleEvent: function (n, r) { e.isNative(n) && t.toggleNativeEvent && t.toggleNativeEvent(n, r) } })), t._eventDispatcher } return { fire: function (e, n, r) { var i = this; if (i.removed && "remove" !== e) return n; if (n = t(i).fire(e, n, r), r !== !1 && i.parent) for (var o = i.parent(); o && !n.isPropagationStopped(); ) o.fire(e, n, !1), o = o.parent(); return n }, on: function (e, n, r) { return t(this).on(e, n, r) }, off: function (e, n) { return t(this).off(e, n) }, once: function (e, n) { return t(this).once(e, n) }, hasEventListeners: function (e) { return t(this).has(e) } } }), r(ct, [lt, y, u], function (e, t, n) { function r(e, t) { return "selectionchange" == t ? e.getDoc() : !e.inline && /^mouse|click|contextmenu|drop|dragover|dragend/.test(t) ? e.getDoc().documentElement : e.settings.event_root ? (e.eventRoot || (e.eventRoot = o.select(e.settings.event_root)[0]), e.eventRoot) : e.getBody() } function i(e, t) { var n = r(e, t), i; if (e.delegates || (e.delegates = {}), !e.delegates[t]) if (e.settings.event_root) { if (a || (a = {}, e.editorManager.on("removeEditor", function () { var t; if (!e.editorManager.activeEditor && a) { for (t in a) e.dom.unbind(r(e, t)); a = null } })), a[t]) return; i = function (n) { for (var r = n.target, i = e.editorManager.editors, a = i.length; a--; ) { var s = i[a].getBody(); (s === r || o.isChildOf(r, s)) && (i[a].hidden || i[a].fire(t, n)) } }, a[t] = i, o.bind(n, t, i) } else i = function (n) { e.hidden || e.fire(t, n) }, o.bind(n, t, i), e.delegates[t] = i } var o = t.DOM, a, s = { bindPendingEventDelegates: function () { var e = this; n.each(e._pendingNativeEvents, function (t) { i(e, t) }) }, toggleNativeEvent: function (e, t) { var n = this; n.settings.readonly || "focus" != e && "blur" != e && (t ? n.initialized ? i(n, e) : n._pendingNativeEvents ? n._pendingNativeEvents.push(e) : n._pendingNativeEvents = [e] : n.initialized && (n.dom.unbind(r(n, e), e, n.delegates[e]), delete n.delegates[e])) }, unbindAllNativeEvents: function () { var e = this, t; if (e.delegates) { for (t in e.delegates) e.dom.unbind(r(e, t), t, e.delegates[t]); delete e.delegates } e.inline || (e.getBody().onload = null, e.dom.unbind(e.getWin()), e.dom.unbind(e.getDoc())), e.dom.unbind(e.getBody()), e.dom.unbind(e.getContainer()) } }; return s = n.extend({}, e, s) }), r(ut, [u, d], function (e, t) { var n = e.each, r = e.explode, i = { f9: 120, f10: 121, f11: 122 }; return function (o) { var a = this, s = {}; o.on("keyup keypress keydown", function (e) { (e.altKey || e.ctrlKey || e.metaKey) && !e.isDefaultPrevented() && n(s, function (n) { var r = t.mac ? e.metaKey : e.ctrlKey; if (n.ctrl == r && n.alt == e.altKey && n.shift == e.shiftKey) return e.keyCode == n.keyCode || e.charCode && e.charCode == n.charCode ? (e.preventDefault(), "keydown" == e.type && n.func.call(n.scope), !0) : void 0 }) }), a.add = function (t, a, l, c) { var u; return u = l, "string" == typeof l ? l = function () { o.execCommand(u, !1, null) } : e.isArray(u) && (l = function () { o.execCommand(u[0], u[1], u[2]) }), n(r(t.toLowerCase()), function (e) { var t = { func: l, scope: c || o, desc: o.translate(a), alt: !1, ctrl: !1, shift: !1 }; n(r(e, "+"), function (e) { switch (e) { case "alt": case "ctrl": case "shift": t[e] = !0; break; default: /^[0-9]{2,}$/.test(e) ? t.keyCode = parseInt(e, 10) : (t.charCode = e.charCodeAt(0), t.keyCode = i[e] || e.toUpperCase().charCodeAt(0)) } }), s[(t.ctrl ? "ctrl" : "") + "," + (t.alt ? "alt" : "") + "," + (t.shift ? "shift" : "") + "," + t.keyCode] = t }), !0 } } }), r(dt, [y, f, C, w, _, R, T, H, O, I, F, z, W, V, b, l, at, E, k, st, d, u, ct, ut], function (e, n, r, i, o, a, s, l, c, u, d, f, p, h, m, g, v, y, b, C, x, w, _, E) { function N(e, t, i) { var o = this, a, s; a = o.documentBaseUrl = i.documentBaseURL, s = i.baseURI, o.settings = t = R({ id: e, theme: "modern", delta_width: 0, delta_height: 0, popup_css: "", plugins: "", document_base_url: a, add_form_submit_trigger: !0, submit_patch: !0, add_unload_trigger: !0, convert_urls: !0, relative_urls: !0, remove_script_host: !0, object_resizing: !0, doctype: "<!DOCTYPE html>", visual: !0, font_size_style_values: "xx-small,x-small,small,medium,large,x-large,xx-large", font_size_legacy_values: "xx-small,small,medium,large,x-large,xx-large,300%", forced_root_block: "p", hidden_input: !0, padd_empty_editor: !0, render_ui: !0, indentation: "30px", inline_styles: !0, convert_fonts_to_spans: !0, indent: "simple", indent_before: "p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist", indent_after: "p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist", validate: !0, entity_encoding: "named", url_converter: o.convertURL, url_converter_scope: o, ie7_compat: !0 }, t), r.language = t.language || "en", r.languageLoad = t.language_load, r.baseURL = i.baseURL, o.id = t.id = e, o.isNotDirty = !0, o.plugins = {}, o.documentBaseURI = new h(t.document_base_url || a, { base_uri: s }), o.baseURI = s, o.contentCSS = [], o.contentStyles = [], o.shortcuts = new E(o), o.execCommands = {}, o.queryStateCommands = {}, o.queryValueCommands = {}, o.loadedCSS = {}, t.target && (o.targetElm = t.target), o.suffix = i.suffix, o.editorManager = i, o.inline = t.inline, i.fire("SetupEditor", o), o.execCallback("setup", o), o.$ = n.overrideDefaults(function () { return { context: o.inline ? o.getBody() : o.getDoc(), element: o.getBody()} }) } var k = e.DOM, S = r.ThemeManager, T = r.PluginManager, R = w.extend, A = w.each, B = w.explode, D = w.inArray, L = w.trim, H = w.resolve, M = g.Event, P = x.gecko, O = x.ie; return N.prototype = { render: function () { function e() { k.unbind(window, "ready", e), n.render() } function t() { var e = m.ScriptLoader; if (r.language && "en" != r.language && !r.language_url && (r.language_url = n.editorManager.baseURL + "/langs/" + r.language + ".js"), r.language_url && e.add(r.language_url), r.theme && "function" != typeof r.theme && "-" != r.theme.charAt(0) && !S.urls[r.theme]) { var t = r.theme_url; t = t ? n.documentBaseURI.toAbsolute(t) : "themes/" + r.theme + "/theme" + o + ".js", S.load(r.theme, t) } w.isArray(r.plugins) && (r.plugins = r.plugins.join(" ")), A(r.external_plugins, function (e, t) { T.load(t, e), r.plugins += " " + t }), A(r.plugins.split(/[ ,]/), function (e) { if (e = L(e), e && !T.urls[e]) if ("-" == e.charAt(0)) { e = e.substr(1, e.length); var t = T.dependencies(e); A(t, function (e) { var t = { prefix: "plugins/", resource: e, suffix: "/plugin" + o + ".js" }; e = T.createUrl(t, e), T.load(e.resource, e) }) } else T.load(e, { prefix: "plugins/", resource: e, suffix: "/plugin" + o + ".js" }) }), e.loadQueue(function () { n.removed || n.init() }) } var n = this, r = n.settings, i = n.id, o = n.suffix; if (!M.domLoaded) return void k.bind(window, "ready", e); if (n.getElement() && x.contentEditable) { r.inline ? n.inline = !0 : (n.orgVisibility = n.getElement().style.visibility, n.getElement().style.visibility = "hidden"); var a = n.getElement().form || k.getParent(i, "form"); a && (n.formElement = a, r.hidden_input && !/TEXTAREA|INPUT/i.test(n.getElement().nodeName) && (k.insertAfter(k.create("input", { type: "hidden", name: i }), i), n.hasHiddenInput = !0), n.formEventDelegate = function (e) { n.fire(e.type, e) }, k.bind(a, "submit reset", n.formEventDelegate), n.on("reset", function () { n.setContent(n.startContent, { format: "raw" }) }), !r.submit_patch || a.submit.nodeType || a.submit.length || a._mceOldSubmit || (a._mceOldSubmit = a.submit, a.submit = function () { return n.editorManager.triggerSave(), n.isNotDirty = !0, a._mceOldSubmit(a) })), n.windowManager = new v(n), "xml" == r.encoding && n.on("GetContent", function (e) { e.save && (e.content = k.encode(e.content)) }), r.add_form_submit_trigger && n.on("submit", function () { n.initialized && n.save() }), r.add_unload_trigger && (n._beforeUnload = function () { !n.initialized || n.destroyed || n.isHidden() || n.save({ format: "raw", no_events: !0, set_dirty: !1 }) }, n.editorManager.on("BeforeUnload", n._beforeUnload)), t() } }, init: function () { function e(n) { var r = T.get(n), i, o; i = T.urls[n] || t.documentBaseUrl.replace(/\/$/, ""), n = L(n), r && -1 === D(m, n) && (A(T.dependencies(n), function (t) { e(t) }), o = new r(t, i, t.$), t.plugins[n] = o, o.init && (o.init(t, i), m.push(n))) } var t = this, n = t.settings, r = t.getElement(), i, o, a, s, l, c, u, d, f, p, h, m = []; if (t.rtl = this.editorManager.i18n.rtl, t.editorManager.add(t), n.aria_label = n.aria_label || k.getAttrib(r, "aria-label", t.getLang("aria.rich_text_area")), n.theme && ("function" != typeof n.theme ? (n.theme = n.theme.replace(/-/, ""), c = S.get(n.theme), t.theme = new c(t, S.urls[n.theme]), t.theme.init && t.theme.init(t, S.urls[n.theme] || t.documentBaseUrl.replace(/\/$/, ""), t.$)) : t.theme = n.theme), A(n.plugins.replace(/\-/g, "").split(/[ ,]/), e), n.render_ui && t.theme && (t.orgDisplay = r.style.display, "function" != typeof n.theme ? (i = n.width || r.style.width || r.offsetWidth, o = n.height || r.style.height || r.offsetHeight, a = n.min_height || 100, p = /^[0-9\.]+(|px)$/i, p.test("" + i) && (i = Math.max(parseInt(i, 10), 100)), p.test("" + o) && (o = Math.max(parseInt(o, 10), a)), l = t.theme.renderUI({ targetNode: r, width: i, height: o, deltaWidth: n.delta_width, deltaHeight: n.delta_height }), n.content_editable || (o = (l.iframeHeight || o) + ("number" == typeof o ? l.deltaHeight || 0 : ""), a > o && (o = a))) : (l = n.theme(t, r), l.editorContainer.nodeType && (l.editorContainer = l.editorContainer.id = l.editorContainer.id || t.id + "_parent"), l.iframeContainer.nodeType && (l.iframeContainer = l.iframeContainer.id = l.iframeContainer.id || t.id + "_iframecontainer"), o = l.iframeHeight || r.offsetHeight), t.editorContainer = l.editorContainer), n.content_css && A(B(n.content_css), function (e) { t.contentCSS.push(t.documentBaseURI.toAbsolute(e)) }), n.content_style && t.contentStyles.push(n.content_style), n.content_editable) return r = s = l = null, t.initContentBody(); for (t.iframeHTML = n.doctype + "<html><head>", n.document_base_url != t.documentBaseUrl && (t.iframeHTML += '<base href="' + t.documentBaseURI.getURI() + '" />'), !x.caretAfter && n.ie7_compat && (t.iframeHTML += '<meta http-equiv="X-UA-Compatible" content="IE=7" />'), t.iframeHTML += '<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />', h = 0; h < t.contentCSS.length; h++) { var g = t.contentCSS[h]; /*t.iframeHTML+='<link type="text/css" rel="stylesheet" href="'+g+'" />',t.loadedCSS[g]=!0*/ } d = n.body_id || "tinymce", -1 != d.indexOf("=") && (d = t.getParam("body_id", "", "hash"), d = d[t.id] || d), f = n.body_class || "", -1 != f.indexOf("=") && (f = t.getParam("body_class", "", "hash"), f = f[t.id] || ""), n.content_security_policy && (t.iframeHTML += '<meta http-equiv="Content-Security-Policy" content="' + n.content_security_policy + '" />'), t.iframeHTML += '</head><body id="' + d + '" class="mce-content-body ' + f + '" data-id="' + t.id + '"><br></body></html>'; var v = 'javascript:(function(){document.open();document.domain="' + document.domain + '";var ed = window.parent.tinymce.get("' + t.id + '");document.write(ed.iframeHTML);document.close();ed.initContentBody(true);})()'; document.domain != location.hostname && (u = v); var y = k.create("iframe", { id: t.id + "_ifr", frameBorder: "0", allowTransparency: "true", title: t.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"), style: { width: "100%", height: o, display: "block"} }); if (y.onload = function () { y.onload = null, t.fire("load") }, k.setAttrib(y, "src", u || 'javascript:""'), t.contentAreaContainer = l.iframeContainer, t.iframeElement = y, s = k.add(l.iframeContainer, y), O) try { t.getDoc() } catch (b) { s.src = u = v } l.editorContainer && (k.get(l.editorContainer).style.display = t.orgDisplay, t.hidden = k.isHidden(l.editorContainer)), t.getElement().style.display = "none", k.setAttrib(t.id, "aria-hidden", !0), u || t.initContentBody(), r = s = l = null }, initContentBody: function (t) { var n = this, r = n.settings, s = n.getElement(), h = n.getDoc(), m, g; r.inline || (n.getElement().style.visibility = n.orgVisibility), t || r.content_editable || (h.open(), h.write(n.iframeHTML), h.close()), r.content_editable && (n.on("remove", function () { var e = this.getBody(); k.removeClass(e, "mce-content-body"), k.removeClass(e, "mce-edit-focus"), k.setAttrib(e, "contentEditable", null) }), k.addClass(s, "mce-content-body"), n.contentDocument = h = r.content_document || document, n.contentWindow = r.content_window || window, n.bodyElement = s, r.content_document = r.content_window = null, r.root_name = s.nodeName.toLowerCase()), m = n.getBody(), m.disabled = !0, r.readonly || (n.inline && "static" == k.getStyle(m, "position", !0) && (m.style.position = "relative"), m.contentEditable = n.getParam("content_editable_state", !0)), m.disabled = !1, n.schema = new y(r), n.dom = new e(h, { keep_values: !0, url_converter: n.convertURL, url_converter_scope: n, hex_colors: r.force_hex_style_colors, class_filter: r.class_filter, update_styles: !0, root_element: n.inline ? n.getBody() : null, collect: r.content_editable, schema: n.schema, onSetAttrib: function (e) { n.fire("SetAttrib", e) } }), n.parser = new b(r, n.schema), n.parser.addAttributeFilter("src,href,style,tabindex", function (e, t) { for (var r = e.length, i, o = n.dom, a, s; r--; ) i = e[r], a = i.attr(t), s = "data-mce-" + t, i.attributes.map[s] || ("style" === t ? (a = o.serializeStyle(o.parseStyle(a), i.name), a.length || (a = null), i.attr(s, a), i.attr(t, a)) : "tabindex" === t ? (i.attr(s, a), i.attr(t, null)) : i.attr(s, n.convertURL(a, t, i.name))) }), n.parser.addNodeFilter("script", function (e) { for (var t = e.length, n; t--; ) n = e[t], n.attr("type", "mce-" + (n.attr("type") || "no/type")) }), n.parser.addNodeFilter("#cdata", function (e) { for (var t = e.length, n; t--; ) n = e[t], n.type = 8, n.name = "#comment", n.value = "[CDATA[" + n.value + "]]" }), n.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div", function (e) { for (var t = e.length, r, i = n.schema.getNonEmptyElements(); t--; ) r = e[t], r.isEmpty(i) && (r.append(new o("br", 1)).shortEnded = !0) }), n.serializer = new a(r, n), n.selection = new l(n.dom, n.getWin(), n.serializer, n), n.formatter = new c(n), n.undoManager = new u(n), n.forceBlocks = new f(n), n.enterKey = new d(n), n.editorCommands = new p(n), n._nodeChangeDispatcher = new i(n), n.fire("PreInit"), r.browser_spellcheck || r.gecko_spellcheck || (h.body.spellcheck = !1, k.setAttrib(m, "spellcheck", "false")), n.fire("PostRender"), n.quirks = new C(n), r.directionality && (m.dir = r.directionality), r.nowrap && (m.style.whiteSpace = "nowrap"), r.protect && n.on("BeforeSetContent", function (e) { A(r.protect, function (t) { e.content = e.content.replace(t, function (e) { return "<!--mce:protected " + escape(e) + "-->" }) }) }), n.on("SetContent", function () { n.addVisual(n.getBody()) }), r.padd_empty_editor && n.on("PostProcess", function (e) { e.content = e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/, "") }), n.load({ initial: !0, format: "html" }), n.startContent = n.getContent({ format: "raw" }), n.initialized = !0, n.bindPendingEventDelegates(), n.fire("init"), n.focus(!0), n.nodeChanged({ initial: !0 }), n.execCallback("init_instance_callback", n), n.contentStyles.length > 0 && (g = "", A(n.contentStyles, function (e) { g += e + "\r\n" }), n.dom.addStyle(g)), A(n.contentCSS, function (e) { n.loadedCSS[e] || (/*n.dom.loadCSS(e)*/true, n.loadedCSS[e] = !0) }), r.auto_focus && setTimeout(function () { var e; e = r.auto_focus === !0 ? n : n.editorManager.get(r.auto_focus), e.focus() }, 100), s = h = m = null }, focus: function (e) { var t = this, n = t.selection, r = t.settings.content_editable, i, o, a = t.getDoc(), s; if (!e) { if (i = n.getRng(), i.item && (o = i.item(0)), t._refreshContentEditable(), r || (x.opera || t.getBody().focus(), t.getWin().focus()), P || r) { if (s = t.getBody(), s.setActive) try { s.setActive() } catch (l) { s.focus() } else s.focus(); r && n.normalize() } o && o.ownerDocument == a && (i = a.body.createControlRange(), i.addElement(o), i.select()) } t.editorManager.setActive(t) }, execCallback: function (e) { var t = this, n = t.settings[e], r; if (n) return t.callbackLookup && (r = t.callbackLookup[e]) && (n = r.func, r = r.scope), "string" == typeof n && (r = n.replace(/\.\w+$/, ""), r = r ? H(r) : 0, n = H(n), t.callbackLookup = t.callbackLookup || {}, t.callbackLookup[e] = { func: n, scope: r }), n.apply(r || t, Array.prototype.slice.call(arguments, 1)) }, translate: function (e) { var t = this.settings.language || "en", n = this.editorManager.i18n; return e ? n.data[t + "." + e] || e.replace(/\{\#([^\}]+)\}/g, function (e, r) { return n.data[t + "." + r] || "{#" + r + "}" }) : "" }, getLang: function (e, n) { return this.editorManager.i18n.data[(this.settings.language || "en") + "." + e] || (n !== t ? n : "{#" + e + "}") }, getParam: function (e, t, n) { var r = e in this.settings ? this.settings[e] : t, i; return "hash" === n ? (i = {}, "string" == typeof r ? A(r.split(r.indexOf("=") > 0 ? /[;,](?![^=;,]*(?:[;,]|$))/ : ","), function (e) { e = e.split("="), i[L(e[0])] = L(e.length > 1 ? e[1] : e) }) : i = r, i) : r }, nodeChanged: function (e) { this._nodeChangeDispatcher.nodeChanged(e) }, addButton: function (e, t) { var n = this; t.cmd && (t.onclick = function () { n.execCommand(t.cmd) }), t.text || t.icon || (t.icon = e), n.buttons = n.buttons || {}, t.tooltip = t.tooltip || t.title, n.buttons[e] = t }, addMenuItem: function (e, t) { var n = this; t.cmd && (t.onclick = function () { n.execCommand(t.cmd) }), n.menuItems = n.menuItems || {}, n.menuItems[e] = t }, addCommand: function (e, t, n) { this.execCommands[e] = { func: t, scope: n || this} }, addQueryStateHandler: function (e, t, n) { this.queryStateCommands[e] = { func: t, scope: n || this} }, addQueryValueHandler: function (e, t, n) { this.queryValueCommands[e] = { func: t, scope: n || this} }, addShortcut: function (e, t, n, r) { this.shortcuts.add(e, t, n, r) }, execCommand: function (e, t, n, r) { var i = this, o = 0, a; if (/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(e) || r && r.skip_focus || i.focus(), r = R({}, r), r = i.fire("BeforeExecCommand", { command: e, ui: t, value: n }), r.isDefaultPrevented()) return !1; if ((a = i.execCommands[e]) && a.func.call(a.scope, t, n) !== !0) return i.fire("ExecCommand", { command: e, ui: t, value: n }), !0; if (A(i.plugins, function (r) { return r.execCommand && r.execCommand(e, t, n) ? (i.fire("ExecCommand", { command: e, ui: t, value: n }), o = !0, !1) : void 0 }), o) return o; if (i.theme && i.theme.execCommand && i.theme.execCommand(e, t, n)) return i.fire("ExecCommand", { command: e, ui: t, value: n }), !0; if (i.editorCommands.execCommand(e, t, n)) return i.fire("ExecCommand", { command: e, ui: t, value: n }), !0; try { o = i.getDoc().execCommand(e, t, n) } catch (s) { } return o ? (i.fire("ExecCommand", { command: e, ui: t, value: n }), !0) : !1 }, queryCommandState: function (e) { var t = this, n, r; if (!t._isHidden()) { if ((n = t.queryStateCommands[e]) && (r = n.func.call(n.scope), r === !0 || r === !1)) return r; if (r = t.editorCommands.queryCommandState(e), -1 !== r) return r; try { return t.getDoc().queryCommandState(e) } catch (i) { } } }, queryCommandValue: function (e) { var n = this, r, i; if (!n._isHidden()) { if ((r = n.queryValueCommands[e]) && (i = r.func.call(r.scope), i !== !0)) return i; if (i = n.editorCommands.queryCommandValue(e), i !== t) return i; try { return n.getDoc().queryCommandValue(e) } catch (o) { } } }, show: function () { var e = this; e.hidden && (e.hidden = !1, e.inline ? e.getBody().contentEditable = !0 : (k.show(e.getContainer()), k.hide(e.id)), e.load(), e.fire("show")) }, hide: function () { var e = this, t = e.getDoc(); e.hidden || (O && t && !e.inline && t.execCommand("SelectAll"), e.save(), e.inline ? (e.getBody().contentEditable = !1, e == e.editorManager.focusedEditor && (e.editorManager.focusedEditor = null)) : (k.hide(e.getContainer()), k.setStyle(e.id, "display", e.orgDisplay)), e.hidden = !0, e.fire("hide")) }, isHidden: function () { return !!this.hidden }, setProgressState: function (e, t) { this.fire("ProgressState", { state: e, time: t }) }, load: function (e) { var n = this, r = n.getElement(), i; return r ? (e = e || {}, e.load = !0, i = n.setContent(r.value !== t ? r.value : r.innerHTML, e), e.element = r, e.no_events || n.fire("LoadContent", e), e.element = r = null, i) : void 0 }, save: function (e) { var t = this, n = t.getElement(), r, i; if (n && t.initialized) return e = e || {}, e.save = !0, e.element = n, r = e.content = t.getContent(e), e.no_events || t.fire("SaveContent", e), r = e.content, /TEXTAREA|INPUT/i.test(n.nodeName) ? n.value = r : (t.inline || (n.innerHTML = r), (i = k.getParent(t.id, "form")) && A(i.elements, function (e) { return e.name == t.id ? (e.value = r, !1) : void 0 })), e.element = n = null, e.set_dirty !== !1 && (t.isNotDirty = !0), r }, setContent: function (e, t) { var n = this, r = n.getBody(), i; return t = t || {}, t.format = t.format || "html", t.set = !0, t.content = e, t.no_events || n.fire("BeforeSetContent", t), e = t.content, 0 === e.length || /^\s+$/.test(e) ? (i = n.settings.forced_root_block, i && n.schema.isValidChild(r.nodeName.toLowerCase(), i.toLowerCase()) ? (e = O && 11 > O ? "" : '<br data-mce-bogus="1">', e = n.dom.createHTML(i, n.settings.forced_root_block_attrs, e)) : O || (e = '<br data-mce-bogus="1">'), n.dom.setHTML(r, e), n.fire("SetContent", t)) : ("raw" !== t.format && (e = new s({}, n.schema).serialize(n.parser.parse(e, { isRootContent: !0 }))), t.content = L(e), n.dom.setHTML(r, t.content), t.no_events || n.fire("SetContent", t)), t.content }, getContent: function (e) { var t = this, n, r = t.getBody(); return e = e || {}, e.format = e.format || "html", e.get = !0, e.getInner = !0, e.no_events || t.fire("BeforeGetContent", e), n = "raw" == e.format ? r.innerHTML : "text" == e.format ? r.innerText || r.textContent : t.serializer.serialize(r, e), e.content = "text" != e.format ? L(n) : n, e.no_events || t.fire("GetContent", e), e.content }, insertContent: function (e, t) { t && (e = R({ content: e }, t)), this.execCommand("mceInsertContent", !1, e) }, isDirty: function () { return !this.isNotDirty }, getContainer: function () { var e = this; return e.container || (e.container = k.get(e.editorContainer || e.id + "_parent")), e.container }, getContentAreaContainer: function () { return this.contentAreaContainer }, getElement: function () { return this.targetElm || (this.targetElm = k.get(this.id)), this.targetElm }, getWin: function () { var e = this, t; return e.contentWindow || (t = e.iframeElement, t && (e.contentWindow = t.contentWindow)), e.contentWindow }, getDoc: function () { var e = this, t; return e.contentDocument || (t = e.getWin(), t && (e.contentDocument = t.document)), e.contentDocument }, getBody: function () { return this.bodyElement || this.getDoc().body }, convertURL: function (e, t, n) { var r = this, i = r.settings; return i.urlconverter_callback ? r.execCallback("urlconverter_callback", e, n, !0, t) : !i.convert_urls || n && "LINK" == n.nodeName || 0 === e.indexOf("file:") || 0 === e.length ? e : i.relative_urls ? r.documentBaseURI.toRelative(e) : e = r.documentBaseURI.toAbsolute(e, i.remove_script_host) }, addVisual: function (e) { var n = this, r = n.settings, i = n.dom, o; e = e || n.getBody(), n.hasVisual === t && (n.hasVisual = r.visual), A(i.select("table,a", e), function (e) { var t; switch (e.nodeName) { case "TABLE": return o = r.visual_table_class || "mce-item-table", t = i.getAttrib(e, "border"), void (t && "0" != t || !n.hasVisual ? i.removeClass(e, o) : i.addClass(e, o)); case "A": return void (i.getAttrib(e, "href", !1) || (t = i.getAttrib(e, "name") || e.id, o = r.visual_anchor_class || "mce-item-anchor", t && n.hasVisual ? i.addClass(e, o) : i.removeClass(e, o))) } }), n.fire("VisualAid", { element: e, hasVisual: n.hasVisual }) }, remove: function () { var e = this; e.removed || (e.save(), e.removed = 1, e.unbindAllNativeEvents(), e.hasHiddenInput && k.remove(e.getElement().nextSibling), e.inline || (O && 10 > O && e.getDoc().execCommand("SelectAll", !1, null), k.setStyle(e.id, "display", e.orgDisplay), e.getBody().onload = null), e.fire("remove"), e.editorManager.remove(e), k.remove(e.getContainer()), e.destroy()) }, destroy: function (e) { var t = this, n; if (!t.destroyed) { if (!e && !t.removed) return void t.remove(); e || (t.editorManager.off("beforeunload", t._beforeUnload), t.theme && t.theme.destroy && t.theme.destroy(), t.selection.destroy(), t.dom.destroy()), n = t.formElement, n && (n._mceOldSubmit && (n.submit = n._mceOldSubmit, n._mceOldSubmit = null), k.unbind(n, "submit reset", t.formEventDelegate)), t.contentAreaContainer = t.formElement = t.container = t.editorContainer = null, t.bodyElement = t.contentDocument = t.contentWindow = null, t.iframeElement = t.targetElm = null, t.selection && (t.selection = t.selection.win = t.selection.dom = t.selection.dom.doc = null), t.destroyed = 1 } }, _refreshContentEditable: function () { var e = this, t, n; e._isHidden() && (t = e.getBody(), n = t.parentNode, n.removeChild(t), n.appendChild(t), t.focus()) }, _isHidden: function () { var e; return P ? (e = this.selection.getSel(), !e || !e.rangeCount || 0 === e.rangeCount) : 0 } }, R(N.prototype, _), N }), r(ft, [], function () { var e = {}; return { rtl: !1, add: function (t, n) { for (var r in n) e[r] = n[r]; this.rtl = this.rtl || "rtl" === e._dir }, translate: function (t) { if ("undefined" == typeof t) return t; if ("string" != typeof t && t.raw) return t.raw; if (t.push) { var n = t.slice(1); t = (e[t[0]] || t[0]).replace(/\{([^\}]+)\}/g, function (e, t) { return n[t] }) } return e[t] || t }, data: e} }), r(pt, [y, d], function (e, t) { function n(e) { function s() { try { return document.activeElement } catch (e) { return document.body } } function l(e, t) { if (t && t.startContainer) { if (!e.isChildOf(t.startContainer, e.getRoot()) || !e.isChildOf(t.endContainer, e.getRoot())) return; return { startContainer: t.startContainer, startOffset: t.startOffset, endContainer: t.endContainer, endOffset: t.endOffset} } return t } function c(e, t) { var n; return t.startContainer ? (n = e.getDoc().createRange(), n.setStart(t.startContainer, t.startOffset), n.setEnd(t.endContainer, t.endOffset)) : n = t, n } function u(e) { return !!a.getParent(e, n.isEditorUIElement) } function d(n) { var d = n.editor; d.on("init", function () { (d.inline || t.ie) && ("onbeforedeactivate" in document && t.ie < 9 ? d.dom.bind(d.getBody(), "beforedeactivate", function (e) { if (e.target == d.getBody()) try { d.lastRng = d.selection.getRng() } catch (t) { } }) : d.on("nodechange mouseup keyup", function (e) { var t = s(); "nodechange" == e.type && e.selectionChange || (t && t.id == d.id + "_ifr" && (t = d.getBody()), d.dom.isChildOf(t, d.getBody()) && (d.lastRng = d.selection.getRng())) }), t.webkit && !r && (r = function () { var t = e.activeEditor; if (t && t.selection) { var n = t.selection.getRng(); n && !n.collapsed && (d.lastRng = n) } }, a.bind(document, "selectionchange", r))) }), d.on("setcontent", function () { d.lastRng = null }), d.on("mousedown", function () { d.selection.lastFocusBookmark = null }), d.on("focusin", function () { var t = e.focusedEditor; d.selection.lastFocusBookmark && (d.selection.setRng(c(d, d.selection.lastFocusBookmark)), d.selection.lastFocusBookmark = null), t != d && (t && t.fire("blur", { focusedEditor: d }), e.setActive(d), e.focusedEditor = d, d.fire("focus", { blurredEditor: t }), d.focus(!0)), d.lastRng = null }), d.on("focusout", function () { window.setTimeout(function () { var t = e.focusedEditor; u(s()) || t != d || (d.fire("blur", { focusedEditor: null }), e.focusedEditor = null, d.selection && (d.selection.lastFocusBookmark = null)) }, 0) }), i || (i = function (t) { var n = e.activeEditor; n && t.target.ownerDocument == document && (n.selection && t.target != n.getBody() && (n.selection.lastFocusBookmark = l(n.dom, n.lastRng)), t.target == document.body || u(t.target) || e.focusedEditor != n || (n.fire("blur", { focusedEditor: null }), e.focusedEditor = null)) }, a.bind(document, "focusin", i)), d.inline && !o && (o = function (t) { var n = e.activeEditor; if (n.inline && !n.dom.isChildOf(t.target, n.getBody())) { var r = n.selection.getRng(); r.collapsed || (n.lastRng = r) } }, a.bind(document, "mouseup", o)) } function f(t) { e.focusedEditor == t.editor && (e.focusedEditor = null), e.activeEditor || (a.unbind(document, "selectionchange", r), a.unbind(document, "focusin", i), a.unbind(document, "mouseup", o), r = i = o = null) } e.on("AddEditor", d), e.on("RemoveEditor", f) } var r, i, o, a = e.DOM; return n.isEditorUIElement = function (e) { return -1 !== e.className.toString().indexOf("mce-") }, n }), r(ht, [dt, f, y, V, d, u, lt, ft, pt], function (e, t, n, r, i, o, a, s, l) { function c(e) { var t = v.editors, n; delete t[e.id]; for (var r = 0; r < t.length; r++) if (t[r] == e) { t.splice(r, 1), n = !0; break } return v.activeEditor == e && (v.activeEditor = t[0]), v.focusedEditor == e && (v.focusedEditor = null), n } function u(e) { return e && !(e.getContainer() || e.getBody()).parentNode && (c(e), e.unbindAllNativeEvents(), e.destroy(!0), e = null), e } var d = n.DOM, f = o.explode, p = o.each, h = o.extend, m = 0, g, v; return v = { $: t, majorVersion: "4", minorVersion: "1.6", releaseDate: "2014-10-08", editors: [], i18n: s, activeEditor: null, setup: function () { var e = this, t, n, i = "", o, a; if (n = document.location.href, /^[^:]+:\/\/\/?[^\/]+\//.test(n) && (n = n.replace(/[\?#].*$/, "").replace(/[\/\\][^\/]+$/, ""), /[\/\\]$/.test(n) || (n += "/")), o = window.tinymce || window.tinyMCEPreInit) t = o.base || o.baseURL, i = o.suffix; else { for (var s = document.getElementsByTagName("script"), c = 0; c < s.length; c++) if (a = s[c].src, /tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(a)) { -1 != a.indexOf(".min") && (i = ".min"), t = a.substring(0, a.lastIndexOf("/")); break } !t && document.currentScript && (a = document.currentScript.src, -1 != a.indexOf(".min") && (i = ".min"), t = a.substring(0, a.lastIndexOf("/"))) } e.baseURL = new r(n).toAbsolute(t), e.documentBaseURL = n, e.baseURI = new r(e.baseURL), e.suffix = i, e.focusManager = new l(e) }, init: function (t) { function n(e) { var t = e.id; return t || (t = e.name, t = t && !d.get(t) ? e.name : d.uniqueId(), e.setAttribute("id", t)), t } function r(t, n, r) { if (!u(s.get(t))) { var i = new e(t, n, s); i.targetElm = i.targetElm || r, l.push(i), i.render() } } function i(e) { var n = t[e]; if (n) return n.apply(s, Array.prototype.slice.call(arguments, 2)) } function o(e, t) { return t.constructor === RegExp ? t.test(e.className) : d.hasClass(e, t) } function a() { var e, s; if (d.unbind(window, "ready", a), i("onpageload"), t.types) return void p(t.types, function (e) { p(d.select(e.selector), function (i) { r(n(i), h({}, t, e), i) }) }); if (t.selector) return void p(d.select(t.selector), function (e) { r(n(e), t, e) }); switch (t.target && r(n(t.target), t), t.mode) { case "exact": e = t.elements || "", e.length > 0 && p(f(e), function (e) { var n; (n = d.get(e)) ? r(e, t, n) : p(document.forms, function (n) { p(n.elements, function (n) { n.name === e && (e = "mce_editor_" + m++, d.setAttrib(n, "id", e), r(e, t, n)) }) }) }); break; case "textareas": case "specific_textareas": p(d.select("textarea"), function (e) { t.editor_deselector && o(e, t.editor_deselector) || (!t.editor_selector || o(e, t.editor_selector)) && r(n(e), t, e) }) } t.oninit && (e = s = 0, p(l, function (t) { s++, t.initialized ? e++ : t.on("init", function () { e++, e == s && i("oninit") }), e == s && i("oninit") })) } var s = this, l = []; s.settings = t, d.bind(window, "ready", a) }, get: function (e) { return arguments.length ? e in this.editors ? this.editors[e] : null : this.editors }, add: function (e) { var t = this, n = t.editors; return n[e.id] = e, n.push(e), t.activeEditor = e, t.fire("AddEditor", { editor: e }), g || (g = function () { t.fire("BeforeUnload") }, d.bind(window, "beforeunload", g)), e }, createEditor: function (t, n) { return this.add(new e(t, n, this)) }, remove: function (e) { var t = this, n, r = t.editors, i; { if (e) return "string" == typeof e ? (e = e.selector || e, void p(d.select(e), function (e) { i = r[e.id], i && t.remove(i) })) : (i = e, r[i.id] ? (c(i) && t.fire("RemoveEditor", { editor: i }), r.length || d.unbind(window, "beforeunload", g), i.remove(), i) : null); for (n = r.length - 1; n >= 0; n--) t.remove(r[n]) } }, execCommand: function (t, n, r) { var i = this, o = i.get(r); switch (t) { case "mceAddEditor": return i.get(r) || new e(r, i.settings, i).render(), !0; case "mceRemoveEditor": return o && o.remove(), !0; case "mceToggleEditor": return o ? (o.isHidden() ? o.show() : o.hide(), !0) : (i.execCommand("mceAddEditor", 0, r), !0) } return i.activeEditor ? i.activeEditor.execCommand(t, n, r) : !1 }, triggerSave: function () { p(this.editors, function (e) { e.save() }) }, addI18n: function (e, t) { s.add(e, t) }, translate: function (e) { return s.translate(e) }, setActive: function (e) { var t = this.activeEditor; this.activeEditor != e && (t && t.fire("deactivate", { relatedTarget: e }), e.fire("activate", { relatedTarget: t })), this.activeEditor = e } }, h(v, a), v.setup(), window.tinymce = window.tinyMCE = v, v }), r(mt, [ht, u], function (e, t) { var n = t.each, r = t.explode; e.on("AddEditor", function (e) { var t = e.editor; t.on("preInit", function () { function e(e, t) { n(t, function (t, n) { t && s.setStyle(e, n, t) }), s.rename(e, "span") } function i(e) { s = t.dom, l.convert_fonts_to_spans && n(s.select("font,u,strike", e.node), function (e) { o[e.nodeName.toLowerCase()](s, e) }) } var o, a, s, l = t.settings; l.inline_styles && (a = r(l.font_size_legacy_values), o = { font: function (t, n) { e(n, { backgroundColor: n.style.backgroundColor, color: n.color, fontFamily: n.face, fontSize: a[parseInt(n.size, 10) - 1] }) }, u: function (t, n) { e(n, { textDecoration: "underline" }) }, strike: function (t, n) { e(n, { textDecoration: "line-through" }) } }, t.on("PreProcess SetContent", i)) }) }) }), r(gt, [lt, u], function (e, t) { var n = { send: function (e) { function t() { !e.async || 4 == r.readyState || i++ > 1e4 ? (e.success && 1e4 > i && 200 == r.status ? e.success.call(e.success_scope, "" + r.responseText, r, e) : e.error && e.error.call(e.error_scope, i > 1e4 ? "TIMED_OUT" : "GENERAL", r, e), r = null) : setTimeout(t, 10) } var r, i = 0; if (e.scope = e.scope || this, e.success_scope = e.success_scope || e.scope, e.error_scope = e.error_scope || e.scope, e.async = e.async === !1 ? !1 : !0, e.data = e.data || "", r = new XMLHttpRequest) { if (r.overrideMimeType && r.overrideMimeType(e.content_type), r.open(e.type || (e.data ? "POST" : "GET"), e.url, e.async), e.crossDomain && (r.withCredentials = !0), e.content_type && r.setRequestHeader("Content-Type", e.content_type), r.setRequestHeader("X-Requested-With", "XMLHttpRequest"), r = n.fire("beforeSend", { xhr: r, settings: e }).xhr, r.send(e.data), !e.async) return t(); setTimeout(t, 10) } } }; return t.extend(n, e), n }), r(vt, [], function () { function e(t, n) { var r, i, o, a; if (n = n || '"', null === t) return "null"; if (o = typeof t, "string" == o) return i = "\bb	t\nn\ff\rr\"\"''\\\\", n + t.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g, function (e, t) { return '"' === n && "'" === e ? e : (r = i.indexOf(t), r + 1 ? "\\" + i.charAt(r + 1) : (e = t.charCodeAt().toString(16), "\\u" + "0000".substring(e.length) + e)) }) + n; if ("object" == o) { if (t.hasOwnProperty && "[object Array]" === Object.prototype.toString.call(t)) { for (r = 0, i = "["; r < t.length; r++) i += (r > 0 ? "," : "") + e(t[r], n); return i + "]" } i = "{"; for (a in t) t.hasOwnProperty(a) && (i += "function" != typeof t[a] ? (i.length > 1 ? "," + n : n) + a + n + ":" + e(t[a], n) : ""); return i + "}" } return "" + t } return { serialize: e, parse: function (e) { try { return window[String.fromCharCode(101) + "val"]("(" + e + ")") } catch (t) { } } } }), r(yt, [vt, gt, u], function (e, t, n) { function r(e) { this.settings = i({}, e), this.count = 0 } var i = n.extend; return r.sendRPC = function (e) { return (new r).send(e) }, r.prototype = { send: function (n) { var r = n.error, o = n.success; n = i(this.settings, n), n.success = function (t, i) { t = e.parse(t), "undefined" == typeof t && (t = { error: "JSON Parse error." }), t.error ? r.call(n.error_scope || n.scope, t.error, i) : o.call(n.success_scope || n.scope, t.result) }, n.error = function (e, t) { r && r.call(n.error_scope || n.scope, e, t) }, n.data = e.serialize({ id: n.id || "c" + this.count++, method: n.method, params: n.params }), n.content_type = "application/json", t.send(n) } }, r }), r(bt, [y], function (e) { return { callbacks: {}, count: 0, send: function (n) { var r = this, i = e.DOM, o = n.count !== t ? n.count : r.count, a = "tinymce_jsonp_" + o; r.callbacks[o] = function (e) { i.remove(a), delete r.callbacks[o], n.callback(e) }, i.add(i.doc.body, "script", { id: a, src: n.url, type: "text/javascript" }), r.count++ } } }), r(Ct, [], function () { function e() { s = []; for (var e in a) s.push(e); i.length = s.length } function n() { function n(e) { var n, r; return r = e !== t ? u + e : i.indexOf(",", u), -1 === r || r > i.length ? null : (n = i.substring(u, r), u = r + 1, n) } var r, i, s, u = 0; if (a = {}, c) { o.load(l), i = o.getAttribute(l) || ""; do { var d = n(); if (null === d) break; if (r = n(parseInt(d, 32) || 0), null !== r) { if (d = n(), null === d) break; s = n(parseInt(d, 32) || 0), r && (a[r] = s) } } while (null !== r); e() } } function r() { var t, n = ""; if (c) { for (var r in a) t = a[r], n += (n ? "," : "") + r.length.toString(32) + "," + r + "," + t.length.toString(32) + "," + t; o.setAttribute(l, n); try { o.save(l) } catch (i) { } e() } } var i, o, a, s, l, c; try { if (window.localStorage) return localStorage } catch (u) { } return l = "tinymce", o = document.documentElement, c = !!o.addBehavior, c && o.addBehavior("#default#userData"), i = { key: function (e) { return s[e] }, getItem: function (e) { return e in a ? a[e] : null }, setItem: function (e, t) { a[e] = "" + t, r() }, removeItem: function (e) { delete a[e], r() }, clear: function () { a = {}, r() } }, n(), i }), r(xt, [y, l, b, C, u, d], function (e, t, n, r, i, o) { var a = window.tinymce; return a.DOM = e.DOM, a.ScriptLoader = n.ScriptLoader, a.PluginManager = r.PluginManager, a.ThemeManager = r.ThemeManager, a.dom = a.dom || {}, a.dom.Event = t.Event, i.each(i, function (e, t) { a[t] = e }), i.each("isOpera isWebKit isIE isGecko isMac".split(" "), function (e) { a[e] = o[e.substr(2).toLowerCase()] }), {} }), r(wt, [U, u], function (e, t) { return e.extend({ Defaults: { firstControlClass: "first", lastControlClass: "last" }, init: function (e) { this.settings = t.extend({}, this.Defaults, e) }, preRender: function (e) { e.addClass(this.settings.containerClass, "body") }, applyClasses: function (e) { var t = this, n = t.settings, r, i, o; r = e.items().filter(":visible"), i = n.firstControlClass, o = n.lastControlClass, r.each(function (e) { e.removeClass(i).removeClass(o), n.controlClass && e.addClass(n.controlClass) }), r.eq(0).addClass(i), r.eq(-1).addClass(o) }, renderHtml: function (e) { var t = this, n = t.settings, r, i = ""; return r = e.items(), r.eq(0).addClass(n.firstControlClass), r.eq(-1).addClass(n.lastControlClass), r.each(function (e) { n.controlClass && e.addClass(n.controlClass), i += e.renderHtml() }), i }, recalc: function () { }, postRender: function () { } }) }), r(_t, [wt], function (e) { return e.extend({ Defaults: { containerClass: "abs-layout", controlClass: "abs-layout-item" }, recalc: function (e) { e.items().filter(":visible").each(function (e) { var t = e.settings; e.layoutRect({ x: t.x, y: t.y, w: t.w, h: t.h }), e.recalc && e.recalc() }) }, renderHtml: function (e) { return '<div id="' + e._id + '-absend" class="' + e.classPrefix + 'abs-end"></div>' + this._super(e) } }) }), r(Et, [K, tt], function (e, t) { return e.extend({ Mixins: [t], Defaults: { classes: "widget tooltip tooltip-n" }, text: function (e) { var t = this; return "undefined" != typeof e ? (t._value = e, t._rendered && (t.getEl().lastChild.innerHTML = t.encode(e)), t) : t._value }, renderHtml: function () { var e = this, t = e.classPrefix; return '<div id="' + e._id + '" class="' + e.classes() + '" role="presentation"><div class="' + t + 'tooltip-arrow"></div><div class="' + t + 'tooltip-inner">' + e.encode(e._text) + "</div></div>" }, repaint: function () { var e = this, t, n; t = e.getEl().style, n = e._layoutRect, t.left = n.x + "px", t.top = n.y + "px", t.zIndex = 131070 } }) }), r(Nt, [K, Et], function (e, t) { var n, r = e.extend({ init: function (e) { var t = this; t._super(e), e = t.settings, t.canFocus = !0, e.tooltip && r.tooltips !== !1 && (t.on("mouseenter", function (n) { var r = t.tooltip().moveTo(-65535); if (n.control == t) { var i = r.text(e.tooltip).show().testMoveRel(t.getEl(), ["bc-tc", "bc-tl", "bc-tr"]); r.toggleClass("tooltip-n", "bc-tc" == i), r.toggleClass("tooltip-nw", "bc-tl" == i), r.toggleClass("tooltip-ne", "bc-tr" == i), r.moveRel(t.getEl(), i) } else r.hide() }), t.on("mouseleave mousedown click", function () { t.tooltip().hide() })), t.aria("label", e.ariaLabel || e.tooltip) }, tooltip: function () { return n || (n = new t({ type: "tooltip" }), n.renderTo()), n }, active: function (e) { var t = this, n; return e !== n && (t.aria("pressed", e), t.toggleClass("active", e)), t._super(e) }, disabled: function (e) { var t = this, n; return e !== n && (t.aria("disabled", e), t.toggleClass("disabled", e)), t._super(e) }, postRender: function () { var e = this, t = e.settings; e._rendered = !0, e._super(), e.parent() || !t.width && !t.height || (e.initLayoutRect(), e.repaint()), t.autofocus && e.focus() }, remove: function () { this._super(), n && (n.remove(), n = null) } }); return r }), r(kt, [Nt], function (e) { return e.extend({ Defaults: { classes: "widget btn", role: "button" }, init: function (e) { var t = this, n; t.on("click mousedown", function (e) { e.preventDefault() }), t._super(e), n = e.size, e.subtype && t.addClass(e.subtype), n && t.addClass("btn-" + n) }, icon: function (e) { var t = this, n = t.classPrefix; if ("undefined" == typeof e) return t.settings.icon; if (t.settings.icon = e, e = e ? n + "ico " + n + "i-" + t.settings.icon : "", t._rendered) { var r = t.getEl().firstChild, i = r.getElementsByTagName("i")[0]; e ? (i && i == r.firstChild || (i = document.createElement("i"), r.insertBefore(i, r.firstChild)), i.className = e) : i && r.removeChild(i), t.text(t._text) } return t }, repaint: function () { var e = this.getEl().firstChild.style; e.width = e.height = "100%", this._super() }, text: function (e) { var t = this; if (t._rendered) { var n = t.getEl().lastChild.lastChild; n && (n.data = t.translate(e)) } return t._super(e) }, renderHtml: function () { var e = this, t = e._id, n = e.classPrefix, r = e.settings.icon, i; return i = e.settings.image, i ? (r = "none", "string" != typeof i && (i = window.getSelection ? i[0] : i[1]), i = " style=\"background-image: url('" + i + "')\"") : i = "", r = e.settings.icon ? n + "ico " + n + "i-" + r : "", '<div id="' + t + '" class="' + e.classes() + '" tabindex="-1" aria-labelledby="' + t + '"><button role="presentation" type="button" tabindex="-1">' + (r ? '<i class="' + r + '"' + i + "></i>" : "") + (e._text ? (r ? "\xa0" : "") + e.encode(e._text) : "") + "</button></div>" } }) }), r(St, [J], function (e) { return e.extend({ Defaults: { defaultType: "button", role: "group" }, renderHtml: function () { var e = this, t = e._layout; return e.addClass("btn-group"), e.preRender(), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes() + '"><div id="' + e._id + '-body">' + (e.settings.html || "") + t.renderHtml(e) + "</div></div>" } }) }), r(Tt, [Nt], function (e) { return e.extend({ Defaults: { classes: "checkbox", role: "checkbox", checked: !1 }, init: function (e) { var t = this; t._super(e), t.on("click mousedown", function (e) { e.preventDefault() }), t.on("click", function (e) { e.preventDefault(), t.disabled() || t.checked(!t.checked()) }), t.checked(t.settings.checked) }, checked: function (e) { var t = this; return "undefined" != typeof e ? (e ? t.addClass("checked") : t.removeClass("checked"), t._checked = e, t.aria("checked", e), t) : t._checked }, value: function (e) { return this.checked(e) }, renderHtml: function () { var e = this, t = e._id, n = e.classPrefix; return '<div id="' + t + '" class="' + e.classes() + '" unselectable="on" aria-labelledby="' + t + '-al" tabindex="-1"><i class="' + n + "ico " + n + 'i-checkbox"></i><span id="' + t + '-al" class="' + n + 'label">' + e.encode(e._text) + "</span></div>" } }) }), r(Rt, [Nt, G, Y], function (e, t, n) { return e.extend({ init: function (e) { var t = this; t._super(e), t.addClass("combobox"), t.subinput = !0, t.ariaTarget = "inp", e = t.settings, e.menu = e.menu || e.values, e.menu && (e.icon = "caret"), t.on("click", function (n) { for (var r = n.target, i = t.getEl(); r && r != i; ) r.id && -1 != r.id.indexOf("-open") && (t.fire("action"), e.menu && (t.showMenu(), n.aria && t.menu.items()[0].focus())), r = r.parentNode }), t.on("keydown", function (e) { "INPUT" == e.target.nodeName && 13 == e.keyCode && t.parents().reverse().each(function (n) { return e.preventDefault(), t.fire("change"), n.hasEventListeners("submit") && n.toJSON ? (n.fire("submit", { data: n.toJSON() }), !1) : void 0 }) }), e.placeholder && (t.addClass("placeholder"), t.on("focusin", function () { t._hasOnChange || (n.on(t.getEl("inp"), "change", function () { t.fire("change") }), t._hasOnChange = !0), t.hasClass("placeholder") && (t.getEl("inp").value = "", t.removeClass("placeholder")) }), t.on("focusout", function () { 0 === t.value().length && (t.getEl("inp").value = e.placeholder, t.addClass("placeholder")) })) }, showMenu: function () { var e = this, n = e.settings, r; e.menu || (r = n.menu || [], r.length ? r = { type: "menu", items: r} : r.type = r.type || "menu", e.menu = t.create(r).parent(e).renderTo(e.getContainerElm()), e.fire("createmenu"), e.menu.reflow(), e.menu.on("cancel", function (t) { t.control === e.menu && e.focus() }), e.menu.on("show hide", function (t) { t.control.items().each(function (t) { t.active(t.value() == e.value()) }) }).fire("show"), e.menu.on("select", function (t) { e.value(t.control.value()) }), e.on("focusin", function (t) { "INPUT" == t.target.tagName.toUpperCase() && e.menu.hide() }), e.aria("expanded", !0)), e.menu.show(), e.menu.layoutRect({ w: e.layoutRect().w }), e.menu.moveRel(e.getEl(), e.isRtl() ? ["br-tr", "tr-br"] : ["bl-tl", "tl-bl"]) }, value: function (e) { var t = this; return "undefined" != typeof e ? (t._value = e, t.removeClass("placeholder"), t._rendered && (t.getEl("inp").value = e), t) : t._rendered ? (e = t.getEl("inp").value, e != t.settings.placeholder ? e : "") : t._value }, disabled: function (e) { var t = this; return t._rendered && "undefined" != typeof e && (t.getEl("inp").disabled = e), t._super(e) }, focus: function () { this.getEl("inp").focus() }, repaint: function () { var e = this, t = e.getEl(), r = e.getEl("open"), i = e.layoutRect(), o, a; o = r ? i.w - n.getSize(r).width - 10 : i.w - 10; var s = document; return s.all && (!s.documentMode || s.documentMode <= 8) && (a = e.layoutRect().h - 2 + "px"), n.css(t.firstChild, { width: o, lineHeight: a }), e._super(), e }, postRender: function () { var e = this; return n.on(this.getEl("inp"), "change", function () { e.fire("change") }), e._super() }, remove: function () { n.off(this.getEl("inp")), this._super() }, renderHtml: function () { var e = this, t = e._id, n = e.settings, r = e.classPrefix, i = n.value || n.placeholder || "", o, a, s = "", l = ""; return "spellcheck" in n && (l += ' spellcheck="' + n.spellcheck + '"'), n.maxLength && (l += ' maxlength="' + n.maxLength + '"'), n.size && (l += ' size="' + n.size + '"'), n.subtype && (l += ' type="' + n.subtype + '"'), e.disabled() && (l += ' disabled="disabled"'), o = n.icon, o && "caret" != o && (o = r + "ico " + r + "i-" + n.icon), a = e._text, (o || a) && (s = '<div id="' + t + '-open" class="' + r + "btn " + r + 'open" tabIndex="-1" role="button"><button id="' + t + '-action" type="button" hidefocus="1" tabindex="-1">' + ("caret" != o ? '<i class="' + o + '"></i>' : '<i class="' + r + 'caret"></i>') + (a ? (o ? " " : "") + a : "") + "</button></div>", e.addClass("has-open")), '<div id="' + t + '" class="' + e.classes() + '"><input id="' + t + '-inp" class="' + r + "textbox " + r + 'placeholder" value="' + i + '" hidefocus="1"' + l + " />" + s + "</div>" } }) }), r(At, [Rt], function (e) { return e.extend({ init: function (e) { var t = this; e.spellcheck = !1, e.onaction && (e.icon = "none"), t._super(e), t.addClass("colorbox"), t.on("change keyup postrender", function () { t.repaintColor(t.value()) }) }, repaintColor: function (e) { var t = this.getEl().getElementsByTagName("i")[0]; if (t) try { t.style.background = e } catch (n) { } }, value: function (e) { var t = this; return "undefined" != typeof e && t._rendered && t.repaintColor(e), t._super(e) } }) }), r(Bt, [kt, rt], function (e, t) { return e.extend({ showPanel: function () { var e = this, n = e.settings; if (e.active(!0), e.panel) e.panel.show(); else { var r = n.panel; r.type && (r = { layout: "grid", items: r }), r.role = r.role || "dialog", r.popover = !0, r.autohide = !0, r.ariaRoot = !0, e.panel = new t(r).on("hide", function () { e.active(!1) }).on("cancel", function (t) { t.stopPropagation(), e.focus(), e.hidePanel() }).parent(e).renderTo(e.getContainerElm()), e.panel.fire("show"), e.panel.reflow() } e.panel.moveRel(e.getEl(), n.popoverAlign || (e.isRtl() ? ["bc-tr", "bc-tc"] : ["bc-tl", "bc-tc"])) }, hidePanel: function () { var e = this; e.panel && e.panel.hide() }, postRender: function () { var e = this; return e.aria("haspopup", !0), e.on("click", function (t) { t.control === e && (e.panel && e.panel.visible() ? e.hidePanel() : (e.showPanel(), e.panel.focus(!!t.aria))) }), e._super() }, remove: function () { return this.panel && (this.panel.remove(), this.panel = null), this._super() } }) }), r(Dt, [Bt, y], function (e, t) { var n = t.DOM; return e.extend({ init: function (e) { this._super(e), this.addClass("colorbutton") }, color: function (e) { return e ? (this._color = e, this.getEl("preview").style.backgroundColor = e, this) : this._color }, renderHtml: function () { var e = this, t = e._id, n = e.classPrefix, r = e.settings.icon ? n + "ico " + n + "i-" + e.settings.icon : "", i = e.settings.image ? " style=\"background-image: url('" + e.settings.image + "')\"" : ""; return '<div id="' + t + '" class="' + e.classes() + '" role="button" tabindex="-1" aria-haspopup="true"><button role="presentation" hidefocus="1" type="button" tabindex="-1">' + (r ? '<i class="' + r + '"' + i + "></i>" : "") + '<span id="' + t + '-preview" class="' + n + 'preview"></span>' + (e._text ? (r ? " " : "") + e._text : "") + '</button><button type="button" class="' + n + 'open" hidefocus="1" tabindex="-1"> <i class="' + n + 'caret"></i></button></div>' }, postRender: function () { var e = this, t = e.settings.onclick; return e.on("click", function (r) { r.aria && "down" == r.aria.key || r.control != e || n.getParent(r.target, "." + e.classPrefix + "open") || (r.stopImmediatePropagation(), t.call(e, r)) }), delete e.settings.onclick, e._super() } }) }), r(Lt, [], function () { function e(e) { function i(e, i, o) { var a, s, l, c, u, d; return a = 0, s = 0, l = 0, e /= 255, i /= 255, o /= 255, u = t(e, t(i, o)), d = n(e, n(i, o)), u == d ? (l = u, { h: 0, s: 0, v: 100 * l }) : (c = e == u ? i - o : o == u ? e - i : o - e, a = e == u ? 3 : o == u ? 1 : 5, a = 60 * (a - c / (d - u)), s = (d - u) / d, l = d, { h: r(a), s: r(100 * s), v: r(100 * l) }) } function o(e, i, o) { var a, s, l, c; if (e = (parseInt(e, 10) || 0) % 360, i = parseInt(i, 10) / 100, o = parseInt(o, 10) / 100, i = n(0, t(i, 1)), o = n(0, t(o, 1)), 0 === i) return void (d = f = p = r(255 * o)); switch (a = e / 60, s = o * i, l = s * (1 - Math.abs(a % 2 - 1)), c = o - s, Math.floor(a)) { case 0: d = s, f = l, p = 0; break; case 1: d = l, f = s, p = 0; break; case 2: d = 0, f = s, p = l; break; case 3: d = 0, f = l, p = s; break; case 4: d = l, f = 0, p = s; break; case 5: d = s, f = 0, p = l; break; default: d = f = p = 0 } d = r(255 * (d + c)), f = r(255 * (f + c)), p = r(255 * (p + c)) } function a() { function e(e) { return e = parseInt(e, 10).toString(16), e.length > 1 ? e : "0" + e } return "#" + e(d) + e(f) + e(p) } function s() { return { r: d, g: f, b: p} } function l() { return i(d, f, p) } function c(e) { var t; return "object" == typeof e ? "r" in e ? (d = e.r, f = e.g, p = e.b) : "v" in e && o(e.h, e.s, e.v) : (t = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(e)) ? (d = parseInt(t[1], 10), f = parseInt(t[2], 10), p = parseInt(t[3], 10)) : (t = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(e)) ? (d = parseInt(t[1], 16), f = parseInt(t[2], 16), p = parseInt(t[3], 16)) : (t = /#([0-F])([0-F])([0-F])/gi.exec(e)) && (d = parseInt(t[1] + t[1], 16), f = parseInt(t[2] + t[2], 16), p = parseInt(t[3] + t[3], 16)), d = 0 > d ? 0 : d > 255 ? 255 : d, f = 0 > f ? 0 : f > 255 ? 255 : f, p = 0 > p ? 0 : p > 255 ? 255 : p, u } var u = this, d = 0, f = 0, p = 0; e && c(e), u.toRgb = s, u.toHsv = l, u.toHex = a, u.parse = c } var t = Math.min, n = Math.max, r = Math.round; return e }), r(Ht, [Nt, Q, Y, Lt], function (e, t, n, r) { return e.extend({ Defaults: { classes: "widget colorpicker" }, init: function (e) { this._super(e) }, postRender: function () { function e(e, t) { var r = n.getPos(e), i, o; return i = t.pageX - r.x, o = t.pageY - r.y, i = Math.max(0, Math.min(i / e.clientWidth, 1)), o = Math.max(0, Math.min(o / e.clientHeight, 1)), { x: i, y: o} } function i(e, t) { var i = (360 - e.h) / 360; n.css(d, { top: 100 * i + "%" }), t || n.css(p, { left: e.s + "%", top: 100 - e.v + "%" }), f.style.background = new r({ s: 100, v: 100, h: e.h }).toHex(), s.color().parse({ s: e.s, v: e.v, h: e.h }) } function o(t) { var n; n = e(f, t), c.s = 100 * n.x, c.v = 100 * (1 - n.y), i(c), s.fire("change") } function a(t) { var n; n = e(u, t), c = l.toHsv(), c.h = 360 * (1 - n.y), i(c, !0), s.fire("change") } var s = this, l = s.color(), c, u, d, f, p; u = s.getEl("h"), d = s.getEl("hp"), f = s.getEl("sv"), p = s.getEl("svp"), s._repaint = function () { c = l.toHsv(), i(c) }, s._super(), s._svdraghelper = new t(s._id + "-sv", { start: o, drag: o }), s._hdraghelper = new t(s._id + "-h", { start: a, drag: a }), s._repaint() }, rgb: function () { return this.color().toRgb() }, value: function (e) { var t = this; return arguments.length ? (t.color().parse(e), void (t._rendered && t._repaint())) : t.color().toHex() }, color: function () { return this._color || (this._color = new r), this._color }, renderHtml: function () { function e() { var e, t, n = "", i, a; for (i = "filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=", a = o.split(","), e = 0, t = a.length - 1; t > e; e++) n += '<div class="' + r + 'colorpicker-h-chunk" style="height:' + 100 / t + "%;" + i + a[e] + ",endColorstr=" + a[e + 1] + ");-ms-" + i + a[e] + ",endColorstr=" + a[e + 1] + ')"></div>'; return n } var t = this, n = t._id, r = t.classPrefix, i, o = "#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000", a = "background: -ms-linear-gradient(top," + o + ");background: linear-gradient(to bottom," + o + ");"; return i = '<div id="' + n + '-h" class="' + r + 'colorpicker-h" style="' + a + '">' + e() + '<div id="' + n + '-hp" class="' + r + 'colorpicker-h-marker"></div></div>', '<div id="' + n + '" class="' + t.classes() + '"><div id="' + n + '-sv" class="' + r + 'colorpicker-sv"><div class="' + r + 'colorpicker-overlay1"><div class="' + r + 'colorpicker-overlay2"><div id="' + n + '-svp" class="' + r + 'colorpicker-selector1"><div class="' + r + 'colorpicker-selector2"></div></div></div></div></div>' + i + "</div>" } }) }), r(Mt, [Nt], function (e) { return e.extend({ init: function (e) { var t = this; e.delimiter || (e.delimiter = "\xbb"), t._super(e), t.addClass("path"), t.canFocus = !0, t.on("click", function (e) { var n, r = e.target; (n = r.getAttribute("data-index")) && t.fire("select", { value: t.data()[n], index: n }) }) }, focus: function () { var e = this; return e.getEl().firstChild.focus(), e }, data: function (e) { var t = this; return "undefined" != typeof e ? (t._data = e, t.update(), t) : t._data }, update: function () { this.innerHtml(this._getPathHtml()) }, postRender: function () { var e = this; e._super(), e.data(e.settings.data) }, renderHtml: function () { var e = this; return '<div id="' + e._id + '" class="' + e.classes() + '">' + e._getPathHtml() + "</div>" }, _getPathHtml: function () { var e = this, t = e._data || [], n, r, i = "", o = e.classPrefix; for (n = 0, r = t.length; r > n; n++) i += (n > 0 ? '<div class="' + o + 'divider" aria-hidden="true"> ' + e.settings.delimiter + " </div>" : "") + '<div role="button" class="' + o + "path-item" + (n == r - 1 ? " " + o + "last" : "") + '" data-index="' + n + '" tabindex="-1" id="' + e._id + "-" + n + '" aria-level="' + n + '">' + t[n].name + "</div>"; return i || (i = '<div class="' + o + 'path-item">\xa0</div>'), i } }) }), r(Pt, [Mt, ht], function (e, t) { return e.extend({ postRender: function () { function e(e) { if (1 === e.nodeType) { if ("BR" == e.nodeName || e.getAttribute("data-mce-bogus")) return !0; if ("bookmark" === e.getAttribute("data-mce-type")) return !0 } return !1 } var n = this, r = t.activeEditor; return n.on("select", function (e) { r.focus(), r.selection.select(this.data()[e.index].element), r.nodeChanged() }), r.on("nodeChange", function (t) { for (var i = [], o = t.parents, a = o.length; a--; ) if (1 == o[a].nodeType && !e(o[a])) { var s = r.fire("ResolveName", { name: o[a].nodeName.toLowerCase(), target: o[a] }); if (s.isDefaultPrevented() || i.push({ name: s.name, element: o[a] }), s.isPropagationStopped()) break } n.data(i) }), n._super() } }) }), r(Ot, [J], function (e) { return e.extend({ Defaults: { layout: "flex", align: "center", defaults: { flex: 1} }, renderHtml: function () { var e = this, t = e._layout, n = e.classPrefix; return e.addClass("formitem"), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes() + '" hidefocus="1" tabindex="-1">' + (e.settings.title ? '<div id="' + e._id + '-title" class="' + n + 'title">' + e.settings.title + "</div>" : "") + '<div id="' + e._id + '-body" class="' + e.classes("body") + '">' + (e.settings.html || "") + t.renderHtml(e) + "</div></div>" } }) }), r(It, [J, Ot, u], function (e, t, n) { return e.extend({ Defaults: { containerCls: "form", layout: "flex", direction: "column", align: "stretch", flex: 1, padding: 20, labelGap: 30, spacing: 10, callbacks: { submit: function () { this.submit() } } }, preRender: function () { var e = this, r = e.items(); e.settings.formItemDefaults || (e.settings.formItemDefaults = { layout: "flex", autoResize: "overflow", defaults: { flex: 1} }), r.each(function (r) { var i, o = r.settings.label; o && (i = new t(n.extend({ items: { type: "label", id: r._id + "-l", text: o, flex: 0, forId: r._id, disabled: r.disabled()} }, e.settings.formItemDefaults)), i.type = "formitem", r.aria("labelledby", r._id + "-l"), "undefined" == typeof r.settings.flex && (r.settings.flex = 1), e.replace(r, i), i.add(r)) }) }, recalcLabels: function () { var e = this, t = 0, n = [], r, i, o; if (e.settings.labelGapCalc !== !1) for (o = "children" == e.settings.labelGapCalc ? e.find("formitem") : e.items(), o.filter("formitem").each(function (e) { var r = e.items()[0], i = r.getEl().clientWidth; t = i > t ? i : t, n.push(r) }), i = e.settings.labelGap || 0, r = n.length; r--; ) n[r].settings.minWidth = t + i }, visible: function (e) { var t = this._super(e); return e === !0 && this._rendered && this.recalcLabels(), t }, submit: function () { return this.fire("submit", { data: this.toJSON() }) }, postRender: function () { var e = this; e._super(), e.recalcLabels(), e.fromJSON(e.settings.data) } }) }), r(Ft, [It], function (e) { return e.extend({ Defaults: { containerCls: "fieldset", layout: "flex", direction: "column", align: "stretch", flex: 1, padding: "25 15 5 15", labelGap: 30, spacing: 10, border: 1 }, renderHtml: function () { var e = this, t = e._layout, n = e.classPrefix; return e.preRender(), t.preRender(e), '<fieldset id="' + e._id + '" class="' + e.classes() + '" hidefocus="1" tabindex="-1">' + (e.settings.title ? '<legend id="' + e._id + '-title" class="' + n + 'fieldset-title">' + e.settings.title + "</legend>" : "") + '<div id="' + e._id + '-body" class="' + e.classes("body") + '">' + (e.settings.html || "") + t.renderHtml(e) + "</div></fieldset>" } }) }), r(zt, [Rt, u], function (e, t) { return e.extend({ init: function (e) { var n = this, r = tinymce.activeEditor, i = r.settings, o, a, s; e.spellcheck = !1, s = i.file_picker_types || i.file_browser_callback_types, s && (s = t.makeMap(s, /[, ]/)), (!s || s[e.filetype]) && (a = i.file_picker_callback, !a || s && !s[e.filetype] ? (a = i.file_browser_callback, !a || s && !s[e.filetype] || (o = function () { a(n.getEl("inp").id, n.value(), e.filetype, window) })) : o = function () { var i = n.fire("beforecall").meta; i = t.extend({ filetype: e.filetype }, i), a.call(r, function (e, t) { n.value(e).fire("change", { meta: t }) }, n.value(), i) }), o && (e.icon = "browse", e.onaction = o), n._super(e) } }) }), r(Wt, [_t], function (e) { return e.extend({ recalc: function (e) { var t = e.layoutRect(), n = e.paddingBox(); e.items().filter(":visible").each(function (e) { e.layoutRect({ x: n.left, y: n.top, w: t.innerW - n.right - n.left, h: t.innerH - n.top - n.bottom }), e.recalc && e.recalc() }) } }) }), r(Vt, [_t], function (e) { return e.extend({ recalc: function (e) { var t, n, r, i, o, a, s, l, c, u, d, f, p, h, m, g, v = [], y, b, C, x, w, _, E, N, k, S, T, R, A, B, D, L, H, M, P, O, I, F, z = Math.max, W = Math.min; for (r = e.items().filter(":visible"), i = e.layoutRect(), o = e._paddingBox, a = e.settings, f = e.isRtl() ? a.direction || "row-reversed" : a.direction, s = a.align, l = e.isRtl() ? a.pack || "end" : a.pack, c = a.spacing || 0, ("row-reversed" == f || "column-reverse" == f) && (r = r.set(r.toArray().reverse()), f = f.split("-")[0]), "column" == f ? (k = "y", E = "h", N = "minH", S = "maxH", R = "innerH", T = "top", A = "deltaH", B = "contentH", P = "left", H = "w", D = "x", L = "innerW", M = "minW", O = "right", I = "deltaW", F = "contentW") : (k = "x", E = "w", N = "minW", S = "maxW", R = "innerW", T = "left", A = "deltaW", B = "contentW", P = "top", H = "h", D = "y", L = "innerH", M = "minH", O = "bottom", I = "deltaH", F = "contentH"), d = i[R] - o[T] - o[T], _ = u = 0, t = 0, n = r.length; n > t; t++) p = r[t], h = p.layoutRect(), m = p.settings, g = m.flex, d -= n - 1 > t ? c : 0, g > 0 && (u += g, h[S] && v.push(p), h.flex = g), d -= h[N], y = o[P] + h[M] + o[O], y > _ && (_ = y); if (x = {}, x[N] = 0 > d ? i[N] - d + i[A] : i[R] - d + i[A], x[M] = _ + i[I], x[B] = i[R] - d, x[F] = _, x.minW = W(x.minW, i.maxW), x.minH = W(x.minH, i.maxH), x.minW = z(x.minW, i.startMinWidth), x.minH = z(x.minH, i.startMinHeight), !i.autoResize || x.minW == i.minW && x.minH == i.minH) { for (C = d / u, t = 0, n = v.length; n > t; t++) p = v[t], h = p.layoutRect(), b = h[S], y = h[N] + h.flex * C, y > b ? (d -= h[S] - h[N], u -= h.flex, h.flex = 0, h.maxFlexSize = b) : h.maxFlexSize = 0; for (C = d / u, w = o[T], x = {}, 0 === u && ("end" == l ? w = d + o[T] : "center" == l ? (w = Math.round(i[R] / 2 - (i[R] - d) / 2) + o[T], 0 > w && (w = o[T])) : "justify" == l && (w = o[T], c = Math.floor(d / (r.length - 1)))), x[D] = o[P], t = 0, n = r.length; n > t; t++) p = r[t], h = p.layoutRect(), y = h.maxFlexSize || h[N], "center" === s ? x[D] = Math.round(i[L] / 2 - h[H] / 2) : "stretch" === s ? (x[H] = z(h[M] || 0, i[L] - o[P] - o[O]), x[D] = o[P]) : "end" === s && (x[D] = i[L] - h[H] - o.top), h.flex > 0 && (y += h.flex * C), x[E] = y, x[k] = w, p.layoutRect(x), p.recalc && p.recalc(), w += y + c } else if (x.w = x.minW, x.h = x.minH, e.layoutRect(x), this.recalc(e), null === e._lastRect) { var V = e.parent(); V && (V._lastRect = null, V.recalc()) } } }) }), r(Ut, [wt], function (e) { return e.extend({ Defaults: { containerClass: "flow-layout", controlClass: "flow-layout-item", endClass: "break" }, recalc: function (e) { e.items().filter(":visible").each(function (e) { e.recalc && e.recalc() }) } }) }), r($t, [K, Nt, rt, u, ht, d], function (e, t, n, r, i, o) { function a(e) { function t(t, n) { return function () { var r = this; e.on("nodeChange", function (i) { var o = e.formatter, a = null; s(i.parents, function (e) { return s(t, function (t) { return n ? o.matchNode(e, n, { value: t.value }) && (a = t.value) : o.matchNode(e, t.value) && (a = t.value), a ? !1 : void 0 }), a ? !1 : void 0 }), r.value(a) }) } } function r(e) { e = e.replace(/;$/, "").split(";"); for (var t = e.length; t--; ) e[t] = e[t].split("="); return e } function i() { function t(e) { var n = []; if (e) return s(e, function (e) { var o = { text: e.title, icon: e.icon }; if (e.items) o.menu = t(e.items); else { var a = e.format || "custom" + r++; e.format || (e.name = a, i.push(e)), o.format = a, o.cmd = e.cmd } n.push(o) }), n } function n() { var n; return n = t(e.settings.style_formats_merge ? e.settings.style_formats ? o.concat(e.settings.style_formats) : o : e.settings.style_formats || o) } var r = 0, i = [], o = [{ title: "Headings", items: [{ title: "Heading 1", format: "h1" }, { title: "Heading 2", format: "h2" }, { title: "Heading 3", format: "h3" }, { title: "Heading 4", format: "h4" }, { title: "Heading 5", format: "h5" }, { title: "Heading 6", format: "h6"}] }, { title: "Inline", items: [{ title: "Bold", icon: "bold", format: "bold" }, { title: "Italic", icon: "italic", format: "italic" }, { title: "Underline", icon: "underline", format: "underline" }, { title: "Strikethrough", icon: "strikethrough", format: "strikethrough" }, { title: "Superscript", icon: "superscript", format: "superscript" }, { title: "Subscript", icon: "subscript", format: "subscript" }, { title: "Code", icon: "code", format: "code"}] }, { title: "Blocks", items: [{ title: "Paragraph", format: "p" }, { title: "Blockquote", format: "blockquote" }, { title: "Div", format: "div" }, { title: "Pre", format: "pre"}] }, { title: "Alignment", items: [{ title: "Left", icon: "alignleft", format: "alignleft" }, { title: "Center", icon: "aligncenter", format: "aligncenter" }, { title: "Right", icon: "alignright", format: "alignright" }, { title: "Justify", icon: "alignjustify", format: "alignjustify"}]}]; return e.on("init", function () { s(i, function (t) { e.formatter.register(t.name, t) }) }), { type: "menu", items: n(), onPostRender: function (t) { e.fire("renderFormatsMenu", { control: t.control }) }, itemDefaults: { preview: !0, textStyle: function () { return this.settings.format ? e.formatter.getCssText(this.settings.format) : void 0 }, onPostRender: function () { var t = this; t.parent().on("show", function () { var n, r; n = t.settings.format, n && (t.disabled(!e.formatter.canApply(n)), t.active(e.formatter.match(n))), r = t.settings.cmd, r && t.active(e.queryCommandState(r)) }) }, onclick: function () { this.settings.format && l(this.settings.format), this.settings.cmd && e.execCommand(this.settings.cmd) } }} } function o(t) { return function () { function n() { return e.undoManager ? e.undoManager[t]() : !1 } var r = this; t = "redo" == t ? "hasRedo" : "hasUndo", r.disabled(!n()), e.on("Undo Redo AddUndo TypingUndo ClearUndos", function () { r.disabled(!n()) }) } } function a() { var t = this; e.on("VisualAid", function (e) { t.active(e.hasVisual) }), t.active(e.hasVisual) } function l(t) { t.control && (t = t.control.value()), t && e.execCommand("mceToggleFormat", !1, t) } var c; c = i(), s({ bold: "Bold", italic: "Italic", underline: "Underline", strikethrough: "Strikethrough", subscript: "Subscript", superscript: "Superscript" }, function (t, n) { e.addButton(n, { tooltip: t, onPostRender: function () { var t = this; e.formatter ? e.formatter.formatChanged(n, function (e) { t.active(e) }) : e.on("init", function () { e.formatter.formatChanged(n, function (e) { t.active(e) }) }) }, onclick: function () { l(n) } }) }), s({ outdent: ["Decrease indent", "Outdent"], indent: ["Increase indent", "Indent"], cut: ["Cut", "Cut"], copy: ["Copy", "Copy"], paste: ["Paste", "Paste"], help: ["Help", "mceHelp"], selectall: ["Select all", "SelectAll"], removeformat: ["Clear formatting", "RemoveFormat"], visualaid: ["Visual aids", "mceToggleVisualAid"], newdocument: ["New document", "mceNewDocument"] }, function (t, n) { e.addButton(n, { tooltip: t[0], cmd: t[1] }) }), s({ blockquote: ["Blockquote", "mceBlockQuote"], numlist: ["Numbered list", "InsertOrderedList"], bullist: ["Bullet list", "InsertUnorderedList"], subscript: ["Subscript", "Subscript"], superscript: ["Superscript", "Superscript"], alignleft: ["Align left", "JustifyLeft"], aligncenter: ["Align center", "JustifyCenter"], alignright: ["Align right", "JustifyRight"], alignjustify: ["Justify", "JustifyFull"] }, function (t, n) { e.addButton(n, { tooltip: t[0], cmd: t[1], onPostRender: function () { var t = this; e.formatter ? e.formatter.formatChanged(n, function (e) { t.active(e) }) : e.on("init", function () { e.formatter.formatChanged(n, function (e) { t.active(e) }) }) } }) }), e.addButton("undo", { tooltip: "Undo", onPostRender: o("undo"), cmd: "undo" }), e.addButton("redo", { tooltip: "Redo", onPostRender: o("redo"), cmd: "redo" }), e.addMenuItem("newdocument", { text: "New document", shortcut: "Ctrl+N", icon: "newdocument", cmd: "mceNewDocument" }), e.addMenuItem("undo", { text: "Undo", icon: "undo", shortcut: "Ctrl+Z", onPostRender: o("undo"), cmd: "undo" }), e.addMenuItem("redo", { text: "Redo", icon: "redo", shortcut: "Ctrl+Y", onPostRender: o("redo"), cmd: "redo" }), e.addMenuItem("visualaid", { text: "Visual aids", selectable: !0, onPostRender: a, cmd: "mceToggleVisualAid" }), s({ cut: ["Cut", "Cut", "Ctrl+X"], copy: ["Copy", "Copy", "Ctrl+C"], paste: ["Paste", "Paste", "Ctrl+V"], selectall: ["Select all", "SelectAll", "Ctrl+A"], bold: ["Bold", "Bold", "Ctrl+B"], italic: ["Italic", "Italic", "Ctrl+I"], underline: ["Underline", "Underline"], strikethrough: ["Strikethrough", "Strikethrough"], subscript: ["Subscript", "Subscript"], superscript: ["Superscript", "Superscript"], removeformat: ["Clear formatting", "RemoveFormat"] }, function (t, n) { e.addMenuItem(n, { text: t[0], icon: n, shortcut: t[2], cmd: t[1] }) }), e.on("mousedown", function () { n.hideAll() }), e.addButton("styleselect", { type: "menubutton", text: "Formats", menu: c }), e.addButton("formatselect", function () { var n = [], i = r(e.settings.block_formats || "Paragraph=p;Address=address;Pre=pre;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6"); return s(i, function (t) { n.push({ text: t[0], value: t[1], textStyle: function () { return e.formatter.getCssText(t[1]) } }) }), { type: "listbox", text: i[0][0], values: n, fixedWidth: !0, onselect: l, onPostRender: t(n)} }), e.addButton("fontselect", function () { var n = "Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats", i = [], o = r(e.settings.font_formats || n); return s(o, function (e) { i.push({ text: { raw: e[0] }, value: e[1], textStyle: -1 == e[1].indexOf("dings") ? "font-family:" + e[1] : "" }) }), { type: "listbox", text: "Font Family", tooltip: "Font Family", values: i, fixedWidth: !0, onPostRender: t(i, "fontname"), onselect: function (t) { t.control.settings.value && e.execCommand("FontName", !1, t.control.settings.value) } } }), e.addButton("fontsizeselect", function () { var n = [], r = "8pt 10pt 12pt 14pt 18pt 24pt 36pt", i = e.settings.fontsize_formats || r; return s(i.split(" "), function (e) { var t = e, r = e, i = e.split("="); i.length > 1 && (t = i[0], r = i[1]), n.push({ text: t, value: r }) }), { type: "listbox", text: "Font Sizes", tooltip: "Font Sizes", values: n, fixedWidth: !0, onPostRender: t(n, "fontsize"), onclick: function (t) { t.control.settings.value && e.execCommand("FontSize", !1, t.control.settings.value) } } }), e.addMenuItem("formats", { text: "Formats", menu: c }) } var s = r.each; i.on("AddEditor", function (t) { t.editor.rtl && (e.rtl = !0), a(t.editor) }), e.translate = function (e) { return i.translate(e) }, t.tooltips = !o.iOS }), r(qt, [_t], function (e) { return e.extend({ recalc: function (e) { var t = e.settings, n, r, i, o, a, s, l, c, u, d, f, p, h, m, g, v, y, b, C, x, w, _, E = [], N = [], k, S, T, R, A, B; t = e.settings, i = e.items().filter(":visible"), o = e.layoutRect(), r = t.columns || Math.ceil(Math.sqrt(i.length)), n = Math.ceil(i.length / r), y = t.spacingH || t.spacing || 0, b = t.spacingV || t.spacing || 0, C = t.alignH || t.align, x = t.alignV || t.align, g = e._paddingBox, A = "reverseRows" in t ? t.reverseRows : e.isRtl(), C && "string" == typeof C && (C = [C]), x && "string" == typeof x && (x = [x]); for (d = 0; r > d; d++) E.push(0); for (f = 0; n > f; f++) N.push(0); for (f = 0; n > f; f++) for (d = 0; r > d && (u = i[f * r + d], u); d++) c = u.layoutRect(), k = c.minW, S = c.minH, E[d] = k > E[d] ? k : E[d], N[f] = S > N[f] ? S : N[f]; for (T = o.innerW - g.left - g.right, w = 0, d = 0; r > d; d++) w += E[d] + (d > 0 ? y : 0), T -= (d > 0 ? y : 0) + E[d]; for (R = o.innerH - g.top - g.bottom, _ = 0, f = 0; n > f; f++) _ += N[f] + (f > 0 ? b : 0), R -= (f > 0 ? b : 0) + N[f]; if (w += g.left + g.right, _ += g.top + g.bottom, l = {}, l.minW = w + (o.w - o.innerW), l.minH = _ + (o.h - o.innerH), l.contentW = l.minW - o.deltaW, l.contentH = l.minH - o.deltaH, l.minW = Math.min(l.minW, o.maxW), l.minH = Math.min(l.minH, o.maxH), l.minW = Math.max(l.minW, o.startMinWidth), l.minH = Math.max(l.minH, o.startMinHeight), !o.autoResize || l.minW == o.minW && l.minH == o.minH) { o.autoResize && (l = e.layoutRect(l), l.contentW = l.minW - o.deltaW, l.contentH = l.minH - o.deltaH); var D; D = "start" == t.packV ? 0 : R > 0 ? Math.floor(R / n) : 0; var L = 0, H = t.flexWidths; if (H) for (d = 0; d < H.length; d++) L += H[d]; else L = r; var M = T / L; for (d = 0; r > d; d++) E[d] += H ? H[d] * M : M; for (h = g.top, f = 0; n > f; f++) { for (p = g.left, s = N[f] + D, d = 0; r > d && (B = A ? f * r + r - 1 - d : f * r + d, u = i[B], u); d++) m = u.settings, c = u.layoutRect(), a = Math.max(E[d], c.startMinWidth), c.x = p, c.y = h, v = m.alignH || (C ? C[d] || C[0] : null), "center" == v ? c.x = p + a / 2 - c.w / 2 : "right" == v ? c.x = p + a - c.w : "stretch" == v && (c.w = a), v = m.alignV || (x ? x[d] || x[0] : null), "center" == v ? c.y = h + s / 2 - c.h / 2 : "bottom" == v ? c.y = h + s - c.h : "stretch" == v && (c.h = s), u.layoutRect(c), p += a + y, u.recalc && u.recalc(); h += s + b } } else if (l.w = l.minW, l.h = l.minH, e.layoutRect(l), this.recalc(e), null === e._lastRect) { var P = e.parent(); P && (P._lastRect = null, P.recalc()) } } }) }), r(jt, [Nt], function (e) { return e.extend({ renderHtml: function () { var e = this; return e.addClass("iframe"), e.canFocus = !1, '<iframe id="' + e._id + '" class="' + e.classes() + '" tabindex="-1" src="' + (e.settings.url || "javascript:''") + '" frameborder="0"></iframe>' }, src: function (e) { this.getEl().src = e }, html: function (e, t) { var n = this, r = this.getEl().contentWindow.document.body; return r ? (r.innerHTML = e, t && t()) : setTimeout(function () { n.html(e) }, 0), this } }) }), r(Yt, [Nt, Y], function (e, t) { return e.extend({ init: function (e) { var t = this; t._super(e), t.addClass("widget"), t.addClass("label"), t.canFocus = !1, e.multiline && t.addClass("autoscroll"), e.strong && t.addClass("strong") }, initLayoutRect: function () { var e = this, n = e._super(); if (e.settings.multiline) { var r = t.getSize(e.getEl()); r.width > n.maxW && (n.minW = n.maxW, e.addClass("multiline")), e.getEl().style.width = n.minW + "px", n.startMinH = n.h = n.minH = Math.min(n.maxH, t.getSize(e.getEl()).height) } return n }, repaint: function () { var e = this; return e.settings.multiline || (e.getEl().style.lineHeight = e.layoutRect().h + "px"), e._super() }, text: function (e) { var t = this; return t._rendered && e && this.innerHtml(t.encode(e)), t._super(e) }, renderHtml: function () { var e = this, t = e.settings.forId; return '<label id="' + e._id + '" class="' + e.classes() + '"' + (t ? ' for="' + t + '"' : "") + ">" + e.encode(e._text) + "</label>" } }) }), r(Kt, [J], function (e) { return e.extend({ Defaults: { role: "toolbar", layout: "flow" }, init: function (e) { var t = this; t._super(e), t.addClass("toolbar") }, postRender: function () { var e = this; return e.items().addClass("toolbar-item"), e._super() } }) }), r(Gt, [Kt], function (e) { return e.extend({ Defaults: { role: "menubar", containerCls: "menubar", ariaRoot: !0, defaults: { type: "menubutton"}} }) }), r(Xt, [kt, G, Gt], function (e, t, n) { function r(e, t) { for (; e; ) { if (t === e) return !0; e = e.parentNode } return !1 } var i = e.extend({ init: function (e) { var t = this; t._renderOpen = !0, t._super(e), t.addClass("menubtn"), e.fixedWidth && t.addClass("fixed-width"), t.aria("haspopup", !0), t.hasPopup = !0 }, showMenu: function () { var e = this, n = e.settings, r; return e.menu && e.menu.visible() ? e.hideMenu() : (e.menu || (r = n.menu || [], r.length ? r = { type: "menu", items: r} : r.type = r.type || "menu", e.menu = t.create(r).parent(e).renderTo(), e.fire("createmenu"), e.menu.reflow(), e.menu.on("cancel", function (t) { t.control.parent() === e.menu && (t.stopPropagation(), e.focus(), e.hideMenu()) }), e.menu.on("select", function () { e.focus() }), e.menu.on("show hide", function (t) { t.control == e.menu && e.activeMenu("show" == t.type), e.aria("expanded", "show" == t.type) }).fire("show")), e.menu.show(), e.menu.layoutRect({ w: e.layoutRect().w }), void e.menu.moveRel(e.getEl(), e.isRtl() ? ["br-tr", "tr-br"] : ["bl-tl", "tl-bl"])) }, hideMenu: function () { var e = this; e.menu && (e.menu.items().each(function (e) { e.hideMenu && e.hideMenu() }), e.menu.hide()) }, activeMenu: function (e) { this.toggleClass("active", e) }, renderHtml: function () { var e = this, t = e._id, r = e.classPrefix, i = e.settings.icon, o; return o = e.settings.image, o ? (i = "none", "string" != typeof o && (o = window.getSelection ? o[0] : o[1]), o = " style=\"background-image: url('" + o + "')\"") : o = "", i = e.settings.icon ? r + "ico " + r + "i-" + i : "", e.aria("role", e.parent() instanceof n ? "menuitem" : "button"), '<div id="' + t + '" class="' + e.classes() + '" tabindex="-1" aria-labelledby="' + t + '"><button id="' + t + '-open" role="presentation" type="button" tabindex="-1">' + (i ? '<i class="' + i + '"' + o + "></i>" : "") + "<span>" + (e._text ? (i ? "\xa0" : "") + e.encode(e._text) : "") + '</span> <i class="' + r + 'caret"></i></button></div>' }, postRender: function () { var e = this; return e.on("click", function (t) { t.control === e && r(t.target, e.getEl()) && (e.showMenu(), t.aria && e.menu.items()[0].focus()) }), e.on("mouseenter", function (t) { var n = t.control, r = e.parent(), o; n && r && n instanceof i && n.parent() == r && (r.items().filter("MenuButton").each(function (e) { e.hideMenu && e != n && (e.menu && e.menu.visible() && (o = !0), e.hideMenu()) }), o && (n.focus(), n.showMenu())) }), e._super() }, text: function (e) { var t = this, n, r; if (t._rendered) for (r = t.getEl("open").getElementsByTagName("span"), n = 0; n < r.length; n++) r[n].innerHTML = (t.settings.icon && e ? "\xa0" : "") + t.encode(e); return this._super(e) }, remove: function () { this._super(), this.menu && this.menu.remove() } }); return i }), r(Jt, [Xt], function (e) { return e.extend({ init: function (e) { function t(r) { for (var a = 0; a < r.length; a++) { if (i = r[a].selected || e.value === r[a].value) { o = o || r[a].text, n._value = r[a].value; break } r[a].menu && t(r[a].menu) } } var n = this, r, i, o, a; n._values = r = e.values, r && ("undefined" != typeof e.value && t(r), !i && r.length > 0 && (o = r[0].text, n._value = r[0].value), e.menu = r), e.text = e.text || o || r[0].text, n._super(e), n.addClass("listbox"), n.on("select", function (t) { var r = t.control; a && (t.lastControl = a), e.multiple ? r.active(!r.active()) : n.value(t.control.settings.value), a = r }) }, value: function (e) { function t(e, n) { e.items().each(function (e) { i = e.value() === n, i && (o = o || e.text()), e.active(i), e.menu && t(e.menu, n) }) } function n(t) { for (var r = 0; r < t.length; r++) i = t[r].value == e, i && (o = o || t[r].text), t[r].active = i, t[r].menu && n(t[r].menu) } var r = this, i, o, a; return "undefined" != typeof e && (r.menu ? t(r.menu, e) : (a = r.settings.menu, n(a)), r.text(o || this.settings.text)), r._super(e) } }) }), r(Qt, [Nt, G, d], function (e, t, n) { return e.extend({ Defaults: { border: 0, role: "menuitem" }, init: function (e) { var t = this; t.hasPopup = !0, t._super(e), e = t.settings, t.addClass("menu-item"), e.menu && t.addClass("menu-item-expand"), e.preview && t.addClass("menu-item-preview"), ("-" === t._text || "|" === t._text) && (t.addClass("menu-item-sep"), t.aria("role", "separator"), t._text = "-"), e.selectable && (t.aria("role", "menuitemcheckbox"), t.addClass("menu-item-checkbox"), e.icon = "selected"), e.preview || e.selectable || t.addClass("menu-item-normal"), t.on("mousedown", function (e) { e.preventDefault() }), e.menu && !e.ariaHideMenu && t.aria("haspopup", !0) }, hasMenus: function () { return !!this.settings.menu }, showMenu: function () { var e = this, n = e.settings, r, i = e.parent(); if (i.items().each(function (t) { t !== e && t.hideMenu() }), n.menu) { r = e.menu, r ? r.show() : (r = n.menu, r.length ? r = { type: "menu", items: r} : r.type = r.type || "menu", i.settings.itemDefaults && (r.itemDefaults = i.settings.itemDefaults), r = e.menu = t.create(r).parent(e).renderTo(), r.reflow(), r.on("cancel", function (t) { t.stopPropagation(), e.focus(), r.hide() }), r.on("show hide", function (e) { e.control.items().each(function (e) { e.active(e.settings.selected) }) }).fire("show"), r.on("hide", function (t) { t.control === r && e.removeClass("selected") }), r.submenu = !0), r._parentMenu = i, r.addClass("menu-sub"); var o = r.testMoveRel(e.getEl(), e.isRtl() ? ["tl-tr", "bl-br", "tr-tl", "br-bl"] : ["tr-tl", "br-bl", "tl-tr", "bl-br"]); r.moveRel(e.getEl(), o), r.rel = o, o = "menu-sub-" + o, r.removeClass(r._lastRel), r.addClass(o), r._lastRel = o, e.addClass("selected"), e.aria("expanded", !0) } }, hideMenu: function () { var e = this; return e.menu && (e.menu.items().each(function (e) { e.hideMenu && e.hideMenu() }), e.menu.hide(), e.aria("expanded", !1)), e }, renderHtml: function () { var e = this, t = e._id, r = e.settings, i = e.classPrefix, o = e.encode(e._text), a = e.settings.icon, s = "", l = r.shortcut; return a && e.parent().addClass("menu-has-icons"), r.image && (a = "none", s = " style=\"background-image: url('" + r.image + "')\""), l && n.mac && (l = l.replace(/ctrl\+alt\+/i, "&#x2325;&#x2318;"), l = l.replace(/ctrl\+/i, "&#x2318;"), l = l.replace(/alt\+/i, "&#x2325;"), l = l.replace(/shift\+/i, "&#x21E7;")), a = i + "ico " + i + "i-" + (e.settings.icon || "none"), '<div id="' + t + '" class="' + e.classes() + '" tabindex="-1">' + ("-" !== o ? '<i class="' + a + '"' + s + "></i>\xa0" : "") + ("-" !== o ? '<span id="' + t + '-text" class="' + i + 'text">' + o + "</span>" : "") + (l ? '<div id="' + t + '-shortcut" class="' + i + 'menu-shortcut">' + l + "</div>" : "") + (r.menu ? '<div class="' + i + 'caret"></div>' : "") + "</div>" }, postRender: function () { var e = this, t = e.settings, n = t.textStyle; if ("function" == typeof n && (n = n.call(this)), n) { var r = e.getEl("text"); r && r.setAttribute("style", n) } return e.on("mouseenter click", function (n) { n.control === e && (t.menu || "click" !== n.type ? (e.showMenu(), n.aria && e.menu.focus(!0)) : (e.fire("select"), e.parent().hideAll())) }), e._super(), e }, active: function (e) { return "undefined" != typeof e && this.aria("checked", e), this._super(e) }, remove: function () { this._super(), this.menu && this.menu.remove() } }) }), r(Zt, [rt, Qt, u], function (e, t, n) { var r = e.extend({ Defaults: { defaultType: "menuitem", border: 1, layout: "stack", role: "application", bodyRole: "menu", ariaRoot: !0 }, init: function (e) { var t = this; if (e.autohide = !0, e.constrainToViewport = !0, e.itemDefaults) for (var r = e.items, i = r.length; i--; ) r[i] = n.extend({}, e.itemDefaults, r[i]); t._super(e), t.addClass("menu") }, repaint: function () { return this.toggleClass("menu-align", !0), this._super(), this.getEl().style.height = "", this.getEl("body").style.height = "", this }, cancel: function () { var e = this; e.hideAll(), e.fire("select") }, hideAll: function () { var e = this; return this.find("menuitem").exec("hideMenu"), e._super() }, preRender: function () { var e = this; return e.items().each(function (t) { var n = t.settings; return n.icon || n.selectable ? (e._hasIcons = !0, !1) : void 0 }), e._super() } }); return r }), r(en, [Tt], function (e) { return e.extend({ Defaults: { classes: "radio", role: "radio"} }) }), r(tn, [Nt, Q], function (e, t) { return e.extend({ renderHtml: function () { var e = this, t = e.classPrefix; return e.addClass("resizehandle"), "both" == e.settings.direction && e.addClass("resizehandle-both"), e.canFocus = !1, '<div id="' + e._id + '" class="' + e.classes() + '"><i class="' + t + "ico " + t + 'i-resize"></i></div>' }, postRender: function () { var e = this; e._super(), e.resizeDragHelper = new t(this._id, { start: function () { e.fire("ResizeStart") }, drag: function (t) { "both" != e.settings.direction && (t.deltaX = 0), e.fire("Resize", t) }, stop: function () { e.fire("ResizeEnd") } }) }, remove: function () { return this.resizeDragHelper && this.resizeDragHelper.destroy(), this._super() } }) }), r(nn, [Nt], function (e) { return e.extend({ renderHtml: function () { var e = this; return e.addClass("spacer"), e.canFocus = !1, '<div id="' + e._id + '" class="' + e.classes() + '"></div>' } }) }), r(rn, [Xt, Y], function (e, t) { return e.extend({ Defaults: { classes: "widget btn splitbtn", role: "button" }, repaint: function () { var e = this, n = e.getEl(), r = e.layoutRect(), i, o; return e._super(), i = n.firstChild, o = n.lastChild, t.css(i, { width: r.w - t.getSize(o).width, height: r.h - 2 }), t.css(o, { height: r.h - 2 }), e }, activeMenu: function (e) { var n = this; t.toggleClass(n.getEl().lastChild, n.classPrefix + "active", e) }, renderHtml: function () { var e = this, t = e._id, n = e.classPrefix, r, i = e.settings.icon; return r = e.settings.image, r ? (i = "none", "string" != typeof r && (r = window.getSelection ? r[0] : r[1]), r = " style=\"background-image: url('" + r + "')\"") : r = "", i = e.settings.icon ? n + "ico " + n + "i-" + i : "", '<div id="' + t + '" class="' + e.classes() + '" role="button" tabindex="-1"><button type="button" hidefocus="1" tabindex="-1">' + (i ? '<i class="' + i + '"' + r + "></i>" : "") + (e._text ? (i ? " " : "") + e._text : "") + '</button><button type="button" class="' + n + 'open" hidefocus="1" tabindex="-1">' + (e._menuBtnText ? (i ? "\xa0" : "") + e._menuBtnText : "") + ' <i class="' + n + 'caret"></i></button></div>' }, postRender: function () { var e = this, t = e.settings.onclick; return e.on("click", function (e) { var n = e.target; if (e.control == this) for (; n; ) { if (e.aria && "down" != e.aria.key || "BUTTON" == n.nodeName && -1 == n.className.indexOf("open")) return e.stopImmediatePropagation(), void t.call(this, e); n = n.parentNode } }), delete e.settings.onclick, e._super() } }) }), r(on, [Ut], function (e) { return e.extend({ Defaults: { containerClass: "stack-layout", controlClass: "stack-layout-item", endClass: "break"} }) }), r(an, [et, Y], function (e, t) { return e.extend({ Defaults: { layout: "absolute", defaults: { type: "panel"} }, activateTab: function (e) { var n; this.activeTabId && (n = this.getEl(this.activeTabId), t.removeClass(n, this.classPrefix + "active"), n.setAttribute("aria-selected", "false")), this.activeTabId = "t" + e, n = this.getEl("t" + e), n.setAttribute("aria-selected", "true"), t.addClass(n, this.classPrefix + "active"), this.items()[e].show().fire("showtab"), this.reflow(), this.items().each(function (t, n) { e != n && t.hide() }) }, renderHtml: function () { var e = this, t = e._layout, n = "", r = e.classPrefix; return e.preRender(), t.preRender(e), e.items().each(function (t, i) { var o = e._id + "-t" + i; t.aria("role", "tabpanel"), t.aria("labelledby", o), n += '<div id="' + o + '" class="' + r + 'tab" unselectable="on" role="tab" aria-controls="' + t._id + '" aria-selected="false" tabIndex="-1">' + e.encode(t.settings.title) + "</div>" }), '<div id="' + e._id + '" class="' + e.classes() + '" hidefocus="1" tabindex="-1"><div id="' + e._id + '-head" class="' + r + 'tabs" role="tablist">' + n + '</div><div id="' + e._id + '-body" class="' + e.classes("body") + '">' + t.renderHtml(e) + "</div></div>" }, postRender: function () { var e = this; e._super(), e.settings.activeTab = e.settings.activeTab || 0, e.activateTab(e.settings.activeTab), this.on("click", function (t) { var n = t.target.parentNode; if (t.target.parentNode.id == e._id + "-head") for (var r = n.childNodes.length; r--; ) n.childNodes[r] == t.target && e.activateTab(r) }) }, initLayoutRect: function () { var e = this, n, r, i; r = t.getSize(e.getEl("head")).width, r = 0 > r ? 0 : r, i = 0, e.items().each(function (e) { r = Math.max(r, e.layoutRect().minW), i = Math.max(i, e.layoutRect().minH) }), e.items().each(function (e) { e.settings.x = 0, e.settings.y = 0, e.settings.w = r, e.settings.h = i, e.layoutRect({ x: 0, y: 0, w: r, h: i }) }); var o = t.getSize(e.getEl("head")).height; return e.settings.minWidth = r, e.settings.minHeight = i + o, n = e._super(), n.deltaH += o, n.innerH = n.h - n.deltaH, n } }) }), r(sn, [Nt, Y], function (e, t) { return e.extend({ init: function (e) { var t = this; t._super(e), t._value = e.value || "", t.addClass("textbox"), e.multiline ? t.addClass("multiline") : t.on("keydown", function (e) { 13 == e.keyCode && t.parents().reverse().each(function (t) { return e.preventDefault(), t.hasEventListeners("submit") && t.toJSON ? (t.fire("submit", { data: t.toJSON() }), !1) : void 0 }) }) }, disabled: function (e) { var t = this; return t._rendered && "undefined" != typeof e && (t.getEl().disabled = e), t._super(e) }, value: function (e) { var t = this; return "undefined" != typeof e ? (t._value = e, t._rendered && (t.getEl().value = e), t) : t._rendered ? t.getEl().value : t._value }, repaint: function () { var e = this, t, n, r, i = 0, o = 0, a; t = e.getEl().style, n = e._layoutRect, a = e._lastRepaintRect || {}; var s = document; return !e.settings.multiline && s.all && (!s.documentMode || s.documentMode <= 8) && (t.lineHeight = n.h - o + "px"), r = e._borderBox, i = r.left + r.right + 8, o = r.top + r.bottom + (e.settings.multiline ? 8 : 0), n.x !== a.x && (t.left = n.x + "px", a.x = n.x), n.y !== a.y && (t.top = n.y + "px", a.y = n.y), n.w !== a.w && (t.width = n.w - i + "px", a.w = n.w), n.h !== a.h && (t.height = n.h - o + "px", a.h = n.h), e._lastRepaintRect = a, e.fire("repaint", {}, !1), e }, renderHtml: function () { var e = this, t = e._id, n = e.settings, r = e.encode(e._value, !1), i = ""; return "spellcheck" in n && (i += ' spellcheck="' + n.spellcheck + '"'), n.maxLength && (i += ' maxlength="' + n.maxLength + '"'), n.size && (i += ' size="' + n.size + '"'), n.subtype && (i += ' type="' + n.subtype + '"'), e.disabled() && (i += ' disabled="disabled"'), n.multiline ? '<textarea id="' + t + '" class="' + e.classes() + '" ' + (n.rows ? ' rows="' + n.rows + '"' : "") + ' hidefocus="1"' + i + ">" + r + "</textarea>" : '<input id="' + t + '" class="' + e.classes() + '" value="' + r + '" hidefocus="1"' + i + " />" }, postRender: function () { var e = this; return t.on(e.getEl(), "change", function (t) { e.fire("change", t) }), e._super() }, remove: function () { t.off(this.getEl()), this._super() } }) }), r(ln, [Y, K], function (e, t) { return function (n, r) { var i = this, o, a = t.classPrefix; i.show = function (t) { return i.hide(), o = !0, window.setTimeout(function () { o && n.appendChild(e.createFragment('<div class="' + a + "throbber" + (r ? " " + a + "throbber-inline" : "") + '"></div>')) }, t || 0), i }, i.hide = function () { var e = n.lastChild; return e && -1 != e.className.indexOf("throbber") && e.parentNode.removeChild(e), o = !1, i } } }), a([l, c, u, d, f, p, h, m, g, y, b, C, _, E, N, k, S, T, R, A, B, D, L, H, M, O, I, F, z, W, V, U, $, q, j, Y, K, G, X, J, Q, Z, et, tt, nt, rt, it, ot, at, st, lt, ct, ut, dt, ft, pt, ht, mt, gt, vt, yt, bt, Ct, xt, wt, _t, Et, Nt, kt, St, Tt, Rt, At, Bt, Dt, Lt, Ht, Mt, Pt, Ot, It, Ft, zt, Wt, Vt, Ut, $t, qt, jt, Yt, Kt, Gt, Xt, Jt, Qt, Zt, en, tn, nn, rn, on, an, sn, ln]) } (this); tinymce.PluginManager.add("autoresize", function (a) { function b() { return a.plugins.fullscreen && a.plugins.fullscreen.isFullscreen() } function c(d) { var g, h, i, j, k, l, m, n, o, p, q, r, s = tinymce.DOM; if (h = a.getDoc()) { if (i = h.body, j = h.documentElement, k = e.autoresize_min_height, !i || d && "setcontent" === d.type && d.initial || b()) return void (i && j && (i.style.overflowY = "auto", j.style.overflowY = "auto")); m = a.dom.getStyle(i, "margin-top", !0), n = a.dom.getStyle(i, "margin-bottom", !0), o = a.dom.getStyle(i, "padding-top", !0), p = a.dom.getStyle(i, "padding-bottom", !0), q = a.dom.getStyle(i, "border-top-width", !0), r = a.dom.getStyle(i, "border-bottom-width", !0), l = i.offsetHeight + parseInt(m, 10) + parseInt(n, 10) + parseInt(o, 10) + parseInt(p, 10) + parseInt(q, 10) + parseInt(r, 10), (isNaN(l) || 0 >= l) && (l = tinymce.Env.ie ? i.scrollHeight : tinymce.Env.webkit && 0 === i.clientHeight ? 0 : i.offsetHeight), l > e.autoresize_min_height && (k = l), e.autoresize_max_height && l > e.autoresize_max_height ? (k = e.autoresize_max_height, i.style.overflowY = "auto", j.style.overflowY = "auto") : (i.style.overflowY = "hidden", j.style.overflowY = "hidden", i.scrollTop = 0), k !== f && (g = k - f, s.setStyle(a.iframeElement, "height", k + "px"), f = k, tinymce.isWebKit && 0 > g && c(d)) } } function d(a, b, e) { setTimeout(function () { c({}), a-- ? d(a, b, e) : e && e() }, b) } var e = a.settings, f = 0; a.settings.inline || (e.autoresize_min_height = parseInt(a.getParam("autoresize_min_height", a.getElement().offsetHeight), 10), e.autoresize_max_height = parseInt(a.getParam("autoresize_max_height", 0), 10), a.on("init", function () { var b = a.getParam("autoresize_overflow_padding", 1); a.dom.setStyles(a.getBody(), { paddingBottom: a.getParam("autoresize_bottom_margin", 50), paddingLeft: b, paddingRight: b }) }), a.on("nodechange setcontent keyup FullscreenStateChanged", c), a.getParam("autoresize_on_init", !0) && a.on("init", function () { d(20, 100, function () { d(5, 1e3) }) }), a.addCommand("mceAutoResize", c)) }); tinymce.PluginManager.add("code", function (a) { function b() { var b = a.windowManager.open({ title: "Source code", body: { type: "textbox", name: "code", multiline: !0, minWidth: a.getParam("code_dialog_width", 600), minHeight: a.getParam("code_dialog_height", Math.min(tinymce.DOM.getViewPort().h - 200, 500)), spellcheck: !1, style: "direction: ltr; text-align: left" }, onSubmit: function (b) { a.focus(), a.undoManager.transact(function () { a.setContent(b.data.code) }), a.selection.setCursorLocation(), a.nodeChanged() } }); b.find("#code").value(a.getContent({ source_view: !0 })) } a.addCommand("mceCodeEditor", b), a.addButton("code", { icon: "code", tooltip: "Source code", onclick: b }), a.addMenuItem("code", { icon: "code", text: "Source code", context: "tools", onclick: b }) }); tinymce.PluginManager.add("textcolor", function (a) { function b(b) { var c; return a.dom.getParents(a.selection.getStart(), function (a) { var d; (d = a.style["forecolor" == b ? "color" : "background-color"]) && (c = d) }), c } function c() { var b, c, d = []; for (c = a.settings.textcolor_map || ["000000", "Black", "993300", "Burnt orange", "333300", "Dark olive", "003300", "Dark green", "003366", "Dark azure", "000080", "Navy Blue", "333399", "Indigo", "333333", "Very dark gray", "800000", "Maroon", "FF6600", "Orange", "808000", "Olive", "008000", "Green", "008080", "Teal", "0000FF", "Blue", "666699", "Grayish blue", "808080", "Gray", "FF0000", "Red", "FF9900", "Amber", "99CC00", "Yellow green", "339966", "Sea green", "33CCCC", "Turquoise", "3366FF", "Royal blue", "800080", "Purple", "999999", "Medium gray", "FF00FF", "Magenta", "FFCC00", "Gold", "FFFF00", "Yellow", "00FF00", "Lime", "00FFFF", "Aqua", "00CCFF", "Sky blue", "993366", "Red violet", "FFFFFF", "White", "FF99CC", "Pink", "FFCC99", "Peach", "FFFF99", "Light yellow", "CCFFCC", "Pale green", "CCFFFF", "Pale cyan", "99CCFF", "Light sky blue", "CC99FF", "Plum"], b = 0; b < c.length; b += 2) d.push({ text: c[b + 1], color: "#" + c[b] }); return d } function d() { function b(a, b) { var c = "transparent" == a; return '<td class="mce-grid-cell' + (c ? " mce-colorbtn-trans" : "") + '"><div id="' + n + "-" + o++ + '" data-mce-color="' + (a ? a : "") + '" role="option" tabIndex="-1" style="' + (a ? "background-color: " + a : "") + '" title="' + tinymce.translate(b) + '">' + (c ? "&#215;" : "") + "</div></td>" } var d, e, f, g, h, k, l, m = this, n = m._id, o = 0; for (d = c(), d.push({ text: tinymce.translate("No color"), color: "transparent" }), f = '<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>', g = d.length - 1, k = 0; j > k; k++) { for (f += "<tr>", h = 0; i > h; h++) l = k * i + h, l > g ? f += "<td></td>" : (e = d[l], f += b(e.color, e.text)); f += "</tr>" } if (a.settings.color_picker_callback) { for (f += '<tr><td colspan="' + i + '" class="mce-custom-color-btn"><div id="' + n + '-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="' + n + '-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">' + tinymce.translate("Custom...") + "</button></div></td></tr>", f += "<tr>", h = 0; i > h; h++) f += b("", "Custom color"); f += "</tr>" } return f += "</tbody></table>" } function e(b, c) { a.focus(), a.formatter.apply(b, { value: c }), a.nodeChanged() } function f(b) { a.focus(), a.formatter.remove(b, { value: null }, null, !0), a.nodeChanged() } function g(c) { function d(a) { j.hidePanel(), j.color(a), e(j.settings.format, a) } function g(a, b) { a.style.background = b, a.setAttribute("data-mce-color", b) } var h, j = this.parent(); if (tinymce.DOM.getParent(c.target, ".mce-custom-color-btn") && (j.hidePanel(), a.settings.color_picker_callback.call(a, function (a) { var b, c, e, f = j.panel.getEl().getElementsByTagName("table")[0]; for (b = tinymce.map(f.rows[f.rows.length - 1].childNodes, function (a) { return a.firstChild }), e = 0; e < b.length && (c = b[e], c.getAttribute("data-mce-color")); e++); if (e == i) for (e = 0; i - 1 > e; e++) g(b[e], b[e + 1].getAttribute("data-mce-color")); g(c, a), d(a) }, b(j.settings.format))), h = c.target.getAttribute("data-mce-color")) { if (this.lastId && document.getElementById(this.lastId).setAttribute("aria-selected", !1), c.target.setAttribute("aria-selected", !0), this.lastId = c.target.id, "transparent" == h) return f(j.settings.format), void j.hidePanel(); d(h) } else null !== h && j.hidePanel() } function h() { var a = this; a._color && e(a.settings.format, a._color) } var i, j; j = a.settings.textcolor_rows || 5, i = a.settings.textcolor_cols || 8, a.addButton("forecolor", { type: "colorbutton", tooltip: "Text color", format: "forecolor", panel: { role: "application", ariaRemember: !0, html: d, onclick: g }, onclick: h }), a.addButton("backcolor", { type: "colorbutton", tooltip: "Background color", format: "hilitecolor", panel: { role: "application", ariaRemember: !0, html: d, onclick: g }, onclick: h }) }); tinymce.ThemeManager.add("modern", function (a) { function b() { function b(b) { var d, e = []; if (b) return l(b.split(/[ ,]/), function (b) { function c() { var c = a.selection; "bullist" == f && c.selectorChanged("ul > li", function (a, c) { for (var d, e = c.parents.length; e-- && (d = c.parents[e].nodeName, "OL" != d && "UL" != d); ); b.active(a && "UL" == d) }), "numlist" == f && c.selectorChanged("ol > li", function (a, c) { for (var d, e = c.parents.length; e-- && (d = c.parents[e].nodeName, "OL" != d && "UL" != d); ); b.active(a && "OL" == d) }), b.settings.stateSelector && c.selectorChanged(b.settings.stateSelector, function (a) { b.active(a) }, !0), b.settings.disabledStateSelector && c.selectorChanged(b.settings.disabledStateSelector, function (a) { b.disabled(a) }) } var f; "|" == b ? d = null : k.has(b) ? (b = { type: b }, j.toolbar_items_size && (b.size = j.toolbar_items_size), e.push(b), d = null) : (d || (d = { type: "buttongroup", items: [] }, e.push(d)), a.buttons[b] && (f = b, b = a.buttons[f], "function" == typeof b && (b = b()), b.type = b.type || "button", j.toolbar_items_size && (b.size = j.toolbar_items_size), b = k.create(b), d.items.push(b), a.initialized ? c() : a.on("init", c))) }), c.push({ type: "toolbar", layout: "flow", items: e }), !0 } var c = []; if (tinymce.isArray(j.toolbar)) { if (0 === j.toolbar.length) return; tinymce.each(j.toolbar, function (a, b) { j["toolbar" + (b + 1)] = a }), delete j.toolbar } for (var d = 1; 10 > d && b(j["toolbar" + d]); d++); return c.length || j.toolbar === !1 || b(j.toolbar || o), c.length ? { type: "panel", layout: "stack", classes: "toolbar-grp", ariaRoot: !0, ariaRemember: !0, items: c} : void 0 } function c() { function b(b) { var c; return "|" == b ? { text: "|"} : c = a.menuItems[b] } function c(c) { var d, e, f, g, h; if (h = tinymce.makeMap((j.removed_menuitems || "").split(/[ ,]/)), j.menu ? (e = j.menu[c], g = !0) : e = n[c], e) { d = { text: e.title }, f = [], l((e.items || "").split(/[ ,]/), function (a) { var c = b(a); c && !h[a] && f.push(b(a)) }), g || l(a.menuItems, function (a) { a.context == c && ("before" == a.separator && f.push({ text: "|" }), a.prependToContext ? f.unshift(a) : f.push(a), "after" == a.separator && f.push({ text: "|" })) }); for (var i = 0; i < f.length; i++) "|" == f[i].text && (0 === i || i == f.length - 1) && f.splice(i, 1); if (d.menu = f, !d.menu.length) return null } return d } var d, e = [], f = []; if (j.menu) for (d in j.menu) f.push(d); else for (d in n) f.push(d); for (var g = "string" == typeof j.menubar ? j.menubar.split(/[ ,]/) : f, h = 0; h < g.length; h++) { var i = g[h]; i = c(i), i && e.push(i) } return e } function d(b) { function c(a) { var c = b.find(a)[0]; c && c.focus(!0) } a.shortcuts.add("Alt+F9", "", function () { c("menubar") }), a.shortcuts.add("Alt+F10", "", function () { c("toolbar") }), a.shortcuts.add("Alt+F11", "", function () { c("elementpath") }), b.on("cancel", function () { a.focus() }) } function e(b, c) { function d(a) { return { width: a.clientWidth, height: a.clientHeight} } var e, f, g, h; e = a.getContainer(), f = a.getContentAreaContainer().firstChild, g = d(e), h = d(f), null !== b && (b = Math.max(j.min_width || 100, b), b = Math.min(j.max_width || 65535, b), m.setStyle(e, "width", b + (g.width - h.width)), m.setStyle(f, "width", b)), c = Math.max(j.min_height || 100, c), c = Math.min(j.max_height || 65535, c), m.setStyle(f, "height", c), a.fire("ResizeEditor") } function f(b, c) { var d = a.getContentAreaContainer(); i.resizeTo(d.clientWidth + b, d.clientHeight + c) } function g(e) { function f() { if (n && n.moveRel && n.visible() && !n._fixed) { var b = a.selection.getScrollContainer(), c = a.getBody(), d = 0, e = 0; if (b) { var f = m.getPos(c), g = m.getPos(b); d = Math.max(0, g.x - f.x), e = Math.max(0, g.y - f.y) } n.fixed(!1).moveRel(c, a.rtl ? ["tr-br", "br-tr"] : ["tl-bl", "bl-tl", "tr-br"]).moveBy(d, e) } } function g() { n && (n.show(), f(), m.addClass(a.getBody(), "mce-edit-focus")) } function h() { n && (n.hide(), m.removeClass(a.getBody(), "mce-edit-focus")) } function l() { return n ? void (n.visible() || g()) : (n = i.panel = k.create({ type: o ? "panel" : "floatpanel", role: "application", classes: "tinymce tinymce-inline", layout: "flex", direction: "column", align: "stretch", autohide: !1, autofix: !0, fixed: !!o, border: 1, items: [j.menubar === !1 ? null : { type: "menubar", border: "0 0 1 0", items: c() }, b()] }), a.fire("BeforeRenderUI"), n.renderTo(o || document.body).reflow(), d(n), g(), a.on("nodeChange", f), a.on("activate", g), a.on("deactivate", h), void a.nodeChanged()) } var n, o; return j.fixed_toolbar_container && (o = m.select(j.fixed_toolbar_container)[0]), j.content_editable = !0, a.on("focus", function () { e.skinUiCss ? tinymce.DOM.styleSheetLoader.load(e.skinUiCss, l, l) : l() }), a.on("blur hide", h), a.on("remove", function () { n && (n.remove(), n = null) }), e.skinUiCss && tinymce.DOM.styleSheetLoader.load(e.skinUiCss), {} } function h(f) { var g, h, l; return /*f.skinUiCss&&tinymce.DOM.loadCSS(f.skinUiCss)*/true, g = i.panel = k.create({ type: "panel", role: "application", classes: "tinymce", style: "visibility: hidden", layout: "stack", border: 1, items: [j.menubar === !1 ? null : { type: "menubar", border: "0 0 1 0", items: c() }, b(), { type: "panel", name: "iframe", layout: "stack", classes: "edit-area", html: "", border: "1 0 0 0"}] }), j.resize !== !1 && (h = { type: "resizehandle", direction: j.resize, onResizeStart: function () { var b = a.getContentAreaContainer().firstChild; l = { width: b.clientWidth, height: b.clientHeight} }, onResize: function (a) { "both" == j.resize ? e(l.width + a.deltaX, l.height + a.deltaY) : e(null, l.height + a.deltaY) } }), j.statusbar !== !1 && g.add({ type: "panel", name: "statusbar", classes: "statusbar", layout: "flow", border: "1 0 0 0", ariaRoot: !0, items: [{ type: "elementpath" }, h] }), j.readonly && g.find("*").disabled(!0), a.fire("BeforeRenderUI"), g.renderBefore(f.targetNode).reflow(), j.width && tinymce.DOM.setStyle(g.getEl(), "width", j.width), a.on("remove", function () { g.remove(), g = null }), d(g), { iframeContainer: g.find("#iframe")[0].getEl(), editorContainer: g.getEl()} } var i = this, j = a.settings, k = tinymce.ui.Factory, l = tinymce.each, m = tinymce.DOM, n = { file: { title: "File", items: "newdocument" }, edit: { title: "Edit", items: "undo redo | cut copy paste pastetext | selectall" }, insert: { title: "Insert", items: "|" }, view: { title: "View", items: "visualaid |" }, format: { title: "Format", items: "bold italic underline strikethrough superscript subscript | formats | removeformat" }, table: { title: "Table" }, tools: { title: "Tools"} }, o = "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"; i.renderUI = function (b) { var c = j.skin !== !1 ? j.skin || "lightgray" : !1; if (c) { var d = j.skin_url; d = d ? a.documentBaseURI.toAbsolute(d) : tinymce.baseURL + "/skins/" + c, b.skinUiCss = tinymce.Env.documentMode <= 7 ? d + "/skin.ie7.min.css" : d + "/skin.min.css", a.contentCSS.push(d + "/content" + (a.inline ? ".inline" : "") + ".min.css") } return a.on("ProgressState", function (a) { i.throbber = i.throbber || new tinymce.ui.Throbber(i.panel.getEl("body")), a.state ? i.throbber.show(a.time) : i.throbber.hide() }), j.inline ? g(b) : h(b) }, i.resizeTo = e, i.resizeBy = f });;
(function(n,t){function a(){for(var n=0;n<i.length;n++)i[n]&&i[n].hide()}function v(n,i){var r=t.extend({},h,n);return r.callbacks={move:u(r.move,i),change:u(r.change,i),show:u(r.show,i),hide:u(r.hide,i),beforeShow:u(r.beforeShow,i)},r}function y(r,u){function dr(){function i(n){return n.data&&n.data.ignore?(et(t(this).data("color")),ri()):(et(t(this).data("color")),ui(!0),ri(),g()),!1}if(e&&f.find("*:not(input)").attr("unselectable","on"),f.toggleClass("sp-flat",k),f.toggleClass("sp-input-disabled",!bi),f.toggleClass("sp-buttons-disabled",!h.showButtons),f.toggleClass("sp-palette-disabled",!vt),f.toggleClass("sp-palette-only",pi),f.toggleClass("sp-initial-disabled",!wi),f.addClass(h.className),ci&&it.hide().after(ft),k?it.after(f).hide():t(wr).append(f.hide()),yt&&n.localStorage)try{ct=n.localStorage[yt].split(",")}catch(u){}li.bind("click.spectrum touchstart.spectrum",function(n){nu();n.stopPropagation();t(n.target).is("input")||n.preventDefault()});f.click(w);d.change(vi);d.bind("paste",function(){setTimeout(vi,1)});d.keydown(function(n){n.keyCode==13&&vi()});si.bind("click",function(n){n.stopPropagation();n.preventDefault();tr?(k=!1,tr.apply(this,[{instance:this,destroy:vr,hide:g}])):g()});er.bind("click",function(n){n.stopPropagation();n.preventDefault();iu()&&(ui(!0),g());si.trigger("click")});s(oi,function(n,t){ut=t/pt;ri()},cr,lr);s(ni,function(n,t){wt=n/ht;bt=(nt-t)/nt;ri()},cr,lr);ti?(et(ti),lt(),ii=ai||tinycolor(ti).format,or(ti)):lt();k&&yi();var r=e?"mousedown.spectrum":"click.spectrum touchstart.spectrum";ur.delegate("span",r,i);fr.delegate("span::nth-child(1)",r,{ignore:!0},i)}function or(t){yr&&(ct.push(tinycolor(t).toHexString()),yt&&n.localStorage&&(n.localStorage[yt]=ct.join(",")))}function gr(){var f=[],r=ct,u={},i,n,e,t;if(vt){for(n=0;n<dt.length;n++)for(i=0;i<dt[n].length;i++)t=tinycolor(dt[n][i]).toHexString(),u[t]=!0;for(n=0;n<r.length;n++)e=tinycolor(r[n]),t=e.toHexString(),u.hasOwnProperty(t)||(f.push(r[n]),u[t]=!0)}return f.reverse().slice(0,h.maxSelectionSize)}function sr(){var n=y(),i=t.map(dt,function(t,i){return o(t,n,"sp-palette-row sp-palette-row-"+i)});ct&&i.push(o(gr(),n,"sp-palette-row sp-palette-row-selection"));ur.html(i.join(""))}function hr(){if(wi){var t=rt,n=y();fr.html(o([t,n],n,"sp-palette-row-initial"))}}function cr(){(nt===0||ht===0||pt===0)&&fi();f.addClass(nr)}function lr(){f.removeClass(nr)}function vi(){var n=tinycolor(d.val());n.ok?et(n):d.addClass("sp-validation-error")}function nu(){st?g():yi()}function yi(){if(st){fi();return}ot.beforeShow(y())!==!1&&(a(),st=!0,t(gt).bind("click.spectrum",g),t(n).bind("resize.spectrum",di),ft.addClass("sp-active"),f.show(),vt&&sr(),fi(),lt(),rt=y(),hr(),ot.show(rt))}function g(){if(st&&!k){st=!1;t(gt).unbind("click.spectrum",g);t(n).unbind("resize.spectrum",di);ft.removeClass("sp-active");f.hide();var i=!tinycolor.equals(y(),rt);i&&(kr?ui(!0):tu());ot.hide(y())}}function tu(){et(rt,!0)}function et(n,i){if(t(".sp-thumb-active").removeClass("sp-thumb-active"),!tinycolor.equals(n,y())){var u=tinycolor(n),r=u.toHsv();ut=r.h;wt=r.s;bt=r.v;kt=r.a;lt();i||(ii=ai||u.format)}}function y(){return tinycolor.fromRatio({h:ut,s:wt,v:bt,a:kt})}function iu(){return!d.hasClass("sp-validation-error")}function ri(){lt();ot.move(y())}function lt(){var t,n,i;d.removeClass("sp-validation-error");ar();t=tinycolor({h:ut,s:"1.0",v:"1.0",a:kt});ni.css("background-color",t.toHexString());n=y();i=kt!==0?n.toHexString():"transparent";br.css("background-color",i);bi&&d.val(n.toString(ii));vt&&sr();hr()}function ar(){var f=ut,r=wt,u=bt,n=r*ht,t=nt-u*nt,i;n=Math.max(-tt,Math.min(ht-tt,n-tt));t=Math.max(-tt,Math.min(nt-tt,t-tt));ir.css({top:t,left:n});i=ut*pt;rr.css({top:i-gi})}function ui(n){var t=y(),i;hi&&it.val(t.toString(ii)).change();i=!tinycolor.equals(t,rt);rt=t;or(t);n&&i&&ot.change(t)}function fi(){ht=ni.width();nt=ni.height();tt=ir.height();pr=oi.width();pt=oi.height();gi=rr.height();k||f.offset(p(f,li));ar()}function vr(){it.show();li.unbind("click.spectrum touchstart.spectrum");f.remove();ft.remove();i[at.id]=null}var h=v(u,r),k=h.flat,pi=h.showPaletteOnly,vt=h.showPalette||pi,wi=h.showInitial&&!k,bi=h.showInput,yr=h.showSelectionPalette,yt=h.localStorageKey,ki=h.theme,ot=h.callbacks,di=b(fi,10),st=!1,ht=0,nt=0,tt=0,pt=0,pr=0,gi=0,ut=0,wt=0,bt=0,kt=0,ei=h.palette.slice(0),dt=t.isArray(ei[0])?ei:[ei],ct=h.selectionPalette.slice(0),nr="sp-dragging",tr=h.cancelResponse?h.cancelResponse:!1,gt=r.ownerDocument,wr=gt.body,it=t(r),f=t(l,gt).addClass(ki),ni=f.find(".sp-color"),ir=f.find(".sp-dragger"),oi=f.find(".sp-hue"),rr=f.find(".sp-slider"),d=f.find(".sp-input"),ur=f.find(".sp-palette"),fr=f.find(".sp-initial"),si=f.find(".sp-cancel"),er=f.find(".sp-choose"),hi=it.is("input"),ci=hi&&!k,ft=ci?t(c).addClass(ki):t([]),li=ci?ft:it,br=ft.find(".sp-preview"),ti=h.color||hi&&it.val(),rt=!1,ai=h.preferredFormat,ii=ai,kr=!h.showButtons,at;return er.text(h.chooseText),si.text(h.cancelText),dr(),at={show:yi,hide:g,set:function(n){et(n);ui()},get:y,destroy:vr,container:f},at.id=i.push(at)-1,at}function p(n,i){var s=0,u=n.outerWidth(),f=n.outerHeight(),a=i.outerWidth(),h=i.outerHeight(),e=n[0].ownerDocument,c=e.documentElement,o=c.clientWidth+t(e).scrollLeft(),l=c.clientHeight+t(e).scrollTop(),r=i.offset();return r.top+=h,r.left-=Math.min(r.left,r.left+u>o&&o>u?Math.abs(r.left+u-o):0),r.top-=Math.min(r.top,r.top+f>l&&l>f?Math.abs(f+h-s):s),r}function r(){}function w(n){n.stopPropagation()}function u(n,t){var i=Array.prototype.slice,r=i.call(arguments,2);return function(){return n.apply(t,r.concat(i.call(arguments)))}}function s(i,r,u,f){function c(n){n.stopPropagation&&n.stopPropagation();n.preventDefault&&n.preventDefault();n.returnValue=!1}function y(n){if(o){if(w&&!(document.documentMode>=9)&&!n.button)return p();var t=n.originalEvent.touches,u=t?t[0].pageX:n.pageX,f=t?t[0].pageY:n.pageY,e=Math.max(0,Math.min(u-l.left,v)),h=Math.max(0,Math.min(f-l.top,a));s&&c(n);r.apply(i,[e,h])}}function b(n){var r=n.which?n.which==3:n.button==2,f=n.originalEvent.touches;r||o||u.apply(i,arguments)!==!1&&(o=!0,a=t(i).height(),v=t(i).width(),l=t(i).offset(),t(h).bind(e),t(h.body).addClass("sp-dragging"),s||y(n),c(n))}function p(){o&&(t(h).unbind(e),t(h.body).removeClass("sp-dragging"),f.apply(i,arguments));o=!1}r=r||function(){};u=u||function(){};f=f||function(){};var h=i.ownerDocument||document,o=!1,l={},a=0,v=0,w=t.browser.msie,s="ontouchstart"in n,e={};e.selectstart=c;e.dragstart=c;e[s?"touchmove":"mousemove"]=y;e[s?"touchend":"mouseup"]=p;t(i).bind(s?"touchstart":"mousedown",b)}function b(n,t,i){var r;return function(){var u=this,f=arguments,e=function(){r=null;n.apply(u,f)};i&&clearTimeout(r);(i||!r)&&(r=setTimeout(e,t))}}var h={beforeShow:r,move:r,change:r,show:r,hide:r,color:!1,flat:!1,showInput:!1,showButtons:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",theme:"sp-light",palette:["fff","000"],selectionPalette:[]},i=[],e=t.browser.msie,c="<div class='sp-replacer'><div class='sp-preview'><\/div><div class='sp-dd'>&#9660;<\/div><\/div>",l=function(){var t="",n;if(e)for(n=1;n<=6;n++)t+="<div class='sp-"+n+"'><\/div>";return["<div class='sp-container'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'><\/div>","<\/div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'><\/div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'><\/div>","<\/div>","<\/div>","<\/div>","<div class='sp-hue'>","<div class='sp-slider'><\/div>",t,"<\/div>","<\/div>","<\/div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","<\/div>","<div class='sp-initial sp-thumb sp-cf'><\/div>","<div class='sp-button-container sp-cf  biz-actions-bar'>","<a class='sp-cancel biz-btn biz-action-btn' href='#'><\/a>","<a class='sp-choose biz-btn biz-action-btn' href='#'><\/a>","<\/div>","<\/div>","<\/div>"].join("")}(),o=function(n,t,i){for(var e,o=[],r=0;r<n.length;r++){var u=tinycolor(n[r]),f="";tinycolor.equals(t,n[r])&&(f+="sp-thumb-active ");e="";n[r]==="transparent"?(e=u.toRgbString(),nTitle=n[r],f+="sp-thumb-transparent sp-thumb-light "):(e=nTitle=u.toHexString(),f+=u.toHsl().l<.5?"sp-thumb-dark ":"sp-thumb-light ");o.push('<span title="'+nTitle+'" data-color="'+e+'" style="background-color:'+u.toRgbString()+';" class="'+f+'"><\/span>')}return"<div class='sp-cf "+i+"'>"+o.join("")+"<\/div>"},f="spectrum.id";t.fn.spectrum=function(n,r){return typeof n=="string"?n=="get"?i[this.eq(0).data(f)].get():n=="container"?i[t(this).data(f)].container:this.each(function(){var u=i[t(this).data(f)];u&&(n=="show"&&u.show(),n=="hide"&&u.hide(),n=="set"&&u.set(r),n=="destroy"&&(u.destroy(),t(this).removeData(f)))}):this.spectrum("destroy").each(function(){var i=y(this,n);t(this).data(f,i.id)})};t.fn.spectrum.load=!0;t.fn.spectrum.loadOpts={};t.fn.spectrum.draggable=s;t.fn.spectrum.processNativeColorInputs=function(){var n=t("<input type='color' />")[0].type==="color";n||t("input[type=color]").spectrum({preferredFormat:"hex6"})};t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})})(this,jQuery),function(n){function t(n){if(typeof n=="object"&&n.hasOwnProperty("_tc_id"))return n;var e=g(n),t=e.r,r=e.g,u=e.b,f=h(e.a),o=e.format;return{ok:e.ok,format:o,_tc_id:d++,alpha:f,toHsv:function(){var n=p(t,r,u);return{h:n.h,s:n.s,v:n.v,a:f}},toHsvString:function(){var n=p(t,r,u),e=i(n.h*360),o=i(n.s*100),s=i(n.v*100);return f==1?"hsv("+e+", "+o+"%, "+s+"%)":"hsva("+e+", "+o+"%, "+s+"%, "+f+")"},toHsl:function(){var n=y(t,r,u);return{h:n.h,s:n.s,l:n.l,a:f}},toHslString:function(){var n=y(t,r,u),e=i(n.h*360),o=i(n.s*100),s=i(n.l*100);return f==1?"hsl("+e+", "+o+"%, "+s+"%)":"hsla("+e+", "+o+"%, "+s+"%, "+f+")"},toHex:function(){return c(t,r,u)},toHexString:function(n){return"#"+c(t,r,u,n)},toRgb:function(){return{r:i(t),g:i(r),b:i(u),a:f}},toRgbString:function(){return f==1?"rgb("+i(t)+", "+i(r)+", "+i(u)+")":"rgba("+i(t)+", "+i(r)+", "+i(u)+", "+f+")"},toName:function(){return w[c(t,r,u)]||!1},toFilter:function(){var n=c(t,r,u),i=Math.round(h(f)*255).toString(16);return"progid:DXImageTransform.Microsoft.gradient(startColorstr=#"+i+n+",endColorstr=#"+i+n+")"},toString:function(n){n=n||this.format;var t=!1;return n==="rgb"&&(t=this.toRgbString()),n==="hex"&&(t=this.toHexString()),n==="hex6"&&(t=this.toHexString(!0)),n==="name"&&(t=this.toName()),n==="hsl"&&(t=this.toHslString()),n==="hsv"&&(t=this.toHsvString()),t||this.toHexString()}}}function g(n){var t={r:0,g:0,b:0},o=1,r=!1,u=!1;return typeof n=="string"&&(n=et(n)),typeof n=="object"&&(n.hasOwnProperty("r")&&n.hasOwnProperty("g")&&n.hasOwnProperty("b")?(t=nt(n.r,n.g,n.b),r=!0,u="rgb"):n.hasOwnProperty("h")&&n.hasOwnProperty("s")&&n.hasOwnProperty("v")?(t=it(n.h,n.s,n.v),r=!0,u="hsv"):n.hasOwnProperty("h")&&n.hasOwnProperty("s")&&n.hasOwnProperty("l")&&(t=tt(n.h,n.s,n.l),r=!0,u="hsl"),n.hasOwnProperty("a")&&(o=n.a)),t.r=f(255,e(t.r,0)),t.g=f(255,e(t.g,0)),t.b=f(255,e(t.b,0)),t.r<1&&(t.r=i(t.r)),t.g<1&&(t.g=i(t.g)),t.b<1&&(t.b=i(t.b)),{ok:r,format:n&&n.format||u,r:t.r,g:t.g,b:t.b,a:o}}function nt(n,t,i){return{r:r(n,255)*255,g:r(t,255)*255,b:r(i,255)*255}}function y(n,t,i){var s;n=r(n,255);t=r(t,255);i=r(i,255);var u=e(n,t,i),h=f(n,t,i),o,c,l=(u+h)/2;if(u==h)o=c=0;else{s=u-h;c=l>.5?s/(2-u-h):s/(u+h);switch(u){case n:o=(t-i)/s+(t<i?6:0);break;case t:o=(i-n)/s+2;break;case i:o=(n-t)/s+4}o/=6}return{h:o,s:c,l:l}}function tt(n,t,i){function h(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}var e,o,s,u,f;return n=r(n,360),t=r(t,100),i=r(i,100),t==0?e=o=s=i:(u=i<.5?i*(1+t):i+t-i*t,f=2*i-u,e=h(f,u,n+1/3),o=h(f,u,n),s=h(f,u,n-1/3)),{r:e*255,g:o*255,b:s*255}}function p(n,t,i){n=r(n,255);t=r(t,255);i=r(i,255);var u=e(n,t,i),h=f(n,t,i),o,c,l=u,s=u-h;if(c=u==0?0:s/u,u==h)o=0;else{switch(u){case n:o=(t-i)/s+(t<i?6:0);break;case t:o=(i-n)/s+2;break;case i:o=(n-t)/s+4}o/=6}return{h:o,s:c,v:l}}function it(n,t,i){var l,a,v;n=r(n,360)*6;t=r(t,100);i=r(i,100);var h=o.floor(n),c=n-h,u=i*(1-t),f=i*(1-c*t),e=i*(1-(1-c)*t),s=h%6,l=[i,f,u,u,e,i][s],a=[e,i,i,f,u,u][s],v=[u,u,e,i,i,f][s];return{r:l*255,g:a*255,b:v*255}}function c(n,t,r,u){function e(n){return n.length==1?"0"+n:""+n}var f=[e(i(n).toString(16)),e(i(t).toString(16)),e(i(r).toString(16))];return!u&&f[0].charAt(0)==f[0].charAt(1)&&f[1].charAt(0)==f[1].charAt(1)&&f[2].charAt(0)==f[2].charAt(1)?f[0].charAt(0)+f[1].charAt(0)+f[2].charAt(0):f.join("")}function rt(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[n[t]]=t);return i}function r(n,t){ut(n)&&(n="100%");var i=ft(n);return(n=f(t,e(0,h(n))),i&&(n=n*(t/100)),o.abs(n-t)<1e-6)?1:n>=1?n%t/h(t):n}function a(n){return f(1,e(0,n))}function s(n){return parseInt(n,16)}function ut(n){return typeof n=="string"&&n.indexOf(".")!=-1&&h(n)===1}function ft(n){return typeof n=="string"&&n.indexOf("%")!=-1}function et(n){var i,t;if(n=n.replace(b,"").replace(k,"").toLowerCase(),i=!1,l[n])n=l[n],i=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0};return(t=u.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=u.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=u.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=u.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=u.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=u.hex6.exec(n))?{r:s(t[1]),g:s(t[2]),b:s(t[3]),format:i?"name":"hex"}:(t=u.hex3.exec(n))?{r:s(t[1]+""+t[1]),g:s(t[2]+""+t[2]),b:s(t[3]+""+t[3]),format:i?"name":"hex"}:!1}var b=/^[\s,#]+/,k=/\s+$/,d=0,o=Math,i=o.round,f=o.min,e=o.max,v=o.random,h=n.parseFloat,l,w,u;t.fromRatio=function(n){if(typeof n=="object")for(var i in n)n[i]===1&&(n[i]="1.0");return t(n)};t.equals=function(n,i){if(!n||!i)return!1;if(t.validateTransparentColor(n,i)){var r=t(n).toRgbString(),u=t(i).toRgbString();return r===u?!0:!1}return t(n).toHex()==t(i).toHex()};t.random=function(){return t.fromRatio({r:v(),g:v(),b:v()})};t.validateTransparentColor=function(n,t){return n==="transparent"||t==="transparent"||n.alpha===0||t.alpha===0||n==="rgba(0, 0, 0, 0)"||t==="rgba(0, 0, 0, 0)"?!0:!1};t.desaturate=function(n,i){var r=t(n).toHsl();return r.s-=(i||10)/100,r.s=a(r.s),t(r)};t.saturate=function(n,i){var r=t(n).toHsl();return r.s+=(i||10)/100,r.s=a(r.s),t(r)};t.greyscale=function(n){return t.desaturate(n,100)};t.lighten=function(n,i){var r=t(n).toHsl();return r.l+=(i||10)/100,r.l=a(r.l),t(r)};t.darken=function(n,i){var r=t(n).toHsl();return r.l-=(i||10)/100,r.l=a(r.l),t(r)};t.complement=function(n){var i=t(n).toHsl();return i.h=(i.h+.5)%1,t(i)};t.triad=function(n){var i=t(n).toHsl(),r=i.h*360;return[t(n),t({h:(r+120)%360,s:i.s,l:i.l}),t({h:(r+240)%360,s:i.s,l:i.l})]};t.tetrad=function(n){var i=t(n).toHsl(),r=i.h*360;return[t(n),t({h:(r+90)%360,s:i.s,l:i.l}),t({h:(r+180)%360,s:i.s,l:i.l}),t({h:(r+270)%360,s:i.s,l:i.l})]};t.splitcomplement=function(n){var i=t(n).toHsl(),r=i.h*360;return[t(n),t({h:(r+72)%360,s:i.s,l:i.l}),t({h:(r+216)%360,s:i.s,l:i.l})]};t.analogous=function(n,i,r){i=i||6;r=r||30;var u=t(n).toHsl(),f=360/r,e=[t(n)];for(u.h*=360,u.h=(u.h-(f*i>>1)+720)%360;--i;)u.h=(u.h+f)%360,e.push(t(u));return e};t.monochromatic=function(n,i){i=i||6;for(var r=t(n).toHsv(),e=r.h,o=r.s,u=r.v,f=[],s=1/i;i--;)f.push(t({h:e,s:o,v:u})),u=(u+s)%1;return f};t.readable=function(n,i){var r=t(n).toRgb(),u=t(i).toRgb();return(u.r-r.r)*(u.r-r.r)+(u.g-r.g)*(u.g-r.g)+(u.b-r.b)*(u.b-r.b)>10404};l=t.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};w=t.hexNames=rt(l);u=function(){var n="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",t="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+t),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+t),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+t),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();n.tinycolor=t}(this);
(function(n,t){var u,i,r;u=i=n.jQuery;r=i.ScrollTo=i.ScrollTo||{config:{duration:400,easing:"swing",callback:t,durationMode:"each",offsetTop:0,offsetLeft:0},configure:function(n){return i.extend(r.config,n||{}),this},scroll:function(n,t){var l,u,a,v,s,p,h,c,w,b,k,d,f,g,nt,e,o,y;return l=n.pop(),u=l.$container,a=u.get(0),v=l.$target,s=i("<span/>").css({position:"absolute",top:"0px",left:"0px"}),p=u.css("position"),u.css("position","relative"),s.appendTo(u),k=s.offset().top,d=v.offset().top,f=d-k-parseInt(t.offsetTop,10),g=s.offset().left,nt=v.offset().left,e=nt-g-parseInt(t.offsetLeft,10),h=a.scrollTop,c=a.scrollLeft,s.remove(),u.css("position",p),y=function(i){return n.length===0?typeof t.callback=="function"&&t.callback.apply(this,[i]):r.scroll(n,t),!0},t.onlyIfOutside&&(w=h+u.height(),b=c+u.width(),h<f&&f<w&&(f=h),c<e&&e<b&&(e=c)),o={},f!==h&&(o.scrollTop=f+"px"),e!==c&&(o.scrollLeft=e+"px"),o.scrollTop||o.scrollLeft?u.animate(o,t.duration,t.easing,y):y(),!0},fn:function(n){var e,o,t,u,f,s,h;if(e=[],f=i(this),f.length===0)return this;for(o=i.extend({},r.config,n),t=f.parent(),u=t.get(0);t.length===1&&u!==document.body&&u!==document;)s=t.css("overflow-y")!=="visible"&&u.scrollHeight!==u.clientHeight,h=t.css("overflow-x")!=="visible"&&u.scrollWidth!==u.clientWidth,(s||h)&&(e.push({$container:t,$target:f}),f=t),t=t.parent(),u=t.get(0);return e.push({$container:i(i.browser.msie||i.browser.mozilla?"html":"body"),$target:f}),o.durationMode==="all"&&(o.duration/=e.length),r.scroll(e,o),this}};i.fn.ScrollTo=i.ScrollTo.fn})(window);
(function(n){function t(t,i,r){var u;this.element=n(t);this.options=n.extend({pickerClass:"wpd",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayShort:2,monthShort:3,startDay:0,timePicker:!1,timePickerOnly:!1,yearPicker:!0,militaryTime:!1,yearsPerPage:20,format:"d-m-Y",allowEmpty:!1,inputOutputFormat:"U",animationDuration:400,useFadeInOut:!n.browser.msie,startView:"month",positionOffset:{x:0,y:0},minDate:null,maxDate:null,debug:!1,toggleElements:null,onShow:n.noop,onClose:n.noop,onSelect:n.noop},r);this.options.toggleElements!=null&&this.options.toggleElements.jquery&&(this.toggler=this.options.toggleElements.eq(i),document.keydown(n.proxy(function(n){n.which==9&&this.close(null,!0)},this)));this.formatMinMaxDates();n(document).mousedown(n.proxy(this.close,this));this.options.timePickerOnly&&(this.options.timePicker=!0,this.options.startView="time");(u=this.element.val())?u=this.format(new Date(this.unformat(u,this.options.inputOutputFormat)),this.options.format):this.options.allowEmpty?u="":(u=this.format(new Date,this.options.format),this.element.val(this.format(new Date,this.options.inputOutputFormat)));this.display=this.element.css("display");this.clone=this.element.css("display",this.options.debug?this.display:"none").data("will_pickdate",!0).clone(!0).data("will_pickdate",!0).removeAttr("name").attr("id",this.element.attr("id")+"_display").css("display",this.display).val(u);this.element.before(this.clone);this.toggler?(this.toggler.css("cursor","pointer").click(n.proxy(function(){this.onFocus(this.element,this.clone)},this)),this.clone.blur(n.proxy(function(){this.element.val(this.clone.val())},this))):this.clone.bind({keydown:n.proxy(function(t){this.options.allowEmpty&&(t.which==46||t.which==8)?(this.element.val(""),n(t.target).val(""),this.close(null,!0)):t.which==9||t.which==27?this.close(null,!0):t.preventDefault()},this),focus:n.proxy(function(){this.onFocus(this.element,this.clone)},this)})}n.fn.will_pickdate=function(i){return this.each(function(r){n.data(this,"will_pickdate")||new t(this,r,i)})};t.prototype={onFocus:function(n,t){var i;(i=n.val())?i=this.unformat(i,this.options.inputOutputFormat).valueOf():(i=new Date,this.options.maxDate&&i.valueOf()>this.options.maxDate.valueOf()&&(i=new Date(this.options.maxDate.valueOf())),this.options.minDate&&i.valueOf()<this.options.minDate.valueOf()&&(i=new Date(this.options.minDate.valueOf())));this.input=n;this.visual=t;this.show(i)},dateToObject:function(n){return{year:n.getFullYear(),month:n.getMonth(),day:n.getDate(),hours:n.getHours(),minutes:n.getMinutes(),seconds:n.getSeconds()}},dateFromObject:function(t){var r=new Date,i;return r.setDate(1),n.each(["year","month","day","hours","minutes","seconds"],n.proxy(function(n,u){if(i=t[u],i||i===0)switch(u){case"day":r.setDate(i);break;case"month":r.setMonth(i);break;case"year":r.setFullYear(i);break;case"hours":r.setHours(i);break;case"minutes":r.setMinutes(i);break;case"seconds":r.setSeconds(i)}},this)),r},pickerPosition:function(){var t={left:this.visual.offset().left+this.options.positionOffset.x,top:this.visual.offset().top+this.options.positionOffset.y},r=n(window).height(),u=n(window).scrollTop(),i=this.picker.outerHeight(),e=Math.abs(r-t.top+this.visual.outerHeight()),o=t.top+u,f=e>i,s=o>i;return s||f?f?t.top+=this.visual.outerHeight():t.top-=i:(t.top=r/2-i/2,r+u<i&&console.warn("will_pickdate: Not enough room to display date picker.")),t},show:function(t){this.formatMinMaxDates();this.working_date=t?new Date(t):new Date;this.today=new Date;this.choice=this.dateToObject(this.working_date);this.mode=this.options.startView=="time"&&!this.options.timePicker?"month":this.options.startView;this.render();this.picker.css(this.pickerPosition());n.isFunction(this.options.onShow)&&this.options.onShow()},render:function(n){var t,i;this.picker?(t=this.oldContents,this.oldContents=this.newContents,this.newContents=t,this.newContents.empty()):this.constructPicker();i=new Date(this.working_date.getTime());this.limit={right:!1,left:!1};switch(this.mode){case"decades":this.renderDecades();break;case"year":this.renderYear();break;case"time":this.renderTime();this.limit={right:!0,left:!0};break;default:this.renderMonth()}this.picker.find(".previous").toggleClass("disabled",this.limit.left);this.picker.find(".next").toggleClass("disabled",this.limit.right);this.picker.find(".title").css("cursor",this.allowZoomOut()?"pointer":"default");this.working_date=i;this.options.useFadeInOut&&this.picker.fadeIn(this.options.animationDuration);n&&this.fx(n)},fx:function(n){n=="right"?(this.oldContents.css("left",0).show(),this.newContents.css("left",this.bodyWidth).show(),this.slider.css("left",0).animate({left:-this.bodyWidth})):n=="left"?(this.oldContents.css("left",this.bodyWidth).show(),this.newContents.css("left",0).show(),this.slider.css("left",-this.bodyWidth).animate({left:0})):n=="fade"&&(this.slider.css("left",0),this.oldContents.css("left",0).fadeOut(this.options.animationDuration>>1),this.newContents.css("left",0).hide().fadeIn(this.options.animationDuration))},constructPicker:function(){n(document.body).append(this.picker=n('<div class="'+this.options.pickerClass+'" />'));this.options.useFadeInOut&&this.picker.hide();var t,r,i;this.picker.append(t=n('<div class="header"/>'));t.append(r=n('<div class="title"/>').click(n.proxy(this.zoomOut,this)));t.append(n('<div class="previous">&larr;<\/div>').click(n.proxy(this.previous,this)));t.append(n('<div class="next">&rarr;<\/div>').click(n.proxy(this.next,this)));t.append(n('<div class="closeButton">x<\/div>').click(n.proxy(this.close,this)));r.append(n('<span class="titleText"/>'));this.picker.append(i=n('<div class="body"/>'));this.bodyHeight=i.outerHeight();this.bodyWidth=i.outerWidth();i.append(this.slider=n('<div style="position:absolute;top:0;left:0;width:'+2*this.bodyWidth+"px;height:"+2*this.bodyHeight+'px" />'));this.slider.append(this.oldContents=n('<div style="position:absolute;top:0;left:'+this.bodyWidth+"px;width:"+this.bodyWidth+"px;height:"+this.bodyHeight+'px" />'));this.slider.append(this.newContents=n('<div style="position:absolute;top:0;left:0;width:'+this.bodyWidth+"px;height:"+this.bodyHeight+'px" />'))},renderDecades:function(){while(this.working_date.getFullYear()%this.options.yearsPerPage>0)this.working_date.setFullYear(this.working_date.getFullYear()-1);this.renderTitle(this.working_date.getFullYear()+"-"+(this.working_date.getFullYear()+this.options.yearsPerPage-1));var i,t,r,u=!1,f;for(this.newContents.append(f=n('<div class="years"/>')),this.options.minDate&&this.working_date.getFullYear()<=this.options.minDate.getFullYear()&&(this.limit.left=!0),i=0;i<this.options.yearsPerPage;i++)t=this.working_date.getFullYear(),f.append(r=n('<div class="year year'+i+(t==this.today.getFullYear()?" today":"")+(t==this.choice.year?" selected":"")+'">'+t+"<\/>")),this.limited("year")?(r.addClass("unavailable"),u?this.limit.right=!0:this.limit.left=!0):(u=!0,r.click({year:t},n.proxy(function(n){this.working_date.setFullYear(n.data.year);this.mode="year";this.render("fade")},this))),this.working_date.setFullYear(this.working_date.getFullYear()+1);(!u||this.options.maxDate&&this.working_date.getFullYear()>=this.options.maxDate.getFullYear())&&(this.limit.right=!0)},renderYear:function(){var f=this.today.getMonth(),e=this.working_date.getFullYear()==this.today.getFullYear(),o=this.working_date.getFullYear()==this.choice.year,i=!1,u,t,r;for(this.renderTitle(this.working_date.getFullYear()),this.working_date.setMonth(0),this.newContents.append(u=n('<div class="months"/>')),t=0;t<=11;t++)u.append(r=n('<div class="month month'+(t+1)+(t==f&&e?" today":"")+(t==this.choice.month&&o?" selected":"")+'">'+(this.options.monthShort?this.options.months[t].substring(0,this.options.monthShort):this.options.months[t])+"<\/div>")),this.limited("month")?(r.addClass("unavailable"),i?this.limit.right=!0:this.limit.left=!0):(i=!0,r.click({month:t},n.proxy(function(n){this.working_date.setDate(1);this.working_date.setMonth(n.data.month);this.mode="month";this.render("fade")},this))),this.working_date.setMonth(t);i||(this.limit.right=!0)},renderTime:function(){var t;this.newContents.append(t=n('<div class="time"/>'));this.options.timePickerOnly?this.renderTitle("Select a time"):this.renderTitle(this.format(this.working_date,"j M, Y"));t.append(n('<input type="text" class="hour"'+(this.options.militaryTime?' style="left:30px"':"")+' maxlength="2" value="'+this.leadZero(this.options.militaryTime?this.working_date.getHours():this.working_date.getHours()>12?this.working_date.getHours()-12:this.working_date.getHours())+'"/>').mousewheel(n.proxy(function(t,i,r,u){var o,f,e;t.preventDefault();t.stopPropagation();o=n(t.target);f=parseInt(o.val(),10);o.focus();this.options.militaryTime?u>0?f=f<23?f+1:0:u<0&&(f=f>0?f-1:23):(e=this.picker.find(".ampm"),u>0?f==11?(f=12,e.val(e.val()=="AM"?"PM":"AM")):f<12?f++:f=1:u<0&&(f==12?(f=11,e.val(e.val()=="AM"?"PM":"AM")):f>1?f--:f=12));o.val(this.leadZero(f))},this)));t.append(n('<input type="text" class="minutes"'+(this.options.militaryTime?' style="left:110px"':"")+' maxlength="2" value="'+this.leadZero(this.working_date.getMinutes())+'"/>').mousewheel(n.proxy(function(t,i,r,u){t.preventDefault();t.stopPropagation();var e=n(t.target),f=parseInt(e.val(),10);e.focus();u>0?f=f<59?f+1:0:u<0&&(f=f>0?f-1:59);e.val(this.leadZero(f))},this)));t.append(n('<div class="separator"'+(this.options.militaryTime?' style="left:91px"':"")+">:<\/div>"));this.options.militaryTime||t.append(n('<input type="text" class="ampm" maxlength="2" value="'+(this.working_date.getHours()>=12?"PM":"AM")+'"/>').mousewheel(n.proxy(function(t,i,r,u){t.preventDefault();t.stopPropagation();var f=n(t.target);f.focus();(u>0||u<0)&&f.val(f.val()=="AM"?"PM":"AM")})));t.append(n('<input type="submit" value="OK" class="ok"/>').click(n.proxy(function(t){t.stopPropagation();var i=parseInt(this.picker.find(".hour").val(),10);this.options.militaryTime||(i=i===12?0:i);this.select(n.extend(this.dateToObject(this.working_date),{hours:i+(!this.options.militaryTime&&this.picker.find(".ampm").val()=="PM"?12:0),minutes:parseInt(this.picker.find(".minutes").val(),10)}))},this)))},renderMonth:function(){var u=this.working_date.getMonth(),o=n('<div class="days"/>'),s=n('<div class="titles"/>'),f=!1,c=this.today.toDateString(),l=this.dateFromObject(this.choice).toDateString(),t,i,r,e,h;for(this.renderTitle(this.options.months[u]+" "+this.working_date.getFullYear()),this.working_date.setDate(1);this.working_date.getDay()!=this.options.startDay;)this.working_date.setDate(this.working_date.getDate()-1);for(this.newContents.append(o.append(s)),t=this.options.startDay;t<this.options.startDay+7;t++)s.append(n('<div class="title day day'+t%7+'">'+this.options.days[t%7].substring(0,this.options.dayShort)+"<\/div>"));for(i=0;i<42;i++)r=["day","day"+this.working_date.getDay()],this.working_date.toDateString()==c&&r.push("today"),this.working_date.toDateString()==l&&r.push("selected"),this.working_date.getMonth()!=u&&r.push("otherMonth"),i%7==0&&o.append(h=n('<div class="week week'+Math.floor(i/7)+'"/>')),h.append(e=n('<div class="'+r.join(" ")+'">'+this.working_date.getDate()+"<\/div>")),this.limited("date")?(e.addClass("unavailable"),f?this.limit.right=!0:this.working_date.getMonth()==u&&(this.limit.left=!0)):(f=!0,e.click({day:this.working_date.getDate(),month:this.working_date.getMonth(),year:this.working_date.getFullYear()},n.proxy(function(n){this.options.timePicker?(this.working_date.setDate(n.data.day),this.working_date.setMonth(n.data.month),this.mode="time",this.render("fade")):this.select(n.data)},this))),this.working_date.setDate(this.working_date.getDate()+1);f||(this.limit.right=!0)},renderTitle:function(n){this.allowZoomOut()?this.picker.find(".title").removeClass("disabled"):this.picker.find(".title").addClass("disabled");this.picker.find(".titleText").text(n)},limited:function(n){var t=!!this.options.minDate,i=!!this.options.maxDate,r;if(!(t||i))return!1;switch(n){case"year":return t&&this.working_date.getFullYear()<this.options.minDate.getFullYear()||i&&this.working_date.getFullYear()>this.options.maxDate.getFullYear();case"month":return r=parseInt(""+this.working_date.getFullYear()+this.leadZero(this.working_date.getMonth()),10),t&&r<parseInt(""+this.options.minDate.getFullYear()+this.leadZero(this.options.minDate.getMonth()),10)||i&&r>parseInt(""+this.options.maxDate.getFullYear()+this.leadZero(this.options.maxDate.getMonth()),10);case"date":return t&&this.working_date<this.options.minDate||i&&this.working_date>this.options.maxDate}},allowZoomOut:function(){return this.mode=="time"&&this.options.timePickerOnly?!1:this.mode=="decades"?!1:!(this.mode=="year"&&!this.options.yearPicker)},zoomOut:function(){if(this.allowZoomOut()){switch(this.mode){case"year":this.mode="decades";break;case"time":this.mode="month";break;default:this.mode="year"}this.render("fade")}},previous:function(){switch(this.mode){case"decades":this.working_date.setFullYear(this.working_date.getFullYear()-this.options.yearsPerPage);break;case"year":this.working_date.setFullYear(this.working_date.getFullYear()-1);break;case"month":this.working_date.setMonth(this.working_date.getMonth()-1)}this.mode!="time"&&this.render("left")},next:function(){switch(this.mode){case"decades":this.working_date.setFullYear(this.working_date.getFullYear()+this.options.yearsPerPage);break;case"year":this.working_date.setFullYear(this.working_date.getFullYear()+1);break;case"month":this.working_date.setMonth(this.working_date.getMonth()+1)}this.mode!="time"&&this.render("right")},close:function(t,i){this.picker&&!this.closing&&(i||t&&t.target!=this.picker&&this.picker.has(t.target).size()==0&&t.target!=this.visual)&&(this.element.blur(),this.options.useFadeInOut?(this.closing=!0,this.picker.fadeOut(this.options.animationDuration>>1,n.proxy(this.destroy,this))):this.destroy())},destroy:function(){this.picker.remove();this.picker=null;this.closing=!1;n.isFunction(this.options.onClose)&&this.options.onClose()},select:function(t){if(this.working_date=this.dateFromObject(n.extend(this.choice,t)),this.input.val(this.format(this.working_date,this.options.inputOutputFormat)).change(),this.visual.val(this.format(this.working_date,this.options.format)),n.isFunction(this.options.onSelect))this.options.onSelect(this.working_date);this.close(null,!0)},formatMinMaxDates:function(){this.options.minDate&&this.options.minDate.format&&(this.options.minDate=this.unformat(this.options.minDate.date,this.options.minDate.format));this.options.maxDate&&this.options.maxDate.format&&(this.options.maxDate=this.unformat(this.options.maxDate.date,this.options.maxDate.format),this.options.maxDate.setHours(23),this.options.maxDate.setMinutes(59),this.options.maxDate.setSeconds(59))},leadZero:function(n){return n<10?"0"+n:n},format:function(n,t){for(var i="",r=n.getHours(),f=n.getMonth(),u=0;u<t.length;u++)switch(t.charAt(u)){case"\\":u++;i+=t.charAt(u);break;case"y":i+=(100+n.getYear()+"").substring(1);break;case"Y":i+=n.getFullYear();break;case"m":i+=this.leadZero(f+1);break;case"n":i+=f+1;break;case"M":i+=this.options.months[f].substring(0,this.options.monthShort);break;case"F":i+=this.options.months[f];break;case"d":i+=this.leadZero(n.getDate());break;case"j":i+=n.getDate();break;case"D":i+=this.options.days[n.getDay()].substring(0,this.options.dayShort);break;case"l":i+=this.options.days[n.getDay()];break;case"G":i+=r;break;case"H":i+=this.leadZero(r);break;case"g":i+=r%12?r%12:12;break;case"h":i+=this.leadZero(r%12?r%12:12);break;case"a":i+=r>11?"pm":"am";break;case"A":i+=r>11?"PM":"AM";break;case"i":i+=this.leadZero(n.getMinutes());break;case"s":i+=this.leadZero(n.getSeconds());break;case"U":i+=Math.floor(n.valueOf()/1e3);break;default:i+=t.charAt(u)}return i},unformat:function(n,t){var u=new Date,e={},f,s,i,o;for(n=n.toString(),o=0;o<t.length;o++){f=t.charAt(o);switch(f){case"\\":r=null;o++;break;case"y":r="[0-9]{2}";break;case"Y":r="[0-9]{4}";break;case"m":r="0[1-9]|1[012]";break;case"n":r="[1-9]|1[012]";break;case"M":r="[A-Za-z]{"+this.options.monthShort+"}";break;case"F":r="[A-Za-z]+";break;case"d":r="0[1-9]|[12][0-9]|3[01]";break;case"j":r="[1-9]|[12][0-9]|3[01]";break;case"D":r="[A-Za-z]{"+this.options.dayShort+"}";break;case"l":r="[A-Za-z]+";break;case"G":case"H":case"g":case"h":r="[0-9]{1,2}";break;case"a":r="(am|pm)";break;case"A":r="(AM|PM)";break;case"i":case"s":r="[012345][0-9]";break;case"U":r="-?[0-9]+$";break;default:r=null}if(r)if(s=n.match("^"+r),s)e[f]=s[0],n=n.substring(e[f].length);else return this.options.debug&&alert("Fatal Error in will_pickdate\n\nUnexpected format at: '"+n+"' expected format character '"+f+"' (pattern '"+r+"')"),u;else n=n.substring(1)}for(f in e){i=e[f];switch(f){case"y":u.setFullYear(i<30?2e3+parseInt(i,10):1900+parseInt(i,10));break;case"Y":u.setFullYear(i);break;case"m":case"n":u.setMonth(i-1);break;case"M":i=this.options.months.filter(function(){return this.substring(0,this.options.monthShort)==i})[0];case"F":u.setMonth(options.months.indexOf(i));break;case"d":case"j":u.setDate(i);break;case"G":case"H":u.setHours(i);break;case"g":case"h":e.a=="pm"||e.A=="PM"?u.setHours(i==12?0:parseInt(i,10)+12):u.setHours(i);break;case"i":u.setMinutes(i);break;case"s":u.setSeconds(i);break;case"U":u=new Date(parseInt(i,10)*1e3)}}return u}}})(jQuery);
(function(n){var b=function(t,i,u){var f,e=t.bind&&t.unbind?t:n(r(t)?[t]:t);return i.indexOf(">")===0&&(i=i.substr(1),f=function(n){n.target===t&&u.apply(this,arguments)}),e.bind(i,f||u),function(){e.unbind(i,f||u);t=i=u=f=null}},c=n.makeArray,k=n.isArray,r=n.isFunction,e=n.extend,l=n.String,a=n.each,u="prototype",t="constructor",d=Array[u].slice,g=function(t,i,u,f){var e=t.delegate&&t.undelegate?t:n(r(t)?[t]:t);return e.delegate(i,u,f),function(){e.undelegate(i,u,f);e=t=u=f=i=null}},v=function(n,t,i,r){return r?g(n,r,t,i):b(n,t,i)},o=function(t,i){var r=typeof i=="string"?t[i]:i;return function(){return t.called=i,r.apply(t,[this.nodeName?n(this):this].concat(d.call(arguments,0)))}},nt=/\./g,tt=/_?controllers?/ig,y=function(n){return l.underscore(n.replace("jQuery.","").replace(nt,"_").replace(tt,""))},it=/[^\w]/,p=/\{([^\}]+)\}/g,rt=/^(?:(.*?)\s)?([\w\.\:>]+)$/,h=function(t,i){return n.data(t,"controllers",i)},f,s,i,w;n.Class("jQuery.Controller",{setup:function(){if(this._super.apply(this,arguments),this.shortName&&this.fullName!="jQuery.Controller"){this._fullName=y(this.fullName);this._shortName=y(this.shortName);var i=this,f=this.pluginName||this._fullName,t;n.fn[f]||(n.fn[f]=function(n){var t=c(arguments),e=typeof n=="string"&&r(i[u][n]),o=t[0];return this.each(function(){var r=h(this),n=r&&r[f];n?e?n[o].apply(n,t.slice(1)):n.update.apply(n,t):i.newInstance.apply(i,[this].concat(t))})});this.actions={};for(t in this[u])t!="constructor"&&r(this[u][t])&&this._isAction(t)&&(this.actions[t]=this._action(t))}},hookup:function(n){return new this(n)},_isAction:function(t){return it.test(t)?!0:n.inArray(t,this.listensTo)>-1||n.event.special[t]||f[t]},_action:function(n,t){if(p.lastIndex=0,!t&&p.test(n))return null;var i=t?l.sub(n,[t,window]):n,r=k(i),u=(r?i[1]:i).match(rt),e=u[2],o=f[e]||s;return{processor:o,parts:u,delegate:r?i[0]:undefined}},processors:{},listensTo:[],defaults:{}},{setup:function(i,r){var u=this[t],f;return i=i.jquery?i[0]:i,f=u.pluginName||u._fullName,this.element=n(i).addClass(f),(h(i)||h(i,{}))[f]=this,this.options=e(e(!0,{},u.defaults),r),this.called="init",this.bind(),this.element},bind:function(i,r,u){var s;if(i===undefined){this._bindings=[];var h=this[t],f=this._bindings,e=h.actions,c=this.element;for(funcName in e)e.hasOwnProperty(funcName)&&(ready=e[funcName]||h._action(funcName,this.options),f.push(ready.processor(ready.delegate||c,ready.parts[2],ready.parts[1],funcName,this)));return s=o(this,"destroy"),c.bind("destroyed",s),f.push(function(t){n(t).unbind("destroyed",s)}),f.length}return typeof i=="string"&&(u=r,r=i,i=this.element),this._binder(i,r,u)},_binder:function(n,t,i,r){return typeof i=="string"&&(i=o(this,i)),this._bindings.push(v(n,t,i,r)),this._bindings.length},_unbind:function(){var n=this.element[0];a(this._bindings,function(t,i){i(n)});this._bindings=[]},delegate:function(n,t,i,r){return typeof n=="string"&&(r=i,i=t,t=n,n=this.element),this._binder(n,i,r,t)},update:function(n){e(this.options,n);this._unbind();this.bind()},destroy:function(){if(this._destroyed)throw this[t].shortName+" controller already deleted";var r=this,i=this[t].pluginName||this[t]._fullName;this._destroyed=!0;this.element.removeClass(i);this._unbind();delete this._actions;delete this.element.data("controllers")[i];n(this).triggerHandler("destroyed");this.element=null},find:function(n){return this.element.find(n)},_set_called:!0});f=n.Controller.processors;s=function(n,t,i,r,u){return v(n,t,o(u,r),i)};a("change click contextmenu dblclick keydown keyup keypress mousedown mousemove mouseout mouseover mouseup reset resize scroll select submit focusin focusout mouseenter mouseleave".split(" "),function(n,t){f[t]=s});w=function(n,r){for(i=0;i<r.length;i++)if(typeof r[i]=="string"?n[t]._shortName==r[i]:n instanceof r[i])return!0;return!1};n.fn.extend({controllers:function(){var u=c(arguments),f=[],t,i,r;return this.each(function(){t=n.data(this,"controllers");for(r in t)t.hasOwnProperty(r)&&(i=t[r],(!u.length||w(i,u))&&f.push(i))}),f},controller:function(){return this.controllers.apply(this,arguments)[0]}})})(jQuery);
Array.prototype.move=function(n,t){var i,r;if(n=parseInt(n,10),t=parseInt(t,10),n!==t&&0<=n&&n<=this.length&&0<=t&&t<=this.length){if(r=this[n],n<t)for(i=n;i<t;i++)this[i]=this[i+1];else for(i=n;i>t;i--)this[i]=this[i-1];this[t]=r}};$.Class.extend("bizagi.editor.utilities",{resolveResource:function(n){var t=bizagi.localization.getResource(n);return t===n&&(t=undefined),t},buildComplexReference:function(n,t){var i={},r={};return typeof n=="string"?(r.ref=n,i.baref=r,t&&(i.displayName=t),i):n},resolveComplexReference:function(n){return bizagi.editor.utilities.isObject(n)?n.baref.ref:n},buildComplexXpath:function(n,t,i,r){var f={},u={};return typeof n=="object"&&n.xpath&&n.xpath.baxpath?n:typeof n=="string"&&n.length>0?(u.xpath=n,bizagi.editor.utilities.isGuidEmpty(t)||(i==="true"?u.scopedefinition=t:u.contextentity=t),f.baxpath=u,r=r!==undefined&&r!="00000000-0000-0000-0000-000000000000"?r:undefined,{xpath:f,relatedentity:bizagi.editor.utilities.buildComplexReference(r)}):void 0},resolveComplexXpath:function(n){return bizagi.editor.utilities.isObject(n)?n.xpath.baxpath.xpath:n},resolveContextEntityFromXpath:function(n){if(bizagi.editor.utilities.isObject(n))return n.xpath.baxpath.contextentity},resolveScopeContextFromXpath:function(n){if(bizagi.editor.utilities.isObject(n))return n.xpath.baxpath.scopedefinition},resolveRelatedEntityFromXpath:function(n){return bizagi.editor.utilities.isObject(n)&&n.relatedentity?n.relatedentity.baref.ref:null},getXpathObject:function(n){if(!n)return n;if(bizagi.editor.utilities.isObject(n))return n.xpath;if(typeof n=="string"&&n.indexOf("<design")>-1)return null;throw"xpath parameter must be a complex xpath object";},buildComplexFilter:function(n,t){var i={filter:n};return t.isScopeAttribute==="true"?(i.scopedefinition=t.contextScope,i.contextentity=t.guidRelatedEntity):i.contextentity=t.guidRelatedEntity,i.globalcontextentity=t.contextScope,{bafilter:i}},resolvefilterExpression:function(n){if(bizagi.editor.utilities.isObject(n)){if(n.rule&&n.rule.displayName)return n.rule.displayName;if(n.rule)return n.rule.baref.ref;if(n.bafilter)return n.bafilter.filter}return n},resolveProperty:function(n,t){for(var u=t.split("."),i=n,r=0;r<u.length;r++)if(i=i[u[r]],i===undefined)return undefined;return i},assignProperty:function(n,t,i,r){var e=t.split("."),u=n,f=e[0],o;if(!r||(u[f]=undefined,i!==undefined)){if(e.length>1)for(o=0;o<e.length-1;o++)bizagi.util.isEmpty(u[f])&&(u[f]={}),u=u[f],f=e[o+1];u[f]=i}},objectEquals:function(n,t){var r=this,i;if(typeof n!=typeof t)return!1;if(typeof n=="function")return n.toString()===t.toString();if(n instanceof Object&&t instanceof Object){if(bizagi.editor.utilities.countProps(n)!==bizagi.editor.utilities.countProps(t))return!1;i=!0;for(k in n)if(i=bizagi.editor.utilities.objectEquals(n[k],t[k]),!i)return!1;return!0}return n===t},countProps:function(n){var t=0;for(k in n)n.hasOwnProperty(k)&&t++;return t},buildComplexLocalizable:function(n,t,i){var u={},r={};return typeof n=="string"?(r.languages={},r["default"]=n,r.uri=t+":"+i,u.i18n=r,u):n},resolveComplexLocalizable:function(n){return typeof n=="object"?n.i18n["default"]:n},resolveInternalResource:function(n){if(!n)return"";if(typeof n=="string")return n;var t=bizagi.language.split("-").shift(),i=function(n){var r=!1,i,u;if($.isArray(n)&&n.length>0&&t.length>0)for(i=0,u=n.length;i<u;i+=1)if(n[i][t]){r=n[i][t];break}return r};return i(n.languages)||n["default"]},resolvei18n:function(n){var t=bizagi.editorLanguage.key,i;return typeof n=="string"?n:t&&t!="default"&&(i=n.i18n.languages&&n.i18n.languages[t],i)?i:n.i18n["default"]},isObject:function(n){return n!=null&&typeof n=="object"},isBoolean:function(n){return n===undefined||n===null?!1:n===!0||n.toString().toLowerCase()==="true"?!0:n===!1||n.toString().toLowerCase()==="false"?!0:!1},isGuidEmpty:function(n){return n?n==="00000000-0000-0000-0000-000000000000"?!0:!1:!0},getGuidEmpty:function(){return"00000000-0000-0000-0000-000000000000"}},{});
$.Class.extend("bizagi.editor.observableClass",{},{init:function(){this.observableElement=$({})},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)}});$.Controller.extend("bizagi.editor.observableController",{},{init:function(){this.observableElement=$({})},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)}});
$.Controller("bizagi.editor.component.controller",{init:function(){this.observableElement=$({});this.tmpl={}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){this.observableElement.triggerHandler.apply(this.observableElement,arguments)},loadTemplate:function(n,t){var i=this,r=new $.Deferred;if(i.tmpl[n])r.resolve();else return bizagi.templateService.getTemplate(t).done(function(t){i.tmpl[n]=t});return r.promise()},loadTemplates:function(n){var r=this,t=new $.Deferred,i=[];return $.each(n,function(n,t){var u=r.loadTemplate(n,t);i.push(u)}),$.when.apply($,i).done(function(){t.resolve()}),t.promise()},getTemplate:function(n){return this.tmpl[n]?this.tmpl[n]:null}});
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.elementValidations={validRequiredProperties:function(){var n=this,t=!0;return(n.formValidations=[],n.messageValidation="",!n.isVisible())?t:(n.requiredProperties&&$.each(n.requiredProperties,function(i){if(n.requiredProperties[i]&&!n.resolveProperty(i)){var r=bizagi.localization.getResource("formmodeler-editor-contextmenu-caption-property-required").replace("{0}",n.propertyModel.getCaption(i));n.messageValidation+=r+"<\/br>";n.formValidations.push({name:i,message:[r]});t=!1}}),t)},validRequiredDependentProperties:function(){var n=this,t=!0;return(n.formValidations=n.formValidations||[],n.messageValidation=n.messageValidation||"",!n.isVisible())?t:(n.requiredDependentProperties&&$.each(n.requiredDependentProperties,function(i,r){if(n.matchValue(r)&&(n.resolveProperty(i)===undefined||n.resolveProperty(i)===null)){var u=bizagi.localization.getResource("formmodeler-editor-contextmenu-caption-property-required").replace("{0}",n.propertyModel.getCaption(i));n.messageValidation+=u+"<\/br>";n.formValidations.push({name:i,message:[u]});t=!1}}),t)},validSameXpath:function(n){var i=this,t=bizagi.localization.getResource("bizagi-editor-form-validation-samexpath");t=typeof t=="string"?t.replace("{0}",n):"";i.messageValidation=i.messageValidation||"";i.messageValidation+=t+"<\/br>"},validAttributesAdministrables:function(n){var t=this,i=!0,r;if(t.isEditable()&&t.isParametricAttribute(n)){if(t.type=="searchlist")return!0;r=t.triggerGlobalHandler("getContextEntityType")=="parameter"?bizagi.localization.getResource("bizagi-editor-form-validation-parameter-attribute-parameter-entity"):bizagi.localization.getResource("bizagi-editor-form-validation-parameter-attribute-entity");t.messageValidation=t.messageValidation||"";t.messageValidation+=r+"<\/br>";i=!1}return i},validLayoutPlaceholder:function(n){var t=this,i=!0;return t.isVisible()?(t.type=="layoutPlaceholder"&&$.inArray(t.guid,n)==-1&&(t.messageValidation=t.messageValidation||"",t.messageValidation+=bizagi.localization.getResource("bizagi-editor-form-validation-layoutplaceholder")+"<\/br>",i=!1),i):i},validAttributesNoEditables:function(){return!0},matchValue:function(n){var i=this,r=n.property,t=i.resolveProperty(r);return t&&n.value=="anyValue"?!0:t!==undefined&&t!==null?t.toString()==n.value:!1}};
bizagi.editor.observableClass.extend("bizagi.editor.base.element",{exclusiveProperty:/[^.]*/},$.extend({},bizagi.editor.base.elementValidations,{init:function(n,t,i){var r=this;this.elementFactory=t;this._super();this.properties=n&&n.properties?JSON.parse(JSON.encode(n.properties)):{};n&&n.guid?i?(this.oldGuid=n.guid,this.guid=Math.guid()):this.guid=n.guid:this.guid=Math.guid();this.updateLocalizableProperties();r.propertyModel={};r.decoratorModel={};r.contextMenuModel={};r.convertToModel=[];r["widget-guid"]=null;r.messageValidation="";r.defaultDisplayName={}},ready:function(){return!0},setParent:function(n){this.parent=n;this.subscribe("refresh",function(){n.publish("refresh")})},getParent:function(){return this.parent},getProperties:function(){return this.properties},getRenderingModel:function(){var t=this,n=$.Deferred();return $.when(t.getRenderingProperties()).done(function(t){t=t||{};n.resolve({properties:t})}),n.promise()},getRibbonProperties:function(){return[]},getRenderingProperties:function(){var t=this,n={};return n.guid=t.guid,n.id=t.guid,n.messageValidation=t.messageValidation,n},getPropertiesModel:function(){var n=this;return n.propertyModel?n.propertyModel.process(n):{}},getIndexedProperties:function(){var n=this;return n.propertyModel?n.propertyModel.indexedProperties||{}:{}},getPropertiesExternal:function(){var n=this;return n.propertyModel&&n.propertyModel.externalProperties?n.propertyModel.externalProperties:{}},getPersistenceModel:function(){var n=this,t={type:n.type,guid:n.guid,properties:n.filterDefaultValues(n.properties)};return n["widget-guid"]&&(t["widget-guid"]=bizagi.editor.utilities.buildComplexReference(n["widget-guid"])),t},getGridColumnModel:function(){var n=this,i=$.Deferred(),t=n.getPersistenceModel();return $.when(n.resolveDisplayNameProperty()).done(function(r){t.properties.displayName=n.resolveProperty("displayName")?n.resolveProperty("displayName"):r;i.resolve(t)}),i.promise()},getContextMenuModel:function(){var t=this,n=t.contextMenuModel,r=n.getProperties();for(var i in r)n.assignProperty(i,t.resolveProperty(i));return n},getConvertToModel:function(){var n=this;return bizagi.clone(n.convertToModel)},resolveType:function(n){var t=this;return t.Class.renderTypeMapping[n]?t.Class.renderTypeMapping[n]:n},getDecoratorModel:function(){var n=this;return n.decoratorModel},getExclusiveProperty:function(n){if(n)return this.Class.exclusiveProperty.exec(n)[0]},filterDefaultValues:function(){var n=this,t=bizagi.clone(n.properties);return n.defaultValues&&$.each(n.defaultValues,function(i,r){var u=n.resolveProperty(i);bizagi.editor.utilities.isBoolean(u)&&(u=bizagi.util.parseBoolean(u),r=bizagi.util.parseBoolean(r));bizagi.editor.utilities.objectEquals(u,r)&&bizagi.editor.utilities.assignProperty(t,i,undefined)}),t},getControlType:function(){},getGuid:function(){var n=this;return n.guid},getXpath:function(){var t=this,n=t.properties;return!n||!n.xpath?null:bizagi.editor.utilities.resolveComplexXpath(n.xpath)},getFilter:function(){var n=this;return bizagi.editor.utilities.resolvefilterExpression(n.resolveProperty("data.filter"))||""},getDisplayName:function(){var n=this,t=n.properties;return bizagi.editor.utilities.resolvei18n(t.displayName)},assignDefaultProperty:function(n,t){var i=this;(i.resolveProperty(n)===undefined||i.resolveProperty(n)===null)&&i.assignProperty(n,t)},assignProperty:function(n,t,i){var r=this;bizagi.editor.utilities.assignProperty(r.properties,n,t,i);n==="xpath"&&(t||r.removeDefaultDisplayName(),r.xpathProperties.length>0&&r.cleanXpathProperties())},propertiesOverrides:function(n){var t=this;$.extend(t.properties,n)},requiredPropertiesOverrides:function(n){var i=this,u=i.getIndexedProperties(),t,r;$.extend(i.requiredProperties,n);for(t in n)n.hasOwnProperty(t)&&(r=u[t]||{},r.required=n[t])},setProperty:function(n,t){this.assignProperty(n,t)},resolveProperty:function(n){return bizagi.editor.utilities.resolveProperty(this.properties,n)},resolveDisplayNameProperty:function(){var n=this,t=new $.Deferred;return n.asyncProperties=n.asyncProperties||[],n.resolveProperty("displayName")?n.resolveI18nProperty("displayName"):n.defaultDisplayName&&n.defaultDisplayName[bizagi.editorLanguage.key]?n.defaultDisplayName[bizagi.editorLanguage.key]:(n.asyncProperties.push($.when(n.triggerGlobalHandler("getDefaultDisplayName",{element:n})).pipe(function(i){if(!i){t.resolve("");return}typeof i=="string"?(n.defaultDisplayName=n.defaultDisplayName||{},n.defaultDisplayName["default"]=i,t.resolve(i)):(n.defaultDisplayName=n.defaultDisplayName||{},n.defaultDisplayName[bizagi.editorLanguage.key]=i.displayName,n.defaultDisplayName["default"]=i.defaultValue,t.resolve(i.displayName))})),t.promise())},getProperty:function(n){return this.resolveProperty(n)},resolveFixedValueProperty:function(n){var i=this,t=i.resolveProperty(n);return t!==undefined&&t.fixedvalue!==undefined?t.fixedvalue:!0},resolveI18nProperty:function(n){var r=this,t=r.resolveProperty(n),i="";return t&&t.i18n&&(i=bizagi.editorLanguage.key==="default"?t.i18n["default"]:t.i18n.languages?t.i18n.languages[bizagi.editorLanguage.key]||t.i18n["default"]:t.i18n["default"]),i},resolveIsRightToLeftProperty:function(){var n=this;return n.isDefaultValueinHierarchicalChain(n,"orientation")||(bizagi.editorLanguage&&bizagi.util.parseBoolean(bizagi.editorLanguage.IsRightToLeft)?"rtl":"ltr")},isDefaultValueinHierarchicalChain:function(n,t){var i=this;return!n||typeof n.getDefaultValueProperty!="function"?!1:n.getDefaultValueProperty(t)===n.getProperty(t)?i.isDefaultValueinHierarchicalChain(n.getParent(),t):n.getProperty(t)},getDefaultValueProperty:function(n){var t=this,r=function(t){return n==="maxlength"?t.getMaxLength():null},i=t.properties.xpath;return i?(i=bizagi.editor.utilities.resolveComplexXpath(i),t.defaultValues[n]||t.triggerGlobalHandler("getNodeInfo",{property:n,xpath:i,callback:r})):t.defaultValues[n]},getDefaultLocalizableProperty:function(n){return n==="displayName"?this.defaultDisplayName["default"]:""},hasDesignValue:function(n){return this.designValueProperties[n]||!1},isVisualProperty:function(n){return this.propertyModel.indexedProperties?this.propertyModel.indexedProperties[n]||!1:!1},isLocalizableProperty:function(n){var i=this,t=i.propertyModel.indexedProperties[n];return!t||!t["bas-type"]?!1:t["bas-type"]==="localizable-string"||t["bas-type"]==="localizablestring"},isInternal:function(){return!1},isRequiredProperty:function(n){var u=this,t,r,i;if(!u.requiredProperties)return!1;for(t=n.split("."),r=t[0],i=0;i<t.length;i++){if(u.requiredProperties[r])return!0;t[i+1]&&(r=r+"."+t[i+1])}return!1},isDependentProperty:function(n){var t=this,i;if(!t.requiredDependentProperties)return!1;for(i in t.requiredDependentProperties)if(t.requiredDependentProperties[i].property===n||i===n)return!0;return!1},isEditable:function(){function t(){return n.resolveProperty("editable.fixedvalue")===!1||n.resolveProperty("editable.fixedvalue")==="false"?!1:!0}var n=this;return n.parent!=undefined?n.parent.isEditable()&&t():t()},isParametricAttribute:function(n){var i=this,t;return n=n||"",n=n+bizagi.editor.utilities.resolveComplexXpath(i.properties.xpath),t=i.triggerGlobalHandler("getNodeInfo",{xpath:n}),t?t.parentIsParametricEntity()&&$.inArray(t.renderType,["cascadingcombo","combo","suggest"])==-1:!1},isText:function(){return this.type==="text"||this.type==="columntext"||this.type==="offlinetext"},isHidden:function(){return this.type==="hidden"||this.type==="columnhidden"||this.type==="offlinehidden"},isGrid:function(){return this.type==="grid"},restoreDefaultDisplayName:function(){var n=this;n.properties.displayName&&typeof n.properties.displayName=="string"&&n.assignProperty("displayName",undefined)},removeDefaultDisplayName:function(){this.defaultDisplayName={}},getFormValidations:function(){return this.formValidations},getFormParent:function(){return this.parent.getFormParent()},getValidations:function(){return this.validations},removeValidations:function(){var n=this;n.messageValidation="";n.propertyModel.model.validations=undefined},triggerGlobalHandler:function(n,t){var i=this;return i.parent?i.parent.triggerGlobalHandler(n,t):null},cleanXpathProperties:function(){var n=this,t=n.defaultValues||{};$.each(n.xpathProperties,function(i,r){bizagi.editor.utilities.assignProperty(n.properties,r,t[r])})},isContainedInNestedForm:function(){var n=this;return n.parent?n.parent.type==="nestedform"?n.parent.getXpath():n.parent.isContainedInNestedForm():!1},getXpathNestedForm:function(){var n=this;return n.parent?n.parent.type==="nestedform"?n.parent.properties.xpath:n.parent.getXpathNestedForm():!1},updateLocalizableProperties:function(){for(var n,f,t=this,u=t.getLocalizableProperties(),i=t.properties,r=0,e=u.length;r<e;r++)n=u[r],i[n]&&typeof i[n]=="object"&&(f=i[n].i18n,f.uri=t.guid+":"+n)},isVisible:function(){return!0}}));
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.renderBehaviour={findPositionOfElementInFormById:function(n,t){var r=this,i={position:t,found:!1};return r.guid===n&&(i={position:t,found:!0}),i}};
bizagi.editor.base.element.extend("bizagi.editor.base.render",{},$.extend({},bizagi.editor.base.renderBehaviour,{init:function(n,t,i){var r=this;r.elementType="render";r._super(n,t,i)},getRenderingModel:function(n){var t=this;return n=n||"render",$.when(t._super()).pipe(function(t){var i={};return i[n]=t,i})},getControlType:function(){return this.controlType||this.properties.renderType},getControlAttributes:function(){var n=this,t=$.Deferred();return $.when(n.triggerGlobalHandler("findXpathAttributes",{element:n,xpath:n.properties.xpath})).done(function(){t.resolve()}),t.promise()},getInherentValidations:function(n){var i=this,t=i.properties;return n=n||[],t.required&&t.required.fixedvalue==!0&&n.push({guid:Math.guid(),conditions:{operator:"and",expressions:[{simple:{operator:"is-empty",xpath:i.getXpath(t.xpath)}}]},validationCommand:{message:"The field "+i.resolveDisplayNameProperty()+" cannot be empty"},inherent:!0}),t.minValue&&n.push({guid:Math.guid(),conditions:{operator:"and",expressions:[{simple:{operator:"is-less-than",xpath:i.getXpath(t.xpath),argument:t.minValue,argumentType:"const"}}]},validationCommand:{message:"The field "+i.resolveDisplayNameProperty()+" cannot be less than "+t.minValue},inherent:!0}),t.maxValue&&n.push({guid:Math.guid(),conditions:{operator:"and",expressions:[{simple:{operator:"is-greater-than",xpath:i.getXpath(t.xpath),argument:t.maxValue,argumentType:"const"}}]},validationCommand:{message:"The field "+i.resolveDisplayNameProperty()+" cannot be less than "+t.maxValue},inherent:!0}),n}}));bizagi.editor.base.render.extend("bizagi.editor.render.generic",{},{init:function(n,t){var i=this;i.type="label";this._super(n,t)},getRenderingProperties:function(){var i=this,n=i.properties,t=this._super();return t.type="label",n.displayName&&(t.displayName=typeof n.displayName=="string"?n.displayName:n.displayName.i18n["default"]),t}});bizagi.editor.base.render.extend("bizagi.editor.column.generic",{},{init:function(n,t){var i=this;i.type="columnReadonly";this._super(n,t)},getRenderingProperties:function(){var i=this,n=i.properties,t=this._super();return t.type="columnReadonly",n.displayName&&(t.displayName=typeof n.displayName=="string"?n.displayName:n.displayName.i18n["default"]),t}});bizagi.editor.base.render.extend("bizagi.editor.base.actionlauncher",{},{getPersistenceModel:function(){var n=this,t=n._super(),i=t.properties;return i.customxpath="@KeyValue.Action_"+n.guid,t}});bizagi.editor.base.render.extend("bizagi.editor.base.polymorphiclauncher",{},{getPersistenceModel:function(){var n=this,t=n._super(),i=t.properties;return i.customxpath="@KeyValue.Constructor_"+n.guid,t}});bizagi.editor.base.render.extend("bizagi.editor.base.entitytemplate",{},{getPersistenceModel:function(){var n=this,t=n._super(),i=t.properties;return i.customxpath="@KeyValue.Action_"+n.guid,t}});
bizagi.editor.base.element.extend("bizagi.editor.base.renderLayout",{},{init:function(n,t,i){var r=this;r.elementType="render";r._super(n,t,i)},getRenderingModel:function(n){var t=this,n=n||"render";return $.when(t._super()).pipe(function(i){i.properties.value=t.getValue();var r={};return r[n]=i,r})},getPersistenceModel:function(){var n=this;return{type:n.type,guid:n.guid,properties:n.filterDefaultValues(n.properties)}},getValue:function(){var i=this,n=i.properties,r=n.link||n.xpath,u=n.displayName,t;return r?i.getDesignValue(r):u!=undefined?bizagi.editor.utilities.resolvei18n(u):n.type?(t=n.type.replace(/[:\s]*/g,"").toLowerCase(),(t=="label"||t=="value")&&(t="drophere"),bizagi.localization.getResource("bizagi-editor-templates-labels-controls-"+t)):void 0},hasValue:function(){var t=this,n=t.properties,i=n.link||n.xpath;return i?!0:n.displayName!=undefined?!0:!1},getControlType:function(){return this.controlType},getDesignValue:function(n){var i=this,r=i.type,t=n.xpath.baxpath.xpath.split(".");return t.length>1?t[t.length-1]:bizagi.editor.utilities.resolveComplexXpath(n)},isVisible:function(){var n=this;return!n.resolveProperty("hide")}});
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.containerValidations={validRequiredProperties:function(){var t=this,n=t._super();return $.each(t.elements,function(t,i){n=n&i.validRequiredProperties()}),n},validRequiredDependentProperties:function(){var t=this,n=t._super();return $.each(t.elements,function(t,i){n=n&i.validRequiredDependentProperties()}),n},validElementsInContainer:function(){var n=this,t=!0,i;return n.isEditable()&&(n.isContainerToValidate()&&(t=n.elements.length>0,t||(i=n.type==="grid"?bizagi.localization.getResource("bizagi-editor-form-validation-elementsingrid"):bizagi.localization.getResource("bizagi-editor-form-validation-elementsincontainer"),typeof i!="string"&&(i=""),n.messageValidation=n.messageValidation||"",n.messageValidation+=i+"<\/br>")),$.each(n.elements,function(n,i){typeof i.validElementsInContainer=="function"&&(t=t&i.validElementsInContainer())})),t},validAttributesAdministrables:function(){var t=this,i=!0,n,r;if(t.isEditable())for(n=0,r=t.elements.length;n<r;n++)i=i&t.elements[n].validAttributesAdministrables();return i},isContainerToValidate:function(){var t=this,n=t.type;return n==="group"||n==="tabitem"||n==="grid"||n==="contentpanel"},validLayoutPlaceholder:function(n){for(var r=this,t=!0,i=0,u=r.elements.length;i<u;i++)t=t&r.elements[i].validLayoutPlaceholder(n);return t},validAttributesNoEditables:function(){var t=this,n=$.Deferred();return this.elements.length>0?$.when.apply($,$.map(this.elements,function(n){return n.validAttributesNoEditables()})).done(function(){var t=$.makeArray(arguments),i=t.filter(function(n){return!n}).length>0;n.resolve(!i)}):n.resolve(!0),n.promise()},removeValidations:function(){var n=this;n._super();$.each(n.elements,function(n,t){t.removeValidations()})}};
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.containerBehaviour={addElement:function(n,t){var r=this,i=t?r.getElement(t):this;return n.position=i.elements.length,i.elements.push(n),n.setParent(i),n},removeLastElement:function(n){var t=this,i=n?t.getElement(n):this;return i.elements.pop()},getElement:function(n){var i=this,r,f,t,u;if(i.guid==n)return i.position=0,i;for(r=0,f=i.elements.length;r<f;r+=1){if(t=i.elements[r],t.guid==n)return t.position=i.elements.indexOf(t),t;if(t.elements&&(u=t.getElement(n),u))return u}return null},getElementByOldGuid:function(n){var i=this,r,f,t,u;if(i.oldGuid==n)return i.position=0,i;for(r=0,f=i.elements.length;r<f;r+=1){if(t=i.elements[r],t.oldGuid==n)return t.position=i.elements.indexOf(t),t;if(t.elements&&(u=t.getElementByOldGuid(n),u))return u}return null},moveElement:function(n,t,i){var u=this,r=u.getElement(i);return r==null?null:(r.elements.move(n,t),r)},removeElement:function(n,t){var r=this,i=t?r.getElement(t):this;return i==null?null:(i.elements.splice(n,1),i)},removeElementById:function(n){var r=this,t=r.getElement(n),i;return t==null?null:(i=r.getElement(t.parent.guid),i==null)?null:(i.elements.splice(t.position,1),t)},findElementByPosition:function(n,t){var r=this,i=r.getElement(t);return i==null?null:i.elements[n]},insertElement:function(n,t,i){var u=this,r=u.getElement(t);return r==null?null:(r.elements.splice(n,0,i),i.setParent(r),i)},changeProperty:function(n,t,i){var u=this,r;return(r=u.getElement(n),r==null)?null:(r.assignProperty(t,i),r)},updateElementByPosition:function(n,t,i){var f=this,r=f.getElement(t),u;return r==null?null:(u=r.elements.splice(n,1),r.elements.splice(n,0,i),u)},findPositionOfElementInFormById:function(n,t){var u=this,i={position:t,found:!1},r;if(u.guid===n)return!0;for(r=0;r<u.elements.length;r++){if(t+=1,i=u.elements[r].findPositionOfElementInFormById(n,t),i.found)break;t=i.position}return i},replaceElement:function(n,t){var i=this,r=i.removeElementById(n),u=r.parent;i.insertElement(r.position,u.guid,t)}};
bizagi.editor.base.element.extend("bizagi.editor.base.container",{},$.extend({},bizagi.editor.base.containerBehaviour,bizagi.editor.base.containerValidations,{init:function(n,t,i){var r=this;r.elements=[];r.elementType="container";r._super(n,t,i);r.initialize(n,i)},initialize:function(n,t){var i=this,r=i.elements;n&&n.elements&&$.each(n.elements,function(n,u){var f=i.elementFactory.createElement(u.type,u,t);f.setParent(i);r.push(f)})},ready:function(){var n=this;return $.when.apply($,$.map(n.elements,function(n){return n.ready()}))},getRenderingModel:function(){var t=this,n=$.Deferred(),i=t._super();return $.when.apply($,$.map(this.elements,function(n){return n.getRenderingModel()})).done(function(){var t=$.makeArray(arguments);$.when(i).done(function(i){i.elements=t;n.resolve({container:i})})}),n.promise()},getPersistenceModel:function(){var t=this,n=this._super();return n.elements=[],$.each(t.elements,function(t,i){n.elements.push(i.getPersistenceModel())}),n},getControlType:function(){return this.controlType},getFormParent:function(){return this.parent.getFormParent()},getChildren:function(){var n=this;return n.elements},getInherentValidations:function(n){var t=this;return n=n||[],$.each(t.elements,function(t,i){i.getInherentValidations(n)}),n}}));
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.formBehaviour={isButtonElement:function(n){return n&&n.type?n.type=="formbutton":!1},addButton:function(n){var t=this;return n.position=t.buttons.length,t.buttons.push(n),n.setParent(t),n},moveElement:function(n,t,i,r){var u=this;return r!="button"?u._super(n,t,i):(u.buttons.move(n,t),this)},getElement:function(n){var t=this,u=t._super(n),r,i;if(!u&&t.buttons)for(r=0;r<t.buttons.length;r++)if(i=t.buttons[r],i.guid==n)return i.position=t.buttons.indexOf(i),i;return u},removeElementById:function(n){var t=this,i=t.getElement(n);return i==null?null:t.isButtonElement(i)?(t.buttons.splice(i.position,1),i):t._super(n)},removeElement:function(n,t,i){var r=this;return r.isButtonElement(i)?(r.buttons.splice(n,1),i):r._super(n,t)}};
bizagi.editor.base.container.extend("bizagi.editor.base.form",{},$.extend({},bizagi.editor.base.formBehaviour,{init:function(n,t,i){var r=this;r.type="form";this._super(n,t,i);r.actions=n&&n.actions?n.actions:[];r.actions=i?r.regenerateGuidsActions():r.actions;r.validations=n&&n.validations?n.validations:[];r.validations=i?r.regenerateGuidsValidations():r.validations;r.buttons=[];n.buttons&&(r.loadButtons(n),r.properties.usecustombuttons=r.properties.usecustombuttons===undefined?!0:r.properties.usecustombuttons);r.contextentity=n.contextentity;r.scopedefinition=n.scopedefinition;r.isActivityForm=n.isActivityForm==undefined?n.isActivityForm:n.buttons?!0:!1;r.version=n.version},loadButtons:function(n){var t=this,i;n&&n.buttons&&(i=t.buttons=[],$.each(n.buttons,function(n,r){var u=t.elementFactory.createElement(r.type,r);u.setParent(t);i.push(u)}))},getFormParent:function(){return this},getRenderingModel:function(){var n=this,t=$.Deferred(),i=n._super();return $.when(i).done(function(i){var r=i.container,u=r.properties;u.isReadOnly=n.triggerGlobalHandler("isReadOnlyForm");t.resolve({form:i.container})}),t.promise()},getPersistenceModel:function(){var n=this,t=this._super();return n.buttons=n.buttons||[],t.actions=n.actions,t.validations=n.validations,t.contextentity=typeof n.contextentity=="string"?bizagi.editor.utilities.buildComplexReference(n.contextentity):n.contextentity,n.scopeDefinitionCanBeAdded()&&(t.scopedefinition=typeof n.scopedefinition=="string"?bizagi.editor.utilities.buildComplexReference(n.scopedefinition):n.scopedefinition),t.version=n.version,n.hasCustomButtons()&&(t.buttons=[],$.each(n.buttons,function(n,i){t.buttons.push(i.getPersistenceModel())})),t},scopeDefinitionCanBeAdded:function(){var n=this;return typeof n.scopedefinition=="string"?!bizagi.editor.utilities.isGuidEmpty(n.scopedefinition):bizagi.editor.utilities.isObject(n.scopedefinition)?!bizagi.editor.utilities.isGuidEmpty(bizagi.editor.utilities.resolveComplexReference(n.scopedefinition)):!1},hasCustomButtons:function(){var n=this;return n.properties.usecustombuttons!==undefined?n.properties.usecustombuttons:!1},getSearchResultRenderingModel:function(){},getButtonRenderingModel:function(){return $.when.apply($,$.map(this.buttons,function(n){return n.getRenderingModel("button")})).pipe(function(){return $.makeArray(arguments)})},getCommandsModel:function(){var n=this,t=$.Deferred(),r={},i=[],u=n.getCommandsControls(n,r,i);return i.length>0?$.when(n.getCommandsSpecialControls(i,r)).done(function(){t.resolve({actions:n.getActions(),validations:n.getValidations(),controls:u,enableReverse:n.verifyFormHasReverse()})}):t.resolve({actions:n.getActions(),validations:n.getValidations(),controls:u,enableReverse:n.verifyFormHasReverse()}),t.promise()},getValidations:function(){var n=this,t=bizagi.clone(n.validations);return $.merge(t,n.getInherentValidations()),t},getActions:function(){var n=this;return $.each(n.actions,function(n,t){for(var i,u=$.grep(t.commands,function(n){return n.command==="execute-rule"||n.command==="execute-gridrule"}),r=0,f=u.length;r<f;r++)i=u[r].argument,bizagi.editor.utilities.isObject(i)||(i={rule:i,label:"Rule"}),i.guid&&(i.rule=bizagi.editor.utilities.buildComplexReference(i.guid),delete i.guid),function(n,t,i){var r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getruledisplayname",rule:n});$.when(r.processRequest()).done(function(n){t.label=n?n.displayName:t.label;i.argument=t})}(i.rule,i,u[r])}),n.actions},getActionValidationsModel:function(){var n=this;return{actions:n.actions,validations:n.validations,mapXpaths:n.getMapControls(n,{})}},setCommandsModel:function(n){var t=this;t.actions=n.actions||[];t.validations=n.validations?$.grep(n.validations,function(n){return n.inherent?!1:!0}):[]},getCommandsControls:function(n,t,i){var e=this,f,l,h,o,c,a,v,r,s,u;for(t=t||{},i=i||[],r=0;r<n.elements.length;r++)if(n.elements[r].elementType=="container"&&n.elements[r].type!=="nestedform"&&e.getCommandsControls(n.elements[r],t,i),n.elements[r].controlType!=="boolean"||n.elements[r].properties.display!=="check"||!bizagi.util.parseBoolean(n.elements[r].properties.isexclusive)){if(f=n.elements[r].getControlType(),l=n.elements[r].isVisualProperty("xpath"),n.elements[r].isHidden()&&!f&&!bizagi.util.isEmpty(n.elements[r].properties.xpath)){i.push(n.elements[r]);continue}n.elements[r].type!="offlinegrid"&&n.elements[r].type!="image"&&(f&&!bizagi.util.isEmpty(n.elements[r].properties.xpath)&&n.elements[r].elementType!=="container"?(h=n.elements[r].isContainedInNestedForm(),o=h?h+"."+n.elements[r].getXpath():n.elements[r].getXpath(),o=n.isGrid()?n.getXpath()+"[]."+n.elements[r].getXpath():o,n.isGrid()||h?typeof n.properties.xpath=="object"?c=e.buildCompositeXpath({originalXpath:n.properties.xpath,resolved:o}):(a=n.elements[r].getXpathNestedForm(),c=e.buildCompositeXpath({originalXpath:a,resolved:o})):c=n.elements[r].properties.xpath,v=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.elements[r].properties.xpath),t[o]={label:n.isGrid()?(bizagi.util.trim(n.resolveDisplayNameProperty())||n.getXpath())+"."+n.elements[r].resolveDisplayNameProperty():n.elements[r].resolveDisplayNameProperty(),type:n.elements[r].getControlType(n.elements[r]),render:n.elements[r].elementType=="render"?!0:null,container:n.elements[r].elementType=="container"?!0:null,baxpath:c,xpathContainer:n.isGrid()?n.getXpath():null,controlType:n.elements[r].type,style:n.elements[r].style,relatedEntity:v}):f&&n.elements[r].elementType==="container"?(u=n.elements[r].guid,t[u]={label:n.elements[r].resolveDisplayNameProperty()||f+" "+u,type:n.elements[r].getControlType(n.elements[r]),render:!1,container:!0,containerId:u,propertyToUpdate:"container",controlType:n.elements[r].type,style:n.elements[r].style}):!l&&f&&n.elements[r].elementType!=="container"&&(u=n.isGrid()?n.getXpath()+"[]."+n.elements[r].guid:n.elements[r].guid,t[u]={label:n.isGrid()?(n.resolveDisplayNameProperty()||n.getXpath())+"."+n.elements[r].resolveDisplayNameProperty()||f+" "+u:n.elements[r].resolveDisplayNameProperty()||f+" "+u,type:f,render:n.elements[r].elementType=="render"?!0:null,container:n.elements[r].elementType=="container"?!0:null,renderId:u,propertyToUpdate:"renderId",xpathContainer:n.isGrid()?n.getXpath():null,controlType:n.elements[r].type,style:n.elements[r].style}),n.elements[r].isGrid()&&!bizagi.util.isEmpty(n.elements[r].properties.xpath)&&e.getCommandsControls(n.elements[r],t,i))}if(e.properties.usecustombuttons)for(r=0;r<e.getFormParent().buttons.length;r++)s=e.getFormParent().buttons[r],u=s.guid,t[u]={label:s.properties.caption.i18n["default"],type:"activityFlowButton",render:s.elementType=="render"?!0:null,container:null,renderId:s.guid,propertyToUpdate:"renderId",xpathContainer:null,controlType:"activityFlowButton"};return t},getCommandsSpecialControls:function(n,t){var r=this,i=new $.Deferred;return $.when.apply($,$.map(n,function(n){return n.getControlAttributes()})).done(function(){r.getCommandsControls({elements:n,isGrid:function(){return!1}},t);i.resolve()}),i.promise()},getMapControls:function(n,t){var e=this,i,u,f,r;for(t=t||{},i=0;i<n.elements.length;i++)(u=n.elements[i],(u.elementType=="container"||u.isGrid())&&e.getMapControls(u,t),n.elements[i].type!="nestedform"&&n.elements[i].type!="formlink"&&n.elements[i].type!="hidden"&&n.elements[i].type!="offlinehidden")&&(bizagi.util.isEmpty(n.elements[i].properties.xpath)||(f=n.elements[i].isContainedInNestedForm(),r=f?f+"."+n.elements[i].getXpath()+n.elements[i].getFilter():n.elements[i].getXpath()+n.elements[i].getFilter(),r=n.isGrid()?n.getXpath()+n.getFilter()+"."+r:r,t[r]||(t[r]={elements:[]}),t[r].elements.push({guid:n.elements[i].guid}),f?t[r].elements[t[r].elements.length-1].nestedForm=!0:""));return t},getMapXpath:function(n,t){var o=this,i,u,f,r,e;for(t=t||{},i=0;i<n.elements.length;i++)(u=n.elements[i],(u.elementType=="container"||u.isGrid())&&n.elements[i].isEditable()&&o.getMapXpath(u,t),n.elements[i].type!="nestedform"&&n.elements[i].type!="formlink"&&n.elements[i].type!="hidden"&&n.elements[i].type!="offlinehidden")&&(bizagi.util.isEmpty(n.elements[i].properties.xpath)||(f=n.elements[i].isContainedInNestedForm(),r=f?f+"."+n.elements[i].getXpath()+n.elements[i].getFilter():n.elements[i].getXpath()+n.elements[i].getFilter(),r=n.isGrid()?n.getXpath()+n.getFilter()+"."+r:r,t[r]||(t[r]={editables:0,elements:[]}),e=bizagi.editor.utilities.resolveProperty(n.elements[i].properties,"editable.fixedvalue")||!0,t[r].editables=bizagi.util.parseBoolean(e)?t[r].editables+1:t[r].editables,t[r].elements.push({editable:e?bizagi.util.parseBoolean(e):!0,guid:n.elements[i].guid}),f?t[r].elements[t[r].elements.length-1].nestedForm=!0:""));return t},buildxpathColumn:function(n){return buildCompositeXpath(n)},buildCompositeXpath:function(n){var i,t;return typeof n.originalXpath=="object"?(t=bizagi.clone(n.originalXpath),t.xpath.baxpath.xpath=n.resolved,t):i},addAction:function(n){this.actions.push(n)},deleteAction:function(n){for(var i=this,r=-1,t=0;t<i.actions.length;t++)if(i.actions[t].guid==n){r=t;break}r>=0&&i.actions.splice(r,1)},addValidation:function(n){this.validations.push(n)},deleteValidation:function(n){for(var i=this,r=-1,t=0;t<i.validations.length;t++)if(i.validations[t].guid==n){r=t;break}r>=0&&i.validations.splice(r,1)},triggerGlobalHandler:function(n,t){var i=this;return i.publish(n,t)},verifyFormHasReverse:function(){for(var r=this,t=r.actions,i=!1,n=0;n<t.length;n++)if(t[n].elseAction&&t[n].elseAction=="automatic"){i=!0;break}return i},regenerateGuidsActions:function(){for(var r,c,t,e,o,u,f,h,i=this,l=0,y=i.actions.length;l<y;l++){for(r=i.actions[l],c=[],i.getExpressions(r.conditions.expressions,c),t=0,e=c.length;t<e;t++)if(o=c[t],o.renderId)if(i.isGridContext(o.renderId)){var s=i.processGridContext(o.renderId),n=i.getElementByOldGuid(s.guidControl),a=n?n.guid:s.guidControl,v=s.gridXpath+"[]."+a;o.renderId=v}else n=i.getElementByOldGuid(o.renderId),o.renderId=n?n.guid:o.renderId;if(r.commands)for(t=0,e=r.commands.length;t<e;t++)u=r.commands[t],(u.renderId||u.container)&&(n=i.getElementByOldGuid(u.renderId||u.container),u.renderId?u.renderId=n?n.guid:u.renderId:u.container=n?n.guid:u.container);if(r.elseCommands)for(t=0,e=r.elseCommands.length;t<e;t++)f=r.elseCommands[t],(f.renderId||f.container)&&(n=i.getElementByOldGuid(f.renderId||f.container),f.renderId?f.renderId=n?n.guid:f.renderId:f.container=n?n.guid:f.container);if(r.dependencies)for(t=0,e=r.dependencies.length;t<e;t++)h=r.dependencies[t],typeof h=="string"&&(i.isGridContext(h)?(s=i.processGridContext(h),n=i.getElementByOldGuid(s.guidControl),a=n?n.guid:s.guidControl,v=s.gridXpath+"[]."+a,r.dependencies[t]=v):(n=i.getElementByOldGuid(h),r.dependencies[t]=n?n.guid:h))}},getExpressions:function(n,t){for(var i,u=this,r=0,f=n.length;r<f;r++)i=n[r],i.complex?u.getExpressions(i.complex.conditions.expressions,t):i.simple&&t.push(i.simple)},regenerateGuidsValidations:function(){for(var o,r,u,s,n,t=this,f=0,h=t.validations.length;f<h;f++)for(o=t.validations[f],r=[],t.getExpressions(o.conditions.expressions,r),u=0,s=r.length;u<s;u++)if(n=r[u],n.renderId)if(t.isGridContext(n.renderId)){var e=t.processGridContext(n.renderId),i=t.getElementByOldGuid(e.guidControl),c=i?i.guid:e.guidControl,l=e.gridXpath+"[]."+c;n.renderId=l}else i=t.getElementByOldGuid(n.renderId),n.renderId=i?i.guid:n.renderId},isGridContext:function(n){return n&&n.indexOf("[]")>0?!0:!1},processGridContext:function(n){var u=new RegExp(/([\w\.]*)\[\]\.([\w\.|\w-\.]*)/g),t=u.exec(n),i,r;return t?(r=t[1],i=t[2]):(i="",r=""),{guidControl:i,gridXpath:r}},createDefaultButtons:function(){var n=this,t,i,r,u;n.buttons=[];t=Math.guid();i=n.elementFactory.createElement("formbutton",{guid:t,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-save"),t,"caption"),actions:["submitData","refresh"]}});i.setParent(n);r=Math.guid();u=n.elementFactory.createElement("formbutton",{guid:r,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-next"),r,"caption"),actions:["validate","submitData","next"]}});u.setParent(n);n.buttons.push(i);n.buttons.push(u)}}));
bizagi.editor.base.form.extend("bizagi.editor.base.startform",{},$.extend({},bizagi.editor.base.formBehaviour,{init:function(n,t){var i=this;this._super(n,t);i.type="startform"},getPersistenceModel:function(){var n=this,t,i,r;return n.triggerGlobalHandler("getControllerInfo",{type:"isNewForm"})&&(t="displayName",n.resolveProperty(t)||(i=bizagi.editor.utilities.resolveResource("bizagi-editor-startform-display-name"),r=bizagi.editor.utilities.buildComplexLocalizable(i,n.guid,t),n.assignProperty(t,r))),n._super()},createDefaultButtons:function(){var n=this,t,i;n.buttons=[];t=Math.guid();i=n.elementFactory.createElement("formbutton",{guid:t,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-create"),t,"caption"),actions:["validate","createnewcase"]}});i.setParent(n);n.buttons.push(i)},hasCustomButtons:function(){return!0}}));
bizagi.editor.base.form.extend("bizagi.editor.base.adhocform",{},$.extend({},bizagi.editor.base.formBehaviour,{init:function(n,t){var i=this;this._super(n,t);i.type="adhocform"}}));
bizagi.editor.base.form.extend("bizagi.editor.base.template",{},{init:function(n,t,i){var r=this;this._super(n,t,i);r.type="template"},getFormParent:function(){return this},getLayout:function(){return this.elements[0]}});
bizagi.editor.base.container.extend("bizagi.editor.base.layout",{},{init:function(n,t,i){var r=this;r.type="layout";r.repeaters={};this._super(n,t,i)},initialize:function(n){for(var i,t=this,f=t.properties,e=t.elements,o=/\{\{(placeholder(\:\w*)?)\}\}/g,s=/{{(repeater( {"id":"([\w-]+)"})?)}}\s*({{repeater:item}}([\w\W]+){{\/repeater:item}})/g,h=/{{repeater:item}}(<\w{2,10}\s*(class="[a-z]*")?([\sa-z0-9-="]*style="display: none;")>[\w\W]+){{\/repeater:item}}/,c=f.html,r=c.split("{{/repeater}}"),u=0,l=r.length;u<l;u++)i=r[u],i=i.replace(s,function(){function o(n){return n.replace(/({{placeholder(:\w*)?)(\s*\{"id":"([\w-]+)"\})?/gm,function(){var n=arguments[4];return n&&(e[n]=!0),arguments[1]})}var f=arguments[3]!=undefined?arguments[3]:Math.guid(),i=arguments[5],u=arguments[4],e={},n=arguments[0],r;return arguments[3]!=undefined?(r=h.exec(u),i=r[1],o(i),u=r[0].replace(r[3],"")):n=n.replace(i,$(i).attr("id",Math.guid())[0].outerHTML),t.repeaters[f]={content:i,item:u,elements:e},n=arguments[3]!=undefined?n:n.replace("{{repeater}}","{{repeater "+JSON.stringify({id:f})+"}}"),n+"{{/repeater}}"}),i=i.replace(o,function(n,i,r){var f=Math.guid(),o="layoutPlaceholder",u;return r==":image"&&(o="layoutImage"),u=t.elementFactory.createElement(o,{guid:f,properties:{type:r||"Value"}},!1),u.setParent(t),e.push(u),"{{placeholder "+JSON.stringify({id:f})+"}}"}),r[u]=i;return f.html=r.join(""),t._super(n)},getRenderingModel:function(){for(var r,n=this,u=n.properties,f=n.elements,e=/({{placeholder(:\w*)?(\s*\{"id":"([\w-]+)"\})?)/g,o=/\{\{repeater \{"id":"([a-zA-Z0-9-]+)"\}\}\}\s*\{\{repeater:item\}\}[\w\W]+/g,s=u.html,t=s.split("{{/repeater}}"),i=0,h=t.length;i<h;i++)r=t[i],r=r.replace(o,function(t,i){var o=i,u=n.repeaters[o],r;return u&&n.addAditionalItem(u)?(t=t.replace('noshow="true"',""),t=t.replace('style="display: none;"',""),u.elements={},r=$(n.repeaters[o].content).css({display:"none"}).attr("noShow",!0).attr("id",Math.guid()),r=r[0].outerHTML,r="{{separator}}{{repeater:item}}"+r+"{{/repeater:item}}",r=r.replace(e,function(t,i,r){var e=Math.guid(),o=n.elementFactory.createElement("layoutPlaceholder",{guid:e,properties:{type:r||"Value",repeaterId:e}},!1);return u.elements[e]=!0,o.setParent(n),f.push(o),arguments[3]!=undefined?t.replace(arguments[3],JSON.stringify({id:e})):t+" "+JSON.stringify({id:e})}),t+r+"{{/repeater}}"):t+"{{/repeater}}"}),t[i]=r;return u.html=t.join(""),n._super()},addAditionalItem:function(n){var i,t;if($.isEmptyObject(n.elements))return!0;for(i in n.elements)if((t=this.getElement(i),!t)||t.hasValue())return!0;return!1}});
bizagi.editor.base.render.extend("bizagi.editor.base.formbutton",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.fixProperties()},fixProperties:function(){var n=this,t=n.properties;t.buttonrule&&n.fixButtonRuleProperty(t.buttonrule)},fixButtonRuleProperty:function(n){var t=this;n.baref&&(n={rule:n},t.assignProperty("buttonrule",n))}});
bizagi.editor.base.form.extend("bizagi.editor.base.offlineform",{},$.extend({},bizagi.editor.base.formBehaviour,{init:function(n,t){var i=this;this._super(n,t);i.type="offlineform"}}));
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.searchFormBehaviour={isResultElement:function(n){return n.type.indexOf("columnResult")>=0},addElement:function(n,t){var i=this;return i.isResultElement(n)?(n.position=i.result.length,i.result.push(n),n.setParent(i),n):i._super(n,t)},insertElement:function(n,t,i){var r=this;return r.isResultElement(i)?(r.result.splice(n,0,i),i.setParent(r),i):r._super(n,t,i)},getElement:function(n){var i=this,u=i._super(n),r,t;if(!u)for(r=0;r<i.result.length;r++)if(t=i.result[r],t.guid==n)return t.position=i.result.indexOf(t),t;return u},moveElement:function(n,t,i,r){var u=this;return r!="searchresult"?u._super(n,t,i):(u.result.move(n,t),this)},removeElementById:function(n){var t=this,i=t.getElement(n);return i==null?null:t.isResultElement(i)?(t.result.splice(i.position,1),i):t._super(n)}};
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.queryFormBehaviour={isResultElement:function(n){return n.type.indexOf("columnResult")>=0},addElement:function(n,t){var i=this;return i.isResultElement(n)?(n.position=i.result.length,i.result.push(n),n.setParent(i),n):i._super(n,t)},insertElement:function(n,t,i){var r=this;return r.isResultElement(i)?(r.result.splice(n,0,i),i.setParent(r),i):r._super(n,t,i)},getElement:function(n){var t=this;return t._super(n)},moveElement:function(n,t,i,r){var u=this;return r!="searchresult"?u._super(n,t,i):(u.result.move(n,t),this)},removeElementById:function(n){var t=this,i=t.getElement(n);return i==null?null:t.isResultElement(i)?(t.result.splice(i.position,1),i):t._super(n)}};
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.searchFormValidations={validRequiredProperties:function(){return this._super()},validRequiredDependentProperties:function(){return!0},validAttributesAdministrables:function(){return!0},validElementsInContainer:function(){var t=this,i=!0,n;return t.resultValidations="",i=t.result.length>0,i||(n=bizagi.localization.getResource("bizagi-editor-form-validation-elementsincontainer"),typeof n!="string"&&(n=""),t.resultValidations=n),i},removeValidations:function(){var n=this;n._super();n.resultValidations=null}};
bizagi.editor=bizagi.editor||{};bizagi.editor.base=bizagi.editor.base||{};bizagi.editor.base.queryFormValidations={validRequiredProperties:function(){return this._super()},validRequiredDependentProperties:function(){return!0},validAttributesAdministrables:function(){return!0},validElementsInContainer:function(){return this._super()},removeValidations:function(){var n=this;n._super();n.resultValidations=null}};
bizagi.editor.base.container.extend("bizagi.editor.base.searchform",{},$.extend({},bizagi.editor.base.searchFormBehaviour,bizagi.editor.base.searchFormValidations,{init:function(n,t,i){var r=this;r.type="searchform";this._super(n,t,i);r.contextentity=n.contextentity;r.scopedefinition=n.scopedefinition;r.version=n.version;r.result=[];n.result&&$.each(n.result,function(n,t){var i=r.elementFactory.createElement(t.type,t);i.setParent(r);r.result.push(i)})},getFormParent:function(){return this},getRenderingModel:function(){var n=$.Deferred(),t=this._super();return $.when(t).done(function(t){t.container&&t.container.properties&&(t.container.properties.type="form");n.resolve({form:t.container})}),n.promise()},getPersistenceModel:function(){var n=this,t=this._super();return t=$.extend(t,{result:n.getSearchResultPersistenceModel(),resultValidations:n.resultValidations}),t.contextentity=typeof n.contextentity=="string"?bizagi.editor.utilities.buildComplexReference(n.contextentity):n.contextentity,t.scopedefinition=typeof n.scopedefinition=="string"?bizagi.editor.utilities.buildComplexReference(n.scopedefinition):n.scopedefinition,t.version=n.version,t},getSearchResultPersistenceModel:function(){var t=this,n=[];return $.each(t.result,function(t,i){n.push(i.getPersistenceModel())}),n},getSearchResultRenderingModel:function(){var n=this,t=$.Deferred();return $.when.apply($,$.map(n.result,function(n){return n.getGridColumnModel()})).done(function(){t.resolve({result:$.makeArray(arguments),resultValidations:n.resultValidations})}),t.promise()},resolveDisplayNameProperty:function(){var n=this;return n.resolveProperty("displayName")?n.resolveI18nProperty("displayName"):undefined},getMapXpath:function(){return},getMapControls:function(){return},triggerGlobalHandler:function(n,t){var i=this;return i.publish(n,t)}}));
bizagi.editor.base.container.extend("bizagi.editor.base.queryform",{},$.extend({},bizagi.editor.base.queryFormValidations,{init:function(n,t,i){var r=this;r.type="queryform";this._super(n,t,i);r.actions=n&&n.actions?n.actions:[];r.actions=i?r.regenerateGuidsActions():r.actions;r.validations=n&&n.validations?n.validations:[];r.validations=i?r.regenerateGuidsValidations():r.validations;r.contextentity=n.contextentity;r.scopedefinition=n.scopedefinition;r.version=n.version},getFormParent:function(){return this},getRenderingModel:function(){var n=$.Deferred(),t=this._super();return $.when(t).done(function(t){n.resolve({form:t.container})}),n.promise()},getPersistenceModel:function(){var n=this,t=this._super(),i=n.triggerGlobalHandler("getContextEntityType");return t.actions=n.actions,t.validations=n.validations,t.properties.onlynested=t.properties.onlynested||!1,t.contextentity=typeof n.contextentity=="string"?bizagi.editor.utilities.buildComplexReference(n.contextentity):n.contextentity,t.scopedefinition=typeof n.scopedefinition=="string"?bizagi.editor.utilities.buildComplexReference(n.scopedefinition):n.scopedefinition,t.version=n.version,t.queryType=i=="application"?"application":"entity",t},resolveDisplayNameProperty:function(){var n=this;return n.resolveProperty("displayName")?n.resolveI18nProperty("displayName"):undefined},getCommandsModel:function(){var n=this,t=$.Deferred(),r={},i=[],u=n.getCommandsControls(n,r,i);return i.length>0?$.when(n.getCommandsSpecialControls(i,r)).done(function(){t.resolve({actions:n.getActions(),validations:n.getValidations(),controls:u,enableReverse:n.verifyFormHasReverse()})}):t.resolve({actions:n.getActions(),validations:n.getValidations(),controls:u,enableReverse:n.verifyFormHasReverse()}),t.promise()},getValidations:function(){var n=this,t=bizagi.clone(n.validations);return $.merge(t,n.getInherentValidations()),t},getActions:function(){var n=this;return $.each(n.actions,function(n,t){for(var i,u=$.grep(t.commands,function(n){return n.command==="execute-rule"||n.command==="execute-gridrule"}),r=0,f=u.length;r<f;r++)i=u[r].argument,bizagi.editor.utilities.isObject(i)||(i={rule:i,label:"Rule"}),i.guid&&(i.rule=bizagi.editor.utilities.buildComplexReference(i.guid),delete i.guid),function(n,t,i){var r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getruledisplayname",rule:n});$.when(r.processRequest()).done(function(n){t.label=n?n.displayName:t.label;i.argument=t})}(i.rule,i,u[r])}),n.actions},getActionValidationsModel:function(){var n=this;return{actions:n.actions,validations:n.validations,mapXpaths:n.getMapControls(n,{})}},setCommandsModel:function(n){var t=this;t.actions=n.actions||[];t.validations=n.validations?$.grep(n.validations,function(n){return n.inherent?!1:!0}):[]},getCommandsControls:function(n,t,i){var o=this,r,u,s,e,f;for(t=t||{},i=i||[],r=0;r<n.elements.length;r++){if(n.elements[r].elementType=="container"&&n.elements[r].type!=="nestedform"&&o.getCommandsControls(n.elements[r],t,i),u=n.elements[r].getControlType(),s=n.elements[r].isVisualProperty("xpath"),n.elements[r].isHidden()&&!u&&!bizagi.util.isEmpty(n.elements[r].properties.xpath)){i.push(n.elements[r]);continue}n.elements[r].isInternal()||n.elements[r].type!="image"&&(u&&!bizagi.util.isEmpty(n.elements[r].properties.xpath)&&n.elements[r].elementType!=="container"?(e=n.isGrid()?n.getXpath()+"[]."+n.elements[r].getXpath():n.elements[r].getXpath(),t[e]={label:n.isGrid()?(bizagi.util.trim(n.resolveDisplayNameProperty())||n.getXpath())+"."+n.elements[r].resolveDisplayNameProperty():n.elements[r].resolveDisplayNameProperty(),type:n.elements[r].getControlType(n.elements[r]),render:n.elements[r].elementType=="render"?!0:null,container:n.elements[r].elementType=="container"?!0:null,baxpath:n.isGrid()?o.buildxpathColumn({originalXpath:n.properties.xpath,resolved:e}):n.elements[r].properties.xpath,xpathContainer:n.isGrid()?n.getXpath():null,controlType:n.elements[r].type,style:n.elements[r].style}):u&&n.elements[r].elementType==="container"?(f=n.elements[r].guid,t[f]={label:n.elements[r].resolveDisplayNameProperty()||u+" "+f,type:n.elements[r].getControlType(n.elements[r]),render:!1,container:!0,containerId:f,propertyToUpdate:"container",controlType:n.elements[r].type,style:n.elements[r].style}):!s&&u&&n.elements[r].elementType!=="container"&&(f=n.isGrid()?n.getXpath()+"[]."+n.elements[r].guid:n.elements[r].guid,t[f]={label:n.isGrid()?(n.resolveDisplayNameProperty()||n.getXpath())+"."+n.elements[r].resolveDisplayNameProperty()||u+" "+f:n.elements[r].resolveDisplayNameProperty()||u+" "+f,type:u,render:n.elements[r].elementType=="render"?!0:null,container:n.elements[r].elementType=="container"?!0:null,renderId:f,propertyToUpdate:"renderId",xpathContainer:n.isGrid()?n.getXpath():null,controlType:n.elements[r].type,style:n.elements[r].style}))}return t},getCommandsSpecialControls:function(n,t){var r=this,i=new $.Deferred;return $.when.apply($,$.map(n,function(n){return n.getControlAttributes()})).done(function(){r.getCommandsControls({elements:n,isGrid:function(){return!1}},t);i.resolve()}),i.promise()},verifyFormHasReverse:function(){for(var r=this,t=r.actions,i=!1,n=0;n<t.length;n++)if(t[n].elseAction&&t[n].elseAction=="automatic"){i=!0;break}return i},getMapXpath:function(){return},getMapControls:function(){return},triggerGlobalHandler:function(n,t){var i=this;return i.publish(n,t)}}));
$.Class.extend("bizagi.editor.base.elementFactory",{designValueRegex:/<\w+:([\w:]+)>/},{init:function(n){var t=this,i;t.classes={};i=t.controls=n.controls;$.each(n.definitions.controls,function(n,r){var u=i.getControlsToConvert(r.name),f=t.createClassForControl(r,u);t.classes[r.name]=f})},createClassForControl:function(n,t){var u=this,f=n.type||"render",i=f=="container"||f=="offlinecontainer"||f=="adhoccontainer"?"bizagi.editor.base.container":"bizagi.editor.base.render",r,e;f=="queryInternal"?i="bizagi.editor.base.internal":n.name==="grid"||n.name==="groupedgrid"||n.name==="offlinegrid"||n.name==="adhocgrid"?i="bizagi.editor.base.grid":n.name==="panel"||n.name==="horizontal"?i="bizagi.editor.base.container":n.name==="nestedform"||n.name==="querynestedform"?i="bizagi.editor.base.nestedform":n.name==="form"?i="bizagi.editor.base.form":n.name==="template"?i="bizagi.editor.base.template":n.name==="layout"?i="bizagi.editor.base.layout":n.name==="offlineform"?i="bizagi.editor.base.offlineform":n.name==="adhocform"?i="bizagi.editor.base.adhocform":n.name==="searchform"?i="bizagi.editor.base.searchform":n.name==="queryform"?i="bizagi.editor.base.queryform":n.name=="startform"?i="bizagi.editor.base.startform":n.name==="formbutton"?i="bizagi.editor.base.formbutton":n.name==="collectionnavigator"?i="bizagi.editor.base.collectionnavigator":n.name==="actionlauncher"?i="bizagi.editor.base.actionlauncher":n.name==="polymorphiclauncher"?i="bizagi.editor.base.polymorphiclauncher":n.name==="entitytemplate"?i="bizagi.editor.base.entitytemplate":f==="template"&&(i="bizagi.editor.base.renderLayout");r="bizagi.editor."+n.name;e=i+'.extend("'+r+'" , {}, {\ninit: function ( data, elementFactory, regenerateGuid ) {\nvar self = this;\nself.type = "'+n.name+'";\nself.style = "'+n.style+'";\nthis._super(data, elementFactory, regenerateGuid);\nthis.propertyModel = this.Class.propertyModel;\nthis.decoratorModel = this.Class.decoratorModel;\nthis.contextMenuModel = this.Class.contextMenuModel;\nthis.convertToModel = this.Class.convertToModel;\nthis["widget-guid"] = this.Class["widget-guid"];\nthis.context = this.Class.decoratorModel;\nthis.defaultValues = {};\nthis.asyncProperties = [];\nthis.requiredProperties = {};\nthis.xpathProperties = [];\nthis.requiredDependentProperties = {};\nthis.designValueProperties = {};\nthis.controlType = '+(n["data-type"]?'"'+n["data-type"]+'"':"null")+";\n"+u.buildCodeForDefaultProperties(n.design.properties)+u.buildCodeForDesignValueProperties(n)+u.buildCodeForRequiredProperties(n.design.properties)+u.buildCodeForRequiredDependentProperties(n.design.properties)+"}, \n\ngetRenderingProperties: function ( ) {\nvar self = this;\nvar defer = $.Deferred();\nvar result = this._super();\n"+u.buildCodeForRenderingModel(n)+"$.when.apply($, self.asyncProperties).done(function(){ defer.resolve(result);}) \nreturn defer.promise();\n},\n\ngetRibbonProperties: function ( ) {\nvar self = this;\nvar result = [];\n"+u.buildCodeForRibbonProperties(n)+"return result;\n},\n\ngetLocalizableProperties: function ( ) {\nvar self = this;\nvar result = [];\n"+u.buildCodeForLocalizableProperties(n)+"return result;\n},\n\n})\n";try{eval(e);eval(r).propertyModel=new bizagi.editor.component.properties.model(n);eval(r).decoratorModel=bizagi.editor.component.decorator.model.getSpecificModel(n);eval(r).contextMenuModel=new bizagi.editor.component.contextmenu.model(n.design.visual["context-menu"],t);eval(r).convertToModel=t;eval(r)["widget-guid"]=n.rendertype==="userfield"?n.guid:null}catch(o){return console.warn(o),"bizagi.editor.label"}return r},addWidgetsControls:function(n){var t=this;$.each(n,function(n,i){var r=t.createClassForControl(i,[]);t.classes[i.name]=r})},buildCodeForRenderingModel:function(n){var r=this,u="",e,t,o,f,i;for(e in n.runtime.properties)t=n.runtime.properties[e],t.designvalue&&(o=t.designvalue,f=this.Class.designValueRegex.exec(o),f?(i=f[1].replace(/:/g,"."),u+=r.isLocalizableProperty(n,i)?r.resolvePropertyLocalizable(n,t.name,i):r.isOrientationProperty(n,t.name)?r.resolveOrientationProperty(n,t.name,i):'result["'+t.name+'"] = self.resolveProperty("'+i+'");\n'):u+=typeof t.designvalue=="object"?'result["'+t.name+"\"] = JSON.parse('"+JSON.encode(t.designvalue)+"');\n":'result["'+t.name+'"] = "'+t.designvalue+'";\n');return u},buildCodeForRibbonProperties:function(n){var t="";return $.each(["visible","editable","required"],function(i,r){n.design.properties[r]&&(t+='result.push("'+r+'");\n')}),t},buildCodeForLocalizableProperties:function(n){var r="",i,t;for(i in n.design.properties)t=n.design.properties[i],(t["bas-type"]==="localizable-string"||t["bas-type"]==="localizablestring"||t["bas-type"]==="displayName")&&(r+='result.push("'+i+'");\n');return r},buildCodeForDesignValueProperties:function(n){var u="",f={},e,o,i,r,t;for(e in n.runtime.properties)o=n.runtime.properties[e],i=o.designvalue,i&&(r=this.Class.designValueRegex.exec(i),r&&(t=r[1].split(":")[0],f[t]||(u+='self.designValueProperties["'+t+'"] = true;\n',f[t]=!0)));return u},isLocalizableProperty:function(n,t){var i;return(i=n.design.properties[t],typeof i=="undefined")?!1:i["bas-type"]==="localizable-string"||i["bas-type"]==="localizablestring"||i["bas-type"]==="displayName"},isOrientationProperty:function(n,t){var i;return(i=n.design.properties[t],typeof i=="undefined")?!1:i["bas-type"]==="orientation"},resolvePropertyLocalizable:function(n,t,i){return t==="displayName"?'$.when(self.resolveDisplayNameProperty("'+i+'")).done(function(value){result["'+t+'"] = value;}); \n':'result["'+t+'"] = self.resolveI18nProperty("'+i+'"); \n'},resolveOrientationProperty:function(n,t,i){return'result["'+t+'"] = self.resolveIsRightToLeftProperty("'+i+'"); \n'},buildCodeForDefaultProperties:function(n,t){var e=this,u="",f,i,r;for(f in n)i=n[f],r=t?t+"."+f:f,i["default"]&&(u+=typeof i["default"]=="object"?'self.defaultValues["'+r+"\"] =  JSON.parse('"+e.getDefaultValueProperty(i["default"])+"');\n":'self.defaultValues["'+r+"\"] = '"+i["default"]+"';\n",u+='self.assignDefaultProperty("'+r+'",  self.defaultValues["'+r+'"]);\n'),i.subproperties&&(u+=e.buildCodeForDefaultProperties(i.subproperties,r));return u},buildCodeForRequiredProperties:function(n,t){var f=this,u="",i,r;for(i in n)r=n[i],r.required&&(i=t?t+"."+i:i,u+='self.requiredProperties["'+i+"\"] = '"+r.required+"';\n"),r.subproperties&&(u+=f.buildCodeForRequiredProperties(r.subproperties,i));return u},buildCodeForRequiredDependentProperties:function(n,t){var s=this,u="",i,r,f,e,o;for(i in n){if(r=n[i],r.dependencies&&s.isRequiredDependentProperty(r)&&(i=t?t+"."+i:i,u+='self.requiredDependentProperties["'+i+"\"] = JSON.parse('"+JSON.encode(r.dependencies.conditions)+"');\n"),r["editor-parameters"]){f=r["editor-parameters"];for(e in f)(o=f[e],f.hasOwnProperty(e))&&typeof o=="string"&&o.indexOf("<design:xpath")>-1&&(u+=t?'self.xpathProperties.push("'+t+"."+i+'");\n':'self.xpathProperties.push("'+i+'");\n')}r.subproperties&&(u+=s.buildCodeForRequiredDependentProperties(r.subproperties,i))}return u},getDefaultValueProperty:function(n){return typeof n=="object"?JSON.encode(n):n},createElement:function(n,t,i){var r=this,u;return r.classes[n]?(u=eval("var bafn = function(data, elementFactory, regenerateGuid) {  var element = new "+r.classes[n]+"(data, elementFactory, regenerateGuid); return element;};bafn"),u(t,this,i)):(console.warn("No control definition found for type: "+n),new bizagi.editor.render.generic(t,this))},createColumnElement:function(n,t,i){var r=this;return r.classes[n]?r.createElement(n,t,i):(console.warn("No control definition found for column type: "+n),new bizagi.editor.column.generic(t,this,i))},isRequiredDependentProperty:function(n){var i=!1,t=n.dependencies;return t&&t.actions&&t.actions.required&&(i=!0),i}});
bizagi.editor.base.render.extend("bizagi.editor.base.grid",{relatedEntityType:{entityType:undefined}},$.extend({},bizagi.editor.base.containerBehaviour,bizagi.editor.base.containerValidations,{init:function(n,t,i){var r=this,u=r.elements=[];this._super(n,t,i);n&&n.elements&&$.each(n.elements,function(n,t){var f=r.elementFactory.createColumnElement(t.type,t,i);f.setParent(r);u.push(f)})},getRenderingModel:function(){var n=this,t=$.Deferred(),i=n._super();return $.when.apply($,$.map(n.elements,function(n){return n.getRenderingModel()})).done(function(){var n=$.makeArray(arguments);$.when(i).done(function(i){i.render.elements=n;t.resolve(i)})}),t.promise()},getPersistenceModel:function(){var t=this,n=this._super();return n.elements=[],$.each(t.elements,function(t,i){n.elements.push(i.getPersistenceModel())}),n},getGridColumnModel:function(){var i=this,n,t=$.Deferred(),r=this._super();return $.when.apply($,$.map(i.elements,function(n){return n.getGridColumnModel()})).done(function(){n=arguments;$.when(r).done(function(i){i.elements=$.makeArray(n);t.resolve(i)})}),t.promise()},restoreDefaultDisplayName:function(){var n=this;n._super();$.each(n.elements,function(n,t){t.restoreDefaultDisplayName()})},deleteColumns:function(){var n=this;n.elements=[]},validAttributesAdministrables:function(n){var t=this,i=!0,r;return t.isEditable()&&t.isParametricAttribute(n)&&(r=t.triggerGlobalHandler("getContextEntityType")=="parameter"?bizagi.localization.getResource("bizagi-editor-form-validation-parameter-attribute-parameter-entity"):bizagi.localization.getResource("bizagi-editor-form-validation-parameter-attribute-entity"),t.messageValidation=t.messageValidation||"",t.messageValidation+=r+"<\/br>",i=!1),i},validAttributesNoEditables:function(){var n=this,t=new $.Deferred,i,r,u,f;if(n.type=="adhocgrid")return t.resolve(!0),t.promise();if(i=n.resolveProperty("xpath"),n.isEditable())if(r=n.triggerGlobalHandler("getContextEntityType")=="system",u=n.triggerGlobalHandler("getNodeInfo",{root:!0})||{},r&&u.xpath=="WFUSER")f=bizagi.localization.getResource("bizagi-editor-form-validation-attribute-no-administrable"),n.messageValidation=n.messageValidation||"",n.messageValidation+=f+"<\/br>",t.resolve(!1);else if(i){function e(){var t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getentitytype",entityGuid:bizagi.editor.utilities.resolveRelatedEntityFromXpath(i)});return n.Class.relatedEntityType.entityType!=undefined?n.Class.relatedEntityType:t.processRequest()}$.when(e()).done(function(i){var r,u;n.Class.relatedEntityType.entityType=i.entityType;r=i.entityType==="Parameter"||i.entityType==="Enum";r&&(u=bizagi.localization.getResource("bizagi-editor-form-validation-attribute-no-editable"),n.messageValidation=n.messageValidation||"",n.messageValidation+=u+"<\/br>");t.resolve(!r)})}else t.resolve(!0);else t.resolve(!0);return t.promise()}}));
bizagi.editor.base.render.extend("bizagi.editor.base.internal",{},{init:function(n,t,i){var r=this;r._super(n,t,i)},getRenderingProperties:function(){var t=this,n=t._super();return n.isInternal=!0,n},isInternal:function(){return!0}});
bizagi.editor.base.container.extend("bizagi.editor.base.nestedform",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadDeferred=new $.Deferred;r.elementFactory=t;r.loading=!0;r.message="loading...";r.loadNestedFormElements()},loadNestedFormElements:function(){var n=this,t;t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadform",form:n.properties.form});$.when(t.processRequest(),n.getFormDisplayName()).done(function(t,i){n.formdisplayName=i.displayName;n.processNestedFormElements(t)})},processNestedFormElements:function(n){var t=this;n&&n.elements&&$.each(n.elements,function(n,i){var r=t.elementFactory.createElement(i.type,i);r.setParent(t);t.elements.push(r)});t.loadDeferred.resolve();$.when(t.ready()).done(function(){t.loading=!1;$.when(t.getRenderingModel()).done(function(n){setTimeout(function(){$.when(t.triggerGlobalHandler("formIsLoaded",null)).done(function(){t.triggerGlobalHandler("refreshElement",n)})},100)})})},ready:function(){var n=this,t=n._super();return $.when(t,n.loadDeferred)},getRenderingModel:function(){var n=this,t=$.Deferred();return $.when(this._super()).done(function(i){i.container.properties.loading=n.loading;i.container.properties.message=n.message;t.resolve(i)}),t.promise()},getPersistenceModel:function(){var n=this;return{elements:[],type:n.type,guid:n.guid,properties:n.filterDefaultValues(n.properties)}},getRenderingProperties:function(){var n=this,t=n._super();return n.formdisplayName||$.when(n.getFormDisplayName()).done(function(i){i=i||{};n.formdisplayName=i.displayName;t.formDisplayName=i.displayName}),t.formDisplayName=n.formdisplayName,t},getFormDisplayName:function(){var t=this,i=t.properties,n=new $.Deferred,r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getformdisplayname",guid:bizagi.editor.utilities.resolveComplexReference(i.form)});return $.when(r.processRequest()).done(function(t){n.resolve(t)}),n.promise()},resolveDisplayNameProperty:function(){var n=this;return"Nested form : "+n.formdisplayName},validAttributesAdministrables:function(){var n=this,i=!0,r,t,u;if(n.isEditable())for(r=bizagi.editor.utilities.resolveComplexXpath(n.properties.xpath)+".",t=0,u=n.elements.length;t<u;t++)i=i&n.elements[t].validAttributesAdministrables(r);return i}});
bizagi.editor.base.render.extend("bizagi.editor.base.collectionnavigator",{},{init:function(n,t,i){var r=this;r.validateData(n);r._super(n,t,i);r.elementFactory=t;r.form=null;r.defer=new $.Deferred;r.properties.navigationform&&r.loadForm()},loadForm:function(){var n=this,t;t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadform",form:n.properties.navigationform});$.when(t.processRequest()).done(function(t){n.form=n.elementFactory.createElement("form",t);n.form.subscribe("getDefaultDisplayName",function(t,i){return n.triggerGlobalHandler("getDefaultDisplayName",i)});n.defer.resolve()})},refreshControl:function(n){var t=this,i=n.canvas;$.when(t.form.getRenderingModel()).done(function(n){t.addRenderingModelProperties(n);var r=t.getRenderingFacade();$.when(r.execute({mode:"design",canvas:i,data:n})).done(function(){t.triggerGlobalHandler("resizeHeigthCanvas")})})},getRenderingModel:function(){var t=this,n=$.Deferred();return $.when(this._super()).done(function(i){i.render.properties.navigationform=t.properties.navigationform;n.resolve(i)}),n.promise()},getPersistenceModel:function(){var n=this;return{elements:[],type:n.type,guid:n.guid,properties:n.filterDefaultValues(n.properties)}},getRenderingFacade:function(){var n=this;return n.rendering=n.rendering||new bizagi.rendering.facade,n.rendering},addRenderingModelProperties:function(n){var t=n.form,i=t.properties;return i.isNavigationForm=!0,n},validateData:function(n){n.elements&&delete n.elements}});
bizagi.editor.observableClass.extend("bizagi.editor.base.protocol.base",{},{init:function(n){var t=this;t._super();t.args=n;t.context=n.context;t.parameters=[];t.answerParameters=[];t._ResourcesServices=bizagi.editor.base.services.resourcesServices;t._editorInfo=bizagi.editor.base.info},processRequest:function(){var n=this,i=new $.Deferred,t,r;return n.buildRequest(),n.parameters.push(n.createParameterItem("guidContext",BIZAGI_IDENTIFIER_MODEL)),n.parameters.push(n.createParameterItem("user",BIZAGI_USER)),t=n.requestForBAS(),r=n.callRestService(t)||bizagi.editor.base.HostFacade.executeBasActions(t),$.when(r).done(function(t){i.resolve(n.processBasAnswer(t))}),i.promise()},processBasAnswer:function(n){return n},createParameterItem:function(n,t){var i={};return i.key=n,i.value=t,i},requestForBAS:function(){var t=this,n={};return n.actiontype=t.actiontype,n.parameters=t.parameters,n},buildRequest:function(){var n=this;n.parameters=[]},callRestService:function(n){var t=this;return t.context=="adhocform"?t._ResourcesServices.getResource(n):!t._editorInfo.isCloud()&&t._ResourcesServices.getResource(n)},findKeyInParameters:function(n){for(var i=this,r=null,t=0,u=i.answerParameters.length;t<u;t+=1)i.answerParameters[t].key===n&&(r=i.answerParameters[t]);return r}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.ruleexpression",{},{init:function(n){var t=this;t._super(n);t.rule=t.args.data.rule||t.args.data;t.actiontype="LoadExpression"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("categorytype",n.args.categorytype));n.isNewExpression()||n.parameters.push(n.createParameterItem("id",n.rule.baref.ref));n.args.idcontextentity&&n.parameters.push(n.createParameterItem("idcontextentity",n.args.idcontextentity))},isNewExpression:function(){var n=this;return n.rule.baref.ref==="expression"},processBasAnswer:function(n){var t=this,i,e=t.args,u=n.result,r,f;if(u.success)return(t.answerParameters=u.parameters,i=t.findKeyInParameters("id"),bizagi.util.isEmpty(i.value))?{isEmpty:!0}:(r=t.findKeyInParameters("displayname")&&t.findKeyInParameters("displayname").value||null,f=e.editor=="rule"?bizagi.editor.utilities.buildComplexReference(i.value,r):t.buildRuleDefinition(i.value,r),f)},buildRuleDefinition:function(n,t){var i={rule:{baref:{ref:n}}};return t&&(i.rule.displayName=t),i}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadinterface",{},{init:function(n){var t=this;t._super(n);t.interface=t.args.data.interface||t.args.data;t.actiontype="LoadInterface"},buildRequest:function(){var n=this;n.parameters=[];n.isNewExpression()||n.parameters.push(n.createParameterItem("id",n.interface.baref.ref));n.args.idcontextentity&&n.parameters.push(n.createParameterItem("idcontextentity",n.args.idcontextentity));n.args.idscopedefinition&&n.parameters.push(n.createParameterItem("idscopedefinition",n.args.idscopedefinition))},isNewExpression:function(){var n=this;return n.interface.baref.ref==="expression"},processBasAnswer:function(n){var t=this,i,r=n.result;if(r.success){if(t.answerParameters=r.parameters,i=t.findKeyInParameters("id"),bizagi.util.isEmpty(i.value))return{isEmpty:!0};var u=t.findKeyInParameters("displayname")&&t.findKeyInParameters("displayname").value||null,f=t.args.type;return f.indexOf("rule")>=0?bizagi.editor.utilities.buildComplexReference(i.value,u):t.buildRuleDefinition(i.value,u)}},buildInterfaceDefinition:function(n,t){var i={baref:{ref:n}};return t&&(i.displayName=t),i}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadtemplate",{},{init:function(n){var t=this;t._super(n);t.template=t.args.template;t.actiontype="LoadTemplate"},buildRequest:function(){var n=this;n.parameters=[];n.isNewTemplate()||n.parameters.push(n.createParameterItem("id",n.template.baref.ref))},isNewTemplate:function(){var n=this;return n.template.baref.ref==="template"},processBasAnswer:function(n){var r=this,t,i=n.result;return i.success?(r.answerParameters=i.parameters,t=r.findKeyInParameters("id"),bizagi.util.isEmpty(t.value))?{isEmpty:!0}:bizagi.editor.utilities.buildComplexReference(t.value):i.sucess}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadsapinterface",{},{init:function(n){var t=this;t._super(n);t.interface=t.args.data.interface||t.args.data;t.actiontype="LoadSapInterface"},buildRequest:function(){var n=this;n.parameters=[];n.isNewExpression()||n.parameters.push(n.createParameterItem("id",n.interface.baref.ref));n.args.idcontextentity&&n.parameters.push(n.createParameterItem("idcontextentity",n.args.idcontextentity));n.args.idscopedefinition&&n.parameters.push(n.createParameterItem("idscopedefinition",n.args.idscopedefinition))},isNewExpression:function(){var n=this;return n.interface.baref.ref==="expression"},processBasAnswer:function(n){var t=this,i,r=n.result;if(r.success){if(t.answerParameters=r.parameters,i=t.findKeyInParameters("id"),bizagi.util.isEmpty(i.value))return{isEmpty:!0};var u=t.findKeyInParameters("displayname")&&t.findKeyInParameters("displayname").value||null,f=t.args.type;return f.indexOf("rule")>=0?bizagi.editor.utilities.buildComplexReference(i.value,u):t.buildRuleDefinition(i.value,u)}},buildInterfaceDefinition:function(n,t){var i={baref:{ref:n}};return t&&(i.displayName=t),i}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadconnectorinterface",{},{init:function(n){var t=this;t._super(n);t.connector=t.args.data.connector||t.args.data;t.actiontype="LoadConnectorInterface"},buildRequest:function(){var n=this;n.parameters=[];n.isNewExpression()||n.parameters.push(n.createParameterItem("id",n.connector.baref.ref));n.args.idcontextentity&&n.parameters.push(n.createParameterItem("idcontextentity",n.args.idcontextentity))},isNewExpression:function(){var n=this;return n.connector.baref.ref==="expression"},processBasAnswer:function(n){var t=this,i,r=n.result;if(r.success){if(t.answerParameters=r.parameters,i=t.findKeyInParameters("id"),bizagi.util.isEmpty(i.value))return{isEmpty:!0};var u=t.findKeyInParameters("displayname")&&t.findKeyInParameters("displayname").value||null,f=t.args.type;return f.indexOf("rule")>=0?bizagi.editor.utilities.buildComplexReference(i.value,u):t.buildRuleDefinition(i.value,u)}},buildInterfaceDefinition:function(n,t){var i={baref:{ref:n}};return t&&(i.displayName=t),i}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadfilter",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadFilterEditor";t.bafilter=t.args.data.bafilter;t.xpathNode=t.args.xpathNode},buildRequest:function(){var n=this,t,i;n.parameters=[];n.isNewExpression()||(t=n.createParameterItem("filter",bizagi.util.unicode2htmlencode(n.bafilter.filter)),n.parameters.push(t));n.args.idcontextentity&&n.parameters.push(n.createParameterItem("idcontextentity",n.args.idcontextentity));i=n.createParameterItem("idrelatedentity",n.xpathNode.guidRelatedEntity);n.parameters.push(i)},isNewExpression:function(){var n=this;return n.bafilter.filter==="filter"?!0:!1},processBasAnswer:function(n){var r=this,t,i=n.result;return i.success?(r.answerParameters=i.parameters,t=r.findKeyInParameters("filter"),bizagi.util.isEmpty(t.value))?{isEmpty:!0}:t.value:i.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadform",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadForm";t.params=n},buildRequest:function(){var n=this,t=n.params,i=n.createParameterItem("id",bizagi.editor.utilities.resolveComplexReference(t.form));n.parameters=[];n.parameters.push(i);t.loadByParent&&n.parameters.push(n.createParameterItem("loadByParent",t.loadByParent));t.adhocProcessId&&t.isAdhocSummaryForm&&(n.parameters.push(n.createParameterItem("adhocProcessId",t.adhocProcessId)),n.parameters.push(n.createParameterItem("isAdhocSummaryForm",t.isAdhocSummaryForm)))},processBasAnswer:function(n){var t=this,i,r=n.result;return r.success?(t.answerParameters=r.parameters,i=t.findKeyInParameters("form"),JSON.parse(i.value)):!1}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.gettags",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetTags"},buildRequest:function(){var n=this;n.parameters=n.args.parameters||[]},processBasAnswer:function(n){var t=n.result;return t.success?t.parameters:t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getmetadata",{context:/\.(\w+)$/},{init:function(n){var t=this;t._super(n);t.actiontype="GetMetadata"},buildRequest:function(){var n=this,t,i;n.parameters=[];t=this.Class.context.exec(n.args.xpath);i=t?t[1]:"";n.parameters.push(n.createParameterItem("context",i))},processBasAnswer:function(n){var i=this,r,t=n.result;return t?t.success?(i.answerParameters=t.parameters,r=i.findKeyInParameters("data"),JSON.parse(r.value)):t.success:n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.opennestedform",{},{init:function(n){var t=this;t._super(n);t.actiontype="OpenNestedForm";t.refForm=t.args.refForm},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("id",n.refForm.baref.ref));n.parameters.push(n.createParameterItem("guidRender",n.args.idForm))}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.relatedentity",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadEntityValues";t.xpath=bizagi.editor.utilities.resolveComplexXpath(n.xpath)},buildRequest:function(){var n=this,t;n.parameters=[];t=n.createParameterItem("xpath",n.replaceFilterCollectionInXpath());n.parameters.push(t)},processBasAnswer:function(n){var i=this,r,t;return n?(t=n.result,t.success)?(i.answerParameters=t.parameters,r=i.findKeyInParameters("values"),i.transformResult(JSON.parse(r.value))):t.success:{}},replaceFilterCollectionInXpath:function(){var n=this;return n.args.xpath.replace("[]","")},transformResult:function(n){for(var i={},t=0,r=n.length;t<r;t+=1)i[n[t].id]=n[t].displayName;return i}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.createform",{},{init:function(n){var t=this;t._super(n);t.actiontype="CreateForm"},buildRequest:function(){var n=this;n.parameters=[];n.args.xpath&&n.parameters.push(n.createParameterItem("xpath",n.args.xpath));n.args.relatedEntity&&n.parameters.push(n.createParameterItem("relatedEntity",n.args.relatedEntity));n.args.isScopeAttribute&&n.parameters.push(n.createParameterItem("isScopeAttribute",n.args.isScopeAttribute));n.args.showForm&&n.parameters.push(n.createParameterItem("showForm",n.args.showForm));n.parameters.push(n.createParameterItem("guidRender",n.args.guid));n.parameters.push(n.createParameterItem("propertyName",n.args.propertyName));n.parameters.push(n.createParameterItem("context",n.args.context))}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.multilanguage",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadLocalizationForm"},buildRequest:function(){var n=this,t;n.parameters=[];t=n.createParameterItem("values",bizagi.util.unicode2htmlencode(JSON.stringify(n.args.i18n)));n.parameters.push(t)},processBasAnswer:function(n){var i=this,r,t=n.result;return t.success?(i.answerParameters=t.parameters,r=i.findKeyInParameters("localization"),JSON.parse(r.value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.relatedforms",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetReleatedEntityForms"},buildRequest:function(){var n=this;n.parameters=[];n.args.xpath&&n.parameters.push(n.createParameterItem("xpath",n.args.xpath));n.args.relatedEntity&&n.parameters.push(n.createParameterItem("relatedEntity",n.args.relatedEntity));n.args.isScopeAttribute&&n.parameters.push(n.createParameterItem("isScopeAttribute",n.args.isScopeAttribute));n.parameters.push(n.createParameterItem("context",n.args.context))},processBasAnswer:function(n){var i=this,r,t=n.result;return t?t.success?(i.answerParameters=t.parameters,r=i.findKeyInParameters("forms"),JSON.parse(r.value)):t.success:n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.gridvalidations",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadGridValidations"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("xpath",n.args.xpath));n.parameters.push(n.createParameterItem("guidRender",n.args.guidRender));bizagi.editor.utilities.isObject(n.args.gridValidations)&&n.args.gridValidations.validations&&n.parameters.push(n.createParameterItem("validations",bizagi.util.unicode2htmlencode(JSON.stringify(n.args.gridValidations))))},processBasAnswer:function(n){var i=this,t=n.result,r;return t?t.success?(i.answerParameters=t.parameters,r=i.findKeyInParameters("validations"),JSON.parse(r.value)):t.success:n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getcontrolsdefinitions",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetControlDefinitions"},buildRequest:function(){var n=this;n.parameters=[]},processBasAnswer:function(n){var i=this,t=n.result;return t.success?(i.answerParameters=t.parameters,JSON.parse(i.findKeyInParameters("definitions").value)):t.success},processRequest:function(){var t=this,n=new $.Deferred;return $.when(bizagi.editor.base.protocol.base.prototype.processRequest.apply(t,arguments)).done(function(t){definitions=t;n.resolve(definitions)}),n.promise()}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getlayoutsdefinitions",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetLayoutDefinitions"},processBasAnswer:function(n){var i=this,t=n.result;return t.success?(i.answerParameters=t.parameters,JSON.parse(i.findKeyInParameters("layouts").value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getentitytype",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetEntityType"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("EntityGuid",n.args.entityGuid))},processBasAnswer:function(n){var i=this,t=n.result;return t?t.success?(i.answerParameters=t.parameters,{entityType:i.findKeyInParameters("entityType").value}):t.success:n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getdependency",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetDependency"},processBasAnswer:function(n){var i=this,t=n.result;return t?t.success?(i.answerParameters=t.parameters,bizagi.util.parseBoolean(i.findKeyInParameters("canBeChanged").value)):t.success:n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getfirstload",{},{init:function(n){var t=this;t._super(n);t.actiontype="XpathNavigatorFirstLoad"},buildRequest:function(){var n=this;n.parameters=[];n.args.adhocProcessId&&n.parameters.push(n.createParameterItem("adhocProcessId",n.args.adhocProcessId))},processBasAnswer:function(n){var i=this,t=n.result;return t.success?(i.answerParameters=t.parameters,JSON.parse(i.findKeyInParameters("root").value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getchildrennodes",{},{init:function(n){var t=this;t._super(n);t.actiontype="XpathNavigatorExpandLoad"},buildRequest:function(){var n=this,t=n.args.node,i=t.xpath;t.isRootNode&&(i="");n.parameters=[];n.parameters.push(n.createParameterItem("contextScope",t.contextScope));n.parameters.push(n.createParameterItem("guid",t.guidRelatedEntity));n.parameters.push(n.createParameterItem("xpath",i));n.parameters.push(n.createParameterItem("style",t.style));n.parameters.push(n.createParameterItem("isScopeAttribute",t.isScopeAttribute));t.entityContext&&n.parameters.push(n.createParameterItem("entityContext",t.entityContext));t.xpathAdhoc&&n.parameters.push(n.createParameterItem("xpathAdhoc",t.xpathAdhoc))},processBasAnswer:function(n){var i=this,t=n.result;return t.success?(i.answerParameters=t.parameters,JSON.parse(i.findKeyInParameters("children").value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.selectprocess",{},{init:function(n){var t=this;t._super(n);t.actiontype="SelectProcess"},buildRequest:function(){var n=this},processBasAnswer:function(){var n=this}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.editentity",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadEditEntity"},buildRequest:function(){var n=this,t;n.parameters=[];t=n.createParameterItem("id",n.args.id);n.parameters.push(t)},processBasAnswer:function(n){if(n&&n.result)return n.result.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.openform",{},{init:function(n){var t=this;t._super(n);t.actiontype="OpenForm"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("id",n.args.idform))}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.saveform",{},{init:function(n){var t=this;t._super(n);t.actiontype="SaveForm"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("json",bizagi.util.unicode2htmlencode(JSON.stringify(n.args.jsonForm))));(n.args.adhocTaskId||n.args.isAdhocSummaryForm)&&(n.parameters.push(n.createParameterItem("adhocTaskId",n.args.adhocTaskId)),n.parameters.push(n.createParameterItem("adhocProcessId",n.args.adhocProcessId)),n.parameters.push(n.createParameterItem("isAdhocSummaryForm",n.args.isAdhocSummaryForm)))}});
bizagi.editor=bizagi.editor||{};bizagi.editor.communicationprotocol=bizagi.editor.communicationprotocol||{};bizagi.editor.communicationprotocol.factory=function(){return{setContext(n){this.context=n},createProtocol:function(n){if(typeof n.protocol=="undefined")throw"The argument must contain a protocol to create the protocol instance";try{var t=eval("var bafn = function(args) {  return new bizagi.editor.base.protocol."+n.protocol+"(args);};bafn"),arguments=n.context?n:$.extend(n,{context:this.context});return t(arguments)}catch(r){throw"Can't create a protocol for "+n.protocol;}}}}();
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.copyform",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadCopyForm"},processBasAnswer:function(n){var r=this,u=n.result,t,i;return u.success?(r.answerParameters=u.parameters,t=r.findKeyInParameters("form"),i=r.findKeyInParameters("buttons"),t=JSON.parse(t.value),i&&(i=JSON.parse(i.value),t.buttons=i.buttons),t):u.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.editentityvalues",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadEditEntityValues"},buildRequest:function(){var n=this,t;n.parameters=[];t=n.createParameterItem("id",n.args.id);n.parameters.push(t)},processBasAnswer:function(n){if(n&&n.result)return n.result.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.newform",{},{init:function(n){var t=this;t._super(n);t.actiontype="CreateFormFromXpath"},buildRequest:function(){var n=this,t=n.args.node;n.parameters=[];n.parameters.push(n.createParameterItem("context",t.contextScope));n.parameters.push(n.createParameterItem("isScopeAttribute",t.isScopeAttribute));n.parameters.push(n.createParameterItem("idContextEntity",t.guidRelatedEntity));n.parameters.push(n.createParameterItem("guidForm",t.id))}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.documenttemplates",{},{init:function(n){var t=this;t._super(n);t.actiontype="LoadDocumentTemplates"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("append",n.args.append));n.parameters.push(n.createParameterItem("xpath",n.args.xpath));n.args.idContextEntity&&n.parameters.push(n.createParameterItem("idContextEntity",n.args.idContextEntity));n.args.groupmapping&&n.parameters.push(n.createParameterItem("groupmapping",bizagi.editor.utilities.resolveComplexReference(n.args.groupmapping)))},processBasAnswer:function(n){var i=this,r,t=n.result;return t.success?(i.answerParameters=t.parameters,r=i.findKeyInParameters("id"),r.value):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.availablelanguages",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetAvailableLanguages"},processBasAnswer:function(n){var t=n.result;return t.success?t.parameters:t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.installwidget",{},{init:function(n){var t=this;t._super(n);t.actiontype="InstallWidget"},processBasAnswer:function(n){var i=this,t=n.result;return t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.openwidgetstore",{},{init:function(n){var t=this;t._super(n);t.actiontype="OpenWidgetstore"},processBasAnswer:function(n){var t=n.result;return t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getwidgets",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetWidgets"},buildRequest:function(){var n=this;n.parameters=[]},processBasAnswer:function(n){var t=this,i=n.result;return i.success?(t.answerParameters=i.parameters,t.findKeyInParameters("widgets")?JSON.parse(t.findKeyInParameters("widgets").value):!1):i.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.closeform",{},{init:function(n){var t=this;t._super(n);t.actiontype="CloseForm"}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getmultiplerelationship",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetMultipleRelationship"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("leftEntityId",n.args.leftEntityId));n.args.rightEntityId&&n.parameters.push(n.createParameterItem("rightEntityId",n.args.rightEntityId))},processBasAnswer:function(n){var t=this,u=n.result,i,r;return u.success?(t.answerParameters=u.parameters,i=[],t.findKeyInParameters("leftfact")&&(i=t.findKeyInParameters("leftfact").value,i=JSON.parse(i)),r=[],t.findKeyInParameters("rightfact")&&(r=t.findKeyInParameters("rightfact").value,r=JSON.parse(r)),{leftfact:i,rightfact:r}):u.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.verifyletters",{},{init:function(n){var t=this;t._super(n);t.actiontype="VerifyLetters"},processBasAnswer:function(n){var r=this,i=n.result,t;return i.success?(r.answerParameters=i.parameters,t=bizagi.util.parseBoolean(r.findKeyInParameters("hasLetters").value),(t===undefined||t===null)&&(t=!0),{letter:!t,columnletter:!t}):i.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getparententities",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetParentEntities"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("id",n.args.id));n.parameters.push(n.createParameterItem("xpath",n.args.xpath))},processBasAnswer:function(n){var r=this,i,t;return n?(t=n.result,t.success)?(r.answerParameters=t.parameters,i=r.findKeyInParameters("values"),bizagi.util.isEmpty(i.value))?{isEmpty:!0}:JSON.parse(i.value):t.success:{}}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getattributedisplayname",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetAttributeDisplayName"},buildRequest:function(){var n=this,t;n.parameters=[];n.parameters.push(n.createParameterItem("xpathattribute",bizagi.editor.utilities.resolveComplexXpath(n.args.xpath)));n.parameters.push(n.createParameterItem("guidentity",n.geGuidEntity()));t=n.isScope();n.parameters.push(n.createParameterItem("isscope",t));bizagi.editorLanguage.key!=="default"&&n.parameters.push(n.createParameterItem("language",bizagi.editorLanguage.displayname));t&&n.parameters.push(n.createParameterItem("scopeDefinition",bizagi.editor.utilities.resolveScopeContextFromXpath(n.args.xpath)))},processBasAnswer:function(n){var i=this,t=n.result;return t?t.success?(i.answerParameters=t.parameters,{displayName:i.findKeyInParameters("displayname").value,defaultValue:i.findKeyInParameters("default").value}):t.success:n},geGuidEntity:function(){var n=this;return bizagi.editor.utilities.resolveContextEntityFromXpath(n.args.xpath)||bizagi.editor.utilities.resolveScopeContextFromXpath(n.args.xpath)},isScope:function(){var n=this;return bizagi.editor.utilities.resolveScopeContextFromXpath(n.args.xpath)?!0:!1}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getmetadataattributedisplayname",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetMetadataAttributeDisplayName"},buildRequest:function(){var n=this,t;n.parameters=[];t=bizagi.editor.utilities.resolveComplexXpath(n.args.xpath);t=t.replace(/\./g,"_").replace("@","");n.parameters.push(n.createParameterItem("xpathattribute",t));bizagi.editorLanguage.key!=="default"&&n.parameters.push(n.createParameterItem("language",bizagi.editorLanguage.displayname))},processBasAnswer:function(n){var i=this,t=n.result;return t?t.success?(i.answerParameters=t.parameters,{displayName:i.findKeyInParameters("displayname").value,defaultValue:i.findKeyInParameters("default").value}):t.success:n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getruledisplayname",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetRuleDisplayName"},buildRequest:function(){var n=this,t;n.parameters=[];t=n.args.rule?bizagi.editor.utilities.resolveComplexReference(n.args.rule):n.args.guid;n.parameters.push(n.createParameterItem("guidRule",t))},processBasAnswer:function(n){var i=this,t=n.result;return t?t.success?(i.answerParameters=t.parameters,{displayName:i.findKeyInParameters("displayname").value}):t.success:n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getformdisplayname",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetFormDisplayName"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("guidForm",n.args.guid))},processBasAnswer:function(n){var i=this,t=n.result;return t?t.success?(i.answerParameters=t.parameters,{displayName:i.findKeyInParameters("displayname").value}):t.success:n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.checkflags",{},{init:function(n){var t=this;t._super(n);t.actiontype="CheckFlags"},buildRequest:function(){var n=this,t,i;if(n.parameters=[],t=n.args.flags,!!t)for(i in t)n.parameters.push(n.createParameterItem(i,!0))},processBasAnswer:function(n){var f=this,t=n.result,r,i,u;if(t.success){for(r={},i=0,u=t.parameters.length;i<u;i++)r[t.parameters[i].key]=bizagi.util.parseBoolean(t.parameters[i].value);return f.processFlags(r)}return t.success},processFlags:function(n){return n.EnableGroupedGridControl!==undefined&&(n.groupedgrid=!n.EnableGroupedGridControl),n.EnableCollectionNavigatorControl!==undefined&&(n.collectionnavigator=!n.EnableCollectionNavigatorControl),n.EnableAssociationControl!==undefined&&(n.association=!n.EnableAssociationControl),n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.checkoutform",{},{init:function(n){var t=this;t._super(n);t.actiontype="CheckoutForm"},buildRequest:function(){var n=this;n.parameters=[];n.args.loadForm&&n.parameters.push(n.createParameterItem("loadForm",!0))},processBasAnswer:function(n){var t=this,u=n.result,f,i,r;return u.success?(t.answerParameters=u.parameters,f=t.findKeyInParameters("userInfo")?bizagi.util.parseBoolean(t.findKeyInParameters("isInCheckout").value):!1,i=null,t.findKeyInParameters("userInfo")&&(i=t.findKeyInParameters("userInfo").value,i=JSON.parse(i)),r=null,t.findKeyInParameters("form")&&(r=t.findKeyInParameters("form").value,r=JSON.parse(r)),{isInCheckout:f,userInfo:i,form:r}):u.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getstatusform",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetStatusForm"},processBasAnswer:function(n){var i=this,t=n.result,r;return t.success?(i.answerParameters=t.parameters,r=bizagi.util.parseBoolean(i.findKeyInParameters("isInCheckout").value),{isInCheckout:r}):t.success},processFlags:function(n){return n.EnableGroupedGridControl!==undefined&&(n.groupedgrid=!n.EnableGroupedGridControl),n.EnableCollectionNavigatorControl!==undefined&&(n.collectionnavigator=!n.EnableCollectionNavigatorControl),n}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getcontrolsdisabled",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetControlsDisabled"},processBasAnswer:function(n){var f=this,t=n.result,i,r,u;if(t.success){if(i={},t.parameters)for(r=0,u=t.parameters.length;r<u;r++)i[t.parameters[r].key]=!bizagi.util.parseBoolean(t.parameters[r].value);return f.args.context==="startform"&&(i.actionlauncher=!0,i.polymorphiclauncher=!0),i}return t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getstakeholders",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetStakeHolders"},processBasAnswer:function(n){var i=this,t=n.result;return t.success?(i.answerParameters=t.parameters,itemParameter=i.findKeyInParameters("stakeholders"),JSON.parse(itemParameter.value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.gettemplates",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetTemplatesByEntity"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("entityGuid",n.args.entityGuid))},processBasAnswer:function(n){var i=this,t=n.result;return t.success?(i.answerParameters=t.parameters,itemParameter=i.findKeyInParameters("templates"),JSON.parse(itemParameter.value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.switchform",{init:function(n){var t=this;t._super(n);t.actiontype="SwitchForm"},buildRequest:function(){},processBasAnswer:function(){}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.setuseoffline",{init:function(n){var t=this;t._super(n);t.actiontype="SetUseOffline"},buildRequest:function(){var n=this,t;n.parameters=[];t=n.createParameterItem("value",n.args.value);n.parameters.push(t)},processBasAnswer:function(n){return n.result}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.showwizardtemplates",{},{init:function(n){var t=this;t._super(n);t.actiontype="OpenWizardTemplates"},buildRequest:function(){var n=this,t=n.args;n.parameters=[];t.xpath&&n.parameters.push(n.createParameterItem("xpath",t.xpath));t.relatedEntity&&n.parameters.push(n.createParameterItem("relatedEntity",t.relatedEntity));t.isScopeAttribute&&n.parameters.push(n.createParameterItem("isScopeAttribute",t.isScopeAttribute));t.guidControl&&n.parameters.push(n.createParameterItem("guidControl",t.guidControl));t.propertyName&&n.parameters.push(n.createParameterItem("propertyName",t.propertyName))}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getadhocdataschema",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetAdhocDataSchema"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("adhocProcessId",n.args.adhocProcessId))},processBasAnswer:function(n){var i=this,t=n.result;return t.success&&t.parameters.length>0?(i.answerParameters=t.parameters,itemParameter=i.findKeyInParameters("dataSchema"),JSON.parse(itemParameter.value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getadhocdatasources",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetAdhocDataSources"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("adhocProcessId",n.args.adhocProcessId))},processBasAnswer:function(n){var i=this,t=n.result;return t.success&&t.parameters.length>0?(i.answerParameters=t.parameters,itemParameter=i.findKeyInParameters("dataSources"),JSON.parse(itemParameter.value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getadhocentityattribs",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetAdhocEntityAttribs"},buildRequest:function(){var n=this;n.parameters=n.args.parameters||[]},processBasAnswer:function(n){var i=this,t=n.result;return t.success&&t.parameters.length>0?(i.answerParameters=t.parameters,itemParameter=i.findKeyInParameters("attributes"),JSON.parse(itemParameter.value)):t.success}});
bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getpredefinedvalues",{},{init:function(n){var t=this;t._super(n);t.actiontype="GetPredefinedValues"},buildRequest:function(){var n=this;n.parameters=[];n.parameters.push(n.createParameterItem("adhocProcessId",n.args.adhocProcessId));n.parameters.push(n.createParameterItem("property",n.args.property))},processBasAnswer:function(n){var i=this,t=n.result;return t.success&&t.parameters.length>0?(i.answerParameters=t.parameters,itemParameter=i.findKeyInParameters("predefinedValues"),itemParameter.value):t.success}});
$.Controller("bizagi.editor.component.controller",{init:function(){this.observableElement=$({});this.tmpl={}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){this.observableElement.triggerHandler.apply(this.observableElement,arguments)},loadTemplate:function(n,t){var i=this,r=new $.Deferred;if(i.tmpl[n])r.resolve();else return bizagi.templateService.getTemplate(t).done(function(t){i.tmpl[n]=t});return r.promise()},loadTemplates:function(n){var r=this,t=new $.Deferred,i=[];return $.each(n,function(n,t){var u=r.loadTemplate(n,t);i.push(u)}),$.when.apply($,i).done(function(){t.resolve()}),t.promise()},getTemplate:function(n){return this.tmpl[n]?this.tmpl[n]:null}});
bizagi.editor.component.controller("bizagi.editor.component.layout",{init:function(n,t){t=t||{};this._super(n);this.model=t.model;this.canvas=n;this.presenter=t.presenter;this.context=t.context;this.isActivityForm=t.isActivityForm},loadTemplates:function(){var n={frames:bizagi.getTemplate("bizagi.editor.component.layout").concat("#layout-frames"),tabs:bizagi.getTemplate("bizagi.editor.component.layout").concat("#layout-left-tabs")};return this._super(n)},refresh:function(){this.render()},render:function(){var n=this;return $.when(n.loadTemplates()).done(function(){n.renderFrames(n.element);n.leftPanel=n.element.find("#left-panel");n.applyThemeToLayout();window.myResize=n.applyThemeToLayout;$(window).bind("resize.windowPanel",window.myResize);n.renderTabs(n.leftPanel)})},applyThemeToLayout:function(){var f=this,i,u,n,r,t;t=$("#left-panel");n=$(".wrapper-left-panel");r=$("form-modeler").height()-(parseFloat(n.css("margin-top"))-n.position().top);n.css("height",r);i=parseFloat(t.css("margin-top"))+parseFloat(t.css("margin-bottom"));u=n.height()-i-(parseFloat(n.css("padding-top"))+parseFloat(n.css("padding-bottom")));$(".ui-tabs-panel",t).addClass("ui-resized")},renderFrames:function(n){var t=this,i=$.tmpl(t.getTemplate("frames"),{context:t.context,isActivityForm:t.isActivityForm});i.appendTo(n)},renderTabs:function(n){var t=$.tmpl(this.getTemplate("tabs"));t.appendTo(n)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.layout.presenter",{},{init:function(n){var t=this;t._super();n=n||{};t.layout=new bizagi.editor.component.layout(n.canvas,{model:n.model,presenter:t,context:n.context,isActivityForm:n.isActivityForm})},render:function(n){var t=this;return t.layout.render(n)}});
bizagi.editor.component.controller("bizagi.editor.component.dialog",{},{init:function(n,t){var i=this;i._super();t=t||{};i.canvas=n;i.model=t.model;i.presenter=t.presenter},loadTemplates:function(){var n=this,t={"content-dialog":bizagi.getTemplate("bizagi.editor.component.dialog").concat("#dialog-container")};return n._super(t)},render:function(){var n=this,t=n.element;t.empty();$.when(n.loadTemplates()).done(function(){var i=n.dialogTemplate=n.getTemplate("content-dialog");$.tmpl(i,n.model.getModel()).appendTo(t)})},destroy:function(n){var t=this;t.element.detach();t.publish("close",n)},".bz-fm-dialog-button  click":function(n){var t=this,i=n.data("key"),r;i&&(r=t.model.getClickEvent(i));t.destroy(r)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.dialog.model",{},{init:function(n){var t=this;t._super();t.events={};t.processData(n)},processData:function(n){var t=this;t.model=n;n.buttons&&$.each(n.buttons,function(n,i){i.icon=i.text?i.text.toLowerCase():"";i.style=i.style?i.style:"";typeof i.click=="function"&&(t.events[i.text]=i.click)})},getModel:function(){return this.model},getName:function(){return this.model.name},getTitle:function(){return this.model.title},getStyle:function(){return this.model.style},getClickEvent:function(n){var t=this;return t.events[n]}});
bizagi.editor.observableClass.extend("bizagi.editor.component.dialog.presenter",{},{init:function(){this._super()},show:function(n){var t=this,r=new $.Deferred,i=new bizagi.editor.component.dialog.model(n.data),u=t.popup=bizagi.createPopup({name:i.getName(),container:"form-modeler",title:i.getTitle(),onClose:function(n){r.resolve(n)}});return t.dialog=new bizagi.editor.component.dialog(u.content,{model:i,presenter:t}),t.dialog.subscribe("close",function(n,i){t.onClose(i)}),t.dialog.render(),r.promise()},onClose:function(n){var t=this;t.popup.close(n)}});
bizagi.editor.component.controller("bizagi.editor.component.controlsnavigator",{init:function(n,t){var i=this;i._super();t=t||{};i.model=t.model;i.canvas=n;i.presenter=t.presenter;i.tmpl={}},render:function(n){var t=this;n=n||{};t.isReadOnly=n.isReadOnly!="undefined"?bizagi.util.parseBoolean(n.isReadOnly):!1;t.element.empty();$.when(t.loadTemplates()).done(function(){t.renderGroups(t.element,t.model.groups);t.isReadOnly||setTimeout(function(){t.setDraggableItems()},1e3);t.element.data().hasOwnProperty("ui-accordion")&&t.element.accordion("destroy");t.element.accordion({header:"> .mtool-group > .mtool-group-header",heightStyle:"content",collapsible:!0,active:!1})})},renderGroups:function(n,t){var i=this;$.each(t,function(t,r){var u=$.tmpl(i.getTemplate("group"),r);i.renderItems(u.find(".mtool-group-items"),r.items);u.appendTo(n)})},renderItems:function(n,t){var i=this;$.each(t,function(t,r){r.name=r.name.replace("column","");$.when(r.icon).done(function(t){r.icon=t;var u=$.tmpl(i.getTemplate("item"),r);u.data("render",{name:r.id,type:r.type,icon:t,displayName:r.name,style:r.style});u.appendTo(n)})})},loadTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.loadTemplate("group",bizagi.getTemplate("bizagi.editor.component.controlsnavigator").concat("#mtool-group")),n.loadTemplate("item",bizagi.getTemplate("bizagi.editor.component.controlsnavigator").concat("#mtool-item")),n.loadTemplate("helper",bizagi.getTemplate("bizagi.editor.component.controlsnavigator").concat("#mtool-helper"))).done(function(){t.resolve()}),t.promise()},setDraggableItems:function(){var n=this;$(".mtool-item").data("self",n);$(".mtool-item").draggable({helper:n.draggableHelper,connectToSortable:".ui-bizagi-container-connectedSortable.ui-bizagi-container",distance:15,start:function(t){var f,i,r,u,e,o;f=$(t.currentTarget);$("#main-panel").addClass("bz-main-dashed-grid");f.addClass("ui-dragging");i=$(".wrapper-main-panel");r=$("#main-panel",i);u=$(".wrapper-main-scroll",i);r.addClass("ui-start-drag");n.presenter.publish("controlRefreshCanvas",{});r.hasClass("biz-auto-height")&&(e=i.position().top+parseFloat(i.css("padding-top"))+parseFloat(i.css("margin-top"))+50,o=u.outerHeight(),bizagi.util.autoScroll(u,e,o,"controlsnavigator"))},stop:function(n){var t,i,r;t=$(n.currentTarget);r=$(this).data("self");i=$("#main-panel");i.removeClass("bz-main-dashed-grid").removeClass("ui-start-drag");t.removeClass("ui-dragging");bizagi.util.removeAutoScroll("autoscroll","controlsnavigator");r.presenter.publish("controlRefreshCanvas",{})},containment:"document"})},draggableHelper:function(n){var r,t=$(n.currentTarget),u="controls",f="Control",i;return t.addClass("ui-dragging"),u=t.data("id"),f=t.data("caption"),icon=t.data("render")&&t.data("render").icon,style=t.data("render")&&t.data("render").style,r=t.data("self"),i=$.tmpl(r.getTemplate("helper"),{id:u,caption:f,icon:icon,style:style}),i.appendTo("form-modeler").css({zIndex:900}),widthLabel=parseFloat($("label",i).width()),widthIcon=parseFloat($(".biz-ico",i).eq(0).width()),widthTotal=widthLabel+widthIcon+40+"px",i.css("width",widthTotal),i},updateModel:function(n){var t=this;t.model=n},".mtool-item dblclick":function(n){var u=this,t,r,i=n.data("render");u.presenter.publish("controlDoubleClick",{name:i.name,type:i.type,displayName:i.displayName});t=$(".wrapper-main-scroll");r=t[0].scrollHeight;t.scrollTop(r);elementLast=$(".ui-bizagi-container-form > div:last",t);bizagi.util.highLightElement(elementLast)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.controlsnavigator.presenter",{},{init:function(n){var t=this;t._super();n=n||{};t.canvas=n.canvas;t.model=n.model;t.controlsNavigator=new bizagi.editor.component.controlsnavigator(t.canvas,$.extend(n,{presenter:t}))},render:function(n){var t=this;return n=n||{},t.model=n.model||t.model,t.controlsNavigator.updateModel(t.model),t.controlsNavigator.render(n)}});
bizagi.editor.component.controller("bizagi.editor.component.banner",{init:function(n,t){var i=this;t=t||{};i._super(n);i.canvas=n;i.presenter=t.presenter;i.model=t.model;i.data=t.data;i.tmpl={}},updateModel:function(n){var t=this;t.model=n;t.update()},render:function(){var n=this;$.when(n.loadTemplates()).done(function(){n.element.show();n.element.empty();n.renderbanner(n.element,n.model)})},renderbanner:function(n,t){var i=this,r,u=t.banner.displayname,f=t.banner.icon,e=t.banner.cite;i.bannerModel=t;t.banner.on&&(r=$.tmpl(i.getTemplate("banner"),{caption:u,icon:f,cite:e}),n.css("position","relative"),n.append(r),$(".ui-tabs-panel",i.data.element).addClass("ui-wbanner-space-show"),(this.visibility="hide")&&i.hide())},remove:function(){this.element.hide();this.element.empty()},hide:function(){var n=this;n.visibility="hide";$(".ui-tabs-panel",n.data.element).removeClass("ui-wbanner-space-show").addClass("ui-wbanner-space-hide");n.element.hide()},show:function(){var n=this;n.visibility="show";$(".ui-tabs-panel",n.data.element).removeClass("ui-wbanner-space-hide").addClass("ui-wbanner-space-show");n.element.show("slow");n.element.css("overflow","visible")},loadTemplates:function(){var t=this,n=new $.Deferred;return $.when(t.loadTemplate("banner",bizagi.getTemplate("bizagi.editor.component.banner").concat("#banner-component"))).done(function(){n.resolve()}),n.promise()},destroy:function(){this.element.detach()},".bizagi-editor-banner-container click":function(n,t){var i=this;t.stopPropagation();i.presenter.publish("onBannerClick",{model:i.bannerModel,reference:i})}});
bizagi.editor.observableClass.extend("bizagi.editor.component.banner.presenter",{},{init:function(n){var t=this;n=n||{};t._super();t.canvas=n.canvas;t.model=n.model;t.bannerElement=n.data.element;t.banner=new bizagi.editor.component.banner(t.canvas,$.extend(n,{presenter:t}))},destroy:function(){this.banner.destroy()},remove:function(){this.banner.remove()},getBannerElement:function(){return this.bannerElement},render:function(n){var t=this;return n=n||{},t.model=n.model||t.setModel(),t.banner.updateModel(t.model),t.banner.render(n)},hide:function(){var n=this;n.banner.hide()},show:function(){var n=this;n.banner.show()},setModel:function(){var t=this,i=new bizagi.editor.component.banner.model,n=i.getBannerModel();return t.banner.updateModel(n),n}});
bizagi.editor.component.controller("bizagi.editor.component.editableLabel",{init:function(n,t){this._super(n);this.canvas=n;this.params=t;this.presenter=t.presenter},loadTemplates:function(){var n={editableLabel:bizagi.getTemplate("bizagi.editor.component.editablelabel")};return this._super(n)},render:function(){var n=this,t=n.params;$.when(n.loadTemplates()).done(function(){var r=n.editablelabel=$.tmpl(n.getTemplate("editableLabel"),{value:t.value});r.width(t.label.width());t.label.hide();t.label.after(r);var i=r.find("input"),u=t.value,f=r.width()-50;i.width(f);i.keyup(function(t){n.onInputKeyUp(i,t)});i.click(function(n){n.stopPropagation()});i.keydown(function(n){n.stopPropagation()});i.blur(function(t){t.stopPropagation();t.stopimmediatepropagation();n.onInputBlur(i,t)});$(".ui-bizagi-input-icon",r).mousedown(function(t){n.onIconClicked(i,t)});i.focus();i.val("");i.val(u)})},destroy:function(){var n=this,t=n.params;t.label.show();n.editablelabel.detach();this.element.detach()},onInputKeyUp:function(n,t){var i=this,r=n.val();if(t.keyCode===13){if(i.params.value===r){i.presenter.publish("keyup",{value:r,keyCode:t.keyCode});i.presenter.destroy();return}i.presenter.publish("change",{value:r});return}i.presenter.publish("keyup",{value:r,keyCode:t.keyCode})},onIconClicked:function(n,t){var i=this,r=n.val();$(".ui-bizagi-input-icon").data("iconClicked",!0);$(t.target).hasClass("ui-bizagi-input-icon-ok")&&i.params.value!==r&&i.presenter.publish("change",{value:r});i.presenter.destroy()},onInputBlur:function(n){var i=this,t;$(".ui-bizagi-input-icon").data("iconClicked")!=!0&&(t=n.val(),i.presenter.publish("change",{value:t}))}});
bizagi.editor.observableClass.extend("bizagi.editor.component.editableLabel.presenter",{},{init:function(n){this._super();n=n||{};this.canvas=n.canvas||$("<div />");this.editableLabel=new bizagi.editor.component.editableLabel(this.canvas,$.extend(n,{presenter:this}))},render:function(){var n=this;return n.editableLabel.render()},destroy:function(){var n=this;n.editableLabel&&(n.editableLabel.destroy(),n.editableLabel=null)}});
bizagi.editor.component.controller("bizagi.editor.component.properties",{listensTo:["outEditor"],events:{PROPERTIES_CHANGE_PROPERTY:"PropertyChange",PROPERTIES_CHANGE_LAYOUT:"PropertyChangeLayout",PROPERTIES_SELECT_EXPRESSION:"ShowRuleSelector",PROPERTIES_SHOW_LOCALIZATION:"ShowLocalization",PROPERTIES_CHANGE_MULTIPLE_PROPERTIES:"ChangeMultipleProperties",PROPERTIES_SELECT_EDITOR_DATALIST:"ShowFilterEditor",PROPERTIES_RULE_EDITOR_DEFAULTVALUE:"ShowRuleEditorForDefaultValue",PROPERTIES_SHOW_XPATH_GENERAL:"ShowXPathEditor",PROPERTIES_SHOW_INTERFACE:"ShowInterfaceEditor",PROPERTIES_SELECT_XPATH_FROM_ENTITY:"SelectXpathFromEntity",PROPERTIES_SHOW_GRID_VALIDATIONS:"ShowGridValidationsEditor",PROPERTIES_SELECT_XPATH_TO_SIMPLE:"SelectXpathToSimple",PROPERTIES_SELECT_XPATH_TO_ENTITY:"SelectXpathToEntity",PROPERTIES_SELECT_XPATH_TO_COLLECTION:"SelectXpathToCollection",PROPERTIES_SELECT_XPATH_MULTIPLE:"SelectMultiXpath",PROPERTIES_SELECT_XPATH:"SelectXpath",PROPERTIES_SELECT_FORM_OPTION:"SelectFormOption",PROPERTIES_SELECT_FORM_BUTTON:"SelectFormButton",PROPERTIES_SELECT_FORM_NEW:"SelectFormNew",PROPERTIES_SELECT_FORM_NONE:"SelectFormNone",PROPERTIES_SELECT_TEMPLATE_NONE:"SelectTemplateNone",PROPERTIES_SELECT_TEMPLATE_DEFAULT:"SelectTemplateDefault",PROPERTIES_SELECT_SEARCHFORM_OPTION:"SelectSearchformOption",PROPERTIES_SELECT_SEARCHFORM_BUTTON:"SelectSearchformButton",PROPERTIES_SELECT_SEARCHFORM_NEW:"SelectSearchformNew",PROPERTIES_SELECT_SEARCHFORM_NONE:"SelectSearchformNone",PROPERTIES_SHOW_DOCUMENT_TEMPLATES:"ShowDocumentTemplatesEditor",PROPERTIES_SHOW_ASSOCIATION_EDITOR:"ShowAssociationEditor",PROPERTIES_SHOW_WIZARD_TEMPLATES:"ShowWizardTemplates",PROPERTIES_SELECT_PROCESS:"SelectProcess",PROPERTIES_LOAD_METADATA:"LoadMetadata"}},{init:function(n,t){var i=this;i._super();t=t||{};i.canvas=n;i.model=t.model;i.presenter=t.presenter;t.adhocProcessId&&(i.adhocProcessId=t.adhocProcessId);i.presenter!==undefined&&i.presenter.subscribe("propertyEditorChanged",function(n,t){return i.onPropertyEditorChanged(t)})},loadTemplates:function(){var n={close:bizagi.getTemplate("bizagi.editor.component.properties").concat("#prop-close"),"frame-header":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-header"),"frame-header-name":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-header-name"),"content-frame":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-content-frame"),"frame-property":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-property"),"frame-group":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-group"),"frame-group-exclusive":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-group-exclusive"),"frame-category-simple":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-category-simple"),"frame-caption":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-caption")};return this._super(n)},render:function(n){var t=this,u,i=t.element,r;n=n||{};t.editorResponses=[];t.refProperties={};t.redraw=n.redraw?n.redraw:!1;t.groupsReferences={};n.model&&t.update(n.model);r=t.model=n.model||t.model;i.show();i.empty();i.data("id",r.idRender);t.propertySelected=n.propertySelected!==undefined?n.propertySelected:null;$.when(t.loadTemplates()).done(function(){t.renderCaption(i,r);t.renderClose(i);t.renderFrame(i,r);t.renderContent(i,r);u=t.getLastActiveTabForRender(n.model.idRender);t.idRender=n.model.idRender;t.scrollPanel=0;i.hasClass("ui-tabs")&&i.tabs("destroy");i.tabs();u&&(i.tabs({select:function(n,i){t.scrollPanelDiv=$(i.panel)}}),i.tabs("option","active",u.index));$(".ui-tabs-panel",i).bind("mousedown.panelselected",function(){var n=$(this).scrollTop();t.scrollPanel=n});i.tabs({select:function(n,i){t.setLastActiveTabForRender(t.idRender,i.index,t.scrollPanel)}});var f=t.Class.fullName.replace(/\./gi,"_");i.attr("id",f);t.addThemeStyle();t.configureAutoCloseHandler();$.when.apply($,t.editorResponses).done(function(){bizagi.util.highLightElement(t.element);t.selectOnProperty();r.validations!==undefined&&r.validations.length>0&&t.highLightOnProperties(r.validations);t.deselectTabLeftPanel();u.scrollRender>0&&t.scrollPanelDiv&&t.scrollPanelDiv.scrollTop(u.scrollRender);t.postRender()})})},postRender:function(){var t,n,i=this;for(t in i.refProperties)n=i.refProperties[t],n.postRender!==undefined&&n.postRender()},highLightOnProperties:function(n){for(var r=this,t,i=0;i<n.length;i++)t=n[i],r.refProperties[t.name]?r.refProperties[t.name].highLightProperty(t.message):console.error(t.name+" is not a register property")},getLastActiveTabForRender:function(n){var r=this,i={index:0,scrollRender:0},t=r.presenter.publish("getRenderElement",{id:n});return t=t?t.element||t.container:$("[data-id = "+n+"]").length>0?$("[data-id = "+n+"]"):$("[data-container-id = "+n+"]"),t&&(i=t.data("last-tab")||i),i},setLastActiveTabForRender:function(n,t,i){var u=this,r=u.presenter.publish("getRenderElement",{id:n});r=r?r.element||r.container:$("[data-id = "+n+"]").length>0?$("[data-id = "+n+"]"):$("[data-container-id = "+n+"]");r&&r.data("last-tab",{index:t,scrollRender:i})},selectOnProperty:function(){var n=this;n.propertySelected!==null&&n.propertyManager!==undefined&&n.propertyManager.selectEditor!==undefined&&n.propertyManager.selectEditor()},deselectTabLeftPanel:function(){var n=this;n.lastTabActive&&n.lastTabActive.removeClass("ui-tabs-selected ui-state-active")},selectTabLeftPanel:function(){var n=this;n.lastTabActive&&n.lastTabActive.addClass("ui-tabs-selected ui-state-active")},configureAutoCloseHandler:function(){var n=this;n.lastTabActive=$("#left-panel ul.ui-tabs-nav li.ui-tabs-active");$(document).bind("mousedown.properties",function(n){function i(i){var r=!0,e=$(i.target),u,f;for(u in t)if(t.hasOwnProperty(u)&&(f=t[u],typeof f=="function"&&(r&=f.call(t,e)),!r))break;r&&(n.lastTabActive&&n.selectTabLeftPanel(),n.destroy(),$(document).unbind("mousedown.properties"),$(window).unbind("resize.panel"))}var t={pickdate:function(n){return!$(".wpd").is(":visible")&&n.closest(".wpd").length===0},colorPicker:function(){return!$(".sp-container").is(":visible")},xpathNavigator:function(){return!$(".bizagi_editor_xpathnavigator_overlay").is(":visible")},properties:function(n){return n.closest(".bizagi_editor_component_properties").length===0},tooltipProp:function(n){return n.closest(".ui-propertybox-tooltip").length===0},warningsButton:function(n){return $(".ribbon-ico-validate",n).length>0?!1:!n.hasClass("ribbon-ico-validate")},saveButton:function(n){return!n.hasClass("ribbon-ico-save")},richText:function(n){return n.closest(".bz-fm-localizablestring-richtext-overlay").length===0},richTextColor:function(n){return n.closest(".mce-container").length===0}};return i}(n))},renderClose:function(n){var t=$.tmpl(this.getTemplate("close"));t.appendTo(n)},renderFrame:function(n,t){var u,i,f,e,r;for(r=t.elements[0].tabs||null,f=r!==null?r.length:-1,u=$.tmpl(this.getTemplate("frame-header"),{}),i=0;i<f;i++)r[i].machineName=this.camelCase(r[i].caption),e=$.tmpl(this.getTemplate("frame-header-name"),r[i]),e.appendTo(u);u.appendTo(n)},renderCaption:function(n,t){var r=this,i;i=$.tmpl(r.getTemplate("frame-caption"),{caption:t.renderCaption,ico:t.element.type,style:t.element.style});i.appendTo(n)},camelCase:function(n){return n.toLowerCase().replace(/\s+(.)/g,function(n,t){return t.toUpperCase()})},machineName:function(n){return n.toLowerCase().replace(/-/g,"")},renderContent:function(n,t){var i,r,f,u;for(r=t.elements[0].tabs||null,f=r!==null?r.length:-1,i=0;i<f;i++)r[i].machineName=this.camelCase(r[i].caption),u=$.tmpl(this.getTemplate("content-frame"),r[i]),this.renderElement(u,r[i].elements),u.appendTo(n)},renderElement:function(n,t){for(var r,u=this,i=0;i<t.length;i++){r=Object.keys(t[i])[0];switch(r){case"property":if(t[i].property.notShow!==undefined)break;else if(t[i].property.disable){delete t[i].property.disable;break}else this.renderProperty(n,t[i].property);break;case"category":this.renderCategory(n,t[i].category);break;case"group":this.renderGroup(n,t[i].group)}}u.setAsCollapsible(n)},renderProperty:function(n,t){var o=this,r,e,i,s,f,h,u;if(r=$.tmpl(this.getTemplate("frame-property"),{}),t.caption=t.caption?t.caption:"&raquo; "+t.name,o.adhocProcessId&&(t.adhocProcessId=o.adhocProcessId),t["bas-type"]=this.machineName(t["bas-type"]),t.subproperties===undefined)t["bas-type"]==="xpathmultiple"?(i=new bizagi.editor.component.editor[t["bas-type"]](r,t,this.presenter),r.appendTo(n)):/^.*xpath.*$/ig.test(t["bas-type"])?(i=new bizagi.editor.component.editor.xpath(r,t,this.presenter),r.appendTo(n)):(i=new bizagi.editor.component.editor[t["bas-type"]](r,t,this.presenter),r.appendTo(n),this.propertySelected!==null&&this.propertySelected==t.name&&(this.propertyManager=i)),u=i.render(),this.editorResponses.push(u),this.registerProperty(i);else if(/^.*xpath.*$/ig.test(t["bas-type"]))i=new bizagi.editor.component.editor.xpath(r,t,this.presenter),r.appendTo(n),u=i.render(),this.editorResponses.push(u),this.registerProperty(i);else if(bizagi.editor.component.editor[t["bas-type"]]===undefined){for(e=$.tmpl(this.getTemplate("frame-category-simple"),t),h=$(".ui-content",e),s=t.subproperties.length,f=0;f<s;f++)i=t.subproperties[f].property,this.renderProperty(h,i);e.appendTo(n)}else i=new bizagi.editor.component.editor[t["bas-type"]](r,t,this.presenter,{refProperties:this.refProperties}),r.appendTo(n),u=i.render(),this.editorResponses.push(u),this.registerProperty(i)},renderGroup:function(n,t){var a=this,e,h,i,u,o,r,c,s,f,l;if(h=t.elements.length,t.exclusive!==undefined)if(t.elements.length!=2)throw"There are more than two exclusives groups";else{for(r=bizagi.clone(t),r.guid===undefined&&(c=Math.guid(),$.extend(r,{guid:c}),a.groupsReferences[c]={data:r}),r.visibility!==undefined&&$.extend(r,{hidden:" properties-group-hidden"}),s=r.index!==undefined,f={},s?r.index===0?(f.check1="properties-group-radio-check",f.check2="properties-group-radio-uncheck biz-action-btn"):(f.check1="properties-group-radio-uncheck biz-action-btn",f.check2="properties-group-radio-check"):(f.check1="properties-group-radio-uncheck biz-action-btn",f.check2="properties-group-radio-uncheck biz-action-btn"),$.extend(r,f),e=$.tmpl(this.getTemplate("frame-group-exclusive"),r),u=$(".ui-content-group",e),i=0;i<h;i++){o=Object.keys(r.elements[i])[0];switch(o){case"property":if(r.elements[i].property.notShow!==undefined)break;else s?r.index==i&&this.renderProperty(u[i],r.elements[i].property):this.renderProperty(u[i],r.elements[i].property);break;case"group":s?r.index==i&&this.renderGroup(u[i],r.elements[i].group):this.renderGroup(u[i],r.elements[i].group)}}e.appendTo(n)}else{for(e=$.tmpl(this.getTemplate("frame-group"),t),u=$(".ui-content",e),i=0;i<h;i++){o=Object.keys(t.elements[i])[0];switch(o){case"property":if(t.elements[i].property.notShow!==undefined)break;else this.renderProperty(u,t.elements[i].property);break;case"group":this.renderGroup(u,t.elements[i].group)}}l=$(e).find(".ui-content");l.children().length>0&&e.appendTo(n)}},renderCategory:function(n,t){var o=this,r,u,i,f,e;for(u=t.elements.length,r=$.tmpl(this.getTemplate("frame-category-simple"),t),e=$(".ui-content",r),i=0;i<u;i++)f=t.elements[i].property,this.renderProperty(e,f);r.appendTo(n)},registerProperty:function(n){var t=this;t.refProperties[n.options.name]=n},setAsCollapsible:function(n){$("h3.ui-legend",n).unbind("click");$("h3.ui-legend",n).bind("click",function(n){n.stopPropagation();var t=$(this).next();t.is(":visible")?t.slideUp():t.slideDown()})},addThemeStyle:function(){var t=this,n=t.element;n.addClass("biz-work-panel");n.addClass("biz-border-all");n.addClass("biz-shadow-modal");n.addClass("biz-border-color");n.addClass("biz-modal");n.addClass("ui-corner-bottom");n.removeClass("ui-corner-all");$("ul.ui-widget-header",n).addClass("biz-gradient-v")},resizePanel:function(){var u=this,n,t,i,r,f;n=u.element;r=$("#left-panel");t=r.height()*.95;i=parseFloat($("> ul",n).height());f=(t-i)*.96;n.css({height:t})},destroy:function(){var n=this,t=n.element,i;t.hasClass("ui-tabs")&&(i=t.tabs("option","active"),n.setLastActiveTabForRender(n.idRender,i,n.scrollPanel),n.selectTabLeftPanel(),$(".sp-container").remove(),n.element.tabs("destroy"));n.element.hide()},onPropertyEditorChanged:function(n){var t=this;return n.typeEvent=n.typeEvent||bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,t.presenter.publish("propertyChanged",n)},".ui-properties-close .ui-close-btn click":function(){this.destroy()},".bizagi_editor_component_editor click":function(n){$(".bizagi_editor_component_editor",this.element).removeClass("editor-selected");n.addClass("editor-selected");n.trigger("outEditor",[n])},outEditor:function(n,t,i){$(".bizagi_editor_component_editor_booleanrule > div > span",n).removeClass("editor-arrow-down-enabled").addClass("editor-arrow-down-disabled");i.find("> div > span").removeClass("editor-arrow-down-disabled").addClass("editor-arrow-down-enabled");$(".bizagi_editor_component_editor_booleanrule .editor-options").removeClass("editor-options-enabled").addClass("editor-options-disabled")},".bizagi_editor_component_editor input focus":function(n){$(".bizagi_editor_component_editor",this.element).removeClass("editor-selected");n.closest(".bizagi_editor_component_editor").addClass("editor-selected")},".properties-category > span click":function(n){var t=n.next();n.toggleClass("close").toggleClass("open");t.slideToggle()},click:function(n,t){return t.stopPropagation(),!1},".properties-group-exclusive-header click":function(n){var r=this,t,i=n.closest(".properties-group-exclusive",n),u=i.parent(),f=$(".properties-group-exclusive-header",u),e=i.attr("data-guid"),o=f.index(n);i.remove();t=r.groupsReferences[e].data;$.extend(t,{index:o});r.renderGroup(u,t)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.properties.presenter",{},{init:function(n){var t=this;t._super();n=n||{};t.canvas=n.canvas||$("<div />").appendTo("form-modeler");t.propertyBox=new bizagi.editor.component.properties(t.canvas,$.extend(n,{presenter:t}))},destroy:function(){var n=this;n.propertyBox&&n.propertyBox.destroy();n.canvas&&n.canvas.remove();n.propertyBox=null;n.canvas=null},render:function(n){var t=this;t.propertyBox&&t.propertyBox.render(n)}});
bizagi.editor.component.properties.parser=function(){};bizagi.editor.component.properties.processrules=function(n,t,i){var f={},e=function(n){for(var h="",e,s,u=n.split(","),r=0;r<u.length;r++)r===0?(s=i[u[r]],e=t.elements[0].tabs[s.tab].elements[s.index].property):r===u.length-1?(h=e[u[r]],f[n]=e):e=o(e,u[r]);return h},o=function(n,t){if(/^.+\[.+\]\(.+\)$/.test(t)){var i=t.replace(/^(.+)\[(.+)\]\((.+)\)$/,"$1:$2:$3").split(":");return n[i[0]][parseInt(i[1])].property}return n[t]},s=function(n){var u=undefined,t,r,i;if(/^<.+:+.+$/.test(n))for(r=n.substring(1,n.length-1),i=r.split(":"),t=0;t<i.length;t++)if(t===0)switch(i[t]){case"design":break;default:return undefined}return u},h=function(n,t){var i=s(t)},r,u;if($.isArray(n)&&n.length>0)for(r=0;r<n.length;r++)u=e(n[r]),h(n[r],u)};bizagi.editor.component.properties.hasRule=function(n){var t=undefined,i=-1,e=/^<.*:+.*>$/,r=function(n,r,u){if(t===undefined)t=[],i++,t[i]=n;else if(r===undefined)i++,t[i]=n;else if(u===undefined)t[i]=n+","+t[i];else for(var f=0;f<=i;f++)t[f]=n+","+t[f]},u=function(n,t,i){for(var s,f,o,h=0;h<n.length;h++)if(f=n[h],f.more===undefined)t[f.name]!==undefined&&e.test(t[f.name])&&(r(f.name),i.paint=!0);else if(t[f.name]!==undefined)if($.isArray(t[f.name]))for(s=0;s<t[f.name].length;s++)o={},u(f.more,t[f.name][s].property,o),o.paint!==undefined&&(r(f.name+"["+s+"]("+t[f.name][s].property.name+")",!0),i.paint=!0);else o={},u(f.more,t[f.name],o),o.paint!==undefined&&(r(f.name,!0),i.paint=!0)},f={};return u([{name:"subproperties",more:[{name:"editor-parameters",more:[{name:"entity"}]}]},{name:"editor-parameters",more:[{name:"entity"}]},{name:"subproperties",more:[{name:"default"}]},{name:"subproperties",more:[{name:"editor-parameters",more:[{name:"context"}]}]},{name:"editor-parameters",more:[{name:"showtime",more:[{name:"rule"}]}]},{name:"editor-parameters",more:[{name:"allowdecimals",more:[{name:"rule"}]}]}],n,f),f.paint!==undefined&&r(n.name,!0,!0),t};
bizagi.editor=bizagi.editor||{};bizagi.editor.component=bizagi.editor.component||{};bizagi.editor.component.properties=bizagi.editor.component.properties||{};bizagi.editor.component.properties.commands=bizagi.editor.component.properties.commands||{};bizagi.editor.component.properties.commands.factory=function(){return this.createRuleCommand=function(n){return new bizagi.editor.component.properties.commands.rule(n)},this.createCommand=function(n){if(n.command!==undefined)try{n.command=n.command.replace("-","");var t=eval("var bafn = function(args) {  return new bizagi.editor.component.properties.commands."+n.command+"(args);};bafn");return t(n)}catch(r){return null}return null},{createCommand:this.createCommand,createRuleCommand:this.createRuleCommand}}();
bizagi.editor.observableClass.extend("bizagi.editor.component.properties.commands.base",{},{init:function(n){n=n||{};this._super();this.args=n;this.element=n.element;this.properties=n.element.properties;this.key=n.key;this.indexedProperty=n.indexedProperty;this.communicationProtocol=bizagi.editor.communicationprotocol.factory},execute:function(){}});
bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.rule",{rulePropertiesCache:{}},{execute:function(){var t=this,n=bizagi.editor.utilities.resolveProperty(t.properties,t.key);return bizagi.editor.utilities.isObject(n)&&bizagi.editor.utilities.isObject(n.baref)?t.updateRuleDisplayName(n):n},updateRuleDisplayName:function(n){var t=this,i=bizagi.editor.utilities.resolveComplexReference(n),r;return t.Class.rulePropertiesCache[i]?(n=t.Class.rulePropertiesCache[i],t.element.assignProperty(t.key,n,!1),n):(r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getruledisplayname",guid:i}),$.when(r.processRequest()).done(function(r){n.displayName=r?r.displayName:rule.displayName;t.element.assignProperty(t.key,n,!1);t.Class.rulePropertiesCache[i]=n}),n)}});
bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.groupby",{},{execute:function(){var n=this;n.parentIsGrid()&&(n.indexedProperty.notShow=!0)},parentIsGrid:function(){var n=this,t=n.element,i=t.parent;return i.type=="grid"}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.showcolumn",{},{execute:function(){var n=this;n.parentIsGrid()&&(n.indexedProperty.notShow=!0)},parentIsGrid:function(){var n=this,t=n.element,i=t.parent;return i.type=="grid"}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.displaytype",{},{execute:function(){var n=this;n.parentIsGrid()&&(n.indexedProperty.notShow=!0)},parentIsGrid:function(){var n=this,t=n.element,i=t.parent;return i.type=="grid"}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.isadministrable",{},{execute:function(){var n=this,t=n.element.triggerGlobalHandler("getContextEntityType");t!="parameter"&&(n.indexedProperty.notShow=!0)}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.selectProcess",{},{execute:function(){var n=this,t=n.element.triggerGlobalHandler("getContextEntityType");t!="application"?n.indexedProperty.notShow=!0:n.indexedProperty.allowClick=n.element.triggerGlobalHandler("getControllerInfo",{type:"isNewForm"})}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.allowdecimals",{},{execute:function(){var n=this,r=n.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"}),u=r?n.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModelGrid"}):n.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModel"}),t,i;if(n.properties.xpath){t=bizagi.editor.utilities.resolveComplexXpath(n.properties.xpath);node=u.getNodeByXpath(t);i=node&&node.getDataType();function f(n){return n=="OracleNumber"?!1:n=="BigInt"?!1:n=="Int"?!1:n=="SmallInt"?!1:n=="TinyInt"?!1:!0}f(i)||(n.indexedProperty.notShow=!0,n.properties.allowdecimals=!1)}}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.buttonrule",{},{execute:function(){var n=this,t;n.element.type=="formbutton"&&(t=n.element.triggerGlobalHandler("getControllerInfo",{type:"isStartFormContext"}),t&&(n.indexedProperty.notShow=!0))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.visible",{},{execute:function(){var n=this,t;n.element.type=="formbutton"&&(t=n.element.triggerGlobalHandler("getControllerInfo",{type:"isStartFormContext"}),t&&(n.indexedProperty.notShow=!0))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.defaultinclude",{},{execute:function(){var n=this;(n.parentIsGrid()||!n.properties.selectable)&&(n.indexedProperty.notShow=!0)},parentIsGrid:function(){var n=this,t=n.element,i=t.parent;return i.type=="grid"}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.numberrange",{},{execute:function(){var n=this,i=n.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"}),r=i?n.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModelGrid"}):n.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModel"}),t;n.properties.xpath&&(t=bizagi.editor.utilities.resolveComplexXpath(n.properties.xpath),node=r.getNodeByXpath(t),node&&node.getRenderType()=="oracleNumber"&&(n.properties.allowdecimals=!1,n.indexedProperty.notShow=!0))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.defaultvalue",{},{execute:function(){var n=this,i=n.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"}),r=i?n.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModelGrid"}):n.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModel"}),t;n.properties.xpath&&(t=bizagi.editor.utilities.resolveComplexXpath(n.properties.xpath),node=r.getNodeByXpath(t),node&&node.getRenderType()=="oracleNumber"&&(n.indexedProperty.notShow=!0))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.actions",{},{execute:function(){var n=this,t;n.element.type=="formbutton"&&(t=n.element.triggerGlobalHandler("getControllerInfo",{type:"isStartFormContext"}),t&&(n.indexedProperty.notShow=!0))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.maxlines",{},{execute:function(){var n=this;n.indexedProperty.show=n.element.properties.isextended==!1||n.element.properties.isextended=="false"?!1:!0}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.formatvalue",{},{execute:function(){var n=this;n.indexedProperty.show=n.element.properties.displaytype=="label"?!1:!0}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.format",{},{execute:function(){var n=this;n.indexedProperty.show=n.element.properties.displaytype=="value"?!1:!0}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.xpath",{},{execute:function(){var n=this;n.element.properties.typedinamic&&(n.indexedProperty.show=n.element.properties.typedinamic==="databind"&&n.properties.allowdinamiclabel?!0:!1);n.indexedProperty.value}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.xpathAdhoc",{},{execute:function(){var n=this,t;n.element.properties.draggedProperty||(t="",n.element.properties.xpathAdhoc||(t=n.element.properties.displayName instanceof Object?n.element.properties.displayName.i18n.default.replace(/[(\/[&\/\\#,+()$~%.'":*?<>{}\s@!¡¿.,àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãñõÃÑÕäëïöüÿÄËÏÖÜŸçÇßØøÅåÆæœ]/g,""):n.element.properties.displayName.replace(/[(\/[&\/\\#,+()$~%.'":*?<>{}\s@!¡¿.,àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãñõÃÑÕäëïöüÿÄËÏÖÜŸçÇßØøÅåÆæœ]/g,""),t=t.substr(0,1).toLowerCase()+t.substr(1),n.element.properties.xpathAdhoc={xpath:t,relatedEntity:null}))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.tagslist",{tagsCache:{}},{execute:function(){var n=this,i,t,r;n.indexedProperty.show=!0;n.element.properties.xpath?(i=n.Class.tagsCache,t=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.element.properties.xpath),i[t]?n.indexedProperty["editor-parameters"].tags=i[t]:(r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"gettags",parameters:[{key:"id",value:t}]}),n.indexedProperty["editor-parameters"].tags=r.processRequest(),$.when(r.processRequest()).done(function(n){i[t]=n||[]}))):n.indexedProperty.show=!1}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.filter",{},{execute:function(){var n=this;n.element.properties.typedinamic&&(n.indexedProperty.show=n.element.properties.typedinamic==="databind"&&n.properties.allowdinamiclabel?!0:!1)}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.datasource",{},{execute:function(){var n=this;n.element.properties.type=="adhocsuggest"?(n.indexedProperty.showAdhocEntitiesControl=!n.element.propertyModel.designProperties.data.subproperties.datasource.ignoreAdhocEntities,n.indexedProperty.showPredefinedValuesControl=!1):(n.indexedProperty.showPredefinedValuesControl=!0,n.indexedProperty.showAdhocEntitiesControl=!0)}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.displayattrib",{},{execute:function(){var n=this;n.element.properties.typedinamic&&(n.indexedProperty.show=n.element.properties.typedinamic==="databind"&&n.properties.allowdinamiclabel?!0:!1)}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.adhocdisplayattrib",{metadataCache:{}},{execute:function(){var n=this,i=[],u=new $.Deferred,r,t,f;n.element.properties.data.datasource&&n.element.properties.data.datasource.type==="adhoc"?(r=n.Class.metadataCache,t=n.element.properties.data.datasource.guid,r[t]?(i=r[t],u.resolve(i)):(f=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getadhocentityattribs",parameters:[{key:"guid",value:t}]}),$.when(f.processRequest()).done(function(n){r[t]=n;i=n;u.resolve(i)})),n.indexedProperty.show=!0):(n.element.properties.data.datasource&&n.element.properties.data.datasource.type==="bizagi"&&(n.element.properties.data.adhocdisplayattrib=null),n.indexedProperty.show=!1);n.indexedProperty["editor-parameters"].attribs=u.promise()}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.datarule",{},{execute:function(){var n=this;n.indexedProperty.show=n.element.properties.typedinamic==="ruleexpression"&&n.properties.allowdinamiclabel?!0:!1}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.typedinamic",{},{execute:function(){var n=this;n.properties.allowdinamiclabel?n.indexedProperty.show=!0:(n.indexedProperty.show=!1,n.element.requiredPropertiesOverrides({xpath:!1,"data.displayattrib":!1,"data.filter":!1,datarule:!1}));n.element.properties.typedinamic==="databind"&&n.properties.allowdinamiclabel?(n.element.requiredPropertiesOverrides({xpath:!0,"data.displayattrib":!0,"data.filter":!0,datarule:!1}),n.element.setProperty("datarule",undefined)):n.element.properties.typedinamic==="ruleexpression"&&n.properties.allowdinamiclabel&&(n.element.requiredPropertiesOverrides({xpath:!1,"data.displayattrib":!1,"data.filter":!1,datarule:!0}),n.element.setProperty("xpath",undefined),n.element.setProperty("data.displayattrib",undefined),n.element.setProperty("data.filter",""));n.element.validRequiredProperties()}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.displayName",{},{execute:function(){var n=this;n.indexedProperty.show=n.properties.allowdinamiclabel?!1:!0}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.isexclusive",{},{execute:function(){var n=this,i=n.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"}),t;n.properties.display=="option"&&i?(n.indexedProperty.show=!1,n.properties.isexclusive=!1):n.indexedProperty.show=!0;n.properties.display==="check"&&n.properties.isexclusive&&(t=n.element.triggerGlobalHandler("getControllerInfo",{type:"searchDependencies",guids:[n.args.element.guid],message:bizagi.localization.getResource("formmodeler-command-searchdependencies-error-column-check")}),$.when(t).done(function(t){t.result||(n.properties.isexclusive=!1)}))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.required",{},{execute:function(){var n=this;n.indexedProperty.show=n.properties.display==="check"&&n.properties.isexclusive?!1:!0}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.totalize",{},{execute:function(){var n=this;n.indexedProperty.show=n.properties.display==="check"&&n.properties.isexclusive?!1:!0}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.submitonchange",{},{execute:function(){var n=this;n.indexedProperty.show=n.properties.display==="check"&&n.properties.isexclusive?!1:!0}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.thousands",{},{execute:function(){var n=this,i=n.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"}),r=i?n.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModelGrid"}):n.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModel"}),t;n.properties.xpath&&(t=bizagi.editor.utilities.resolveComplexXpath(n.properties.xpath),node=r.getNodeByXpath(t),node.getRenderType()=="number"&&(n.properties.allowdecimals=!1))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.enabledby.stakeholders",{stakeholdersPromise:{resolve:!1}},{execute:function(){var n=this,i=n.Class.stakeholdersPromise,t;i.resolve?n.indexedProperty["editor-parameters"].stakeholders=i.resolve:(t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getstakeholders"}),n.indexedProperty["editor-parameters"].stakeholders=t.processRequest(),$.when(t.processRequest()).done(function(t){n.Class.stakeholdersPromise.resolve=t}))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.selecttemplate",{templatesPromise:{},regexParameter:/<\w+:([\w:]+)>/},{execute:function(){var n=this,i=n.Class.templatesPromise,t,r;n.indexedProperty["editor-parameters"].templates=null;n.indexedProperty.show=!1;t=n.getRelatedEntity();t&&(i[t]=i[t]||{},n.indexedProperty.show=!0,r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"gettemplates",entityGuid:t}),n.indexedProperty["editor-parameters"].templates=r.processRequest(),n.indexedProperty["editor-parameters"].templatetype=n.getTemplateType())},getRelatedEntity:function(){var n=this;if(editorParameters=n.indexedProperty["editor-parameters"]||{},entity=editorParameters.entity,!entity)return!1;var i=/<\w+:([\w:]+)>/.exec(entity),r=i[1].replace(/:/g,"."),t=n.element.resolveProperty(r);return t?bizagi.editor.utilities.resolveComplexReference(t):!1},getTemplateType:function(){var n=this,u=n.Class.regexParameter,f=n.indexedProperty["editor-parameters"]||{},t=f.type,i,r;return t?(i=u.exec(t),r=i[1].replace(/:/g,"."),n.element.resolveProperty(r)||!1):!1}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.newrecords",{},{execute:function(){var n=this;n.properties.newrecords&&(bizagi.util.parseBoolean(n.properties.newrecords.allownew)?n.element.requiredPropertiesOverrides({"newrecords.allownewform":!0}):bizagi.util.parseBoolean(n.properties.newrecords.allownew)||n.element.requiredPropertiesOverrides({"newrecords.allownewform":!1}))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.searchforms",{},{execute:function(){var n=this;n.element.properties.xpath||(n.indexedProperty.notShow=!0)}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.multipleselection",{},{execute:function(){var t=this,n;t.element.type=="actionlauncher"&&(n=bizagi.util.parseBoolean(this.element.resolveProperty("multipleselection")),n&&this.element.assignProperty("required",{fixedvalue:"false"},!1))}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.required",{},{execute:function(){var n=this,t;n.element.type=="actionlauncher"&&(t=bizagi.util.parseBoolean(this.element.resolveProperty("multipleselection")),n.indexedProperty.show=t?!1:!0)}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.maxitems",{},{execute:function(){var n=this;n.element.type=="entitytemplate"&&(value=bizagi.util.parseBoolean(this.element.resolveProperty("allowactions")),n.indexedProperty.show=value?!0:!1)}});bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.allowactions",{},{execute:function(){var n=this,t;n.element.type=="entitytemplate"&&(t=n.element.triggerGlobalHandler("getControllerInfo",{type:"isStartFormContext"}),n.indexedProperty.show=!t)}});
bizagi.editor.component.controller("bizagi.editor.component.decorator",{init:function(n,t){var i=this;t=t||{};i._super(n);i.canvas=n;i.presenter=t.presenter;i.model=t.model;i.data=t.data;i.tmpl={}},updateModel:function(n){var t=this;t.model=n;t.update()},render:function(){var n=this;$(".ui-decorator-tooltip").remove();n.targetElement!=undefined&&n.targetElement.removeClass("container-decorator");n.data.element!==undefined&&(n.targetElement=n.data.element,n.targetElement.addClass("container-decorator"));$.when(n.loadTemplates()).done(function(){n.element.appendTo(n.targetElement);n.element.addClass("ui-control-decorator");n.element.show();n.element.empty();n.renderDecorator(n.element)})},renderDecorator:function(n){var t=this,i=$.tmpl(this.getTemplate("decoratorFrame"),t.model),r=$(".biz-decorator-specific-options",i).clone().addClass("ui-clone"),u=n.parent().outerHeight(!0);u>470&&r.appendTo(n);i.appendTo(n);t.setDecoratorPosition(i,n);$(".biz-ico.decorator-image",t.element).tooltip({tooltipClass:"ui-widget-content ui-decorator-tooltip",position:{my:"left top",at:"left bottom",offset:"0 10"}})},setDecoratorPosition:function(n,t){var u=this,i=t.parent().closest(".ui-col"),r=$(".biz-decorator-standard-options",n);i.length>0&&(i[0].scrollWidth>i.outerWidth()&&n.addClass("ui-decorator-left"),i.outerWidth()<r.outerWidth()&&n.addClass("ui-decorator-vertical"))},remove:function(){this.targetElement!==undefined&&this.targetElement.removeClass("container-decorator");$(".ui-decorator-tooltip").remove();this.element.hide();this.element.empty()},loadTemplates:function(){var t=this,n=new $.Deferred;return $.when(t.loadTemplate("decoratorFrame",bizagi.getTemplate("bizagi.editor.component.decorator").concat("#decorator-frame"))).done(function(){n.resolve()}),n.promise()},destroy:function(){$(".ui-decorator-tooltip").remove();this.element.detach()},".decorator-gear click":function(n,t){var i=this;t.stopPropagation();i.presenter.publish("showProperties",i.data)},".decorator-bind click":function(n,t){var i=this;t.stopPropagation();i.presenter.publish("showXpathNavigator",i.data)},".decorator-delete click":function(n,t){var i=this;t.stopPropagation();i.presenter.publish("deleteElement",i.data.guid)},".decorator-edit click":function(n,t){var i=this;t.stopPropagation();i.presenter.publish("openNestedForm",i.data.guid)},".editor-ui-button-actions click":function(n,t){var i=this,r;t.stopPropagation();r=n.data("id");i.presenter.publish("buttonClicked",{button:r,guid:i.data.guid})}});
bizagi.editor.observableClass.extend("bizagi.editor.component.decorator.presenter",{},{init:function(n){var t=this;n=n||{};t._super();t.canvas=n.canvas;t.model=n.model;t.decoratedElement=n.data.element;t.decorator=new bizagi.editor.component.decorator(t.canvas,$.extend(n,{presenter:t}))},destroy:function(){this.decorator.destroy()},remove:function(){this.decorator.remove()},getDecoratedElement:function(){return this.decoratedElement},render:function(n){var t=this;return n=n||{},t.model=n.model||t.model,t.decorator.updateModel(t.model),t.decorator.render(n)}});
$.Class.extend("bizagi.editor.component.decorator.model",{getSpecificModel:function(n){var t=this,i=n.type||n.name,r;return t.models={grid:{specificOptions:[{id:"ConfigGrid",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editcolumns"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},offlinegrid:{specificOptions:[{id:"ConfigGrid",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editcolumns"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},adhocgrid:{specificOptions:[{id:"ConfigGrid",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editcolumns"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},groupedgrid:{specificOptions:[{id:"ConfigGrid",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editcolumns"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},nestedform:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}],specificOptions:[{id:"EditNestedForm",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editform"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},querynestedform:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}],specificOptions:[{id:"EditNestedForm",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editform"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},horizontal:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},container:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},formbutton:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},query:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]}},t.standardOptions=[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowXpath:!0,id:"bind",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-bind"),css:"bz-studio bz-boolean-xpath_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}],r=i=="queryInternal"||i=="query"?t.models.query||{standardOptions:t.standardOptions}:i=="template"?{standardOptions:[]}:t.models[n.name]||t.models[i]||{standardOptions:t.standardOptions},r.standardOptions||(r.standardOptions=t.standardOptions),r}},{});
bizagi.editor.component.controller("bizagi.editor.component.ribbon",{init:function(n,t){var i=this;i._super();t=t||{};i.canvas=n;i.model=t.model;i.presenter=t.presenter},loadTemplates:function(){var n={layout:bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-layout",tab:bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-tab",group:bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-group","group-caption":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-group-caption",button:bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button","button-horizontal":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button-horizontal","button-horizontal-item":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#contextmenu-button-horizontal-item","button-vertical":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button-vertical","button-with-items":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button-with-items","button-subitem":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button-subitem"};return this._super(n)},render:function(n){var t=this;n=n||{};t.model=n.model||t.model;t.itemsPerRow=3;$.when(t.loadTemplates()).done(function(){t.element.empty();var n=t.model.getViewModel();$.when(t.renderGroups(t.element,n.elements)).done(function(){$(".ribbon-group-col .ui-cells > [title].biz-btn-horizontal",t.element).tooltip({tooltipClass:"ui-widget-content ui-ribbon-tooltip ui-ribbon-horizontal-tooltip",position:{my:"left top+10",at:"left bottom"}});$(".ribbon-group-col > [title].biz-btn-vertical",t.element).tooltip({tooltipClass:"ui-widget-content ui-ribbon-tooltip ui-ribbon-vertical-tooltip",position:{my:"left top+10",at:"left bottom"}})})})},updateModel:function(n){var t=this;t.model=n},renderLayout:function(n){var t=this,i=$.tmpl(t.getTemplate("layout"),{}),r=$.tmpl(t.getTemplate("tab"),{});r.appendTo(i);i.appendTo(n)},renderGroups:function(n,t){for(var r=this,i,u,f=0;f<t.length;f++)i=$.tmpl(r.getTemplate("group"),{}),u=t[f],r.renderElements(i,u),r.renderGroupCaption(i,u),i.appendTo(n)},renderGroupCaption:function(n,t){var i;i=$.tmpl(this.getTemplate("group-caption"),t);i.appendTo(n)},renderElementSubItem:function(n,t){var i;i=$.tmpl(this.getTemplate("button-subitem"),t);i.appendTo(n)},renderElement:function(n,t){var i,r=t.align?t.align.toLowerCase():"horizontal";i="value"in t?$.tmpl(this.getTemplate("button-horizontal-item"),t):$.tmpl(this.getTemplate("button-"+r),t);i.appendTo(n)},renderElements:function(n,t){var u,c=this,o=0,i,l=t.elements.length,s=$.tmpl(this.getTemplate("button")),r,f,e,h;for(s.appendTo(n),u=0;u<l;u++)u%c.itemsPerRow==0&&(h=$("<div class='ui-cells ui-pos-"+o+"'><\/div>"),e=h.appendTo(s),o++),i=t.elements[u],f=i.align?i.align.toLowerCase():"horizontal",i.elements?f==="horizontal"?this.renderElementWithItems(e,i):(r=$.tmpl(this.getTemplate("button"),i),r.appendTo(n),this.renderElementWithItems(r,i)):f==="horizontal"?this.renderElement(e,i):(r=$.tmpl(this.getTemplate("button"),i),r.appendTo(n),this.renderElement(r,i))},renderElementWithItems:function(n,t){var r=this,i,f,o=t.elements.length,e,u;if(t.disabled)i=$.tmpl(r.getTemplate("button-horizontal"),t),i.appendTo(n);else{for(i=$.tmpl(r.getTemplate("button-with-items"),t),i.appendTo(n),e=i.find("ul:lt(1)"),u=0;u<o;u++)f=t.elements[u],r.renderElement(e,f);r.fixElementsPosition()}},fixElementsPosition:function(){var n=this;setTimeout(function(){var t=$(".biz-dropdown",n.element);t.each(function(){var n=$(this),t=0;n.children()&&n.children().length>0&&n.children().each(function(){var n=$(this);n.text().trim().length>25&&t<n.width()&&(t=n.width())});t>0&&n.css("width",t+20+"px")})},500)},remove:function(){this.element.hide();this.element.empty()},"div.biz-btn click":function(n){var i=this,r=n.data("guid"),t=i.model.getElement(r);t.items||t.disabled||(t.action==="save"&&(i.model.disableAction("save"),i.render()),setTimeout(function(){i.presenter.publish("onItemClicked",{property:t.property,value:t.value,action:t.action})},500))}});
bizagi.editor.observableClass.extend("bizagi.editor.component.ribbon.presenter",{},{init:function(n){var t=this;t._super();n=n||{};t.canvas=n.canvas;t.model=n.model;t.ribbon=new bizagi.editor.component.ribbon(t.canvas,$.extend(n,{presenter:t}))},getGuid:function(){return this.guid},render:function(n){var t=this;return n=n||{},t.guid=n.guid||null,t.ribbon.render(n)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.ribbon.model",{},{init:function(n){var t=this;t.model=n;t._super();t.items={};t.properties={};t.actions={};t.groups={};n.elements&&t.processElements(n.elements,!0)},getViewModel:function(){for(var t,i={elements:[]},n=0,r=this.model.elements.length;n<r;n++)t=this.model.elements[n],t.hide||i.elements.push(t);return i},processElements:function(n,t){for(var i,u,r=this,f=0;f<n.length;f++)i=n[f],i.guid=i.guid||Math.guid(),i.caption=bizagi.localization.getResource(i.caption)||"",i.tooltip=i.tooltip?bizagi.localization.getResource(i.tooltip):i.caption,t&&(r.groups[i.name]=i),r.items[i.guid]=i,i.property&&!i.value&&(r.properties[i.property]=i),i.action&&(r.actions[i.action]=i),i.property&&i.value&&(u=r.properties[i.property],u.values=u.values||{},u.values[JSON.encode(i.value)]=i),i.disabled=i.disabled==!0||i.disabled=="disabled"?!0:!1,i.originalDisabled=i.disabled,i.elements&&r.processElements(i.elements)},getElementByAction:function(n){var t=this;return t.actions[n]},processElementsForConvertTo:function(n){var t=this;t.processElements(n)},getElement:function(n){return this.items[n]},reset:function(){var n=this;$.each(n.properties,function(n,t){t.disabled=t.originalDisabled});$.each(n.actions,function(n,t){t.disabled=t.originalDisabled})},enableProperty:function(n,t){var u=this,i=u.properties[n],r;if(i){i.disabled=!1;for(r in i.values)i.values[r].selected=!1;t=t!=="undefined"&&typeof t=="boolean"?t.toString():t;t&&(i.values[JSON.encode(t)]?i.values[JSON.encode(t)].selected=!0:typeof t.rule=="object"&&(i.values[JSON.encode("expression")].selected=!0))}},disableProperty:function(n){var i=this,t=i.properties[n];t&&(t.disabled=!0)},enableAction:function(n){var i=this,t=i.actions[n];t&&(t.disabled=!1)},disableAction:function(n){var i=this,t=i.actions[n];t&&(t.disabled=!0)},checkAction:function(n){var i=this,t=i.actions[n];t&&(t.checked=!0)},uncheckAction:function(n){var i=this,t=i.actions[n];t&&(t.checked=!1)},showGroup:function(n){var i=this,t=i.groups[n];t&&(t.hide=!1)},hideGroup:function(n){var i=this,t=i.groups[n];t&&(t.hide=!0)},setCaption:function(n,t){var u=this,i=u.properties[n],r;i&&$.isArray(i.elements)&&i.elements.length>0&&(r=$.grep(i.elements,function(n){return n.value&&n.value.key?n.value.key===t:!1}));r&&r[0]&&r[0].caption&&(i.caption=r[0].caption)}});
bizagi.editor.component.controller("bizagi.editor.component.contextmenu",{init:function(n,t){var i=this;i._super(n);t=t||{};i.canvas=n;i.model=t.model;i.presenter=t.presenter;i.mWidthDropDown=100},loadTemplates:function(){var n=this,t={"context-menu-container":bizagi.getTemplate("bizagi.editor.component.contextmenu")+"#contextmenu-container",button:bizagi.getTemplate("bizagi.editor.component.contextmenu")+"#contextmenu-button","button-separator":bizagi.getTemplate("bizagi.editor.component.contextmenu")+"#contextmenu-button-separator"};return n._super(t)},refresh:function(n){this.render(n)},render:function(n){var t=this;t.model=n.model||t.model;t.model.items&&(t.element.empty(),$.when(t.loadTemplates()).done(function(){var i=$.tmpl(t.getTemplate("context-menu-container"));t.renderItems($(".contextmenu-group",i),t.model.getViewModel());i.appendTo(t.canvas);t.setDropdownWidth();n.position&&t.updateContextMenuPosition(n.position);t.configureCloseHandler();t.fixElementsPosition()}))},fixElementsPosition:function(){var n=this;setTimeout(function(){var t=$(".biz-dropdown",n.element);t.each(function(){var n=$(this),t=n.outerWidth();t>180&&n.css("right",String(20-t)+"px")})},500)},setDropdownWidth:function(){var n=this,t=$(".biz-dropdown",n.element);t.each(function(){var i=$(this),t=n.mWidthDropDown;$(".contextmenu-group-row",i).each(function(){var n=$(this),r=$(".biz-ico",n).length,u=$(".biz-ico",n).outerWidth(!0),f=u*r+10,i=$(".contextmenu-caption",n).outerWidth(!0)+f;i>t&&(t=i)});i.width(t)})},configureCloseHandler:function(){$(document).bind("mouseup.contextmenu",function(n){if(n.button==0){var t=$(".contextmenu-container").parent();t.has(n.target).length===0&&(t.hide(),$(document).unbind("mouseup.contextmenu"))}})},updateContextMenuPosition:function(n){var a=this,i,r,t,e,o,s,h,u,f,c,l;t=a.element;i=n.x;r=n.y;e=$(window).width();o=$(window).height();s=10;h=10;u=t.width()+s;f=t.height()+h;c=Math.abs(i+u-e);l=Math.abs(r+f-o);i+u+135>e?(i=i-u-c+u,t.css("left",i),t.addClass("rightToLeft")):(t.css("left",n.x),t.removeClass("rightToLeft"));r+f+120>o?(r=r-f-l+f,t.css("top",r),t.addClass("bottomToTop")):(t.css("top",n.y),t.removeClass("bottomToTop"));t.show()},renderItems:function(n,t){var u=this,i,r;if(t.items)for(i=0;i<t.items.length;i++)r=t.items[i],r.separator?u.renderSeparator(n,r):u.renderItem(n,r)},renderItem:function(n,t){var i=this,r=$.tmpl(i.getTemplate("button"),$.extend(t,{hasItems:t.items&&t.items.length>0})),u;t.items&&(u=r.find("ul:lt(1)"),i.renderItems(u,t));r.appendTo(n)},renderSeparator:function(n){var t=this,i=$.tmpl(t.getTemplate("button-separator"));i.appendTo(n)},destroy:function(){this.element.detach()},"div.biz-btn click":function(n){var i=this,r=n.data("guid"),t=i.model.getItem(r);t.items||(i.presenter.publish("onItemClicked",{property:t.property,value:t.value,action:t.action}),i.destroy())}});
bizagi.editor.observableClass.extend("bizagi.editor.component.contextmenu.presenter",{},{init:function(n){this._super();n=n||{};this.guid=n.guid;this.canvas=n.canvas||$("<div />").appendTo("form-modeler");this.contextmenu=new bizagi.editor.component.contextmenu(this.canvas,$.extend(n,{presenter:this}))},getGuid:function(){return this.guid},destroy:function(){this.contextmenu.destroy()},render:function(n){var t=this;return n=n||{},t.contextmenu.render(n)}});
$.Class.extend("bizagi.editor.component.contextmenu.model",{},{init:function(n){var t=this;(t.model=n,n&&n.items)&&(t.items={},t.actionItems={},t.properties={},t.processItems(n.items))},getViewModel:function(){return this.model},processItems:function(n){for(var i=this,t=0;t<n.length;t++)i.processItem(n[t])},processItem:function(n){var t=this,i;n.guid=Math.guid();t.items[n.guid]=n;n.caption&&(n.caption=bizagi.localization.getResource(n.caption));n.action&&(t.actionItems[n.action]=n);n.property&&n.value&&(i=t.properties[n.property]=t.properties[n.property]||{values:{}},i.values=i.values||{},n["default"]=n.value,i.values[JSON.encode(n.value)]=n);n.items&&t.processItems(n.items)},getItem:function(n){return this.items[n]},getItemByAction:function(n){var t=this;return t.actionItems[n]},getProperties:function(){return this.properties},assignProperty:function(n,t){var u=this,i=u.properties[n],r;if(i){for(r in i.values)i.values[r].selected=!1,i.values[r].value=i.values[r]["default"];t=t!=="undefined"&&typeof t=="boolean"?t.toString():t;t&&(i.values[JSON.encode(t)]?i.values[JSON.encode(t)].selected=!0:typeof t.rule=="object"&&(i.values[JSON.encode("expression")].selected=!0,i.values[JSON.encode("expression")].value=t))}},addConverToItem:function(n){var r=this,t,u,f,i;if(r.removeConvertToItem(),$.isArray(n)&&n.length>0){for(t={caption:"formmodeler-component-contextmenu-caption-convertto",style:"convertTo",items:[],css:"bz-studio bz-convert-to_16x16_standard"},u=0,f=n.length;u<f;u+=1)i=n[u],t.items.push({caption:i.caption,style:i.controlName,action:"convertTo",value:i.controlName,css:i.style});r.model.items.push(t);r.currentConvertToModel=t;r.processItem(t)}},removeConvertToItem:function(){var n=this;n.currentConvertToModel&&n.model.items.splice($.inArray(n.currentConvertToModel,n.model.items),1)}});
$.Controller("bizagi.editor.component.editor",{init:function(n,t,i){this.canvas=n;this.model=t;this.controller=i;this.tmpl={};this.parameters=this.getParams()},render:function(){var n=this,t=new $.Deferred;return n.element.empty(),n.inline=!1,n.callbacks=[],n.element.addClass("ui-editor"),$.isEmptyObject(n.tmpl)?$.when(n.loadInitTemplates(),n.loadTemplates()).done(function(){n.options.show&&(n.renderEditor(n.element,n.options),n.addTooltipEditor());t.resolve()}):(n.renderEditor(n.element,n.options),n.addTooltipEditor(),t.resolve()),t.promise()},registerCallback:function(n){var t=this;t.callbacks.push(n)},postRender:function(){for(var t=this,n=0;n<t.callbacks.length;n++)t.callbacks[n]()},addTooltipEditor:function(){var n=this;$("i[title]",n.element).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip"});$("div[title]",n.element).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip"})},addRequired:function(n,t){var f=this,r=f.options.required,u,i;if(t&&(r=t.required),bizagi.util.parseBoolean(r)&&n.length>0)for(u=$(' <span class="biz-ico ui-bizagi-render-required bz-studio bz-required_16x16_standard"/>'),i=0;i<n.length;i++)$(n[i]).hasClass("ui-required")||($(n[i]).addClass("ui-required"),$(n[i]).append(u))},loadTemplate:function(n,t){var i=this,r=new $.Deferred;if(i.tmpl.hasOwnProperty(n))r.resolve(i.tmpl[n]);else return bizagi.templateService.getTemplate(t).done(function(t){i.tmpl[n]=t});return r.promise()},loadInitTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.loadTemplate("error",bizagi.getTemplate("bizagi.editor.component.editor").concat("#validator-editor")),n.loadTemplate("multiple-error",bizagi.getTemplate("bizagi.editor.component.editor").concat("#validator-multiple-editor")),n.loadTemplate("multiple-error-item",bizagi.getTemplate("bizagi.editor.component.editor").concat("#validator-multiple-editor-item")),n.loadTemplate("modal",bizagi.getTemplate("bizagi.editor.component.editor").concat("#modal-editor")),n.loadTemplate("modal-actions",bizagi.getTemplate("bizagi.editor.component.editor").concat("#modal-actions-editor"))).done(function(){t.resolve()}),t.promise()},getTemplate:function(n){return this.tmpl.hasOwnProperty(n)?this.tmpl[n]:null},hideEditors:function(){var n=this;n.element.addClass("ui-control-select-editor-up");$(".bizagi_editor_component_properties").append('<div id="blockerProperties" class="blocker-properties ui-block-properties" style="display:none;"><\/div>');$("#blockerProperties").fadeIn();$("#blockerProperties").bind("click",function(){n.hideDialog();$(this).fadeOut(function(){$(this).remove()})})},showEditors:function(){var n=this;n.element.removeClass("ui-control-select-editor-up");$("#blockerProperties").fadeOut(function(){$(this).remove()})},getParams:function(){var i={},n=this.model["editor-parameters"],t;if(!$.isEmptyObject(n))for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},createDialog:function(n,t){var i=this,r,u,f;return i.idDialogEditor=i.options.name+"_DialogModal_"+Math.floor(Math.random()*1e7),f=i.options.name,i.elPopUp=r=$.tmpl(i.getTemplate("modal"),{caption:i.options.caption,id:i.idDialogEditor,style:f}),u=$.tmpl(i.getTemplate("modal-actions")),r.addClass("ui-modal-as-dialog"),r.append(u),i.element.addClass("editor_with_modal"),r.find(".content-modal").append(n),r.find(".modal-editor-buttons").append(t),r.hide(),$(".ui-close-btn",r).click(function(){i.hideDialog()}),r},showDialog:function(n){var t=this,r,i,u=$.Deferred();return i=$("#bizagi_editor_component_properties"),$("#"+t.idDialogEditor,i).length<=0&&i.append(t.elPopUp),r=$("#"+t.idDialogEditor,i),t.dialogReference=r,t.dialogPosition={clientY:event.clientY,offsetY:event.offsetY,top:n.position().top},t.hideEditors(),$.when(t.updateDialogPosition("init")).done(function(){r.show("slide",{direction:"left"},function(){$(this).removeClass("ui-modal-close").addClass("ui-modal-open");u.resolve()})}),u.promise()},updateDialogPosition:function(n){var i=this,u,t,o,f,s,h,l,e,c,r,a;f=i.element.parent().parent();t=$("#"+i.idDialogEditor,f);s=$("body").height();h=20;l=i.dialogPosition.clientY+i.dialogPosition.offsetY;u=l-t.height()/2-f.position().top;o=parseFloat(i.element.parent().width())*2+"px";c=u+t.height()+f.position().top;c>s?(e=u-(c-s)-h,t.find("[class*='ui-modal-arrow-']").css("top","83%")):(t.find("[class*='ui-modal-arrow-']").css("top","43%"),e=u-h);n!=="init"?(r={minWidth:o},t.css(r),a={top:e},n?t.animate(r):t.css(a)):(r={top:e,left:"100%",minWidth:o},t.css(r))},hideDialog:function(n){var i=this,t,r;r=$("#bizagi_editor_component_properties");t=$("#"+i.idDialogEditor,r);t.hasClass("ui-modal-closing")||(t.addClass("ui-modal-closing"),t.hide("slide",{direction:"left"},1e3,function(){$(this).addClass("ui-modal-close").removeClass("ui-modal-open").removeClass("ui-modal-closing");i.showEditors();n&&(i.elPopUp.remove(),n())}))},createValidateMessage:function(n,t,i){var f=this,r,e,o,s=[],u,h;if($.isArray(i)){for(r=$.tmpl(f.getTemplate("multiple-error"),{typeMessage:"error",style:"bz-studio bz-warning-red_16x16_standard"}),e=$(".editor-validator-message-error",r),u=0;u<i.length;u++)r.attr("id","bizagi_editor_validator_container-"+u),o=$.tmpl(f.getTemplate("multiple-error-item"),{typeMessage:"error",message:i[u],style:"bz-studio bz-warning-red_16x16_standard"}),e.append(o),s.push("bizagi_editor_validator_container-"+u);n.data("error-msg",s);r.addClass("ui-inline-error");r.insertAfter(n);r.fadeIn()}else r=$.tmpl(f.getTemplate("error"),{typeMessage:"error",message:i,style:"bz-studio bz-warning-red_16x16_standard"}),r.css({left:t.left,top:t.top}),h=r.attr("id")+"-"+f.options.name,r.attr("id",h),n.data("error-msg",r.attr("id")),$(n.parent()).append(r),r.fadeIn()},showError:function(n,t){var i=this,e,o,s,r,u,f;e=n.position();s="0px";o=e.top+i.getRealHeight(n)+2+"px";r={left:s,top:o};u=i.getValidateId(n);u&&typeof t!="object"?(f=$("#"+u),$(".editor-validator-message-error",f).html(t),f.css(r).fadeIn()):i.createValidateMessage(n,r,t)},hideError:function(){var n=this,t;t=n.getValidateId(n.element);$("#"+t).fadeOut(function(){$(this).remove()})},getValidateId:function(n){var t,i,r=!1;return i=n.closest(".ui-editor"),t=$(".bizagi_editor_validator_container",i),t.length>0&&(r=t.attr("id")),r},getRealHeight:function(n){var r=0,i,u,t;for(i=["padding-top","padding-bottom","margin-top","margin-bottom","border-top","border-bottom"],u=$(n).height(),t=0;t<i.length;t++)r+=parseFloat($(n).css(i[t]));return r+u},highLightProperty:function(n){this.element.addClass("ui-editor-highlight");this.showError(this.element,n)},uiControls:{comboBox:function(n){var t=this;if(t.settings={uiPlaceHolderText:"",uiValues:[{label:"true",value:"true"},{label:"false",value:"false"}],uiInline:!1,onChange:function(){}},$.extend(t.settings,arguments[0]),t.editor=t.settings.uiEditor,t.update=function(n){var t=this;t.methods.update(n)},t.getValue=function(){var n=this;return n.value},t.getLabel=function(){var n=this;return n.label},t.methods={instance:this,init:function(){var n=this;n.container=n.settings.uiContainer;$.when(n.methods.loadTemplates.apply(n)).done(function(){n.methods.renderControl.apply(n)})},loadTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.editor.loadTemplate("comboSelector",bizagi.getTemplate("bizagi.editor.component.editor").concat("#comboBox-selector")),n.editor.loadTemplate("comboValues",bizagi.getTemplate("bizagi.editor.component.editor").concat("#comboBox-values")),n.editor.loadTemplate("comboOptions",bizagi.getTemplate("bizagi.editor.component.editor").concat("#comboBox-options"))).done(function(){t.resolve()}),t.promise()},renderControl:function(){var n,t,i,r,u;try{n=this;t=n.settings;i=n.container;r=i.hasClass("ui-control-editor")?i:$(".ui-control-editor",i);n.value=t.hasOwnProperty("uiInitValue")?n.editor.uiControls.utils.validateValue(n.settings.uiInitValue):n.editor.uiControls.utils.validateValue(n.editor.options.value);t.uiPlaceHolderText.length>0&&(u={label:t.uiPlaceHolderText,value:"select"},t.uiValues.unshift(u));n.options=n.editor.uiControls.utils.selectValueOption(n.value,t.uiValues);n.methods.asignValues.apply(n,[{uiContainer:r}])}catch(f){bizagi.log(f.message,f,"error")}},asignValues:function(n){var t=this,u,f,i,h,e,o,r,s;o=$('<div class="ui-bizagi-editor-uiControls-comboBox ui-control-input" tabindex="0"/>');f=$.tmpl(t.editor.getTemplate("comboValues"),{});for(s in t.options)e=t.options[s].value,r=t.options[s],r.hasOwnProperty("value")&&(r.hasOwnProperty("icon")||(r.icon=r.value),i=$.tmpl(t.editor.getTemplate("comboOptions"),r),$('[class*="-check"]',i).toggleClass("ui-comboBox-image-small-check ui-comboBox-image-small-uncheck"),$('[class*="-check"]',i).addClass("bz-black"),$('[class*="-check"]',i).toggleClass("bz-point_16x16_standard bz-point_16x16_black"),$(".ui-comboBox-value",i).data("value",e),typeof e=="string"&&$(".ui-comboBox-value",i).attr("data-value",e),i.bind("click",function(){t.methods.changeDropDown.apply(t,[{ui:this,e:event}])}),r.hasOwnProperty("tmpl")&&$(".ui-comboBox-value",i).append(r.tmpl),f.append(i),r.hasOwnProperty("selected")&&($('[class*="-uncheck"]',i).toggleClass("ui-comboBox-image-small-uncheck ui-comboBox-image-small-check"),$('[class*="-uncheck"]',i).removeClass("bz-black"),$('[class*="-uncheck"]',i).toggleClass("bz-point_16x16_black bz-point_16x16_standard"),u=$.tmpl(t.editor.getTemplate("comboSelector"),r),$(".ui-comboBox-value",u).data("value",r.value),$(".ui-comboBox-value",u).data("label",r.label),t.value=r.value,t.label=r.label,r.hasOwnProperty("tmpl")&&u.append(r.tmpl)));u===undefined&&(i=$(".ui-bizagi-editor-comboBox-option",f).eq(0),$('[class*="-uncheck"]',i).toggleClass("ui-comboBox-image-small-uncheck ui-comboBox-image-small-check"),$('[class*="-uncheck"]',i).removeClass("bz-black"),$('[class*="-uncheck"]',i).toggleClass("bz-point_16x16_black bz-point_16x16_standard"),u=$.tmpl(t.editor.getTemplate("comboSelector"),t.options[0]),$(".ui-comboBox-value",u).data("value",t.options[0].value),$(".ui-comboBox-value",u).data("label",t.options[0].label),t.value=t.options[0].value,t.label=t.options[0].label,t.options[0].hasOwnProperty("tmpl")&&$(".ui-comboBox-selector-text",u).append(t.options[0].tmpl));t.settings.uiInitLabel&&$(".ui-comboBox-value",u).text(t.settings.uiInitLabel);u.bind("click",function(){t.methods.changeDropDown.apply(t,[{ui:this,e:event}])});f.addClass("ui-comboBox-close");o.append(f);o.prepend(u);n.uiContainer.append(o);t.settings.hasOwnProperty("uiWidthIcon")&&(h=t.settings.uiWidthIcon,$('[class*="ui-comboBox-image-large-"]',n.uiContainer).toggleClass("biz-ico biz-ico-"+h))},update:function(n){var t=this.instance,i=t.settings;t.settings.uiValues=[];t.settings.uiValues=n;t.options=n;this.changeDataCombo.apply(t,[i])},changeDataCombo:function(n){var t=this,i,r,u;i=t.settings;i.uiPlaceHolderText.length>0&&(u={label:i.uiPlaceHolderText,value:"select"},n.uiValues.unshift(u));$.extend(i,n);t.value=i.hasOwnProperty("uiInitValue")?t.editor.uiControls.utils.validateValue(t.settings.uiInitValue):t.editor.uiControls.utils.validateValue(t.editor.options.value);t.options=t.editor.uiControls.utils.selectValueOption(t.value,i.uiValues);r=t.container.hasClass("ui-control-editor")?t.container:$(".ui-control-editor",t.container);r.empty();t.methods.asignValues.apply(t,[{uiContainer:r}])},changeDropDown:function(n){var i={},r,f,t,u;$.extend(i,n);r=$(i.ui);f=r.hasClass("ui-bizagi-editor-comboBox-option")?r.parent().parent():r.parent();u=$(".ui-bizagi-editor-comboBox-selector",f);t=$(".ui-bizagi-editor-comboBox-dropDown",f);i.uiSelector=u;i.uiDropDown=t;t.hasClass("ui-comboBox-close")?t.slideDown(function(){$(this).addClass("ui-comboBox-open").removeClass("ui-comboBox-close");$(".ui-comboBox-arrow-close",u).addClass("ui-comboBox-arrow-open").removeClass("ui-comboBox-arrow-close");$(document).bind("mouseup",function(){t.has(n.ui).length===0&&t.slideUp(function(){$(this).addClass("ui-comboBox-close").removeClass("ui-comboBox-open");$(".ui-comboBox-arrow-open",u).addClass("ui-comboBox-arrow-close").removeClass("ui-comboBox-arrow-open")})})}):t.slideUp(function(){$(this).addClass("ui-comboBox-close").removeClass("ui-comboBox-open");$(".ui-comboBox-arrow-open",u).addClass("ui-comboBox-arrow-close").removeClass("ui-comboBox-arrow-open")});r.hasClass("ui-bizagi-editor-comboBox-selector")||this.methods.setValue.apply(this,[i])},setValue:function(n){var u=$(n.ui),t,e,i,r,o,f;e=$('[class*="ui-comboBox-image-large-"]',u);t=$(".ui-comboBox-value",u).data("value");i=$(".ui-comboBox-value",u).text();r=$(".ui-comboBox-value",n.uiSelector);o=$('[class*="ui-comboBox-image-large-"]',n.uiSelector);$('[class*="-check"]',n.uiDropDown).toggleClass("ui-comboBox-image-small-check ui-comboBox-image-small-uncheck");$('[class*="-uncheck"]',n.uiDropDown).addClass("bz-black");f=$('[data-value="'+t+'"]',n.uiDropDown);$('[class*="-uncheck"]',f.parent()).toggleClass("ui-comboBox-image-small-uncheck ui-comboBox-image-small-check");$('[class*="-check"]',f.parent()).removeClass("bz-black");r.data("value",t);r.data("label",i);r.text(i);o.attr("class",e.attr("class"));this.value=t;this.label=i;this.settings.onChange(t,event)}},t.methods[n])return t.methods[n].apply(t,Array.prototype.slice.call(arguments,1));if(typeof n!="object"&&n&&typeof n!="string")$.error("Method "+method+" does not exist on bizagi.editor.component.editor.uiControls.comboBox");else return t.methods.init.apply(t,arguments)},booleanSwitch:function(n){var t=this;if(t.settings={uiValues:[{label:"true",value:"true"},{label:"false",value:"false"}],uiInline:!1,onChange:function(){}},$.extend(t.settings,arguments[0]),t.editor=t.settings.uiEditor,t.update=function(n){t.methods.update(n)},t.getValue=function(){var n=this;return n.value},t.methods={instance:this,init:function(){var n=this;$.when(n.methods.loadTemplates.apply(n)).done(function(){return n.methods.renderControl.apply(n)})},loadTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.editor.loadTemplate("booleanSwitchSelector",bizagi.getTemplate("bizagi.editor.component.editor").concat("#booleanSwitch-selector")),n.editor.loadTemplate("booleanSwitchValues",bizagi.getTemplate("bizagi.editor.component.editor").concat("#booleanSwitch-values")),n.editor.loadTemplate("booleanSwitchOptions",bizagi.getTemplate("bizagi.editor.component.editor").concat("#booleanSwitch-options"))).done(function(){t.resolve()}),t.promise()},renderControl:function(){var n=this,t,s,o,u,r,i,f,h,e;t=n.settings;r=n.container=n.settings.uiContainer;s=$.tmpl(n.editor.getTemplate("booleanSwitchSelector"),{});i=r.hasClass("ui-control-editor")&&$(".ui-bizagi-editor-uiControls-booleanSwitch",r).length>0?$(".ui-bizagi-editor-uiControls-booleanSwitch",r):r;f=$('<div class="ui-bizagi-editor-uiControls-booleanSwitch ui-control-input biz-btn-horizontal" tabindex="0"/>');o=$.tmpl(n.editor.getTemplate("booleanSwitchValues"),{});h=$(".ui-bizagi-editor-booleanSwitch-content",o);n.value=t.hasOwnProperty("uiInitValue")?n.editor.uiControls.utils.validateValue(n.settings.uiInitValue):n.editor.uiControls.utils.validateValue(n.editor.options.value);n.options=n.editor.uiControls.utils.selectValueOption(n.value,t.uiValues);for(e in n.options)n.options[e].hasOwnProperty("value")&&(u=$.tmpl(n.editor.getTemplate("booleanSwitchOptions"),n.options[e]),n.options[e].hasOwnProperty("selected")?u.addClass("ui-booleanSwitch-selected"):u.addClass("ui-booleanSwitch-unselected"),h.append(u));return f.append(o),f.append(s),i.append(f),t.uiContainer=$(".ui-bizagi-editor-booleanSwitch-content",i),t.uiSelector=$(".ui-bizagi-editor-booleanSwitch-selector",i),i.bind("click",function(){var t=n.settings;$.extend(t,{ui:this,e:event});n.methods.changeSwitch.apply(n,[t])}),n.editor.inline&&i.addClass("ui-control-editor-inline"),$.extend(t,{ui:null,e:null}),n.methods.changeSwitch.apply(n,[t]),n},update:function(n){var t=this.instance,i=t.settings;t.value=n;$.extend(i,{ui:null,e:null});this.changeSwitch.apply(t,[i])},changeSwitch:function(n){var t=n,i=this,r,u,f;r=parseFloat($(t.uiContainer).width());u=parseFloat($(t.uiSelector).width());f=i.editor.inline?"38":r-u;n.ui!=null&&(i.value=!i.value);t.animation=i.value?{selector:{left:f-1+"px",timer:300},container:{left:"0%",timer:300}}:{selector:{left:"0px",timer:300},container:{left:"-100%",timer:300}};n.ui!=null?i.methods.animateChange.apply(i,[t]):(t.uiSelector.css({left:t.animation.selector.left}),t.uiContainer.css({left:t.animation.container.left}))},animateChange:function(n){var t=this;$(n.uiSelector).stop().animate({left:n.animation.selector.left},n.animation.selector.timer);$(n.uiContainer).stop().animate({left:n.animation.container.left},n.animation.selector.timer,function(){var i=$('[class*="selected"]',n.uiContainer);i.removeClass("ui-booleanSwitch-selected").removeClass("ui-booleanSwitch-unselected");i.each(function(){$(this).data("value")==t.value?$(this).addClass("ui-booleanSwitch-selected"):$(this).addClass("ui-booleanSwitch-unselected")});t.methods.setValue.apply(t,[n])})},setValue:function(n){var i=$(n.ui),t;t=$(".ui-booleanSwitch-selected",n.ui).data("value");this.value=t;this.settings.onChange(t,n.e)}},t.methods[n])return t.methods[n].apply(t,Array.prototype.slice.call(arguments,1));if(typeof n!="object"&&n&&typeof n!="string")$.error("Method "+method+" does not exist on bizagi.editor.component.editor.uiControls.booleanSwitch");else return t.methods.init.apply(t,arguments)},iconMenu:{},groupUIControls:{},utils:{validateValue:function(n){var t=n;switch(n){case"true":case!0:t=!0;break;case"false":case!1:case null:t=!1;break;default:t=n}return t},selectValueOption:function(n,t){for(var r,u=this,i=0;i<t.length;i++)r=u.validateValue(t[i].value),n===r&&(n!=undefined||n!=null)&&(t[i].selected=!0);return t},hasHScrollBar:function(n){return n.get(0).scrollWidth>n.width()}}}});
bizagi.editor.component.editor("bizagi.editor.component.editor.string",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u,f;i.inputValue=t.value;i.defaultValue=t["default"];i.charLimit=300;i.localization=t.showLocalization?!0:!1;i.placeholder=t["editor-parameters"].placeholder?!0:!1;i.placeholderText=i.placeholder?" "+t["editor-parameters"].placeholder:" ";i.isReadOnly=t["editor-parameters"].readOnly!==undefined?bizagi.util.parseBoolean(t["editor-parameters"].readOnly):!1;$.extend(t,{placeholder:i.placeholder,placeholderText:i.placeholderText,isReadOnly:i.isReadOnly});r=$.tmpl(i.getTemplate("frame"),t);i.isReadOnly||(u=$.tmpl(i.getTemplate("default")),f=$.tmpl(i.getTemplate("localization")),i.localization&&$(".editor-string-input",r).append(f),$(".editor-string-input",r).append(u));r.appendTo(n)},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.string").concat("#string-frame")),n.loadTemplate("default",bizagi.getTemplate("bizagi.editor.component.editor.string").concat("#string-default-value")),n.loadTemplate("localization",bizagi.getTemplate("bizagi.editor.component.editor.string").concat("#string-localization"))).done(function(){t.resolve()}),t.promise()},validate:function(n){var i=this,t,r,u=!1;return t=$(n),r=t.val(),!i.isLength(n)&&r.length?(t.hasClass("error")||t.addClass("error"),i.showError(n,i.Error),t.select()):(t.removeClass("error"),i.hideError(n),u=!0),u},isLength:function(n){var t=this;return t.Error=bizagi.localization.getResource("bizagi-editor-numberrange-error-lenght").replace("$number",t.charLimit),n.val().length<=t.charLimit},"label click":function(n){n.next().focus()},"input keydown":function(n,t){var i=this,r;t.keyCode==13&&i.validate(n)&&i.inputValue!=n.val()&&(r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:n.val(),type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.options.hasOwnProperty("exclusive")&&(r=$.extend({},r,{exclusive:i.options.exclusive})),i.controller.publish("propertyEditorChanged",r),i.inputValue=n.val())},"input blur":function(n){var t=this,r,u=t.element.find('input[type="text"]').parent(),i;t.validate(n)&&this.inputValue!=n.val()&&(i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t.inputValue,newValue:n.val(),type:t.options.name,id:t.element.closest(".bizagi_editor_component_properties").data("id")},t.options.hasOwnProperty("exclusive")&&(i=$.extend({},i,{exclusive:t.options.exclusive})),t.controller.publish("propertyEditorChanged",i),t.inputValue=n.val());r=t.element.find(".editor-string-icon-localization");r.removeClass("editor_string_fadeIn");u.toggleClass("editor-string-focus")},"input focus":function(){var n,t=this;n=t.element.find(".editor-string-icon-localization");inputParent=t.element.find('input[type="text"]').parent();n.addClass("editor_string_fadeIn");inputParent.toggleClass("editor-string-focus")},"span.editor-string-icon-localization click":function(){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_LOCALIZATION,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},".editor-string-icon-default-value click":function(){var i,n=this,t=n.defaultValue;i=n.element.find('input[type="text"]');t&&(i.val(t),n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:n.inputValue,newValue:t,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")}))},".editor-string-icon-localization mouseenter":function(n){n.addClass("editor_string_fadeIn")},".editor-string-icon-localization mouseleave":function(n){n.removeClass("editor_string_fadeIn")}});
bizagi.editor.component.editor("bizagi.editor.component.editor.localizablestring",{init:function(n,t,i){this._super(n,t,i);this.focus=null},renderEditor:function(n,t){var i=this,r,f,e,u,o={},s;t.value||(i.defaultAttributeSelected=!0,t.value="");/<\s*\w+[\S\s]*>/im.test(t.value)&&($.extend(o,{value:"HTML",html:!0}),i.isHTML=!0);u=i.parameters;i.inputValue=t.value;i.defaultValue=t["default"]?t["default"]:"";i.localization=!0;$.isEmptyObject(u)||(bizagi.util.parseBoolean(u["show-attribute-default"])&&(i.defaultBindCaption=!0),bizagi.util.parseBoolean(u["show-richtext-editor"])&&(i.showRichtextEditor=!0));r=$.tmpl(i.getTemplate("frame"),$.extend({},t,o));f=$.tmpl(i.getTemplate("localization"));s=$.tmpl(i.getTemplate("defaultBindCaption"));i.showRichtextEditor&&$(".editor-localizablestring-input",r).append($.tmpl(i.getTemplate("richtext")));i.localization&&$(".editor-localizablestring-input",r).append(f);i.defaultBindCaption&&($(".editor-localizablestring-input",r).append(s),i.defaultAttributeSelected&&($(".editor-localizablestring-default-bind",r).addClass("bz-studio"),$(".editor-localizablestring-default-bind",r).addClass("bz-checked_16x16_standard")));r.appendTo(n);e=$("label",r);i.addRequired(e)},selectEditor:function(){var n=this;$("input",n.element).select()},loadTemplates:function(){var n=this,t;return t=new $.Deferred,$.when(n.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-frame")),n.loadTemplate("localization",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-localization")),n.loadTemplate("richtext",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-richtext")),n.loadTemplate("richtext-editor",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-richtext-editor")),n.loadTemplate("defaultBindCaption",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-default-bind"))).done(function(){t.resolve()}),t.promise()},remove:function(){var n=this;n.element.hide();n.element.empty()},publishValue:function(n){var t=this,i;t.options.value=n;i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t.inputValue,newValue:n,type:t.options.name,id:t.element.closest(".bizagi_editor_component_properties").data("id")};t.options.hasOwnProperty("exclusive")&&(i=$.extend({},i,{exclusive:t.options.exclusive}));t.controller.publish("propertyEditorChanged",i);t.inputValue=n},"input keyup":function(n,t){var r=this,i=n.val()||"";n.hasClass("isHtml")&&i!=="HTML"&&n.removeClass("isHtml");t.keyCode==13&&i!==r.inputValue&&r.publishValue(i)},"input blur":function(n){var t=this,r,i,u,f;u=t.element.find('input[type="text"]').parent();t.showRichtextEditor&&(f=t.element.find(".editor-localizablestring-richtext"),f.removeClass("ui-control-fadeIn"));r=t.element.find(".editor-localizablestring-localization");r.removeClass("ui-control-fadeIn");u.toggleClass("ui-control-focus");i=n.val()||"";i!==t.inputValue&&i!=="HTML"&&t.publishValue(i)},"input focus":function(){var t,i,r,n=this;n.showRichtextEditor&&(i=n.element.find(".editor-localizablestring-richtext"),i.addClass("ui-control-fadeIn"));t=n.element.find(".editor-localizablestring-localization");r=n.element.find('input[type="text"]').parent();t.addClass("ui-control-fadeIn");r.toggleClass("ui-control-focus")},".editor-localizablestring-richtext click":function(){var n=this,t,i;n.showRichtextEditor&&(t=n.popup=bizagi.createPopup({name:"bz-fm-localizablestring-richtext",container:"form-modeler",center:!0,title:bizagi.localization.getResource("formmodeler-component-editor-localizablestring-richtext-title")}),t.content.append($.tmpl(n.getTemplate("richtext-editor"))),content=$(".bz-fm-localizablestring-richtext-content",t.content),i=$(".bz-fm-localizablestring-richtext-buttons",content),content.height(content.height()-i.height()),$(".bz-fm-localizablestring-richtext-ok",i).click(function(){var i=tinymce.activeEditor.getContent();i=bizagi.util.trim(i);i&&(i="<span>"+i+"<\/span>",n.publishValue(i));t.overlay.remove()}),$(".bz-fm-localizablestring-richtext-cancel",i).click(function(){t.overlay.remove()}),tinymce.remove(),tinymce.init({selector:"textarea#richtext-editor",menubar:!1,resize:!1,forced_root_block:!1,plugins:["textcolor autoresize"],toolbar1:"bold italic underline strikethrough | forecolor"}),n.isHTML&&tinymce.activeEditor.setContent(n.inputValue))},".editor-localizablestring-localization mouseup":function(){var n=this;n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_LOCALIZATION,value:n.inputValue,oldValue:this.options.value,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")})},".editor-localizablestring-localization mouseenter":function(n){n.addClass("editor_localizablestring_fadeIn")},".editor-localizablestring-localization mouseleave":function(n){n.removeClass("editor_localizablestring_fadeIn")},".editor-localizablestring-default-bind click":function(n){var t=this;n.hasClass("bz-checked_16x16_standard")?(n.removeClass("bz-checked_16x16_standard"),n.addClass("bz-check_16x16_standard")):(n.removeClass("bz-check_16x16_standard"),n.addClass("bz-checked_16x16_standard"),t.publishValue());console.log("clicked")}});
bizagi.editor.component.editor("bizagi.editor.component.editor.thumbnail",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r,e,o,u,f,s;i.inDropDown=!1;i.inputValue=t.value;i.minLimit=32;i.maxLimit=128;i.firstSubproperty=i.options.subproperties[0];i.secondSubproperty=i.options.subproperties[1];r=$.tmpl(i.getTemplate("frame"),t);elValues=$.tmpl(i.getTemplate("values"),t);elCheck=$.tmpl(i.getTemplate("check"),t);i.mapSizes=i.mapForSizes(t);i.actualValue=i.retrieveValueObject(t);i.inDropDown?(elValues.insertAfter($(".thumbnail-group-container",r)),o=$.tmpl(i.getTemplate("option"),{name:i.actualValue.name,option:i.actualValue.label,value:{firstSubproperty:i.actualValue.value[i.firstSubproperty.property.name],secondSubproperty:i.actualValue.value[i.secondSubproperty.property.name]}}),o.append(elCheck),$(".thumbnail-group-container",r).append(o)):i.element.addClass("without-dropdown");for(f in i.mapSizes)u=$.tmpl(i.getTemplate("option"),{name:i.mapSizes[f].name,option:i.mapSizes[f].label,value:{firstSubproperty:i.mapSizes[f].value[i.firstSubproperty.property.name],secondSubproperty:i.mapSizes[f].value[i.secondSubproperty.property.name]}}),elCheck=$.tmpl(i.getTemplate("check"),{}),u.append(elCheck),i.inDropDown?(u.append(elCheck),$(".thumbnail-values",r).append(u)):$(".thumbnail-group-container",r).append(u),f==="auto"&&($(".thumbnail-dimension",u).remove(),$(".thumbnail-value",u).css("margin-top","5px"));r.appendTo(n);s=$("label",r);i.addRequired(s);i.inDropDown?$(".thumbnail-values",r).append(u):(e=$(".thumbnail-image-small-"+i.actualValue.name,i.element).closest(".biz-btn-vertical"),e.addClass("biz-btn-checked"),e.find(".thumbnail-image-icon-uncheck").toggleClass("thumbnail-image-icon-uncheck thumbnail-image-icon-check"))},retrieveValueObject:function(){var n=this,t=n.mapSizes;return n.secondSubproperty.property.value==-1?t.auto:n.firstSubproperty.property.value<=n.minLimit?t.small:n.secondSubproperty.property.value>=n.maxLimit?t.large:t.medium},mapForSizes:function(n){var t=this,r,i={small:{label:bizagi.localization.getResource("formmodeler-component-editor-thumbnail-small"),value:{},name:"Small"},medium:{label:bizagi.localization.getResource("formmodeler-component-editor-thumbnail-medium"),value:{},name:"Medium"},large:{label:bizagi.localization.getResource("formmodeler-component-editor-thumbnail-large"),value:{},name:"Large"},auto:{label:bizagi.localization.getResource("formmodeler-component-editor-thumbnail-auto"),value:{},name:"Auto"}};return i.large.value[t.firstSubproperty.property.name]="128",i.large.value[t.secondSubproperty.property.name]="128",i.medium.value[t.firstSubproperty.property.name]="64",i.medium.value[t.secondSubproperty.property.name]="64",i.small.value[t.firstSubproperty.property.name]="32",i.small.value[t.secondSubproperty.property.name]="32",i.auto.value[t.firstSubproperty.property.name]="-1",i.auto.value[t.secondSubproperty.property.name]="-1",r=n.value.width==-1?"auto":n.value[t.firstSubproperty.name]<=t.minLimit?"small":n.value[t.firstSubproperty.property.name]>=t.maxLimit?"large":"medium",i[r].selected=!0,i[r].value[t.firstSubproperty.property.name]=n.value[t.firstSubproperty.property.name]?n.value[t.firstSubproperty.property.name]:i[r].value[t.firstSubproperty.property.name],i[r].value[t.secondSubproperty.property.name]=n.value[t.secondSubproperty.property.name]?n.value[t.secondSubproperty.property.name]:i[r].value[t.firstSubproperty.property.name],i},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.thumbnail").concat("#thumbnail-frame")),this.loadTemplate("option",bizagi.getTemplate("bizagi.editor.component.editor.thumbnail").concat("#thumbnail-frame-option")),this.loadTemplate("values",bizagi.getTemplate("bizagi.editor.component.editor.thumbnail").concat("#thumbnail-frame-values")),this.loadTemplate("check",bizagi.getTemplate("bizagi.editor.component.editor.thumbnail").concat("#thumbnail-frame-check"))).done(function(){n.resolve()}),n.promise()},selectOption:function(n){var t=this,i,r,u;$(".thumbnail-group",t.element).removeClass("biz-btn-checked");t.element.hasClass("without-dropdown")?(n.addClass("biz-btn-checked"),$(".thumbnail-image-icon-check",t.element).removeClass("thumbnail-image-icon-check").addClass("thumbnail-image-icon-uncheck"),$(".thumbnail-image-icon-uncheck",n).toggleClass("thumbnail-image-icon-uncheck thumbnail-image-icon-check"),i=n.data("firstsubproperty"),r=n.data("secondsubproperty")):(n.parent().find(".thumbnail-group > i[class^=thumbnail-icon-small-]").removeClass("thumbnail-image-icon-check").addClass("thumbnail-image-icon-uncheck"),$("i:eq(2)",n).toggleClass("thumbnail-image-small-uncheck thumbnail-image-small-check"),i=n.data("firstsubproperty"),r=n.data("secondsubproperty"),$(".thumbnail-container > .thumbnail-group-container .thumbnail-group > i:eq(0)",t.element).removeClass().addClass("thumbnail-icon-small-"+value.toLowerCase()),$(".thumbnail-container > .thumbnail-group-container .thumbnail-group > i:eq(1)",t.element).text(newValue),$(".thumbnail-values",this.element).removeClass("thumbnail-open").addClass("thumbnail-close"));u=[];u.push({property:t.firstSubproperty.property.name,value:i});u.push({property:t.secondSubproperty.property.name,value:r});t.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_MULTIPLE_PROPERTIES,properties:u,id:this.element.closest(".bizagi_editor_component_properties").data("id")});t.inputValue={width:i,height:r}},".thumbnail-container > .thumbnail-group-container mouseenter":function(n){$(".thumbnail-image-normal-expand",this.element).removeClass("thumbnail-hidden").addClass("thumbnail-show");n.removeClass("thumbnail-collapsed").addClass("thumbnail-expanded")},".thumbnail-container > .thumbnail-group-container mouseleave":function(n){$(".thumbnail-image-normal-expand",this.element).removeClass("thumbnail-show").addClass("thumbnail-hidden");n.removeClass("thumbnail-expanded").addClass("thumbnail-collapsed")},".ui-editor:not(.without-dropdown) > .thumbnail-group-container click":function(n,t){$(".thumbnail-values",this.element).slideDown(function(){$(this).removeClass("thumbnail-close").addClass("thumbnail-open");$(document).bind("mouseup",function(){var n=$(".thumbnail-values");n.has(t.target).length===0&&n.slideUp()})})},".thumbnail-group-container .thumbnail-group click":function(n,t){var i=this;i.inDropDown||i.selectOption(n,t)},".thumbnail-values > .thumbnail-group click":function(n,t){var i=this;i.selectOption(n,t)},".thumbnail-values mouseenter":function(){$(".thumbnail-container > .thumbnail-group-container .thumbnail-image-normal-expand",this.element).removeClass("thumbnail-hidden").addClass("thumbnail-show");$(".thumbnail-container > .thumbnail-group-container .thumbnail-group",this.element).removeClass("thumbnail-collapsed").addClass("thumbnail-expanded")},".thumbnail-values mouseleave":function(n){$(".thumbnail-container > .thumbnail-group-container .thumbnail-image-normal-expand").removeClass("thumbnail-show").addClass("thumbnail-hidden");$(".thumbnail-container > .thumbnail-group-container .thumbnail-group").removeClass("thumbnail-expanded").addClass("thumbnail-collapsed");n.removeClass("thumbnail-open").addClass("thumbnail-close")}});
bizagi.editor.component.editor("bizagi.editor.component.editor.boolean",{init:function(n,t,i){this._super(n,t,i);this.focus=null},renderEditor:function(n,t){var i=this,e,u,o=!1,s,r,f={},h;t.value===undefined?t.value=!1:t.value===null||t.value===!1||t.value=="false"?t.value=!1:(t.value===!0||t.value=="true")&&(t.value=!0);i.inputValue=t.value?!0:!1;t["default"]===undefined?i.defaultValue=!1:t["default"]===null||t["default"]===!1||t["default"]=="false"?i.defaultValue=!1:(t["default"]===!0||t["default"]=="true")&&(i.defaultValue=!0);r=t["editor-parameters"];r&&(o=r.tooltip?bizagi.localization.getResource(r.tooltip):!1,r.labels&&(f["true"]=bizagi.localization.getResource(r.labels["true"].caption),f["false"]=bizagi.localization.getResource(r.labels["false"].caption)));i.inline=!0;$.extend(t,{uiValues:[{label:r.labels?f["true"]:bizagi.localization.getResource("formmodeler-component-editor-boolean-true"),value:"true"},{label:r.labels?f["false"]:bizagi.localization.getResource("formmodeler-component-editor-boolean-false"),value:"false"}],tooltip:o});u=$.tmpl(this.getTemplate("frame"),t);e=$.tmpl(this.getTemplate("default"));i.inline&&u.addClass("bizagi-editor-boolean-inline");u.append(e);u.appendTo(n);s=$("label",u);i.addRequired(s);h=new i.uiControls.booleanSwitch({uiEditor:i,uiContainer:$(".ui-control-editor",u),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeSwitch(n,t,i)}});$(".boolean-container.ui-control-container[title]",i.element).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-boolean-editor-tooltip",position:{my:"left top+10",at:"left bottom"}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.boolean").concat("#boolean-frame")),this.loadTemplate("default",bizagi.getTemplate("bizagi.editor.component.editor.boolean").concat("#boolean-default-action"))).done(function(){n.resolve()}),n.promise()},responseChangeSwitch:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r},".editor-boolean-icon-default-value click":function(){var n=this,t,i;t=n.inputValue;i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t,newValue:n.defaultValue,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",i);n.inputValue=n.defaultValue}});
bizagi.editor.component.editor("bizagi.editor.component.editor.ruleexpression",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,u,r;i.inline=!0;i.data=t;u=i.createDataSource();i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);i.inline&&r.addClass("bizagi-editor-ruleexpression-inline");r.appendTo(n);i.setInitValue(t.value);i.createUIControls(r,u)},createDataSource:function(){var n=this,t=n.data["editor-parameters"],i=null,r=null;return n.data.value&&(r=n.data.value.rule||n.data.value.rule90?{label:bizagi.localization.getResource("formmodeler-component-editor-ruleexpression-option-expression"),value:n.data.value,icon:"expression",style:"bz-studio bz-expresion-ex_16x16_standard"}:{label:bizagi.localization.getResource("formmodeler-component-editor-ruleexpression-option-expression"),value:{rule:{baref:{ref:"expression"}}},icon:"expression",style:"bz-studio bz-expresion-ex_16x16_standard"}),$.isEmptyObject(t)||t.type?($.extend(n.data,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-ruleexpression-option-true"),value:{fixedvalue:"true"},icon:"true",style:"bz-studio bz-yes-no_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-ruleexpression-option-false"),value:{fixedvalue:"false"},icon:"false",style:"bz-studio bz-false_16x16_standard"},r],valueCheck:!1}),i=!1):t.allowboolean!==undefined&&(t.allowboolean=="false"||t.allowboolean==!1)&&($.extend(n.data,{uiValues:[r],valueCheck:!1}),i=!0),i},createUIControls:function(n,t){var i=this;i.myCombo=t?new i.uiControls.comboBox({uiEditor:i,uiPlaceHolderText:"-----",uiContainer:$(".ui-control-editor",n),uiValues:i.data.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}}):new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",n),uiValues:i.data.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.ruleexpression").concat("#ruleexpression-frame")),this.loadTemplate("option",bizagi.getTemplate("bizagi.editor.component.editor.ruleexpression").concat("#ruleexpression-frame-option")),this.loadTemplate("edit",bizagi.getTemplate("bizagi.editor.component.editor.ruleexpression").concat("#ruleexpression-frame-edit"))).done(function(){n.resolve()}),n.promise()},setInitValue:function(n){for(var r,u=this,i=u.data.uiValues,t=0;t<i.length;t++)delete i[t].selected,n.rule&&i[t].value.rule?(i[t].selected="selected",n.rule.displayName&&(i[t].label=n.rule.displayName)):n.rule90&&i[t].value.rule90?(i[t].selected="selected",n.rule90.displayName&&(i[t].label=n.rule90.displayName)):(r=eval(i[t].value.fixedvalue),eval(n.fixedvalue)===r&&(i[t].selected="selected"))},responseChangeCombo:function(n,t,i){var f,r,u;f=i.inputValue;r=n;u=bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY;(r.rule||r.rule90)&&(u=bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,i.options.name=i.options.name);i.options.value=n;i.setInitValue(r);i.myCombo.update(i.data.uiValues);bizagi.log("PROPERTIES_SELECT_EXPRESSION",r);i.controller.publish("propertyEditorChanged",{typeEvent:u,oldValue:f,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Boolean"});i.inputValue=r}});
bizagi.editor.component.editor("bizagi.editor.component.editor.booleandisplay",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u,f;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-booleandisplay-option-check"),value:"check",style:"bz-studio bz-yes-no_16x16_standard",icon:"nothing"},{label:bizagi.localization.getResource("formmodeler-component-editor-booleandisplay-option-radio"),value:"option",style:"bz-studio  bz-radio_16x16_standard",icon:"nothing"}],valueCheck:!1});t.value=t.value?t.value:"expression";i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);elEditAction=$.tmpl(i.getTemplate("edit"),{});i.inline&&r.addClass("bizagi-editor-booleandisplay-inline");r.appendTo(n);u=$("label",r);i.addRequired(u);f=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.booleandisplay").concat("#booleandisplay-frame")),this.loadTemplate("edit",bizagi.getTemplate("bizagi.editor.component.editor.booleandisplay").concat("#booleandisplay-frame-edit"))).done(function(){n.resolve()}),n.promise()},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r}});
bizagi.editor.component.editor("bizagi.editor.component.editor.typedinamic",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u,f;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-typedinamic-option-databinding"),value:"databind",icon:"select-box"},{label:bizagi.localization.getResource("formmodeler-component-editor-typedinamic-option-rule"),value:"ruleexpression"}],valueCheck:!1});t.value=t.value?t.value:"expression";i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);elEditAction=$.tmpl(i.getTemplate("edit"),{});i.inline&&r.addClass("bizagi-editor-typedinamic-inline");r.appendTo(n);u=$("label",r);i.addRequired(u);f=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.typedinamic").concat("#typedinamic-frame")),this.loadTemplate("edit",bizagi.getTemplate("bizagi.editor.component.editor.typedinamic").concat("#typedinamic-frame-edit"))).done(function(){n.resolve()}),n.promise()},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r}});
bizagi.editor.component.editor("bizagi.editor.component.editor.linktarget",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-linktarget-option-newtab"),value:"newtab"},{label:bizagi.localization.getResource("formmodeler-component-editor-linktarget-option-newwindow"),value:"newwindow"}],valueCheck:!1});i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);u=new i.uiControls.comboBox({uiWidthIcon:0,uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.linktarget").concat("#linktarget-frame"))).done(function(){n.resolve()}),n.promise()},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;options={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",options);i.inputValue=r}});
bizagi.editor.component.editor("bizagi.editor.component.editor.horizontalalign",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r,v,y,f,e,p,w,b,u,s,k,h,c,l,a,d,o;if(i.inDropDown=!1,i.inputValue=t.value,t.name=="columntitlealign"?(h=bizagi.localization.getResource("formmodeler-component-editor-columntitlealign-align-right"),c=bizagi.localization.getResource("formmodeler-component-editor-columntitlealign-align-left"),l=bizagi.localization.getResource("formmodeler-component-editor-columntitlealign-align-center"),a=bizagi.localization.getResource("formmodeler-component-editor-columntitlealign-align-justify")):t.name=="columnalign"?(h=bizagi.localization.getResource("formmodeler-component-editor-columnalign-align-right"),c=bizagi.localization.getResource("formmodeler-component-editor-columnalign-align-left"),l=bizagi.localization.getResource("formmodeler-component-editor-columnalign-align-center"),a=bizagi.localization.getResource("formmodeler-component-editor-columnalign-align-justify")):(h=bizagi.localization.getResource("formmodeler-component-editor-horizontalalign-align-right"),c=bizagi.localization.getResource("formmodeler-component-editor-horizontalalign-align-left"),l=bizagi.localization.getResource("formmodeler-component-editor-horizontalalign-align-center"),a=bizagi.localization.getResource("formmodeler-component-editor-horizontalalign-align-justify")),$.extend(t,{labelValues:{optionRight:h,optionLeft:c,optionCenter:l,optionJustify:a},iconValues:["right","left","center","justify"],iconsNew:["bz-studio bz-text-align-right_16x16_standard","bz-studio bz-text-align-left_16x16_standard","bz-studio bz-text-align-center_16x16_standard","bz-studio bz-text-align-justify_16x16_standard"]}),r=$.tmpl(i.getTemplate("frame"),t),d=$.tmpl(i.getTemplate("values"),t),o=$.tmpl(i.getTemplate("check"),t),i.inDropDown){d.insertAfter($(".horizontalalign-group-container",r));u=0;for(e in t.labelValues){if(t.value===t.labelValues[e]){s=t.iconValues[u];break}u++}y=$.tmpl(i.getTemplate("option"),{option:t.value,icon:s});y.append(o);$(".horizontalalign-group-container",r).append(y)}else i.element.addClass("without-dropdown");u=0;for(e in t.labelValues)b=t.labelValues[e].toLowerCase(),s=t.iconValues[u],k=t.iconsNew[u],w=bizagi.localization.getResource(t.labelValues[e]),f=$.tmpl(i.getTemplate("option"),{option:b,title:w,icon:s,newIcon:k}),o=$.tmpl(i.getTemplate("check"),{}),f.append(o),i.inDropDown?(f.append(o),$(".horizontalalign-values",r).append(f)):$(".horizontalalign-group-container",r).append(f),u++;r.appendTo(n);p=$("label",r);i.addRequired(p);i.inDropDown?$(".horizontalalign-values",r).append(f):(t.value=t.value=="default"?"left":t.value,v=$(".horizontalalign-image-small-"+t.value.toLowerCase(),i.element).parent(),v.addClass("biz-btn-checked"),v.find(".horizontalalign-image-icon-uncheck").toggleClass("horizontalalign-image-icon-uncheck horizontalalign-image-icon-check"));$(".horizontalalign-group",r).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-horizontalalign-tooltip",position:{my:"left top+10",at:"left bottom"}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.horizontalalign").concat("#horizontalalign-frame")),this.loadTemplate("option",bizagi.getTemplate("bizagi.editor.component.editor.horizontalalign").concat("#horizontalalign-frame-option")),this.loadTemplate("values",bizagi.getTemplate("bizagi.editor.component.editor.horizontalalign").concat("#horizontalalign-frame-values")),this.loadTemplate("check",bizagi.getTemplate("bizagi.editor.component.editor.horizontalalign").concat("#horizontalalign-frame-check"))).done(function(){n.resolve()}),n.promise()},selectOption:function(n){var t=this,i;$(".horizontalalign-group",t.element).removeClass("biz-btn-checked");t.element.hasClass("without-dropdown")?(n.addClass("biz-btn-checked"),$(".horizontalalign-image-icon-check",t.element).removeClass("horizontalalign-image-icon-check").addClass("horizontalalign-image-icon-uncheck"),$(".horizontalalign-image-icon-uncheck",n).toggleClass("horizontalalign-image-icon-uncheck horizontalalign-image-icon-check"),i=n.find("i:eq(1)").data("value")):(n.parent().find(".horizontalalign-group > i[class^=horizontalalign-icon-small-]").removeClass("horizontalalign-image-icon-check").addClass("horizontalalign-image-icon-uncheck"),$("i:eq(2)",n).toggleClass("horizontalalign-image-small-uncheck horizontalalign-image-small-check"),i=n.find("i:eq(1)").data("value"),$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-group > i:eq(0)",t.element).removeClass().addClass("horizontalalign-icon-small-"+value.toLowerCase()),$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-group > i:eq(1)",t.element).text(i),$(".horizontalalign-values",this.element).removeClass("horizontalalign-open").addClass("horizontalalign-close"));t.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t.inputValue,newValue:i.toLowerCase(),data:i.toLowerCase(),type:t.options.name,id:t.element.closest(".bizagi_editor_component_properties").data("id")});t.inputValue=i.toLowerCase()},".horizontalalign-group click":function(n,t){var i=this;i.selectOption(n,t)},".horizontalalign-values > .horizontalalign-group click":function(n,t){var i=this;i.selectOption(n,t)},".horizontalalign-values mouseenter":function(){$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-image-normal-expand",this.element).removeClass("horizontalalign-hidden").addClass("horizontalalign-show");$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-group",this.element).removeClass("horizontalalign-collapsed").addClass("horizontalalign-expanded")},".horizontalalign-values mouseleave":function(n){$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-image-normal-expand").removeClass("horizontalalign-show").addClass("horizontalalign-hidden");$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-group").removeClass("horizontalalign-expanded").addClass("horizontalalign-collapsed");n.removeClass("horizontalalign-open").addClass("horizontalalign-close")}});
bizagi.editor.component.editor("bizagi.editor.component.editor.rendertype",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r;i.clicks=0;i.inputValue=i.options.value;r=$.tmpl(this.getTemplate("frame"),t);$.each(t.data,function(n,t){i.renderOptions(r.find("select"),t)});r.appendTo(n)},renderOptions:function(n,t){var i="",r;t.hasOwnProperty("selected")&t.selected==!0&&(i=" selected=selected");$.extend(t,{selected:i});r=$.tmpl(this.getTemplate("option"),t);r.appendTo(n)},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.rendertype").concat("#rendertype-frame")),this.loadTemplate("option",bizagi.getTemplate("bizagi.editor.component.editor.rendertype").concat("#rendertype-option"))).done(function(){n.resolve()}),n.promise()},"span focus":function(n){n.removeClass("editor-text-rendertype-enabled").addClass("editor-text-rendertype-disabled");n.next().removeClass("editor-options-disabled").addClass("editor-options-enabled").focus()},"select blur":function(n){n.removeClass("editor-options-enabled").addClass("editor-options-disabled");n.prev().removeClass("editor-text-rendertype-disabled").addClass("editor-text-rendertype-enabled")},"label click":function(n){var t=this;t.clicks++;t.clicks==1&&setTimeout(function(){t.clicks==1&&n.next().focus();t.clicks=0},200)},"label dblclick":function(n){var i=n.closest(".bizagi_editor_component_editor_rendertype").find("select"),u=i.children().length,r=i.find("option:selected"),t;u-1==i.find("option").index(r)?(i.find("option:first").attr("selected","selected"),t=i.find("option:first").text(),n.next().text(t),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:t,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=t):(r.next().attr("selected","selected"),t=r.next().text(),n.next().text(t),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:t,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=t)},"select change":function(n){n.prev().text(n.find("option:selected").text());this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:n.val(),type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")});this.inputValue=n.val()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.controlreference",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u;i.inline=!0;i.retrieveData(t);t.value=t.value?t.value:"isEmpty";i.inputValue=t.value;r=$.tmpl(this.getTemplate("frame"),t);r.appendTo(n);u=$("label",r);i.addRequired(u);i.myCombo=new i.uiControls.comboBox({uiEditor:i,uiPlaceHolderText:bizagi.localization.getResource("formmodeler-component-editor-all-select-one"),uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.controlreference").concat("#controlreference-frame"))).done(function(){n.resolve()}),n.promise()},retrieveData:function(n){var u,f,i,r,t;if(n["editor-parameters"].hasOwnProperty("elements")){for(f=n["editor-parameters"].elements.length,r=[],t=0;t<f;t++)i={},i.label=n["editor-parameters"].elements[t].displayname,i.value=n["editor-parameters"].elements[t].guid,u="controlreference-icon-"+n["editor-parameters"].elements[t].displayname.i18n["default"].replace(/ /gi,"").toLowerCase(),i.icon="column "+u,r.push(i);$.extend(n,{uiValues:r})}return n},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r}});
bizagi.editor.component.editor("bizagi.editor.component.editor.displayname",{init:function(n,t,i){this._super(n,t,i);this.focus=null},renderEditor:function(n,t){var i=this,r,u;i.inputValue=i.options.value;i.defaultValue=t["default"]?t["default"]:"";i.localization=t.showLocalization?!0:!0;r=$.tmpl(i.getTemplate("frame"),t);elLocalization=$.tmpl(i.getTemplate("localization"));i.localization&&$(".ui-control-input",r).append(elLocalization);r.appendTo(n);u=$("label",r);i.addRequired(u)},loadTemplates:function(){var t=this,n;return n=new $.Deferred,$.when(t.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.displayname").concat("#displayname-frame")),t.loadTemplate("localization",bizagi.getTemplate("bizagi.editor.component.editor.displayname").concat("#displayname-localization"))).done(function(){n.resolve()}),n.promise()},remove:function(){var n=this;n.element.hide();n.element.empty()},"input keyup":function(n,t){var i=n.val();t.keyCode==13&&i!==this.inputValue&&(this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:i,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=i)},"input blur":function(n){var t=this,i,u=t.element.find('input[type="text"]').parent(),r=n.val();i=t.element.find(".editor-displayname-localization");i.removeClass("ui-control-fadeIn");u.toggleClass("ui-control-focus");this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:r,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")});this.inputValue=r},"input focus":function(n){var r,t,i=this;r=i.element.find(".editor-displayname-localization");inputParent=i.element.find('input[type="text"]').parent();r.addClass("ui-control-fadeIn");inputParent.toggleClass("ui-control-focus");t=n.val();t!==this.inputValue&&(i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:t,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=t)},"span.editor-displayname-localization click":function(){var n=this;n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_LOCALIZATION,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},"span.editor-displayname-localization mouseenter":function(n){var t=this;n.addClass("ui-control-fadeIn")},"span.editor-displayname-localization mouseleave":function(n){var t=this;n.removeClass("ui-control-fadeIn")}});
bizagi.editor.component.editor("bizagi.editor.component.editor.int",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u,f="",e,o;t.value===undefined?t.value="":t.value===null&&(t.value="");i.inputValue=t.value;i.defaultValue=t["default"]!==undefined&&t["default"]!==null?t["default"]:"";i.suffix="";t["editor-parameters"].hasOwnProperty("suffix")&&t["editor-parameters"].suffix!=""&&(i.suffix=t["editor-parameters"].suffix,f=i.suffix+" ");r=$.tmpl(this.getTemplate("frame"),$.extend({},t,{templateSuffix:f}));e=$.tmpl(this.getTemplate("default"));r.append(e);r.appendTo(n);t["editor-parameters"].hasOwnProperty("placeholder-type")&&(o=t["editor-parameters"]["placeholder-type"],i.setPlaceholder(r),o=="default"&&i.defaultValue!=""&&(i.options["editor-parameters"].max=parseInt(i.defaultValue)));u=$("label",r);i.addRequired(u)},setPlaceholder:function(n){var t=this,i=parseInt(t.defaultValue),u=parseInt(t.options.value),r=n.find("input");isNaN(u)?isNaN(i)||r.attr("placeholder",i):i!=-1&&u>i&&t.registerCallback(function(){t.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-default")+i;t.showError(r,t.Error);r.select()})},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.int").concat("#int-frame")),this.loadTemplate("default",bizagi.getTemplate("bizagi.editor.component.editor.int").concat("#int-default-action"))).done(function(){n.resolve()}),n.promise()},remove:function(){var n=this;n.element.hide();n.element.empty()},validate:function(n){var i=this,t,r,u=!1;return t=$(n),r=t.val(),isNaN(parseInt(r))?(u=!1,r!=""&&(t.hasClass("error")||t.addClass("error"),i.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-integer"),i.showError(n,i.Error),t.select())):i.isInt(r)&&i.isInRange(r)&&!isNaN(parseInt(r))?(t.removeClass("error"),i.hideError(n),u=!0):(t.hasClass("error")||t.addClass("error"),i.showError(n,i.Error),t.select()),u},isInRange:function(n){var r=this,u=!0,i=r.options["editor-parameters"].min,t=r.options["editor-parameters"].max,f=parseInt(n);return i!==undefined&&i!==null&&i!==""&&(isNaN(parseInt(i))||f<parseInt(i)&&(r.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-rangemin"),u=!1)),t!==undefined&&t!==null&&t!==""&&(isNaN(parseInt(t))||parseInt(t)!=-1&&f>parseInt(t)&&(r.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-rangemax"),u=!1)),u},isInt:function(n){var t=this,i;return i=RegExp("^[-+]?[0-9]+"+t.suffix+"$"),t.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-integer"),i.test(n)||n==""},"input[type='text'] blur":function(n){var t=this,r,i,u;n.val($.trim(n.val()));i=n.val();t.suffix!=""&&(u=RegExp("^[-+]?[0-9]+"+t.suffix+"$"),u.test(i)||/^[-+]?[0-9]+$/.test(i)&&n.val(i+t.suffix));(t.validate(n)||i=="")&&(r=parseInt(i),isNaN(r)&&(r=undefined),this.controller.publish("propertyEditorChanged",{oldValue:t.inputValue,newValue:r,type:t.options.name,id:t.element.closest(".bizagi_editor_component_properties").data("id")}))},"input[type='text'] keydown":function(n,t){var i=this,u,r,f;r=n.val();t.keyCode==13&&(n.val($.trim(n.val())),i.suffix!=""&&(f=RegExp("^[-+]?[0-9]+"+i.suffix+"$"),f.test(r)||/^[-+]?[0-9]+$/.test(r)&&n.val(r+i.suffix)),(i.validate(n)||r=="")&&(u=parseInt(r),isNaN(u)&&(u=undefined),this.controller.publish("propertyEditorChanged",{oldValue:i.inputValue,newValue:u,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")})))},".biz-ico.biz-ico-default click":function(){var n=this,i,t;t=n.element.find("input");t.val("");t.hasClass("error")&&(t.removeClass("error"),n.hideError(t));i={oldValue:n.inputValue,newValue:undefined,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",i)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.renderlayout",{listensTo:["innerPropertyChange"]},{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var r,o,s,f,h,i=this,e,c,u;for(i.properties=[],o=t.subproperties.length,e=t.subproperties[2]?t.subproperties[2].property.value:null,c=t.subproperties[2]?t.subproperties[2].property["default"]:null,i.layoutType=e?e:c,f=i.calculateValues(t.subproperties).replace(/\%/gi,""),this.values=i.retrieveValues(f),h=i.retrieveNames(t.subproperties),t.caption=t.caption||"Layout",$.extend(t,{calculatedValues:f},this.values,h),r=$.tmpl(i.getTemplate("frame"),t),r.find(".renderlayout-group").hide().addClass("renderlayout-close"),u=0;u<o;u++)s=t.subproperties[u].property,i.renderSubproperty(r.find(".renderlayout-group"),s);r.appendTo(n);i.inputValue=[];i.layoutType=="pixels"?(i.defaultLabelValue=t.subproperties[0].property["default"],i.defaultControlValue=t.subproperties[1].property["default"],i.defaultPixelValue=i.properties[0].options.value):(i.defaultLabelValue=i.properties[0].options.value,i.defaultControlValue=i.properties[1].options.value,i.defaultPixelValue="");i.inputValue.push(i.defaultLabelValue);i.inputValue.push(i.defaultControlValue);i.createDialogEditor(t)},createDialogEditor:function(n){var t=this,i,r,s,u,f,e,o;t.elPopUpContent=i=$.tmpl(t.getTemplate("content-popup"),n);r=$.tmpl(t.getTemplate("actions-popup"),n);$(".renderlayout-box1",i).text(t.defaultLabelValue+"%").attr("data-value",t.defaultLabelValue+"%");$(".renderlayout-box2",i).text(t.defaultControlValue+"%").attr("data-value",t.defaultControlValue+"%");$("#renderlayout-px-label",i).val(t.defaultPixelValue);e=$(".biz-action-btn",r).eq(1);e.click(function(n){t.responseOkButton.apply(t,[e,n])});f=$(".biz-action-btn",r).eq(2);f.click(function(n){t.responseCancelButton.apply(t,[f,n])});o=$(".biz-action-btn",r).eq(0);o.click(function(n){t.responseApplyButton.apply(t,[o,n])});u=$(".biz-icon.ui-close-btn",i).eq(0);u.click(function(n){t.responseCloseButton.apply(t,[u,n])});s=$(".renderlayout-split",i);s.change(function(){var n=$(this).val(),t=100-n;$(".renderlayout-box1",i).text(n+"%").attr("data-value",n);$(".renderlayout-box2",i).text(t+"%").attr("data-value",t)});t.createEditorUIControls(n,i);t.modalReference=t.createDialog(i,r)},renderSubproperty:function(n,t){var i,r;i=$.tmpl(this.getTemplate("frame-property"),t);t.value=parseFloat(t.value);$.extend(t,{"editor-parameters":{suffix:"%",range:{min:0,max:100}}});r=new bizagi.editor.component.editor.int(i,t,this.controller);this.properties.push(r);i.appendTo(n);r.render()},calculateValues:function(n){var f=this,r,i="",t,u=[30,70];for(r=f.layoutType=="pixels"?n.length-2:n.length-1,i+="",t=0;t<r;t++)n[t].property.hasOwnProperty("value")&n[t].property.value!=null?i+=n[t].property.value:n[t].property.hasOwnProperty("default")&n[t].property["default"]!=null?i+=n[t].property["default"]:(i+=u[t],n[t].property.value=u[t]),i+=t==r-1?"":", ";return i+""},retrieveValues:function(n){var t=n.replace(/\[|\]|,/g,"").trim().split(" ");return{per1:t[0],per2:t[1]}},retrieveNames:function(n){for(var i=[],r=n.length,t=0;t<r;t++)i[t]=n[t].property.caption;return{caption1:i[0],caption2:i[1]}},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.renderlayout").concat("#renderlayout-frame")),this.loadTemplate("frame-property",bizagi.getTemplate("bizagi.editor.component.editor.renderlayout").concat("#renderlayout-frame-property")),this.loadTemplate("content-popup",bizagi.getTemplate("bizagi.editor.component.editor.renderlayout").concat("#renderlayout-frame-popup")),this.loadTemplate("actions-popup",bizagi.getTemplate("bizagi.editor.component.editor.renderlayout").concat("#renderlayout-frame-popup-actions"))).done(function(){n.resolve()}),n.promise()},responseCloseDialog:function(){this.element.empty();this.renderEditor(this.element,this.options)},".renderlayout-value click":function(n){this.showDialogBox(n)},".renderlayout-data > .biz-ico.ui-control-modal click":function(n){this.showDialogBox(n)},showDialogBox:function(n){var t=this;t.showDialog(n).done(function(){var n=$(".renderlayout-split",t.modalReference),i=t.inputValue[0];n.val(i)});t.responseChangeDefaultFormat(t.layoutType,t.elPopUpContent);$("#renderlayout-px-label",t.modalReference).bind("keypress",function(n){var t=n.charCode?n.charCode:n.keyCode;if(t!=8&&(t<48||t>57))return!1})},responseCloseButton:function(){var n=this;n.hideDialog();$(".renderlayout-box1",n.modalReference).attr("data-value",n.values.per1).text(n.values.per1+"%");$(".renderlayout-box2",n.modalReference).attr("data-value",n.values.per2).text(n.values.per2+"%")},responseOkButton:function(){var n=this,t=$("#renderlayout-px-label",n.modalReference).val();n.myCombo.value=="pixels"&&(t==""||t=="NaN")||(n.saveDataLayout(),n.hideDialog(function(){n.responseCloseDialog()}))},responseApplyButton:function(){var n=this,t=$("#renderlayout-px-label",n.modalReference).val();n.myCombo.value=="pixels"&&(t==""||t=="NaN")||n.saveDataLayout()},saveDataLayout:function(){var n=this,t,i,u,r;t=n.options.subproperties[0];i=n.options.subproperties[1];u=n.options.subproperties[2];n.layoutType=n.myCombo.value;n.layoutType=="pixels"?(t.property.value=$("#renderlayout-px-label",n.modalReference).val(),i.property.value="1"):(t.property.value=$(".renderlayout-box1",n.modalReference).attr("data-value"),i.property.value=$(".renderlayout-box2",n.modalReference).attr("data-value"));u.property.value=n.layoutType;r=[];r.push({property:t.property.name,value:t.property.value.replace(/\%/gi,"")});r.push({property:i.property.name,value:i.property.value.replace(/\%/gi,"")});r.push({property:u.property.name,value:u.property.value});n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_MULTIPLE_PROPERTIES,properties:r,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},responseCancelButton:function(){var n=this;n.hideDialog();$(".renderlayout-box1",n.modalReference).attr("data-value",this.values.per1).text(this.values.per1+"%");this.values.per2!=undefined&&$(".renderlayout-box2",n.modalReference).attr("data-value",this.values.per2).text(this.values.per2+"%")},responseChangeDefaultFormat:function(n,t){var i=this,s=$(".renderlayout-names[data-id='percentageData']",i.modalReference),h=$(".renderlayout-names[data-id='pixelData']",i.modalReference),c=$(".ui-bizagi-editor-comboBox-option",t),v=$(".biz-btn",c[0]),y=$(".biz-btn",c[1]),f=$(".biz-ico",v),e=$(".biz-ico",y),l=$(".ui-control-text-box, .ui-comboBox-selector-text",t),r=$("i",l),a=$("span",l),o=i.values.per1,u;o>100&&(i.values.per1=50);u=100-o;f.removeClass();e.removeClass();n=="pixels"?($(".renderlayout-separator",t).hide(),r.removeClass("ui-comboBox-image-large-percentage biz-ico-0"),r.addClass("ui-comboBox-image-large-pixels biz-ico-0"),a.text(bizagi.localization.getResource("formmodeler-component-editor-renderLayout-pixels-format")),s.addClass("renderlayout-px-active"),h.removeClass("renderlayout-px-active"),f.addClass("biz-ico ui-comboBox-image-small-uncheck bz-studio bz-black bz-point_16x16_black"),e.addClass("biz-ico ui-comboBox-image-small-check bz-studio bz-point_16x16_standard")):($(".renderlayout-separator",t).show(),r.removeClass("ui-comboBox-image-large-pixels biz-ico-0"),r.addClass("ui-comboBox-image-large-percentage biz-ico-0"),a.text(bizagi.localization.getResource("formmodeler-component-editor-renderLayout-percentage-format")),s.removeClass("renderlayout-px-active"),o!=""&&(i.values.per2=u,$(".renderlayout-box2",t).text(u+"%").attr("data-value",u)),h.addClass("renderlayout-px-active"),f.addClass("biz-ico ui-comboBox-image-small-check bz-studio bz-point_16x16_standard"),e.addClass("biz-ico ui-comboBox-image-small-uncheck bz-studio bz-black bz-point_16x16_black"))},createEditorUIControls:function(n,t){var i=this;$.extend(n,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-renderLayout-percentage-format"),value:"percentage"},{label:bizagi.localization.getResource("formmodeler-component-editor-renderLayout-pixels-format"),value:"pixels"}]});i.myCombo=new i.uiControls.comboBox({uiWidthIcon:0,uiEditor:i,uiInitValue:i.layoutType,uiContainer:$(".renderLayout-modal-default-format",t),uiValues:n.uiValues,uiInline:i.inline,onChange:function(n){i.responseChangeDefaultFormat(n,t)}})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.displaytype",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,u,f,r,e;for(i.inline=!0,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-both"),value:"both",style:" bz-studio bz-display-both_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-label"),value:"label",style:"bz-studio bz-text-label_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-value"),value:"value",style:"bz-studio bz-display-value_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-reversed"),value:"reversed",style:"bz-studio bz-display-reversed_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-vertical"),value:"vertical",style:"bz-studio bz-display-vertical_16x16_standard"}]}),i.removeItems(t),t.value=t.value?t.value:"expression",r=0;r<t.uiValues.length;r++)t.value===t.uiValues[r].value&&(t.uiValues[r].selected=!0);i.inputValue=t.value;u=$.tmpl(this.getTemplate("frame"),t);u.appendTo(n);f=$("label",u);i.addRequired(f);e=new i.uiControls.comboBox({uiWidthIcon:32,uiEditor:i,uiContainer:$(".ui-control-editor",u),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},removeItems:function(n){var u=n["editor-parameters"],i=u&&u.hide,r=n.uiValues,t,f,e;if($.isArray(i)&&i.length>0)for(r=[],t=0,f=n.uiValues.length;t<f;t++)e=n.uiValues[t].value,$.inArray(e,i)==-1&&r.push(n.uiValues[t]);n.uiValues=r},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.displaytype").concat("#displaytype-frame"))).done(function(){n.resolve()}),n.promise()},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r}});
bizagi.editor.component.editor("bizagi.editor.component.editor.currencysymbol",{init:function(n,t,i){this._super(n,t,i);this.focus=null},responseChangeCombo:function(n,t,i){var u,r,f,e;u=i.inputValue;r=n;f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",f);i.inputValue=r;e=$(".ui-comboBox-value",i.element).html();$(".ui-bizagi-editor-comboBox-selector",i.element).attr("title",e)},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.currencysymbol").concat("#currencysymbol-frame"))).done(function(){n.resolve()}),n.promise()},renderEditor:function(n,t){var i=this,r,u;$.extend(t,{uiCurrencySymbolValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-separator-main"),value:"-1",unselectable:!0},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DEF"),value:""},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-USD"),value:"US$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-EUR"),value:"€"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GBP"),value:"£"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-INR"),value:"₹"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AUD"),value:"AUD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CAD"),value:"CAD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SGD"),value:"SGD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-separator-all"),value:"-1",unselectable:!0},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AED"),value:"AED$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AFN"),value:"AFN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ALL"),value:"ALL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AMD"),value:"AMD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ANG"),value:"ANG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AOA"),value:"AOA$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ARS"),value:"ARS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AUD"),value:"AUD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AWG"),value:"AWG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AZN"),value:"AZN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BAM"),value:"BAM$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BBD"),value:"BBD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BDT"),value:"BDT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BGN"),value:"BGN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BHD"),value:"BHD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BIF"),value:"BIF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BMD"),value:"BMD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BND"),value:"BND$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BOB"),value:"BOB$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BRL"),value:"R$"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BSD"),value:"BSD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BTN"),value:"BTN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BWP"),value:"BWP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BYR"),value:"BYR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BZD"),value:"BZD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CAD"),value:"CAD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CDF"),value:"CDF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CHF"),value:"CHF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CLP"),value:"CLP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CNY"),value:"元"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-COP"),value:"COP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CRC"),value:"CRC$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CUC"),value:"CUC$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CUP"),value:"CUP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CVE"),value:"CVE$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CZK"),value:"Kč"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DJF"),value:"DJF "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DKK"),value:"kr"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DOP"),value:"DOP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DZD"),value:"DZD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-EGP"),value:"EGP£ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ERN"),value:"ERN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ETB"),value:"ETB$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-EUR"),value:"€"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-FJD"),value:"FJD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-FKP"),value:"FKP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GBP"),value:"£"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GEL"),value:"GEL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GGP"),value:"GGP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GHS"),value:"GHS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GIP"),value:"GIP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GMD"),value:"GMD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GNF"),value:"GNF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GTQ"),value:"GTQ$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GYD"),value:"GYD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HKD"),value:"HKD元 "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HNL"),value:"HNL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HRK"),value:"HRK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HTG"),value:"HTG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HUF"),value:"Ft"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-IDR"),value:"Rp"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ILS"),value:"₪"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-IMP"),value:"IMP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-INR"),value:"₹"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-IQD"),value:"IQD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-IRR"),value:"IRR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ISK"),value:"ISKkr "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-JEP"),value:"JEP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-JMD"),value:"J$"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-JOD"),value:"JOD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-JPY"),value:"¥"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KES"),value:"KES$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KGS"),value:"KGS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KHR"),value:"KHR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KMF"),value:"KMF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KPW"),value:"KPW$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KRW"),value:"₩"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KWD"),value:"KWD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KYD"),value:"KYD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KZT"),value:"KZT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LAK"),value:"LAK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LBP"),value:"LBP£ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LKR"),value:"₨"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LRD"),value:"LRD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LSL"),value:"LSL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LYD"),value:"LYD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MAD"),value:"MAD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MDL"),value:"MDL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MGA"),value:"MGA$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MKD"),value:"MKD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MMK"),value:"MMK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MNT"),value:"MNT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MOP"),value:"MOP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MRO"),value:"MRO$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MUR"),value:"MUR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MVR"),value:"MVR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MWK"),value:"MWK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MXN"),value:"MXN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MZN"),value:"MZN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NAD"),value:"NAD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NGN"),value:"NGN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NIO"),value:"NIO$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NOK"),value:"NOKkr "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NPR"),value:"NPR₨ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NZD"),value:"NZD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-OMR"),value:"﷼"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PAB"),value:"B/."},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PEN"),value:"PEN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PGK"),value:"PGK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PHP"),value:"Ph"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PKR"),value:"PKR₨ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PLN"),value:"zł"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PYG"),value:"PYG "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-QAR"),value:"QAR﷼ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-RON"),value:"le"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-RSD"),value:"RSD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-RUB"),value:"RUB "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-RWF"),value:"RWF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SAR"),value:"SAR﷼ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SBD"),value:"SBD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SCR"),value:"SCR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SDG"),value:"SDG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SEK"),value:"SEKkr "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SGD"),value:"SGD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SHP"),value:"SHP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SLL"),value:"SLL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SOS"),value:"SOS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SPL"),value:"SPL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SRD"),value:"SRD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-STD"),value:"STD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SVC"),value:"SVC$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SYP"),value:"SYP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SZL"),value:"SZL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-THB"),value:"฿"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TJS"),value:"TJS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TMT"),value:"TMT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TND"),value:"TND$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TOP"),value:"TOP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TRY"),value:"YTL "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TTD"),value:"TTD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TVD"),value:"TVD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TWD"),value:"TWD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TZS"),value:"TZS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-UAH"),value:"UAH$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-UGX"),value:"UGX$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-USD"),value:"US$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-UYU"),value:"UYU$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-UZS"),value:"UZS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-VEF"),value:"VEFBs "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-VND"),value:"VND$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-VUV"),value:"VUV$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-WST"),value:"WST$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XAF"),value:"XAF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XAG"),value:"XAG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XAU"),value:"XAU$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XBT"),value:"XBT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XCD"),value:"XCD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XDR"),value:"XDR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XOF"),value:"XOF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XPD"),value:"XPD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XPF"),value:"XPF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XPT"),value:"XPT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-YER"),value:"YER$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ZAR"),value:"ZAR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ZMW"),value:"ZMW$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ZWD"),value:"ZWD$ "}]});t.uiCurrencySymbolValues.forEach(function(n){$.extend(n,{tooltip:n.label})});(typeof t.value===undefined||t.value===null)&&(t.value="$");i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);typeof i.options.value=="undefined"&&(t.uiCurrencySymbolValues[1].selected="selected");u=new i.uiControls.comboBox({uiWidthIcon:32,uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiCurrencySymbolValues,onChange:function(n,t){n!=-1&&i.responseChangeCombo(n,t,i)}})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.totalize",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,u,f,r,e;for(i.inline=!0,t["editor-parameters"].type&&t["editor-parameters"].type=="number"?$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-none"),value:""},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-sum"),value:"sum"},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-max"),value:"max"},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-min"),value:"min"},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-avg"),value:"avg"},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-count"),value:"count"}]}):$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-none"),value:""},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-count"),value:"count"}]}),t.value=t.value?t.value:"expression",r=0;r<t.uiValues.length;r++)t.value===t.uiValues[r].value&&(t.uiValues[r].selected=!0);i.inputValue=t.value;u=$.tmpl(this.getTemplate("frame"),t);u.appendTo(n);f=$("label",u);i.addRequired(f);e=new i.uiControls.comboBox({uiWidthIcon:32,uiEditor:i,uiContainer:$(".ui-control-editor",u),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.totalize").concat("#totalize-frame"))).done(function(){n.resolve()}),n.promise()},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r}});
bizagi.editor.component.editor("bizagi.editor.component.editor.daterange",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var r,i=this;t.caption=t.caption||bizagi.localization.getResource("formmodeler-component-editor-daterange-caption");i.data=t;i.container=n;i.value=t.value?bizagi.clone(t.value):{};i.setEditorParameters(t);t.value=t.value||{};r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);i.inputValue=t.value;i.mapSubproperties=i.generateMapSubProperties(t);i.renderMinValue(r);i.renderMaxValue(r)},setEditorParameters:function(n){self.showTime=n["editor-parameters"].showtime.value===!0?"daterange-show-time":"daterange-not-show-time";self.showtime=n["editor-parameters"].showtime.value;self.isOffline=n["editor-parameters"].isOffline||!1},renderMinValue:function(n){var t=this,r,u,i;t.data.min={value:null,caption:bizagi.localization.getResource("formmodeler-component-editor-daterange-min-caption"),style:"min-value"};for(i in t.mapSubproperties)if(t.mapSubproperties[i].name.indexOf("min")!==-1&&t.mapSubproperties[i].value){r=t.mapSubproperties[i].value;u=t.mapSubproperties[i]["bas-type"]==="date"?"min":t.mapSubproperties[i].name.split(".")[1];$.extend(t.data.min,{value:r,type:u});break}t.data.min.value===null&&$.extend(t.data.min,{value:null,type:"min"});t.data.min.style="daterange-min-value";t.renderTypeEditor(n,t.data.min)},renderMaxValue:function(n){var t=this,r,u,i;t.data.max={value:null,caption:bizagi.localization.getResource("formmodeler-component-editor-daterange-max-caption"),style:"max-value"};for(i in t.mapSubproperties)if(t.mapSubproperties[i].name.indexOf("max")!==-1&&t.mapSubproperties[i].value){r=t.mapSubproperties[i].value;u=t.mapSubproperties[i]["bas-type"]==="date"?"max":t.mapSubproperties[i].name.split(".")[1];$.extend(t.data.max,{value:r,type:u});break}t.data.max.value===null&&$.extend(t.data.max,{value:null,type:"max"});t.data.max.style="daterange-max-value";t.renderTypeEditor(n,t.data.max)},generateMapSubProperties:function(n){for(var u=n.subproperties,t,i={},r=0;r<u.length;r++)t=u[r].property.name,i[t]=u[r].property,i[t].value&&(i[t]["bas-type"]==="date"?i[t].value||(i[t].value=null):i[t].value.baref.ref||(i[t].value=null));return i},renderTypeEditor:function(n,t){var i=this,f,r,u,e;f=t.type;u=t.value;$.extend(t,{isOffline:i.isOffline});switch(f){case"max":case"min":var o=i.showtime?" daterange-show-time":" daterange-not-show-time",s=t.style.concat(o),h=u?u:i.value[f];$.extend(t,{style:s,fixedvalue:h});r=i.renderDefaultDate(n,t);i.showtime?$(".daterange-date-container .daterange-date-value",r).will_pickdate({timePicker:!0,allowEmpty:!0,militaryTime:!0,inputOutputFormat:"m/d/Y H:i:s",format:"m/d/Y H:i",onSelect:function(n){n=$.datepicker.formatDate("mm/dd/yy",n)+" "+i.retrieveHumanTime(n);t.value=n;e=$(".daterange-date-container .daterange-date-value",r);i.validateAndPublishFixedSubproperties(t,t.value,e)}}):$(".daterange-date-container .daterange-date-value",r).will_pickdate({allowEmpty:!0,militaryTime:!0,inputOutputFormat:"m/d/Y",format:"m/d/Y",onSelect:function(n){n=$.datepicker.formatDate("mm/dd/yy",n);t.value=n;e=$(".daterange-date-container .daterange-date-value",r);i.validateAndPublishFixedSubproperties(t,t.value,e)}});break;case"maxrule":case"maxrule90":case"minrule":case"minrule90":$.extend(t,{showTime:i.showTime});t.rule=u?u:i.value[f].rule;i.renderDefaultRule(n,t)}},redrawRenderEditor:function(n,t,i){for(var r=this,f=r.data.subproperties,u=0;u<f.length;u++)if(f[u].property.name===t){f[u].property.value=i;r.options.value[t.split(".")[1]]=i;break}r.renderEditor(n,r.data)},renderDefaultDate:function(n,t){var i,r,u=this;return i=$.tmpl(this.getTemplate("frame-date-fixed"),t),i.appendTo(n),t.required=u.mapSubproperties["daterange."+t.type].required===!0?!0:!1,r=$("label",i),u.addRequired(r,t),i},renderDefaultRule:function(n,t){var i,r,u=this;return t.value.displayName!==undefined?t.value.displayName!=""?$.extend(t,{nameRule:t.value.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-daterange-rule")}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-daterange-rule")}),i=$.tmpl(this.getTemplate("frame-rule"),t),i.appendTo(n),t.required=u.mapSubproperties["daterange."+t.type].required===!0?!0:!1,r=$("label",i),u.addRequired(r,t),i},retrieveExculsiveSubProperty:function(n){var t=null;switch(n){case"maxrule":t="max";break;case"minrule":t="min";break;case"min":t="minrule";break;case"max":t="maxrule"}return t},validateAndPublishFixedSubproperties:function(n,t,i){var r=this;r.isValidRange(t,n.type)?(r.hideError(i),r.mapSubproperties["daterange."+n.type].value=t,r.publishFixedSubproperties(n,t)):r.showError(i,r.error)},isValidRange:function(n,t){var i=this,r=!1,u=i.mapSubproperties["daterange.min"].value?i.mapSubproperties["daterange.min"].value:null,f=i.mapSubproperties["daterange.max"].value?i.mapSubproperties["daterange.max"].value:null;return t=="min"?f===null||f==""?r=!0:i.compareDate(f,n)>=0&&(r=!0):u===null||u==""?r=!0:i.compareDate(n,u)>=0&&(r=!0),r===!1&&(i.error=bizagi.localization.getResource("formmodeler-component-editor-daterange-error-range")),r},compareDate:function(n,t){var i=new Date(n),r=new Date(t);return i.valueOf()==r.valueOf()?0:i.valueOf()>r.valueOf()?1:-1},publishFixedSubproperties:function(n,t){var u,r,i=this,f;r="daterange."+n.type;f=i.retrieveOldValue(n.type);i.value?i.value[r]||(i.value[r]={}):i.value={};i.value[r]=t;u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:f,newValue:t===undefined?undefined:t,data:t===undefined?undefined:t,type:r,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",u)},publishRuleSubproperties:function(n,t){var u,r,i=this,o,f,e;r="daterange."+n;o=i.isRule90(n)?"rule90":"rule";f=i.retrieveOldValue(n);i.value?i.value[r]||(i.value[r]={}):i.value={};t===undefined?u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:f,newValue:t,data:t,type:r,id:i.element.closest(".bizagi_editor_component_properties").data("id")}:(i.value[r].rule={baref:{ref:t}},e={},e[o]=i.value[r].rule,u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,oldValue:f,data:e,type:r,id:this.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Scripting",editor:"rule"});i.controller.publish("propertyEditorChanged",u);i.removeFixedExclusiveProperty(n);t===undefined&&(i.element.empty(),i.redrawRenderEditor(i.container,r,t))},removeFixedExclusiveProperty:function(n){var t=this,i;i=t.retrieveExculsiveSubProperty(n);t.publishFixedSubproperties({type:i},undefined)},removeRuleExclusiveProperty:function(n){var t=this,i;i=t.retrieveExculsiveSubProperty(n);t.publishRuleSubproperties(i,undefined)},retrieveOldValue:function(n){var t=this;return t.value[n]?t.value[n]!=""?t.value[n]:t.value[n].rule.baref.ref!="expression"?{rule:t.value[n].rule}:"":""},retrieveHumanTime:function(n){var t=n.getHours(),i=n.getMinutes();return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+":"+i+":00"},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.daterange").concat("#daterange-frame")),this.loadTemplate("frame-date-fixed",bizagi.getTemplate("bizagi.editor.component.editor.daterange").concat("#daterange-frame-date-fixed")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.daterange").concat("#daterange-frame-rule"))).done(function(){n.resolve()}),n.promise()},getMinRuleName:function(){var t=this,n=t.options.min;return n&&n.rule?n.type:"minrule"},getMaxRuleName:function(){var t=this,n=t.options.max;return n&&n.rule?n.type:"maxrule"},isRule90:function(n){return n.indexOf("90")>=0},"i.daterange-rule-external click":function(n){var t=this,i,r=n.closest(".ui-control-input");i=r.hasClass("daterange-min-value")?t.getMinRuleName():t.getMaxRuleName();t.options.value[i]!==undefined&&t.options.value[i]!==null?t.publishRuleSubproperties(i,t.options.value[i].baref.ref):t.publishRuleSubproperties(i,"expression")},".daterange-date-container .daterange-image-rule-delete click":function(n){var t=this,i,r=n.closest(".ui-control-input");i=r.hasClass("daterange-min-value")?t.getMinRuleName():t.getMaxRuleName();t.publishRuleSubproperties(i,undefined)},".daterange-date-container .daterange-image-fixed-delete click":function(n){var u=this,t,i=n.closest(".ui-control-input"),r;t=i.hasClass("daterange-min-value")?"min":"max";r=$(".daterange-date-value",i);r.val("");u.publishFixedSubproperties({type:t},undefined)},".biz-ico.daterange-image-rule-edit click":function(n){var t=this,i,r=n.closest(".ui-control-input");i=r.hasClass("daterange-min-value")?t.getMinRuleName():t.getMaxRuleName();t.options.value[i]!==undefined&&t.options.value[i]!==null?t.publishRuleSubproperties(i,t.options.value[i].baref.ref):t.publishRuleSubproperties(i,"expression")},".biz-ico.daterange-image-fixed-edit click":function(n){var r=this,t=n.closest(".ui-control-input"),i=$(".daterange-date-value",t);i.focus()},".biz-complex-btn.daterange-button-value click":function(n){var r=this,t=n.closest(".ui-control-input"),i=$(".daterange-date-value",t);i.focus()},".daterange-rule-value .daterange-button-value click":function(n){var t=this,i,r=n.closest(".ui-control-input");i=r.hasClass("daterange-min-value")?t.getMinRuleName():t.getMaxRuleName();t.options.value[i]!==undefined&&t.options.value[i]!==null?t.publishRuleSubproperties(i,t.options.value[i].baref.ref):t.publishRuleSubproperties(i,"expression")}});
bizagi.editor.component.editor("bizagi.editor.component.editor.numberrange",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var r,i=this;t.caption=t.caption||bizagi.localization.getResource("formmodeler-component-editor-numberrange-caption");i.data=t;i.container=n;i.setEditorParameters(t);t.value=t.value||{};r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);i.inputValue=t.value;i.mapSubproperties=i.generateMapSubProperties(t);i.renderMinValue(r);i.renderMaxValue(r)},setEditorParameters:function(n){var t=this;t.allowdecimals=n["editor-parameters"].allowdecimals.value;t.isOffline=n["editor-parameters"].isOffline||!1},renderMinValue:function(n){var t=this,r,u,i;t.data.min={value:null,caption:bizagi.localization.getResource("formmodeler-component-editor-numberrange-min-caption"),style:"min-value"};for(i in t.mapSubproperties)if(t.mapSubproperties[i].name.indexOf("min")!==-1&&t.mapSubproperties[i].value){r=t.mapSubproperties[i].value;u=t.mapSubproperties[i]["bas-type"]==="number"?"min":t.mapSubproperties[i].name.split(".")[1];$.extend(t.data.min,{value:r,type:u});break}t.data.min.value===null&&$.extend(t.data.min,{value:null,type:"min"});t.data.min.style="numberrange-min-value";t.renderTypeEditor(n,t.data.min)},renderMaxValue:function(n){var t=this,r,u,i;t.data.max={value:null,caption:bizagi.localization.getResource("formmodeler-component-editor-numberrange-max-caption"),style:"max-value"};for(i in t.mapSubproperties)if(t.mapSubproperties[i].name.indexOf("max")!==-1&&t.mapSubproperties[i].value){r=t.mapSubproperties[i].value;u=t.mapSubproperties[i]["bas-type"]==="number"?"max":t.mapSubproperties[i].name.split(".")[1];$.extend(t.data.max,{value:r,type:u});break}t.data.max.value===null&&$.extend(t.data.max,{value:null,type:"max"});t.data.max.style="numberrange-max-value";t.renderTypeEditor(n,t.data.max)},generateMapSubProperties:function(n){for(var u=n.subproperties,t,i={},r=0;r<u.length;r++)t=u[r].property.name,i[t]=u[r].property,i[t].value&&(i[t]["bas-type"]==="number"?i[t].value||(i[t].value=null):i[t].value.baref.ref||(i[t].value=null));return i},renderTypeEditor:function(n,t){var i=this,r,f,u;r=t.type;u=t.value;$.extend(t,{isOffline:i.isOffline});switch(r){case"max":case"min":var e=i.allowdecimals?" numberrange-show-time":" numberrange-not-show-time",o=t.style.concat(e),s=u?u:i.data.value[r];$.extend(t,{style:o,fixedvalue:s});f=i.renderDefaultNumber(n,t);$(".numberrange-"+r+"-value .numberrange-number-value",f).bind("blur",function(){var n=$(this),u=n.val();t.value=i.mapSubproperties["numberrange."+r].value=u;i.validateAndPublish(t,n)});$(".numberrange-"+r+"-value .numberrange-number-value",f).bind("keyup",function(n){if(n.keyCode==13){var u=$(this),f=u.val();t.value=i.mapSubproperties["numberrange."+r].value=f;i.validateAndPublish(t,u)}});break;case"maxrule":case"maxrule90":case"minrule":case"minrule90":$.extend(t,{allowdecimals:i.allowdecimals});t.rule=u?u:i.data.value[r].rule;i.renderDefaultRule(n,t)}},redrawRenderEditor:function(n,t,i){for(var r=this,f=r.data.subproperties,u=0;u<f.length;u++)if(f[u].property.name===t){f[u].property.value=i;r.options.value[t.split(".")[1]]=i;break}r.renderEditor(n,r.data)},renderDefaultNumber:function(n,t){var i;return i=$.tmpl(this.getTemplate("frame-number-fixed"),t),i.appendTo(n),i},renderDefaultRule:function(n,t){var i;return t.value.displayName!==undefined?t.value.displayName!=""?$.extend(t,{nameRule:t.value.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-numberrange-rule")}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-numberrange-rule")}),i=$.tmpl(this.getTemplate("frame-rule"),t),i.appendTo(n),i},retrieveExculsiveSubProperty:function(n){var t=null;switch(n){case"maxrule":t="max";break;case"minrule":t="min";break;case"min":t="minrule";break;case"max":t="maxrule"}return t},publishFixedSubproperties:function(n,t){var u,r,i=this,f;r="numberrange."+n.type;f=i.retrieveOldValue(n.type);i.data.value?i.data.value[r]||(i.data.value[r]={}):i.data.value={};i.data.value[r]=t;u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:f,newValue:t===undefined?undefined:t,data:t===undefined?undefined:t,type:r,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",u)},publishRuleSubproperties:function(n,t){var u,r,i=this,f,o,e;r="numberrange."+n;o=i.isRule90(n)?"rule90":"rule";f=i.retrieveOldValue(n);i.data.value?i.data.value[r]||(i.data.value[r]={}):i.data.value={};i.data.value[r].rule={baref:{ref:t}};t===undefined?u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:f,newValue:t,data:t,type:r,id:i.element.closest(".bizagi_editor_component_properties").data("id")}:(e={},e[o]=i.data.value[r].rule,u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,oldValue:f,data:e,type:r,id:this.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Scripting",editor:"rule"});i.controller.publish("propertyEditorChanged",u);i.removeFixedExclusiveProperty(n);t===undefined&&(i.element.empty(),i.redrawRenderEditor(i.container,r,t))},removeFixedExclusiveProperty:function(n){var t=this,i;i=t.retrieveExculsiveSubProperty(n);t.publishFixedSubproperties({type:i},undefined)},removeRuleExclusiveProperty:function(n){var t=this,i;i=t.retrieveExculsiveSubProperty(n);t.publishRuleSubproperties(i,undefined)},retrieveOldValue:function(n){var t=this,i="";return t.data.value[n]?t.data.value[n]!=""?i=t.data.value[n]:t.data.value[n].rule?t.data.value[n].rule.baref.ref!="expression"&&(i={rule:t.data.value[n].rule}):i="":i="",i},retrieveHumanTime:function(n){var t=n.getHours(),i=n.getMinutes();return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+":"+i+":00"},isValidRange:function(n,t){var r=this,i=!1,u=r.mapSubproperties["numberrange.max"].value?r.mapSubproperties["numberrange.max"].value:null,f=r.mapSubproperties["numberrange.min"].value?r.mapSubproperties["numberrange.min"].value:null,e,o;return t=="min"?u===null||u===""?i=!0:n===""?(f=null,i=!0):r.allowdecimals?(parseFloat(n)<=u||u==="")&&(i=!0):(e=u,e===""||e===undefined?i=!0:parseInt(n)<=parseInt(e)&&(i=!0)):f===null||f===""?i=!0:n===""?(u=null,i=!0):r.allowdecimals?(parseFloat(n)>=f||f==="")&&(i=!0):(o=f,o===""||o===undefined?i=!0:parseInt(n)>=parseInt(o)&&(i=!0)),i===!1&&(r.error=bizagi.localization.getResource("formmodeler-component-editor-numberrange-error-range")),i},validateAndPublish:function(n,t){var i=this,r,u=n.value,f=n.type;i.allowdecimals===!0?(r=/(^$)|(^-?(0|[1-9][0-9]*)(\.[0-9]+)?$)/,i.error=bizagi.localization.getResource("formmodeler-component-editor-numberrange-error-number")):(r=/(^$)|(^-?(0|[1-9][0-9]*)$)/,i.error=bizagi.localization.getResource("formmodeler-component-editor-numberrange-error-int"));r.test(u)&&i.isValidRange(u,f)?(i.hideError(t),i.publishFixedSubproperties(n,n.value)):(i.showError(t,i.error),t.select())},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.numberrange").concat("#numberrange-frame")),this.loadTemplate("frame-number-fixed",bizagi.getTemplate("bizagi.editor.component.editor.numberrange").concat("#numberrange-frame-number-fixed")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.numberrange").concat("#numberrange-frame-rule"))).done(function(){n.resolve()}),n.promise()},getMinRuleName:function(){var t=this,n=t.options.min;return n&&n.rule?n.type:"minrule"},getMaxRuleName:function(){var t=this,n=t.options.max;return n&&n.rule?n.type:"maxrule"},isRule90:function(n){return n.indexOf("90")>=0},"i.numberrange-rule-external click":function(n){var t=this,i,r=n.closest(".ui-control-input");i=r.hasClass("numberrange-min-value")?t.getMinRuleName():t.getMaxRuleName();t.options.value[i]!==undefined&&t.options.value[i]!==null?t.publishRuleSubproperties(i,t.options.value[i].baref.ref):t.publishRuleSubproperties(i,"expression")},".numberrange-number-container .numberrange-image-rule-delete click":function(n){var t=this,i,r=n.closest(".ui-control-input");i=r.hasClass("numberrange-min-value")?t.getMinRuleName():t.getMaxRuleName();t.publishRuleSubproperties(i,undefined)},".numberrange-number-container .numberrange-image-fixed-delete click":function(n){var u=this,t,i=n.closest(".ui-control-input"),r;t=i.hasClass("numberrange-min-value")?"min":"max";r=$(".numberrange-number-value",i);r.val("");u.publishFixedSubproperties({type:t},undefined)},".biz-ico.numberrange-image-rule-edit click":function(n){var t=this,i,r=n.closest(".ui-control-input");i=r.hasClass("numberrange-min-value")?t.getMinRuleName():t.getMaxRuleName();t.options.value[i]!==undefined&&t.options.value[i]!==null?t.publishRuleSubproperties(i,t.options.value[i].baref.ref):t.publishRuleSubproperties(i,"expression")},".biz-ico.numberrange-image-fixed-edit click":function(n){var r=this,t=n.closest(".ui-control-input"),i=$(".numberrange-number-value",t);i.focus()},".numberrange-rule-value .numberrange-button-value click":function(n){var t=this,i,r=n.closest(".ui-control-input");i=r.hasClass("numberrange-min-value")?t.getMinRuleName():t.getMaxRuleName();t.options.value[i]!==undefined&&t.options.value[i]!==null?t.publishRuleSubproperties(i,t.options.value[i].baref.ref):t.publishRuleSubproperties(i,"expression")}});
bizagi.editor.component.editor("bizagi.editor.component.editor.dateformat",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var f,r,e,o,s,h,u,c,l,i=this;i.showTime=t["editor-parameters"].showtime.value;h=t["editor-parameters"].showtime.value===!0?"dateformat-show-time":"dateformat-not-show-time";u=i.retrieveValues(t.value);$.extend(t,u,{showTime:h});f=$.tmpl(i.getTemplate("frame"),t);f.appendTo(n);l=$("label",f);i.addRequired(l);i.data=t;i.inputValue=t.value;i.inline=!0;i.elPopUpContent=r=$.tmpl(i.getTemplate("modal-content"),t);i.elPopUpActions=e=$.tmpl(i.getTemplate("modal-actions-editor"),{});t.initValueDateFormat=t.initValueShortDate=!1;u.valueDate===bizagi.localization.getResource("formmodeler-component-editor-dateformat-default-format")&&(t.initValueDateFormat=!0);$(".dateformat-options-default-format-false",r).hide();$(".dateformat-options-short-date-false",r).hide();i.showTime?($(".dateformat-format .dateformat-modal-item",r).removeClass("dateformat-col1").addClass("dateformat-col2"),$(".dateformat-modal-time-format",r).parent().show()):($(".dateformat-format .dateformat-modal-item",r).removeClass("dateformat-col2").addClass("dateformat-col1"),$(".dateformat-modal-time-format",r).parent().hide());i.createEditorDataSources(t);c=i.isShortDate(t);i.createEditorUIControls(t,r);i.showTime?i.populate(i.showTime,{dateFormatSelected:u.valueDate,timeFormatSelected:u.valueTime}):i.populate(i.showTime,{dateFormatSelected:t.value});i.showTime?$(".dateformat-modal-time",i.elPopUpContent).show():$(".dateformat-modal-time",i.elPopUpContent).hide();o=$(".biz-action-btn",e).eq(0);s=$(".biz-action-btn",e).eq(1);o.click(function(n){i.responseOkButton.apply(i,[o,n])});s.click(function(n){i.responseCancelButton.apply(i,[s,n])});i.dialogReference=i.createDialog(i.elPopUpContent,i.elPopUpActions);c&&$(".dateformat-options-short-date-false",i.dialogReference).show()},isShortDate:function(n){var i={value:!1,index:0},r=n.uiSelect.shortDateSeparator.uiValues,u=n.value,t,f;if(u)for(t=0;t<r.length;t++)if(f=u.indexOf(r[t].value),f!=-1){i={value:!0,index:t};break}return $.extend(n,{shortDate:i}),i.value},createEditorUIControls:function(n,t){var i=this;i.shortDateComboBox=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor.dateformat-short-date",t),uiInitValue:n.uiSelect.shortDateSeparator.uiValues[n.shortDate.index].value,uiValues:n.uiSelect.shortDateSeparator.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseShortDateComboChange(n,t)}});i.dateFormatComboBox=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor.date-format",t),uiInitValue:n.value,uiValues:n.uiSelect.normalDateFormat.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseDateFormatComboChange(n,t)}});i.timeFormatComboBox=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor.time-format",t),uiValues:n.uiSelect.timesDateFormat.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseTimeFormatComboChange(n,t)}});i.mySwitchDefaultFormat=new i.uiControls.booleanSwitch({uiEditor:i,uiInitValue:n.initValueDateFormat,uiContainer:$(".dateformat-modal-default-format",t),uiValues:n.dateFormatUIValues.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeDefaultFormat(n,t,i)}});i.mySwitchShortDate=new i.uiControls.booleanSwitch({uiEditor:i,uiInitValue:n.shortDate.value,uiContainer:$(".dateformat-modal-short-date",t),uiValues:n.shortDateUIValues.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeShortDate(n,t,i)}})},createEditorDataSources:function(n){return $.extend(n,{uiSelect:{shortDateSeparator:{uiValues:[{label:"/",value:"/",icon:"separator"},{label:".",value:".",icon:"separator"},{label:"-",value:"-",icon:"separator"}]},shortDateFormat:{uiValues:[{label:"M*d*yyyy",value:"m*d*yy",icon:"date"},{label:"M*d*yy",value:"m*d*y",icon:"date"},{label:"MM*dd*yy",value:"mm*dd*y",icon:"date"},{label:"MM*dd*yyyy",value:"mm*dd*yy",icon:"date"},{label:"yy*MM*dd",value:"y*mm*dd",icon:"date"},{label:"yyyy*MM*dd",value:"yy*mm*dd",icon:"date"},{label:"dd*MM*yyyy",value:"dd*mm*yy",icon:"date"},{label:"dd*MMM*yy",value:"dd*M*y",icon:"date"},{label:"dd*MM*yy",value:"dd*mm*y",icon:"date"}]},normalDateFormat:{uiValues:[{label:"dddd, MMMM dd, yyyy",value:"DD, MM dd, yy",icon:"date"},{label:"MMMM dd, yyyy",value:"MM dd, yy",icon:"date"},{label:"dddd, dd MMMM, yyyy",value:"DD, dd MM, yy",icon:"date"},{label:"dd MMMM, yyyy",value:"dd MM, yy",icon:"date"}]},timesDateFormat:{uiValues:[{label:"hh:mm:ss tt",value:{format:"hh:mm:ss tt",ampm:!0},icon:"hour"},{label:"h:mm:ss tt",value:{format:"h:mm:ss tt",ampm:!0},icon:"hour"},{label:"H:mm:ss",value:{format:"H:mm:ss",ampm:!1},icon:"hour"},{label:"HH:mm:ss",value:{format:"HH:mm:ss",ampm:!1},icon:"hour"}]}}}),$.extend(n,{dateFormatUIValues:{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-dateformat-true"),value:"true"},{label:bizagi.localization.getResource("formmodeler-component-editor-dateformat-false"),value:"false"}]},shortDateUIValues:{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-dateformat-true"),value:"true"},{label:bizagi.localization.getResource("formmodeler-component-editor-dateformat-false"),value:"false"}]}}),n},responseShortDateComboChange:function(){var n=this,i,t;t=n.dateFormatComboBox.value;n.showTime?(i=n.timeFormatComboBox.value.format,n.populate(n.showTime,{dateFormatSelected:t,timeFormatSelected:i})):n.populate(n.showTime,{dateFormatSelected:t})},responseDateFormatComboChange:function(){var n=this,t,i;t=n.dateFormatComboBox.label;n.showTime?(i=n.timeFormatComboBox.value.format,n.populate(n.showTime,{dateFormatSelected:t,timeFormatSelected:i})):n.populate(n.showTime,{dateFormatSelected:t})},responseTimeFormatComboChange:function(){var n=this,t,i;i=n.timeFormatComboBox.value.format;t=n.dateFormatComboBox.label;n.populate(n.showTime,{dateFormatSelected:t,timeFormatSelected:i})},changeItems:function(n,t,i,r){var u=this,f,e,o,s;for(s=$('[class*="ui-modal-arrow"]',u.element).position(),s&&$('[class*="ui-modal-arrow"]',u.element).css("top",s.top),n=="disabled"?(e="dateformat-enabled",o="dateformat-disabled"):(e="dateformat-disabled",o="dateformat-enabled"),r=r?r:".empty",n=="disabled"&&$(r).slideUp({step:function(){u.updateDialogPosition(!1)}}),f=0;f<t.length;f++)if(i||t[f]!=="dateformat-modal-short-date-separator")$(".dateformat-modal ."+t[f]).parent().removeClass(e).addClass(o);else continue;n==="enabled"&&$(r).slideDown({step:function(){u.updateDialogPosition(!1)},complete:function(){$(this).css("overflow","visible")}});u.createSampleInputText()},populate:function(n,t){var i=this,o,r,c,u,e,s,f,h;if(c=i.mySwitchShortDate.getValue(),s=t.hasOwnProperty("dateFormatSelected"),f=[],c){for(o=i.shortDateComboBox.getValue(),r=0;r<i.data.uiSelect.shortDateFormat.uiValues.length;r++)u={label:i.data.uiSelect.shortDateFormat.uiValues[r].label.replace(/\*/g,o),value:i.data.uiSelect.shortDateFormat.uiValues[r].value.replace(/\*/g,o),icon:"date"},s&u.label===t.dateFormatSelected&&(u.selected="selected"),f.push(u);i.dateFormatComboBox.update(f)}else{for(r=0;r<i.data.uiSelect.normalDateFormat.uiValues.length;r++)u={label:i.data.uiSelect.normalDateFormat.uiValues[r].label,value:i.data.uiSelect.normalDateFormat.uiValues[r].value,icon:"date"},s&u.label===t.dateFormatSelected&&(u.selected="selected"),f.push(u);i.dateFormatComboBox.update(f)}if(i.showTime){for(h=[],r=0;r<i.data.uiSelect.timesDateFormat.uiValues.length;r++)e={label:i.data.uiSelect.timesDateFormat.uiValues[r].label,value:i.data.uiSelect.timesDateFormat.uiValues[r].value,icon:"date"},e.value.format===t.timeFormatSelected&&(e.selected="selected"),h.push(e);i.timeFormatComboBox.update(h)}i.createSampleInputText()},createSampleInputText:function(){var t=this,n,u,i,r;r=$(".dateformat-modal-date-sample",t.dialogReference);t.showTime?(n=new Date,u={hour:n.getHours(),minute:n.getMinutes(),second:n.getSeconds()},i=t.timeFormatComboBox.getValue(),r.text($.datepicker.formatDate(t.dateFormatComboBox.getValue(),n)+" "+$.datepicker.formatTime(i.format,u,{ampm:i.ampm}))):(n=new Date,r.text($.datepicker.formatDate(t.dateFormatComboBox.getValue(),n)))},retrieveValues:function(n){var t,i,r;return n===null||n===undefined||n===""?(t=bizagi.localization.getResource("formmodeler-component-editor-dateformat-default-format"),i=""):(r=n.search(/h|H/),r==-1?(t=bizagi.util.trim(n.slice(0)),i=""):(t=bizagi.util.trim(n.slice(0,r)),i=n.slice(r))),{valueDate:t,valueTime:i}},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.dateformat").concat("#dateformat-frame")),this.loadTemplate("frame-options",bizagi.getTemplate("bizagi.editor.component.editor.dateformat").concat("#dateformat-frame-options")),this.loadTemplate("modal-content",bizagi.getTemplate("bizagi.editor.component.editor.dateformat").concat("#dateformat-modal")),this.loadTemplate("modal-actions-editor",bizagi.getTemplate("bizagi.editor.component.editor.dateformat").concat("#dateformat-modal-actions"))).done(function(){n.resolve()}),n.promise()},responseChangeDefaultFormat:function(n,t,i){var r,u,f;u=n;f=n?!0:!1;r=i.showTime?["dateformat-modal-short-date","dateformat-modal-date-format","dateformat-modal-time-format","dateformat-modal-date-sample"]:["dateformat-modal-short-date","dateformat-modal-date-format","dateformat-modal-date-sample"];u&&r.push("dateformat-modal-short-date-separator");f?i.changeItems("disabled",r,i.showTime,".dateformat-options-default-format-false"):i.changeItems("enabled",r,i.showTime,".dateformat-options-default-format-false")},responseChangeShortDate:function(n,t,i){var r,u;n?i.changeItems("enabled",["dateformat-modal-short-date-separator"],i.showTime,".dateformat-options-short-date-false"):i.changeItems("disabled",["dateformat-modal-short-date-separator"],i.showTime,".dateformat-options-short-date-false");n?(r=i.dateFormatComboBox.getLabel(),i.showTime?(u=i.timeFormatComboBox.value.format,i.populate(i.showTime,{dateFormatSelected:r,timeFormatSelected:u})):i.populate(i.showTime,{dateFormatSelected:r})):i.dateFormatComboBox.update(i.data.uiSelect.normalDateFormat.uiValues)},".dateformat-fields > input click":function(n){var t=this;t.openDialog(n)},".dateformat-fields > i:eq(1) click":function(n){var t=this;t.openDialog(n)},openDialog:function(n){var t=this,r,i;t.showDialog(n);r=t.retrieveValues(t.options.value);i=r.valueDate===bizagi.localization.getResource("formmodeler-component-editor-dateformat-default-format")?!0:!1;t.mySwitchDefaultFormat.update(i);t.responseChangeDefaultFormat(i,null,t)},responseOkButton:function(){var n=this,i,u,t,r,f;i=$(".dateformat-fields .dateformat-field-date",n.element);u=$(".dateformat-fields .dateformat-field-time",n.element);i.val("");u.val("");f=n.mySwitchDefaultFormat.getValue();this.hideDialog(function(){if(f)i.val("Default Format"),n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:n.inputValue,newValue:"",data:"",type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")}),n.inputValue="";else{t=n.dateFormatComboBox.getLabel();var e;n.showTime?(r=n.timeFormatComboBox.getValue(),i.val(t),u.val(r.format),n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:n.inputValue,newValue:t+" "+r.format,data:t+" "+r.format,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")}),n.inputValue=t+" "+r.format):(i.val(t),e={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:n.inputValue,newValue:t,data:t,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")},n.controller.publish("propertyEditorChanged",e),n.inputValue=t)}})},responseCancelButton:function(){this.hideDialog()},".editor-modal .header span:eq(0) click":function(){this.hideDialog()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.gridvalidations",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var r=this,i,u;i=$.tmpl(r.getTemplate("frame"),t);i.appendTo(n);u=$("label",i);r.addRequired(u)},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.gridvalidations").concat("#gridvalidations-frame"))).done(function(){n.resolve()}),n.promise()},".biz-action-validate click":function(n,t){var i=this;t.stopPropagation();i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_GRID_VALIDATIONS,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.selectprocess",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u=i.getEditorParameters(t);t.showLabel=u.showLabel=="undefined"?!0:u.showLabel;t.disabled=t.allowClick||!1;r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n)},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.selectprocess").concat("#selectprocess-frame"))).done(function(){n.resolve()}),n.promise()},getEditorParameters:function(n){return n["editor-parameters"]||{}},".biz-action-select-process click":function(n,t){var i=this;t.stopPropagation();i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_PROCESS,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.retype",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var u,i=this,r,f;if(i.paramsRetype=t["editor-parameters"],i.paramsHide=i.paramsRetype&&t["editor-parameters"].hide?t["editor-parameters"].hide:undefined,i.inline=!1,i.inline&&i.element.addClass("retype-inline"),$.extend(t,{uiValues:[{value:"duplicate",style:"bz-studio bz-duplicate-retype_16x16_standard",label:bizagi.localization.getResource("formmodeler-component-editor-retype-duplicate")},{value:"double",style:"bz-studio bz-double-retype_16x16_standard",label:bizagi.localization.getResource("formmodeler-component-editor-retype-double")},{value:"none",style:"bz-studio bz-none-retype_16x16_standard",label:bizagi.localization.getResource("formmodeler-component-editor-retype-none")}]}),t.value!="duplicate"&&t.value!="double"&&t.value!="none"&&(t.value="none"),i.paramsHide!=undefined)for(r=0;r<i.paramsHide.length;r++)i.paramsHide[r]==="duplicate"&&(t.uiValues=t.uiValues.slice(1,3));for(r=0;r<t.uiValues.length;r++)t.value===t.uiValues[r].value&&(t.uiValues[r].selected=!0);u=$.tmpl(this.getTemplate("frame"),t);u.appendTo(n);this.inputValue=t.value;f=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",u),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var t=this,n=$.Deferred();return $.when(t.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.retype").concat("#retype-frame"))).done(function(){n.resolve()}),n.promise()},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r}});
bizagi.editor.component.editor("bizagi.editor.component.editor.datalist",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var u=this,r,i,f=t.subproperties.length;for(r=$.tmpl(this.getTemplate("frame"),t),u.inputValues={},i=0;i<f;i++)u.inputValues[t.subproperties[i].property.name]=t.subproperties[i].property.value,t.subproperties[i].property["bas-type"]=="filter"||t.subproperties[i].property["bas-type"]=="xpath-from-entity"||t.subproperties[i].property["bas-type"]=="xpathfromentity"?this.renderExternal(r.find(".datalist-group"),t.subproperties[i].property):u.renderSubproperty(r.find(".datalist-group"),t.subproperties[i].property);r.appendTo(n);u.setAsCollapsible(r)},renderExternal:function(n,t){var i,r,u;t["user-editable"]=="true"&&(i=$.tmpl(this.getTemplate("external"),{}),t["bas-type"]=this.machineName(t["bas-type"]),bizagi.editor.component.editor[t["bas-type"]]===undefined?r=/^.*xpath.*$/ig.test(t["bas-type"])?new bizagi.editor.component.editor.xpath(i,t,this.controller):new bizagi.editor.component.editor.lstring(i,t,this.controller):(u=eval("var bafn = function(elExternal, dataProperty, controller) {  return new bizagi.editor.component.editor."+t["bas-type"]+"(elExternal, dataProperty, controller);};bafn"),r=u(i,t,this.controller)),i.appendTo(n),r.render())},machineName:function(n){return n.toLowerCase().replace(/-/g,"")},setAsCollapsible:function(n){var t=$(".ui-content",n);$("h3",n).bind("click",function(){t.slideToggle()})},renderSubproperty:function(n,t){var i,r;t["user-editable"]=="true"&&(i=$.tmpl(this.getTemplate("subproperty"),t),i.appendTo(n),r=$("label",i),self.addRequired(r))},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.datalist").concat("#datalist-frame")),this.loadTemplate("subproperty",bizagi.getTemplate("bizagi.editor.component.editor.datalist").concat("#datalist-subproperty")),this.loadTemplate("external",bizagi.getTemplate("bizagi.editor.component.editor.datalist").concat("#datalist-frame-external"))).done(function(){n.resolve()}),n.promise()},".datalist-group .datalist-subproperty-value keydown":function(n,t){t.stopPropagation();t.keyCode==13&&(this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValues[n.data("name")],newValue:n.val(),data:n.val(),type:n.data("name"),id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValues[n.data("name")]=n.val())},".datalist-group .datalist-subproperty-external click":function(n){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EDITOR_DATALIST,oldValue:this.inputValues[n.parent().find(".datalist-subproperty-value").data("name")],type:n.parent().find(".datalist-subproperty-value").data("name"),id:this.element.closest(".bizagi_editor_component_properties").data("id")})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.multiple",{init:function(n,t,i,r){var u=this;t=new bizagi.editor.component.editor.multiple.model(t);u._super(n,t,i);r.refProperties!==undefined&&(u.refProperties=r.refProperties)},renderEditor:function(n,t){var i=this,r;i.value=[];i.model.isExclusive()?(r=$.tmpl(i.getTemplate("frame-exclusive"),i.model.getModel()),i.renderExclusiveSubproperties(r.find(".multiple-category-group"))):(r=$.tmpl(i.getTemplate("frame"),t),$.each(i.model.getProperties(),function(n,t){i.renderSubproperty(r.find(".multiple-category-group"),t)}));r.appendTo(n);i.setAsCollapsible(r);i.hideSubproperties()},renderProperties:function(n,t){for(var r=this,u=r.model.getProperties(),i=0,f=u.length;i<f;i++)r.renderSubproperty(n,u[i],t)},renderExclusiveSubproperties:function(n){for(var i=this,r=i.model.getSelectedProperty(),t=0,u=r.length;t<u;t++)i.renderSubproperty(n,r[t],!0)},renderSubproperty:function(n,t,i){var r,u;if(t.notShow===undefined)if(r=$.tmpl(this.getTemplate("frame-property"),{}),t["bas-type"]=this.machineName(t["bas-type"]),/^.*xpath.*$/ig.test(t["bas-type"]))u=i===undefined?new bizagi.editor.component.editor.xpath(r,t,this.controller):new bizagi.editor.component.editor.xpath(r,$.extend({},t,{exclusive:!0}),this.controller),r.appendTo(n),u.render(),this.registerSubproperty(u);else if(bizagi.editor.component.editor[t["bas-type"]]===undefined)throw"Editor "+t["bas-type"]+" doesn't exists.";else u=i===undefined?new bizagi.editor.component.editor[t["bas-type"]](r,t,this.controller):new bizagi.editor.component.editor[t["bas-type"]](r,$.extend({},t,{exclusive:!0}),this.controller),r.appendTo(n),u.render(),this.registerSubproperty(u)},registerSubproperty:function(n){var t=this;t.refProperties[n.options.name]=n},machineName:function(n){return n.toLowerCase().replace(/-/g,"")},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.multiple").concat("#multiple-frame")),this.loadTemplate("frame-property",bizagi.getTemplate("bizagi.editor.component.editor.multiple").concat("#multiple-frame-property")),this.loadTemplate("frame-exclusive",bizagi.getTemplate("bizagi.editor.component.editor.multiple").concat("#multiple-frame-exclusive"))).done(function(){n.resolve()}),n.promise()},setAsCollapsible:function(n){var t=$(".ui-content",n);$("h3",n).bind("click",function(){t.slideToggle(function(){$(this).css("overflow","visible")})})},hideSubproperties:function(){var n=this;n.model.isExclusive()&&!n.model.hasValue()&&n.element.find(".multiple-category-group").empty()},updatePropertyToNone:function(){var n=this;n.model.hasValue()&&n.controller.publish("propertyEditorChanged",{newValue:undefined,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")})},".multiple-name click":function(n){var t=this,e,i,r,u,f;e=$(".multiple-name",this.element).index(n);n.hasClass("selected")||(n.hasClass("selected")?($(".multiple-name",this.element).removeClass("selected"),$(".biz-ico",this.element).addClass("multiple-ico-radio-uncheck").removeClass("multiple-ico-radio-check"),$(".biz-ico",n).addClass("multiple-ico-radio-check").removeClass("multiple-ico-radio-uncheck"),$(".biz-ico",this.element).addClass("bz-studio"),$(".biz-ico",this.element).addClass("bz-radio-unselected_16x16_standard").removeClass("bz-radio_16x16_standard"),$(".biz-ico",n).addClass("bz-radio_16x16_standard").removeClass("bz-radio-unselected_16x16_standard"),i=!1):($(".multiple-name",this.element).removeClass("selected"),$(".biz-ico",this.element).addClass("multiple-ico-radio-uncheck").removeClass("multiple-ico-radio-check"),$(".biz-ico",this.element).addClass("bz-studio"),$(".biz-ico",this.element).addClass("bz-radio-unselected_16x16_standard").removeClass("bz-radio_16x16_standard"),n.addClass("selected"),$(".biz-ico",n).addClass("multiple-ico-radio-check").removeClass("multiple-ico-radio-uncheck"),$(".biz-ico",n).addClass("bz-radio_16x16_standard").removeClass("bz-radio-unselected_16x16_standard"),i=!0),this.element.find(".multiple-category-group").empty(),r=this.model.isExclusive(),u=t.element.find(".multiple-category-group"),i?(f=t.model.getPropertyByIndex(e),f&&this.renderSubproperty(u,f,r)):t.renderProperties(u,r),n.hasClass("multiple-none-option")&&t.updatePropertyToNone())}});
$.Class.extend("bizagi.editor.component.editor.multiple.model",{subpropertyRegex:/[^.]*$/},{init:function(n){var t=this;t.data=n;t.properties={};t.parameters=n&&n["editor-parameters"];t.processData(n)},processData:function(n){var r=this,i,u,t;if(n.subproperties)for(i=0,u=n.subproperties.length;i<u;i++)t=n.subproperties[i],t=t.property,t.propertyName=r.Class.subpropertyRegex.exec(t.name)[0],t.selected=r.isMatchValue(t.propertyName),t.selectedcss=t.selected?" selected":"",r.properties[t.name]=t},getModel:function(){var n=this;return{caption:n.getCaption(),properties:n.getProperties(),isExclusive:n.isExclusive(),isEmpty:!n.hasValue(),noneCaption:n.getNodeCaption()}},getValue:function(){return this.data.value},isExclusive:function(){var n=this,t;return n.parameters?(t=bizagi.util.parseBoolean(n.parameters.exclusive),t?!0:!1):!1},isOnlyForUpdate:function(n){var t=n["editor-parameters"],i;return t?(i=bizagi.util.parseBoolean(t.onlyforupdate),i?!0:!1):!1},isMatchValue:function(n){var i=this,t=i.data.value;return t?t[n]?!0:!1:!1},hasValue:function(){return!bizagi.util.isEmpty(this.data.value)},getProperties:function(){var t=this,i=[],r,n;for(r in t.properties)t.properties.hasOwnProperty(r)&&(n=t.properties[r],t.isOnlyForUpdate(n)?n.selected&&i.push(n):i.push(n));return i},getSelectedProperty:function(){var n=this,t=n.getProperties();return n.getValue()?$.grep(t,function(n){return n.selected}):t},getPropertyByIndex:function(n){var t=this,i=t.getProperties();return i[n]},getCaption:function(){return this.data.caption||"Multiple"},getNodeCaption:function(){var t=this,n=t.data["editor-parameters"]||{};return n.noneCaption?bizagi.editor.utilities.resolveInternalResource(n.noneCaption):bizagi.localization.getResource("formmodeler-component-editor-multiple-none")}});
bizagi.editor.component.editor("bizagi.editor.component.editor.defaultvalue",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r;i.Error="";i.setEditorParameters(t);t.value||(t.value=i.getIntialValue());t.value.fixedvalue!==undefined&&t.value.fixedvalue!==""?i.state=!0:i.isEmptyRule(t.value)?(t.value=i.getIntialValue(),i.state=!0):i.state=!1;i.state=i.state||i.isOffline;r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);i.inputValue=t.value;i.type&&i.renderTypeEditor(r,t)},setEditorParameters:function(n){var t=this;t.exclusive=n["editor-parameters"].exclusive===undefined?!1:!0;t.isOffline=n["editor-parameters"].isOffline||!1;t.type=n["editor-parameters"].type;n.isOffline=t.isOffline},getIntialValue:function(){var n={fixedvalue:""};return n.rule={baref:{ref:"expression"}},n},retrieveHumanTime:function(n){var t=n.getHours(),i=n.getMinutes();return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+":"+i+":00"},renderTypeEditor:function(n,t){var i=this,r,s,h,u,f,e,o;switch(i.type){case"date":s=t["editor-parameters"].showtime.value===!0?"defaultvalue-show-time":"defaultvalue-not-show-time";$.extend(t,{showTime:s});i.renderDefaultDate(n,t);t["editor-parameters"].showtime.value===!0?$(".defaultvalue-date-container .defaultvalue-date-value",i.element).will_pickdate({timePicker:!0,allowEmpty:!0,militaryTime:!0,inputOutputFormat:"m/d/Y H:i:s",format:"m/d/Y H:i",onSelect:function(n){n=$.datepicker.formatDate("mm/dd/yy",n)+" "+i.retrieveHumanTime(n);r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:{fixedvalue:n},data:{fixedvalue:n},type:t.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.exclusive&&$.extend(r,{exclusive:!0});i.controller.publish("propertyEditorChanged",r);i.inputValue={fixedvalue:n}}}):$(".defaultvalue-date-container .defaultvalue-date-value",i.element).will_pickdate({allowEmpty:!0,militaryTime:!0,inputOutputFormat:"m/d/Y",format:"m/d/Y",onSelect:function(n){n=$.datepicker.formatDate("mm/dd/yy",n);r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:{fixedvalue:n},data:{fixedvalue:n},type:t.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.exclusive&&$.extend(r,{exclusive:!0});i.controller.publish("propertyEditorChanged",r);i.inputValue={fixedvalue:n}}});break;case"number":h=t["editor-parameters"].allowdecimals.value===!0?"defaultvalue-allowdecimals":"defaultvalue-not-allowdecimals";$.extend(t,{allowDecimals:h});this.renderDefaultNumber(n,t);t["editor-parameters"].allowdecimals.value===!0?(u=/(^$)|(^-?(0|[1-9][0-9]*)\.[0-9]+$)/,i.Error+=bizagi.localization.getResource("formmodeler-component-editor-int-error-integer")):(u=/(^$)|(^-?(0|[1-9][0-9]*)$)/,i.Error+=bizagi.localization.getResource("formmodeler-component-editor-int-error-integer"));$(".defaultvalue-number-container .defaultvalue-number-value",i.element).keydown(function(n){n.keyCode==13&&(u.test($(this).val())?(i.hideError($(this)),r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:{fixedvalue:$(this).val()},data:{fixedvalue:$(this).val()},type:t.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.exclusive&&$.extend(r,{exclusive:!0}),i.controller.publish("propertyEditorChanged",r),i.inputValue={fixedvalue:$(this).val()}):(i.showError($(this),i.Error),$(this).select()))});$(".defaultvalue-number-container .defaultvalue-number-value",i.element).blur(function(){u.test($(this).val())?(i.hideError($(this)),r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:{fixedvalue:$(this).val()},data:{fixedvalue:$(this).val()},type:t.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.exclusive&&$.extend(r,{exclusive:!0}),i.controller.publish("propertyEditorChanged",r),i.inputValue={fixedvalue:$(this).val()}):(i.showError($(this),i.Error),$(this).select())});break;case"string":this.renderDefaultString(n,t);$(".defaultvalue-string-value",i.element).keydown(function(n){n.keyCode==13&&(r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:{fixedvalue:$(this).val()},data:{fixedvalue:$(this).val()},type:t.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.exclusive&&$.extend(r,{exclusive:!0}),i.controller.publish("propertyEditorChanged",r),i.inputValue={fixedvalue:$(this).val()})});$(".defaultvalue-string-value",i.element).blur(function(){r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:{fixedvalue:$(this).val()},data:{fixedvalue:$(this).val()},type:t.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.exclusive&&$.extend(r,{exclusive:!0});i.controller.publish("propertyEditorChanged",r);i.inputValue={fixedvalue:$(this).val()}});break;case"boolean":(t.value.fixedvalue===undefined||t.value.fixedvalue===null)&&(t.value.fixedvalue="");e="";o="";t.value.fixedvalue===""?f="none":(f=t.value,t.value.fixedvalue===!0||t.value.fixedvalue=="true"?e=" selected":o=" selected");this.renderDefaultBoolean(n,$.extend(t,{booleanState:f.fixedvalue,selectedYes:e,selectedNo:o}));t.value.fixedvalue!==""&&n.find(".defaultvalue-boolean-value").addClass("active");$(".defaultvalue-boolean-value > .defaultvalue-boolean-button",i.element).click(function(){r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,type:t.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};$(".defaultvalue-boolean-value > .defaultvalue-boolean-button",i.element).removeClass("selected");$(this).addClass("selected");$(this).hasClass("defaultvalue-boolean-button-yes")?($.extend(r,{newValue:{fixedvalue:!0},data:{fixedvalue:!0}}),i.inputValue={fixedvalue:!0}):($.extend(r,{newValue:{fixedvalue:!1},data:{fixedvalue:!1}}),i.inputValue={fixedvalue:!1});i.exclusive&&$.extend(r,{exclusive:!0});i.controller.publish("propertyEditorChanged",r)});break;case"rule":this.renderDefaultRule(n,t)}},renderDefaultDate:function(n,t){var i;i=this.state?$.tmpl(this.getTemplate("frame-date-fixed"),t):this.renderRule(t);i.appendTo(n)},renderDefaultNumber:function(n,t){var i;i=this.state?$.tmpl(this.getTemplate("frame-number-fixed"),t):this.renderRule(t);i.appendTo(n)},renderDefaultString:function(n,t){var i;i=this.state?$.tmpl(this.getTemplate("frame-string-fixed"),t):this.renderRule(t);i.appendTo(n)},renderDefaultBoolean:function(n,t){var i;i=this.state?$.tmpl(this.getTemplate("frame-boolean-fixed"),t):this.renderRule(t);i.appendTo(n)},renderDefaultRule:function(n,t){var i;i=this.state?$.tmpl(this.getTemplate("frame-onlyrule"),t):this.renderRule(t);i.appendTo(n)},renderRule:function(n){var i=this,t=i.getRuleValue(n.value);return t.displayName!==undefined?t.displayName!=""?$.extend(n,{nameRule:t.displayName}):$.extend(n,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-defaultvalue-rule")}):$.extend(n,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-defaultvalue-rule")}),$.tmpl(this.getTemplate("frame-rule"),n)},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame")),this.loadTemplate("frame-date-fixed",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-date-fixed")),this.loadTemplate("frame-number-fixed",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-number-fixed")),this.loadTemplate("frame-string-fixed",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-string-fixed")),this.loadTemplate("frame-boolean-fixed",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-boolean-fixed")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-rule")),this.loadTemplate("frame-onlyrule",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-onlyrule"))).done(function(){n.resolve()}),n.promise()},editCreateRule:function(){var n=this,i,t;i=n.options.value.fixedvalue!=""?{fixedvalue:n.options.value.fixedvalue}:n.isEmptyRule(n.options.value)?{fixedvalue:""}:n.options.value;(n.options.value===undefined||n.options.value===null||n.options.value.fixedvalue)&&(n.options.value={rule:{baref:{ref:"expression"}}});t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,oldValue:i,type:n.options.name,data:n.options.value,id:n.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Scripting"};n.exclusive&&$.extend(t,{exclusive:!0});n.controller.publish("propertyEditorChanged",t);n.inputValue=n.options.value},isEmptyRule:function(n){var i=this,t=i.getRuleValue(n);return t?t.baref.ref==="expression":!0},getRuleValue:function(n){return n.rule||n.rule90},"i.defaultvalue-rule-external click":function(n,t){var i=this;i.editCreateRule(n,t)},".defaultvalue-rule-value .defaultvalue-image-rule-delete click":function(){var n=this,t;t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:n.inputValue,newValue:undefined,data:undefined,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.exclusive&&$.extend(t,{exclusive:!0});n.controller.publish("propertyEditorChanged",t);n.element.find(".defaultvalue-container div").empty();n.options.value={fixedvalue:"",rule:{baref:{ref:"expression"}}};n.state=!0;n.renderTypeEditor(n.element.find(".defaultvalue-container"),n.options)},".defaultvalue-image-fixed-delete click":function(){var n=this,t,i;i=n.element.find("input");i.length>0?n.element.find("input").val(""):n.element.find(".defaultvalue-boolean-value").removeClass("active");t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:n.inputValue,newValue:undefined,data:undefined,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.exclusive&&$.extend(t,{exclusive:!0});n.controller.publish("propertyEditorChanged",t)},".biz-complex-btn.defaultvalue-button-value click":function(n,t){var i=this,r=$(".defaultvalue-"+i.type+"-value",i.element);r.length>0?(r.addClass("active"),r.focus()):i.editCreateRule(n,t)},".biz-ico.defaultvalue-image-edit click":function(n,t){var i=this,r;r=i.type==="rule"?[]:$(".defaultvalue-"+i.type+"-value",i.element);r.length>0?(r.addClass("active"),r.focus()):i.editCreateRule(n,t)},".defaultvalue-rule-value .defaultvalue-button-value click":function(n,t){var i=this;i.type==="rule"&&i.editCreateRule(n,t)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.filterexpression",{defaultRule:{rule:{baref:{ref:"expression"}}},defaultFilter:{bafilter:{filter:"filter"}}},{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,u,r,f;i.properties={};i.findSubproperties(t);i.inputValue=t.value;u=i.getCurrentType(t.value);r={caption:t.caption,currentType:u.replace(/\ /g,"&nbsp;")};$.extend(r,i.properties);f=$.tmpl(i.getTemplate("frame"),r);f.appendTo(n)},isRule:function(){var n=this;return n.inputValue?n.inputValue.rule?!0:!1:!1},isFilter:function(){var n=this;return n.inputValue?n.inputValue.bafilter?!0:!1:!1},getCurrentType:function(n){var i=this,t=bizagi.localization.getResource("formmodeler-component-filterexpression-empty");return i.isRule()?t=null!=n.rule&&n.rule.displayName?n.rule.displayName:bizagi.localization.getResource("formmodeler-component-filterexpression-rule"):i.isFilter()&&(t=bizagi.localization.getResource("formmodeler-component-filterexpression-filter")),t},findSubproperties:function(n){var u=this,t,i,r;if(n.subproperties&&$.isArray(n.subproperties))for(t=0,i=n.subproperties.length;t<i;t++)r=n.subproperties[t].property,u.properties[r["bas-type"]]=!0},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var t=this,n=$.Deferred();return $.when(t.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.filterexpression").concat("#filterexpression-frame"))).done(function(){n.resolve()}),n.promise()},editCreateRule:function(){var n=this,t=n.Class.defaultRule,i;n.isRule()&&(t=n.inputValue);i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,type:n.options.name,data:t,id:n.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Scripting"};n.controller.publish("propertyEditorChanged",i)},editCreateFilter:function(){var n=this,t=n.Class.defaultFilter,i;n.isFilter()&&(t=n.inputValue);i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EDITOR_DATALIST,data:t,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",i)},deleteValue:function(){var n=this,t;n.inputValue&&(t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:undefined,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")},n.controller.publish("propertyEditorChanged",t))},"i.filterexpression-rule-external click":function(){var n=this;n.editCreateRule()},"i.filterexpression-filter-external click":function(){var n=this;n.editCreateFilter()},"i.filterexpression-delete-filter click":function(){var n=this;n.deleteValue()},"input.filterexpression-string-value click":function(){var n=this;n.inputValue&&(n.isRule()?n.editCreateRule():n.isFilter()&&n.editCreateFilter())}});
bizagi.editor.component.editor("bizagi.editor.component.editor.textformat",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var f,i=this,r,e=t.subproperties.length,u;for(i.values={},i.palette=[["transparent"],["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada"],["d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5"],["bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f"],["a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09"],["7f7f7f","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"],["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"]],f=$.tmpl(i.getTemplate("frame"),t),r=0;r<e;r++)i.values[t.subproperties[r].property.name]=t.subproperties[r].property.value,i.renderSubproperty(f,t.subproperties[r].property);if(i.initialValues=bizagi.clone(i.values),f.appendTo(n),i.setFontSize(t.subproperties),u=i.retrieveValueFontSize(t.subproperties),bizagi.util.isEmpty(u))i.refFontSize=parseInt($(".textformat-preview",this.element).css("font-size"));else if(/^(\+[1-9][0-9]*|0|-[1-9][0-9]*)$/.test(u))i.refFontSize=i.calculateFontSize(u);else throw"FontSize value error.";},closeSp:function(n,t){var i=$(t.target),r=$(".sp-container",$("body"));i.closest(r).length===0&&(n.spectrum("hide"),$(document).unbind("mousedown.closesp"))},setFontSize:function(n){for(var t,r,u,e=this,f,i=0;i<n.length;i++)if(f=n[i].property.name.split(".").pop(),f=="size"){t=n[i].property.value;t===null||t===undefined?t="0":/^(\+[1-9][0-9]*|0|-[1-9][0-9]*)$/.test(t)&&(r=$(".textformat-preview",this.element),t!="0"&&(u=parseInt(t.toString().substr(1)),e.registerCallback(function(){/^\+.*$/.test(t)?r.css({"font-size":parseInt(r.css("font-size"))+u+"px"}):r.css({"font-size":parseInt(r.css("font-size"))-u+"px"})})));$(".textformat-size-value",this.element).text(t);break}},calculateFontSize:function(n){var t,i,u=this,r=parseInt($(".textformat-preview",u.element).css("font-size"));return n=="0"?t=r:(i=parseInt(n.toString().substr(1)),t=/^\+.*$/.test(n)?r-i:r+i),t},retrieveValueFontSize:function(n){for(var i=null,r,t=0;t<n.length;t++)if(r=n[t].property.name.split(".").pop(),r=="size"){i=n[t].property.value;break}return i},renderSubproperty:function(n,t){var f=this,i,r,u=$(".textformat-preview",n),e=t.name.split(".").pop();switch(e){case"bold":r=t.value===null?"":t.value===!0||t.value=="true"?" selected":"";r==""?u.removeClass("bold"):u.addClass("bold");i=$.tmpl(this.getTemplate("bold"),{selected:r,property:this.options.name});i.appendTo(n.find(".textformat-actions"));break;case"italic":r=t.value===null?"":t.value===!0||t.value=="true"?" selected":"";r==""?u.removeClass("italic"):u.addClass("italic");i=$.tmpl(this.getTemplate("italic"),{selected:r,property:this.options.name});i.appendTo(n.find(".textformat-actions"));break;case"underline":r=t.value===null?"":t.value===!0||t.value=="true"?" selected":"";r==""?u.removeClass("underline"):u.addClass("underline");i=$.tmpl(this.getTemplate("underline"),{selected:r,property:this.options.name});i.appendTo(n.find(".textformat-actions"));break;case"strikethru":r=t.value===null?"":t.value===!0||t.value=="true"?" selected":"";r==""?u.removeClass("strikeout"):u.addClass("strikeout");i=$.tmpl(this.getTemplate("strikeout"),{selected:r,property:this.options.name});i.appendTo(n.find(".textformat-actions"));break;case"color":i=$.tmpl(this.getTemplate("font"),{property:this.options.name});i.appendTo(n.find(".textformat-actions"));t.value&&(t.value=t.value.toLowerCase(),u.css({color:t.value}));$("input.textformat-image-font",n).spectrum({color:t.value,showPaletteOnly:!0,palette:f.palette,change:function(i){var r,u=i.toRgbString();r=u==="rgba(0, 0, 0, 0)"?"":i.toHexString();$(".textformat-preview",n).css({color:r});f.changeProperty(t.name,r)},beforeShow:function(){return $(document).bind("mousedown.closesp",function(t){f.closeSp($("input.textformat-image-font",n),t)}),!0}});$(".sp-preview",n).addClass("biz-ico bz-studio bz-format-text-letter-a_16x16_standard");$(".sp-replacer",n).find(".sp-dd").remove();break;case"background":i=$.tmpl(this.getTemplate("background"),{property:this.options.name});i.appendTo(n.find(".textformat-actions"));t.value?(t.value=t.value.toLowerCase(),u.css({"background-color":t.value})):(t.value="transparent",u.css({"background-color":"transparent"}));$("input.textformat-image-background",n).spectrum({color:t.value,showPaletteOnly:!0,preferredFormat:"rgb",palette:f.palette,change:function(i){var r,u=i.toRgbString();r=u==="rgba(0, 0, 0, 0)"?"":i.toHexString();$(".textformat-preview",n).css({"background-color":r});f.changeProperty(t.name,r)},beforeShow:function(){return $(document).bind("mousedown.closesp",function(t){f.closeSp($("input.textformat-image-background",n),t)}),!0}});$(".sp-preview",n).addClass("biz-ico bz-studio bz-format-text-color-background_16x16_standard");$(".sp-replacer",n).find(".sp-dd").remove();break;case"size":i=$.tmpl(this.getTemplate("size"),{property:this.options.name});i.appendTo(n.find(".textformat-actions"))}},resetSubproperty:function(n){var t=$(".textformat-preview",this.element),i=n.split(".").pop();switch(i){case"bold":$(".textformat-actions .textformat-image-bold").removeClass("selected");t.removeClass("bold");break;case"italic":$(".textformat-actions .textformat-image-italic").removeClass("selected");t.removeClass("italic");break;case"underline":$(".textformat-actions .textformat-image-underline").removeClass("selected");t.removeClass("underline");break;case"strikethru":$(".textformat-actions .textformat-image-strikeout").removeClass("selected");t.removeClass("strikeout");break;case"color":$("input.textformat-image-font",this.element).spectrum("set","black");t.css("color","black");break;case"background":$("input.textformat-image-background",this.element).spectrum("set","");t.css("background-color","");break;case"size":t.css("font-size",this.refFontSize+"px");$(".textformat-size-value",this.element).text("0")}},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame")),this.loadTemplate("bold",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-bold")),this.loadTemplate("italic",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-italic")),this.loadTemplate("underline",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-underline")),this.loadTemplate("strikeout",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-strikeout")),this.loadTemplate("font",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-font")),this.loadTemplate("background",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-background")),this.loadTemplate("size",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-size"))).done(function(){n.resolve()}),n.promise()},changeProperty:function(n,t){var i;this.values[n]=t;i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.initialValues[n],newValue:t,type:n,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.controller.publish("propertyEditorChanged",i)},publishReset:function(){var t,n=$(".textformat-preview",this.element);$(".textformat-actions .textformat-image-bold").removeClass("selected");n.removeClass("bold");$(".textformat-actions .textformat-image-italic").removeClass("selected");n.removeClass("italic");$(".textformat-actions .textformat-image-strikeout").removeClass("selected");n.removeClass("strikeout");$(".textformat-actions .textformat-image-underline").removeClass("selected");n.removeClass("underline");$("input.textformat-image-background",this.element).spectrum("set","");n.css("background-color","");$("input.textformat-image-font",this.element).spectrum("set","black");n.css("color","black");n.css("font-size","17px");$(".textformat-size-value",this.element).text("0");t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.initialValues,newValue:this.initialValues,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.controller.publish("propertyEditorChanged",t)},".textformat-actions i.textformat-primary-control click":function(n){var t,r=n.data("preview-style"),i=n.data("property");n.toggleClass("selected");t=$(".textformat-preview",this.element);t.toggleClass(r);this.changeProperty(i,!this.values[i])},".textformat-actions i.textformat-tertiary-control click":function(n){var i=$(".textformat-preview",this.element),r=$(".textformat-size-value",this.element),f=n.data("property"),t,u=!0;n.hasClass("textformat-image-size-plus")?(t=parseInt(r.text()),t++,t<=20?(i.css({"font-size":parseInt(i.css("font-size"))+1+"px"}),r.text(t>0?"+"+t:t)):u=!1):(t=parseInt(r.text()),t--,t>=-9?(i.css({"font-size":parseInt(i.css("font-size"))-1+"px"}),r.text(t>0?"+"+t:t)):u=!1);u&&this.changeProperty(f,t>0?"+"+t:t)},".textformat-image-reset click":function(){this.publishReset()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.xpath",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var u,i=this,r,f;i.map=i.retrieveMapSubproperties(t.subproperties);i.xpathValue=r=bizagi.editor.utilities.getXpathObject(t.value);i.propertiesNames=i.getSubpropertiesNames(t.subproperties,i.map);t.readonly=i.options["editor-parameters"].readonly||!1;t.value=r===undefined?{baxpath:{xpath:""}}:r===null?{baxpath:{xpath:""}}:r;i.inputValue=t.value;switch(t["bas-type"]){case"xpathfromentity":typeof t.subproperties[0].property.value!=typeof t.value&&(t.value.baxpath.xpath="");i.renderXpathFromEntity(n,t);break;case"xpathtosimple":i.renderXpathToSimple(n,t);break;case"xpathtoentity":i.renderXpathToEntity(n,t);break;case"xpathtocollection":i.renderXpathToCollection(n,t);break;case"xpathtoentitytemplate":i.renderXpathToCollection(n,t);break;case"xpath":i.renderXpath(n,t);break;default:u=$.tmpl(i.getTemplate("frame"),t);u.appendTo(n);f=$("label",u);i.addRequired(f)}t.value.baxpath.xpath==""&&(t.value.baxpath.xpath="xpath")},getSubpropertiesNames:function(n){var i={},u,r,t;if(!n)return i;for(t=0;t<n.length;t++)r=n[t].property,u=r.name.split(".")[1],i[u]=r.name;return i},retrieveMapSubproperties:function(n){var t,i={},r;if(!n)return i;for(t=0;t<n.length;t++)r=n[t].property,i[r.name]=t;return i},renderXpath:function(n,t){var i,r,u=this;i=$.tmpl(this.getTemplate("xpath"),t);i.appendTo(n);r=$("label",i);u.addRequired(r)},renderXpathToCollection:function(n,t){var i,r,u=this;i=$.tmpl(this.getTemplate("xpathtocollection"),t);i.appendTo(n);r=$("label",i);u.addRequired(r)},renderXpathToEntity:function(n,t){var i,r,u=this;i=$.tmpl(this.getTemplate("xpathtoentity"),t);i.appendTo(n);r=$("label",i);u.addRequired(r)},renderXpathToSimple:function(n,t){var i,r,u=this;i=$.tmpl(this.getTemplate("xpathtosimple"),t);i.appendTo(n);r=$("label",i);u.addRequired(r)},renderXpathFromEntity:function(n,t){var i,r,u=this;i=$.tmpl(this.getTemplate("xpathfromentity"),t);i.appendTo(n);r=$("label",i);u.addRequired(r)},remove:function(){this.element.hide();this.element.empty()},positionXpathDialog:function(n){var t=n.offset();return{top:t.top+n.outerHeight(!0),left:t.left}},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-frame")),this.loadTemplate("xpathfromentity",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-xpathfromentity")),this.loadTemplate("xpathtosimple",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-xpathtosimple")),this.loadTemplate("xpathtoentity",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-xpathtoentity")),this.loadTemplate("xpathtocollection",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-xpathtocollection")),this.loadTemplate("xpath",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath"))).done(function(){n.resolve()}),n.promise()},".xpath.xpath-image-world click":function(){var n=this,t=n.element.find(".xpath-value"),i=n.positionXpathDialog(t),r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH,oldValue:n.inputValue,position:i,type:n.options.name,subproperties:n.propertiesNames,xpathValue:n.options.value,editor:n,editorParameters:n.options["editor-parameters"],id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",r)},".xpath-from-entity.xpath-image-world click":function(){var n=this,t=n.element.find(".xpath-value"),i=n.positionXpathDialog(t),r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_FROM_ENTITY,oldValue:n.inputValue,position:i,type:n.options.name,subproperties:n.propertiesNames,xpathValue:n.options.value,typeEditor:n.options["bas-type"],editor:n,editorParameters:n.options["editor-parameters"],id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",r)},".xpath-to-simple.xpath-image-world click":function(){var n=this,i=n.element.find(".xpath-value"),r=n.positionXpathDialog(i),t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_TO_SIMPLE,oldValue:n.inputValue,position:r,type:n.options.name,subproperties:n.propertiesNames,xpathValue:n.options.value,typeEditor:n.options["bas-type"],editorParameters:n.options["editor-parameters"],id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.options.hasOwnProperty("exclusive")&&(t=$.extend({},t,{exclusive:n.options.exclusive}));n.controller.publish("propertyEditorChanged",t)},".xpath-to-entity.xpath-image-world click":function(){var n=this,t=n.element.find(".xpath-value"),i=n.positionXpathDialog(t),r=n.element.closest(".bizagi_editor_component_properties").data("id");n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_TO_ENTITY,oldValue:n.inputValue,position:i,type:n.options.name,subproperties:n.propertiesNames,xpathValue:n.options.value,typeEditor:n.options["bas-type"],id:r})},".xpath-to-collection.xpath-image-world click":function(){var n=this,t=n.element.find(".xpath-value"),i=n.positionXpathDialog(t);n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_TO_COLLECTION,oldValue:n.inputValue,position:i,type:n.options.name,subproperties:n.propertiesNames,xpathValue:n.options.value,typeEditor:n.options["bas-type"],context:n.model["editor-parameters"]&&n.model["editor-parameters"].context!=null?n.model["editor-parameters"].context:null,id:n.element.closest(".bizagi_editor_component_properties").data("id")})},".biz-ico-default click":function(){var n=this,e=n.element.find(".xpath-value"),o=n.positionXpathDialog(e),r=!1,t={xpath:{},relatedentity:{}},i,u,f;if(n.options.subproperties)for(i=0;i<n.model.subproperties.length;i++)n.options.subproperties[i].property&&(r=n.options.subproperties[i].property["default"],r&&(u=n.options.subproperties[i].property.name.replace("xpath.",""),u=="xpath"?t.xpath=r:t.relatedentity=r));r||(t=undefined);f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:t,data:t,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",f);n.element.empty();n.options.value=t;n.renderEditor(this.element,n.options)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.editor.xpath.presenter",{},{init:function(n,t){this._super();this.canvas=n;this.model=t;this.create()},create:function(){this.xpathEditorNavigator=new bizagi.editor.component.xpathnavigator(this.canvas,this.model,this)},render:function(n,t){var i=this;i.model=n!==undefined?n:i.model;i.xpathEditorNavigator.updateModel(i.model);i.xpathEditorNavigator.render(t)},showXpath:function(n){return this.xpathEditorNavigator.showXpath(n)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.xpathmultiple",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var r,i=this,u,f;i.map=i.retrieveMapSubproperties(t.subproperties);i.xpathValue=u=t.value||[];i.propertiesNames=i.getSubpropertiesNames(t.subproperties,i.map);t.hasXpaths=t.value&&t.value.length>0?!0:!1;t.readonly=i.options["editor-parameters"].readonly||!1;i.inputValue=t.value;u.length==0&&(t.value={baxpath:{xpath:""}});r=$.tmpl(i.getTemplate("xpathframe"),t);r.appendTo(n);f=$("label",r);i.addRequired(f)},getSubpropertiesNames:function(n){var i={},u,r,t;if(!n)return i;for(t=0;t<n.length;t++)r=n[t].property,u=r.name.split(".")[1],i[u]=r.name;return i},retrieveMapSubproperties:function(n){var t,i={},r;if(!n)return i;for(t=0;t<n.length;t++)r=n[t].property,i[r.name]=t;return i},remove:function(){this.element.hide();this.element.empty()},positionXpathDialog:function(n){var t=n.offset();return{top:t.top+n.outerHeight(!0),left:t.left}},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("xpathframe",bizagi.getTemplate("bizagi.editor.component.editor.xpathmultiple").concat("#xpathmultiple-xpathframe"))).done(function(){n.resolve()}),n.promise()},".xpath-select click":function(){var n=this,i=n.element.find(".fileprint-item-container"),r=n.positionXpathDialog(i),t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_MULTIPLE,oldValue:n.inputValue,position:r,type:n.options.name,subproperties:n.propertiesNames,xpathValue:n.options.value,typeEditor:n.options["bas-type"],editorParameters:n.options["editor-parameters"],id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.options.hasOwnProperty("exclusive")&&(t=$.extend({},t,{exclusive:n.options.exclusive}));n.controller.publish("propertyEditorChanged",t)},".biz-ico-default click":function(){var n=this,e=n.element.find(".fileprint-item-container"),o=n.positionXpathDialog(e),r=!1,t={xpath:{},relatedentity:{}},i,u,f;if(n.options.subproperties)for(i=0;i<n.model.subproperties.length;i++)n.options.subproperties[i].property&&(r=n.options.subproperties[i].property["default"],r&&(u=n.options.subproperties[i].property.name.replace("xpath.",""),u=="xpath"?t.xpath=r:t.relatedentity=r));r||(t=undefined);f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:t,data:t,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",f);n.element.empty();n.options.value=t;n.renderEditor(this.element,n.options)},".interface-image-rule-delete click":function(n){var t=this,i=t.inputValue,r=n[0].id,f;r=Number(r.substring(7,8));i.splice(r,1);i.length==0&&(i=undefined);var e=t.element.find(".fileprint-item-container"),o=t.positionXpathDialog(e),u={xpath:{},relatedentity:{}};!1||(u=undefined);f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:i,data:u,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};t.controller.publish("propertyEditorChanged",f);t.element.empty();t.options.value=i;t.renderEditor(this.element,t.options)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.tags",{init:function(n,t,i){this._super(n,t,i)},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("tagsFrame",bizagi.getTemplate("bizagi.editor.component.editor.tags").concat("#tags-tagsframe"))).done(function(){n.resolve()}),n.promise()},renderEditor:function(n,t){var i=this,r=t["editor-parameters"]||{};$.when(r.tags).done(function(r){if(r=r||[],r.length>0){i.value=t.value?t.value:[];t.hasValue=i.value.length>0;i.container=n;t.tagsSelected=i.getTagsSelected(r);t.tags=r;var u=$.tmpl(i.getTemplate("tagsFrame"),t);u.appendTo(n)}})},isNewValue:function(n){var u=this,i=!0,f=u.value.length,t,r;if(f==0)return i;for(t=0;t<f;t++)if(r=u.value[t],(r.id||r)==n){i=!1;break}return i},getTagsSelected:function(n){var r=this,e=r.value.length,u=[],t,o,i,s,f;if(e==0)return u;for(t=0;t<e;t++)for(o=r.value[t].id||r.value[t],i=0,s=n.length;i<s;i++)f=n[i],f.key==o&&u.push(f);return u},updateProperty:function(){var n=this;n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:n.value,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")})},showValues:function(n,t){var i=this;$(document).bind("mouseup.tags",function(r){if(r.which==1){var u=i.element;u.has(r.target).length===0&&(i.hideValues(n,t),$(document).unbind("mouseup.tags"))}});t.slideDown(function(){$(this).addClass("tags-values-open")});n.addClass("tags-values-open")},refresh:function(n){var t=this,i=t.element.find("#tag-values");t.hideValues(n,i);t.container.empty();t.renderEditor(t.container,t.options)},hideValues:function(n,t){var i=this;t.slideUp(function(){$(this).removeClass("tags-values-open")});n.removeClass("tags-values-open")},".tag-select click":function(n,t){var i=this,r=i.element.find("#tag-values");t.stopPropagation();n.hasClass("tags-values-open")?i.hideValues(n,r):i.showValues(n,r)},".tag-item.tag-value click":function(n){var t=this,i=n.data("key");t.isNewValue(i)&&(t.value.push(n.data("key")),t.options.value=t.value,t.updateProperty());t.refresh(n)},".item-image-delete-tag click":function(n){var t=this,i=n.data("id");t.value.splice(i,1);t.updateProperty();t.refresh(n)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.stakeholders",{init:function(n,t,i){this._super(n,t,i)},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("stakeholdersFrame",bizagi.getTemplate("bizagi.editor.component.editor.stakeholders").concat("#stakeholders-stakeholdersframe"))).done(function(){n.resolve()}),n.promise()},renderEditor:function(n,t){var i=this,r=t["editor-parameters"]||{},u=r.stakeholders;$.when(u).done(function(r){i.value=t.value?t.value:[];t.hasValue=i.value.length>0;i.container=n;i.updateProperty();t.stakeholdersSelected=i.getStakeholdersSelected(r);t.stakeholders=r;var u=$.tmpl(i.getTemplate("stakeholdersFrame"),t);u.appendTo(n)})},isNewValue:function(n){var r=this,i=!0,t,u;if(l=r.value.length,l==0)return i;for(t=0;t<l;t++)if(u=r.value[t],u.baref.ref==n){i=!1;break}return i},getStakeholdersSelected:function(n){var u=this,f=u.value.length,i=[],t,e,r;if(f==0)return i;for(t=0;t<f;t++)for(e=bizagi.editor.utilities.resolveComplexReference(u.value[t]),j=0,k=n.length;j<k;j++)r=n[j],r.guid==e&&i.push(r);return i},refresh:function(n){var t=this,i=t.element.find("#stakeholder-values");t.hideValues(n,i);t.container.empty();t.renderEditor(t.container,t.options)},updateProperty:function(){var n=this;n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:n.value,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")})},showValues:function(n,t){var i=this;$(document).bind("mouseup.stakeholders",function(r){if(r.which==1){var u=i.element;u.has(r.target).length===0&&(i.hideValues(n,t),$(document).unbind("mouseup.stakeholders"))}});t.slideDown(function(){$(this).addClass("stakeholders-values-open")});n.addClass("stakeholders-values-open")},hideValues:function(n,t){var i=this;t.slideUp(function(){$(this).removeClass("stakeholders-values-open")});n.removeClass("stakeholders-values-open")},".stakeholder-select click":function(n,t){var i=this,r;t.stopPropagation();r=i.element.find("#stakeholder-values");n.hasClass("stakeholders-values-open")?i.hideValues(n,r):i.showValues(n,r)},".stakeholder-item.stakeholder-value click":function(n){var t=this,i=n.data("guid");t.isNewValue(i)&&(t.value.push(bizagi.editor.utilities.buildComplexReference(n.data("guid"))),t.options.value=t.value,t.updateProperty());t.refresh(n)},".item-image-delete-stakeholder click":function(n){var t=this,i=n.data("id");t.value.splice(i,1);t.updateProperty();t.refresh(n)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.resizer",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var r,i=this,f,e="auto",u=i.model.value,o=t["editor-parameters"];i.editorParameters=o;r=$.tmpl(i.getTemplate("horizontalResize"),t);r.appendTo(n);u!="auto"&&(f=parseInt(u).toString(),e=u.substring(f.length,u.length),r.find("#resizeWidth").val(u));o.isWidthColumnEditable||(r.find("#resizeWidth").attr("readonly",!0),i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-editable"),i.showErrorMessage(r.find("#resizeWidth"),i.Error),setTimeout(function(){$("#bizagi_editor_validator_container-columnwidth").css("top",25)},100));i.widthValue=f;i.measureType=e},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("horizontalResize",bizagi.getTemplate("bizagi.editor.component.editor.resizer").concat("#resizer-horizontal"))).done(function(){n.resolve()}),n.promise()},changeSize:function(n){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:n,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},validateSize:function(n,t){var i=this,u=parseInt(t).toString(),r;return t=="auto"||t==""?!0:isNaN(u)||(r=t.substring(u.length,t.length),r!="px"&&r!="%")?(i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-format"),i.showErrorMessage(n,i.Error),!1):Number(u)<1&&r=="px"?(i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-minimum"),i.showErrorMessage(n,i.Error),!1):Number(u)>100&&r=="%"?(i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-percent"),i.showErrorMessage(n,i.Error),!1):r=="%"&&Number(u)>i.editorParameters.percentMaxWidth?(i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-percent-available"),typeof i.Error=="string"?i.Error=i.Error.replace("{0}",i.editorParameters.percentMaxWidth):caption="",i.showErrorMessage(n,i.Error),!1):!0},showErrorMessage:function(n,t){var r=this,i=$(n);i.hasClass("error")||i.addClass("error");r.showError(n,t);i.select()},applyColumnWidth:function(n){var i=this,t=$(n).val(),u=i.model.value.width,r=t==""?"auto":t;i.validateSize(n,t)?i.changeSize(r):t="";$("#resizeWidth").val(t)},"input blur":function(n,t){var i=this;i.applyColumnWidth(n,t)},"input keydown":function(n,t){var i=this;event.keyCode==13&&i.applyColumnWidth(n,t)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.filter",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i,u,r=this;t.value?t.value.hasOwnProperty("bafilter")||(t.value={bafilter:{filter:bizagi.localization.getResource("formmodeler-component-editor-all-metadata-error"),contextentity:"",scopedefinition:""}}):t.value={bafilter:{filter:""}};r.inputValue=t.value;i=$.tmpl(r.getTemplate("frame"),t);i.appendTo(n);t.value.bafilter.filter==""&&(t.value.bafilter.filter="filter");u=$("label",i);r.addRequired(u)},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var t=this,n=$.Deferred();return $.when(t.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.filter").concat("#filter-frame"))).done(function(){n.resolve()}),n.promise()},".biz-ico-filter-value click":function(){var n=this,t;t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EDITOR_DATALIST,data:n.inputValue,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",t)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.interface",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i,r;t.value===undefined?t.value={baref:{ref:bizagi.localization.getResource("formmodeler-component-editor-interface-expression")}}:t.value===null&&(t.value={baref:{ref:bizagi.localization.getResource("formmodeler-component-editor-interface-expression")}});this.inputValue=t.value;r=t.name.replace(/\./gi,"-");t.title=bizagi.localization.getResource("formmodeler-component-editor-rule-validation-"+r);t.title==="formmodeler-component-editor-rule-validation-"+r&&(t.title="");t.value.baref.ref==bizagi.localization.getResource("formmodeler-component-editor-interface-expression")?i=$.tmpl(this.getTemplate("frame-empty"),t):(t.value.displayName!==undefined?t.value.displayName!=""?$.extend(t,{nameRule:t.value.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-interface-rule")}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-interface-rule")}),i=$.tmpl(this.getTemplate("frame-rule"),t));i.appendTo(n);$("input.interface-rule-value[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}});$(".interface-rule-value > .defaultvalue-button-value[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame-empty",bizagi.getTemplate("bizagi.editor.component.editor.interface").concat("#interface-frame-empty")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.interface").concat("#interface-frame-rule"))).done(function(){n.resolve()}),n.promise()},createEditRule:function(){var n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_INTERFACE,oldValue:this.inputValue,data:this.options.value,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.options.hasOwnProperty("exclusive")&&(n=$.extend({},n,{exclusive:this.options.exclusive}));this.controller.publish("propertyEditorChanged",n)},".interface-rule-value .interface-image-rule-delete click":function(){var t=this,n;this.element.find(".interface-container").empty();this.options.value={baref:{ref:bizagi.localization.getResource("formmodeler-component-editor-interface-expression")}};n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:undefined,data:undefined,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.options.hasOwnProperty("exclusive")&&$.extend(n,{exclusive:this.options.exclusive});this.controller.publish("propertyEditorChanged",n);this.renderEditor(this.element.find(".interface-container"),this.options)},".interface-rule-value .interface-image-rule-edit click":function(n,t){var i=this;i.createEditRule(n,t)},".defaultvalue-button-value click":function(n,t){var i=this;i.createEditRule(n,t)},".biz-ico.interface-image-external click":function(n,t){var i=this;i.createEditRule(n,t)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.formbase",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var r,u,f,e,o,s,h,c,i=this;e=t.allowNewForm===undefined?!0:t.allowNewForm;o=t.allowNone===undefined?!0:t.allowNone;t.value===undefined?t.value={baref:{ref:""}}:t.value===null&&(t.value={baref:{ref:""}});i.inputValue=t.value;i.editorParameters=t["editor-parameters"]||{};$.when(t.relatedForms).done(function(l){f=l||[];c=t.name.replace(/\./g,"-").toLowerCase();t.icon=c;t.value.baref.ref!=""&&(u=i.updateCaption(t.value,f),t.captionForm=u.caption,u.version&&(t.version=u.version));r=$.tmpl(i.getTemplate("frame"),t);var a=$("label",r);i.addRequired(a);o&&(h=$.tmpl(i.getTemplate("none"),{}),r.find(".form-menu").prepend(h));e&&(s=$.tmpl(i.getTemplate("newform"),{}),r.find(".form-menu").prepend(s));f.length>0&&$.each(f,function(n,t){i.renderParents(r.find(".form-submenu"),t)});r.appendTo(n);$(".form-button-caption[title]",r).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}})})},updateCaption:function(n,t){for(var u="",f="",r,e=!1,o=n.baref.ref,i=0;i<t.length;i++){if(o==t[i].guid){u=t[i].displayname;f=t[i].version;break}if(t[i].children)for(r=0;r<t[i].children.length;r++)if(o==t[i].children[r].guid){u=t[i].children[r].displayname;f=t[i].children[r].version;e=!0;break}if(e)break}return{caption:u,version:f}},renderParents:function(n,t){var i=this,r;i.parentHasChildren(t)?(r=t.guid==i.inputValue.baref.ref?$.tmpl(i.getTemplate("item-parent-children-checked"),t):$.tmpl(i.getTemplate("item-parent-children-unchecked"),t),r.data("info",t),$.each(t.children,function(n,t){i.renderChild(r.find("ul"),t)})):(r=t.guid==i.inputValue.baref.ref?$.tmpl(i.getTemplate("item-parent-no-children-checked"),t):$.tmpl(i.getTemplate("item-parent-no-children-unchecked"),t),r.data("info",t));r.appendTo(n)},renderChild:function(n,t){var i=this,r;t.icon=i.options.icon;r=t.guid==i.inputValue.baref.ref?$.tmpl(i.getTemplate("item-child-checked"),t):$.tmpl(i.getTemplate("item-child-unchecked"),t);r.data("info",t);r.appendTo(n)},parentHasChildren:function(n){var t=!0;return n.children===undefined?t=!1:n.children===null?t=!1:n.children.length<=0&&(t=!1),t},getDataForms:function(){return[{guid:"GUID-FORM-1",displayname:"Group Form 1",version:"1.0",children:[{guid:"GUID-FORM-1-1",displayname:"Form 1, G1",version:"1.0"},{guid:"GUID-FORM-1-2",displayname:"Form 2, G1",version:"1.5",selected:!0}]},{guid:"GUID-GUID",displayname:"Group Form A",version:"3.141592",children:null},{guid:"GUID-FORM-2",displayname:"Group Form 2",version:"1.0",children:[{guid:"GUID-FORM-2-1",displayname:"Form 1, G2",version:"1.0"}]},{guid:"GUID-FORM-3",displayname:"Group Form 3",version:"1.0",children:[{guid:"GUID-FORM-3-1",displayname:"Form 1, G3",version:"2.0"},{guid:"GUID-FORM-3-2",displayname:"Form 2, G3",version:"1.0"}]}]},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-frame")),this.loadTemplate("newform",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-newform")),this.loadTemplate("none",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-none")),this.loadTemplate("item-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-unchecked")),this.loadTemplate("item-checked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-checked")),this.loadTemplate("item-parent-no-children-checked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-parent-no-children-checked")),this.loadTemplate("item-parent-no-children-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-parent-no-children-unchecked")),this.loadTemplate("item-child-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-child-unchecked")),this.loadTemplate("item-child-checked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-child-checked")),this.loadTemplate("item-parent-children-checked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-parent-children-checked")),this.loadTemplate("item-parent-children-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-parent-children-unchecked"))).done(function(){n.resolve()}),n.promise()},closeMenu:function(n,t){t.slideUp(function(){$(this).removeClass("form-open")});n.removeClass("form-open")},openMenu:function(n,t){var i=this;$(document).bind("mouseup.formbase",function(r){if(r.which==1){var u=i.element;u.has(r.target).length===0&&(i.closeMenu(n,t),$(document).unbind("mouseup.formbase"))}});t.slideDown(function(){$(this).addClass("form-open")});n.addClass("form-open")},toggleForm:function(n){var t=n.closest(".form-item-expandable").find("ul");t.is(":visible")?(n.addClass("form-image-plus").removeClass("form-image-minus"),t.hide()):(n.addClass("form-image-minus").removeClass("form-image-plus"),t.show())},".form-button-dropdown click":function(n,t){var i=this,r=$(".form-menu",this.element);n.hasClass("form-open")?i.closeMenu(n,r):i.openMenu(n,r);t.stopPropagation()},".form-image-minus click":function(n,t){var i=this;i.toggleForm(n);t.stopPropagation()},".form-image-plus click":function(n,t){var i=this;i.toggleForm(n);t.stopPropagation()}});
bizagi.editor.component.editor.formbase("bizagi.editor.component.editor.form",{init:function(n,t,i){this._super(n,t,i)},".form-button-caption click":function(n,t){var i=this;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_BUTTON,value:i.inputValue,id:this.element.closest(".bizagi_editor_component_properties").data("id")});$(".form-button-dropdown",this.element).hasClass("form-open")&&$(".form-button-dropdown",this.element).removeClass("form-open");$(".form-menu",this.element).hasClass("form-open")&&$(".form-menu",this.element).removeClass("form-open");t.stopPropagation()},".form-newform click":function(n,t){var i=this,r,u;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NEW,propertyName:i.model.name,context:"form",id:this.element.closest(".bizagi_editor_component_properties").data("id"),showForm:i.editorParameters.showForm});r=$(".form-button-dropdown",this.element);u=$(".form-menu",this.element);i.closeMenu(r,u);t.stopPropagation()},".form-none click":function(n,t){var i=this,r,u;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NONE,propertyName:i.model.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")});$(".form-button-dropdown",this.element).removeClass("form-open");r=$(".form-button-dropdown",this.element);u=$(".form-menu",this.element);i.closeMenu(r,u);t.stopPropagation()},".form-submenu li.form-item-selectable click":function(n,t){var i=this,r=n.data("info"),u,f,e;e={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_OPTION,propertyName:i.model.name,form:r.guid,value:i.inputValue,id:this.element.closest(".bizagi_editor_component_properties").data("id"),showForm:i.editorParameters.showForm};this.controller.publish("propertyEditorChanged",e);this.inputValue={baref:{ref:r.guid}};u=$(".form-button-dropdown",this.element);f=$(".form-menu",this.element);i.closeMenu(u,f);t.stopPropagation()}});
bizagi.editor.observableClass.extend("bizagi.editor.component.editor.form.presenter",{},{init:function(n){var t=this;t._super();n=n||{};t.canvas=n.canvas||$("<div />");t.model=n.model||{};t.formEditor=new bizagi.editor.component.editor.form(t.canvas,t.model,t)},getGuid:function(){return this.model.getGuid()},refresh:function(n){var t=this;t.gridcolumneditor.refresh(n)},render:function(){var n=this;n.formEditor.render()},destroy:function(){self.gridcolumneditor.destroy()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.searchformbase",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var r,f,e,o,s,h,i=this,u,c;e=t.allowNewForm===undefined?!0:t.allowNewForm;o=t.allowNone===undefined?!0:t.allowNone;i.values=[];t.value===undefined?t.value=[]:t.value===null?t.value=[]:i.values=i.retrieveSelectedValues(t.value);i.inputValue=t.value;$.when(t.relatedForms).done(function(l){f=l||[];t.name=="searchforms"&&(t.icon="searchform-image-form");var a=[];if(t.value.length!==0)for(a=i.retrieveCaptions(i.values,f),r=$.tmpl(i.getTemplate("frame-empty"),t),u=a.length-1;u>=0;u--)c=$.tmpl(i.getTemplate("caption"),{caption:a[u],version:i.versions[u],icon:t.name=="searchforms"?"searchform-image-form":t.icon}),r.find(".searchform-captions").prepend(c);else r=$.tmpl(i.getTemplate("frame"),t);o&&(h=$.tmpl(i.getTemplate("none"),{}),r.find(".searchform-menu").prepend(h));e&&(s=$.tmpl(i.getTemplate("newform"),{}),r.find(".searchform-menu").prepend(s));f.length>0&&$.each(f,function(n,t){i.renderParents(r.find(".searchform-submenu"),t)});r.appendTo(n)})},retrieveVersion:function(){return null},retrieveSelectedValues:function(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t].baref.ref);return i},retrieveCaptions:function(n,t){var i,r,u=[],f=this;for(f.versions=[],i=0;i<t.length;i++)if($.inArray(t[i].guid,n)!==-1&&(u.push(t[i].displayname),f.versions.push(t[i].version)),t[i].hasOwnProperty("children")&&t[i].children!==null)for(r=0;r<t[i].children.length;r++)$.inArray(t[i].children[r].guid,n)!==-1&&(u.push(t[i].children[r].displayname),f.versions.push(t[i].children[r].version));return u},renderParents:function(n,t){var i=this,r;i.parentHasChildren(t)?(r=$.inArray(t.guid,i.values)!==-1?$.tmpl(i.getTemplate("item-parent-children-checked"),t):$.tmpl(i.getTemplate("item-parent-children-unchecked"),t),r.data("info",t),$.each(t.children,function(n,t){i.renderChild(r.find("ul"),t)})):(r=$.inArray(t.guid,i.values)!==-1?$.tmpl(i.getTemplate("item-parent-no-children-checked"),t):$.tmpl(i.getTemplate("item-parent-no-children-unchecked"),t),r.data("info",t));r.appendTo(n)},renderChild:function(n,t){var i=this,r;r=$.inArray(t.guid,i.values)!==-1?$.tmpl(i.getTemplate("item-child-checked"),t):$.tmpl(i.getTemplate("item-child-unchecked"),t);r.data("info",t);r.appendTo(n)},parentHasChildren:function(n){var t=!0;return n.children===undefined?t=!1:n.children===null?t=!1:n.children.length<=0&&(t=!1),t},getDataForms:function(){return[{guid:"GUID-FORM-1",displayname:"Group Form 1",version:"1.0",children:[{guid:"GUID-FORM-1-1",displayname:"Form 1, G1",version:"1.0"},{guid:"GUID-FORM-1-2",displayname:"Form 2, G1",version:"1.5"}]},{guid:"GUID-GUID",displayname:"Group Form A",version:"3.141592",children:null},{guid:"GUID-FORM-2",displayname:"Group Form 2",version:"1.0",children:[{guid:"GUID-FORM-2-1",displayname:"Form 1, G2",version:"1.0"}]},{guid:"GUID-FORM-3",displayname:"Group Form 3",version:"1.0",children:[{guid:"GUID-FORM-3-1",displayname:"Form 1, G3",version:"2.0"},{guid:"GUID-FORM-3-2",displayname:"Form 2, G3",version:"1.0"}]}]},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-frame")),this.loadTemplate("frame-empty",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-frame-empty")),this.loadTemplate("caption",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-caption")),this.loadTemplate("newform",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-newform")),this.loadTemplate("none",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-none")),this.loadTemplate("item-parent-no-children-checked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-parent-no-children-checked")),this.loadTemplate("item-parent-no-children-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-parent-no-children-unchecked")),this.loadTemplate("item-parent-children-checked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-parent-children-checked")),this.loadTemplate("item-parent-children-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-parent-children-unchecked")),this.loadTemplate("item-child-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-child-unchecked")),this.loadTemplate("item-child-checked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-child-checked"))).done(function(){n.resolve()}),n.promise()},closeMenu:function(n,t){var i=this;t.slideUp(function(){$(this).removeClass("searchform-open")});n.removeClass("searchform-open")},openMenu:function(n,t){var i=this;$(document).bind("mouseup.searchformbase",function(r){if(r.which==1){var u=i.element;u.has(r.target).length===0&&(i.closeMenu(n,t),$(document).unbind("mouseup.searchformbase"))}});t.slideDown(function(){$(this).addClass("searchform-open")});n.addClass("searchform-open")},toggleForm:function(n){var t=n.closest(".searchform-item-expandable").find("ul");t.is(":visible")?(n.addClass("searchform-image-plus").removeClass("searchform-image-minus"),t.hide()):(n.addClass("searchform-image-minus").removeClass("searchform-image-plus"),t.show())},".searchform-button-dropdown click":function(n,t){var i=this,r=$(".searchform-menu",this.element);n.hasClass("searchform-open")?i.closeMenu(n,r):i.openMenu(n,r);t.stopPropagation()},".searchform-image-minus click":function(n,t){var i=this;i.toggleForm(n);t.stopPropagation()},".searchform-image-plus click":function(n,t){var i=this;i.toggleForm(n);t.stopPropagation()}});
bizagi.editor.component.editor.searchformbase("bizagi.editor.component.editor.searchform",{init:function(n,t,i){this._super(n,t,i)},".searchform-button-caption click":function(n,t){var i=this;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_BUTTON,value:i.inputValue,id:this.element.closest(".bizagi_editor_component_properties").data("id")});$(".searchform-button-dropdown",this.element).hasClass("searchform-open")&&$(".searchform-button-dropdown",this.element).removeClass("searchform-open");$(".searchform-menu",this.element).hasClass("searchform-open")&&$(".searchform-menu",this.element).removeClass("searchform-open");t.stopPropagation()},".searchform-newform click":function(n,t){var i=this;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NEW,propertyName:i.model.name,context:"searchform",id:this.element.closest(".bizagi_editor_component_properties").data("id")});$(".searchform-button-dropdown",this.element).removeClass("searchform-open");$(".searchform-menu",this.element).removeClass("searchform-open");t.stopPropagation()},".searchform-none click":function(n,t){var i=this;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NONE,propertyName:i.model.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")});$(".searchform-button-dropdown",this.element).removeClass("searchform-open");$(".searchform-menu",this.element).removeClass("searchform-open");t.stopPropagation()},".searchform-submenu li.searchform-item-selectable click":function(n,t){var i=this,e=n.data("info"),r,u,f;r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_OPTION,propertyName:i.model.name,form:e.guid,value:i.inputValue,context:"searchform",id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.controller.publish("propertyEditorChanged",r);u=$(".searchform-button-dropdown",this.element);f=$(".searchform-menu",this.element);i.closeMenu(u,f);t.stopPropagation()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.selecttemplate",{types:{NONE:"none",DEFAULT:"default",TEMPLATE:"template"}},{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u=i.editorParameters=t["editor-parameters"]||{};$.when(u.templates).done(function(f){var o=i.templates=f||[],e;i.value=t.value;t.selectedValue=i.getSelectedValue(t.value);r=$.tmpl(i.getTemplate("frame"),$.extend(t,{templates:o}));e=$.tmpl(i.getTemplate("options"),{disableNoneOption:bizagi.util.parseBoolean(u.disableNoneOption)});r.find(".selecttemplate-menu").prepend(e);r.appendTo(n)})},remove:function(){this.element.hide();this.element.empty()},getSelectedValue:function(n){var t=this,i={},r,e,u,o,f;if(!n)return r=t.editorParameters.templatetype||"",r=r.toUpperCase(),t.Class.types[r]&&(i.displayName=bizagi.localization.getResource("formmodeler-component-editor-selecttemplate-"+t.Class.types[r])),i;if(t.templates.length==0)return i;for(e=bizagi.editor.utilities.resolveComplexReference(n),u=0,o=t.templates.length;u<o;u++)if(f=t.templates[u],f.guid==e){i=f;break}return i},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.selecttemplate").concat("#selecttemplate-frame")),this.loadTemplate("options",bizagi.getTemplate("bizagi.editor.component.editor.selecttemplate").concat("#selecttemplate-options")),this.loadTemplate("default",bizagi.getTemplate("bizagi.editor.component.editor.selecttemplate").concat("#selecttemplate-default"))).done(function(){n.resolve()}),n.promise()},getEditorParameters:function(n){return n["editor-parameters"]||{}},closeMenu:function(n,t){var i=this;t.slideUp(function(){$(this).removeClass("selecttemplate-open")});n.removeClass("selecttemplate-open")},isSameItem:function(n){var t=this;return t.value?bizagi.editor.utilities.resolveComplexReference(t.value)==n:!1},openMenu:function(n,t){var i=this;$(document).bind("mouseup.selecttemplate",function(r){if(r.which==1){var u=i.element;u.has(r.target).length===0&&(i.closeMenu(n,t),$(document).unbind("mouseup.selecttemplate"))}});t.slideDown(function(){$(this).addClass("selecttemplate-open")});n.addClass("selecttemplate-open")},setTemplatetype:function(n){var t=this;t.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:n,type:"templatetype",id:t.element.closest(".bizagi_editor_component_properties").data("id")})},".selecttemplate-none click":function(n,t){var i=this;i.setTemplatetype(i.Class.types.NONE);i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_TEMPLATE_NONE,propertyName:i.model.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")});$(".selecttemplate-button-dropdown",this.element).removeClass("selecttemplate-open");$(".selecttemplate-menu",this.element).removeClass("selecttemplate-open");t.stopPropagation()},".selecttemplate-default click":function(n,t){var i=this;i.setTemplatetype(i.Class.types.DEFAULT);i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NONE,propertyName:i.model.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")});$(".selecttemplate-button-container selecttemplate-button-caption").text(bizagi.localization.getResource("formmodeler-component-editor-selecttemplate-default"));$(".selecttemplate-button-dropdown",this.element).removeClass("selecttemplate-open");$(".selecttemplate-menu",this.element).removeClass("selecttemplate-open");t.stopPropagation()},".selecttemplate-button-dropdown click":function(n,t){var i=this,r=$(".selecttemplate-menu",this.element);n.hasClass("selecttemplate-open")?i.closeMenu(n,r):i.openMenu(n,r);t.stopPropagation()},".selecttemplate-item click":function(n){var t=this,i=n.data("guid");t.isSameItem(i)||(t.setTemplatetype(t.Class.types.TEMPLATE),t.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:bizagi.editor.utilities.buildComplexReference(i),type:t.options.name,id:t.element.closest(".bizagi_editor_component_properties").data("id")}))},".selecttemplate-button-caption click":function(){var n=this;n.value&&n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_BUTTON,value:n.value,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},".selecttemplate-newtemplate click":function(){var n=this;n.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_WIZARD_TEMPLATES,propertyName:n.model.name,context:"template",id:this.element.closest(".bizagi_editor_component_properties").data("id")})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.rule",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r;t.value===undefined?t.value={baref:{ref:"expression"}}:t.value===null&&(t.value={baref:{ref:"expression"}});i.subproperties=t.subproperties;i.inputValue=t.value;r=t.name.replace(/\./gi,"-");t.title=bizagi.localization.getResource("formmodeler-component-editor-rule-validation-"+r);t.title==="formmodeler-component-editor-rule-validation-"+r&&(t.title="");i.renderRuleEditor(n,t)},renderRuleEditor:function(n,t){var i,r=this,u=r.getRuleValue(t.value),f=u?u.baref:t.value.baref;f.ref=="expression"?i=$.tmpl(r.getTemplate("frame-empty"),t):($.extend(t,{nameRule:"",title:""}),t.value.rule&&t.value.rule.displayName!==undefined?t.value.rule.displayName!=""?$.extend(t,{nameRule:t.value.rule.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-rule-expression")}):t.value.displayName!==undefined?t.value.displayName!=""?$.extend(t,{nameRule:t.value.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-rule-expression")}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-rule-expression")}),i=$.tmpl(r.getTemplate("frame-rule"),t));i.appendTo(n);$("input.rule-value[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}});$(".rule-internal-container > .defaultvalue-button-value[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}})},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame-empty",bizagi.getTemplate("bizagi.editor.component.editor.rule").concat("#rule-frame-empty")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.rule").concat("#rule-frame-rule"))).done(function(){n.resolve()}),n.promise()},createEditRule:function(){var n=this,i=n.isRule90()?"rule90":"rule",t={},u,r;t[i]=n.options.value;t[i].rule&&(t[i]=t[i].rule);u=n.model["editor-parameters"]?n.model["editor-parameters"].type:"Scripting";r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,oldValue:n.inputValue,type:n.options.name,data:t,newValue:n.options.value,id:n.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:u||"Scripting",context:n.model["editor-parameters"]?n.model["editor-parameters"].context:undefined,editor:n.hasRuleSubproperty()?"":"rule"};n.options.hasOwnProperty("exclusive")&&(r=$.extend({},r,{exclusive:n.options.exclusive}));n.controller.publish("propertyEditorChanged",r);n.inputValue=n.options.value},getRuleValue:function(n){return n.rule||n.rule90},isRule90:function(){var n=this;return n.options.name.indexOf("90")>=0},hasRuleSubproperty:function(){var n=this,t;return n.subproperties&&$.isArray(n.subproperties)?(t=n.subproperties[0].property||{},t["bas-type"]?t["bas-type"]=="rule":!1):!1},"i.rule-external click":function(n,t){var i=this;i.createEditRule(n,t)},".biz-complex-btn.defaultvalue-button-value click":function(n,t){var i=this;i.createEditRule(n,t)},".rule-internal-container .rule-image-edit click":function(n,t){var i=this;i.createEditRule(n,t)},".rule-internal-container .rule-image-delete click":function(){var n=this,t;n.element.find(".rule-container").empty();t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:n.inputValue,newValue:undefined,data:undefined,type:n.options.name,id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.options.hasOwnProperty("exclusive")&&$.extend(t,{exclusive:n.options.exclusive});n.controller.publish("propertyEditorChanged",t);n.options.value={baref:{ref:"expression"}};n.renderRuleEditor(n.element.find(".rule-container"),n.options)}});
bizagi.editor.component.editor("bizagi.editor.component.editor.orientation",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-orientation-ltr"),style:"bz-studio bz-orientation-left-to-right_16x16_standard",value:"ltr"},{label:bizagi.localization.getResource("formmodeler-component-editor-orientation-rtl"),style:"bz-studio bz-orientation-right-to-left_16x16_standard",value:"rtl"},{label:bizagi.localization.getResource("formmodeler-component-editor-orientation-inherited"),style:"bz-studio bz-orientation-inherited_16x16_standard",value:"inherited"}],valueCheck:!1});t.value===undefined?t.value="ltr":t.value===null&&(t.value="ltr");i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);i.inline&&r.addClass("bizagi-editor-orientation-inline");r.appendTo(n);u=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},responseChangeCombo:function(n,t,i){var u,r,f;u=i.inputValue;r=n;f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",f);i.inputValue=r},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.orientation").concat("#orientation-frame"))).done(function(){n.resolve()}),n.promise()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.queryinternalsdefaultvalues",{cache:{application:[],processVersion:[],task:[],position:[],processClass:[]}},{init:function(n,t,i){this._super(n,t,i);this.focus=null},renderEditor:function(n,t){var i=this,r;t.value&&t.value.fixedvalue||(t.value=i.getIntialValue());t.loadingMessage=bizagi.localization.getResource("webpart-render-loading");r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);i.inputValue=t.value;i.loadData(t,n)},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.queryinternalsdefaultvalues").concat("#queryinternals-defaultvalue-frame"))).done(function(){n.resolve()}),n.promise()},getIntialValue:function(){return{fixedvalue:-1,name:""}},loadData:function(n,t){var i=this;$(".ui-control-input",t).click(function(){t.find(".queryinternals-defaultvalue-value").toggleClass("active");t.find(".queryinternals-defaultvalue-action-btn").toggleClass("active");n.value.name===""&&$("i[name=expanded].queryinternals-biz-wp-tree-icon").removeClass("bz-tree-less_16x16_standard").addClass("bz-tree-show-more_16x16_standard");setTimeout(function(){var r=n["editor-parameters"].type,u=$(".queryinternals-defaultvalue-value-loading"),f,e;i.Class.cache[r].length==0?(f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_LOAD_METADATA,id:i.element.closest(".bizagi_editor_component_properties").data("id")},u.startLoading({delay:0,overlay:!0}),$.when(i.controller.publish("propertyEditorChanged",f)).done(function(u){u?(i.renderEditorCanvas(u,t),i.renderEditorListHandlers(t,n),i.expandTree(n,t),i.Class.cache[r]=u):(t.find(".queryinternals-defaultvalue-value").toggleClass("active"),t.find(".queryinternals-defaultvalue-action-btn").toggleClass("active"))}).fail(function(n){bizagi.log(n)}).done(function(){u.endLoading()})):(e=$(".queryinternals-defaultvalue-value").has("ul").length,e==0&&(i.renderEditorCanvas(i.Class.cache[r],t),i.renderEditorListHandlers(t,n),i.expandTree(n,t)))},70)});$("#queryinternals-defaultvalue-action-btn",t).click(function(){var r=$("#data-queryinternals-defaultvalue-frame span",t);r.text("");i.updateValue(r,n,t,!0);t.find(".queryinternals-defaultvalue-value").removeClass("active");t.find(".queryinternals-defaultvalue-action-btn").removeClass("active");i.expandTree(n,t)})},renderEditorCanvas:function(n,t){var o=this,r=$("<div>"),u,f,i,e;u="<i name='expanded' class='queryinternals-biz-wp-tree-icon biz-ico queryinternals-biz-wp-tree-expand-icon bz-studio bz-tree-show-more_16x16_standard'><\/i>";f="<i class='queryinternals-biz-wp-tree-icon queryinternals-biz-wp-tree-image-";i=o.renderEditorCanvasChildrens(n,u,f);i.attr("id","queryinternals-defaultvalue-mainList");i.appendTo(r);e=$.tmpl(r,{});$(".queryinternals-defaultvalue-value",t).html(e)},renderEditorCanvasChildrens:function(n,t,i){var h=this,f,r,e,c,o,l,a,u,s=$("<ul>"),v={application:{style:"bz-studio bz-application_16x16_standard"},process:{style:"bz-studio bz-processes_16x16_standard"},processClass:{style:"bz-studio bz-processes_16x16_standard"},task:{style:"bz-studio bz-m-task_16x16_standard"},position:{style:"bz-studio bz-object-position_16x16_standard"},processVersion:{style:"bz-studio bz-new-version_16x16_standard"},organization:{style:"bz-studio bz-organization_16x16_standard"},loading:{style:"bz-studio bz-m-custom-artifact_16x16_standard"}};return $.each(n,function(n,y){r=h.convertTypeString(y.Type);a=y.IdObject;e=y.DisplayName;u=y.Id;c=r?v[r].style:"";o=i+r+" "+c+"'><\/i>";y.Children!=null&&y.Children.length>0?(f=$("<li  data-id="+r+" data-guid="+u+" id = "+u+">"+t+o+bizagi.util.encodeHtml(e)+"<\/li>").appendTo(s),l=h.renderEditorCanvasChildrens(y.Children,t,i),l.appendTo(f)):f=$("<li  data-id= "+r+" data-guid="+u+" id = "+u+">"+o+bizagi.util.encodeHtml(e)+"<\/li>").appendTo(s)}),s},renderEditorListHandlers:function(n,t){var i=this;$("#queryinternals-defaultvalue-mainList li",n).click(function(){var o=this.getElementsByTagName("ul"),r,u,f,e;if(o.length>0)return r=this.getElementsByClassName("queryinternals-biz-wp-tree-expand-icon")[0],$(r).toggleClass("queryinternals-biz-wp-tree-collapse-icon"),$(r).toggleClass("bz-tree-show-more_16x16_standard bz-tree-less_16x16_standard"),$(this).children("ul").toggle("medium"),!1;if(u=t["editor-parameters"].type,this.getAttribute("data-id")==u)return i.updateValue(this,t,n),n.find(".queryinternals-defaultvalue-value").toggleClass("active"),n.find(".queryinternals-defaultvalue-action-btn").toggleClass("active"),i.expandTree(t,n),$("#data-queryinternals-defaultvalue-frame span",n).text($(this).text()),!1;f=bizagi.localization.getResource("formmodeler-component-editor-validation-xpath-title");e=bizagi.localization.getResource("formmodeler-component-editor-queryinternalsdefaultvalues-message-"+u);bizagi.showMessageBox(e,f,"warning",!1)})},updateValue:function(n,t,i,r){var u=this,f,e;$("#queryinternals-defaultvalue-mainList li",i).removeClass("queryinternals-defaultvalue-mainItem");f=typeof $(n).attr("id")=="undefined"?-1:$(n).attr("id");u.inputValue=t.value={fixedvalue:f,name:$(n).text()};e={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:r?undefined:u.buildValue(n),data:r?undefined:u.buildValue(n),type:t.name,id:u.element.closest(".bizagi_editor_component_properties").data("id")};u.controller.publish("propertyEditorChanged",e)},expandTree:function(n,t){var i;if(n.value&&n.value.fixedvalue){var r=n["editor-parameters"].type,u='#queryinternals-defaultvalue-mainList li[data-id="'+r+'"]',f=$(u).filter(function(){return $(this).attr("id")===n.value.fixedvalue});$(f,t).addClass("queryinternals-defaultvalue-mainItem")}$("#queryinternals-defaultvalue-mainList ul").hide();$(".queryinternals-biz-wp-tree-expand-icon").removeClass("queryinternals-biz-wp-tree-collapse-icon");i=$(".queryinternals-defaultvalue-mainItem").parentsUntil("#queryinternals-defaultvalue-mainList").find("ul:has(.queryinternals-defaultvalue-mainItem)");i.show();i.siblings().show();i.siblings().toggleClass("queryinternals-biz-wp-tree-collapse-icon");$("i[name=expanded].queryinternals-biz-wp-tree-collapse-icon").hasClass("bz-tree-show-more_16x16_standard")&&$("i[name=expanded].queryinternals-biz-wp-tree-collapse-icon").removeClass("bz-tree-show-more_16x16_standard").addClass("bz-tree-less_16x16_standard")},convertTypeString:function(n){var t;return n==1?t="application":n==20?t="processClass":n==100?t="task":n==11?t="position":n==16?t="processVersion":n==10&&(t="organization"),t},buildValue:function(n){return{fixedvalue:$(n).attr("id"),name:$(n).text()}}});
bizagi.editor.component.editor("bizagi.editor.component.editor.rangequery",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-rangequery-from"),value:"from",style:"bz-studio bz-range-query-from_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-rangequery-to"),value:"to",style:"bz-studio bz-range-query-to_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-rangequery-none"),value:"none",style:" bz-studio bz-number-range_16x16_standard"}],valueCheck:!1});t.value===undefined?t.value="none":t.value===null&&(t.value="none");i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);i.inline&&r.addClass("bizagi-editor-rangequery-inline");r.appendTo(n);u=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},responseChangeCombo:function(n,t,i){var u,r,f;u=i.inputValue;r=n;f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",f);i.inputValue=r},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.rangequery").concat("#rangequery-frame"))).done(function(){n.resolve()}),n.promise()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.userstoinclude",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-userstoinclude-current"),value:"1"},{label:bizagi.localization.getResource("formmodeler-component-editor-userstoinclude-all"),value:"0"}],valueCheck:!1});t.value===undefined?t.value="current":t.value===null&&(t.value="current");i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);i.inline&&r.addClass("bizagi-editor-userstoinclude-inline");r.appendTo(n);u=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},responseChangeCombo:function(n,t,i){var u,r,f;u=i.inputValue;r=n;f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",f);i.inputValue=r},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.userstoinclude").concat("#userstoinclude-frame"))).done(function(){n.resolve()}),n.promise()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.typesearch",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-typesearch-approximate"),value:"approx"},{label:bizagi.localization.getResource("formmodeler-component-editor-typesearch-exact"),value:"exact"}],valueCheck:!1});t.value===undefined?t.value="approximate":t.value===null&&(t.value="approximate");i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);i.inline&&r.addClass("bizagi-editor-typesearch-inline");r.appendTo(n);u=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},responseChangeCombo:function(n,t,i){var u,r,f;u=i.inputValue;r=n;f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",f);i.inputValue=r},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.typesearch").concat("#typesearch-frame"))).done(function(){n.resolve()}),n.promise()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.casestatedefaultvalue",{map:{0:"casestate-all",5:"casestate-closed",2:"casestate-pending",4:"casestate-aborted"}},{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-casestatedefaultvalue-all"),value:"casestate-all",style:"bz-studio bz-state-blue_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-casestatedefaultvalue-closed"),value:"casestate-closed",style:"bz-studio bz-state-red_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-casestatedefaultvalue-pending"),value:"casestate-pending",style:"bz-studio bz-state-yellow_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-casestatedefaultvalue-aborted"),value:"casestate-aborted",style:"bz-studio bz-remove-cross_16x16_standard"}],valueCheck:!1});t.value===undefined?t.value=0:t.value===null&&(t.value=0);typeof t.value=="object"&&(t.value=t.value.fixedvalue?t.value.fixedvalue:0);t.value=i.Class.map[t.value];i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);i.inline&&r.addClass("bizagi-editor-casestatedefaultvalue-inline");r.appendTo(n);u=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},responseChangeCombo:function(n,t,i){var r,u;r=i.buildValue(n);u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",u);i.inputValue=n},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.casestatedefaultvalue").concat("#casestatedefaultvalue-frame"))).done(function(){n.resolve()}),n.promise()},buildValue:function(n){var i=0,t,r;for(t in this.Class.map)if(r=this.Class.map[t],r==n){i=t;break}return{fixedvalue:i}}});
bizagi.editor.component.editor("bizagi.editor.component.editor.taskstatedefaultvalue",{map:{0:"taskstate-all",1:"taskstate-expired",2:"taskstate-expires-today",7:"taskstate-expires-future"}},{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u;i.inline=!1;$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-taskstatedefaultvalue-all"),value:"taskstate-all"},{label:bizagi.localization.getResource("formmodeler-component-editor-taskstatedefaultvalue-expired"),value:"taskstate-expired"},{label:bizagi.localization.getResource("formmodeler-component-editor-taskstatedefaultvalue-expiresinthefuture"),value:"taskstate-expires-future"},{label:bizagi.localization.getResource("formmodeler-component-editor-taskstatedefaultvalue-expirestoday"),value:"taskstate-expires-today"}],valueCheck:!1});(t.value===undefined||t.value===null)&&(t.value=0);typeof t.value=="object"&&(t.value=t.value.fixedvalue?t.value.fixedvalue:0);t.value=i.Class.map[t.value];i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);i.inline&&r.addClass("bizagi-editor-taskstatedefaultvalue-inline");r.appendTo(n);u=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},responseChangeCombo:function(n,t,i){var r,u;r=i.buildValue(n);u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",u);i.inputValue=r},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.taskstatedefaultvalue").concat("#taskstatedefaultvalue-frame"))).done(function(){n.resolve()}),n.promise()},buildValue:function(n){var i=0,t,r;for(t in this.Class.map)if(r=this.Class.map[t],r==n){i=t;break}return{fixedvalue:i}}});
bizagi.editor.component.editor("bizagi.editor.component.editor.activecontainer",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r,u,f;i.inline=!1;u=t["editor-parameters"].values||[];$.extend(t,{uiValues:u,valueCheck:!1});t.value=t.value||0;i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);i.inline&&r.addClass("bizagi-editor-activecontainer-inline");r.appendTo(n);f=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:t.uiValues,uiInline:i.inline,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})},responseChangeCombo:function(n,t,i){var u,r,f;u=i.inputValue;r=n;f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",f);i.inputValue=r},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var n=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.activecontainer").concat("#activecontainer-frame"))).done(function(){n.resolve()}),n.promise()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.changelayout",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var i=this,r;i.data=t;i.boxes=[];i.values=[];i.total=0;i.fixedWidth=0;r=$.tmpl(i.getTemplate("frame"),t);i.renderColumnsWidths(r.find(".changelayout-fields"),t.value.elements);r.appendTo(n);i.createDialogEditor(t)},renderColumnsWidths:function(n,t){for(var f=this,u,r="",i=0;i<t.length;i++)r+=t[i].width,t.length>1&&i!=t.length-1&&(r+=", ");u=$.tmpl(f.getTemplate("columns"),{width:r});u.appendTo(n)},renderFieldsWidths:function(n,t){for(var u=this,r,i=0;i<t.length;i++)r=$.tmpl(u.getTemplate("field"),t[i]),r.appendTo(n)},refreshColumnsWidths:function(n){var t=this;$(".changelayout-concat-value",t.element).text(n)},createDialogEditor:function(n){var t=this,r,f,e,p,l,h,a,v,u,i,y,s;for(r=$.tmpl(t.getTemplate("popup-content"),{}),elPopupContentWrapper=$(".changelayout-wrapper-container",r),elPopupContentSlider=$(".changelayout-slider-container",r),e=n.value.elements,i=0;i<e.length;i++)l=$.tmpl(t.getTemplate("popup-wrapper"),e[i]),l.appendTo(elPopupContentWrapper);h=$.tmpl(t.getTemplate("popup-slider"),e[0]);h.css("width",p+"%");h.appendTo(elPopupContentSlider);f=$.tmpl(t.getTemplate("popup-actions"),{});a=$($("span",f).get(0));a.click(function(){var e=$(".changelayout-box",r),o=$(".changelayout-field-value",t.element),u=[],f,i,n;for($.each(e,function(n,t){t=$(t).parent();u.push({index:n,width:parseInt(t.attr("data-value"))+"%"});$(o[n]).text(parseInt(t.attr("data-value"))+"%")}),f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_LAYOUT,values:u,id:t.element.closest(".bizagi_editor_component_properties").data("id")},t.controller.publish("propertyEditorChanged",f),t.hideDialog(),i="",n=0;n<t.boxes.length;n++)i+=parseInt($(t.boxes[n]).attr("data-value"))+"%",t.data.value.elements[n].width=parseInt($(t.boxes[n]).attr("data-value"))+"%",t.boxes.length>1&&n!=t.boxes.length-1&&(i+=", ");t.refreshColumnsWidths(i)}).text(bizagi.localization.getResource("formmodeler-component-editor-changelayout-ok"));v=$($("span",f).get(1));v.click(function(){t.hideDialog()}).text(bizagi.localization.getResource("formmodeler-component-editor-changelayout-cancel"));t.modalReference=t.createDialog(r,f);var w=$(".changelayout-slider",r),c={slide:function(n,i){var f=$(".ui-slider-handle"),r=$(i.handle).siblings("a").andSelf().index(i.handle),u=$(this).slider("value");return f.length>1&&(u=$(this).slider("values")),t.redrawWidthBoxes(r,u),f.length>1?(r==0||i.value>u[r-1])&&(r==u.length-1||i.value<u[r+1]):void 0}},o=$(".changelayout-box",r);if(o.length>2){for(u=[],i=0;i<o.length;i++)y=parseFloat(u[i-1])?parseFloat(u[i-1]):0,s=parseFloat($(o[i]).parent().attr("data-value"))+y,s<100&&s>0&&u.push(s);$.extend(c,{min:0,max:100,values:u})}else $.extend(c,{value:$(o[0]).parent().attr("data-value")});w.slider(c)},redrawWidthBoxes:function(n,t){var s=this,f,e,i,u,h,r,c,o;f=t[n-1]?parseInt(t[n-1]):0;e=t[n]?parseFloat(t[n])-f:parseFloat(t)-f;u=$(s.boxes[n]);r=$(s.boxes[n+1]);h=parseFloat(u.attr("data-value"));c=parseFloat(r.attr("data-value"));o=h+c;u.css("width",e+"%");$(".changelayout-value",u).text(e+"%");u.attr("data-value",e);typeof t!="number"?(i=parseInt(o-parseInt(t[n]-f)),r.css("width",i+"%"),$(".changelayout-value",r).text(i+"%"),r.attr("data-value",i)):(i=o-t,r.css("width",i+"%"),$(".changelayout-value",r).text(i+"%"),r.attr("data-value",i))},loadTemplates:function(){var n=this,t=$.Deferred();return $.when(n.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-frame")),n.loadTemplate("field",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-field")),n.loadTemplate("columns",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-columns")),n.loadTemplate("popup-content",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-popupcontent")),n.loadTemplate("popup-wrapper",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-wrapper")),n.loadTemplate("popup-slider",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-slider")),n.loadTemplate("popup-actions",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-popupactions"))).done(function(){t.resolve()}),t.promise()},".biz-ico.changelayout-image-small-popup click":function(n){var t=this,i;t.showDialog(n).done(function(){var n=$(".changelayout-box-wrapper",t.modalReference);for(t.boxes=[],$.each(n,function(n,i){i=$(i);t.boxes.push(i);t.values.push(parseInt(t.boxes[n].attr("data-value")));t.total+=t.values[n]}),i=0;i<t.boxes.length;i++)t.boxes[i].css("width",t.boxes[i].attr("data-value")+"%")})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.cssclass",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r;t.value===undefined?t.value="":t.value===null&&(t.value="");i.inputValue=t.value;r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n)},validateAndPublish:function(n,t){var i=this,r;/^([a-zA-Z]([a-zA-Z0-9_-])*|\s)*$/.test(t)?(i.hideError(n),i.publishValue(t)):(r=bizagi.localization.getResource("formmodeler-component-editor-cssclass-error-class"),i.showError(n,r),n.select())},publishValue:function(n){var t=this,i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t.inputValue,newValue:n,type:t.options.name,id:t.element.closest(".bizagi_editor_component_properties").data("id")};t.controller.publish("propertyEditorChanged",i);t.inputValue=n},loadTemplates:function(){var t=this,n;return n=$.Deferred(),$.when(t.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.cssclass").concat("#cssclass-frame"))).done(function(){n.resolve()}),n.promise()},"input keyup":function(n,t){var i=this,r=n.val();t.keyCode==13&&r!=i.inputValue&&i.validateAndPublish(n,r)},"input blur":function(n){var t=this,i=n.val();i!=t.inputValue&&t.validateAndPublish(n,i)}});
$.Controller("bizagi.editor.component.editor.lstring",{init:function(n,t,i){this.canvas=n;this.model=t;this.controller=i},render:function(){var t=$("<label><\/label>").html(this.options.caption),n=$("<input />").attr("type","text").val(this.options.hasOwnProperty("value")?this.options.value:this.options["default"]);n.addClass("ui-control-input").css("width","95%");this.inputVal=this.options.value;t.appendTo(this.element);n.appendTo(this.element)},"input keydown":function(n,t){t.stopPropagation();t.keyCode==13&&this.inputVal!=n.val()&&(this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputVal,newValue:n.val(),type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputVal=n.val())}});
bizagi.editor.component.editor("bizagi.editor.component.editor.buttonactions",{init:function(n,t,i){this._super(n,t,i);var r=typeof bizagi.editor.flags.EnableNextWithoutValidations!="undefined"?bizagi.util.parseBoolean(bizagi.editor.flags.EnableNextWithoutValidations):!1;this.actions=r?{submitData:{tooltip:"formmodeler-component-editor-buttonactions-submitdata-tooltip",label:"formmodeler-component-editor-buttonactions-submitdata",value:!1,show:!0},refresh:{tooltip:"formmodeler-component-editor-buttonactions-refresh",label:"formmodeler-component-editor-buttonactions-refresh",value:!1,show:!1},validate:{tooltip:"formmodeler-component-editor-buttonactions-validate-tooltip",label:"formmodeler-component-editor-buttonactions-validate",value:!1,show:!0},next:{tooltip:"formmodeler-component-editor-buttonactions-next-tooltip",label:"formmodeler-component-editor-buttonactions-next",value:!1,show:!0},"next without validations":{tooltip:"formmodeler-component-editor-buttonactions-next-without-validations-tooltip",label:"formmodeler-component-editor-buttonactions-next-without-validations",value:!1,show:!0},back:{tooltip:"formmodeler-component-editor-buttonactions-back",label:"formmodeler-component-editor-buttonactions-back",value:!1,show:!1}}:{submitData:{tooltip:"formmodeler-component-editor-buttonactions-submitdata-tooltip",label:"formmodeler-component-editor-buttonactions-submitdata",value:!1,show:!0},refresh:{tooltip:"formmodeler-component-editor-buttonactions-refresh",label:"formmodeler-component-editor-buttonactions-refresh",value:!1,show:!1},validate:{tooltip:"formmodeler-component-editor-buttonactions-validate-tooltip",label:"formmodeler-component-editor-buttonactions-validate",value:!1,show:!0},next:{tooltip:"formmodeler-component-editor-buttonactions-next-tooltip",label:"formmodeler-component-editor-buttonactions-next",value:!1,show:!0},back:{tooltip:"formmodeler-component-editor-buttonactions-back",label:"formmodeler-component-editor-buttonactions-back",value:!1,show:!1}}},renderEditor:function(n,t){var i=this,r,u;i.originalValue=t.value;t.value=i.executeInternalValidationRules(t.value,!0);t.value&&$.each(t.value,function(n,t){i.actions[t]&&i.actions[t].show&&(i.actions[t].value=!0)});r=$.tmpl(i.getTemplate("control"));r.appendTo(n);u=i.getComboValues();i.createUIControls(r,u);n.tooltip({position:{my:"left+15 center",at:"right center"},tooltipClass:"ui-widget-content ui-propertybox-tooltip"})},getComboValues:function(){var t=this,n=[];return $.each(t.actions,function(t,i){i.show&&(i.value?n.push({tooltip:i.tooltip,icon:null,label:i.label,value:t,selected:"selected"}):n.push({tooltip:i.tooltip,icon:null,label:i.label,value:t}))}),n},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.buttonactions").concat("#buttonactions-frame")),this.loadTemplate("control",bizagi.getTemplate("bizagi.editor.component.editor.buttonactions").concat("#buttonactions-control"))).done(function(){n.resolve()}),n.promise()},responseChangeCombo:function(n){var t=this,i=t.executeInternalValidationRules(n,!1);return t.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t.originalValue,newValue:i,type:t.options.name,id:t.element.closest(".bizagi_editor_component_properties").data("id")}),!0},executeInternalValidationRules:function(n,t){var r=this,i=[];if(t)$.isArray(n)&&n.indexOf("next")>=0?i.push(r.resolveAction("next",n)):i=n;else switch(n){case"next":i=["next","submitData","validate"];break;case"next without validations":i=["next","submitData"];break;case"submitData":i=["submitData","refresh"];break;default:i=[n]}return i},resolveAction:function(n,t){return n=="next"?t.indexOf("validate")>=0?n:"next without validations":n},createUIControls:function(n,t){var i=this;i.myCombo=new i.uiControls.comboBox({uiEditor:i,uiPlaceHolderText:" ---------- ",uiContainer:$(".ui-control-editor",n),uiValues:t,uiInline:!1,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.adhocsuggest",{init:function(n,t,i){this._super(n,t,i);var r=this;r.adhocProcessId=t.adhocProcessId},renderEditor:function(n,t){var i=this,r,u;i.inputValue=t.value;i.charLimit=300;i.placeholder=t["editor-parameters"].placeholder?!0:!1;i.placeholderText=i.placeholder?" "+t["editor-parameters"].placeholder:" ";i.isReadOnly=t["editor-parameters"].readOnly!==undefined?bizagi.util.parseBoolean(t["editor-parameters"].readOnly):!1;$.extend(t,{placeholder:i.placeholder,placeholderText:i.placeholderText,isReadOnly:i.isReadOnly});r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);i.adhocXpathInput=$("#adhocsuggest-input",r);t.value&&i.adhocXpathInput.val(t.value.xpath);i.adhocXpathInput.on("focusin",function(){i.createAutoComplete(r)});u=$("label",r);i.addRequired(u)},createAutoComplete:function(){var n=this;n.autoCompleteCreated||(n.adhocXpathvalues?n.initializeAutoComplete(n.adhocXpathInput,n.adhocXpathvalues):$.when(n.getDataSource()).done(function(t){n.adhocXpathvalues=t;n.initializeAutoComplete(n.adhocXpathInput,t)}),n.autoCompleteCreated=!0)},destroyAutoComplete:function(n){var i=this,t;i.autoCompleteCreated&&(t=$("#adhocsuggest-input",n),t.hasClass("ui-autocomplete-input")&&t.autocomplete("destroy"))},remove:function(){var n=this;n.element.hide();n.element.empty()},loadTemplates:function(){var t=this,n=new $.Deferred;return $.when(t.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.adhocsuggest").concat("#adhocsuggest-frame"))).done(function(){n.resolve()}),n.promise()},validate:function(n){var i=this,t,r,u=!1;return t=$(n),r=t.val(),!i.isLength(n)&&r.length?(t.hasClass("error")||t.addClass("error"),i.showError(n,i.Error),t.select()):(t.removeClass("error"),i.hideError(n),u=!0),u},isLength:function(n){var t=this;return t.Error=bizagi.localization.getResource("bizagi-editor-numberrange-error-lenght").replace("$number",t.charLimit),n.val().length<=t.charLimit},"label click":function(n){n.next().focus()},initializeAutoComplete:function(n,t){var i=this;n.autocomplete({minLength:2,source:t,appendTo:".bizagi_editor_component_properties",select:function(t,r){var f=r.item.label.indexOf(".")>-1?r.item.label.split(".")[1]:r.item.label;n.val(f);var e=i.inputValue?i.inputValue.relatedEntity:null,u={xpath:n.val(),relatedEntity:e},o={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:u,type:i.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:i.element.closest(".bizagi_editor_component_properties").data("id")};return i.inputValue=u,i.controller.publish("propertyEditorChanged",o),!1},focus:function(){return!1},change:function(t,r){if(r.item===null){n.val(t.currentTarget.value);var f=i.inputValue?i.inputValue.relatedEntity:null,u=n.val().length>0?{xpath:n.val(),relatedEntity:f}:undefined,e={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:u,type:i.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.inputValue=u;i.controller.publish("propertyEditorChanged",e)}return!1}})},getDataSource:function(){var t=this,n=new $.Deferred,i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getadhocdataschema",adhocProcessId:t.adhocProcessId});return $.when(i.processRequest()).done(function(t){var i=[];t.properties&&$.each(t.properties,function(n,t){i.push({label:t.name,value:t.name})});n.resolve(i)}),n.promise()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.adhocdatasource",{init:function(n,t,i){this._super(n,t,i);var r=this;r.controller=i;r.canvas=n;r.adhocProcessId=t.adhocProcessId;r.adhocXpathValue={};r.dialogBox={}},renderEditor:function(n,t){var r,i=this,u;t.readonly=i.options["editor-parameters"].readonly||!1;r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);u=$("label",r);i.addRequired(u);i.adhocXpathInput=$(".adhoc-xpath-value",r);i.showPredefinedValuesControl=t.showPredefinedValuesControl;i.showAdhocEntitiesControl=t.showAdhocEntitiesControl;$.when(i.getDataSources()).done(function(n){if(i.bizagiEntitiesValues=n.bizagiEntities,i.adhocEntitiesValues=n.adhocEntities,t.value&&t.value!=null)if(t.value.guid){var r=i.bizagiEntitiesValues.filter(function(n){return n.value===t.value.guid})[0];r==null&&(r=i.adhocEntitiesValues.filter(function(n){return n.value===t.value.guid})[0]);r==null?(t.value.values?i.adhocXpathValue=t.value:$.when(i.getPredefinedValues(t.adhocProcessId,t.value.property)).done(function(n){t.value.values=n;i.adhocXpathValue=t.value}),i.adhocXpathInput.val("Predefined")):(i.adhocXpathValue=r,i.adhocXpathInput.val(r.label))}else i.adhocXpathValue=t.value,i.adhocXpathInput.val("Predefined")})},loadTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-frame")),n.loadTemplate("close-popup",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-popup-close")),n.loadTemplate("popup-container",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-popup-container")),n.loadTemplate("predefined-values-popup",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-predefined-values-popup"))).done(function(){t.resolve()}),t.promise()},initializeAutoComplete:function(n,t){var i=this;n.autocomplete({minLength:2,source:t,select:function(t,r){var e=r.item.label,u,f;return n.val(e),u={guid:r.item.value,type:"bizagi",values:null},n[0].id=="adhoc-entity-input"&&(u.type="adhoc"),f={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.adhocXpathValue,newValue:u,type:i.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",f),i.adhocXpathInput.val(n.val()),i.adhocXpathValue=u,i.closePopup(),!1},focus:function(){return!1},change:function(t,r){if(r.item===null){n.val(t.currentTarget.value);var u={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.adhocXpathValue,newValue:null,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",u);i.adhocXpathInput.val(n.val());i.adhocXpathValue=null;i.closePopup()}return!1}})},getDataSource:function(){var t=this,n=new $.Deferred,i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getadhocdataschema",adhocProcessId:t.adhocProcessId});return $.when(i.processRequest()).done(function(t){var i=[];t.properties&&$.each(t.properties,function(n,t){i.push({label:t.name,value:t.name})});n.resolve(i)}),n.promise()},createXpathNavigatorCanvas:function(){var n=this,t=n.overlay=$("<div />").addClass("bizagi_editor_xpathnavigator_overlay"),i=n.xpathNavigatorElement=$("<div />").addClass("bizagi_editor_component_xpathnavigator biz-work-panel biz-border-all biz-shadow-modal biz-border-color ui-corner-all"),r=$.tmpl(this.getTemplate("close-popup"));$(".bizagi_editor_xpathnavigator_container-close-image",r).on("click",function(){n.closePopup()});r.appendTo(n.xpathNavigatorElement);t.appendTo("form-modeler");i.appendTo(t);setTimeout(function(){i.click(function(n){n.stopPropagation()});$(t).one("click",function(){n.closePopup()})},100)},calculateFloatingPosition:function(n){var t=this,r=t.overlay.height(),i=t.canvas.height();return n.top+i>r&&(n.top-=i),n},getDialogPosition:function(n){var t=n.offset();return{top:t.top+n.outerHeight(!0),left:t.left}},closePopup:function(){var n=this;n.xpathNavigatorElement.hide();n.controller.publish("close");n.adhocEntityInput&&n.adhocEntityInput.autocomplete("destroy");n.bizagiEntityInput&&n.bizagiEntityInput.autocomplete("destroy");setTimeout(function(){n.overlay.detach()},200)},getDataSources:function(){var t=this,n=new $.Deferred,i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getadhocdatasources",adhocProcessId:t.adhocProcessId});return $.when(i.processRequest()).done(function(t){var i={},r=[],u=[];$.each(t,function(n,t){t.type==="bizagi"?r.push({label:t.entName,value:t.entId}):u.push({label:t.entName,value:t.entId})});i.bizagiEntities=r;i.adhocEntities=u;n.resolve(i)}),n.promise()},getPredefinedValues:function(n,t){var u=this,i=new $.Deferred,r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getpredefinedvalues",adhocProcessId:n,property:t});return $.when(r.processRequest()).done(function(n){i.resolve(n)}),i.promise()},".xpath-image-world click":function(){var n=this,f=n.getDialogPosition(n.adhocXpathInput),t;n.createXpathNavigatorCanvas();n.xpathNavigatorElement.css(n.calculateFloatingPosition(f));n.xpathNavigatorElement.show();n.xpathNavigatorElement.resizable({helper:"ui-resizable-helper",minWidth:250,start:function(){$(".ui-resizable-helper").css({"z-index":1001})},stop:function(){}});var r=n.bizagiEntitiesValues.length>0,u=n.adhocEntitiesValues.length>0,i=$.tmpl(n.getTemplate("popup-container"),{hasBizagiEntities:r,hasAdhocEntities:u,showPredefinedValuesControl:n.showPredefinedValuesControl,showAdhocEntitiesControl:n.showAdhocEntitiesControl});n.xpathNavigatorElement.append(i);r&&(n.bizagiEntityInput=$("#bizagi-entity-input",i),t=n.bizagiEntitiesValues.filter(function(t){return t.label===n.adhocXpathInput.val()})[0],n.bizagiEntityInput.val(t?t.label:""),n.bizagiEntityInput.mousedown(function(n){$(n.target).focus()}),n.initializeAutoComplete(n.bizagiEntityInput,n.bizagiEntitiesValues));u&&(n.adhocEntityInput=$("#adhoc-entity-input",i),t=n.adhocEntitiesValues.filter(function(t){return t.label===n.adhocXpathInput.val()})[0],n.adhocEntityInput.val(t?t.label:""),n.adhocEntityInput.mousedown(function(n){$(n.target).focus()}),n.initializeAutoComplete(n.adhocEntityInput,n.adhocEntitiesValues));$("#predefinedValuesLink",i).click(function(){n.showPredefinedValuesPopup()})},showPredefinedValuesPopup:function(){var n=this,t=n.getTemplate("predefined-values-popup");n.dialogBox.formContent=$.tmpl(t);n.dialogBox.elements={gridFields:$("#predefinedValuesGrid",n.dialogBox.formContent),buttonSave:$("#button-accept-predefined-values-form",n.dialogBox.formContent),buttonCancel:$("#button-cancel-predefined-values-form",n.dialogBox.formContent)};n.dialogBox.elements.buttonSave.on("click",$.proxy(n.onSavePredefinedValues,n));n.dialogBox.elements.buttonCancel.on("click",$.proxy(n.closeDialogBox,n));n.dialogBox.data=n.adhocXpathValue.values?JSON.parse(n.adhocXpathValue.values):[];n.dialogBox.elements.gridFields.jsGrid({width:"100%",height:"200px",inserting:!0,editing:!0,sorting:!1,paging:!1,deleteConfirm:"Do you really want to delete this value?",autoload:!0,controller:{loadData:function(){return n.dialogBox.data},insertItem:function(n){return n.key||(n.key=Math.guid()),n},updateItem:function(n){return n}},fields:[{name:"key",visible:!1},{name:"value",title:"value",type:"text",width:200,validate:"required"},{type:"control"}]});n.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"500px",modal:!0,title:bizagi.localization.getResource("Predefined Values"),maximize:!1,close:function(){n.dialogBox.formContent.dialog("destroy");n.dialogBox.formContent.detach()}})},onSavePredefinedValues:function(n){n.preventDefault();var t=this,i={guid:t.adhocXpathValue.values?t.adhocXpathValue.guid:Math.guid(),processguid:t.adhocProcessId,type:"predefined",values:JSON.stringify(t.dialogBox.data)},r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t.adhocXpathValue,newValue:i,type:t.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:t.element.closest(".bizagi_editor_component_properties").data("id")};t.controller.publish("propertyEditorChanged",r);t.adhocXpathInput.val("Predefined");t.adhocXpathValue=i;t.closeDialogBox();t.closePopup()},closeDialogBox:function(){var n=this;n.dialogBox.elements.gridFields.jsGrid("destroy");n.dialogBox.formContent.dialog("destroy");n.dialogBox.formContent.detach()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.adhocattribute",{init:function(n,t,i){this._super(n,t,i)},renderEditor:function(n,t){var i=this,r;i.inline=!0;t.readonly=i.options["editor-parameters"].readonly||!1;r=$.tmpl(i.getTemplate("frame"),t);r.appendTo(n);i.inputValue=t.value;$.when(t["editor-parameters"].attribs).done(function(n){i.attributesMetadata=n;var u=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",r),uiValues:i.getDataForCombo(t.value),uiInline:i.inline,uiInitValue:-1,onChange:function(n,t){i.responseChangeCombo(n,t,i)}})})},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.adhocattribute").concat("#adhocattribute-frame"))).done(function(){n.resolve()}),n.promise()},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r},".xpath-from-adhoc-entity.xpath-image-world click":function(){var n=this,t=n.element.find(".xpath-value"),i=n.positionXpathDialog(t),r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_FROM_ENTITY,oldValue:n.inputValue,position:i,type:n.options.name,subproperties:n.propertiesNames,xpathValue:n.options.value,typeEditor:n.options["bas-type"],editor:n,editorParameters:n.options["editor-parameters"],id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",r)},getDisplayAttribute:function(n){var t=this,i=t.attributesMetadata.filter(function(t){return t.attribGuid===n})[0];return i.displayName},getDataForCombo:function(n){for(var t,i=this,r=[],u=0;u<i.attributesMetadata.length;u++){t={label:i.attributesMetadata[u].displayName,value:i.attributesMetadata[u].attribGuid};switch(i.attributesMetadata[u].attribType.type){case 15:t.style="ui-bizagi-type-attribute-string";break;case 7:t.style="ui-bizagi-type-attribute-number";break;case 8:t.style="ui-bizagi-type-attribute-currency";break;case 5:t.style="ui-bizagi-type-attribute-boolean";break;case 12:t.style="ui-bizagi-type-attribute-date";break;default:t.style="ui-bizagi-type-attribute"}t.value===n&&(t.selected=!0);r.push(t)}return n||(r[0].selected=!0,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:"",newValue:r[0].value,data:r[0].value,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")})),r},responseChangeCombo:function(n,t,i){var u,r;u=i.inputValue;r=n;i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:u,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")});i.inputValue=r}});
bizagi.editor.observableClass.extend("bizagi.editor.component.controlsnavigator.group.model",{},{init:function(n){this._super();this.items=[];n&&this.processData(n)},processData:function(n){var t=this,i,r,u;if(n.design.visual["controls-navigator"]){r=n.design.visual["controls-navigator"].group;u=typeof r;switch(u){case"string":i=r;break;case"object":i=bizagi.editor.utilities.resolveInternalResource(r)}t.id=i;t.name=i}else t.id="default",t.name="default";t.addItem(n)},addItem:function(n){var t=this,i={id:n.name,name:bizagi.editor.utilities.resolveInternalResource(n.display),type:n.type,icon:n.icon,style:n.style};t.items.push(i)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.controlsnavigator.model",{},{init:function(){var n=this;n._super();n.controls={};n.context={form:{groups:[],hash:{}},startform:{groups:[],hash:{}},grid:{groups:[],hash:{}},offlinegrid:{groups:[],hash:{}},adhocgrid:{groups:[],hash:{}},searchform:{groups:[],hash:{}},queryform:{groups:[],hash:{}},offlineform:{groups:[],hash:{}},template:{groups:[],hash:{}},layout:{groups:[],hash:{}},notVisible:{groups:[],hash:{}},adhocform:{groups:[],hash:{}}}},processData:function(n){var t=this;$.each(n.controls,function(n,i){var r,u;t.controls[i.name]||(r=t.resolveGroupforControlNavigator(i.design.visual["controls-navigator"]),r&&(u=t.getControlContext(i),u&&(u.hash[r]?(u.hash[r].addItem(i),t.controls[i.name]=u.hash[r].items[u.hash[r].items.length-1]):t.createAndAddGroupInModel(u,r,i))))});t.sortGroups()},resolveGroupforControlNavigator:function(n){var t="default",i;if(n){if(n=="none"||n.group=="none")return null;i=typeof n.group;switch(i){case"string":t=n.group;break;case"object":t=bizagi.editor.utilities.resolveInternalResource(n.group)}}return t},createAndAddGroupInModel:function(n,t,i){var u=this,r=new bizagi.editor.component.controlsnavigator.group.model(i);n.groups.push(r);n.hash[t]=r;u.controls[i.name]=r.items[0]},getControlContext:function(n){var t=this,i=n.type,r=t.publish("getContext");return i==="column"?t.context.grid:i==="offlinecolumn"?t.context.offlinegrid:i==="adhoccolumn"?t.context.adhocgrid:i==="search"?t.context.searchform:i==="query"?t.context.queryform:i==="queryInternal"?t.publish("isContextEntityApplication")?t.context.queryform:null:i==="offline"||i==="offlinecontainer"?t.context.offlineform:i==="adhoc"||i==="adhoccontainer"?t.context.adhocform:i==="layout"?t.context.layout:i==="nestedform"||i==="booleandisabled"?t.context.notVisible:i=="container"?r=="queryform"&&!t.isGridControl(n)?t.context.queryform:r=="startform"?t.context.startform:t.context.form:r=="startform"?t.context.startform:t.context.form},sortGroups:function(){var n=this,i,t,r;for(i in n.context)for(t=0,r=n.context[i].groups.length;t<r;t+=1)n.context[i].groups[t].items.sort(n.sortFunction)},sortFunction:function(n,t){var i=n.name.toLowerCase(),r=t.name.toLowerCase();return i<r?-1:i>r?1:0},getControlDisplayName:function(n){var t=this;return t.controls[n]?t.controls[n].name:n},isGridControl:function(n){return n.name.indexOf("grid")>=0}});
$.Class.extend("bizagi.editor.component.banner.model",{getBannerModel:function(){var n=this;return this.model={banner:{displayname:bizagi.localization.getResource("formmodeler-component-banner-store-legend"),cite:bizagi.localization.getResource("formmodeler-component-banner-store-cite"),icon:"mtool-item-more-controls",on:!0}}}});
bizagi.editor.component.controller("bizagi.editor.component.xpathnavigator",{init:function(n,t){t=t||{};this._super(n);this.model=t.model;this.canvas=n;this.presenter=t.presenter;this.scope=t.scope||"form"},loadTemplates:function(){var n={node:bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#node","node-version":bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#xpathnavigator-node-version",close:bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#xpathnavigator-close",helper:bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#xpathnavigator-helper","node-container":bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#xpathnavigator-node-container"};return this._super(n)},updateModel:function(n){var t=this;t.model=n},createFloatingCanvas:function(){var n=this,t=n.overlay=$("<div />").addClass("bizagi_editor_xpathnavigator_overlay");n.element.addClass("biz-work-panel biz-border-all biz-shadow-modal biz-border-color ui-corner-all");t.appendTo("form-modeler");n.element.appendTo(t);setTimeout(function(){n.element.click(function(n){n.stopPropagation()});$(t).one("click",function(){n.close()})},100)},render:function(n){var i=new $.Deferred,t=this,r,u,f;return(n=n||{},r=n.expand||!1,t.isReadOnly=n.isReadOnly!="undefined"?bizagi.util.parseBoolean(n.isReadOnly):!1,t.context=n.context||"fixed",t.scope=n.scope||"form",t.filter=n.filter,t.allowDrag=typeof n.allowDrag!="undefined"?n.allowDrag:!0,t.allowDrag=!t.isReadOnly&&t.allowDrag,t.allowCollection=n.allowCollection||!1,t.isFloatingContext()&&t.createFloatingCanvas(),t.element.empty(),$.isEmptyObject(t.model))?null:($.when(t.loadTemplates()).done(function(){if(t.isFloatingContext()){t.renderCloseButton();var e=t.calculateFloatingPosition(n.position);t.element.css(e);t.element.show();t.element.resizable({helper:"ui-resizable-helper",minHeight:200,minWidth:250,start:function(){$(".ui-resizable-helper").css({"z-index":1001})},stop:function(){}})}u=$.tmpl(t.getTemplate("node-container"),{});t.element.append(u);f=t.element.find(".xpathnavigator-node-container");t.renderNodes(f,t.model.rootNodes,r);$(document).ready(function(){t.togglePlusMinusIcon(t.element.find(".bizagi_editor_xpathnavigator_node").first(),!1)});n.xpath&&t.showXpath(n.xpath);i.resolve()}),i.promise())},calculateFloatingPosition:function(n){var t=this,r=t.overlay.height(),i=t.canvas.height();return n.top+i>r&&(n.top-=i),n},renderCloseButton:function(){var n=$.tmpl(this.getTemplate("close"));this.canvas.has($(".xpathnavigator-close")).length===0&&n.prependTo(this.canvas)},renderNodes:function(n,t,i){var r=this,u=r.filter;$.each(t,function(t,f){r.context==="grid"?f.nodeType!=="form"&&f.nodeType!=="collection"&&r.renderNodeAndSubnodes(n,f,i):u===undefined?r.renderNodeAndSubnodes(n,f,i):r.isValidNode(f,u)&&r.renderNodeAndSubnodes(n,f,i)})},renderNodeAndSubnodes:function(n,t,i){var u=this,r,f;r=u.renderNode(n,t);t.nodes&&(f=$(r).find(".bizagi_editor_xpathnavigator_node-childs"),u.renderNodes(f,t.nodes),t.nodes.length>0&&!i&&$(r).find(".bizagi_editor_xpathnavigator_node-childs").hide())},isValidNode:function(n,t){var u=this,i=!1,r=n.nodeType,f=n.nodeSubtype;return r!="form"&&(r=="entity-application"?i=!0:n.hasRelatedEntity?(r!="collection"||t.typeFilter=="xpathtocollection"||t.typeFilter=="xpathtoentitytemplate"||u.allowCollection)&&(i=!0):u.isValidFilter(r,f,t)&&(i=!0)),i},isValidFilter:function(n,t,i){var e=i.typeFilter,u=i.types,f=!1,r;switch(e){case"xpathfromentity":case"xpathtosimple":for(r=0;r<u.length;r++)try{if($.inArray(t,bizagi.editor.component.xpathnavigator.equiv.rule.xpathtosimple[u[r]])!=-1){f=!0;break}}catch(o){bizagi.logError("Equiv Error","nodeType: "+t+", types: "+u.toString())}break;case"xpathmultiple":for(r=0;r<u.length;r++)try{if($.inArray(t,bizagi.editor.component.xpathnavigator.equiv.rule.xpathmultiple[u[r]])!=-1){f=!0;break}}catch(o){bizagi.logError("Equiv Error","nodeType: "+t+", types: "+u.toString())}}return f},isFloatingContext:function(){return this.context==="floating"},renderNode:function(n,t){var r=this,u,i=$.tmpl(r.getTemplate("node"),t);return i.appendTo(n),t.formVersion&&(u=$.tmpl(r.getTemplate("node-version"),{version:t.formVersion}),$(u).insertBefore($("label",i))),r.allowDrag&&r.setDraggableNode(i,t),t.displayName.length>20&&$(i).tooltip({tooltipClass:"ui-widget-content",position:{my:"left top",at:"right+5 top-5"}}),i},setDraggableNode:function(n,t){var i=this;if(this.isFloatingContext()){i.removeDraggableOptions(n);return}t.enableDrag(i.scope)&&($(n).find(".bizagi_editor_xpathnavigator_data").first().data(t),$(n).find(".bizagi_editor_xpathnavigator_data").first().draggable({helper:function(n){return i.draggableHelper(n)},connectToSortable:".ui-bizagi-container-connectedSortable",distance:15,start:function(){$("#main-panel").addClass("bz-main-dashed-grid").addClass("ui-start-drag");i.presenter.publish("controlRefreshCanvas",{})},stop:function(){$("#main-panel").removeClass("bz-main-dashed-grid").removeClass("ui-start-drag");bizagi.util.removeAutoScroll("autoscroll","xpathnavigator");i.presenter.publish("controlRefreshCanvas",{})},containment:"document",cursorAt:i.scope!="template"?!1:{left:5}}))},removeDraggableOptions:function(n){$(".ui-bizagi-draggable-item",n).removeClass("ui-bizagi-draggable-item");$(".ui-bizagi-itemfordrag ",n).removeClass("ui-bizagi-itemfordrag ")},draggableHelper:function(n){var u=this,r,f=$(n.currentTarget),s,h,c,e,t,l,a,i,o,v;return h=f.data(),c=parseFloat($("label",f).width()),e=parseFloat($(".biz-ico",f).eq(0).width()),t=c+e+40+"px",u.scope=="template"&&(t=e+5,t=t+"px"),r=$.tmpl(u.getTemplate("helper"),$.extend(h,{context:u.scope})),r.css("width",t),r.css("max-width",t),s=r.appendTo("form-modeler").css({zIndex:900}),i=$(".wrapper-main-panel"),v=$("#main-panel",i),o=$(".wrapper-main-scroll",i),v.hasClass("biz-auto-height")&&(l=i.position().top+parseFloat(i.css("padding-top"))+parseFloat(i.css("margin-top"))+50,a=o.outerHeight(),bizagi.util.autoScroll(o,l,a,"xpathnavigator")),s},expandCollapse:function(n,t){var i=this,r=new $.Deferred,u;return i.hasChildren(n[0])?(i.togglePlusMinusIcon(n,t),null):(u=n.data("id"),$.when(i.model.getChildren(u)).done(function(t){var u=$(n).find(".bizagi_editor_xpathnavigator_node-childs");i.hasChildren(n[0])||(i.renderNodes(u,t),i.togglePlusMinusIcon(n,!0));r.resolve(t)}),r.promise())},findNode:function(n,t){return n.find("#"+t.id)},hide:function(){this.element.hide()},togglePlusMinusIcon:function(n,t){$(n).find("ul").first().is(":visible")&&!t?($(n).children("div").find(".biz-btn").children(".xpathnavigator_collapse_icon").removeClass("bz-tree-less_16x16_standard").addClass("bz-tree-show-more_16x16_standard"),$(n).children("div").find(".biz-btn").children(".xpathnavigator_collapse_icon").removeClass("xpathnavigator_collapse_icon").addClass("xpathnavigator_expand_icon"),$(n).find("ul").first().hide()):($(n).children("div").find(".biz-btn").children(".xpathnavigator_expand_icon").removeClass("bz-tree-show-more_16x16_standard").addClass("bz-tree-less_16x16_standard"),$(n).children("div").find(".biz-btn").children(".xpathnavigator_expand_icon").removeClass("xpathnavigator_expand_icon").addClass("xpathnavigator_collapse_icon"),$(n).find("ul").first().show())},findAndShowForm:function(n,t,i,r){var f=this,e,u,o,s=i.baref.ref,h=r!==undefined?r.xpath.baxpath.xpath:null;if(h===null)if(u=t[t.length-1],t[t.length-1].nodes===null)e=$("#"+u.id,n),f.expandCollapse(e,!0).done(function(){f.showXpathByGuid(i,r)});else if(u.nodes.length!=0){for(o=0;o<u.nodes.length;o++)if(u.nodes[o].guid==s){e=$("#"+u.nodes[o].id,n);$(".ui-state-active",f.element).removeClass("ui-state-active");$(e).find(".bizagi_editor_xpathnavigator_data").first().addClass("ui-state-highlight");$(".ui-state-highlight",f.element).ScrollTo({duration:0});break}}else throw"Query is not sending right data.";else if(t.nodes===null)e=$("#"+t.id),f.expandCollapse(e,!0).done(function(){f.findAndShowForm(n,t,i,r)});else if(u=t.nodes[t.nodes.length-1],u.nodes===null)e=$("#"+u.id),f.expandCollapse(e,!0).done(function(){f.findAndShowForm(n,t,i,r)});else if(u.nodes.length!=0){for(o=0;o<u.nodes.length;o++)if(u.nodes[o].guid==s){e=$("#"+u.nodes[o].id,n);$(".ui-state-active",f.element).removeClass("ui-state-active");$(e).find(".bizagi_editor_xpathnavigator_data").first().addClass("ui-state-highlight");$(".ui-state-highlight",f.element).ScrollTo({duration:0});break}}else throw"Query is not sending right data.";},showXpathByGuid:function(n,t){var i=this,r=t!==undefined?t.xpath.baxpath.xpath:null;$(".bizagi_editor_xpathnavigator_data").removeClass("ui-state-highlight");r===null?i.findAndShowForm(i.element,i.model.rootNodes,n,t):i.findAndShowXpath(i.element,i.model.rootNodes,t,n)},showMetadataXpath:function(n){var t=this,i;($(".bizagi_editor_xpathnavigator_data").removeClass("ui-state-highlight"),n!="undefined")&&(i=[{nodes:t.model.rootNodes}],t.findAndShowXpath(t.element,i,n))},showXpath:function(n){var t=this,i=new $.Deferred;if($(".bizagi_editor_xpathnavigator_data").removeClass("ui-state-highlight"),typeof n!="undefined")return $.when(t.findAndShowXpath(t.element,t.model.rootNodes,n)).done(function(){t.isFloatingContext()&&t.renderCloseButton();i.resolve()}),i.promise()},findAndShowXpath:function(n,t,i,r){var f=this,u,o,s=0,c=f.scope==="grid"?t:t[0].nodes||t,l=n,a=bizagi.editor.utilities.resolveComplexXpath(i),h=a?a.split("."):[],e=new $.Deferred;o=h[0];do{if(u=f.findNodeForXpath(l,c,o),!u){e.resolve();break}if(s===h.length-1){e.resolve();break}if(s++,o=o+"."+h[s],u.node.nodes&&u.node.nodes.length!==0)c=u.node.nodes,l=$(u.element).find(".bizagi_editor_xpathnavigator_node-childs"),u.node.canHaveChildren==="true"?f.expandCollapse(u.element,!0):e.resolve();else{$.when(f.expandCollapse(u.element,!0)).done(function(n){n&&n.length?$.when(f.showXpath(i)).done(function(){e.resolve()}):e.resolve()});u=undefined;break}}while(1);return u&&(r!==undefined?f.findAndShowForm(u.element,u.node,r,i):f.highlightNode(u.element)),e.promise()},findNodeForXpath:function(n,t,i){var f=this,u,r=f.model.getNodeByXpath(i);if(r)return u=n.find("#"+r.id),{element:u,node:r}},highlightNode:function(n){var t=this;$(".ui-state-active",t.element).removeClass("ui-state-active");$(n).find(".bizagi_editor_xpathnavigator_data").first().addClass("ui-state-highlight");$(".ui-state-highlight",this.element).ScrollTo({duration:0})},hasChildren:function(n){return $(n).find("ul").first().children().length>0},close:function(){this.hide();this.publish("close");this.isFloatingContext()&&this.overlay.detach()},onNodeRightClick:function(n,t){var i=this,r=i.model.getNode(n),f=bizagi.util.parseBoolean(r.canHaveChildren),u;i.context!="floating"&&(i.contextmenu&&i.contextmenu.destroy(),r.parentIsGrid()||(u=f?i.model.getChildren(n):!1,$.when(u).done(function(){i.showContextMenu(r,{x:t.clientX,y:t.clientY})})))},showContextMenu:function(n,t){var i=this,r=n.getContextMenuModel(i.scope);return i.contextmenu=new bizagi.editor.component.contextmenu.presenter({model:r,guid:n.id}),i.contextmenu.subscribe("onItemClicked",function(t,r){i.onContextMenuItemClicked(n,r)}),i.contextmenu.render({position:t})},onContextMenuItemClicked:function(n,t){var i=this;i.presenter.publish("contextMenuItemClick",{node:n,action:t.action})},".xpathnavigator-close > .bizagi_editor_xpathnavigator_container-close-image click":function(){this.close()},".bizagi_editor_xpathnavigator_data mousedown":function(n,t){var i=this,r=n.parent().data("id"),u;if(t.button==0||t.button==1)u=i.model.getNode(r),i.presenter.publish("nodeClick",u);else if(t.button==2&&!i.isReadOnly)i.onNodeRightClick(r,t)},".xpathnavigator_expand_icon, .xpathnavigator_collapse_icon click":function(n,t){t.stopImmediatePropagation();var i=this,r=n.closest(".bizagi_editor_xpathnavigator_node");i.expandCollapse(r)},".bizagi_editor_xpathnavigator_data dblclick":function(n,t){var i=this,u,f,e,r;$(t.target).hasClass("xpathnavigator_expand_icon")||$(t.target).hasClass("xpathnavigator_collapse_icon")||(e=n.closest(".bizagi_editor_xpathnavigator_node").data("id"),r=i.model.getNode(e),(r.renderType&&r.enableDrag(i.scope)||!i.model.isRootNode(r)&&i.allowCollection)&&(i.presenter.publish("nodeDoubleClick",r),$(".ui-tooltip").remove(),u=$(".wrapper-main-scroll"),bizagi.util.autoScrollBottom(u),f=$(".ui-bizagi-container-form > div:last",u),bizagi.util.highLightElement(f),n.removeClass("ui-state-active")))}});
bizagi.editor.observableClass.extend("bizagi.editor.component.xpathnavigator.model",{view:{onlyProcessEntity:"PROCESSENTITY",allView:"All"}},{init:function(n,t){var i=this,r,f,u;if(i._super(),i.rootNodes=null,i.nodes=null,i.nodeHash={},i.xpathNodeHash={},i.processEntityNodes={},i.communicationProtocol=bizagi.editor.communicationprotocol.factory,i.processEntityId=n.nodes&&n.nodes[0]&&n.nodes[0].processEntityId,i.isProcessEntity=i.processEntityId?!0:!1,i.isEmptyRootNode=t||!1,n){if(i.isProcessEntity)for(r=0,f=n.nodes[0].nodes.length;r<f;r++)u=n.nodes[0].nodes[r],u.guidRelatedEntity==i.processEntityId&&(i.processEntityNodes[u.guid]=u);i.rootNodes=i.processData(n);i.nodes=i.rootNodes.length>0&&i.rootNodes[0].nodes?i.rootNodes[0].nodes.slice(0):i.nodes;n.context&&(i.context=n.context)}},processData:function(n){var t=this,i=[];return n.nodes&&$.each(n.nodes,function(n,r){var u=new bizagi.editor.component.xpathnavigator.node(r),f;t.nodeHash[u.id]=u;t.processEntityNodes[u.guid]&&(t.processEntityNodes[u.guid]=u);u.nodeType&&u.nodeType!=="form"&&(t.xpathNodeHash[u.xpath]=u);i.push(u);u.canHaveChildren&&r.nodes.length==0&&(r.nodes=null);r.nodes&&(f=t.processData({nodes:r.nodes}),u.setChildren(f),$.each(f,function(n,t){t.setParent(u)}))}),i},addChildren:function(n,t){var i=this,r=i.getNode(n),u=i.processData(t);i.isRootNode(r)&&(i.nodes=u);r.setChildren(u);$.each(u,function(n,t){t.setParent(r)})},getChildren:function(n,t){var r=this,i=r.getNode(n),u,f,e;return i?(u=i.getChildren(),u&&!t)?u:(f=new $.Deferred,i.isRootNode=this.isRootNode(i),e=r.communicationProtocol.createProtocol({protocol:"getchildrennodes",node:i}),$.when(e.processRequest()).done(function(t){r.addChildren(n,t);f.resolve(i.getChildren())}),f.promise()):[]},getNodeByXpath:function(n){var t=this;return t.xpathNodeHash[n]},getNode:function(n){var t=this;return t.nodeHash[n]},getAllModel:function(){var n=this;n.rootNodes.length>0&&(n.rootNodes[0].nodes=n.nodes&&n.nodes.slice(0))},getProcessEntityModel:function(){var n=this,i=[],t;if(n.isProcessEntity){for(t in n.processEntityNodes)n.processEntityNodes.hasOwnProperty(t)&&i.push(n.processEntityNodes[t]);n.rootNodes[0].nodes=i}else n.getAllModel()},getProcessEntityId:function(){var n=this;return n.processEntityId?n.processEntityId:null},processEntityRelated:function(n){var t=this,i=t.getNodeByXpath(n);return i&&i.parentIsProcessEntity(t.processEntityId)},getRootNode:function(){return this.rootNodes[0]},isRootNode:function(n){var i=this,t;return i.isEmptyRootNode?!1:(t=i.getRootNode(),t&&t.guid===n.guid&&t.xpath===n.xpath)?!0:!1},getSubModel:function(n){var u=this,i,t,r,f;return n==="none"?{}:(i=bizagi.editor.utilities.resolveComplexXpath(n),i==undefined)?this:i.length==0?this:(t=u.getNodeByXpath(i),t)?(r=new $.Deferred,f=u.communicationProtocol.createProtocol({protocol:"getchildrennodes",node:{contextScope:t.contextScope,guidRelatedEntity:t.guidRelatedEntity,xpath:"",isRootNode:!0,style:t.style,isScopeAttribute:t.isScopeAttribute}}),$.when(f.processRequest()).done(function(n){var t=new bizagi.editor.component.xpathnavigator.model(n,!0);r.resolve(t)}),r.promise()):null},getSubModelByEntity:function(n,t){var r=this,i=new $.Deferred,u=r.communicationProtocol.createProtocol({protocol:"getchildrennodes",node:{contextScope:null,guidRelatedEntity:n,xpath:"",isRootNode:!0,style:null,isScopeAttribute:!1,entityContext:t}});return $.when(u.processRequest()).done(function(n){var t=new bizagi.editor.component.xpathnavigator.model(n,!0);i.resolve(t)}),i.promise()}});
bizagi.editor.observableClass.extend("bizagi.editor.component.xpathnavigator.node",{icons:{entity:"bz-studio bz-entity_16x16_standard","entity-application":"bz-studio bz-application_16x16_standard","entity-master":"bz-studio bz-master_16x16_standard","entity-stakeholder":"bz-studio bz-stakeholderentity_16x16_standard","entity-parametric":"bz-studio bz-Parametersentity_16x16_standard","entity-system":"bz-studio bz-entity_16x16_standard",number:"bz-studio bz-number_16x16_standard",form:"bz-studio bz-reusable-forms_16x16_standard",string:"bz-studio bz-textbox_16x16_standard",text:"bz-studio bz-textbox_16x16_standard",date:"bz-studio bz-date_16x16_standard",boolean:"bz-studio bz-boolean_16x16_standard",currency:"bz-studio bz-money_16x16_standard",image:"bz-studio bz-image_16x16_standard",attachment:"bz-studio bz-file-uploads_16x16_standard",float:"bz-studio bz-number_16x16_standard",uploadecm:"bz-studio bz-file-uploads-ecm_16x16_standard",collection:"bz-studio bz-collections_16x16_standard","metadata-metadata":"bz-studio bz-process-filters_16x16_standard","metadata-applications":"bz-studio bz-process-filters-application_16x16_standard","metadata-process":"bz-studio bz-process-filters-process_16x16_standard","metadata-task":"bz-studio bz-process-task_16x16_standard","metadata-task-current":"bz-studio bz-process-current-task_16x16_standard","metadata-task-previous":"bz-studio bz-process-previous-task_16x16_standard","metadata-task-entry-date":"bz-studio bz-process-task-entry-date_16x16_standard","metadata-task-expiry-date":"bz-studio bz-process-task-expiry-date_16x16_standard","metadata-task-state":"bz-studio bz-process-task-state_16x16_standard","metadata-cases":"bz-studio bz-process-case_16x16_standard","metadata-case-creation-date":"bz-studio bz-case-creation-date_16x16_standard","metadata-case-creator":"bz-studio bz-case-creator_16x16_standard","metadata-case-id":"bz-studio bz-case-id_16x16_standard","metadata-case-number":"bz-studio bz-case-number_16x16_standard","metadata-case-solution-date":"bz-studio bz-case-solution-date_16x16_standard","metadata-case-state":"bz-studio bz-case-state_16x16_standard","metadata-users":"bz-studio bz-users_16x16_standard","metadata-users-creator":"bz-studio bz-users-creator_16x16_standard","metadata-users-creator-fullname":"bz-studio bz-users-creator-fullname_16x16_standard","metadata-users-creator-username":"bz-studio bz-users-creator-name_16x16_standard","metadata-users-creator-position":"bz-studio bz-users-creator-position_16x16_standard","metadata-users-currentuser":"bz-studio bz-users-current_16x16_standard","metadata-users-currentuser-fullname":"bz-studio bz-users-current-fullname_16x16_standard","metadata-users-currentuser-username":"bz-studio bz-users-current-name_16x16_standard","metadata-users-currentuser-position":"bz-studio bz-users-current-position_16x16_standard","metadata-users-previoususer":"bz-studio bz-users-previous_16x16_standard","metadata-users-previoususer-fullname":"bz-studio bz-users-previous-fullname_16x16_standard","metadata-users-previoususer-username":"bz-studio bz-users-previous-name_16x16_standard","metadata-users-previoususer-position":" bz-studio bz-users-previous-position_16x16_standard"}},{init:function(n){var t=this;t._super();t.nodes=null;t.data=n;n&&t.processData(n)},processData:function(n){var t=this;t.id=Math.guid();t.canHaveChildren=n.canHasChildren===undefined?!1:n.canHasChildren;t.displayName=n.displayName;t.guid=n.guid;t.isDraggable=n.isDragabble===undefined?!0:n.isDragabble;t.style=n.style;t.renderType=n.renderType;t.xpath=n.xpath;t.isScopeAttribute=n.isScopeAttribute===undefined?!1:n.isScopeAttribute;t.guidRelatedEntity=n.guidRelatedEntity;t.hasRelatedEntity=t.guidRelatedEntity&&t.guidRelatedEntity!="00000000-0000-0000-0000-000000000000"?!0:!1;t.contextScope=n.contextScope;t.formVersion=n.formVersion;t.maxLength=n.maxLength;t.contextEntityType=n.contextEntityType;n.entityContext&&(t.entityContext=n.entityContext);n.predefinedValues&&(t.predefinedValues=n.predefinedValues);t.isScopeAttribute===!0||t.isScopeAttribute=="true"?(t.nodeType=n.style.replace("ui-bizagi-type-scope-","").replace(/(attribute)(-\w+)/g,"$1"),t.nodeSubtype=n.style.replace("ui-bizagi-type-scope-","").replace(/(attribute)(-)(\w+)/g,"$3")):(t.nodeType=n.style.replace("ui-bizagi-type-","").replace(/(attribute)(-\w+)/g,"$1"),t.nodeSubtype=n.style.replace("ui-bizagi-type-","").replace(/(attribute)(-)(\w+)/g,"$3"));t.icon=t.Class.icons[t.nodeSubtype];t.isDraggable==="true"&&(t.dragabbleClass="ui-bizagi-draggable-item ui-bizagi-itemfordrag")},getOriginalData:function(){var t=this,n=t.data;return n.nodes=[],n},setChildren:function(n){var t=this;t.nodes=n},getChildren:function(){var n=this;return n.nodes},setParent:function(n){this.parent=n},getParent:function(){return this.parent},getDisplayName:function(){return this.displayName},getContextMenuModel:function(n){function r(t){var u=t,r,i,f;if(n=="template"){for(r=[],i=0,f=t.items.length;i<f;i++)t.items[i].action!="addelement"&&t.items[i].action!="addchildelements"&&t.items[i].separator==undefined&&r.push(t.items[i]);u.items=r}return u}var t=this,i=t.nodeTypeContextMenuMappings[this.nodeType],u=r(t.contextMenuModels[i]);return new bizagi.editor.component.contextmenu.model(u)},setCaptionViewContextMenu:function(){var t=this,i=t.getContextMenuModel(),n=i.getItemByAction("viewall");n&&(n.caption=n.caption==bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-viewall")?bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-onlycontextentity"):bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-viewall"))},enableDrag:function(n){var t=this;return n==="grid"||n==="queryform"?bizagi.util.parseBoolean(t.isDraggable):t.parentIsGrid()?!1:bizagi.util.parseBoolean(t.isDraggable)},parentIsGrid:function(){var n=this,t=!1;return n.parent&&(t=n.parent.renderType==="grid"||n.parent.parentIsGrid()),t},parentIsProcessEntity:function(n){var t=this;return n?n===t.guidRelatedEntity:!1},getMaxLength:function(){var n=this;return n.maxLength},getRenderType:function(){return this.nodeSubtype},getDataType:function(){var n=this;return n.DataType},setScopeAttribute:function(n){var t=this;t.isScopeAttribute=n},parentIsParametricEntity:function(){var n=this,t=!1;return n.parent&&(t=n.parent.style=="ui-bizagi-type-entity-parametric"||n.parent.parentIsParametricEntity()),t}});bizagi.editor.component.xpathnavigator.node.extend("bizagi.editor.component.xpathnavigator.node",{},{init:function(n){var t=this;t.contextMenuModels={applicationEntity:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editentity"),style:"editentity",action:"editentity",icon:"bz-studio bz-edit-entity_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-viewall"),style:"viewall",action:"viewall",icon:"bz-studio view-all_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]},masterEntity:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addchildelements"),style:"addchildelements",action:"addchildelements",icon:"bz-studio bz-add-elements_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editentity"),style:"editentity",action:"editentity",icon:"bz-studio bz-edit-entity_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]},entity:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addchildelements"),style:"addchildelements",action:"addchildelements",icon:"bz-studio bz-add-elements_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editentity"),style:"editentity",action:"editentity",icon:"bz-studio bz-edit-entity_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editvalues"),style:"editvalues",action:"editvalues",icon:" bz-studio bz-edit-entity-values_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]},entitySystem:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addchildelements"),style:"addchildelements",action:"addchildelements",icon:"bz-studio bz-add-elements_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]},attribute:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"}]},form:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-newform"),style:"newform",action:"newForm",icon:"bz-studio bz-new-form_16x16_standard"}]},collection:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editentity"),style:"editentity",action:"editentity",icon:"bz-studio bz-edit-entity_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]}};t.nodeTypeContextMenuMappings={"entity-application":"applicationEntity","entity-master":"masterEntity","entity-parametric":"entity","entity-system":"entitySystem","entity-stakeholder":"entity",attribute:"attribute",form:"form"};t._super(n)}});
$.Class.extend("bizagi.editor.component.xpathnavigator.equiv",{rule:{xpathtosimple:{boolean:["boolean"],number:["currency","number","float","oracleNumber"],date:["date"],string:["string","text"],upload:["upload","attachment"],letter:["letter"],image:["image"],uploadecm:["uploadecm"]},xpathtocollection:{xpathtocollection:["collection"]},xpathmultiple:{entity:["entity-parametric","entity-master","entity-stakeholder","entity-system"],upload:["upload","attachment"],image:["image"],uploadecm:["uploadecm"]}}},{});
bizagi.editor.observableClass.extend("bizagi.editor.component.xpathnavigator.presenter",{},{init:function(n){this._super();n=n||{};this.canvas=n.canvas||$("<div />");this.model=n.model;this.xpathNavigator=new bizagi.editor.component.xpathnavigator(this.canvas,$.extend(n,{presenter:this}))},render:function(n){var t=this;return n=n||{},t.model=n.model||t.model,t.xpathNavigator.updateModel(t.model),t.xpathNavigator.render(n)},renderPopup:function(n){var t=this,i;return n=n||{},t.model=n.model||t.model,t.xpathNavigator.updateModel(t.model),t.xpathNavigator.subscribe("close",function(){n.onClose&&n.onClose()}),i=$.extend(n,{context:"floating"}),t.xpathNavigator.render(i)},closePopup:function(){var n=this;n.xpathNavigator.close()},showXpath:function(n){var t=this;return t.xpathNavigator.showXpath(n)},showXpathByGuid:function(n,t){this.xpathNavigator.showXpathByGuid(n,t)},showMetadataXpath:function(n){this.xpathNavigator.showMetadataXpath(n)}});
bizagi.editor.component.controller("bizagi.editor.component.layoutnavigator",{init:function(n,t){var i=this;i._super();t=t||{};i.canvas=n;i.model=t.model;i.presenter=t.presenter},render:function(n){var t=this,i,r,u,f;n=n||{};t.isReadOnly=n.isReadOnly!="undefined"?bizagi.util.parseBoolean(n.isReadOnly):!1;t.element.empty();t.showPercent=!0;$.when(t.loadTemplates()).done(function(){var n,o,e;for(i=t.model,r=$.tmpl(t.getTemplate("layoutContainer"),{}),n=0;n<i.layouts.length;n++){if(u=$.tmpl(t.getTemplate("layoutItem"),i.layouts[n]),f=$(".bz-fm-layout-width",u),t.showPercent)for(o=i.layouts[n].childrens,e=0;e<o.length;e++)layoutWidth=$.tmpl(t.getTemplate("layoutWidth"),{value:o[e].properties.width}),f.append(layoutWidth);else f.remove();r.append(u)}t.element.append(r);t.isReadOnly||t.setDraggableItems()})},updateModel:function(n){var t=this;t.model=n},loadTemplates:function(){var n={layoutContainer:bizagi.getTemplate("bizagi.editor.component.layoutnavigator")+"#layout-container",layoutItem:bizagi.getTemplate("bizagi.editor.component.layoutnavigator")+"#layout-item",layoutWidth:bizagi.getTemplate("bizagi.editor.component.layoutnavigator")+"#layout-width",layoutHelper:bizagi.getTemplate("bizagi.editor.component.layoutnavigator")+"#layout-helper"};return this._super(n)},setDraggableItems:function(){var n=this;$(".bz-fm-layout-navigator-item").data("self",n);$(".bz-fm-layout-navigator-item").draggable({helper:n.draggableHelper,connectToSortable:".ui-bizagi-container-connectedSortable",distance:15,start:function(){$("#main-panel").addClass("bz-main-dashed-grid").addClass("ui-start-drag");n.presenter.publish("controlRefreshCanvas",{})},stop:function(){$("#main-panel").removeClass("bz-main-dashed-grid").removeClass("ui-start-drag");bizagi.util.removeAutoScroll("autoscroll","layoutnavigator");n.presenter.publish("controlRefreshCanvas",{})}})},draggableHelper:function(n){var e,o,t=$(n.currentTarget),u,f,i,s,c,l;t.addClass("ui-dragging");u=t.data("id");f=t.data("caption");o=t.data("self");s=t.data("style");t.data("type",u);t.data("display",f);e=$.tmpl(o.getTemplate("layoutHelper"),{id:u,caption:f,style:s});i=e.appendTo("form-modeler").css({zIndex:900});var a=parseFloat($("label",i).width()),v=parseFloat($(".bz-fm-layout-image",i).eq(0).width()),y=a+v+40+"px";i.css("width",y);var r=$(".wrapper-main-panel"),p=$("#main-panel",r),h=$(".wrapper-main-scroll",r);return p.hasClass("biz-auto-height")&&(c=r.position().top+parseFloat(r.css("padding-top"))+parseFloat(r.css("margin-top"))+50,l=h.outerHeight(),bizagi.util.autoScroll(h,c,l,"layoutnavigator")),i},".bz-fm-layout-navigator-item dblclick":function(n){var u=this,t,i,r;u.presenter.publish("layoutDoubleClick",{id:n.data("id")});t=$(".wrapper-main-scroll");i=t[0].scrollHeight;t.scrollTop(i);r=$(".ui-bizagi-container-form > div:last",t);bizagi.util.highLightElement(r)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.layoutnavigator.model",{},{init:function(n){var t=this;this._super();t.layouts=[];n&&this.processData(n)},processData:function(n){var t=this;$.each(n.layouts,function(n,i){i.caption.resource&&(i.caption=bizagi.localization.getResource(i.caption.resource));t.layouts.push(i)})},findControlById:function(n){for(var i=this,r=!1,t=0,u=i.layouts.length;t<u;t=t+1)if(i.layouts[t].id===n){r=i.layouts[t];break}return r}});
bizagi.editor.observableClass.extend("bizagi.editor.component.layoutnavigator.presenter",{},{init:function(n){var t=this;t._super();n=n||{};t.canvas=n.canvas||$("<div />").addClass("bizagi_editor_layoutnavigator_container");t.model=n.model;t.layoutNavigator=new bizagi.editor.component.layoutnavigator(t.canvas,$.extend(n,{presenter:t}))},render:function(n){var t=this;return n=n||{},t.model=n.model||t.model,t.layoutNavigator.updateModel(t.model),t.layoutNavigator.render(n)}});
$.Controller("bizagi.editor.component.commandseditor",{init:function(n,t,i){this.canvas=n;this.model=t;this.controller=i;this.tmpl={}},refresh:function(){var t=this,i=t.element,n;this.currentTab=$("#bz-fm-commandseditor-tabs",i).tabs("option","selected");n=this.currentTab==0?$(".bz-fm-commandseditor-actions").parent():$(".bz-fm-commandseditor-validations").parent();this.scrollPosition=n.scrollTop();this.render()},render:function(){var n=this,t=n.element;t.empty();$.when(n.loadTemplates()).done(function(){var r=n.getTemplate("container"),i;$.tmpl(r,n.model.getReadOnlyModel()).appendTo(t);$("#bz-fm-commandseditor-tabs",t).tabs({selected:n.currentTab});n.scrollPosition&&(i=n.currentTab==0?$(".bz-fm-commandseditor-actions").parent():$(".bz-fm-commandseditor-validations").parent(),i.scrollTop(n.scrollPosition));n.changeEnabledView()})},changeEnabledView:function(){var n=this,u=n.element,i,t,r,e=n.model.actions,f;$.each(e,function(f,e){e.enabled==!1&&(i="li[data-guid='"+e.guid+"']",t=u.find(i),r=$(".ui-comboBox-image-small-check",t),n.disableActionsView(t,r))});f=n.model.validations;$.each(f,function(f,e){e.enabled==!1&&(i="li[data-guid='"+e.guid+"']",t=u.find(i),r=$(".ui-comboBox-image-small-check",t),n.disableActionsView(t,r))});n.updateEnabledAllChecked();n.initActionSearch();n.initValidationSearch();n.actionPositionHandlers();n.validationPositionHandlers();n.initTooltips()},disableActionsView:function(n,t){var r=bizagi.localization.getResource("formmodeler-component-enable"),u=bizagi.localization.getResource("formmodeler-component-disable"),i;return t.toggleClass("ui-comboBox-image-small-uncheck"),t.addClass("bz-point_16x16_standard"),n.toggleClass("bz-fm-commandseditor-component-disable"),t.hasClass("ui-comboBox-image-small-uncheck")?(t.prop("title",r),i=!1,t.removeClass("bz-point_16x16_standard"),t.addClass("bz-black"),t.addClass("bz-point_16x16_black")):(t.prop("title",u),i=!0,t.removeClass("bz-black"),t.removeClass("bz-point_16x16_black"),t.addClass("bz-point_16x16_standard")),i},initTooltips:function(){var t=this,n=t.element,i=n.find(".bz-fm-commandseditor-icons-edit"),r=n.find(".bz-fm-commandseditor-icons-delete"),u=n.find(".bz-fm-commandseditor-icons-toogle"),f=n.find(".bz-fm-commandseditor-icons-action-move-up"),e=n.find(".bz-fm-commandseditor-icons-action-move-down");i.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}});r.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}});u.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}});e.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}});f.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}})},updateEnabledAllChecked:function(){var r=this,n=r.element,u=n.find(".bz-fm-commandseditor-action .ui-comboBox-image-small-check").length,f=n.find(".bz-fm-commandseditor-action .ui-comboBox-image-small-uncheck").length,t=$("#bz-fm-commandseditor-actions-enable-all"),e=n.find(".bz-fm-commandseditor-validation .ui-comboBox-image-small-check").length,o=n.find(".bz-fm-commandseditor-validation .ui-comboBox-image-small-uncheck").length,i=$("#bz-fm-commandseditor-validations-enable-all");u==f?t.prop("checked",!1):t.prop("checked",!0);e==o?i.prop("checked",!1):i.prop("checked",!0)},disableAllActionsView:function(n,t,i){var r=bizagi.localization.getResource("formmodeler-component-enable"),u=bizagi.localization.getResource("formmodeler-component-disable");i?(t.removeClass("bz-black"),t.removeClass("bz-point_16x16_black"),t.addClass("bz-point_16x16_standard"),n.removeClass("bz-fm-commandseditor-component-disable"),t.removeClass("ui-comboBox-image-small-uncheck"),t.prop("title",u)):(t.removeClass("bz-point_16x16_standard"),t.addClass("bz-black"),t.addClass("bz-point_16x16_black"),n.addClass("bz-fm-commandseditor-component-disable"),t.addClass("ui-comboBox-image-small-uncheck"),t.prop("title",r))},".bz-fm-commandseditor-action, .bz-fm-commandseditor-validation click":function(n){var t=this,i=t.element;$(".bz-fm-commandseditor-action, .bz-fm-commandseditor-validation",i).removeClass("bz-state-selected").removeClass("ui-state-active");n.addClass("bz-state-selected").addClass("ui-state-active")},".bz-fm-commandseditor-action .bz-fm-commandseditor-icons-edit click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-action"),r=i.data("guid");t.controller.editAction(t.model,r)},".bz-fm-commandseditor-validation .bz-fm-commandseditor-icons-edit click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-validation"),r=i.data("guid");t.controller.editValidation(t.model,r)},"#bz-fm-commandseditor-actions-editor .ui-widget-actions button click":function(){var n=this;n.controller.createAction(n.model)},"#bz-fm-commandseditor-validations-editor .ui-widget-actions button click":function(){var n=this;n.controller.createValidation(n.model)},".bz-fm-commandseditor-action .bz-fm-commandseditor-icons-delete click":function(n){var t=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("formmodeler-component-delete-action-message"),"Bizagi","warning")).done(function(){var i=n.closest(".bz-fm-commandseditor-action"),r=i.data("guid");t.model.deleteAction(r);t.refresh()})},".bz-fm-commandseditor-action .ui-comboBox-image-small-check click":function(n){var t=this,u=t.disableActionsView(n.parents("li"),n),i,r;t.updateEnabledAllChecked();i=n.closest(".bz-fm-commandseditor-action");r=i.data("guid");t.model.changeActionStateEnabled(r,u)},"#bz-fm-commandseditor-actions-enable-all click":function(n){var t=this,i=t.element,u=i.find(".bz-fm-commandseditor-action"),f=i.find(".bz-fm-commandseditor-action .ui-comboBox-image-small-check"),r=n.is(":checked");t.disableAllActionsView(u,f,r);t.model.changeAllActionStateEnabled(r)},".bz-fm-commandseditor-validation .bz-fm-commandseditor-icons-delete click":function(n){var t=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("formmodeler-component-delete-validation-message"),"Bizagi","warning")).done(function(){var i=n.closest(".bz-fm-commandseditor-validation"),r=i.data("guid");t.model.deleteValidation(r);t.refresh();$("#bz-fm-commandseditor-tabs",t.element).tabs("option","active",1)})},".bz-fm-commandseditor-validation .ui-comboBox-image-small-check click":function(n){var t=this,u=t.disableActionsView(n.parents("li"),n),i,r;t.updateEnabledAllChecked();i=n.closest(".bz-fm-commandseditor-validation");r=i.data("guid");t.model.changeValidationStateEnabled(r,u)},"#bz-fm-commandseditor-validations-enable-all change":function(n){var t=this,i=t.element,u=i.find(".bz-fm-commandseditor-validation"),f=i.find(".bz-fm-commandseditor-validation .ui-comboBox-image-small-check"),r=n.is(":checked");t.disableAllActionsView(u,f,r);t.model.changeAllValidationStateEnabled(r)},loadTemplates:function(){var t=this,n=new $.Deferred;return $.when(t.loadTemplate("container",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-container"))).done(function(){n.resolve()}),n.promise()},loadTemplate:function(n,t){var i=this,r=new $.Deferred;if(i.tmpl[n])r.resolve(i.tmpl[n]);else return bizagi.templateService.getTemplate(t).done(function(t){i.tmpl[n]=t});return r.promise()},getTemplate:function(n){return this.tmpl[n]?this.tmpl[n]:null},actionPositionHandlers:function(){var n=this,t=n.element,i=t.find(".bz-fm-commandseditor-icons-action-move-up"),r=t.find(".bz-fm-commandseditor-icons-action-move-down");i.click(function(){var t=$(this).closest(".bz-fm-commandseditor-action"),i=$(t).prev(),r=$(t).data("guid");n.model.moveActionUp(r);$(t).insertBefore(i)});r.click(function(){var t=$(this).closest(".bz-fm-commandseditor-action"),i=$(t).next(),r=$(t).data("guid");n.model.moveActionDown(r);$(t).insertAfter(i)})},validationPositionHandlers:function(){var n=this,t=n.element,i=t.find(".bz-fm-commandseditor-icons-validation-move-up"),r=t.find(".bz-fm-commandseditor-icons-validation-move-down");r.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip"});i.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip"});i.click(function(){var t=$(this).closest(".bz-fm-commandseditor-validation"),i=$(t).prev(),r=$(t).data("guid");n.model.moveValidationUp(r);$(t).insertBefore(i)});r.click(function(){var t=$(this).closest(".bz-fm-commandseditor-validation"),i=$(t).next(),r=$(t).data("guid");n.model.moveValidationDown(r);$(t).insertAfter(i)})},initActionSearch:function(){var n=this,t=n.element,i=t.find("#bz-fm-commandseditor-actions-text-to-search"),r=t.find(".bz-fm-commandseditor-action"),u=t.find("#bz-fm-commandseditor-condition"),f=t.find("#bz-fm-commandseditor-statement"),e=t.find("#bz-fm-commandseditor-elsestatement");i.change(function(){n.showActionsFound(r,i)});u.change(function(){n.showActionsFound(r,i)});f.change(function(){n.showActionsFound(r,i)});e.change(function(){n.showActionsFound(r,i)})},initValidationSearch:function(){var n=this,t=n.element,i=t.find("#bz-fm-commandseditor-validations-text-to-search"),r=t.find(".bz-fm-commandseditor-validation");i.change(function(){n.showValidationsFound(r,i)})},showActionsFound:function(n,t){var l=this,o=l.element,a=o.find("#bz-fm-commandseditor-condition").is(":checked")||!1,v=o.find("#bz-fm-commandseditor-statement").is(":checked")||!1,y=o.find("#bz-fm-commandseditor-elsestatement").is(":checked")||!1,r=t.val(),i,u,f,e;if(r.length>2)for(n.hide(),r=r.toUpperCase(),i=0;i<n.length;i++){var s=$(n[i]).find("span.bz-fm-commandseditor-condition-xpath.biz-highlight-1-color"),h=$(n[i]).find("[data-section='then']").find("span.bz-fm-commandseditor-statement-xpath.biz-highlight-1-color"),c=$(n[i]).find("[data-section='else']").find("span.bz-fm-commandseditor-statement-xpath.biz-highlight-1-color");if(a)for(u=0;u<s.length;u++)if($(s[u]).html().toUpperCase().indexOf(r)>-1){$(n[i]).show();break}if(v)for(f=0;f<h.length;f++)if($(h[f]).html().toUpperCase().indexOf(r)>-1){$(n[i]).show();break}if(y)for(e=0;e<c.length;e++)if($(c[e]).html().toUpperCase().indexOf(r)>-1){$(n[i]).show();break}}else r===""&&n.show()},showValidationsFound:function(n,t){var e=this,o=e.element,i=t.val(),r,f,u;if(i.length>2){for(n.hide(),i=i.toUpperCase(),r=0;r<n.length;r++)for(f=$(n[r]).find("span.bz-fm-commandseditor-condition-xpath.biz-highlight-1-color"),u=0;u<f.length;u++)if($(f[u]).html().toUpperCase().indexOf(i)>-1){$(n[r]).show();break}}else i===""&&n.show()}});
bizagi.editor.component.controller("bizagi.editor.component.baseeditor",{init:function(n,t,i){this._super();this.canvas=n;this.model=t;this.controller=i;this.tmpl={}},refresh:function(){var n=this,t=$(".bz-fm-actionvalidationeditor",n.element);n.scrollPosition=t.scrollTop();n.render()},render:function(){var n=this,t=n.element;t.empty();$.when(n.loadTemplates()).done(function(){var r=n.getTemplate("container"),i;$.tmpl(r,n.model.getViewModel()).appendTo(t);n.configureSortablePlugin();n.scrollPosition&&(i=$(".bz-fm-actionvalidationeditor",n.element),i.scrollTop(n.scrollPosition))})},".bz-fm-commandseditor-condition-logicOperator click":function(n){var t=this,i=n.data("parent-expression");t.displayLogicOperators(n,i)},".bz-fm-commandseditor-condition-xpath click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-condition").data("guid");t.displayExpressionControls(n,i)},".bz-fm-commandseditor-condition-operator click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-condition").data("guid");t.displayOperators(n,i)},".bz-fm-commandseditor-condition-argument click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-condition").data("guid");t.displayExpressionArgument(n,i)},".bz-fm-commandseditor-condition-new click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-button-bar").data("complex-guid");t.model.addExpression(i);t.refresh()},".bz-fm-commandseditor-btn-complex click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-button-bar").data("complex-guid");return t.model.addComplexExpression(i),t.refresh(),!1},".bz-fm-commandseditor-condition .bz-fm-commandseditor-icons-delete click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-complex").closest(".bz-fm-commandseditor-condition").data("guid"),r=n.closest(".bz-fm-commandseditor-condition").data("guid");t.model.removeExpression(r,i);t.refresh()},".bz-fm-commandseditor-button-ok click":function(){var n=this,t=n.model.validate(),i;t.isValid?n.publish("save",{model:n.model.getData()}):(n.refresh(),i=t.message?t.message:bizagi.localization.getResource("formmodeler-component-commandseditor-validate-requiredfields"),bizagi.showMessageBox(i,"Bizagi","error",!1))},".bz-fm-commandseditor-button-cancel click":function(){var n=this;n.publish("cancel",{model:n.model})},displayExpressionControls:function(n,t){var i=this,u=i.model.getControls({appliesToRender:!0,exclude:["undefined","activityFlowButton"],checkContext:!0}),f=i.model.fullModel.resolveCommand(i.model.getExpression(t)),r=i.displayList(u,f,!0);r.position({my:"left top",at:"left bottom",of:n,collision:"fit flip"});r.find("li").click(function(){var n=$(this).data("value"),u=i.model.getPropertyToUpdate(n);i.model.updateExpression(t,u,n,u!="xpath");i.refresh();r.detach()})},displayOperators:function(n,t){var i=this,u=i.model.getOperators(t),f=i.model.getExpression(t).operator,r=i.displayList(u,f);r.position({my:"left top",at:"left bottom",of:n,collision:"fit flip"});r.find("li").click(function(){var n=$(this).data("value");i.model.updateExpression(t,"operator",n);i.refresh();r.detach()})},displayLogicOperators:function(n,t){var i=this,u=i.model.getLogicOperators(),f=i.model.getLogicOperator(t),r=i.displayList(u,f);r.position({my:"left top",at:"left bottom",of:n,collision:"none"});r.find("li").click(function(){var n=$(this).data("value");i.model.updateLogicOperator(t,n);i.refresh();r.detach()})},displayExpressionArgument:function(n,t){var i=this,u=i.model.getExpression(t).argument,f=i.model.getExpressionType(t),e=i.model.getExpression(t).xpath,r;r=i.getConstantEditor(n,u,e,f);r&&(r.render(),r.subscribe("valuechanged",function(n,u){i.model.updateExpression(t,"argument",u.value);i.model.updateExpression(t,"argumentType",u.argumentType);r.close();i.refresh()}))},getConstantEditor:function(n,t,i,r){var f=this,u={templates:f.tmpl,element:n,xpath:i,value:t,mainEditor:this};return r=="boolean"?new bizagi.editor.component.constantargument.boolean(u):r=="string"?new bizagi.editor.component.constantargument.string(u):r=="date"?new bizagi.editor.component.constantargument.date(u):r=="number"?new bizagi.editor.component.constantargument.number(u):r=="entity"?new bizagi.editor.component.constantargument.entity(u):r=="color"?new bizagi.editor.component.constantargument.color(u):r=="rule"?new bizagi.editor.component.constantargument.rule(u):r=="interface"?new bizagi.editor.component.constantargument.interface(u):r=="sap"?new bizagi.editor.component.constantargument.sap(u):r=="connector"?new bizagi.editor.component.constantargument.connector(u):null},displayList:function(n,t,i){var u=this,f=i?u.getTemplate("controlslist"):u.getTemplate("list"),r=$.tmpl(f,{list:n,currentValue:t});return r.appendTo("form-modeler",document),setTimeout(function(){r.click(function(n){n.stopPropagation()});$(document).one("click",function(){r.detach()})},100),r},configureSortablePlugin:function(){},loadTemplates:function(){}});bizagi.editor.observableClass.extend("bizagi.editor.component.constantargument.editor",{},{init:function(n){this._super();this.templates=n.templates;this.element=n.element;this.xpath=n.xpath;this.value=n.value;this.mainEditor=n.mainEditor;this.model=n.mainEditor.model;this.displayXpathControls=!0},render:function(){var n=this,r=n.templates.argument,t=n.editor=$.tmpl(r),i;t.appendTo($("form-modeler",document));i=$(".bz-fm-commandseditor-argument-editor",t);$.when(n.internalRender(i)).done(function(t){n.control=t});n.displayXpathControls?t.find(".bz-fm-commandseditor-argument-xpath").click(function(){n.displayControls($(this))}):t.find(".bz-fm-commandseditor-argument-xpath").hide()},displayControls:function(n){var t=this,r=t.model.getControl(t.xpath),f=t.model.getControl(t.value),e=[],u,o,i;r&&e.push(r.type);u={appliesToRender:!0,filterBy:e};r.relatedEntity&&$.extend(u,{filterByRelatedEntity:!0,relatedEntity:r.relatedEntity});o=t.model.getControls(u);i=t.controlsList=t.mainEditor.displayList(o,f?f.xpath:null,!0);i.position({my:"right top",at:"right bottom",offset:"4 0",of:n,collision:"none"});i.find("li").click(function(){var n=$(this).data("value");t.changeValue(n,"xpath")});setTimeout(function(){i.click(function(n){n.stopPropagation()});$(document).one("click",function(){i.detach()})},100)},floatElement:function(){var n=this,t=n.editor;t.position({my:"left top",at:"left top",of:n.element,offset:" 0 -6"});setTimeout(function(){t.click(function(n){n.stopPropagation()});$(document).one("click",function(){n.close()})},100);n.element.hide()},changeValue:function(n,t){var i=this;t=t||"const";i.publish("valuechanged",{value:n,argumentType:t})},localizableEditor:function(n){var t=this;t.publish("launchLocalizableEditor",{value:n})},close:function(){var n=this;$(document).unbind("click");n.editor&&n.editor.detach();n.controlsList&&n.controlsList.detach();n.element.show()}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.boolean",{},{internalRender:function(n){var t=this,r=t.templates.boolean,i=$.tmpl(r,{value:t.value});return i.appendTo(n),t.floatElement(),i.find("span").click(function(){var n=bizagi.util.parseBoolean($(this).data("value"));t.changeValue(n)}),i}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.string",{},{internalRender:function(n){var t=this,u=t.templates.string,r=$.tmpl(u,{value:t.value}),i;return r.appendTo(n),t.floatElement(),i=r.find("input"),i.focus(),i.change(function(){i.unbind("change");var n=$(this).val();n.length==0&&(n=null);t.changeValue(n)}),i.keyup(function(n){if(n.which==13){var i=$(this).val();i.length==0&&(i=null);t.changeValue(i)}}),r}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.textarea",{},{init:function(n){this._super(n);this.displayXpathControls=!1},internalRender:function(n){var t=this,f=t.templates.textarea,r=$.tmpl(f,{value:t.value}),i,u;return r.appendTo(n),t.floatElement(),i=r.find("textarea"),i.focus(),i.keyup(function(n){if(n.which==13){var i=$(this).val();i.length==0&&(i=null);t.changeValue(i)}}),t.bindChangeEventElement(i),u=r.find("i"),u.bind("click",function(){t.localizableEditor(i.val())}),u.bind("mouseenter",function(){i.unbind("change")}),u.bind("mouseleave",function(){t.bindChangeEventElement(i)}),r},bindChangeEventElement:function(n){var t=this;n.bind("change",function(){var n=$(this).val();n.length==0&&(n=null);t.changeValue(n)})}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.date",{},{internalRender:function(n){var t=this,f=t.templates.date,i=t.dateControl=$.tmpl(f,{value:t.value}),r,u;i.appendTo(n);t.floatElement();try{r=bizagi.util.dateFormatter.getDateFromInvariant(t.value,!1)}catch(e){r=null}return u=i.find("div"),u.datepicker({defaultDate:r,onSelect:function(n){var i=n;i.length==0&&(i=null);t.changeValue(i)}}),i},displayControls:function(n){var t=this;t._super(n);t.dateControl&&t.dateControl.css("opacity",.2)}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.number",{},{internalRender:function(n){var t=this,u=t.templates.number,f=t.formatValue(t.value),r=$.tmpl(u,{value:f}),i;return r.appendTo(n),t.floatElement(),i=r.find("input"),i.numeric("."),i.focus(),i.change(function(){i.unbind("change");var n=$(this).val();n.length==0&&(n=null);t.changeValue(n)}),i.keyup(function(n){if(n.which==13){var i=$(this).val();i.length==0&&(i=null);t.changeValue(i)}}),r},formatValue:function(){var n=this,t=$("<label/>").html(n.value||0);return t.asNumber()}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.entity",{},{internalRender:function(n){var t=this,i=new $.Deferred,r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"relatedentity",xpath:bizagi.editor.utilities.resolveComplexXpath(t.xpath)});return $.when(r.processRequest()).done(function(r){var f=t.templates.list,e=t.value?t.value.value||t.value:null,u=t.entityList=$.tmpl(f,{list:r,currentValue:e});u.appendTo(n);t.floatElement();u.find("li").click(function(){var n=$(this).data("value"),i=$(this).text();t.changeValue({value:n,label:i},"entity")});i.resolve(u)}),i.promise()},displayControls:function(n){var t=this;t._super(n);t.entityList&&t.entityList.css("opacity",.2)}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.color",{},{init:function(n){this._super(n);this.displayXpathControls=!1},internalRender:function(n){var t=this,r=t.templates.color,i=$.tmpl(r,{value:t.value});return i.appendTo(n),i.find("input").spectrum({flat:!0,color:t.value,preferredFormat:"hex",showInput:!0,cancelResponse:function(n){n.flat=!1;i.find("input").spectrum("destroy");i.closest(".bz-fm-commandseditor-argument").remove();t.element.show()},showPalette:!0,palette:[["black","white","red","orange"],["yellow","green","blue","purple"]],chooseText:bizagi.localization.getResource("formmodeler-component-commandseditor-ok"),cancelText:bizagi.localization.getResource("formmodeler-component-commandseditor-cancel"),change:function(n){var i=n.toName()||"#"+n.toHex();t.changeValue(i)}}),t.floatElement(),i}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.rule",{},{render:function(){var n=this,i=n.model,r={rule:{baref:{ref:"expression"}}},t,u,f;bizagi.editor.utilities.isObject(n.value)&&(bizagi.editor.utilities.isObject(n.value.rule)?r={rule:n.value.rule}:n.value.guid&&(r={rule:{baref:{ref:n.value.guid}}}));t=null;i.isGridContext()&&(u=i.getContextAction().value,t=i.getControl(u).baxpath);f=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"ruleexpression",categorytype:"Scripting",type:"executerule",idcontextentity:t?bizagi.editor.utilities.resolveRelatedEntityFromXpath(t):null,data:r,editor:"rule"});$.when(f.processRequest()).done(function(t){if(t){var i=t.displayName;delete t.displayName;n.changeValue({rule:t,label:i})}})}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.interface",{},{render:function(){var n=this,i=n.model,r={interface:{baref:{ref:"expression"}}},t,u,f;bizagi.editor.utilities.isObject(n.value)&&(bizagi.editor.utilities.isObject(n.value.interface)?r={interface:n.value.interface}:n.value.guid&&(r={interface:{baref:{ref:n.value.guid}}}));t=null;i.isGridContext()&&(u=i.getContextAction().value,t=i.getControl(u).baxpath);f=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadinterface",type:"executerule",idcontextentity:t?bizagi.editor.utilities.resolveRelatedEntityFromXpath(t):null,idscopedefinition:t?bizagi.editor.utilities.resolveContextEntityFromXpath(t):null,data:r});$.when(f.processRequest()).done(function(t){if(t){var i=t.displayName||"Interface";delete t.displayName;n.changeValue({interface:t,label:i})}})}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.sap",{},{render:function(){var n=this,i=n.model,r={interface:{baref:{ref:"expression"}}},t,u,f;bizagi.editor.utilities.isObject(n.value)&&(bizagi.editor.utilities.isObject(n.value.interface)?r={interface:n.value.interface}:n.value.guid&&(r={interface:{baref:{ref:n.value.guid}}}));t=null;i.isGridContext()&&(u=i.getContextAction().value,t=i.getControl(u).baxpath);f=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadsapinterface",type:"rule",idcontextentity:t?bizagi.editor.utilities.resolveRelatedEntityFromXpath(t):null,idscopedefinition:t?bizagi.editor.utilities.resolveContextEntityFromXpath(t):null,data:r});$.when(f.processRequest()).done(function(t){if(t){var i=t.displayName||"sap interface";delete t.displayName;n.changeValue({interface:t,label:i})}})}});bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.connector",{},{render:function(){var n=this,i=n.model,r={connector:{baref:{ref:"expression"}}},t,u,f;bizagi.editor.utilities.isObject(n.value)&&(bizagi.editor.utilities.isObject(n.value.connector)?r={connector:n.value.connector}:n.value.guid&&(r={connector:{baref:{ref:n.value.guid}}}));t=null;i.isGridContext()&&(u=i.getContextAction().value,t=i.getControl(u).baxpath);f=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadconnectorinterface",type:"rule",idcontextentity:t?bizagi.editor.utilities.resolveRelatedEntityFromXpath(t):null,idscopedefinition:t?bizagi.editor.utilities.resolveContextEntityFromXpath(t):null,data:r});$.when(f.processRequest()).done(function(t){if(t){var i=t.displayName||"connector interface";delete t.displayName;n.changeValue({connector:t,label:i})}})}});
bizagi.editor.observableClass.extend("bizagi.editor.component.baseeditor.model",{argumentTypes:{"const":"formmodeler-component-commandseditor-argumenttype-constant",xpath:"formmodeler-component-commandseditor-argumenttype-xpath"}},{init:function(n,t){this.logicOperators=bizagi.editor.component.commandseditor.model.logicOperators;this.data=n;this.fullModel=t;this.expressions={}},resolveXpath:function(n){return this.fullModel.resolveXpath(n)},resolveCommand:function(n){return this.fullModel.resolveCommand(n)},getPropertyToUpdate:function(n){var r=this,i="xpath",t=r.fullModel.data.controls[n];return t&&t.propertyToUpdate&&(i=t.propertyToUpdate),i},getData:function(){return this.data},getControl:function(n){if(!n)return null;n=bizagi.editor.utilities.resolveComplexXpath(n);var t=this.fullModel.getControls();return t[n]},getControls:function(n){var r=this.fullModel.getControls(),e={},t,u,a;n=n||{};var v=n.appliesToRender||!1,y=n.appliesToContainer||!1,o=n.filterBy||null,s=n.exclude||null,p=n.checkContext||!1,w=!1,h=n.filterByRelatedEntity||!1,c=null;h&&(c=n.relatedEntity);n.checkGridContainer&&(w=this.areThereGridAttributes());for(t in r){var f=r[t],b=f.render,k=f.container,l=f.type,d=f.xpathContainer,i=!1;if(v&&b&&(i=!0),y&&k&&(i=!0),o)for(i=!1,u=0;u<o.length;u++)if(o[u]==l){i=!0;break}if(i&&s)for(u=0;u<s.length;u++)if(s[u]==l){i=!1;break}i&&p&&this.isGridContext()&&(a=this.getContextAction(),d!==a.value&&(i=!1));i&&(h?c===f.relatedEntity&&(e[t]={label:r[t].label,type:r[t].controlType,style:r[t].style}):e[t]={label:r[t].label,type:r[t].controlType,style:r[t].style})}return e},getOperators:function(n){var r=this,e={},o=r.getExpressionType(n),u,f,t,i;for(u in r.operators){for(f=!1,t=r.operators[u],i=0;i<t.appliesTo.length;i++)if(t.appliesTo[i]==o){f=!0;break}f&&(e[u]=bizagi.localization.getResource(t.label))}return e},getLogicOperators:function(){var t=this,i={},n,r;for(n in t.logicOperators)r=t.logicOperators[n],i[n]=bizagi.localization.getResource(r);return i},getLogicOperator:function(n){var t=this,i=t.data;return n?t.expressions[n].complex.conditions.operator:i.conditions.operator},getExpression:function(n){return this.expressions[n].simple},getExpressionType:function(n){var t=this,i=t.expressions[n];return t.fullModel.getXpath(t.resolveXpath(t.getXpathExpression(i.simple))).type},getViewModel:function(){for(var u,n=this,t=n.data,r={hasErrors:!n.validate(),guid:t.guid,conditions:{expressions:[]}},i=0;i<t.conditions.expressions.length;i++)u=i>0?n.fullModel.getLogicOperatorName(t.conditions.operator):null,r.conditions.expressions.push(n.getViewExpression(t.conditions.expressions[i],null,u));return r},getViewExpression:function(n,t,i){var r=this,f,u,e;if(n.guid=n.guid||Math.guid(),r.expressions[n.guid]=n,f={simple:n.simple?{xpath:{label:r.fullModel.getXpathName(r.resolveXpath(r.getXpathExpression(n.simple))),value:r.resolveXpath(n.simple.xpath)},operator:{label:r.getOperatorName(n.simple.operator),value:n.simple.operator,isUnary:r.isUnaryOperator(n.simple.operator)},argument:{label:r.fullModel.getArgumentName(n.simple.argument,n.simple.argumentType),value:n.simple.argument&&n.simple.argument.value?n.simple.argument.value:n.simple.argument},argumentType:n.simple.argumentType}:null,complex:n.complex?{conditions:{expressions:[]}}:null,logicOperator:i,parentGuid:t,guid:n.guid},n.complex)for(u=0;u<n.complex.conditions.expressions.length;u++)e=u>0?r.fullModel.getLogicOperatorName(n.complex.conditions.operator):null,f.complex.conditions.expressions.push(r.getViewExpression(n.complex.conditions.expressions[u],n.guid,e));return f},getXpathExpression:function(n){return this.fullModel.getXpathExpression(n)},getOperatorName:function(n){return bizagi.localization.getResource(this.fullModel.getOperatorName(n,"action"))},getXpathContainer:function(){return this.xpathContainer||null},isUnaryOperator:function(n){return this.fullModel.isUnaryOperator(n,"action")},isGridContext:function(){return!1},areThereGridAttributes:function(){return!1},updateExpression:function(n,t,i,r){var e=this,u=e.expressions[n],f;t=="xpath"?(f=e.getControl(i),u.simple[t]=f.baxpath,u.simple.xpathContainer=f.xpathContainer,delete u.simple.operator,delete u.simple.argument,u.simple.propertyToUpdate&&(delete u.simple[u.simple.propertyToUpdate],delete u.simple.propertyToUpdate)):r?(f=e.getControl(i),u.simple[t]=f[t],u.simple.propertyToUpdate=t,delete u.simple.operator,delete u.simple.argument,delete u.simple.xpath):u.simple[t]=i},updateLogicOperator:function(n,t){var i=this,r=i.data,u=n?i.expressions[n].complex.conditions:r.conditions;u.operator=t},addExpression:function(n){var t=this,u=t.data,f=n?t.expressions[n].complex.conditions.expressions:u.conditions.expressions,i=Math.guid(),r={simple:{operator:null,xpath:null,argument:null,argumentType:"const",guid:i}};f.push(r);t.expressions[i]=r},addComplexExpression:function(n){var t=this,u=t.data,f=n?t.expressions[n].complex.conditions.expressions:u.conditions.expressions,i=Math.guid(),r={complex:{conditions:{operator:"and",expressions:[{simple:{operator:null,xpath:null,argument:null,argumentType:"const",guid:i}}]}}};f.push(r);t.expressions[i]=r},removeExpression:function(n,t){var u=this,e=u.data,f=t?u.expressions[t].complex.conditions.expressions:e.conditions.expressions,r,i;for(delete u.expressions[n],r=-1,i=0;i<f.length;i++)if(f[i].guid==n){r=i;break}r>=0&&f.splice(r,1)},setXpathContainer:function(n){this.xpathContainer=n},validate:function(n){var r=this,u=r.data,t={isValid:!0},i;if(r.setXpathContainer(null),u.conditions.expressions.length==0)return!1;for(i=0;i<u.conditions.expressions.length;i++)if(t=r.validateExpression(u.conditions.expressions[i],n),!t.isValid)return t;return t},validateExpression:function(n,t){var r=this,i=r.getXpathContainer(),f={isValid:!0},e,u;if(n.simple){if(e=r.getXpathExpression(n.simple),e==null||e.length==0)return{isValid:!1};if(n.simple.operator==null||n.simple.operator.length==0)return{isValid:!1};if(!r.fullModel.isUnaryOperator(n.simple.operator,t)&&(n.simple.argument==null||n.simple.argument.length==0))return{isValid:!1};if(i=i==null?n.simple.xpathContainer||null:i,i!=null&&n.simple.xpathContainer!=null&&i!==n.simple.xpathContainer)return{isValid:!1,message:bizagi.localization.getResource("formmodeler-component-commandseditor-validate-invalidcondition")};r.setXpathContainer(i)}else{if(n.complex.conditions.expressions.length==0)return{isValid:!1};for(u=0;u<n.complex.conditions.expressions.length;u++)if(f=r.validateExpression(n.complex.conditions.expressions[u],t),!f.isValid)return{isValid:!1}}return f}});
bizagi.editor.component.baseeditor("bizagi.editor.component.actioneditor",{init:function(n,t,i){this._super(n,t,i)},".bz-fm-commandseditor-statement-command click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-statement").data("guid");t.displayCommands(n,i)},".bz-fm-commandseditor-statement-xpath click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-statement").data("guid");t.displayStatementControls(n,i)},".bz-fm-commandseditor-statement-argument click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-statement").data("guid");(typeof t.model.isOpen=="undefined"||t.model.isOpen)&&t.displayStatementArgument(n,i);t.model.isOpen=!1;setTimeout(function(){t.model.isOpen=!0},1e3)},".bz-fm-commandseditor-statement-new click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-statements").data("section");t.model.addStatement(i);t.refresh()},".bz-fm-commandseditor-statement .bz-fm-commandseditor-icons-delete click":function(n){var t=this,i=n.closest(".bz-fm-commandseditor-statements").data("section"),r=n.closest(".bz-fm-commandseditor-statement").data("guid");t.model.removeStatement(r,i);t.refresh()},".bz-fm-commandseditor-statements-else-action click":function(n){var t=this;t.displayElseActions(n)},".bz-fm-commandseditor-context-control click":function(n){var t=this;t.displayContextControls(n)},displayContextControls:function(n){var t=this,r=t.model.getControls({appliesToRender:!0,filterBy:["collection"]}),i;r.Form={label:"Form",type:"form",style:"bz-studio bz-forms_16x16_standard"};i=t.displayList(r,t.model.getContextAction().value,!0);i.position({my:"left top",at:"left bottom",of:n,collision:"fit flip"});i.find("li").click(function(){var n=$(this).data("value");t.model.updateContext(n);t.refresh();i.detach()})},displayStatementControls:function(n,t){var i=this,e=i.model.fullModel.resolveCommand(i.model.getStatement(t)),u=i.model.getStatementCommand(t),f,r;u!=null&&(f=i.model.getControls(u),r=i.displayList(f,e,!0),r.position({my:"left top",at:"left bottom",of:n,collision:"fit flip"}),r.find("li").click(function(){var n=$(this).data("value"),u=i.model.getPropertyToUpdate(n);i.model.updateStatement(t,u,n,u!=="xpath");i.model.updateButtonsStatement(t,n);i.refresh();r.detach()}))},displayStatementArgument:function(n,t){var i=this,u=i.model.getStatement(t).argument,f=i.model.getStatementType(t),e=i.model.getStatement(t).xpath,r;r=i.getConstantEditor(n,u,e,f);r&&(r.subscribe("valuechanged",function(n,u){i.model.updateStatement(t,"argument",u.value);i.model.updateStatement(t,"argumentType",u.argumentType);r.close();i.refresh()}),r.render())},displayCommands:function(n,t){var i=this,u=i.model.getCommands(t),f=i.model.getStatement(t).command,r=i.displayList(u,f);r.position({my:"left top",at:"left bottom",of:n,collision:"fit flip"});r.find("li").click(function(){var f=$(this).data("value"),u;i.model.updateStatement(t,"command",f);u=bizagi.editor.component.commandseditor.actioncommands.factory.createCommand({command:f,guid:t,model:i.model,controller:i,section:n.closest(".bz-fm-commandseditor-statements").data("section")});u&&u.execute();i.refresh();r.detach()})},displayElseActions:function(n){var t=this,r=t.model.getElseActions(),u=t.model.getElseAction(),i=t.displayList(r,u);i.position({my:"left top",at:"left bottom",of:n,collision:"none"});i.find("li").click(function(){var n=$(this).data("value");t.model.updateElseAction(n);t.refresh();i.detach()})},configureSortablePlugin:function(){var n=this,t=$(".bz-fm-commandseditor-statements",n.element);t.bind("sortstart",function(t,i){n.onSortStart(i)});t.bind("sortstop",function(t,i){n.onSortFinish(i)});t.sortable({items:".bz-fm-commandseditor-item",revert:!1,distance:10,cursorAt:{top:-3,left:0},placeholder:"ui-bizagi-placeholder",delay:150}).disableSelection()},onSortStart:function(n){var t=$(n.item).parent().children(".bz-fm-commandseditor-item").index(n.item);n.item.data("start-position",t)},onSortFinish:function(n){var t=this,i=$(n.item).parent().children(".bz-fm-commandseditor-item").not(".ui-sortable-placeholder").index(n.item),r=n.item.data("start-position"),u=n.item.closest(".bz-fm-commandseditor-statements").data("section");t.model.sortCommands({finalPosition:i,initialPosition:r,section:u})},loadTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.loadTemplate("container",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-action")),n.loadTemplate("list",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-list")),n.loadTemplate("controlslist",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-controls-list")),n.loadTemplate("argument",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument")),n.loadTemplate("boolean",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-boolean")),n.loadTemplate("string",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-string")),n.loadTemplate("textarea",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-textarea")),n.loadTemplate("date",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-date")),n.loadTemplate("number",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-number")),n.loadTemplate("color",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-color")),n.loadTemplate("rule",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-rule")),n.loadTemplate("interface",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-interface"))).done(function(){t.resolve()}),t.promise()}});
bizagi.editor.component.baseeditor.model.extend("bizagi.editor.component.actioneditor.model",{action:"action"},{init:function(n,t){this._super(n,t);this.operators=bizagi.editor.component.commandseditor.model.operators.action;this.actionCommands=bizagi.editor.component.commandseditor.model.actionCommands;this.elseActions=bizagi.editor.component.commandseditor.model.elseActions;this.statements={};this.context=null},getData:function(){var i=this,n=this.data,r=[],t;if(n.conditions.expressions.length==0)return!1;for(t=0;t<n.conditions.expressions.length;t++)i.findDependencies(n.conditions.expressions[t],r);return n.dependencies=r,n.context=i.context,n},getSelectedCommands:function(){var n=this.data;return n.commands},getCommands:function(){var n=this,i={};for(var t in n.actionCommands)n.actionCommands[t].hidden||(i[t]=bizagi.localization.getResource(n.actionCommands[t].label));return i},getStatement:function(n){return this.statements[n]},getStatementType:function(n){var t=this,i=t.statements[n],r;if(bizagi.util.isEmpty(i.command))return null;if(r=this.actionCommands[i.command].type,r=="argument"){if(bizagi.util.isEmpty(t.resolveXpath(i.xpath)))return null;r=t.fullModel.getXpath(t.resolveXpath(i.xpath)).type}return r},getStatementCommand:function(n){for(var u=this,f=u.statements[n],t=this.actionCommands[f.command],r={label:t?t.label:"",filterBy:t.filterBy,exclude:t.exclude,checkContext:!0,checkGridContainer:!0},i=0;i<t.appliesTo.length;i++)t.appliesTo[i]=="render"&&(r.appliesToRender=!0),t.appliesTo[i]=="container"&&(r.appliesToContainer=!0);return r},getStatementProperty:function(n){var i=this,t=i.statements[n];return t?t.propertyToUpdate?t.propertyToUpdate:"xpath":"xpath"},haveAllCommandsReverse:function(){var t=this,r=t.getSelectedCommands(),n;for(i=0;i<r.length;i++)if(n=r[i].command,n!=null&&!t.actionCommands[n].hasReverse)return!1;return!0},verifyFormHasReverse:function(){var n=this;return n.fullModel.data.flags.EnableShowAlwaysReverseAction||n.fullModel.data.enableReverse},getElseActions:function(){var n=this,t={};for(var i in n.elseActions)t[i]=bizagi.localization.getResource(n.elseActions[i]);return n.verifyFormHasReverse()&&(!n.verifyFormHasReverse()||n.haveAllCommandsReverse())||delete t.automatic,t},getElseAction:function(){return this.fullModel.getElseActionType(this.data)},getXpathName:function(n){return this.fullModel.getXpathName(n)},getContextAction:function(){var n=this,t;return n.context=n.context||n.data.context,t=n.context,t?{label:n.getXpathName(t)||t,value:t}:{label:"Form",value:"Form"}},getViewModel:function(){for(var r,n=this,t=n.data,f=n.getElseAction(),i=$.extend(n._super(),{commands:[],elseCommands:t.elseCommands?[]:undefined,elseAction:{label:bizagi.localization.getResource(n.elseActions[f]),value:f},context:n.getContextAction()}),u=0;u<t.commands.length;u++)i.commands.push(n.getViewCommand(t.commands[u]));if(i.elseCommands)for(r=0;r<t.elseCommands.length;r++)i.elseCommands.push(n.getViewCommand(t.elseCommands[r]));return i},getViewCommand:function(n){var t=this;return n.guid=n.guid||Math.guid(),t.statements[n.guid]=n,{xpath:{label:t.fullModel.getXpathName(t.resolveCommand(n)),value:t.resolveCommand(n)},command:{label:bizagi.localization.getResource(t.fullModel.getCommandName(n.command)),value:n.command,isUnary:t.fullModel.isUnaryCommand(n.command),isOnlyCommand:t.fullModel.isOnlyCommand(n.command),isOnlyArgument:t.fullModel.isOnlyArgument(n.command),hidden:t.fullModel.isHiddenCommand(n.command)},argument:{label:t.fullModel.getArgumentName(n.argument,n.argumentType),value:n.argument&&n.argument.value?n.argument.value:n.argument},guid:n.guid}},updateStatement:function(n,t,i,r){var f=this,u=f.statements[n],e;f.removeAttributesStatement(u,t,r);t=="xpath"?(e=f.getControl(i),u[t]=e.baxpath,u.xpathContainer=e.xpathContainer):(u[t]=i,r&&(u.propertyToUpdate=t))},updateButtonsStatement:function(n,t){var i=this,u=i.statements[n],r=i.fullModel.data.controls[t];r.controlType==="activityFlowButton"&&(u.controlType=r.controlType)},addStatement:function(n){var t=this,i=t.data,f=n=="then"?i.commands:i.elseCommands,r=Math.guid(),u={xpath:null,command:null,argument:null,argumentType:"const",guid:r};f.push(u);t.statements[r]=u},removeStatement:function(n,t){var i=this,u=i.data,f=t=="then"?u.commands:u.elseCommands,e=i.statementhasDependencies(i.statements[n]),r;delete i.statements[n];r=i.findCommandPosition(n,t);r>=0&&f.splice(r,1);e&&i.removeSubmitDataStatement(f,t)},statementhasDependencies:function(n){return n.command=="execute-rule"||n.command=="refresh"||n.command=="execute-interface"||n.command=="execute-connector"},removeSubmitDataStatement:function(n,t){var u=this,f=$.grep(n,function(n){return n.command=="execute-rule"||n.command=="refresh"||n.command=="execute-interface"||n.command=="execute-connector"}),r=-1,i;if(f.length===0){for(i=0;i<n.length;i++)if(n[i].command=="submit-data"){r=i;break}r>=0&&u.removeStatement(n[r].guid,t)}},removeAttributesStatement:function(n,t,i){t=="command"&&(delete n.argument,delete n.xpath,delete n.xpathContainer);i&&delete n.xpath;(t=="command"||t=="xpath"||i)&&n.propertyToUpdate&&(delete n[n.propertyToUpdate],delete n.propertyToUpdate)},updateElseAction:function(n){var t=this,i=t.data,r=t.getElseAction();r!=n&&(i.elseAction=n,i.elseCommands=n=="automatic"?undefined:[])},isGridContext:function(){return typeof this.context=="string"&&this.context!="Form"},areThereGridAttributes:function(){var n=this,u=!1,i,t,f,r;if(bizagi.editor.utilities.isObject(n.data.conditions)&&$.isArray(n.data.conditions.expressions))for(i=n.data.conditions.expressions,t=0,f=i.length;t<f;t++)if(r=n.findGridContainer(i[t]),typeof r=="string"){n.gridContainer=r;u=!0;break}return u},findGridContainer:function(n){var r=this,t=null,i;if(n.simple)t=n.simple.xpathContainer;else if(n.complex&&n.complex.conditions.expressions.length>0)for(i=0;i<n.complex.conditions.expressions.length;i++)if(t=r.findGridContainer(n.complex.conditions.expressions[i]),typeof t=="string")break;return t},getGridContainer:function(){return this.gridContainer||null},validate:function(){var i=this,t=i.data,n=i._super(i.Class.action),r,u;if(!n.isValid)return n;for(t.commands.length==0&&(n.isValid=!1),r=0;r<t.commands.length;r++)if(n=i.validateCommand(t.commands[r]),!n.isValid)return n;if(t.elseCommands)for(u=0;u<t.elseCommands.length;u++)if(n=i.validateCommand(t.elseCommands[u]),!n.isValid)return n;return n},updateContext:function(n){var t=this;t.context!=n&&(t.context=n,t.cleanModel())},cleanModel:function(){var n=this;n.data.commands=[];n.data.elseCommands=[];n.data.conditions.expressions=[];n.data.conditions.operator="and";n.statements={}},validateCommand:function(n){var t=this,i=t.getStatementProperty(n.guid);return t.fullModel.isOnlyCommand(n)?{isValid:!0}:!t.fullModel.isOnlyArgument(n)&&(n[i]==null||n[i].length==0)?{isValid:!1}:!t.fullModel.isUnaryCommand(n)&&(n.argument==null||n.argument.length==0)?{isValid:!1}:{isValid:!0}},findDependencies:function(n,t){var u=this,i,r;if(n.simple)n.simple.xpath&&t.push(n.simple.xpath),n.simple.propertyToUpdate&&t.push(n.simple[n.simple.propertyToUpdate]),n.simple.argument&&n.simple.argumentType=="xpath"&&(i=u.getControl(n.simple.argument),i&&i.baxpath&&t.push(i.baxpath));else if(n.complex.conditions.expressions.length>0)for(r=0;r<n.complex.conditions.expressions.length;r++)u.findDependencies(n.complex.conditions.expressions[r],t)},findCommandPosition:function(n,t){for(var e=this,r=e.data,u=t=="then"?r.commands:r.elseCommands,f=-1,i=0,o=u.length;i<o;i++)if(u[i].guid==n){f=i;break}return f},sortCommands:function(n){var t=this,r=t.data,i=n.section=="then"?r.commands:r.elseCommands;i.move(n.initialPosition,n.finalPosition);t.statementhasDependencies(i[n.finalPosition])&&t.moveSubmitDataStatement(i,n.finalPosition)},moveSubmitDataStatement:function(n,t){for(var r=-1,i=0,u=n.length;i<u;i++)if(n[i].command=="submit-data"){r=i;break}r>t&&n.move(r,t)}});
bizagi.editor.component.actioneditor.model.extend("bizagi.editor.component.actioneditor.offline.model",{},{init:function(n,t){this._super(n,t);this.actionCommands=bizagi.editor.component.commandseditor.offline.model.actionCommands}});
bizagi.editor.observableClass.extend("bizagi.editor.component.commandseditor.actioncommands.base",{},{init:function(n){n=n||{};this._super();this.args=n;this.model=n.model;this.data=this.model.data;this.controller=n.controller},execute:function(){}});
bizagi.editor.component.commandseditor.actioncommands.base.extend("bizagi.editor.component.commandseditor.actioncommands.executerule",{},{execute:function(){var n=this;return n.existSubmitDataCommand()?!0:(n.addSubmitDataCommand(),n.controller.refresh(),!0)},addSubmitDataCommand:function(){var n=this,i=n.args.section=="then"?n.data.commands:n.data.elseCommands,t;n.model.addStatement(n.args.section);t=i.pop();t.command="submit-data";i.splice(n.getPositionStatement(),0,t)},getPositionStatement:function(){for(var n=this,i=0,r=n.args.section=="then"?n.data.commands:n.data.elseCommands,t=0,u=r.length;t<u;t++)if(r[t].guid===n.args.guid){i=t;break}return i},existSubmitDataCommand:function(){var t=this,n=t.args.section=="then"?t.data.commands:t.data.elseCommands;return n=n.slice(0,t.getPositionStatement()),n=$.grep(n,function(n){return n.command==="submit-data"}),n.length>0}});
bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.executeinterface",{},{execute:function(){var n=this;return n._super()}});bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.executesap",{},{execute:function(){var n=this;return n._super()}});bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.executeconnector",{},{execute:function(){var n=this;return n._super()}});
bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.refresh",{},{execute:function(){var n=this;return n._super()}});
bizagi.editor=bizagi.editor||{};bizagi.editor.component=bizagi.editor.component||{};bizagi.editor.component.commandseditor=bizagi.editor.component.commandseditor||{};bizagi.editor.component.commandseditor.actioncommands=bizagi.editor.component.commandseditor.actioncommands||{};bizagi.editor.component.commandseditor.actioncommands.factory=function(){return{createCommand:function(n){if(n.command!==undefined)try{n.command=n.command.replace("-","");var t=eval("var bafn = function(args) {  return new bizagi.editor.component.commandseditor.actioncommands."+n.command+"(args);};bafn");return t(n)}catch(r){return null}return null}}}();
bizagi.editor.component.baseeditor("bizagi.editor.component.validationeditor",{init:function(n,t,i){this._super(n,t,i)},".bz-fm-commandseditor-message-argument click":function(n){var t=this;t.displayMessageControl(n)},displayMessageControl:function(n){var t=this,r=t.model.getMessage(),i=new bizagi.editor.component.constantargument.textarea({templates:t.tmpl,element:n,value:r,mainEditor:this});i.render();i.subscribe("valuechanged",function(n,r){var u=r.value;t.model.updateMessage(u);i.close();t.refresh()});i.subscribe("launchLocalizableEditor",function(n,r){var u=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"multilanguage",i18n:t.model.getMessage()});$.when(u.processRequest()).done(function(n){n.i18n["default"]=r.value;t.model.updateMessage(n);i.close();t.refresh()})})},loadTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.loadTemplate("container",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-validation")),n.loadTemplate("list",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-list")),n.loadTemplate("controlslist",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-controls-list")),n.loadTemplate("argument",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument")),n.loadTemplate("boolean",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-boolean")),n.loadTemplate("string",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-string")),n.loadTemplate("textarea",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-textarea")),n.loadTemplate("date",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-date")),n.loadTemplate("number",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-number")),n.loadTemplate("color",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-color"))).done(function(){t.resolve()}),t.promise()}});
bizagi.editor.component.baseeditor.model.extend("bizagi.editor.component.validationeditor.model",{action:"validation"},{init:function(n,t){this._super(n,t);this.operators=bizagi.editor.component.commandseditor.model.operators.validation},getViewModel:function(){var n=this,t=n.data;return $.extend(n._super(),{message:bizagi.editor.utilities.resolveComplexLocalizable(t.validationCommand.message)})},getMessage:function(){var n=this,t=n.data;return t.validationCommand.message},updateMessage:function(n){var i=this,t=i.data;typeof n=="object"&&n.i18n?t.validationCommand.message=n:t.validationCommand.message.i18n["default"]=n},getOperatorName:function(n){return this.fullModel.getOperatorName(n,"validation")},isUnaryOperator:function(n){return this.fullModel.isUnaryOperator(n,"validation")},validate:function(){var t=this,r=t.data,n=t._super(t.Class.action),i;return n.isValid?(i=bizagi.editor.utilities.resolveComplexLocalizable(r.validationCommand.message),(i==null||i.length==0)&&(n.isValid=!1),n):n}});
bizagi.editor.observableClass.extend("bizagi.editor.component.commandseditor.model",{operators:{action:{equals:{label:"formmodeler-component-commandseditor-operators-action-changes-to",appliesTo:["string","date","number","boolean","entity"]},"not-equals":{label:"formmodeler-component-commandseditor-operators-action-different-to",appliesTo:["string","date","number","boolean","entity"]},"less-than":{label:"formmodeler-component-commandseditor-operators-action-less-than",appliesTo:["date","number"]},"less-equals-than":{label:"formmodeler-component-commandseditor-operators-action-less-or-equal-than",appliesTo:["date","number"]},"greater-than":{label:"formmodeler-component-commandseditor-operators-action-greater-than",appliesTo:["date","number"]},"greater-equals-than":{label:"formmodeler-component-commandseditor-operators-action-greater-or-equal-than",appliesTo:["date","number"]},like:{label:"formmodeler-component-commandseditor-operators-action-like",appliesTo:["string"]},"is-empty":{label:"formmodeler-component-commandseditor-operators-action-is-empty",appliesTo:["string","date","number","boolean","entity"],isUnary:!0},"is-not-empty":{label:"formmodeler-component-commandseditor-operators-action-is-not-empty",appliesTo:["string","date","number","boolean","entity"],isUnary:!0},"is-true":{label:"formmodeler-component-commandseditor-operators-action-is-true",appliesTo:["boolean"],isUnary:!0},"is-false":{label:"formmodeler-component-commandseditor-operators-action-is-false",appliesTo:["boolean"],isUnary:!0},"does-not-contain":{label:"formmodeler-component-commandseditor-operators-action-does-not-contain",appliesTo:["string"]},contains:{label:"formmodeler-component-commandseditor-operators-action-contain",appliesTo:["string"]},"begins-with":{label:"formmodeler-component-commandseditor-operators-action-begins-with",appliesTo:["string"]},"does-not-begins-with":{label:"formmodeler-component-commandseditor-operators-action-does-not-begin-with",appliesTo:["string"]},"file-uploaded":{label:"formmodeler-component-commandseditor-operators-action-has-a-file-uploaded",appliesTo:["upload"],isUnary:!0},"file-not-uploaded":{label:"formmodeler-component-commandseditor-operators-action-has-no-file-uploaded",appliesTo:["upload"],isUnary:!0},"is-invalid-email":{label:"formmodeler-component-commandseditor-operators-action-is-an-invalid-email",appliesTo:["string"],isUnary:!0},"letter-edited":{label:"formmodeler-component-commandseditor-operators-action-has-been-edited",appliesTo:["letter"],isUnary:!0},"letter-not-edited":{label:"formmodeler-component-commandseditor-operators-action-has-not-been-edited",appliesTo:["letter"],isUnary:!0},changes:{label:"formmodeler-component-commandseditor-operators-action-has-changed",appliesTo:["string","date","number","boolean","entity","letter","upload"],isUnary:!0},"on-press":{label:"formmodeler-component-commandseditor-operators-action-on-click",appliesTo:["button"],isUnary:!0},"on-deleted-row":{label:"formmodeler-component-commandseditor-operators-action-on-deleted-row",appliesTo:["collection"],isUnary:!0}},validation:{equals:{label:"formmodeler-component-commandseditor-operators-validation-is-equal-to",appliesTo:["string","date","number","boolean","entity"]},"not-equals":{label:"formmodeler-component-commandseditor-operators-validation-is-not-equal-to",appliesTo:["string","date","number","boolean","entity"]},"less-than":{label:"formmodeler-component-commandseditor-operators-validation-less-than",appliesTo:["date","number"]},"less-equals-than":{label:"formmodeler-component-commandseditor-operators-validation-less-or-equal-than",appliesTo:["date","number"]},"greater-than":{label:"formmodeler-component-commandseditor-operators-validation-greater-than",appliesTo:["date","number"]},"greater-equals-than":{label:"formmodeler-component-commandseditor-operators-validation-greater-or-equal-than",appliesTo:["date","number"]},like:{label:"formmodeler-component-commandseditor-operators-validation-like",appliesTo:["string"]},"is-empty":{label:"formmodeler-component-commandseditor-operators-validation-is-empty",appliesTo:["string","date","number","boolean","entity"],isUnary:!0},"is-not-empty":{label:"formmodeler-component-commandseditor-operators-validation-is-not-empty",appliesTo:["string","date","number","boolean","entity"],isUnary:!0},"is-true":{label:"formmodeler-component-commandseditor-operators-validation-is-true",appliesTo:["boolean"],isUnary:!0},"is-false":{label:"formmodeler-component-commandseditor-operators-validation-is-false",appliesTo:["boolean"],isUnary:!0},"begins-with":{label:"formmodeler-component-commandseditor-operators-validation-begins-with",appliesTo:["string"]},"does-not-contain":{label:"formmodeler-component-commandseditor-operators-validation-does-not-contain",appliesTo:["string"]},contains:{label:"formmodeler-component-commandseditor-operators-validation-contain",appliesTo:["string"]},"does-not-begins-with":{label:"formmodeler-component-commandseditor-operators-validation-does-not-begins-with",appliesTo:["string"]},"file-uploaded":{label:"formmodeler-component-commandseditor-operators-validation-has-a-file-uploaded",appliesTo:["upload"],isUnary:!0},"file-not-uploaded":{label:"formmodeler-component-commandseditor-operators-validation-has-no-files-uploaded",appliesTo:["upload"],isUnary:!0},"is-invalid-email":{label:"formmodeler-component-commandseditor-operators-validation-invalid-email",appliesTo:["string"],isUnary:!0},"letter-edited":{label:"formmodeler-component-commandseditor-operators-validation-has-been-edited",appliesTo:["letter"],isUnary:!0},"letter-not-edited":{label:"formmodeler-component-commandseditor-operators-validation-has-not-been-edited",appliesTo:["letter"],isUnary:!0},changes:{label:"formmodeler-component-commandseditor-operators-action-has-changed",appliesTo:["string","date","number","boolean","entity","letter","upload"],isUnary:!0},"on-press":{label:"formmodeler-component-commandseditor-operators-action-on-click",appliesTo:["button"],isUnary:!0},"on-deleted-row":{label:"formmodeler-component-commandseditor-operators-action-on-deleted-row",appliesTo:["collection"],isUnary:!0}}},logicOperators:{and:"formmodeler-component-commandseditor-logicoperators-and",or:"formmodeler-component-commandseditor-logicoperators-or"},actionCommands:{"background-color":{label:"formmodeler-component-commandseditor-actioncommands-set-background-color",appliesTo:["render","container"],exclude:["nestedform"],type:"color",hasReverse:!0},forecolor:{label:"formmodeler-component-commandseditor-actioncommands-set-forecolor-color",appliesTo:["render"],exclude:["collection"],type:"color",hasReverse:!0},visible:{label:"formmodeler-component-commandseditor-actioncommands-changes-visibility-for",appliesTo:["render","container"],type:"boolean",hasReverse:!0},readonly:{label:"formmodeler-component-commandseditor-actioncommands-changes-editability-for",appliesTo:["render","container"],exclude:["undefined","button"],type:"boolean",hasReverse:!0},required:{label:"formmodeler-component-commandseditor-actioncommands-set-required-for",appliesTo:["render"],exclude:["collection","undefined","button","activityFlowButton"],type:"boolean",hasReverse:!0},"set-value":{label:"formmodeler-component-commandseditor-actioncommands-set-value-for",appliesTo:["render"],exclude:["collection","undefined","button","activityFlowButton"],type:"argument",hasReverse:!1},"set-min":{label:"formmodeler-component-commandseditor-actioncommands-set-minimum-value-for",appliesTo:["render"],filterBy:["number","date"],type:"argument",hasReverse:!1},"set-max":{label:"formmodeler-component-commandseditor-actioncommands-set-maximum-value-for",appliesTo:["render"],filterBy:["number","date"],type:"argument",hasReverse:!1},collapse:{label:"formmodeler-component-commandseditor-actioncommands-collapse",appliesTo:["container"],filterBy:["group"],type:"boolean",hasReverse:!0},"set-active":{label:"formmodeler-component-commandseditor-actioncommands-set-as-active",appliesTo:["container"],filterBy:["tabItem"],type:"boolean",hasReverse:!1},refresh:{label:"formmodeler-component-commandseditor-actioncommands-refresh",appliesTo:["render","container"],exclude:["activityFlowButton"],isUnary:!0,hasReverse:!1},"execute-rule":{label:"formmodeler-component-commandseditor-actioncommands-execute-rule",appliesTo:["render","container"],isOnlyArgument:!0,type:"rule",hasReverse:!1},"execute-interface":{label:"formmodeler-component-commandseditor-actioncommands-execute-interface",appliesTo:["render","container"],isOnlyArgument:!0,type:"interface",hasReverse:!1},"execute-sap":{label:"formmodeler-component-commandseditor-actioncommands-execute-sap",appliesTo:["render","container"],isOnlyArgument:!0,type:"sap",hasReverse:!1},"execute-connector":{label:"formmodeler-component-commandseditor-actioncommands-execute-connector",appliesTo:["render","container"],isOnlyArgument:!0,type:"connector",hasReverse:!1},"submit-data":{label:"formmodeler-component-commandseditor-actioncommands-submit-data",appliesTo:["render","container"],isOnlyCommand:!0,hasReverse:!1,hidden:!0},"clean-data":{label:"formmodeler-component-commandseditor-actioncommands-clean-data",appliesTo:["render"],exclude:["collection","undefined","button","activityFlowButton"],isUnary:!0,hasReverse:!1},"trigger-click":{label:"formmodeler-component-commandseditor-actioncommands-trigger-click",appliesTo:["render"],filterBy:["activityFlowButton"],isUnary:!0,hasReverse:!0}},elseActions:{actions:"formmodeler-component-commandseditor-elseactions-actions",none:"formmodeler-component-commandseditor-elseactions-none",automatic:"formmodeler-component-commandseditor-elseactions-automatic"}},{init:function(n){this._super();this.actions={};this.validations={};this.data=n;this.processData(n);this.operators=this.Class.operators;this.logicOperators=this.Class.logicOperators;this.actionCommands=this.Class.actionCommands;this.isReadOnly=n.isReadOnly!="undefined"?bizagi.util.parseBoolean(n.isReadOnly):!1},processData:function(n){for(var i,u,r,e=this,t,f=0;f<n.actions.length;f++)i=n.actions[f],i.guid?t=i.guid:i.guid=t=Math.guid(),e.actions[t]=i;for(u=0;u<n.validations.length;u++)r=n.validations[u],r.guid?t=r.guid:r.guid=t=Math.guid(),e.validations[t]=r},getDataModel:function(){var n=this;return n.data},getAction:function(n){var t=this;return t.actions[n]},getElseActionType:function(n){return n.elseAction?n.elseAction:n.elseCommands?n.elseCommands.length>0?"actions":"none":"automatic"},getValidation:function(n){var t=this;return t.validations[n]},getControls:function(){var n=this;return n.data.controls},getReadOnlyModel:function(){for(var n,i=this,t=this.data,r={actions:[],validations:[],isReadOnly:i.isReadOnly},u=0;u<t.actions.length;u++)r.actions.push(i.getReadOnlyAction(t.actions[u]));for(n=0;n<t.validations.length;n++)t.validations[n].inherent||r.validations.push(i.getReadOnlyValidation(t.validations[n]));for(n=0;n<t.validations.length;n++)t.validations[n].inherent&&r.validations.push(i.getReadOnlyValidation(t.validations[n]));return r},getReadOnlyAction:function(n){var t=this,s=t.getElseActionType(n),r,u,h,o,f,i,e;for(n.isValid=!0,r={guid:n.guid,conditions:{expressions:[]},commands:[],elseAction:{label:bizagi.localization.getResource(t.Class.elseActions[s]),value:s},elseCommands:n.elseCommands?[]:undefined,isReadOnly:t.isReadOnly},u=0;u<n.conditions.expressions.length;u++)h=u>0?t.getLogicOperatorName(n.conditions.operator):null,o=t.getReadOnlyExpression(n.conditions.expressions[u],h,"action"),n.isValid=n.isValid&&o.isValid,r.conditions.expressions.push(o);for(f=0;f<n.commands.length;f++)i=t.getReadOnlyCommand(n.commands[f]),n.isValid=n.isValid&&i.isValid,r.commands.push(i);if(n.elseCommands)for(e=0;e<n.elseCommands.length;e++)i=t.getReadOnlyCommand(n.elseCommands[e]),n.isValid=n.isValid&&i.isValid,r.elseCommands.push(i);return r},getReadOnlyValidation:function(n){var i=this,r,t,f,u;for(n.isValid=!0,r={guid:n.guid,conditions:{expressions:[]},validationCommand:{message:bizagi.editor.utilities.resolveComplexLocalizable(n.validationCommand.message)},inherent:n.inherent||!1,isReadOnly:i.isReadOnly},t=0;t<n.conditions.expressions.length;t++)f=t>0?i.getLogicOperatorName(n.conditions.operator):null,u=i.getReadOnlyExpression(n.conditions.expressions[t],f,"validation"),n.isValid=n.isValid&&u.isValid,r.conditions.expressions.push(u);return r},getReadOnlyExpression:function(n,t,i){var r=this,u={simple:n.simple?{xpath:r.getXpathName(r.resolveXpath(r.getXpathExpression(n.simple))),operator:r.getOperatorName(n.simple.operator,i),argument:r.getArgumentName(n.simple.argument,n.simple.argumentType)}:null,complex:n.complex?{conditions:{expressions:[]}}:null,logicOperator:t,isValid:!0},f,o,e;if(n.simple&&(u.isValid=typeof r.getControls()[r.resolveXpath(n.simple.xpath)]=="object"),n.complex)for(f=0;f<n.complex.conditions.expressions.length;f++)o=f>0?r.getLogicOperatorName(n.complex.conditions.operator):null,e=r.getReadOnlyExpression(n.complex.conditions.expressions[f],o,i),u.complex.conditions.expressions.push(e),u.isValid=u.isValid&&e.isValid;return u},getReadOnlyCommand:function(n){var t=this;return{xpath:t.getXpathName(t.resolveCommand(n)),command:t.getCommandName(n.command),argument:t.getArgumentName(n.argument,n.argumentType),isValid:typeof t.getControls()[t.resolveXpath(n.xpath)]=="object",isUnary:t.isUnaryCommand(n.command),isOnlyArgument:t.isOnlyArgument(n.command),isOnlyCommand:t.isOnlyCommand(n.command),hidden:t.isHiddenCommand(n.command)}},getLogicOperatorName:function(n){return bizagi.util.isEmpty(n)?"":bizagi.localization.getResource(this.logicOperators[n])},getOperatorName:function(n,t){return typeof n=="undefined"||bizagi.util.isEmpty(n)||!this.operators[t][n]?"":bizagi.localization.getResource(this.operators[t][n].label)},isUnaryOperator:function(n,t){return bizagi.util.isEmpty(n)?!1:this.operators[t][n]&&(this.operators[t][n].isUnary||!1)},isUnaryCommand:function(n){return n==null?!1:typeof n=="string"&&n?this.actionCommands[n].isUnary||!1:typeof n=="object"&&n.command?this.actionCommands[n.command].isUnary||!1:!1},isOnlyCommand:function(n){return n==null?!1:typeof n=="string"&&n?this.actionCommands[n].isOnlyCommand||!1:typeof n=="object"&&n.command?this.actionCommands[n.command].isOnlyCommand||!1:!1},isOnlyArgument:function(n){return n==null?!1:typeof n=="string"&&n?this.actionCommands[n].isOnlyArgument||!1:typeof n=="object"&&n.command?this.actionCommands[n.command].isOnlyArgument||!1:!1},isHiddenCommand:function(n){return n==null?!1:typeof n=="string"&&n?this.actionCommands[n].hidden||!1:typeof n=="object"&&n.command?this.actionCommands[n.command].hidden||!1:!1},resolveXpath:function(n){return n?bizagi.editor.utilities.resolveComplexXpath(n):null},resolveCommand:function(n){var t=this;return n.xpath?t.resolveXpath(n.xpath):n.propertyToUpdate?n[n.propertyToUpdate]:void 0},getXpathName:function(n){return bizagi.util.isEmpty(n)?"":this.data.controls[n]?this.data.controls[n].label:""},getXpathExpression:function(n){return n.propertyToUpdate?n[n.propertyToUpdate]:n.xpath},getXpath:function(n){return bizagi.util.isEmpty(n)?"":this.data.controls[n]},getArgumentName:function(n,t){return n===undefined||n==null?null:(t=="const"||t=="entity")&&n!==undefined?n.label?n.label:n:this.getXpathName(this.resolveXpath(n))},getCommandName:function(n){return bizagi.util.isEmpty(n)||!this.actionCommands[n]?"":bizagi.localization.getResource(this.actionCommands[n].label)},createEmptyAction:function(){return{guid:Math.guid(),conditions:{operator:"and",expressions:[]},commands:[],elseCommands:[]}},addAction:function(n,t){var i=this,r=i.data;r.actions.push(t);i.actions[n]=t},updateAction:function(n,t){for(var u=this,r=u.data,i=0;i<r.actions.length;i++)r.actions[i].guid==n&&(r.actions[i]=t);u.actions[n]=t},createEmptyValidation:function(){var n=Math.guid();return{guid:n,conditions:{operator:"and",expressions:[]},validationCommand:{message:bizagi.editor.utilities.buildComplexLocalizable("",n,"message")}}},changeActionStateEnabled:function(n,t){for(var f=this,r=f.data,u=-1,i=0;i<r.actions.length;i++)if(r.actions[i].guid==n){u=i;break}u>=0&&(r.actions[u].enabled=t)},changeAllActionStateEnabled:function(n){for(var r=this,i=r.data,t=0;t<i.actions.length;t++)i.actions[t].enabled=n},changeValidationStateEnabled:function(n,t){var f=this,u=f.data,r,i;for(delete f.validations[n],r=-1,i=0;i<u.validations.length;i++)if(u.validations[i].guid==n){r=i;break}r>=0&&(u.validations[r].enabled=t)},changeAllValidationStateEnabled:function(n){for(var r=this,i=r.data,t=0;t<i.validations.length;t++)i.validations[t].enabled=n},addValidation:function(n,t){var i=this,r=i.data;r.validations.push(t);i.validations[n]=t},updateValidation:function(n,t){for(var u=this,r=u.data,i=0;i<r.validations.length;i++)r.validations[i].guid==n&&(r.validations[i]=t);u.validations[n]=t},deleteAction:function(n){var u=this,r=u.data,i,t;for(delete u.actions[n],i=-1,t=0;t<r.actions.length;t++)if(r.actions[t].guid==n){i=t;break}i>=0&&r.actions.splice(i,1)},deleteValidation:function(n){var u=this,r=u.data,i,t;for(delete u.validations[n],i=-1,t=0;t<r.validations.length;t++)if(r.validations[t].guid==n){i=t;break}i>=0&&r.validations.splice(i,1)},getInvalidElements:function(){var n=this;return n.getReadOnlyModel(),{actions:$.grep(n.data.actions,function(n){return!n.isValid}),validations:$.grep(n.data.validations,function(n){return!n.isValid})}},moveActionUp:function(n){for(var u,f=this,t=f.data,i=-1,r=0;r<t.actions.length;r++)if(t.actions[r].guid==n){i=r;break}i>=0&&(u=t.actions[i],t.actions.splice(i,1),t.actions.splice(i-1,0,u))},moveActionDown:function(n){for(var u,f=this,t=f.data,i=-1,r=0;r<t.actions.length;r++)if(t.actions[r].guid==n){i=r;break}i>=0&&(u=t.actions[i],t.actions.splice(i,1),t.actions.splice(i+1,0,u))},moveValidationUp:function(n){for(var u,f=this,t=f.data,i=-1,r=0;r<t.validations.length;r++)if(t.validations[r].guid==n){i=r;break}i>=0&&(u=t.validations[i],t.validations.splice(i,1),t.validations.splice(i-1,0,u))},moveValidationDown:function(n){for(var u,f=this,t=f.data,i=-1,r=0;r<t.validations.length;r++)if(t.validations[r].guid==n){i=r;break}i>=0&&(u=t.validations[i],t.validations.splice(i,1),t.validations.splice(i+1,0,u))}});
bizagi.editor.component.commandseditor.model.extend("bizagi.editor.component.commandseditor.offline.model",{actionCommands:{"background-color":{label:"formmodeler-component-commandseditor-actioncommands-set-background-color",appliesTo:["render","container"],exclude:["nestedform"],type:"color",hasReverse:!0},forecolor:{label:"formmodeler-component-commandseditor-actioncommands-set-forecolor-color",appliesTo:["render"],exclude:["collection"],type:"color",hasReverse:!0},visible:{label:"formmodeler-component-commandseditor-actioncommands-changes-visibility-for",appliesTo:["render","container"],type:"boolean",hasReverse:!0},readonly:{label:"formmodeler-component-commandseditor-actioncommands-changes-editability-for",appliesTo:["render","container"],exclude:["undefined"],type:"boolean",hasReverse:!0},required:{label:"formmodeler-component-commandseditor-actioncommands-set-required-for",appliesTo:["render"],exclude:["collection","undefined","button"],type:"boolean",hasReverse:!0},"set-value":{label:"formmodeler-component-commandseditor-actioncommands-set-value-for",appliesTo:["render"],exclude:["collection","undefined","button"],type:"argument",hasReverse:!1},"set-min":{label:"formmodeler-component-commandseditor-actioncommands-set-minimum-value-for",appliesTo:["render"],filterBy:["number","date"],type:"argument",hasReverse:!1},"set-max":{label:"formmodeler-component-commandseditor-actioncommands-set-maximum-value-for",appliesTo:["render"],filterBy:["number","date"],type:"argument",hasReverse:!1},collapse:{label:"formmodeler-component-commandseditor-actioncommands-collapse",appliesTo:["container"],filterBy:["group"],type:"boolean",hasReverse:!0},"set-active":{label:"formmodeler-component-commandseditor-actioncommands-set-as-active",appliesTo:["container"],filterBy:["tabItem"],type:"boolean",hasReverse:!1},"clean-data":{label:"formmodeler-component-commandseditor-actioncommands-clean-data",appliesTo:["render"],filterBy:["entity"],isUnary:!0,hasReverse:!1}}},{init:function(n){this._super(n);this.actionCommands=this.Class.actionCommands}});
bizagi.editor.observableClass.extend("bizagi.editor.component.commandseditor.presenter",{},{init:function(){this._super()},show:function(n){var t=this,i=new $.Deferred,r=t.createModelFactory(n),u=t.popup=bizagi.createPopup({name:"bz-fm-commandseditor",container:"form-modeler",title:bizagi.localization.getResource("formmodeler-component-commandseditor-displayname"),center:!0,onClose:function(){i.resolve(r.getDataModel())}});return t.configureDraggablePlugin(u.fullPopup),t.commandsEditor=new bizagi.editor.component.commandseditor(u.content,r,t),t.commandsEditor.render(),i.promise()},createModelFactory:function(n){var i=this,t=i.publish("getContext");return t==="form"?new bizagi.editor.component.commandseditor.model(n):t==="offlineform"||t==="queryform"?new bizagi.editor.component.commandseditor.offline.model(n):t=="startform"?new bizagi.editor.component.commandseditor.model(n):void 0},createAction:function(n){var t=this,u,i;t.hidePopup();u=bizagi.localization.getResource("formmodeler-component-commandseditor-action-editor-title");i=bizagi.createPopup({name:"bz-fm-actionvalidationeditor",container:"form-modeler",title:u,center:!0,onClose:function(){t.showPopup()}});t.configureDraggablePlugin(i.fullPopup);var f=n.createEmptyAction(),e=t.createActionModelFactory(f,n),r=new bizagi.editor.component.actioneditor(i.content,e,t);r.render();r.subscribe("cancel",function(){t.showPopup();i.close()});r.subscribe("save",function(r,u){n.addAction(u.model.guid,u.model);t.showPopup();i.close();t.commandsEditor.refresh()})},editAction:function(n,t){var i=this,r;i.hidePopup();r=bizagi.createPopup({name:"bz-fm-actionvalidationeditor",container:"form-modeler",title:"Edit action",center:!0,onClose:function(){i.showPopup()}});i.configureDraggablePlugin(r.fullPopup);var f=bizagi.clone(n.getAction(t)),e=i.createActionModelFactory(f,n),u=new bizagi.editor.component.actioneditor(r.content,e,i);u.render();u.subscribe("cancel",function(){i.showPopup();r.close()});u.subscribe("save",function(u,f){n.updateAction(t,f.model);i.showPopup();r.close();i.commandsEditor.refresh()})},createActionModelFactory:function(n,t){var r=this,i=r.publish("getContext");return i=="form"?new bizagi.editor.component.actioneditor.model(n,t):i=="offlineform"||i=="queryform"?new bizagi.editor.component.actioneditor.offline.model(n,t):i=="startform"?new bizagi.editor.component.actioneditor.model(n,t):void 0},createValidation:function(n){var t=this,u,i;t.hidePopup();u=bizagi.localization.getResource("formmodeler-component-commandseditor-validation-editor-title");i=bizagi.createPopup({name:"bz-fm-actionvalidationeditor",container:"form-modeler",title:u,center:!0,onClose:function(){t.showPopup()}});t.configureDraggablePlugin(i.fullPopup);var f=n.createEmptyValidation(),e=new bizagi.editor.component.validationeditor.model(f,n),r=new bizagi.editor.component.validationeditor(i.content,e,t);r.render();r.subscribe("cancel",function(){t.showPopup();i.close()});r.subscribe("save",function(r,u){n.addValidation(u.model.guid,u.model);t.showPopup();i.close();t.commandsEditor.refresh();$("#bz-fm-commandseditor-tabs",t.commandsEditor.element).tabs("option","active",1)})},editValidation:function(n,t){var i=this,r;i.hidePopup();r=bizagi.createPopup({name:"bz-fm-actionvalidationeditor",container:"form-modeler",title:"Edit validation",center:!0,onClose:function(){i.showPopup()}});i.configureDraggablePlugin(r.fullPopup);var f=bizagi.clone(n.getValidation(t)),e=new bizagi.editor.component.validationeditor.model(f,n),u=new bizagi.editor.component.validationeditor(r.content,e,i);u.render();u.subscribe("cancel",function(){i.showPopup();r.close()});u.subscribe("save",function(u,f){n.updateValidation(t,f.model);i.showPopup();r.close();i.commandsEditor.refresh();$("#bz-fm-commandseditor-tabs",i.commandsEditor.element).tabs("option","active",1)})},hidePopup:function(){this.popup.fullPopup.hide()},showPopup:function(){this.popup.fullPopup.show()},configureDraggablePlugin:function(n){n.draggable({containment:"#container-layout",delay:100,distance:5,handle:".ui-popup-header"})}});
bizagi.editor.observableClass.extend("bizagi.editor.component.properties.model",{rulePropertiesHash:["defaultvalue.rule","defaultvalue.rule90","daterange.maxrule","daterange.maxrule90","daterange.minrule","daterange.minrule90","buttonrule","buttonrule.rule","buttonrule.rule90","data.filter.rule","editable.rule","editable.rule90","visible.rule","visible.rule90","required.rule","required.rule90"]},{init:function(n){var t=this;this._super();n&&(t.disableProperties=n.disableProperties,this.initModel(n));t.communicationProtocol=bizagi.editor.communicationprotocol.factory},initModel:function(n){var t=this,u=t.model={idRender:"",elements:[]},i,r;t.externalProperties=t.populateExternalProperties(n);t.indexedProperties={};t.designProperties=n.design.properties;i=n.design.visual["property-box"];i.tabs?(r=[],$.each(i.tabs,function(n,i){var u={id:i.id,caption:bizagi.editor.utilities.resolveInternalResource(i.caption)};u.elements=t.initElements({elements:i.elements});r.push(u)}),u.elements.push({tabs:r})):u.elements=t.initElements({elements:i.elements})},initElements:function(n){var t=this,r=n.elements||[],u=n.prefix,i=n.applyIndexing||!0,f=[];return i=i!==undefined?i:!0,$.each(r,function(n,e){var l=e.type||r[n].type,s=null,o,h,c;if(l=="property"){if(t.propertyIsEnabled(e.value)){if(o=t.getDesignProperty(e.value),$.isEmptyObject(o))throw"The visual property ("+e.value+") doesn't exist. External properties: "+JSON.stringify(t.externalProperties);h=e.value||e.name;s={"bas-type":o["bas-type"]||e["bas-type"],name:u?u+"."+h:h,required:o.required||{},caption:bizagi.editor.utilities.resolveInternalResource(o.caption)||e.caption,"user-editable":o["user-editable"]||e["user-editable"],value:e.dataValue||null,"editor-parameters":o["editor-parameters"]?t.processEditorParameters(o):e["editor-parameters"]||{},"default":o["default"],deprecated:o.deprecated||!1};i&&(t.indexedProperties[s.name]=s);o.subproperties&&t.processSubproperties(s.name,o,s)}}else s={id:e.id,caption:bizagi.editor.utilities.resolveInternalResource(e.caption)},e.exclusive!==undefined&&$.extend(s,{exclusive:!0}),e.visibility!==undefined&&$.extend(s,{visibility:e.visibility});s&&(e.elements&&(s.elements=t.initElements({elements:e.elements})),c={},c[l]=s,f.push(c))}),f},getDesignProperty:function(n){var i=this,t,r;return n.indexOf(".")===-1?i.designProperties[n]||{}:(t=n.split("."),t.length>1?(r=i.designProperties[t[0]],r.subproperties[t[1]]):{})},processEditorParameters:function(n){var h=this,t,e=!1,r,o,i,u,s,f;for(t in n["editor-parameters"])if(o=n["editor-parameters"][t],o.rule){e=!0;break}if(e){r={};for(t in n["editor-parameters"])n["editor-parameters"][t].rule?(i=n["editor-parameters"][t].rule,i.search(/^<.*>$/)!=-1&&(i=i.substring(1,i.length-1),u=i.split(":"),u.length>1&&u[0]=="design"&&(s=u[1],u[2]===undefined&&(f=h.designProperties[s],r[t]={value:f.value!==undefined|f.value!=null?f.value:f["default"]==="true"?!0:!1,rule:n["editor-parameters"][t].rule})))):r[t]=n["editor-parameters"][t]}else r=n["editor-parameters"];return r},processSubproperties:function(n,t,i){var u=this,r,f,e,o=[];for(r in t.subproperties)f=t.subproperties[r],e={value:r,type:"property"},u.designProperties[r]=f,o.push(e);i.subproperties=u.initElements({elements:o,applyIndexing:!1,prefix:n})},process:function(n){var t=this,r,i;t.model.idRender=n.guid;t.model.element=n;for(r in t.indexedProperties)i=t.indexedProperties[r],i.value=null,t.isForm(i)&&t.updateFormInModel(n,i),t.isLayoutContainer(i)&&t.updateLayoutProperty(n,r),n.isText()&&t.isSpecialProperty(i.name)&&t.updateDefaultValueProperty(n,i,r),t.isActiveContainerProperty(i)&&t.updateActiveContainerProperty(n,i),t.updatePropertyModel(n,i,r);return t.model},isForm:function(n){return n["bas-type"]==="form"||n["bas-type"]==="searchform"},isLayoutContainer:function(n){return n["bas-type"]==="change-layout"||n["bas-type"]==="changelayout"},isLocalizableProperty:function(n){return n["bas-type"]==="localizable-string"||n["bas-type"]==="localizablestring"},isActiveContainerProperty:function(n){return n["bas-type"]==="active-container"||n["bas-type"]==="activecontainer"},updateFormInModel:function(n,t){var e=this,u,i=n.properties,r,f;i&&typeof i.xpath=="object"||!n.isRequiredProperty("xpath")?(r=bizagi.editor.utilities.resolveComplexXpath(i.xpath),f=bizagi.editor.utilities.resolveRelatedEntityFromXpath(i.xpath),u=e.communicationProtocol.createProtocol({protocol:"relatedforms",xpath:n.triggerGlobalHandler("getContextXpath",{xpath:r}),relatedEntity:f,context:t["bas-type"],isScopeAttribute:n.triggerGlobalHandler("getNodeInfo",{xpath:r,callback:function(n){return n.isScopeAttribute}})}),t.relatedForms=u.processRequest()):t.relatedForms=[]},updateLayoutProperty:function(n,t){var i={elements:[]};n.elements&&$.each(n.elements,function(n,t){var r=t.properties.width||"0%";i.elements.push({index:n,width:r})});n.properties[t]=i},updatePropertyModel:function(n,t,i){var f=this,e=bizagi.editor.component.properties.commands.factory,o,u,r;t.show=!0;t.notShow=undefined;f.isRuleProperty(i)&&(o=e.createRuleCommand({command:i,element:n,key:i}),o.execute());u=e.createCommand({command:i,element:n,key:i,indexedProperty:t});u&&u.execute();r=bizagi.editor.utilities.resolveProperty(n.properties,i);bizagi.editor.utilities.isObject(r)&&(r=bizagi.clone(r),r=f.resolveObjectProperty(t,r));t.value=r;!t.value&&t.deprecated&&bizagi.override.enableDeprecatedProperties&&(t.show=!1)},updateDefaultValueProperty:function(n,t,i){t["default"]=n.getDefaultValueProperty(i)},updateActiveContainerProperty:function(n,t){var i=n.getChildren();t["editor-parameters"]=t["editor-parameters"]||{};t["editor-parameters"].values=i.length>0?$.map(i,function(n){return{label:n.resolveDisplayNameProperty(),value:n.guid,icon:"tab"}}):[]},resolveObjectProperty:function(n,t){var i=this;return i.isLocalizableProperty(n)&&(t=i.resolveResource(t.i18n,bizagi.editorLanguage.key)),t},resolveResource:function(n,t){if(!n)return"";if(typeof n=="string")return n;if(t=t||bizagi.language,n.languages){while(n.languages[t]==null&&t.length>0){var i=t.split("-");i.pop();t=i.join("-")}if(t.length==0||n.languages[t]==null)return n["default"]}else return n["default"];return n.languages[t]},isSpecialProperty:function(n){return n==="maxlength"},populateExternalProperties:function(n){return{renderCaption:bizagi.editor.utilities.resolveInternalResource(n.display)}},getCaption:function(n){var t=this;return t.indexedProperties[n]&&t.indexedProperties[n].caption?t.indexedProperties[n].caption:n},isRuleProperty:function(n){var t=this;return t.Class.rulePropertiesHash.indexOf(n)>=0},propertyIsEnabled:function(n){var t=this;return $.inArray(n,t.disableProperties)<0}});
bizagi.editor.component.controller("bizagi.editor.component.gridcolumneditor",{init:function(n,t){t=t||{};this._super(n);this.model=t.model;this.canvas=n;this.renderArea=t.renderArea;this.presenter=t.presenter;this.options=t.options},loadTemplates:function(){var n={gridcolumneditor:bizagi.getTemplate("bizagi.editor.component.gridcolumneditor")+"#gridcolumneditor-container"};return this._super(n)},refresh:function(n){this.render(n)},render:function(n){var t=this;n=n||{};t.options=$.extend(t.options,n.options);n.gridModel&&t.model.update(n.gridModel);t.createOverlay();$.when(t.loadTemplates()).done(function(){t.canvas.empty();var i=t.renderGrid();t.renderGridWidths(n.gridModel);t.activeState(n,i)})},destroy:function(){var n=this;n.overlay.detach();n.renderArea.removeClass("bz-edit-mode");n.presenter.publish("close");$(window).unbind("resize.grid")},createOverlay:function(){var n=this,t;return n.overlay?n.overlay:(t=n.overlay=$("<div />"),t.addClass("bz-grid-columneditor-container-main"),n.renderArea.addClass("bz-edit-mode"),t.appendTo(n.renderArea),n.canvas.appendTo(t),t)},renderGrid:function(){var t=this,n,i;return i=t.model.getViewModel(),n=t.grid=$.tmpl(t.getTemplate("gridcolumneditor"),i),n.offset({top:t.options.top,left:t.options.left}),n.height(t.options.height),n.width(t.options.width),n.attr("difWindow",$(window).width()-(n.position().left+n.width())),$(window).bind("resize.grid",function(){n.width($(window).width()-n.attr("difWindow"))}),n.appendTo(t.canvas),i.columns.length===0?n.addClass("ui-drop-here-layout"):n.removeClass("ui-double-drop-here-layout"),n.find(".ui-icon").css("background-image","url('')"),n.find(".bz-grid-column").css("height","50px"),t.addGridSortBehaviour(n),n},renderGridWidths:function(){var n=this,t=n.model.model;$.each($(".bz-grid-column",n.grid),function(n,i){var e=t.columns[n];if(e.columnwidth){var r=e.columnwidth,u=parseInt(r).toString(),f=r.substring(u.length,r.length);$(i).css("width",u+f);f!="%"&&$(i).find("span").css("width",u+f)}else $(i).css("width","auto")})},addGridSortBehaviour:function(n){var t=this;n.sortable({items:".ui-bizagi-draggable-item",revert:!0,connectWith:".ui-bizagi-container-connectedSortable",distance:1,cursorAt:{top:-3,left:0},placeholder:"bz-fm-grid-columneditor-placeholder-custom",delay:0,helper:"clone"});n.disableSelection();n.bind("sortstart",function(n,i){t.onSortStart(i)});n.bind("sortactivate",function(n,i){t.onSortActivate(i)});n.bind("sortstop",function(n,i){t.onSortStop(i)})},activeState:function(n,t){var f=this,i=n.guidSelected,r,u;if($.isArray(i)&&i.length>0){for(r=0,u=i.length;r<u;r++)$('div[data-id="'+i[r]+'"]',t).addClass("ui-state-active");f.presenter.publish("processSelectedColumns",{refresh:!0})}},onSortStart:function(n){var t=this,i=$(n.item).parent().children(".ui-bizagi-itemfordrag").index(n.item);t.initialPosition=i},onSortActivate:function(n){var t=this;$(n.item).hasClass("mtool-item")?(t.sourceData=$(n.item).data("render"),t.source="controlsNavigator"):$(n.item).hasClass("bizagi_editor_xpathnavigator_data")?(t.sourceData=$(n.item).data(),t.source="xpathNavigator"):t.source="gridColumnEditor"},onSortStop:function(n){var t=this,f=t.initialPosition,u=t.source,r=t.sourceData,i=$(n.item).parent().children(".ui-bizagi-itemfordrag").not(".ui-sortable-placeholder").index(n.item);t.finalPosition=i;u=="gridColumnEditor"?(t.model.moveColumn(f,i),t.presenter.publish("moveColumn",{guid:t.model.getGuid(),data:r,initialPosition:f,finalPosition:i})):u=="controlsNavigator"?(t.model.insertControlColumn(i,r),t.presenter.publish("insertControl",{guid:t.model.getGuid(),data:r,position:i})):u=="xpathNavigator"&&(t.model.insertXpathColumn(i,r),t.presenter.publish("insertXpath",{guid:t.model.getGuid(),data:r,position:i}));t.refresh()},selectColumn:function(n,t){var i=this,r=n.offset(),u={position:{top:r.top,left:r.left,width:n.outerWidth(),height:n.outerHeight()},element:n,guid:n.data("id"),type:"column",grid:i.model.guid};t!==undefined&&$.extend(u,{ctrlIsPressed:!0});i.presenter.publish("updateDesignAttributesColumn",{guid:n.data("id"),property:"columnwidth",attributes:{isWidthColumnEditable:i.model.isWidthColumnEditable(n.data("id")),percentMaxWidth:i.model.getPercentMaxWidth(n.data("id"))}});i.presenter.publish("selectColumn",u)},unselectColumn:function(n){var t=this;t.presenter.publish("unselectColumn",n)},showContextMenu:function(n,t){var i=this,r={position:t,guid:n,type:"column",grid:i.model.guid};i.presenter.publish("showContextMenu",r)},".biz-action-btn.biz-btn-ok click":function(){var n=this;n.presenter.publish("performValidationsInModel",{originalGridModel:n.model.originalModel,model:n.model.getViewModel()})},".biz-action-btn.biz-btn-cancel click":function(){var n=this;n.presenter.publish("cancelChangesInModel",{gridModel:n.model.originalModel});n.destroy()},".bz-grid-column click":function(n){var t=this,i=t.presenter.publish("checkCtrlKey",{});i?(n.toggleClass("ui-state-active"),n.hasClass("ui-state-active")?t.selectColumn(n,!0):t.unselectColumn({guid:n.data("id"),ctrlIsPressed:!0})):($("#bz-fm-grid-columneditor .bz-grid-column").not(n).removeClass("ui-state-active"),n.toggleClass("ui-state-active"),n.hasClass("ui-state-active")?t.selectColumn(n):t.unselectColumn())},".bz-grid-column mousedown":function(n,t){var i=this;return t.button==2?(i.showContextMenu(n.data("id"),{x:t.clientX,y:t.clientY}),t.preventDefault(),t.stopPropagation(),!1):!0}});
bizagi.editor.observableClass.extend("bizagi.editor.component.gridcolumneditor.presenter",{},{init:function(n){var t=this;t._super();n=n||{};this.canvas=n.canvas||$("<div />");this.model=new bizagi.editor.component.gridcolumneditor.model(n.gridModel);t.gridcolumneditor=new bizagi.editor.component.gridcolumneditor(this.canvas,{model:this.model,presenter:t,renderArea:n.renderArea})},getGuid:function(){return this.model.getGuid()},refresh:function(n){var t=this;t.gridcolumneditor.refresh(n)},render:function(n){var t=this;t.gridcolumneditor.render(n)},destroy:function(){var n=this;n.gridcolumneditor.destroy()}});
bizagi.editor.observableClass.extend("bizagi.editor.component.gridcolumneditor.model",{},{init:function(n){var t=this;t.model={columns:[]};t.guid=n.guid;t.originalModel=bizagi.clone(n);t.model.columns=t.processModel(n)},getGuid:function(){return this.guid},update:function(n){var t=this;t.model.columns=t.processModel(n)},processModel:function(n){var r=[],i,t;if(!n)return r;if(n.elements.length>0)for(i=0;i<n.elements.length;i++)t=n.elements[i],r.push({guid:t.guid,displayName:bizagi.editor.utilities.resolvei18n(t.properties.displayName),xpath:t.properties.xpath,type:t.type,columnwidth:t.properties.columnwidth});return r},getViewModel:function(){return this.model},insertControlColumn:function(n,t){var r=this,i={guid:Math.guid(),displayName:t.caption,type:t.type};return r.model.columns.splice(n,0,i),i},insertXpathColumn:function(n,t){var r=this,i={guid:Math.guid(),displayName:t.displayName,xpath:bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity)};return r.model.columns.splice(n,0,i),i},moveColumn:function(n,t){var i=this;i.model.columns.move(n,t)},deleteColumn:function(n){for(var i=this,t=0,r=i.model.columns.length;t<r;t+=1)if(i.model.columns[t].guid===n){i.model.columns.splice(t,1);break}},isWidthColumnEditable:function(n){var i=this,e=$.grep(i.model.columns,function(n){return n.columnwidth==undefined||n.columnwidth=="auto"}),t,u,f,r;if(e.length==1){for(t=0,u=i.model.columns.length;t<u;t+=1)if(f=i.model.columns[t],r=f.columnwidth,r=="auto"||r==undefined&&n==i.model.columns[t].guid)return!1;return!0}return!0},getPercentMaxWidth:function(n){for(var f,i,r=this,u=100,t=0,e=r.model.columns.length;t<e;t+=1)f=r.model.columns[t],i=f.columnwidth,i&&i.indexOf("%")>=0&&n!=r.model.columns[t].guid&&(u-=parseInt(i));return u}});
bizagi.editor.component.controller("bizagi.editor.component.wait",{},{init:function(n,t){var i=this;i._super();t=t||{};i.canvas=n;i.model=t.model;i.presenter=t.presenter;i.renderArea=t.renderArea},loadTemplates:function(){var n={wait:bizagi.getTemplate("bizagi.editor.component.wait")+"#wait-container"};return this._super(n)},render:function(){var n=this,i=new $.Deferred,t;return bizagi.log("self.createOverlay();"),n.createOverlay(),t=n.element,t.empty(),$.when(n.loadTemplates()).done(function(){var r=n.getTemplate("wait");$.tmpl(r,n.model.getModel()).appendTo(t);i.resolve()}),i.promise()},createOverlay:function(){var n=this,t;if(n.overlay)return n.overlay;t=n.overlay=$("<div />");t.addClass("bz-grid-wait-container-main");n.renderArea.addClass("bz-edit-mode");t.appendTo(n.renderArea);n.canvas.appendTo(t)},destroy:function(){var n=this;n.overlay.detach();n.renderArea.removeClass("bz-edit-mode")}});
bizagi.editor.observableClass.extend("bizagi.editor.component.wait.presenter",{},{init:function(n){var t=this;t._super();n=n||{};t.canvas=n.canvas||$("<div />");t.model=new bizagi.editor.component.wait.model(n.model);t.waitEditor=new bizagi.editor.component.wait(t.canvas,{model:t.model,presenter:t,renderArea:n.renderArea})},render:function(n){var t=this;t.waitEditor.render(n)},destroy:function(){var n=this;n.waitEditor.destroy()}});
bizagi.editor.observableClass.extend("bizagi.editor.component.wait.model",{},{init:function(n){var t=this;n=n||{};t.message=n.message||""},getModel:function(){return{message:this.message}}});
bizagi.editor.component.controller("bizagi.editor.component.searchresulteditor",{init:function(n,t){t=t||{};this._super(n);this.model=t.model;this.canvas=n;this.presenter=t.presenter;this.options=t.options},loadTemplates:function(){var n={searchresulteditor:bizagi.getTemplate("bizagi.editor.component.searchresulteditor")+"#searchresulteditor-container"};return this._super(n)},refresh:function(n){this.render(n)},render:function(n){var t=this;n=n||{};t.options=$.extend(t.options,n.options);n.searchResultModel&&t.model.update(n.searchResultModel);t.canvas.empty();$.when(t.loadTemplates()).done(function(){var i=t.renderGrid();i.children().length===0&&i.addClass("children");i.appendTo(t.canvas);n.currentSelectElement&&t.selectColumnByGuid(n.currentSelectElement)})},renderGrid:function(){var n=this,t;return t=n.grid=$.tmpl(n.getTemplate("searchresulteditor"),n.model.getViewModel()),$("[title]",t).tooltip(),t.appendTo(n.canvas),n.addGridSortBehaviour(t),t},addGridSortBehaviour:function(n){var t=this;n.sortable({items:".ui-bizagi-draggable-item",revert:!0,connectWith:".ui-bizagi-container-connectedSortable",distance:10,cursorAt:{top:-3,left:0},placeholder:"bz-fm-searchresult-placeholder",delay:150,helper:"clone"});n.disableSelection();n.bind("sortstart",function(n,i){t.onSortStart(i)});n.bind("sortactivate",function(n,i){t.onSortActivate(i)});n.bind("sortstop",function(n,i){t.onSortStop(i)})},onSortStart:function(n){var t=this,i=$(n.item).parent().children(".ui-bizagi-itemfordrag").index(n.item);t.initialPosition=i},onSortActivate:function(n){var t=this;$(n.item).hasClass("bizagi_editor_xpathnavigator_data")?(t.sourceData=$(n.item).data(),t.source="xpathNavigator"):t.source="searchResultEditor"},onSortStop:function(n){var t=this,f=t.initialPosition,r=t.source,u=t.sourceData,i=$(n.item).parent().children(".ui-bizagi-itemfordrag").not(".ui-sortable-placeholder").index(n.item);t.finalPosition=i;r=="searchResultEditor"?t.presenter.publish("moveColumn",{data:u,initialPosition:f,finalPosition:i}):r=="xpathNavigator"&&t.presenter.publish("insertXpath",{data:u,position:i})},selectColumn:function(n){var i=this,t=n.offset();i.presenter.publish("selectColumn",{position:{top:t.top,left:t.left,width:n.outerWidth(),height:n.outerHeight()},element:n,guid:n.data("id")})},unSelectColumn:function(){var n=this;n.presenter.publish("unSelectColumn",{})},selectColumnByGuid:function(n){var i=this,r=$('.bz-searchresult-column[data-id = "'+n+'"]',i.canvas),t;r.length>0&&(t=$(r[0]),t.toggleClass("ui-state-active"),i.selectColumn(t))},".bz-searchresult-column click":function(n){var t=this;$("#bz-fm-searchresult-editor > .bz-searchresult-column").not(n).removeClass("ui-state-active");n.toggleClass("ui-state-active");n.hasClass("ui-state-active")?t.selectColumn(n):t.unSelectColumn(n)}});
bizagi.editor.observableClass.extend("bizagi.editor.component.searchresulteditor.presenter",{},{init:function(n){var t=this;t._super();n=n||{};this.model=new bizagi.editor.component.searchresulteditor.model(n.searchResultModel);t.searchresulteditor=new bizagi.editor.component.searchresulteditor(n.canvas,{model:this.model,presenter:t})},refresh:function(n){var t=this;t.searchresulteditor.refresh(n)},render:function(n){var t=this;t.searchresulteditor.render($.extend(n))}});
bizagi.editor.observableClass.extend("bizagi.editor.component.searchresulteditor.model",{},{init:function(n){var t=this;t.dummyRows=5;t.model=t.processModel(n)},update:function(n){var t=this;t.model=t.processModel(n)},processModel:function(n){var o=this,u={columns:[],rows:[],resultValidations:n.resultValidations},i,r,t,f,e;if(!n)return u;if(i=n.model,i.length>0)for(r=0;r<i.length;r++){for(t=i[r],f=[],e=0;e<o.dummyRows;e++)f.push({value:"value"});u.columns.push({guid:t.guid,displayName:bizagi.editor.utilities.resolvei18n(t.properties.displayName),xpath:t.properties.xpath,type:t.type,values:f})}return u},getViewModel:function(){return this.model}});
bizagi.editor.component.controller("bizagi.editor.component.buttoneditor",{init:function(n,t){t=t||{};this._super(n);this.model=t.model;this.canvas=n;this.presenter=t.presenter;this.options=t.options;this.rendering=new bizagi.rendering.facade},loadTemplates:function(){var n={buttoneditor:bizagi.getTemplate("bizagi.editor.component.buttoneditor")+"#buttoneditor-container"};return this._super(n)},refresh:function(n){this.render(n)},render:function(n){var t=this;n=n||{};t.isReadOnly=n.isReadOnly!="undefined"?bizagi.util.parseBoolean(n.isReadOnly):!1;t.allowAddButtons=n.allowAddButtons!="undefined"?bizagi.util.parseBoolean(n.allowAddButtons):!1;t.options=$.extend(t.options,n.options);n.buttonModel&&t.model.update(n.buttonModel);$.when(t.loadTemplates()).done(function(){var n,i;t.buttonEditor||(t.canvas.empty(),n=t.buttonEditor=$.tmpl(t.getTemplate("buttoneditor")),n.appendTo(t.canvas));i=$("#bz-fm-buttoneditor-rendering",t.buttonEditor);t.renderButtons(i)})},renderButtons:function(n){var t=this;if(bizagi.renderButtonsTimeout==null)return bizagi.renderButtonsTimeout=setTimeout(function(){bizagi.renderButtonsTimeout=null},200),t.rendering.update({mode:"design",canvas:n,allowButtons:!0,data:{properties:{},buttons:t.model.getViewModel()}}),$.when(t.rendering.ready()).done(function(){var i=$(".ui-bizagi-button-container",n),e=$(".ui-bizagi-button",i),u,f,r;i.unwrap();e.wrap("<span><\/span>");$(".bz-fm-buttoneditor-add",i).button();$(".bz-fm-buttoneditor-add .ui-button-text",i).addClass("bz-fm-buttoneditor-add-icon");!t.isReadOnly&&t.allowAddButtons?($(".bz-fm-buttoneditor-add",i).button(),$(".bz-fm-buttoneditor-add .ui-button-text",i).addClass("bz-fm-buttoneditor-add-icon"),u=$(i.children()[0]),u.sortable({items:u.children().not(".bz-fm-avoid-sort"),cancel:"textarea,select,option",distance:10,axis:"x",cursorAt:{top:-3,left:0},placeholder:"ui-bizagi-button-placeholder bz-fm-avoid-sort",delay:150,start:function(n,i){t.sortStart(n,i)},tolerance:"pointer",stop:function(n,i){t.sortFinish(n,i)}}),t.options.element&&(f=t.options.element.guid,r=$('input[data-guid="'+f+'"]',i),r.length>0&&(r.toggleClass("bz-state-active"),r=r.parent(),t.selectButton(r,f)))):$(".bz-fm-avoid-sort",i).hide()}),n},sortStart:function(n,t){var r=this,i=$(t.item).parent().children().not(".bz-fm-avoid-sort").index(t.item);return t.item.data("start-position",i),r.initialPosition=i,!0},sortFinish:function(n,t){var i=this,r=$(t.item).parent().children().not(".bz-fm-avoid-sort").index(t.item);return i.presenter.publish("moveButton",{initialPosition:t.item.data("start-position")||i.initialPosition,finalPosition:r}),!0},selectButton:function(n,t){var r=this,i=n.offset();r.presenter.publish("selectButton",{position:{top:i.top,left:i.left,width:n.outerWidth(),height:n.outerHeight()},element:n,guid:t,type:"button"})},unselectButton:function(){var n=this;n.presenter.publish("unselectButton")},".ui-bizagi-button click":function(n){var t=this,i;t.isReadOnly||($(".ui-bizagi-render").not(n).removeClass("ui-state-active"),$(".ui-bizagi-grid-cell").not(n).removeClass("ui-state-active"),$(".ui-bizagi-container").removeClass("ui-bizagi-container-selected"),n.toggleClass("bz-state-active"),i=n.hasClass("bz-state-active"),$(".ui-bizagi-button",t.canvas).not(n).removeClass("bz-state-active"),i?t.selectButton(n.parent(),n.data("guid")):t.unselectButton())},".bz-fm-buttoneditor-add click":function(){var n=this;n.presenter.publish("addButton")}});
bizagi.editor.observableClass.extend("bizagi.editor.component.buttoneditor.presenter",{},{init:function(n){var t=this;t._super();n=n||{};this.model=new bizagi.editor.component.buttoneditor.model(n.buttonModel);t.buttoneditor=new bizagi.editor.component.buttoneditor(n.canvas,{model:this.model,presenter:t,isReadOnly:n.isReadOnly})},refresh:function(n){var t=this;t.buttoneditor.refresh(n)},render:function(n){var t=this;t.buttoneditor.render($.extend(n))}});
bizagi.editor.observableClass.extend("bizagi.editor.component.buttoneditor.model",{},{init:function(n){var t=this;t.model=t.processModel(n)},update:function(n){var t=this;t.model=t.processModel(n)},processModel:function(n){var t=this;return n},getViewModel:function(){return this.model}});
bizagi.editor.observableClass.extend("bizagi.editor.command",{},{init:function(n){n=n||{};this._super();this.arguments=n.arguments;this.controller=n.controller;this.model=n.model;this.arguments.canUndo=this.arguments.canUndo!==undefined?this.arguments.canUndo:this.canUndo();this.arguments.refresh=this.needRefresh();this.arguments.canValidate=!1;this.validateArguments()},needRefresh:function(){return!1},execute:function(){},canUndo:function(){return!0},undo:function(){return!1},redo:function(){return this.execute()},validateArguments:function(){if(typeof this.arguments=="undefined")throw"Argument is not defined";},createElement:function(n,t){var i=this,r={properties:n,guid:n.guid,elements:t};return i.model.createElement(n.type,r)},isSpecialElement:function(n,t){var r=this,u,i;(n==="tab"||n==="grid"||n==="offlinetab")&&(n==="tab"||n==="offlinetab")&&(u=r.controller.isOfflineFormContext()?"offlinetabitem":"tabitem",i=r.createElement({type:u,displayName:"Tab 1"}),i.properties.displayName=bizagi.editor.utilities.buildComplexLocalizable("Tab 1",i.guid,"displayName"),t.addElement(i))},resolveResult:function(n){var t=typeof n=="object"&&n.done;return t&&n.state()=="resolved"?bizagi.resolveResult(n):n},setXpathAdhoc:function(n){var t=this;xpath=n.properties.displayName instanceof Object?n.properties.displayName.i18n.default.replace(/[(\/[&\/\\#,+()$~%.'":*?<>{}\s@!��.,������������������������������������������������ܟ���������]/g,""):n.properties.displayName.replace(/[(\/[&\/\\#,+()$~%.'":*?<>{}\s@!��.,������������������������������������������������ܟ���������]/g,"");xpath=xpath.substr(0,1).toLowerCase()+xpath.substr(1);n.properties.xpathAdhoc={xpath:xpath,relatedEntity:null}}});bizagi.editor.command.extend("bizagi.editor.notUndoableCommand",{},{canUndo:function(){return!1}});bizagi.editor.command.extend("bizagi.editor.refreshableCommand",{},{needRefresh:function(){return!0}});
bizagi.editor.observableClass.extend("bizagi.editor.commandfactory",{},{init:function(n){this._super();this.controller=n},create:function(n){if(typeof n.command=="undefined")throw"The argument must contain a command to perform";try{var t=eval("var bafn = function(args, controller, model) { \n return new bizagi.editor."+n.command+"Command({arguments: args, controller: controller, model: model }); \n};\nbafn");return t(n,this.controller,this.controller.getModel())}catch(r){throw"Can't create a comand for "+n.command;}}});
bizagi.editor.observableClass.extend("bizagi.editor.base.controller",{},{init:function(n){var t=this;this._super();n=n||{};this.readyDefer=new $.Deferred;this._ResourcesServices=bizagi.editor.base.services.resourcesServices;t.commandfactory=new bizagi.editor.commandfactory(this);t.undoCommandStack=[];t.redoCommandStack=[];t.copyFormatStack=[];t.selectedElements={};t.communicationProtocol=bizagi.editor.communicationprotocol.factory;t.communicationProtocol.setContext(n.context);t.ctrlPressed=!1;t.newForm=n.data==undefined;t.context=n.context||"form";t.originalContext=bizagi.clone(t.context);t.contextInfo={xpath:{xpath:{baxpath:{xpath:"",contextentity:n.contextentity,scopedefinition:n.scopedefinition}}},guid:null};t.baseContextInfo=bizagi.clone(t.contextInfo);t.contextEntityType=n.contextentitytype=="enum"?"parameter":n.contextentitytype;t.xpathNavigatorView=bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity;setTimeout(function(){t.initModels(n)},200)},initModels:function(n){var t=this,r,f,e,o,s,i,c=t.communicationProtocol.createProtocol({protocol:"availablelanguages"}),l=t.communicationProtocol.createProtocol({protocol:"getcontrolsdefinitions"}),a=t.communicationProtocol.createProtocol({protocol:"getfirstload"}),v=t.communicationProtocol.createProtocol({protocol:"getlayoutsdefinitions"}),y=t.communicationProtocol.createProtocol({protocol:"verifyletters"}),p=t.communicationProtocol.createProtocol({protocol:"checkflags",flags:{EnableCssClassProperty:!0,EnableShowAlwaysReverseAction:!0,EnableNextWithoutValidations:!0,UseOfflineForms:!0}}),u=t.communicationProtocol.createProtocol({protocol:"getcontrolsdisabled",context:t.context}),h=!1;t.isNewForm()||(h=t.communicationProtocol.createProtocol({protocol:"checkoutform"}).processRequest());$.when(l.processRequest()).pipe(function(n){return r=n,a.processRequest()}).pipe(function(n){return f=n,v.processRequest()}).pipe(function(n){return e=n,c.processRequest()}).pipe(function(n){return o=n,y.processRequest()}).pipe(function(n){return s=n,p.processRequest()}).pipe(function(n){return i=n,u.processRequest()}).pipe(function(n){return u=n,h}).done(function(h){$.when(bizagi.localization.ready()).done(function(){var c=t.componentModels={},l=c.controls=new bizagi.editor.controls(r,$.extend(i,s,u)),a;bizagi=bizagi||{};bizagi.editor=bizagi.editor||{};bizagi.editor.flags=i;h=h||{};t.isInCheckout=h.isInCheckout;t.userInfo=h.userInfo;i.EnableCssClassProperty||l.disableControlProperties("EnableCssClassProperty");n.isActivityForm=t.isFormContext()||t.isStartFormContext()?bizagi.util.parseBoolean(n.isActivityForm):!1;t.model=new bizagi.editor.model({definitions:r,controls:l,context:n.context,contextentity:n.contextentity,scopedefinition:n.scopedefinition,isActivityForm:n.isActivityForm,hasOfflineForm:n.hasOfflineForm,isOfflineAsOnline:n.isOfflineAsOnline,version:n.version,languages:o,flags:i});t.model.subscribe("refresh",function(){t.publish("refresh")});t.model.subscribe("getDefaultDisplayName",function(n,i){return t.publish("getDefaultDisplayName",i)});t.model.subscribe("getNodeInfo",function(n,i){return t.publish("getNodeInfo",i)});t.model.subscribe("getContextXpath",function(n,i){return t.getContextXpath(i)});t.model.subscribe("findXpathAttributes",function(n,i){return t.publish("findXpathAttributes",i)});t.model.subscribe("resizeHeigthCanvas",function(n,i){return t.publish("resizeHeigthCanvas",i)});t.model.subscribe("isReadOnlyForm",function(){return t.isReadOnlyForm()});t.model.subscribe("getContextEntityType",function(){return t.getContextEntityType()});t.model.subscribe("getControllerInfo",function(n,i){if(i.type&&typeof t[i.type]=="function")return t[i.type](i)});t.model.subscribe("refreshElement",function(n,i){return t.publish("refreshElement",i)});t.model.subscribe("formIsLoaded",function(n,i){return t.publish("formIsLoaded",i)});a=[];(t.isFormContext()||t.isStartFormContext())&&$.each(l.controls,function(n,i){i.type&&(i.type=="userfield"||i.rendertype=="userfield")&&(a.push(t.loadUserfield(i)),t.loadIconUserField(i))});c.xpathNavigator=new bizagi.editor.component.xpathnavigator.model(f);c.controlsNavigator=new bizagi.editor.component.controlsnavigator.model;c.controlsNavigator.subscribe("isContextEntityApplication",function(){return t.isContextEntityApplication()});c.controlsNavigator.subscribe("getContext",function(){return t.getContext()});c.controlsNavigator.processData(l);c.layoutNavigator=new bizagi.editor.component.layoutnavigator.model(e);c.ribbon=new bizagi.editor.component.ribbon.model(t.model.getRibbonModelData());t.processEntityId=c.xpathNavigator.getProcessEntityId();$.when.apply($,a).done(function(){t.readyDefer.resolve()})})})},loadUserfield:function(n){var t=$.Deferred(),i={actiontype:"GetUserfieldDependencies",parameters:[{key:"userfieldId",value:n.guid}]};return $.when(bizagi.editor.base.services.resourcesServices.getResource(i)).done(function(t){try{var r=t.result.parameters[0].value;try{t=eval(r)}catch(i){bizagi.log("Could not parse result userfield1 "+n.name,i.message)}$.each(t,function(t,i){if(i.type=="js")try{eval(i.content)}catch(r){bizagi.log("Could not parse result userfield3 "+n.name,r.message)}i.type=="css"&&bizagi.util.loadStyle(i.content,n.guid)})}catch(i){bizagi.log("Could not parse result userfield "+n.name,i.message)}}).pipe(function(){t.resolve()}),t.promise()},loadIconUserField:function(n){var t=$.Deferred(),i;n.icon=t.promise();i={actiontype:"GetUserfieldIconDependencies",parameters:[{key:"userfieldId",value:n.guid},{key:"density",value:"HDPI"},{key:"size",value:"SMALL"}]};$.when(bizagi.editor.base.services.resourcesServices.getResource(i)).done(function(i){var r=i.result.parameters[0].value;bizagi.util.loadIconStyle(r,n.name);n.icon=t.resolve(r)})},ready:function(){return this.readyDefer.promise()},executeCommand:function(n){var t=this,i,r;return i=this.commandfactory.create(n),i?$.when(i.execute()).pipe(function(u){if(u&&!n.error){n.success=!0;t.onCommandExecuted(n);r=typeof n.canUndo!="undefined"?n.canUndo:!0;r&&i.arguments.command!=="getElementDesignProperty"&&(t.undoCommandStack.push(i),t.redoCommandStack.length>0&&t.redoCommandStack.splice(0,t.redoCommandStack.splice.length))}else n.success=!1,n.result={error:!0,message:n.error};return n.result}):void 0},onCommandExecuted:function(n){this.publish("commandExecuted",n)},hasUndo:function(){var n=this;return n.undoCommandStack.length>0?!0:!1},undo:function(){var n,t;return(n=this.undoCommandStack.pop(),!n)?!1:(t=n.undo(),t?this.redoCommandStack.push(n):this.undoCommandStack.push(n),t)},hasRedo:function(){var n=this;return n.redoCommandStack.length>0?!0:!1},redo:function(){var n,t,i;if(n=this.redoCommandStack.pop(),!n)return!1;t=n.redo();i=$.extend({},n.arguments,{redoed:!0});this.onCommandExecuted(i);return this.undoCommandStack.push(n),t},getControlsModel:function(){var n=this;return n.componentModels.controls},isContextEntityApplication:function(){var n=this;return n.contextEntityType=="application"},getControlsNavigatorModel:function(){var n=this,t=n.context;return n.componentModels.controlsNavigator.context[t]},getControlDisplayName:function(n){var t=this;return t.componentModels.controlsNavigator.getControlDisplayName(n)},getXpathNavigatorModel:function(n){var r=this,t,i,u;return(n=n||{},t=n.context,i=r.componentModels.xpathNavigator,t!=null)?t==""?i:i.getSubModel(t):(u=r.contextInfo,i.getSubModel(u.xpath))},getXpathNavigatorModelGrid:function(n){var i=this,t;return(n=n||{},t=n.context,t!=null)?t==""?i.xpathNavigatorModelGrid:i.xpathNavigatorModelGrid.getSubModel(t):this.xpathNavigatorModelGrid},getLayoutNavigatorModel:function(){var n=this;return n.componentModels.layoutNavigator},getRibbonModel:function(){var n=this;return n.componentModels.ribbon},getRenderingModel:function(){var n=this;return n.model.getRenderingModel()},getPersistenceModel:function(){var n=this;return n.model.getPersistenceModel()},getModel:function(){var n=this;return n.model},getCommandsModel:function(){var n=this,t=new $.Deferred;return $.when(n.model.getCommandsModel()).done(function(i){n.commandsModel=bizagi.clone($.extend(i,{flags:n.model.getFlags(),isReadOnly:n.isReadOnlyForm()}));t.resolve(n.commandsModel)}),t.promise()},getFlags:function(){var n=this;return n.model.getFlags()},getCommandsEditorModel:function(){var t=this,n=new $.Deferred;return $.when(t.getCommandsModel()).done(function(t){n.resolve(new bizagi.editor.component.commandseditor.model(t))}),n.promise()},copyFormatHasElement:function(){return this.copyFormatStack.length>0},getCopyFormatElement:function(){return this.copyFormatStack[0]},isOfflineAsOnline:function(){return this.model.checkOfflineAsOnline()},setOfflineAsOnline:function(n){this.model.updateOfflineAsOnline(n)},pushCopyFormat:function(n){this.copyFormatStack.push(n)},popCopyFormat:function(){return this.copyFormatStack.pop()},setCommandsModel:function(n){var t=this;return t.model.setCommandsModel(n)},setOriginalModel:function(n){this.originalModel=n?n:this.getPersistenceModel()},setXpathNavigatorModelGrid:function(n){this.xpathNavigatorModelGrid=n},setUserInfo:function(n){this.userInfo=n},getContext:function(){return this.context},getOriginalContext:function(){return this.originalContext},getContextInfo:function(){var n=this;return{xpath:this.contextInfo.xpath,guid:this.contextInfo.guid||n.model.getGuid()}},getContextXpath:function(n){var r=this,t=n.xpath,i;return r.isGridContext()?(i=bizagi.editor.utilities.resolveComplexXpath(r.contextInfo.xpath),t?i+"."+t:i):t},getUserInfo:function(){return this.userInfo},changeContext:function(n){this.context=n.context;n.context==="adhocgrid"?this.contextInfo.xpathAdhoc=n.xpathAdhoc||this.baseContextInfo.xpathAdhoc:this.contextInfo.xpath=n.xpath||this.baseContextInfo.xpath;this.contextInfo.guid=n.guid||this.baseContextInfo.guid},isFormContext:function(){var n=this;return n.context==="form"},isTemplateContext:function(){var n=this;return n.context==="template"},isStartFormContext:function(){var n=this;return n.context==="startform"},isAdhocFormContext:function(){var n=this;return n.context==="adhocform"||n.context==="adhocgrid"},isOfflineContext:function(){var n=this;return n.context==="offlineform"||n.context==="offlinegrid"},isOfflineFormContext:function(){var n=this;return n.context==="offlineform"&&bizagi.editor.flags.UseOfflineForms},isGridContext:function(){var n=this;return n.context==="grid"||n.context==="offlinegrid"||n.context==="adhocgrid"},searchDependencies:function(n){var t=this;return t.executeCommand({command:"searchDependencies",guids:n.guids,message:n.message})},isSearchFormContext:function(){var n=this;return n.context==="searchform"},isQueryFormContext:function(){var n=this;return n.context==="queryform"},isActivityForm:function(){var n=this;return n.model.checkActivityForm()},hasOfflineForm:function(){var n=this;return n.model.checkOfflineForm()},isReadOnlyForm:function(){return this.isInCheckout},setReadOnlyFlag:function(n){this.isInCheckout=n},thereAreChangesInForm:function(){var n=this;return!bizagi.editor.utilities.objectEquals(n.originalModel,n.getPersistenceModel())},toogleXPathNavigatorView:function(){var n=this;n.xpathNavigatorView=n.xpathNavigatorView===bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity?bizagi.editor.component.xpathnavigator.model.view.allView:bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity},getXpathNavigatorView:function(){return this.xpathNavigatorView},getProcessEntityId:function(){return this.processEntityId},addSelectedElement:function(n,t){var i=this;i.selectedElements[n]=t},removeSelectedElement:function(n){var t=this;if(!n){t.selectedElements={};return}t.selectedElements[n]&&delete t.selectedElements[n]},getSelectedElements:function(n){return n?this.selectedElements[n]:this.selectedElements},getGuidsSelected:function(){var t=this,n=[];for(var i in t.selectedElements)n.push(i);return n},getContextEntityType:function(){return this.contextEntityType},thereAreMultiselection:function(){var t=this,n=0;for(var i in t.selectedElements)n++;return n>1},setNewForm:function(n){this.newForm=n},setCtrlKey:function(n){this.ctrlPressed=n},isCtrlKeyPressed:function(){return this.ctrlPressed},isNewForm:function(){return this.newForm},hasEnableCommandsEditor:function(){var n=this;return n.context==="searchform"||n.context==="queryform"?!1:!0},setLastInsertedElement:function(n){this.lastInsertedElement=n},getLastInsertedElement:function(){return this.lastInsertedElement}});
bizagi.editor.base.controller.extend("bizagi.editor.adhoc.controller",{},{initModels:function(n){var t=this,i,r,u,f;t.adhocProcessId=n.adhocProcessId;var e=t.communicationProtocol.createProtocol({protocol:"availablelanguages"}),o=t.communicationProtocol.createProtocol({protocol:"getcontrolsdefinitions"}),s=t.communicationProtocol.createProtocol({protocol:"getfirstload",adhocProcessId:n.adhocProcessId}),h=t.communicationProtocol.createProtocol({protocol:"getlayoutsdefinitions"});$.when(o.processRequest()).pipe(function(n){return i=n,s.processRequest()}).pipe(function(n){return r=n,r.context="adhocform",h.processRequest()}).pipe(function(n){return u=n,e.processRequest()}).done(function(e){f=e;$.when(bizagi.localization.ready()).done(function(){var e=t.componentModels={},o=e.controls=new bizagi.editor.controls(i);bizagi=bizagi||{};bizagi.editor=bizagi.editor||{};bizagi.editor.flags={};t.model=new bizagi.editor.model({definitions:i,controls:o,context:n.context,contextentity:null,scopedefinition:null,isActivityForm:!1,hasOfflineForm:!1,isOfflineAsOnline:!1,version:"1.0",languages:f,flags:[]});t.model.subscribe("refresh",function(){t.publish("refresh")});t.model.subscribe("getDefaultDisplayName",function(n,i){return t.publish("getDefaultDisplayName",i)});t.model.subscribe("getNodeInfo",function(n,i){return t.publish("getNodeInfo",i)});t.model.subscribe("getContextXpath",function(n,i){return t.getContextXpath(i)});t.model.subscribe("findXpathAttributes",function(n,i){return t.publish("findXpathAttributes",i)});t.model.subscribe("resizeHeigthCanvas",function(n,i){return t.publish("resizeHeigthCanvas",i)});t.model.subscribe("isReadOnlyForm",function(){return t.isReadOnlyForm()});t.model.subscribe("getContextEntityType",function(){return t.getContextEntityType()});t.model.subscribe("getControllerInfo",function(n,i){if(i.type&&typeof t[i.type]=="function")return t[i.type](i)});e.xpathNavigator=new bizagi.editor.component.xpathnavigator.model(r);e.controlsNavigator=new bizagi.editor.component.controlsnavigator.model;e.controlsNavigator.subscribe("isContextEntityApplication",function(){return t.isContextEntityApplication()});e.controlsNavigator.subscribe("getContext",function(){return t.getContext()});e.controlsNavigator.processData(o);e.layoutNavigator=new bizagi.editor.component.layoutnavigator.model(u);e.ribbon=new bizagi.editor.component.ribbon.model(t.model.getRibbonModelData());t.readyDefer.resolve()})})},getAdhocXpathNavigatorModelGrid:function(){var n=this,t=new $.Deferred,i=n.communicationProtocol.createProtocol({protocol:"getchildrennodes",node:{entityContext:"adhocgrid",guidRelatedEntity:n.adhocProcessId,xpathAdhoc:n.contextInfo.xpathAdhoc}});return $.when(i.processRequest()).done(function(n){var i=new bizagi.editor.component.xpathnavigator.model(n);t.resolve(i)}),t.promise()}});
$.Widget.prototype.destroy=function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")};
bizagi.editor.observableClass.extend("bizagi.editor.view",{},{init:function(n){var t=this;this._super();n.context!="adhocform"?(this.controller=new bizagi.editor.base.controller(n),t.controller.subscribe("getNodeInfo",function(n,i){return t.getNodeInfo(i)}),t.controller.subscribe("findXpathAttributes",function(n,i){return t.findXpathAttributes(i)})):this.controller=new bizagi.editor.adhoc.controller(n);t.controller.subscribe("commandExecuted",function(n,i){t.commandExecuted(i)});t.controller.subscribe("refresh",function(){t.refresh()});t.controller.subscribe("showControlWizard",function(n,i){return t.showControlWizard(i)});t.controller.subscribe("getExternalData",function(n,i){return t.getExternalData(i)});t.controller.subscribe("getDefaultDisplayName",function(n,i){return t.getDefaultDisplayName(i)});t.controller.subscribe("resizeHeigthCanvas",function(n,i){return t.refreshCanvas(i)});t.controller.subscribe("refreshElement",function(n,i){return t.refreshElement(i)});t.controller.subscribe("formIsLoaded",function(){return t.formIsLoaded()})},ready:function(){return this.controller.ready()},refresh:function(n){var t=this;n=n||{};$.when(t.preRender(n)).pipe(function(){t.render(n);t.postRender()})},executeCommand:function(n){var i=this,t,r;return(n.command&&(n.gridGuid=n.command==="changeContext"?i.guid:null),t=$.when(i.controller.executeCommand(n)).pipe(function(t){return n.success&&n.refresh&&i.refresh(n),t}),r=typeof t=="object"&&t.done,r&&t.state()=="resolved")?bizagi.resolveResult(t):t},undo:function(){var t=this,n;n=t.controller.undo();n&&this.refresh()},redo:function(){var n;n=this.controller.redo();n&&this.refresh()},render:function(){},showControlWizard:function(){},getExternalData:function(){},commandExecuted:function(n){var t=this;typeof t[n.command+"Executed"]=="function"&&t[n.command+"Executed"](n.result,n)}});
bizagi.editor.view.extend("bizagi.editor.modelerView",{},{init:function(n){var t=this;n=n||{};t.renderingMode="design";t.validateForm=!1;t._super(n);t.currentTabIndex=0;bizagi.editorLanguage={displayname:"default",IsRightToLeft:!1,key:"default"};var r=$("body"),u={message:bizagi.localization.getResource("formmodeler-component-wait-message-loading-form")},i=new bizagi.editor.component.wait.presenter({model:u,renderArea:r});$.when(this.controller.ready(),i.render()).done(function(){$.when(t.processLayout(n)).done(function(){setTimeout(function(){i.destroy()},100)})});n.data&&t.load(n.data);n.autoGenerate&&t.autoGenerate();t.setOriginalModel()},load:function(n){var t=this;$.when(this.controller.ready()).done(function(){t.executeCommand({command:"loadModel",dataModel:n,canUndo:!1})})},autoGenerate:function(){var n=this;$.when(this.controller.ready()).done(function(){$.when(n.controller.getXpathNavigatorModel()).done(function(t){var i,u=t.getProcessEntityId(),r;u?(t.getProcessEntityModel(),r=t.getRootNode()||{},$.isArray(r.nodes)&&(i=r.nodes[0],i&&$.when(t.getChildren(i.id)).done(function(){n.executeCommand({command:"addEntityChildren",node:i,canUndo:!1})}))):(i=t.getRootNode(),n.executeCommand({command:"addEntityChildren",node:i,canUndo:!1}))})})},save:function(){var t=this,n={command:"saveModel",dataModel:{},canUndo:!1};return t.executeCommand(n),n.dataModel},validateAndSaveForm:function(){var n=this;n.performSave(!0)},updateForm:function(n){var i=this,t;t={command:"updateModel",data:n,canUndo:!1};i.executeCommand(t)},setOriginalModel:function(){var n=this;$.when(this.controller.ready()).done(function(){n.controller.setOriginalModel()})},processLayout:function(n){var t=this,i=new $.Deferred,r;return t.configureHtmlPage(n),t.mainContainer=$("<form-modeler />").appendTo(n.canvas||"body"),t.mainContainer.attr("id","container-layout"),r=new bizagi.editor.component.layout.presenter({canvas:t.mainContainer,context:n.context,isActivityForm:n.isActivityForm}),$.when(r.render()).done(function(){setTimeout(function(){t.configureLeftPane();t.drawRibbon();t.controller.isSearchFormContext()&&t.drawSearchResultEditor();t.controller.isActivityForm()&&t.drawButtonEditor();t.controller.isReadOnlyForm()&&t.showUserInformation();t.configureKeyHandlers();$.when(t.configureRenderingView()).done(function(){i.resolve()})},100)}),i.promise()},configureHtmlPage:function(){$("html").addClass("biz-work-area");$("body").addClass("biz-font").addClass("biz-normal-font").addClass("biz-text-color");$("body").attr("oncontextmenu","return false")},configureLeftPane:function(){var n=this;$.when(n.drawControlsNavigator(),n.drawXpathNavigator(),n.drawLayoutNavigator(),n.drawBanner()).done(function(){n.mainContainer.find("#left-panel").tabs({beforeActivate:function(t,i){var r=$("a",i.newTab).data("rendering-mode");n.hidePropertyBox();n.needsRedrawAfterTabChange(i.newTab.index())&&(n.currentSelectedElement=null,n.controller.removeSelectedElement(),n.renderingMode=r,n.render(r));n.currentTabIndex=i.newTab.index();n.setBannerVisibility(i)}});n.setBannerVisibility()})},configureKeyHandlers:function(){var n=this;$(document).keydown(function(){}).keyup(function(t){t.keyCode===46&&($(document.activeElement).is("input, textarea")||n.deleteElement())});$(document).on("keydown",function(t){t.keyCode==17&&n.controller.setCtrlKey(!0)});$(document).on("keyup",function(){n.controller.isCtrlKeyPressed()&&n.controller.setCtrlKey(!1)})},needsRedrawAfterTabChange:function(n){var t=this;return t.currentTabIndex<2&&n===2?!0:t.currentTabIndex===2&&n<2?!0:!1},setBannerVisibility:function(n){var t=this,i=n?$("a",n.newTab).attr("data-banner"):"hide";i==="show"?t.showBanner():t.hideBanner()},preRender:function(n){var t=this,i=new $.Deferred;return t.validateForm&&n.canValidate?t.processValidations({canRefresh:!1}):i.resolve()},render:function(n,t){var r=this,i=r.controller.getContext();i=="form"?r.renderForm(n,t):i=="searchform"?r.renderSearchForm(t):i=="grid"||i=="offlinegrid"||i=="adhocgrid"?r.renderGridColumnEditor():i=="offlineform"?r.renderForm(n,t):i=="queryform"?r.renderForm(n,t):i=="startform"?r.renderForm(n,t):i=="adhocform"&&r.renderForm(n,t)},postRender:function(){var n=this,t=null;n.controller.thereAreMultiselection()&&(t=bizagi.editor.utilities.getGuidEmpty());n.refreshRibbon(t)},refreshCanvas:function(){var u=this,t,n,f,e,r,i;t=$("#main-panel");n=$(".wrapper-main-scroll");f=1;e=$("> .ui-bizagi-container-form",t);r=$(".top-scroll-grad",n);i=$(".bottom-scroll-grad",n);var h=parseFloat(t.css("padding-top"))+parseFloat(t.css("padding-bottom")),c=Math.floor(n.height()*f-h),o=u.controller.getContext()=="adhocform"?96:0,s=u.controller.getContext()=="adhocform"?n.width()+20:n.width(),l=n.position().top+o,a=n.position().top+n.outerHeight(!0)-i.height()+o,v=e.prop("scrollHeight");v>c?(t.addClass("biz-auto-height"),i.css("top",a).css("width",s),i.show(),r.css("top",l).css("width",s),r.show()):(i.hide(),r.hide(),t.removeClass("biz-auto-height"));t.hasClass("biz-auto-height")&&($(".top-scroll-grad",n).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollTopInterval(n,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}),$(".bottom-scroll-grad",n).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollBottomInterval(n,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}))},renderForm:function(n,t){var i=this,r=$("#main-panel");if(i.refreshRenderingView(n,t),i.controller.isActivityForm()){if(i.refreshButtonEditor(),i.renderingMode=="design")r.on("widgetComplete",function(){i.refreshCanvas()});i.refreshCanvas();setTimeout(function(){i.refreshCanvas()},500)}},renderSearchForm:function(n){this.refreshRenderingView(n);this.refreshSearchFormResult()},renderGridColumnEditor:function(){this.refreshGridColumnEditor()},enableLayoutTab:function(){var n=this;n.mainContainer.find("#left-panel").tabs("option","disabled",[])},disableLayoutTab:function(){var n=this;n.mainContainer.find("#left-panel").tabs("option","disabled",[2])}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawXpathNavigator:function(){var n=this,t=$("<div />").addClass("bizagi_editor_xpathnavigator_container").appendTo(n.mainContainer.find("#left-tab-data-bind"));$.when(n.executeCommand({command:"getXpathNavigatorModel"}),n.controller.getContext()).pipe(function(i,r){n.xpathNavigatorModel=i;var u=n.xpathNavigator=new bizagi.editor.component.xpathnavigator.presenter({canvas:t,model:i,scope:r});return n.controller.isGridContext()&&n.controller.setXpathNavigatorModelGrid(i),n.attachHandlersXpathNavigator(),u.render({isReadOnly:n.controller.isReadOnlyForm(),scope:n.controller.getContext()})})},attachHandlersXpathNavigator:function(){var n=this,t=n.xpathNavigator;n.controller.isReadOnlyForm()||(t.subscribe("nodeDoubleClick",function(t,i){n.onNodeDoubleClick(i)}),t.subscribe("contextMenuItemClick",function(t,i){n.onContextMenuItemClick(i)}),t.subscribe("controlRefreshCanvas",function(t,i){n.refreshCanvas(i)}))},showElementXpath:function(n){var t=this;return n&&t.changeXpathNavigatorView(bizagi.clone(n)),t.xpathNavigator.showXpath(n)},showElementGuid:function(n,t){var i=this;t&&i.changeXpathNavigatorView(bizagi.clone(t));i.xpathNavigator.showXpathByGuid(n,t)},showMetadataXpath:function(n){var t=this;return t.xpathNavigator.showMetadataXpath(n)},changeXpathNavigatorView:function(n){var t=this;return t.controller.isGridContext()?!1:t.controller.getContext()=="template"?!1:(n=bizagi.editor.utilities.resolveComplexXpath(n),n&&(n=n.split(".")[0],!t.xpathNavigatorModel.processEntityRelated(n)&&t.controller.getXpathNavigatorView()===bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity))?(t.performViewAll(t.xpathNavigatorModel.getRootNode()),!0):!1},refreshXpathNavigator:function(n){var t=this;$.when(t.executeCommand({command:"getXpathNavigatorModel"})).done(function(i){t.controller.isGridContext()&&t.controller.setXpathNavigatorModelGrid(i);var r={model:n&&n.model||i,context:n?n.context:undefined,scope:t.controller.getContext(),isReadOnly:t.controller.isReadOnlyForm()};t.xpathNavigator.render(r)})},reloadXpathNode:function(n){var t=this;n&&$.when(t.controller.getXpathNavigatorModel()).done(function(i){i&&$.when(i.getChildren(n.id,!0)).done(function(){t.refreshXpathNavigator()})})},insertXpathElement:function(n){var i=this,t={command:"insertElementFromXpathNavigator",data:{renderType:n.renderType,nodeSubtype:n.nodeSubtype,name:n.displayName,xpath:bizagi.editor.utilities.buildComplexXpath(n.xpath,n.contextScope,n.isScopeAttribute,n.guidRelatedEntity),guid:n.guid}};return n.renderType.indexOf("adhoc")!==-1&&(t.data.context=n.renderType.indexOf("adhoccolumn")!==-1?"adhocgrid":"adhocform",t.data.displayName=n.displayName,n.parent&&(t.data.parent={guidRelatedEntity:n.parent.guidRelatedEntity}),n.guidRelatedEntity&&(t.data.guidRelatedEntity=n.guidRelatedEntity,t.data.entityContext=n.entityContext,n.predefinedValues&&(t.data.predefinedValues=n.predefinedValues))),i.executeCommand(t)},onNodeDoubleClick:function(n){var t=this;t.controller.isTemplateContext()||t.insertXpathElement(n)},onContextMenuItemClick:function(n){var t=this,i=n.action;i=="editentity"&&t.performEditEntity(n.node);i=="viewall"&&t.performViewAll(n.node);i=="refresh"&&t.performRefresh(n.node);i=="addelement"&&t.performAddElement(n.node);i=="addchildelements"&&t.performAddChildElements(n.node);i=="editvalues"&&t.performEditValues(n.node);i=="newForm"&&t.performNewForm(n.node)},performEditEntity:function(n){var t=this,i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"editentity",id:n.guidRelatedEntity});$.when(i.processRequest()).done(function(){t.reloadXpathNode(n)})},performViewAll:function(n){var t=this;n.setCaptionViewContextMenu();$.when(t.executeCommand({command:"getXpathNavigatorModel",toogleView:!0})).done(function(n){t.xpathNavigator.render({model:n,scope:t.controller.getContext()})})},performRefresh:function(n){this.reloadXpathNode(n)},performAddElement:function(n){this.insertXpathElement(n)},performAddChildElements:function(n){var t=this;t.executeCommand({command:"addEntityChildren",node:n})},performEditValues:function(n){var i=this,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"editentityvalues",id:n.guidRelatedEntity});$.when(t.processRequest()).done(function(){})},performNewForm:function(n){var t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"newform",node:n});$.when(t.processRequest()).done(function(){})}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawDecorator:function(n){var t=this,u=n.element;t.removeDecorator();var r=$("<div />").appendTo(u),f=t.executeCommand({command:"getDecoratorModel",guid:n.guid}),i=t.decorator=new bizagi.editor.component.decorator.presenter({canvas:r,data:n,model:f});i.subscribe("showProperties",function(n,i){t.onShowProperties(i)});i.subscribe("showXpathNavigator",function(n,i){t.onShowXpathNavigator(i)});i.subscribe("deleteElement",function(n,i){t.onDeleteElement(i)});i.subscribe("openNestedForm",function(n,i){t.onOpenNestedForm(i)});i.subscribe("buttonClicked",function(n,i){t.onButtonClicked(i)});i.subscribe("close",function(){r.detach()});$.when(i.render()).done(function(){n.IsOnClickEvent&&t.drawPropertyBox({guid:n.guid})})},destroyDecorator:function(){var n=this;n.decorator&&n.decorator.destroy()},removeDecorator:function(){$(".bizagi_editor_component_decorator").length>0&&$(".bizagi_editor_component_decorator").detach()},onShowProperties:function(n){var t=this;t.drawPropertyBox({guid:n.guid})},onShowXpathNavigator:function(n){var t=this,u=t.executeCommand({command:"getElementProperties",guid:n.guid}),o=t.controller.model,s=o.getElement(n.guid),h=s.propertyModel.indexedProperties||{},f=h.xpath||{},i={},r,e;i.typeFilter=f["bas-type"];r=f["editor-parameters"]||{};r.types&&(i.types=r.types,e={typeEditor:i.typeFilter,editorParameters:r},t.editorValidations[n.guid]=e);typeof u.xpath=="object"&&t.changeXpathNavigatorView(u.xpath);$.when(t.controller.getXpathNavigatorModel()).done(function(r){var f=new bizagi.editor.component.xpathnavigator.presenter({model:r}),e=u.xpath;f.subscribe("nodeDoubleClick",function(i,r){t.changeXpathPropertyForElement(n.guid,"xpath",r);f.closePopup()});f.renderPopup({position:{left:n.position.left,top:n.position.top+n.position.height},xpath:e,filter:i})})},changeXpathForElement:function(n,t){var i=this,r={command:"changeProperty",guid:n,property:"xpath",value:bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity)};i.executeCommand(r)},onDeleteElement:function(n){var t=this;t.hidePropertyBox();t.executeCommand({command:"removeElementById",guid:n})},onButtonClicked:function(n){var t=this,r=t.decorator.getDecoratedElement(),i,u,f;n.button==="ConfigGrid"?(t.drawGridColumnEditor({guid:n.guid,element:r}),t.hidePropertyBox(),t.executeCommand({command:"changeContext",guid:n.guid,context:t.getGridContext()})):n.button==="EditNestedForm"?(i={},f=t.executeCommand({command:"getElementProperties",guid:n.guid}),i.refForm=f.form,i.protocol="opennestedform",i.idForm=n.guid,u=bizagi.editor.communicationprotocol.factory.createProtocol(i),u.processRequest()):n.button==="AddForm"?t.drawSelectFormEditor({guid:n.guid,element:r,property:"add.form",caption:"Add Form"}):n.button==="EditForm"&&t.drawSelectFormEditor({guid:n.guid,element:r,property:"edit.form",caption:"Edit Form"})},getGridContext:function(){var n=this;return n.controller.isOfflineFormContext()?"offlinegrid":n.controller.isAdhocFormContext()?"adhocgrid":"grid"}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{changeContextExecuted:function(n,t){var i=this;i.refreshControlsNavigator();i.refreshXpathNavigator({context:t.context});(t.context=="grid"||t.context=="offlinegrid"||t.context=="adhocgrid")&&(i.formContainer.disableSortablePlugin(),i.disableLayoutTab());(t.context=="form"||t.context=="offlineform"||t.context=="adhocform")&&i.enableLayoutTab()},updateModelExecuted:function(n){var t=this;n.action==="CreateForm"?(t.validateForm&&t.processValidations({canRefresh:!1}),t.drawPropertyBox({guid:n.guid})):n.action==="CreateFormFromXpath"?t.reloadXpathNode({id:n.idNode}):n.action==="OpenWizardTemplates"?t.drawPropertyBox({guid:n.guid}):n.action==="OpenNestedForm"&&t.showRenderingModel()},changePropertyExecuted:function(n,t){var i=this,e=t.guid,r,f,u;t.property=="xpath"&&(r=i.controller.model.getElement(e),i.isGrid(r.type)&&(r.deleteColumns&&r.deleteColumns(),i.render()));t.property=="showinprocesses"&&t.value==!1&&(f=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getdependency"}),$.when(f.processRequest()).done(function(n){if(!n){var r=bizagi.localization.getResource("templatedesigner-dependency");$.when(bizagi.showMessageBox(r),i.controller.executeCommand({command:"changeProperty",guid:t.guids[0],property:t.property,value:!0})).done(function(){i.drawPropertyBox({guid:t.guids[0],redraw:!0})})}}));t.refreshProperties&&(u=t.guid,$.isArray(t.guids)&&(u=t.guids[0]),i.drawPropertyBox({guid:u,redraw:!0}))},changeMultiplePropertiesExecuted:function(n,t){var i=this;t.refreshProperties&&i.drawPropertyBox({guid:t.guid,redraw:!0})},loadWidgetsExecuted:function(){var n=this;n.refreshControlsNavigator()},formValidationsExecuted:function(n){var t=this;$.isEmptyObject(n)||(t.validateForm=!0)},isGrid:function(n){return n=="grid"||n==="groupedgrid"}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawControlsNavigator:function(){var n=this,t=$("<div />").appendTo(n.mainContainer.find("#left-tab-minitoolbar"));$.when(n.controller.getControlsNavigatorModel()).pipe(function(i){var r=n.controlsNavigator=new bizagi.editor.component.controlsnavigator.presenter({canvas:t,model:i});return n.attachHandlersControlsNavigator(),r.render({isReadOnly:n.controller.isReadOnlyForm()})})},attachHandlersControlsNavigator:function(){var n=this,t=n.controlsNavigator;n.controller.isReadOnlyForm()||(t.subscribe("controlDoubleClick",function(t,i){n.onControlDoubleClick(i)}),t.subscribe("controlRefreshCanvas",function(t,i){n.refreshCanvas(i)}))},onControlDoubleClick:function(n){var t=this;t.executeCommand({command:"insertElementFromControlsNavigator",data:n})},refreshControlsNavigator:function(){var n=this;$.when(n.controller.getControlsNavigatorModel()).done(function(t){n.controlsNavigator.render({model:t,isReadOnly:n.controller.isReadOnlyForm()})})}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawBanner:function(){var n=this,i=$("<div />").appendTo(n.mainContainer.find("#left-panel")),r={element:n.mainContainer.find("#left-panel")},t=n.banner=new bizagi.editor.component.banner.presenter({canvas:i,data:r});return t.subscribe("onBannerClick",function(t,i){n.onBannerClick(i)}),t.subscribe("onBannerOptionClick",function(t,i){n.onBannerOptionClick(i)}),t.render()},hideBanner:function(){var n=this;n.banner.hide()},showBanner:function(){var n=this;(n.controller.isFormContext()||n.controller.isStartFormContext())&&n.banner.show()},destroy:function(){var n=this},onBannerClick:function(){var n=this;n.performstore()},onBannerOptionClick:function(n){var t=this;typeof t["perform"+n.key]=="function"&&t["perform"+n.key]()},performstore:function(){var n=this,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"openwidgetstore"});$.when(t.processRequest()).done(function(t){if(t){var i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getwidgets"});$.when(i.processRequest()).done(function(t){t&&n.executeCommand({command:"loadWidgets",controls:t});n.destroy()})}})},performupload:function(){var n=this,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"installwidget"});$.when(t.processRequest()).done(function(){n.destroy()})}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{mappingContext:{grid:"form",offlinegrid:"offlineform"}},{drawGridColumnEditor:function(n){var t=this,i=n.element,r=$("#main-panel");t.controller.removeSelectedElement();$.when(t.executeCommand({command:"getGridColumnModel",guid:n.guid})).done(function(u){var f=t.gridcolumneditor=new bizagi.editor.component.gridcolumneditor.presenter({gridModel:u,guid:n.guid,renderArea:r}),e=i.offset();f.render({options:{top:e.top,left:e.left,height:i.outerHeight(),width:i.outerWidth()},guidSelected:t.controller.getGuidsSelected()});f.subscribe("moveColumn",function(n,i){t.onMoveGridColumn(i)});f.subscribe("insertControl",function(n,i){t.onInsertControlColumn(i)});f.subscribe("insertXpath",function(n,i){t.onInsertXpathColumn(i)});f.subscribe("selectColumn",function(n,i){t.onSelectGridColumn(i)});f.subscribe("unselectColumn",function(n,i){t.onUnselectGridColumn(i)});f.subscribe("showContextMenu",function(n,i){t.onShowGridColumnContextMenu(i)});f.subscribe("performChangesInModel",function(n,i){t.onPerformChangesInModel(i)});f.subscribe("performValidationsInModel",function(n,i){t.onPerformValidationsInModel(i)});f.subscribe("cancelChangesInModel",function(n,i){t.onCancelChangesInModel(i)});f.subscribe("checkCtrlKey",function(){return t.controller.isCtrlKeyPressed()});f.subscribe("processSelectedColumns",function(n,i){t.onProcessSelectedColumns(i)});f.subscribe("updateDesignAttributesColumn",function(n,i){t.onUpdateDesignAttributesColumn(i)})})},refreshGridColumnEditor:function(){var n=this,t=n.gridcolumneditor,i=n.controller.getGuidsSelected();t&&$.when(n.executeCommand({command:"getGridColumnModel",guid:t.getGuid()})).done(function(n){t.refresh({gridModel:n,guidSelected:i})})},onInsertXpathColumn:function(n){var r=this,t=n.data,i={command:"insertElementFromXpathNavigator",data:{context:t.context,renderType:t.renderType,nodeSubtype:t.nodeSubtype,name:t.displayName,xpath:bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity)},position:n.position,parent:n.guid};t.renderType.indexOf("adhoccolumn")!==-1&&(i.data.context="adhocgrid",i.data.displayName=t.displayName,t.parent&&(i.data.parent={guidRelatedEntity:t.parent.guidRelatedEntity}),t.guidRelatedEntity&&(i.data.guidRelatedEntity=t.guidRelatedEntity,i.data.entityContext=t.entityContext,t.predefinedValues&&(i.data.predefinedValues=t.predefinedValues)));r.executeCommand(i)},onInsertControlColumn:function(n){var i=this,t=n.data,r={command:"insertElementFromControlsNavigator",data:{renderType:t.name,name:t.name,displayName:t.displayName&&t.displayName.length>0?t.displayName:t.name},position:n.position,parent:n.guid};i.executeCommand(r)},onMoveGridColumn:function(n){var t=this,i={command:"moveElement",initialPosition:n.initialPosition,finalPosition:n.finalPosition,parent:n.guid};t.executeCommand(i)},onSelectGridColumn:function(n){var t=this,i=t.executeCommand({command:"getElementProperties",guid:n.guid});t.currentSelectedElement=n.guid;n.ctrlIsPressed===undefined&&t.controller.removeSelectedElement();t.controller.addSelectedElement(n.guid,n);$.when(t.showElementXpath(i.xpath)).done(function(){t.onDrawComponents(n)})},onShowGridColumnContextMenu:function(n){var t=this,i;t.controller.thereAreMultiselection()&&t.controller.getSelectedElements(n.guid)||(i=t.executeCommand({command:"getElementProperties",guid:n.guid}),t.contextmenu&&t.contextmenu.destroy(),$.when(t.showElementXpath(i.xpath)).done(function(){t.drawContextMenu({guid:n.guid,position:n.position})}))},onCancelChangesInModel:function(n){var t=this;t.executeCommand({command:"updateGridColumnModel",gridModel:n.gridModel,canUndo:!1});t.executeCommand({command:"changeContext",context:t.getContext()});t.currentSelectedElement=null;t.controller.removeSelectedElement()},onPerformChangesInModel:function(){var n=this;n.executeCommand({command:"changeContext",context:n.getContext()});n.currentSelectedElement=null;n.controller.removeSelectedElement()},onPerformValidationsInModel:function(){var n=this;n.currentSelectedElement=null;n.hidePropertyBox();n.onPerformChangesInModel();n.gridcolumneditor.destroy()},onUnselectGridColumn:function(n){var t=this;t.currentSelectedElement=null;n&&n.ctrlIsPressed!==undefined?t.controller.removeSelectedElement(n.guid):t.controller.removeSelectedElement();t.hidePropertyBox();t.refreshRibbon();t.destroyDecorator();t.onProcessSelectedColumns(n)},onDrawComponents:function(n){var t=this;t.controller.thereAreMultiselection()?(t.removeDecorator(),t.drawPropertyBox({guid:t.controller.getGuidsSelected()})):(t.hidePropertyBox(),t.refreshRibbon(n.guid),t.drawDecorator($.extend(n,{IsOnClickEvent:!0})))},onProcessSelectedColumns:function(n){var t=this,i,r;if(n=n||{},i=t.controller.getGuidsSelected(),i.length===1){r=t.controller.getSelectedElements(i[0]);t.controller.removeSelectedElement();t.onSelectGridColumn($.extend({IsOnClickEvent:!0},r))}else if(i.length>1)t.onDrawComponents(n)},onUpdateDesignAttributesColumn:function(n){var t=this;n.command="changeDesignAttributes";t.executeCommand(n)},getContext:function(){var n=this;return n.controller.getOriginalContext()}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawSearchResultEditor:function(){var n=this;$.when(n.executeCommand({command:"getSearchResultModel"})).done(function(t){var r=n.createSearchResultCanvas(),i=n.searchresulteditor=new bizagi.editor.component.searchresulteditor.presenter({searchResultModel:t,canvas:r});i.render();i.subscribe("moveColumn",function(t,i){n.onMoveColumn(i)});i.subscribe("insertXpath",function(t,i){n.onInsertXpath(i)});i.subscribe("selectColumn",function(t,i){n.onSelectColumn(i)});i.subscribe("unSelectColumn",function(t,i){n.onUnSelectColumn(i)})})},createSearchResultCanvas:function(){var n=this;return $("#search-result-panel .bz-fm-searchresult-content",n.mainContainer)},refreshSearchFormResult:function(){var n=this,t=n.searchresulteditor;t&&$.when(n.executeCommand({command:"getSearchResultModel"})).done(function(i){t.refresh({searchResultModel:i,currentSelectElement:n.currentSelectedElement})})},onInsertXpath:function(n){var i=this,t=n.data,r={command:"insertElementFromXpathNavigator",data:{renderType:t.renderType,name:t.displayName,displayName:t.displayName,xpath:bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity)},position:n.position,searchformresult:!0};i.executeCommand(r)},onMoveColumn:function(n){var t=this,i={command:"moveElement",initialPosition:n.initialPosition,finalPosition:n.finalPosition,elementType:"searchresult"};t.executeCommand(i)},onSelectColumn:function(n){var t=this,i=t.executeCommand({command:"getElementProperties",guid:n.guid});t.hidePropertyBox();t.refreshRibbon(n.guid);t.currentSelectedElement=n.guid;t.drawDecorator($.extend(n,{IsOnClickEvent:!0}),!0);t.showElementXpath(i.xpath)},onUnSelectColumn:function(){var n=this;n.currentSelectedElement=null;n.hidePropertyBox();n.removeDecorator()}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawButtonEditor:function(){var n=this;$.when(n.executeCommand({command:"getButtonModel"})).done(function(t){var i=n.createButtonEditorCanvas(),r=n.buttoneditor=new bizagi.editor.component.buttoneditor.presenter({buttonModel:t,canvas:i});r.render({isReadOnly:n.controller.isReadOnlyForm(),allowAddButtons:n.controller.isFormContext()});n.attachHandlersButtonEditor();n.refreshButtonEditor()})},attachHandlersButtonEditor:function(){var n=this,t=n.buttoneditor;n.controller.isReadOnlyForm()||(t.subscribe("selectButton",function(t,i){n.onSelectButton(i)}),t.subscribe("unselectButton",function(t,i){n.onUnselectButton(i)}),t.subscribe("addButton",function(t,i){n.onAddButton(i)}),t.subscribe("moveButton",function(t,i){n.onMoveButton(i)}))},refreshButtonEditor:function(){var n=this,i=n.buttoneditor,r=n.controller.getContextInfo().guid,t=n.executeCommand({command:"getElementProperty",guid:r,property:"usecustombuttons"});t=t||n.controller.isStartFormContext();t?(n.showButtonEditor(),i&&$.when(n.executeCommand({command:"getButtonModel"})).done(function(t){var r=n.controller.getGuidsSelected()[0]?n.controller.getSelectedElements(n.controller.getGuidsSelected()[0]):null;i.refresh({buttonModel:t,options:{element:r},isReadOnly:n.controller.isReadOnlyForm(),allowAddButtons:n.controller.isFormContext()})})):n.hideButtonEditor()},showButtonEditor:function(){$(".wrapper-main-panel").addClass("bz-form-buttons-enabled")},hideButtonEditor:function(){$(".wrapper-main-panel").removeClass("bz-form-buttons-enabled")},createButtonEditorCanvas:function(){var n=this;return $("#button-editor-panel",n.mainContainer)},onSelectButton:function(n){var t=this;t.currentSelectedElement=n.guid;t.controller.removeSelectedElement();t.controller.addSelectedElement(n.guid,n);t.hidePropertyBox();t.refreshRibbon(n.guid);t.controller.isFormContext()?t.drawDecorator($.extend(n,{IsOnClickEvent:!0})):t.drawPropertyBox({guid:n.guid});t.applyCopyFormat(n.guid)},onUnselectButton:function(){var n=this;n.currentSelectedElement=null;n.hidePropertyBox();n.refreshRibbon();n.removeDecorator()},onAddButton:function(){var n=this;n.hidePropertyBox();n.removeDecorator();n.executeCommand({command:"insertButton"})},onMoveButton:function(n){var t=this,i={command:"moveElement",initialPosition:n.initialPosition,finalPosition:n.finalPosition,elementType:"button"};t.executeCommand(i)}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{configureRenderingView:function(){var n=this,t=n.controller.getRenderingModel(),i={data:t,canvas:n.mainContainer.find("#main-panel"),mode:n.renderingMode};return n.loadFormDeferred=new $.Deferred,n.renderingView=new bizagi.rendering.facade,bizagi.log("Rendering with ...",t),n.renderingView.subscribe("sortstart",function(){n.onRenderingViewSortStart()}),n.renderingView.subscribe("sortfinish",function(t,i){n.onRenderingViewSortFinish(i)}),n.renderingView.subscribe("unselectelement",function(t,i){n.onRenderingViewElementUnselected(i)}),n.renderingView.subscribe("selectelement",function(t,i){n.onRenderingViewElementSelected(i)}),n.renderingView.subscribe("canChangeLabel",function(){return!0}),n.renderingView.subscribe("startlabeledition",function(){n.onRenderingViewStartLabelEdition()}),n.renderingView.subscribe("changelabel",function(t,i){n.onRenderingViewElementChangeLabel(i)}),n.renderingView.subscribe("elementrightclick",function(t,i){n.onRenderingViewElementRightClick(i)}),n.renderingView.subscribe("addtab",function(t,i){n.onRenderingViewTabAdd(i)}),n.renderingView.subscribe("deletetab",function(t,i){n.onRenderingViewTabDelete(i)}),n.renderingView.subscribe("activatetab",function(t,i){n.onRenderingViewTabActivate(i)}),n.renderingView.subscribe("showsearchform",function(t,i){n.onRenderingShowSearchForm(i)}),n.renderingView.subscribe("showProperties",function(t,i){n.onRenderingShowProperties(i)}),n.renderingView.subscribe("showPropertiesForm",function(t,i){n.onRenderingShowPropertiesForm(i)}),n.renderingView.subscribe("controlRefreshCanvas",function(t,i){n.refreshCanvas(i)}),n.renderingView.subscribe("selectcontainerform",function(t,i){n.onRenderingSelectForm(i)}),n.renderingView.subscribe("checkCtrlKey",function(t,i){return n.onCheckCtrlKey(i)}),n.renderingView.subscribe("resizeImage",function(t,i){return n.onResizeImage(i)}),n.renderingView.subscribe("refreshControl",function(t,i){return n.onRefreshControl(i)}),n.renderingView.subscribe("getparentid",function(t,i){return n.onGetParentId(i)}),n.renderingView.subscribe("getLastInsertedElement",function(){return n.onGetLastInsertedElement()}),n.renderingView.subscribe("getControlIcon",function(t,i){return n.onGetControlIcon(i)}),n.renderingView.subscribe("setLastInsertedElement",function(t,i){n.onSetLastInsertedElement(i)}),$.when(n.renderingView.execute(i)).done(function(t){n.formContainer=t;n.loadFormDeferred.resolve();setTimeout(function(){n.applyThemeToRendering()},100);$(document).ready(function(){n.applyThemeToRendering()});$(window).bind("resize.rendering",function(){n.applyThemeToRendering()})}),n.loadFormDeferred.promise()},applyThemeToRendering:function(){var n=this,t,e,r,u,f,i;r=n.mainContainer.find("#main-panel");e=$(".wrapper-main-scroll");t=$("> .ui-bizagi-container-form",r);n.renderingMode==="layout"?$("#main-panel").addClass("bz-main-layout-mode"):n.renderingMode==="design"&&$("#main-panel").removeClass("bz-main-layout-mode");t.children().length===0&&t.append('<div class="children"><\/div>');t.addClass("biz-form").addClass("biz-draft-border");n.renderingView.publish("controlRefreshCanvas");$(".ui-bizagi-container-form > .children").attr("drophere",bizagi.localization.getResource("formmodeler-component-editor-layout-drophere-containers"));u=".ui-bizagi-container-panel, .ui-bizagi-container-group, .ui-bizagi-container-nestedform, .ui-bizagi-container-horizontal, .ui-col > .children, .ui-bizagi-container-tab, .ui-bizagi-render:last, .ui-bizagi-render:first";$(u).attr("drophere",bizagi.localization.getResource("formmodeler-component-editor-layout-drophere"));$(".ui-drop-here-layout").attr("drophere",bizagi.localization.getResource("formmodeler-component-editor-layout-drophere"));f=$('<style id="drophere"><\/style>');$("#drophere").length===0&&(i=$("head"),i.append(f),$("#drophere",i).append('.ui-bizagi-placeholder:before,  #bz-fm-grid-columneditor[class*="drop-here"]:before {content:"'+bizagi.localization.getResource("formmodeler-component-editor-layout-drophere")+'"}'))},createMsgValidationTooltip:function(){var n=this,t=n.mainContainer.find("#main-panel");$(".ui-bizagi-render-icon-editor-msg-validation[title], .ui-bizagi-container-icon-editor-msg-validation-templates[title]",t).tooltip({tooltipClass:"ui-widget-content ui-msg-validation-tooltip",content:function(){var n=$(this),t;return n[0]&&n[0].attributes["data-title"]?n[0].attributes["data-title"].value:n[0]&&n[0].title?(t=n[0].title,n[0].title="",t):void 0}})},formIsLoaded:function(){var n=this;return n.loadFormDeferred},removeMsgValidationTooltip:function(){var n=this,t=n.mainContainer.find("#main-panel");$(".ui-msg-validation-tooltip",t).remove()},refreshRenderingView:function(n,t){var i=this;typeof i.renderingView!="undefined"&&(t=t||i.renderingMode,i.renderingMode=t,i.showRenderingModel())},showRenderingModel:function(){var n=this;$.when(n.controller.getRenderingModel()).done(function(t){var i={data:t,mode:n.renderingMode,focus:n.currentFocus};bizagi.log("Rendering with ...",t);$.when(n.renderingView.update(i)).done(function(t){n.formContainer=t;n.renderingMode==="design"&&t.selectElementByGuid(n.controller.getGuidsSelected());n.controller.isTemplateContext()?n.applyThemeToTemplates():n.applyThemeToRendering();n.validateForm&&(n.removeMsgValidationTooltip(),n.createMsgValidationTooltip())})})},setCurrentFocus:function(n){var t=this;t.currentFocus=n},isLayoutMode:function(){var n=this;return n.renderingMode==="layout"},processSelectedElements:function(n){var t=this,i=t.controller.getGuidsSelected();if(i.length===1){n=t.controller.getSelectedElements(i[0]);t.controller.removeSelectedElement();t.onRenderingViewElementSelected($.extend({IsOnClickEvent:!0},n))}else i.length>1&&t.drawComponents()},drawComponents:function(n){var t=this,i;n=n||{};i=n.args;t.controller.thereAreMultiselection()?(t.removeDecorator(),i&&!i.IsOnClickEvent||t.drawPropertyBox({guid:t.controller.getGuidsSelected()}),t.refreshRibbon()):(t.drawDecorator(i),t.refreshRibbon(i.guid),t.applyCopyFormat(i.guid))},deleteElement:function(){var n=this,t=n.controller.getGuidsSelected();t&&(n.hidePropertyBox(),n.executeCommand({command:"removeElementById",guids:t}),n.currentSelectedElement=null)},onRenderingViewSortStart:function(){var n=this;n.hidePropertyBox();$("#main-panel").addClass("bz-main-dashed-grid")},onRenderingViewSortFinish:function(n){var t=this;$("#main-panel").removeClass("bz-main-dashed-grid");n.source&&n.source.toolbar?t.executeCommand({command:"insertElementFromControlsNavigator",position:n.finalPosition,parent:n.targetContainer,data:n.source.data}):n.source&&n.source.xpathNavigator?(n.source.data.xpath=bizagi.editor.utilities.buildComplexXpath(n.source.data.xpath,n.source.data.contextScope,n.source.data.isScopeAttribute,n.source.data.guidRelatedEntity),t.executeCommand({command:"insertElementFromXpathNavigator",position:n.finalPosition,parent:n.targetContainer,data:n.source.data})):n.source&&n.source.layout?t.executeCommand({command:"createAndInsertControlLayoutInModel",position:n.finalPosition,parent:n.targetContainer,id:n.source.data}):n.sourceContainer===n.targetContainer?n.initialPosition!==n.finalPosition&&t.executeCommand({command:"moveElement",initialPosition:n.initialPosition,finalPosition:n.finalPosition,parent:n.targetContainer}):t.executeCommand({command:"moveElementContainer",posIni:n.initialPosition,posEnd:n.finalPosition,parentSource:n.sourceContainer,parentTarget:n.targetContainer})},onRenderingViewElementUnselected:function(n){var t=this;t.currentSelectedElement=null;n&&n.ctrlIsPressed!==undefined?t.controller.removeSelectedElement(n.guid):t.controller.removeSelectedElement();t.hidePropertyBox();t.removeDecorator();t.refreshRibbon();t.processSelectedElements(n)},onRenderingSelectForm:function(){var n=this;n.drawPropertyBox({formProperties:!0})},onRenderingViewElementSelected:function(n){var t=this,i=t.executeCommand({command:"getElementProperties",guid:n.guid}),r={args:n,decorator:!0,ribbon:!0,copyFormat:!0};n.IsOnClickEvent?(t.currentSelectedElement=n.guid,n.ctrlIsPressed===undefined&&t.controller.removeSelectedElement(),t.controller.addSelectedElement(n.guid,n),n.type=="nestedForm"?(t.showElementGuid(i.form,i.xpath),t.drawComponents(r)):n.isInternal?(t.showMetadataXpath(i.xpath),t.drawComponents(r)):$.when(t.showElementXpath(i.xpath)).done(function(){t.drawComponents(r)})):t.drawComponents(r)},applyCopyFormat:function(n){var i=this,r,t;i.controller.copyFormatHasElement()&&(t=i.controller.getCopyFormatElement(),t.guid!==n&&(t=i.controller.popCopyFormat(),r={command:"changeProperty",guid:n,property:"format"},t.properties!==undefined?$.extend(r,{value:bizagi.clone(t.properties)}):$.extend(r,{value:bizagi.clone({})}),i.executeCommand(r)))},onRenderingViewStartLabelEdition:function(){var n=this;n.hidePropertyBox()},onRenderingViewElementChangeLabel:function(n){var t=this;t.executeCommand({command:"changeProperty",guid:n.guid,property:"displayName",value:n.value})},onRenderingViewElementRightClick:function(n){var t=this,i;t.controller.thereAreMultiselection()&&t.controller.getSelectedElements(n.guid)||(i=t.executeCommand({command:"getElementProperties",guid:n.guid}),t.contextmenu&&t.contextmenu.destroy(),$.when(t.showElementXpath(i.xpath)).done(function(){t.drawContextMenu({guid:n.guid,position:n.position})}))},onRenderingViewTabAdd:function(n){var t=this,i=t.executeCommand({command:"insertTabItem",tab:n.guid});setTimeout(function(){t.onRenderingViewTabActivate(i)},100)},onRenderingViewTabDelete:function(n){var t=this;t.executeCommand({command:"removeElementById",guid:n.guid})},onRenderingViewTabActivate:function(n){var t=this;t.setCurrentFocus(n.guid);t.currentSelectedElement=null;t.refresh()},onRenderingShowSearchForm:function(n){var i=this,t=i.executeCommand({command:"getElementProperties",guid:n.guid});t&&t.searchforms&&$.isArray(t.searchforms)&&i.performSelectFormButton({value:t.searchforms})},onRenderingShowPropertiesForm:function(){var n=this;n.performShowFormProperties()},onRenderingShowProperties:function(n){var t=this;t.drawPropertyBox(n)},onCheckCtrlKey:function(){var n=this;return!n.isLayoutMode()&&n.controller.isCtrlKeyPressed()?!0:!1},onResizeImage:function(n){var t=this;t.executeCommand({command:"changeMultipleProperties",guid:n.guid,properties:n.properties,refreshProperties:!0})},onGetRenderElement:function(n){var t=this;return t.formContainer?t.formContainer.getRenderById(n.id):null},refreshElement:function(n){var i=this,t,r,u={},f;i.formContainer&&n.container&&(f=n.container,t=f.properties.id,$.isArray(u[t])||(u[t]=[]),u[t].push(1),r=i.formContainer.getRenderById(t),r&&(r.refreshDesignContainer(n),i.refreshCanvas()))},onRefreshControl:function(n){var t=this;t.executeCommand({command:"refreshControl",guid:n.guid,canvas:n.canvas})},onGetParentId:function(n){var t=this,i=t.controller.model.getElement(n.guid);return i.parent.guid},onSetLastInsertedElement:function(n){var t=this;t.controller.setLastInsertedElement(n)},onGetLastInsertedElement:function(){var n=this;return n.controller.getLastInsertedElement()},onGetControlIcon:function(n){var t=this,i=t.controller.model.getElement(n.id)||{style:"bz-studio bz-layout-full_16x16_standard"};return i.style}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{configureTemplateView:function(){var n=this,t=n.controller.getRenderingModel(),i={data:t,canvas:n.mainContainer.find("#main-panel"),mode:n.renderingMode};n.renderingView=new bizagi.rendering.facade;bizagi.log("Rendering with ...",t);n.renderingView.subscribe("dropfinish",function(t,i){if(i.sourceGuid)n.onRenderingReplaceAndRestoreElement(i);else n.onRenderingViewUpdateElement(i)});n.renderingView.subscribe("changelabel",function(t,i){if(i.value){$.extend(i,{property:"displayName",renderType:"label"});i.value=bizagi.editor.utilities.buildComplexLocalizable(i.value,i.guid,"displayName");n.onRenderingViewUpdateElement(i)}else n.refresh()});n.renderingView.subscribe("deleteRepeaterItem",function(t,i){n.onDeleteRepeaterItem(i)});n.renderingView.subscribe("unselectelement",function(t,i){n.onRenderingViewElementUnselected(i)});n.renderingView.subscribe("selectelement",function(t,i){n.onRenderingViewElementSelected(i)});n.renderingView.subscribe("selectcontainerform",function(t,i){n.onRenderingSelectForm(i)});n.renderingView.subscribe("canChangeLabel",function(t,i){return n.onTemplateChangeLabel(i)});n.renderingView.subscribe("restoreItem",function(t,i){n.onRestoreItem(i)});n.renderingView.subscribe("isDeleteOptionAllowed",function(t,i){return n.onIsDeleteOptionAllowed(i)});n.renderingView.subscribe("controlRefreshCanvas",function(t,i){setTimeout(function(){n.refreshCanvas(i)},0)});n.renderingView.subscribe("hideElement",function(t,i){n.onHideElement(i)});$.when(n.renderingView.execute(i)).done(function(t){n.formContainer=t;n.applyThemeToTemplates();$(document).ready(function(){n.applyThemeToTemplates()});$(window).resize(function(){n.applyThemeToTemplates()})})},applyThemeToTemplates:function(){var n=this,t,r,i;i=n.mainContainer.find("#main-panel");r=$(".wrapper-main-scroll");t=$("> .bz-design-template",i);n.renderingMode==="layout"?$("#main-panel").addClass("bz-main-layout-mode"):n.renderingMode==="design"&&$("#main-panel").removeClass("bz-main-layout-mode");t.children().length===0&&t.append('<div class="children"><\/div>');t.addClass("biz-form").addClass("biz-draft-border");n.renderingView.publish("controlRefreshCanvas")},onRenderingReplaceAndRestoreElement:function(n){var t=this;t.executeCommand($.extend({command:"replaceAndRestoreElement"},n))},onRenderingViewUpdateElement:function(n){var t=this;t.executeCommand($.extend({command:"updateElement"},n))},onDeleteRepeaterItem:function(n){var t=this;t.executeCommand($.extend({command:"deleteRepeaterItem"},n))},onTemplateChangeLabel:function(n){var t=this,i=t.executeCommand({command:"getElementProperties",guid:n.guid});return i.type!=":image"},onRestoreItem:function(n){var t=this;t.executeCommand({command:"updateElement",guid:n.guid,renderType:"layoutPlaceholder",toInitialState:!0})},onIsDeleteOptionAllowed:function(n){var i=this,r=i.controller.getModel(),t=r.getElement(n.guid);return t?t.type=="layoutPlaceholder"?!1:t.properties.type&&t.properties.type.search(/image/ig)>=0?!1:!0:!1},onHideElement:function(n){var t=this;t.executeCommand({command:"changeProperty",guid:n.guid,property:"hide",value:!0})}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawSelectFormEditor:function(n){var t=this,r;t.decorator.canvas.find(".bizagi_editor_component_editor_form").detach();var u=t.decorator.canvas.find(".editor-ui-actions-container"),f=$("<div />").appendTo(u),i=$.extend(t.executeCommand({command:"getSelectFormModel",guid:n.guid,property:n.property}),{caption:n.caption});t.getRelatedForms(i);r=t.formSelector=new bizagi.editor.component.editor.form.presenter({canvas:f,model:i});r.render()},getRelatedForms:function(n){if(typeof n.xpath=="object"){var t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"relatedforms",xpath:bizagi.editor.utilities.resolveComplexXpath(n.xpath),context:n.context});$.when(t.processRequest()).done(function(t){t&&(n.relatedForms=t)})}}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawLayoutNavigator:function(){var n=this,t=$("<div />").addClass("bizagi_editor_layoutnavigator_container").appendTo(n.mainContainer.find("#left-tab-layout"));$.when(n.controller.getLayoutNavigatorModel()).pipe(function(i){var r=n.layoutNavigator=new bizagi.editor.component.layoutnavigator.presenter({canvas:t,model:i});return n.attachHandlersLayoutNavigator(),r.render({isReadOnly:n.controller.isReadOnlyForm()})})},attachHandlersLayoutNavigator:function(){var n=this,t=n.layoutNavigator;n.controller.isReadOnlyForm()||(t.subscribe("layoutDoubleClick",function(t,i){n.onLayoutDoubleClick(i)}),t.subscribe("controlRefreshCanvas",function(t,i){n.refreshCanvas(i)}))},onLayoutDoubleClick:function(n){var t=this,i={command:"addControlLayoutInModel",id:n.id};t.executeCommand(i)},refreshLayoutNavigator:function(){var n=this;$.when(n.controller.getLayoutNavigatorModel()).done(function(t){n.layoutNavigator.render({model:t,isReadOnly:n.controller.isReadOnlyForm()})})}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawRibbon:function(){var n=this,i=$("<div />").appendTo(n.mainContainer.find("#ribbon-panel")),r=n.executeCommand({command:"getRibbonModel",validFormChecked:n.validateForm}),t=n.ribbon=new bizagi.editor.component.ribbon.presenter({canvas:i,model:r});return t.subscribe("onItemClicked",function(i,r){n.onItemRibbonClick($.extend(r,{guid:t.getGuid()}))}),t.render()},refreshRibbon:function(n){var t=this;t.controller.thereAreMultiselection()&&(n=bizagi.editor.utilities.getGuidEmpty());n=n||t.currentSelectedElement;$.when(t.executeCommand({command:"getConvertToModel",guid:n})).done(function(i){var r=t.executeCommand({command:"getRibbonModel",guid:n,convertToModel:i,validFormChecked:t.validateForm});t.ribbon&&t.ribbon.render({model:r,guid:n})})},onItemRibbonClick:function(n){var t=this,i=n.action;n.property&&n.value&&!n.action&&(n.value!="expression"?t.executeCommand({command:"changeProperty",guid:n.guid,property:n.property,value:n.value}):t.showExpressionSelector(n.property,n.guid));i=="undo"&&t.performUndo();i=="redo"&&t.performRedo();i=="save"&&t.performSave();i=="copy-from"&&t.performCopyFrom();i=="switchForm"&&t.performSwitchForm();i=="setuseoffline"&&t.performSetUseOffline();i=="copy-format"&&t.performCopyFormat(n);i=="actionsvalidations"&&t.performShowActionsValidations();i=="formproperties"&&t.performShowFormProperties();i=="delete"&&t.performDelete(n.guid);i=="rename"&&t.performRename(n.guid);i=="validate"&&t.performValidate();i=="Language"&&t.performChangeEditorLanguage(n);i=="useCustomButtons"&&t.enableOrDisableCustomButtons(n);i=="checkout"&&t.performCheckout(n);i=="useOfflineForm"&&t.enableOrDisableOfflineFormOption(n);i=="offlineAsOnline"&&t.performSetOfflineAsOnline(n);i=="emailTemplate"&&t.performEmailTemplate(n);i=="convert"&&t.performConvertTo(n)},performConvertTo:function(n){var t=this;t.executeCommand({command:"convertTo",guid:n.guid,convertTo:n.property})},performUndo:function(){var n=this;n.undo()},performRedo:function(){var n=this;n.redo()},performSave:function(n){var t=this;t.dialog||$.when(t.processValidations({canRefresh:!0})).done(function(i){if(t.controller.thereAreChangesInForm()||!t.controller.isReadOnlyForm()&&i.showMessage)if(i.showMessage||n){t.dialog=new bizagi.editor.component.dialog.presenter;var r={name:"bz-dialog-perfomsave",title:t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-dialog-save"):bizagi.localization.getResource("bizagi-editor-form-dialog-save"),message:i.showMessage?t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-save-warning-message"):bizagi.localization.getResource("bizagi-editor-form-save-warning-message"):t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-save-message"):bizagi.localization.getResource("bizagi-editor-form-save-message"),buttons:[{text:bizagi.localization.getResource("bizagi-editor-form-dialog-yes"),legend:t.getLegendYesOption({showMessage:i.showMessage,close:n}),style:"bz-studio bz-yes-no_16x16_standard",click:function(){$.when(t.saveForm()).done(function(){n&&t.closeForm()})}},{text:bizagi.localization.getResource("bizagi-editor-form-dialog-no"),legend:t.getLegendNoOption({showMessage:i.showMessage,close:n}),style:"bz-studio bz-false_16x16_standard",click:function(){n&&t.closeForm()}}]};t.addCancelButton({showMessage:i.showMessage,close:n,model:r});$.when(t.dialog.show({data:r})).done(function(n){setTimeout(function(){typeof n=="function"&&n.call(t);t.dialog=null},0)})}else t.saveForm();else n&&t.closeForm()})},performCopyFrom:function(){var n=this,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"copyform"});$.when(t.processRequest()).done(function(t){t&&n.executeCommand({command:"insertElements",data:t})})},performCopyFormat:function(n){var t=this;t.executeCommand({command:"copyFormat",guid:n.guid})},performSwitchForm:function(){var n=this;n.dialog||$.when(n.processValidations({canRefresh:!0})).done(function(t){if(n.controller.thereAreChangesInForm()||t.showMessage)if(t.showMessage){n.dialog=new bizagi.editor.component.dialog.presenter;var i={name:"bz-dialog-perfomsave",title:bizagi.localization.getResource("bizagi-editor-form-dialog-save"),message:t.showMessage?bizagi.localization.getResource("bizagi-editor-form-save-warning-message"):bizagi.localization.getResource("bizagi-editor-form-save-message"),buttons:[{text:bizagi.localization.getResource("bizagi-editor-form-dialog-yes"),legend:n.getLegendYesOption({showMessage:t.showMessage,close:!1}),style:"bz-studio bz-yes-no_16x16_standard",click:function(){$.when(n.saveForm()).done(function(){n.switchForm()})}},{text:bizagi.localization.getResource("bizagi-editor-form-dialog-no"),legend:n.getLegendNoOption({showMessage:t.showMessage,close:!1}),style:"bz-studio bz-black bz-false_16x16_black",click:function(){n.switchForm()}}]};n.addCancelButton({showMessage:t.showMessage,close:!0,model:i});$.when(n.dialog.show({data:i})).done(function(t){setTimeout(function(){typeof t=="function"&&t.call(n);n.dialog=null},0)})}else $.when(n.saveForm()).done(function(){n.switchForm()});else n.switchForm()})},performSetUseOffline:function(){var t=this,n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"setuseoffline"});$.when(n.processRequest()).done(function(){})},performShowActionsValidations:function(){var n=this;n.drawCommandsEditor()},performShowFormProperties:function(){var n=this;n.drawPropertyBox({formProperties:!0})},performDelete:function(n){var t=this;t.hidePropertyBox();t.executeCommand({command:"removeElementById",guid:n})},performRename:function(n){var t;t=$('[guid="'+n+'"]');t.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||$("label",t).trigger("dblclick")},performValidate:function(){var n=this;n.validateForm=!n.validateForm;n.validateForm?n.controller.isTemplateContext()?n.processTemplateValidations({canRefresh:!0}):n.processValidations({canRefresh:!0}):n.removeValidations({canRefresh:!0})},performChangeEditorLanguage:function(n){var t=this;n.canValidate=!0;bizagi.editorLanguage=n.value;t.refresh(n)},performSetOfflineAsOnline:function(){var t=this,n=t.controller.isOfflineAsOnline(),i;n=!n;i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"setuseoffline",value:n});$.when(i.processRequest()).done(function(i){i&&(t.controller.setOfflineAsOnline(n),t.refreshRibbon())})},enableOrDisableOfflineFormOption:function(){var n=this,i=n.controller.getContextInfo().guid,t=n.executeCommand({command:"getElementProperty",guid:i,property:"useofflineform"});t=t||!1;n.executeCommand({command:"changeProperty",guid:i,property:"useofflineform",value:!t})},performEmailTemplate:function(){var n=this,i=n.controller.getContextInfo().guid,t=n.executeCommand({command:"getElementProperty",guid:i,property:"emailintegration"}),r;bizagi.log("VALUE "+t);r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadtemplate",template:t?t:{baref:{ref:"template"}}});$.when(r.processRequest()).done(function(t){t&&!t.isEmpty&&n.executeCommand({command:"changeProperty",guid:i,property:"emailintegration",value:t})})},enableOrDisableCustomButtons:function(){var t=this,i=t.controller.getContextInfo().guid,n=t.executeCommand({command:"getElementProperty",guid:i,property:"usecustombuttons"}),r=t.controller.getRibbonModel(),u;n==!0?(u=bizagi.localization.getResource("formmodeler-component-ribbon-useCustomButtons-validation"),$.when(bizagi.showConfirmationBox(u,"Bizagi","warning")).done(function(){n=n||!1;r.hideGroup("email");t.executeCommand({command:"changeProperty",guid:i,property:"usecustombuttons",value:!n});t.executeCommand({command:"changeProperty",guid:i,property:"useemailoption",value:!n})})):(n=n||!1,r.showGroup("email"),t.executeCommand({command:"changeProperty",guid:i,property:"usecustombuttons",value:!n}),t.executeCommand({command:"changeProperty",guid:i,property:"useemailoption",value:!n}))},performCheckout:function(){var n=this;$.when(n.checkStatusForm()).done(function(t){t.isInCheckout?n.showUserInformation():n.checkoutForm()})},saveForm:function(){var n=this,t=$.Deferred(),i=$("#container-layout");return $.when(n.executeCommand({command:"saveModel"})).done(function(r){var f={message:bizagi.localization.getResource("formmodeler-component-wait-message-save")},u=new bizagi.editor.component.wait.presenter({model:f,renderArea:i});$.when(u.render()).done(function(){var i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"saveform",jsonForm:r});setTimeout(function(){$.when(i.processRequest()).done(function(){n.controller.setNewForm(!1);n.refreshRibbon();n.refreshPropertyBox();u.destroy();t.resolve()})},200)})}),t.promise()},closeForm:function(){var n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"closeform"});$.when(n.processRequest()).done(function(){})},switchForm:function(){var n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"switchform"});$.when(n.processRequest()).done(function(){})},addCancelButton:function(n){var t=this;n.close&&n.model.buttons.push({text:bizagi.localization.getResource("bizagi-editor-form-dialog-cancel"),style:"bz-studio bz-error_16x16_standard",legend:t.getLegendCancelOption(n)})},getLegendYesOption:function(n){var t=this;return n.showMessage&&n.close?t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-dialog-yes-errors-close-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-yes-errors-close-legend"):n.showMessage?t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-dialog-yes-errors-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-yes-errors-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-yes-legend")},getLegendNoOption:function(n){var t=this;return n.showMessage&&n.close?t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-dialog-no-errors-close-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-no-errors-close-legend"):n.showMessage?bizagi.localization.getResource("bizagi-editor-form-dialog-no-errors-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-no-legend")},getLegendCancelOption:function(n){return n.showMessage&&n.close?bizagi.localization.getResource("bizagi-editor-form-dialog-cancel-errors-legend"):n.close?bizagi.localization.getResource("bizagi-editor-form-dialog-cancel-legend"):""},checkStatusForm:function(){var n=new $.Deferred,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getstatusform"});return $.when(t.processRequest()).done(function(t){t=t||{};n.resolve(t)}),n.promise()},showUserInformation:function(){var n=this,t=new bizagi.editor.component.dialog.presenter,i={name:"bz-dialog-perfomsave",title:bizagi.localization.getResource("bizagi-editor-form-dialog-userinfo"),message:n.getUserInfo(),date:n.getDateInfo()};t.show({data:i})},getUserInfo:function(){var n=this,t=n.controller.getUserInfo(),i=bizagi.localization.getResource("bizagi-editor-form-dialog-userinfo-message");return i.replace("{0}",t.userName)},getDateInfo:function(){var n=this,t=n.controller.getUserInfo();return $.timeago(t.CheckOutDate)},checkoutForm:function(){var n=this,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"checkoutform",loadForm:!0});$.when(t.processRequest()).done(function(t){t=t||{};t.userInfo&&(n.controller.setReadOnlyFlag(t.isInCheckout),n.controller.setUserInfo(t.userInfo));t.form&&(n.attachHandlersComponents(),n.load(t.form),n.controller.setOriginalModel(),n.refresh())})},attachHandlersComponents:function(){var n=this;n.controller.isActivityForm()&&(n.attachHandlersButtonEditor(),n.refreshButtonEditor());n.attachHandlersControlsNavigator();n.refreshControlsNavigator();n.attachHandlersLayoutNavigator();n.refreshLayoutNavigator();n.attachHandlersXpathNavigator();n.refreshXpathNavigator()}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawContextMenu:function(n){var t=this;$.when(t.executeCommand({command:"getConvertToModel",guid:n.guid})).done(function(i){t.destroy();var u=t.executeCommand({command:"getContextMenuModel",guid:n.guid,convertToModel:i}),r=t.contextmenu=new bizagi.editor.component.contextmenu.presenter({model:u,guid:n.guid});return r.subscribe("onItemClicked",function(n,i){t.onContextMenuItemClicked(r,i)}),r.render({position:n.position})})},onContextMenuItemClicked:function(n,t){var i=this;i.hidePropertyBox();t.property&&t.value&&(i.controller.isOfflineContext()?i.executeCommand({command:"changeProperty",guid:n.guid,property:t.property,value:t.value}):typeof t.value=="object"&&t.value.fixedvalue?i.executeCommand({command:"changeProperty",guid:n.guid,property:t.property,value:t.value}):(t.value=bizagi.editor.utilities.buildComplexReference(t.value),i.performShowRuleSelector({type:t.property,id:n.guid,newValue:t.value,categorytype:"Boolean",data:t.value})));t.action&&(t.action=="delete"&&i.executeCommand({command:"removeElementById",guid:n.guid}),t.action=="rename"&&i.showElementLabelEditor(n.guid),t.action=="convertTo"&&i.executeCommand({command:"convertTo",guid:n.guid,convertTo:t.value}),t.action=="properties"&&i.showPropertyBox(n.guid))},showExpressionSelector:function(n,t){var r=this,u=r.controller.getModel(),f=u.getElement(t),e=f.getProperty(n)||{},i={};i.data=e.rule||{rule:{baref:{ref:"expression"}}};i.type=n;i.categorytype="Boolean";r.performShowRuleSelector(i)},showElementLabelEditor:function(n){var t=this.formContainer.getRenderById(n);t&&t.showElementLabelEditor&&t.showElementLabelEditor()},showPropertyBox:function(n){var t=this,i=$('[guid="'+n+'"]');t.drawPropertyBox({guid:n})},destroy:function(){var n=this;n.contextmenu&&n.contextmenu.destroy()}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{map:{columnsearchlist:"searchlist"}},{drawPropertyBox:function(n){var t=this;t.propertyBox&&t.hidePropertyBox();t.redrawPropertyBox=n.redraw?n.redraw:!1;t.propertyBox=new bizagi.editor.component.properties.presenter;t.propertyBox.subscribe("propertyChanged",function(n,i){return t.onPropertiesChanged(i)});t.propertyBox.subscribe("getRenderElement",function(n,i){return t.onGetRenderElement(i)});t.propertyBox.subscribe("destroy",function(n,i){t.hidePropertyBox(i)});t.editorValidations={};t.guid=n.guid||t.currentSelectedElement;t.formProperties=n&&n.formProperties?!0:!1;t.refreshPropertyBox()},refreshPropertyBox:function(){var n=this,t;if(n.validElement()){if(n.formProperties)t=n.executeCommand({command:"getFormPropertiesModel",showValidations:n.validateForm});else if(n.guid)n.controller.thereAreMultiselection()?t=n.executeCommand({command:"getMultiselectionProperties",showValidations:n.validateForm}):(n.executeCommand({command:"applyOverridesElement",guid:n.guid,overrides:{requiredProperties:!0}}),t=n.executeCommand({command:"getPropertiesModel",guid:n.guid,showValidations:n.validateForm}));else{n.propertyBox&&n.propertyBox.propertyBox&&n.propertyBox.propertyBox.element&&n.propertyBox.propertyBox.element.hide();return}n.propertyBox.render({model:t,position:{left:10,top:135},redraw:n.redrawPropertyBox})}},validElement:function(){var n=this,t;return n.propertyBox?n.formProperties?!0:$.isArray(n.guid)?!0:(t=n.executeCommand({command:"getElementProperties",guid:n.guid}),!t)?!1:!0:!1},onPropertiesChanged:function(n){var t=this;if(typeof t["perform"+n.typeEvent]=="function")return t["perform"+n.typeEvent](n)},hidePropertyBox:function(){var n=this;n.propertyBox&&n.propertyBox.destroy();n.propertyBox=null},showXpathEditor:function(n){var t=this,i=t.executeCommand({command:"getElementProperties",guid:n.guid}),r;typeof i.xpath=="object"&&t.changeXpathNavigatorView(i.xpath);r=n.model||t.controller.getXpathNavigatorModel({context:n.context});$.when(r).done(function(r){$.extend(r,{context:t.controller.getContext()});var u=new bizagi.editor.component.xpathnavigator.presenter({model:r}),f=bizagi.editor.utilities.resolveProperty(i,n.property);/^.*:+.*$/.test(f)&&(f=undefined);u.subscribe("nodeDoubleClick",function(i,r){t.changeXpathPropertyForElement(n.guid,n.property,r);u.closePopup()});u.renderPopup({position:n.position,xpath:f,filter:n.filter})})},showMultiXpathEditor:function(n){var t=this,i=t.executeCommand({command:"getElementProperties",guid:n.guid}),r=n.model||t.controller.getXpathNavigatorModel({context:n.context});$.when(r).done(function(r){$.extend(r,{context:t.controller.getContext()});var u=new bizagi.editor.component.xpathnavigator.presenter({model:r}),f=bizagi.editor.utilities.resolveProperty(i,n.property);/^.*:+.*$/.test(f)&&(f=undefined);u.subscribe("nodeDoubleClick",function(i,r){t.changeXpathMultiplePropertyForElement(n.guid,n.property,r);u.closePopup()});u.renderPopup({position:n.position,filter:n.filter,allowCollection:n.filter.allowCollections==undefined?!0:bizagi.util.parseBoolean(n.filter.allowCollections)})})},changeXpathPropertyForElement:function(n,t,i){var r=this,f,u;(r.editorValidations[n]===undefined||(f=r.validateXpathChange(n,t,i),f))&&(u={command:"changeProperty",guid:n,property:t,value:bizagi.editor.utilities.buildComplexXpath(i.xpath,i.contextScope,i.isScopeAttribute,i.guidRelatedEntity),refreshProperties:!0,removeDefaultDisplayName:!0,renderTypeProperty:i.nodeSubtype,validateForm:r.validateForm},r.editorValidations[n]&&r.editorValidations[n].exclusive!==undefined&&(u=$.extend({},u,{exclusive:r.editorValidations[n].exclusive})),r.executeCommand(u))},changeXpathMultiplePropertyForElement:function(n,t,i){var r=this,f,o;if(r.editorValidations[n]===undefined||(f=r.validateXpathMultipleChange(n,t,i),f)){var u=r.executeCommand({command:"getElementProperty",guid:n,property:t})||[],e=bizagi.editor.utilities.buildComplexXpath(i.xpath,i.contextScope,i.isScopeAttribute,i.guidRelatedEntity),s=$.grep(u,function(n){return e.xpath.baxpath.xpath==n.xpath.baxpath.xpath}).length!=0?!0:!1;s||(u.push(e),o={command:"changeProperty",guid:n,property:t,value:u,refreshProperties:!0,removeDefaultDisplayName:!0,renderTypeProperty:i.nodeSubtype,validateForm:r.validateForm},r.executeCommand(o))}},performPropertyChange:function(n,t){var i=this,r=[n.id],u=t||n.refreshProperties;bizagi.editor.utilities.isGuidEmpty(n.id)&&(r=i.controller.getGuidsSelected());i.executeCommand({command:"changeProperty",guids:r,property:n.type,value:n.newValue,exclusive:n.exclusive,refreshProperties:u,validateForm:i.validateForm})},performPropertyChangeLayout:function(n){var t=this;t.executeCommand({command:"changeLayout",guid:n.id,values:n.values})},performShowRuleSelector:function(n){var i=this,r=n.data,u,t,f,e;r&&i.isRule90(r)&&(u=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getruledisplayname",rule:r.rule90}),$.when(u.processRequest()).done(function(n){var t=bizagi.localization.getResource("formmodeler-message-rule90").replace("{0}",n.displayName);bizagi.showMessageBox(t);return}));t=i.executeCommand({command:"getElementProperties",guid:n.id,getContext:n.context});t&&t.context&&(f=t.context);e=bizagi.editor.communicationprotocol.factory.createProtocol($.extend(n,{protocol:"ruleexpression",idcontextentity:f}));$.when(e.processRequest()).done(function(t){t&&(n.newValue=t.isEmpty?undefined:t,i.performPropertyChange(n,!0))})},performShowLocalization:function(n){var r=this,t=r.executeCommand({command:"getElementProperty",guid:n.id,property:n.type}),i,u;typeof t!="object"&&(t=typeof t=="string"?bizagi.editor.utilities.buildComplexLocalizable(t,n.id,n.type):bizagi.editor.utilities.buildComplexLocalizable("",n.id,n.type));i=t.i18n["default"];t.i18n["default"]=$("<div/>").html(t.i18n["default"]).text();u=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"multilanguage",i18n:t});$.when(u.processRequest()).done(function(u){t.i18n["default"]=i;u&&(u.i18n["default"]=i,n.newValue=u,r.performPropertyChange(n,!0))})},performChangeMultipleProperties:function(n){var t=this,i=[n.id];bizagi.editor.utilities.isGuidEmpty(n.id)&&(i=t.controller.getGuidsSelected());t.executeCommand({command:"changeMultipleProperties",properties:n.properties,guids:i})},performShowFilterEditor:function(n){var t=this,i,r;n.type==="data.filter"&&(n.xpathNode=t.executeCommand({command:"getXpathDataForElement",guid:n.id}),i=t.executeCommand({command:"getElementProperties",guid:n.id}),r=bizagi.editor.communicationprotocol.factory.createProtocol($.extend(n,{protocol:"loadfilter",idcontextentity:i.context})),$.when(r.processRequest()).done(function(i){i&&(n.newValue=i.isEmpty?undefined:bizagi.editor.utilities.buildComplexFilter(i,n.xpathNode),t.performPropertyChange(n,!0))}))},performShowRuleEditorForDefaultValue:function(){},performShowXPathEditor:function(n){this.showXpathEditor({guid:n.id,property:n.type,position:n.position})},performShowInterfaceEditor:function(n){var t=this,i=bizagi.editor.communicationprotocol.factory.createProtocol($.extend(n,{protocol:"loadinterface"}));$.when(i.processRequest()).done(function(i){i&&(n.newValue=i,t.performPropertyChange(n,!0))})},performSelectXpathFromEntity:function(n){var t=this,i={typeEditor:n.typeEditor,editorParameters:n.editorParameters};n.editorParameters.types!==undefined&&(t.editorValidations[n.id]=i);$.when(t.executeCommand({command:"getXpathEditorModel",guid:n.id,editorParameters:n.editorParameters})).done(function(i){$.when(i).done(function(i){var r={guid:n.id,property:n.type,position:n.position,model:i};n.editorParameters.types!==undefined&&$.isArray(n.editorParameters.types)&&$.extend(r,{filter:{typeFilter:n.typeEditor,types:n.editorParameters.types}});t.showXpathEditor(r)})})},performSelectXpathToSimple:function(n){var i=this,t={typeEditor:n.typeEditor,editorParameters:n.editorParameters};n.exclusive!==undefined&&(t=$.extend({},t,{exclusive:n.exclusive}));i.editorValidations[n.id]=t;this.showXpathEditor({guid:n.id,property:n.type,position:n.position,context:n.context,filter:{typeFilter:n.typeEditor,types:n.editorParameters.types}})},performSelectXpathToEntity:function(n){var t=this,u=t.executeCommand({command:"getElementProperties",guid:n.id}),i,r;u.type=="nestedform"?(i=bizagi.localization.getResource("formmodeler-component-editor-validation-xpath-title"),r=bizagi.localization.getResource("formmodeler-component-editor-validation-xpath-message"),bizagi.showMessageBox(r,i,"warning",!1)):(t.editorValidations[n.id]={typeEditor:n.typeEditor},t.showXpathEditor({guid:n.id,property:n.type,position:n.position,context:n.context,filter:{typeFilter:n.typeEditor}}))},performSelectXpathToCollection:function(n){var t=this;t.editorValidations[n.id]={typeEditor:n.typeEditor};t.showXpathEditor({guid:n.id,property:n.type,position:n.position,context:n.context,filter:{typeFilter:n.typeEditor}})},performSelectMultiXpath:function(n){var i=this,t={typeEditor:n.typeEditor,editorParameters:n.editorParameters};n.exclusive!==undefined&&(t=$.extend({},t,{exclusive:n.exclusive}));i.editorValidations[n.id]=t;this.showMultiXpathEditor({guid:n.id,property:n.type,position:n.position,context:n.context,filter:{typeFilter:n.typeEditor,types:n.editorParameters.types,allowCollections:n.editorParameters.allowCollections}})},performSelectXpath:function(n){var t=this;t.showXpathEditor({guid:n.id,property:n.type,position:n.position,context:n.context})},performShowGridValidationsEditor:function(n){var i=this,t=i.executeCommand({command:"getElementProperties",guid:n.id}),r;typeof t.xpath=="object"&&(r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"gridvalidations",guidRender:n.id,xpath:bizagi.editor.utilities.resolveComplexXpath(t.xpath),gridValidations:t.gridvalidations}),$.when(r.processRequest()).done(function(t){t&&(n.newValue=t,i.performPropertyChange(n,!0))}))},performSelectProcess:function(n){var t=this,i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"selectprocess",guidRender:n.id});$.when(i.processRequest()).done(function(i){i&&(n.newValue=i,t.performPropertyChange(n,!0))})},performSelectFormOption:function(n){var t=this,i=[],r=bizagi.editor.utilities.buildComplexReference(n.form);n.newValue=r;n.context&&n.context==="searchform"&&(i.push(r),n.newValue=i);t.performPropertyChange($.extend(n,{type:n.propertyName}),!0);n.showForm&&t.executeCommand({command:"updateModel",data:{actiontype:"ShowForm",guidrender:n.id,form:n.form}})},performSelectFormButton:function(n){var t,i;$.isArray(n.value)&&(n.value=n.value[0]);typeof n.value=="object"&&(t=bizagi.editor.utilities.resolveComplexReference(n.value),t.length>0&&(i=bizagi.editor.communicationprotocol.factory.createProtocol($.extend(n,{protocol:"openform",idform:t})),i.processRequest()))},performShowWizardTemplates:function(n){var i=this,t=i.executeCommand({command:"getElementProperties",guid:n.id,canUndo:!1}),f=i.controller.getModel();if(t.xpath&&typeof bizagi.editor.utilities.isObject(t.xpath)){var r=bizagi.editor.utilities.resolveComplexXpath(t.xpath),u=bizagi.editor.utilities.resolveRelatedEntityFromXpath(t.xpath),f=i.controller.getModel(),e=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"showwizardtemplates",xpath:r,relatedEntity:u,guidControl:n.id,propertyName:n.propertyName,isScopeAttribute:f.publish("getNodeInfo",{xpath:r,callback:function(n){return n.isScopeAttribute}})});$.when(e.processRequest()).done(function(){delete bizagi.editor.component.properties.commands.selecttemplate.templatesPromise[u]})}},performSelectFormNew:function(n){var t=this,i=t.executeCommand({command:"getElementProperties",guid:n.id,canUndo:!1}),u=t.executeCommand({command:"propertyIsRequired",guid:n.id,property:"xpath"}),f=t.controller.getModel();if(i.xpath&&typeof i.xpath=="object"||!u){var r=bizagi.editor.utilities.resolveComplexXpath(i.xpath),e=bizagi.editor.utilities.resolveRelatedEntityFromXpath(i.xpath),o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"createform",xpath:t.controller.getContextXpath({xpath:r}),guid:n.id,propertyName:n.propertyName,context:n.context,relatedEntity:e,isScopeAttribute:f.publish("getNodeInfo",{xpath:r,callback:function(n){return n.isScopeAttribute}}),showForm:n.showForm});o.processRequest()}},performSelectFormNone:function(n){var t=this;n.newValue=undefined;t.performPropertyChange($.extend(n,{type:n.propertyName}),!0)},performSelectTemplateNone:function(n){var t=this;n.newValue=undefined;t.performPropertyChange($.extend(n,{type:n.propertyName}),!0)},performSelectTemplateDefault:function(n){var t=this;n.newValue=n.value;t.performPropertyChange($.extend(n,{type:n.propertyName}),!0)},performShowDocumentTemplatesEditor:function(n){var i=this,t=i.executeCommand({command:"getElementProperties",guid:n.id}),r;t.xpath&&typeof t.xpath=="object"&&(r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"documenttemplates",groupmapping:t.groupmapping,append:t.append,xpath:bizagi.editor.utilities.resolveComplexXpath(t.xpath),idContextEntity:t.context}),$.when(r.processRequest()).done(function(t){t&&i.performPropertyChange({id:n.id,type:"groupmapping",newValue:bizagi.editor.utilities.buildComplexReference(t)})}))},performShowAssociationEditor:function(n){var t=this,r=t.executeCommand({command:"getElementProperties",guid:n.id}),i=r.type;$.when(t.showControlWizard({model:r,control:t.Class.map[i]||i})).done(function(r){r.success&&t.executeCommand({command:"updateAssociationModel",model:r.model,guid:n.id,control:i});t.refreshPropertyBox()})},performLoadMetadata:function(n){var t=this,i=t.executeCommand({command:"getElementProperties",guid:n.id}),r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getmetadata",xpath:bizagi.editor.utilities.resolveComplexXpath(i.xpath)});return r.processRequest()},validateXpathChange:function(n,t,i){var l=this,u=i.nodeType,a=i.nodeSubtype,r=!1,o=l.editorValidations[n],s="N/A",f,e,h,c;switch(o.typeEditor){case"xpathfromentity":case"xpathtosimple":for(f=o.editorParameters.types,s=f.toString(),r=!0,e=0;e<f.length;e++)try{if($.inArray(a,bizagi.editor.component.xpathnavigator.equiv.rule.xpathtosimple[f[e]])!=-1){r=!1;break}}catch(v){bizagi.logError("Equiv Error","renderType: "+u+", types: "+s)}break;case"xpathtocollection":$.inArray(u,bizagi.editor.component.xpathnavigator.equiv.rule.xpathtocollection.xpathtocollection)==-1&&(r=!0);break;case"xpathtoentity":i.hasRelatedEntity&&i.guidRelatedEntity!="00000000-0000-0000-0000-000000000000"&&u!="collection"||(r=!0)}return r&&(h=bizagi.localization.getResource("bizagi-editor-validation-xpath-title"),c=printf(bizagi.localization.getResource("bizagi-editor-validation-xpath-title-message"),o.typeEditor,s,u),bizagi.showMessageBox(c,h,"warning",!1)),!r},validateXpathMultipleChange:function(n,t,i){var l=this,o=i.nodeType,a=i.nodeSubtype,r=!1,s=l.editorValidations[n],e="N/A",u,f,h,c;for(u=s.editorParameters.types,e=u.toString(),r=!0,f=0;f<u.length;f++)try{if($.inArray(a,bizagi.editor.component.xpathnavigator.equiv.rule.xpathmultiple[u[f]])!=-1){r=!1;break}}catch(v){bizagi.logError("Equiv Error","renderType: "+o+", types: "+e)}return r&&(h=bizagi.localization.getResource("bizagi-editor-validation-xpath-title"),c=printf(bizagi.localization.getResource("bizagi-editor-validation-xpath-title-message"),s.typeEditor,e,o),bizagi.showMessageBox(c,h,"warning",!1)),!r},isRule90:function(n){return n.rule90}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{processValidations:function(n){var t=this,i=new $.Deferred,r;return t.controller.isTemplateContext()?t.processTemplateValidations(n):(r=t.executeCommand({command:"formValidations",validations:["RequiredProperties","RequiredDependentProperties","SameXpath","ElementsInContainers","AttributesAdministrables","AttributesNoEditables"],canRefresh:n.canRefresh}),$.when(r).done(function(n){$.isEmptyObject(n)||(t.validateForm=!0,t.refreshRibbon(),$.extend(n,{showMessage:!0}));i.resolve(n)}),i.promise())},processTemplateValidations:function(n){var t=this,i=t.executeCommand({command:"formValidations",validations:[],canRefresh:n.canRefresh});return $.isEmptyObject(i)||(t.validateForm=!0,t.refreshRibbon(),$.extend(i,{showMessage:!0})),i},removeValidations:function(n){var t=this;t.validateForm=!1;t.executeCommand({command:"removeValidationsInModel",canRefresh:n.canRefresh})}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{showControlWizard:function(n){var t=this,i=t.wizardPresenter=new bizagi.editor.wizard.presenter;return t.prepareWizardParams(n),n.isGridContext=t.controller.isGridContext(),n.isGridContext&&(n.gridContextXpath=t.controller.getContextXpath({})),i.show(n)},prepareWizardParams:function(n){var t=this;n.control=="cascadingcombo"?n.xpathModel=t.controller.getXpathNavigatorModel():n.control=="association"?(t.wizardPresenter.subscribe("showXPathNavigatorEditor",function(n,i){return t.onShowXpathNavigatorEditor(i)}),t.wizardPresenter.subscribe("getMultipleRelationship",function(n,i){return t.onGetMultipleRelationship(i)}),t.wizardPresenter.subscribe("getXpathData",function(n,i){return t.onGetXpathData(i)}),t.wizardPresenter.subscribe("setLocalization",function(n,i){return t.onSetLocalization(i)})):n.control=="searchlist"&&(t.wizardPresenter.subscribe("showXPathNavigatorEditor",function(n,i){return t.onShowXpathNavigatorEditor(i)}),t.wizardPresenter.subscribe("getMultipleRelationship",function(n,i){return t.onGetSimpleRelationship(i)}),t.wizardPresenter.subscribe("getXpathData",function(n,i){return t.onGetXpathData(i)}),t.wizardPresenter.subscribe("setLocalization",function(n,i){return t.onSetLocalization(i)}),t.wizardPresenter.subscribe("changelabel",function(n,i){t.onElementChangeLabel(i)}))},onShowXpathNavigatorEditor:function(n){var t=this,r=new $.Deferred,u,i;return t.editorValidations=t.editorValidations||{},i=n.filter&&n.filter.types,i=i||[],t.editorValidations[n.xpathProperty]={typeEditor:n.typeEditor,editorParameters:{types:i}},u=t.controller.isGridContext()?t.controller.getXpathNavigatorModelGrid({context:n.entity}):t.controller.getXpathNavigatorModel({context:n.entity}),$.when(u).done(function(i){var u=new bizagi.editor.component.xpathnavigator.presenter({model:i});u.subscribe("nodeDoubleClick",function(i,f){var e=t.validateXpathChange(n.xpathProperty,n.xpathProperty,f);e&&(u.closePopup(),r.resolve(f))});u.renderPopup({position:n.position,filter:n.filter,xpath:n.xpath,allowCollection:n.allowCollection})}),r.promise()},onGetMultipleRelationship:function(n){var t=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.leftEntity),i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.rightEntity),r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getmultiplerelationship",leftEntityId:t,rightEntityId:i});return r.processRequest()},onGetSimpleRelationship:function(n){var t=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.leftEntity),i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getmultiplerelationship",leftEntityId:t});return i.processRequest()},onGetXpathData:function(n){var t=this,i=n.xpath,r=t.controller.getXpathNavigatorModel();return r.getNodeByXpath(i)},onSetLocalization:function(n){var u=this,i=new $.Deferred,t=n.propertyValue,r;return t=t||bizagi.editor.utilities.buildComplexLocalizable("",n.elementGuid,n.propertyName),r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"multilanguage",i18n:t}),$.when(r.processRequest()).done(function(n){n&&i.resolve(n)}),i.promise()},onElementChangeLabel:function(n){var t=this;t.executeCommand({command:"changeProperty",guid:n.guid,property:"displayName",value:n.value})}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{getExternalData:function(n){var t=this;return bizagi.log("sucede getExternalData",n),typeof t["getDataFor"+n.control]=="function"?t["getDataFor"+n.control](n):void 0},getDataForcascadingcombo:function(n){var t=bizagi.editor.utilities.resolveComplexXpath(n.xpath),i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.xpath),r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getparententities",id:i,xpath:t});return r.processRequest()},getDataForquerycascadingcombo:function(n){var t=this;return t.getDataForcascadingcombo(n)},getDefaultDisplayName:function(n){var i=this,t=n.element,r=t.properties,u=$.Deferred(),f,e;return r&&typeof r.xpath=="object"?(f=t.isInternal()?"getmetadataattributedisplayname":"getattributedisplayname",e=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:f,xpath:r.xpath,guidControl:i.controller.getControlsModel().getGuidControl(t.type)}),e.processRequest()):(i.controller.isTemplateContext()?u.resolve(""):u.resolve(i.controller.getControlDisplayName(t.type)),u.promise())},getNodeInfo:function(n){var t=this,r,i;return(n=n||{},r=t.controller.isGridContext()?t.controller.getXpathNavigatorModelGrid():t.controller.getXpathNavigatorModel(),i=n.root?r.getRootNode():r.getNodeByXpath(n.xpath),i&&typeof n.callback=="function")?n.callback.call(t,i):i},findXpathAttributes:function(n){var t=this;return t.showElementXpath(n.xpath).pipe(function(){return t.executeCommand({command:"applyOverridesElement",element:n.element})})}});
bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawCommandsEditor:function(){var n=this,t=new bizagi.editor.component.commandseditor.presenter;$.when(n.controller.getCommandsModel()).done(function(i){t.subscribe("getContext",function(t,i){return n.onGetContext(i)});$.when(t.show(i)).done(function(t){n.controller.setCommandsModel(t);n.refreshRibbon()})})},onGetContext:function(){var n=this;return n.controller.getContext()}});
bizagi.editor.component.editor("bizagi.editor.component.editor.groupmapping",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var r=this,i,u;t.ButtonName=bizagi.localization.getResource("formmodeler-component-editor-groupmapping-buttonname");t.caption=bizagi.util.trim(t.caption).length>0?t.caption:" ";i=$.tmpl(r.getTemplate("frame"),t);i.appendTo(n);u=$("div",i);r.addRequired(u)},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.groupmapping").concat("#groupmapping-frame"))).done(function(){n.resolve()}),n.promise()},".biz-action-validate click":function(n,t){var i=this;t.stopPropagation();i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_DOCUMENT_TEMPLATES,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})}});
bizagi.editor.component.editor("bizagi.editor.component.editor.associationconfig",{init:function(n,t,i){var r=this;r._super(n,t,i)},renderEditor:function(n,t){var r=this,i,u;t.ButtonName=bizagi.localization.getResource("formmodeler-component-editor-associationconfig-buttonname");t.caption=bizagi.util.trim(t.caption).length>0?t.caption:" ";i=$.tmpl(r.getTemplate("frame"),t);i.appendTo(n);u=$("div",i);r.addRequired(u)},remove:function(){this.element.hide();this.element.empty()},loadTemplates:function(){var n=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.associationconfig").concat("#associationconfig-frame"))).done(function(){n.resolve()}),n.promise()},".biz-action-validate click":function(n,t){var i=this;t.stopPropagation();i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_ASSOCIATION_EDITOR,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})}});
bizagi.editor.observableClass.extend("bizagi.editor.model",{},{init:function(n){var t=this,u=n&&n.definitions?n.definitions:{},i=n.languages,r;t.context=n.context;t.isActivityForm=n.isActivityForm;t.hasOfflineForm=n.hasOfflineForm;t.isOfflineAsOnline=n.isOfflineAsOnline;t.flags=n.flags;this._super();t.elementFactory=new bizagi.editor.base.elementFactory({definitions:u,controls:n.controls});r={contextentity:n.contextentity,scopedefinition:n.scopedefinition,isActivityForm:n.isActivityForm,version:n.version};t.form=t.createFormElement(n.context,r);t.isInitForm()&&t.addInitFormOptionsToRibbon();i&&$.isArray(i)&&t.context!="adhocform"&&t.addLanguagesToRibbonModel(i);n.isActivityForm&&t.context=="form"&&(t.addCustomButtonsSwitchToRibbon(),t.addEmailOptionsToRibbonModel());t.context=="startform"&&t.flags.UseOfflineForms&&t.addUseOfflineFormSwitchToRibbon()},isInitForm:function(){var n=this;return n.context=="offlineform"||n.context=="startform"},checkActivityForm:function(){var n=this;return bizagi.util.parseBoolean(n.isActivityForm)==!0},checkOfflineForm:function(){var n=this;return bizagi.util.parseBoolean(n.hasOfflineForm)},checkOfflineAsOnline:function(){var n=this;return bizagi.util.parseBoolean(n.isOfflineAsOnline)},updateOfflineAsOnline:function(n){var t=this;t.isOfflineAsOnline=n},createFormElement:function(n,t){var r=this,i;return n=n||"form",i=r.createElement(n,t),r.isActivityForm&&i.createDefaultButtons(),i.subscribe("refresh",function(n,t){r.publish("refresh",t)}),i.subscribe("getDefaultDisplayName",function(n,t){return r.publish("getDefaultDisplayName",t)}),i.subscribe("getContextXpath",function(n,t){return r.publish("getContextXpath",t)}),i.subscribe("getNodeInfo",function(n,t){return r.publish("getNodeInfo",t)}),i.subscribe("findXpathAttributes",function(n,t){return r.publish("findXpathAttributes",t)}),i.subscribe("resizeHeigthCanvas",function(n,t){r.publish("resizeHeigthCanvas",t)}),i.subscribe("isReadOnlyForm",function(n,t){return r.publish("isReadOnlyForm",t)}),i.subscribe("getContextEntityType",function(n,t){return r.publish("getContextEntityType",t)}),i.subscribe("getControllerInfo",function(n,t){return r.publish("getControllerInfo",t)}),i.subscribe("refreshElement",function(n,t){return r.publish("refreshElement",t)}),i.subscribe("formIsLoaded",function(n,t){return r.publish("formIsLoaded",t)}),i},createDefaultButtons:function(n){var u=this,t=[],f=Math.guid(),e=u.createElement("formbutton",{guid:f,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-save"),f,"caption"),actions:["submitData","refresh"]}}),i,r;return e.setParent(n),i=Math.guid(),r=u.createElement("formbutton",{guid:i,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-next"),i,"caption"),actions:["validate","submitData","next"]}}),r.setParent(n),t.push(e),t.push(r),t},getForm:function(){return this.form},createLayoutElement:function(n){for(var u,i=this,r=i.createElement("horizontal"),t=0,f=n.childrens.length;t<f;t=t+1)u=i.createChildElement(n.childrens[t]),r.addElement(u);return r},createChildElement:function(n){var t=this,i=$.extend(n.properties,{type:n.type});return t.createElement(n.type,{properties:i})},loadModel:function(n,t){var i=this;i.form=i.createElement(n,t);i.isActivityForm&&i.form.buttons.length==0&&i.form.createDefaultButtons();i.form.subscribe("refresh",function(n,t){i.publish("refresh",t)});i.form.subscribe("getDefaultDisplayName",function(n,t){return i.publish("getDefaultDisplayName",t)});i.form.subscribe("getContextXpath",function(n,t){return i.publish("getContextXpath",t)});i.form.subscribe("getNodeInfo",function(n,t){return i.publish("getNodeInfo",t)});i.form.subscribe("findXpathAttributes",function(n,t){return i.publish("findXpathAttributes",t)});i.form.subscribe("resizeHeigthCanvas",function(n,t){i.publish("resizeHeigthCanvas",t)});i.form.subscribe("isReadOnlyForm",function(n,t){return i.publish("isReadOnlyForm",t)});i.form.subscribe("getContextEntityType",function(n,t){return i.publish("getContextEntityType",t)});i.form.subscribe("getControllerInfo",function(n,t){return i.publish("getControllerInfo",t)});i.form.subscribe("refreshElement",function(n,t){return i.publish("refreshElement",t)});i.form.subscribe("formIsLoaded",function(n,t){return i.publish("formIsLoaded",t)})},saveModel:function(){return this.form.getPersistenceModel()},createElement:function(n,t,i){var r=this;return r.elementFactory.createElement(n,t,i)},getRibbonModelData:function(){var n=this;return n.context=="offlineform"?this.Class.ribbonModelDataOffline:n.context=="template"?this.Class.ribbonModelTemplateData:n.context=="adhocform"?this.Class.ribbonModelAdhoc:this.Class.ribbonModelData},addWidgets:function(n){var t=this;t.elementFactory.addWidgetsControls(n)},getFlags:function(){return this.flags},addEmailOptionsToRibbonModel:function(){var n=this,t=n.getRibbonModelData();t.elements.push({caption:"formmodeler-component-ribbon-caption-email",css:"bz-studio bz-newSystemConfiguration_32x32_standard",hide:!0,name:"email",elements:[{caption:"formmodeler-component-ribbon-caption-emailtemplate",style:"email-template",action:"emailTemplate",align:"vertical",disabled:"disabled",css:"bz-studio bz-newSystemConfiguration_32x32_standard"}]})},addInitFormOptionsToRibbon:function(){var n=this,t=n.getRibbonModelData(),i={caption:n.context=="offlineform"?"formmodeler-component-ribbon-caption-initform-offline":"formmodeler-component-ribbon-caption-initform-online",name:"initForm",hide:!0,elements:[{caption:n.context=="offlineform"?"formmodeler-component-ribbon-initform-caption-setonline":"formmodeler-component-ribbon-initform-caption-setoffline",style:n.context=="offlineform"?"online":"offline",css:"bz-studio bz-forms-offline_16x16_standard",action:"switchForm",tooltip:"formmodeler-component-ribbon-offline-caption-designform-tooltip",isButton:!0}]};t.elements.push(i)},addLanguagesToRibbonModel:function(n){var s=this,u=s.getRibbonModelData(),f=u.elements.filter(function(n){return n.name=="languages"}),t,i,e,r,o;if(f==null||!(f.length>0)){for(t=[],t.push({caption:"formmodeler-component-ribbon-caption-default",style:"language",property:"language",css:"bz-studio bz-world_16x16_standard",action:"Language",value:{displayname:"default",IsRightToLeft:!1,key:"default"}}),i=0,e=n.length;i<e;i+=1)r=JSON.parse(n[i].value),t.push({caption:r.displayname,style:r.displayname,property:"language",action:"Language",value:r});o={caption:"formmodeler-component-ribbon-caption-languages",name:"languages",css:"bz-studio bz-world_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-language",style:"language",property:"language",css:"bz-studio bz-world_16x16_standard",elements:t}]};u.elements.push(o)}},addCustomButtonsSwitchToRibbon:function(){for(var i=this,t=i.getRibbonModelData(),r={caption:"formmodeler-component-ribbon-caption-useCustomButtons",style:"validate",action:"useCustomButtons",disabled:"disabled",css:"bz-studio bz-form-buttons_16x16_standard",checked:!1,name:"customButtons"},n=0;n<t.elements.length;n++)t.elements[n].caption=="formmodeler-component-ribbon-caption-show"&&t.elements[n].elements.push(r)},addUseOfflineFormSwitchToRibbon:function(){for(var i=this,t=i.getRibbonModelData(),r={caption:"formmodeler-component-ribbon-caption-useofflineform",style:"validate",action:"useOfflineForm",css:"bz-studio bz-forms-offline_16x16_standard",tooltip:"formmodeler-component-ribbon-offline-caption-useoffline-tooltip",checked:!1},n=0;n<t.elements.length;n++)t.elements[n].caption=="formmodeler-component-ribbon-caption-show"&&t.elements[n].elements.push(r)}});for(var key in bizagi.editor.base.form.prototype)key!="init"&&key!="constructor"&&key!="Class"&&key!="subscribe"&&key!="unsubscribe"&&key!="publish"&&(bizagi.editor.model.prototype[key]=eval("var tmp = function(){ \nif (this.getForm()){ \nreturn this.getForm()."+key+".apply(this.getForm(), arguments); \n} \nreturn null;};\ntmp \n"));bizagi.editor.model.extend("bizagi.editor.model",{ribbonModelData:{elements:[{caption:"formmodeler-component-ribbon-caption-form",name:"form",css:"bz-sprite-img bz-save_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-undo",style:"undo",action:"undo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-redo",style:"redo",action:"redo",disabled:"disabled",css:"bz-studio bz-redo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-checkout",style:"checkout",action:"checkout",align:"vertical",disabled:"disabled",css:"bz-studio bz-check-out_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-save",style:"save",action:"save",align:"vertical",disabled:"disabled",css:"bz-studio bz-save_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyfrom",style:"copy-from",action:"copy-from",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-form_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyformat",style:"copy-format",action:"copy-format",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-format_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-properties",style:"form-properties",action:"formproperties",align:"vertical",disabled:"disabled",css:"bz-studio bz-form-properties_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-show",name:"show",css:"bz-studio bz-warning_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-validations",style:"validate",action:"validate",checked:!1,css:"bz-studio bz-warning_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-validation",name:"validation",elements:[{caption:"formmodeler-component-ribbon-caption-actionsvalidations",style:"actions-validations",action:"actionsvalidations",align:"vertical",disabled:"disabled",css:"bz-studio bz-actions-and-validations_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-element",name:"element",css:"bz-studio bz-save_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-convertto",style:"convert-to",action:"convertto",disabled:"disabled",css:"bz-studio bz-convert-to_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-delete",style:"delete",action:"delete",disabled:"disabled",css:"bz-studio bz-delete_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-rename",style:"rename",action:"rename",disabled:"disabled",css:"bz-studio bz-rename_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-visible",style:"visible",property:"visible",disabled:"disabled",css:"bz-studio bz-visible_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"visible",value:{fixedvalue:"true"},css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"visible",value:{fixedvalue:"false"},css:"bz-studio bz-boolean-remove_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-expression",style:"expression",property:"visible",value:"expression",css:"bz-studio bz-expresion-ex_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-editable",style:"editable",property:"editable",disabled:"disabled",css:"bz-studio bz-editable_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"editable",value:{fixedvalue:"true"},css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"editable",value:{fixedvalue:"false"},css:"bz-studio bz-boolean-remove_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-expression",style:"expression",property:"editable",value:"expression",css:"bz-studio bz-expresion-ex_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-required",style:"required",property:"required",disabled:"disabled",css:"bz-studio bz-required_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"required",value:{fixedvalue:"true"},css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"required",value:{fixedvalue:"false"},css:"bz-studio bz-boolean-remove_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-expression",style:"expression",property:"required",value:"expression",css:"bz-studio bz-expresion-ex_16x16_standard"}]}]}]},ribbonModelTemplateData:{elements:[{caption:"formmodeler-component-ribbon-caption-form",name:"form",elements:[{caption:"formmodeler-component-ribbon-caption-undo",style:"undo",action:"undo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-redo",style:"redo",action:"redo",disabled:"disabled",css:"bz-studio bz-redo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-checkout",style:"checkout",action:"checkout",align:"vertical",disabled:"disabled",css:"bz-studio bz-check-out_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-save",style:"save",action:"save",align:"vertical",disabled:"disabled",css:"bz-studio bz-save_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyformat",style:"copy-format",action:"copy-format",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-format_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-properties",style:"form-properties",action:"formproperties",align:"vertical",disabled:"disabled",css:"bz-studio bz-form-properties_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-show",name:"show",css:"bz-studio bz-warning_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-validations",style:"validate",action:"validate",checked:!1,css:"bz-studio bz-studio bz-warning_16x16_standard"}]}]},ribbonModelDataOffline:{elements:[{caption:"formmodeler-component-ribbon-caption-form",name:"form",elements:[{caption:"formmodeler-component-ribbon-caption-undo",style:"undo",action:"undo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-redo",style:"redo",action:"redo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-checkout",style:"checkout",action:"checkout",align:"vertical",disabled:"disabled",css:"bz-studio bz-check-out_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-save",style:"save",action:"save",align:"vertical",disabled:"disabled",css:"bz-studio bz-save_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyformat",style:"copy-format",action:"copy-format",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-format_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-properties",style:"form-properties",action:"formproperties",align:"vertical",disabled:"disabled",css:"bz-studio bz-form-properties_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-show",name:"show",css:"bz-studio bz-warning_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-validations",style:"validate",action:"validate",checked:!1,css:"bz-studio bz-studio bz-warning_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-validation",name:"validation",elements:[{caption:"formmodeler-component-ribbon-caption-actionsvalidations",style:"actions-validations",action:"actionsvalidations",align:"vertical",disabled:"disabled",css:"bz-studio bz-actions-and-validations_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-element",name:"element",css:"bz-studio bz-undo_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-convertto",style:"convert-to",action:"convertto",disabled:"disabled",css:"bz-studio bz-convert-to_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-delete",style:"delete",action:"delete",disabled:"disabled",css:"bz-studio bz-delete_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-rename",style:"rename",action:"rename",disabled:"disabled",css:"bz-studio bz-rename_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-visible",style:"visible",property:"visible",disabled:"disabled",css:"bz-studio bz-visible_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"visible",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"visible",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-editable",style:"editable",property:"editable",disabled:"disabled",css:"bz-studio bz-editable_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"editable",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"editable",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-required",style:"required",property:"required",disabled:"disabled",css:"bz-studio bz-required_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"required",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"required",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]}]}]},ribbonModelAdhoc:{elements:[{caption:"formmodeler-component-ribbon-caption-form",name:"form",elements:[{caption:"formmodeler-component-ribbon-caption-undo",style:"undo",action:"undo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-redo",style:"redo",action:"redo",disabled:"disabled",css:"bz-studio bz-redo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-save",style:"save",action:"save",align:"vertical",disabled:"disabled",css:"bz-studio bz-save_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyformat",style:"copy-format",action:"copy-format",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-format_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-properties",style:"form-properties",action:"formproperties",align:"vertical",disabled:"disabled",css:"bz-studio bz-form-properties_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-show",name:"show",css:"bz-studio bz-warning_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-validations",style:"validate",action:"validate",checked:!1,css:"bz-studio bz-studio bz-warning_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-element",name:"element",css:"bz-studio bz-undo_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-delete",style:"delete",action:"delete",disabled:"disabled",css:"bz-studio bz-delete_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-rename",style:"rename",action:"rename",disabled:"disabled",css:"bz-studio bz-rename_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-visible",style:"visible",property:"visible",disabled:"disabled",css:"bz-studio bz-visible_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"visible",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"visible",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-editable",style:"editable",property:"editable",disabled:"disabled",css:"bz-studio bz-editable_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"editable",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"editable",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-required",style:"required",property:"required",disabled:"disabled",css:"bz-studio bz-required_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"required",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"required",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]}]}]}},{});
bizagi.editor.observableClass.extend("bizagi.editor.controls",{},{init:function(n,t){var i=this;i._super();i.controls={};i.convertToMap={};i.controlsToConvert={};t=t||{};typeof n!="undefined"&&i.processData(n,t)},processData:function(n,t){var i=this;$.each(n.controls,function(n,r){t[r.name]||(i.isConvertible(r.name)&&i.addControlInConvertToMap(r),i.controls[r.name]=r)})},findControl:function(n){var i=this,t=i.controls[n];if(t==null)throw"there aren't a control with name "+n;return t},disabledControls:function(n){var i=this;for(var t in n)i.controls[t]&&n[t]&&delete i.controls[t]},getDesignProperties:function(n){var i=this,t=i.findControl(n);return t.design&&t.design.properties?t.design.properties:{}},getGuidControl:function(n){var t=this,i=t.findControl(n);return i.jquery},isConvertible:function(n){return n=="association"?!1:n=="userpassword"?!1:n=="comboselected"?!1:n=="getuser"?!1:n=="stakeholder"?!1:!0},addControlInConvertToMap:function(n){var u=this,e=n.type||"render",f=n.design?n.design.properties:null,t,i,r;f&&(t=f.xpath,t&&t["bas-type"]&&(i=u.getConvertToMap(e),i[t["bas-type"]]||(i[t["bas-type"]]=[]),r={controlName:n.name,filterBy:t["editor-parameters"]?t["editor-parameters"].types:null,caption:bizagi.editor.utilities.resolveInternalResource(n.display),style:n.style},i[t["bas-type"]].push(r),u.controlsToConvert[n.name]={siblings:i[t["bas-type"]],definition:r}))},getConvertToMap:function(n){var t=this;return t.convertToMap[n]||(t.convertToMap[n]={}),t.convertToMap[n]},getControlsToConvert:function(n){var i=this,t;return i.controlsToConvert[n]?(t=i.controlsToConvert[n],$.grep(t.siblings,function(n){return n.controlName!==t.definition.controlName&&i.filterBy(t,n.filterBy)})):[]},filterBy:function(n,t){var i,r,u;if(n.definition.filterBy&&$.isArray(n.definition.filterBy)&&t&&$.isArray(t)){for(i=0,r=n.definition.filterBy.length;i<r;i+=1)if(u=n.definition.filterBy[i],t.indexOf(u)>=0)return!0;return!1}return!0},disableControlProperties:function(n){var e=this,u,i,t,f,r;for(u in bizagi.editor.overrides[n])if(i=bizagi.editor.overrides[n][u],t=e.controls[u],t!=undefined&&bizagi.editor.utilities.isObject(i))for(f=i.properties&&i.properties.disable||[],t.disableProperties=t.disableProperties?t.disableProperties:[],r=0;r<=f.length;r++)t.disableProperties.push(f[r])}});
bizagi.editor.base.HostFacade=function(){return this.internalCache={},this.isHost=function(){return bizagi.editor.base.info.isCloud()?!1:typeof sharedObject!="undefined"},this.invokeHost=function(n,t){var r=new $.Deferred,i;bizagi.log("Invoking host method "+n,t);i=sharedObject.call(n,JSON.encode(t));bizagi.log("Result from invoking host method "+n,i);try{i=JSON.parse(i)}catch(u){bizagi.log("Could not parse result for call "+n,u.message)}return r.resolve(i),r.promise()},{getControlsMetadata:function(){var i=this,n=new $.Deferred,t;return internalCache.getControlsMetadata?internalCache.getControlsMetadata:(t=isHost()?invokeHost("GetControlDefinitions"):$.ajax({url:"jquery/editor/base/mocks/stub.controls.definition.json.txt",dataType:"json",async:!0}),$.when(t).done(function(t){bizagi.log("Current working control definitions: ",t);internalCache.getControlsMetadata=t;n.resolve(t)}),n.promise())},getXpathNavigatorFirstLoad:function(){return isHost()?invokeHost("XpathNavigatorFirstLoad"):$.ajax({url:"jquery/editor/component/xpathNavigator/mocks/stub.xpathnavigator.firstLoad.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},getUserfieldDependencies:function(n){return isHost()?invokeHost("GetUserfieldDependencies",{name:n}):$.ajax({url:"jquery/editor/component/xpathNavigator/mocks/stub.xpathnavigator.firstLoad.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},GetUserfieldIconDependencies:function(n,t,i){return isHost()?invokeHost("GetUserfieldIconDependencies",{name:n,density:t,size:i}):$.ajax({url:"jquery/editor/base/mocks/stub.loadUserFieldIcon.json.txt",dataType:"text",async:!0}).pipe(function(n){return n})},getXpathNavigatorExpandLoad:function(n){var t;return isHost()?(params={contextScope:n.contextScope,guid:n.guidRelatedEntity,xpath:n.xpath,style:n.style,isScopeAttribute:n.isScopeAttribute},t=invokeHost("XpathNavigatorExpandLoad",params)):t=$.ajax({url:"jquery/editor/component/xpathNavigator/mocks/stub.xpathnavigator.forexpand.json.txt",dataType:"json",async:!0}).pipe(function(n){return n}),t},getLayoutNavigatorModel:function(){return isHost()?invokeHost("GetLayoutDefinitions"):$.ajax({url:"jquery/editor/component/layoutnavigator/mocks/stub.layoutnavigator.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},executeBasActions:function(n){var r=this,u=new $.Deferred,t,i;return isHost()?t=invokeHost("ExecuteBasActions",n):(i=n.actiontype.toLowerCase(),t=$.ajax({url:"jquery/editor/base/mocks/stub."+i+".json.txt",dataType:"json",async:!0}).pipe(function(n){return n})),t},LoadForm:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loadform.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},GetReleatedEntityForms:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loadrelatedforms.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},LoadExpression:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loadexpression.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},LoadInterface:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loadinterface.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},LoadLocalizationForm:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.multilenguages.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},LoadCopyForm:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loadcopyform.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},LoadFilterEditor:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loadfilter.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},LoadDocumentTemplates:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loaddocumentemplates.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},LoadEntityValues:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loadentityvalues.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},GetAvailableLanguages:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.getavailablelanguages.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},GetAttributeDisplayName:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.atributtedisplayname.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},OpenWidgetstore:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.loadwigdetstore.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},InstallWidget:function(){var n=this;return $.ajax({url:"jquery/editor/base/mocks/stub.installwidget.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},GetWidgets:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadwigdets.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},VerifyLetters:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.verifyletters.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},GetParentEntities:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.getparententities.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},CreateForm:function(n){var t=n.parameters,i=this.findKeyInParameters(t,"guidRender"),r=this.findKeyInParameters(t,"propertyName"),u=this.findKeyInParameters(t,"context");setTimeout(function(){bizagi.form.modeler.updateForm({actiontype:"CreateForm",guidrender:i,propertyname:r,context:u,idform:Math.guid()})},100)},findKeyInParameters:function(n,t){for(var i=0,r=n.length;i<r;i+=1)if(n[i].key===t)return n[i].value},getRibbonBaseModel:function(){return $.ajax({url:"jquery/editor/component/ribbon/mocks/stub.base.ribbon.json.txt",dataType:"json",async:!0}).pipe(function(n){return n})},loadRuleExpressions:function(){var n=!1;isHost()&&(n=invokeHost("LoadBooleanExpression"));n&&(n=JSON.parse(n))}}}();bizagi.editor.base.info=function(){function n(){}return n.prototype.isCloud=function(){var n=BIZAGI_URL_REST_SERVICES;return n.indexOf("localhost")>=0?!1:!0},new n}();
bizagi.editor.refreshableCommand.extend("bizagi.editor.moveElementCommand",{},{execute:function(){var n=this,t=n.arguments,i=n.controller.getContextInfo();return t.elementType=t.elementType||"render",n.parent||(n.parent=n.arguments.parent||i.guid),n.model.moveElement(t.initialPosition,t.finalPosition,n.parent,t.elementType),!0},undo:function(){var t=this,n=t.arguments;return this.model.moveElement(n.finalPosition,n.initialPosition,t.parent,n.searchformresult),!0}});
bizagi.rendering.element.original=$.extend(!0,{},bizagi.rendering.element.prototype);$.extend(bizagi.rendering.element.prototype,{isContainedInNestedForm:function(){var n=this;return n.parent?n.parent.properties.type==="nestedForm"?!0:n.parent.properties.type==="collectionnavigator"?!0:n.parent.isContainedInNestedForm():!1},isContainedInCollectionNavigator:function(){var n=this,t=n.getFormContainer(),i=t.properties;return i.isNavigationForm||!1},isContainedInGrid:function(){var n=this,t=n.column;return t!=undefined},isReadOnlyForm:function(){var n=this,t=n.getFormContainer()||{},i=t.properties||{};return i.isReadOnly?!0:!1},findElement:function(n){var t=this;return n?t.properties.guid===n?this:null:null},selectElement:function(){},unselectElement:function(){}});
bizagi.rendering.container.original=$.extend(!0,{},bizagi.rendering.container.prototype);$.extend(bizagi.rendering.container.prototype,{postRenderContainer:function(n){var t=this;return(bizagi.rendering.container.original.postRenderContainer.apply(this,arguments),t.isReadOnlyForm())?n:t.getFormType()=="template"?(t.properties.type=="template"&&n.click(function(n){t.onClickCanvas(n)}),n):(n.hasClass("ui-sortable")&&n.sortable("destroy"),n.addClass("ui-bizagi-itemfordrag"),t.addDraggableClassToContainer(),t.isContainerSortable()&&(n.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type}),t.configureSortablePlugin(n)),t.isClickEventAllowed()&&(t.properties.type!==undefined&&t.properties.type!=="searchForm"&&t.properties.type!=="queryForm"?(n.mousedown(function(n){t.onMouseDown(n)}),n.click(function(n){t.onClick(n)})):n.click(function(n){t.onClickCanvas(n)})),t.changeVisibility(t.properties.visible),n)},selectElementByGuid:function(n){for(var r,i,u=this,t=0,f=n.length;t<f;t++)r=n[t],i=u.findElement(r),i&&i.selectElement({IsOnClickEvent:!1})},findElement:function(n){var i=this,t,r;if(!n)return null;if(i.properties.guid===n)return this;for(t=0;t<i.children.length;t++)if(r=i.children[t].findElement(n),r)return r;return null},disableSortablePlugin:function(){var n=this,t,i;for(n.container&&n.container.hasClass("ui-sortable")&&n.container.data()["ui-sortable"]&&n.container.sortable("destroy"),t=0,i=n.children.length;t<i;t=t+1)n.children[t].container&&n.children[t].disableSortablePlugin()},selectElement:function(n){var i=this,t=i.container,r;t.addClass("ui-bizagi-container-selected");r=t.offset();$.extend(r,{width:t.outerWidth(),height:t.outerHeight()});i.triggerGlobalHandler("selectelement",$.extend(n,{position:r,guid:i.properties.guid,element:t,type:i.properties.type}))},unselectElement:function(n){var t=this,i=t.container;i.removeClass("ui-bizagi-container-selected");n&&$.extend(n,{guid:t.properties.guid});t.triggerGlobalHandler("unselectelement",n)},configureSortablePlugin:function(n){var t=this,i;n.addClass("ui-bizagi-container-connectedSortable");n.bind("sortstart",function(n,i){t.onSortStart(i)});n.bind("sortstop",function(n,i){t.onSortFinish(i)});n.bind("sortactivate",function(n,i){t.currentDragSource=t.getDragSource(i.item)});i="> .ui-bizagi-draggable-item";t.getMode()!="layout"&&(i="> .ui-bizagi-draggable-item:not(.ui-bizagi-container-horizontal)");n.sortable({items:i,revert:!1,connectWith:".ui-bizagi-container-connectedSortable:not(.ui-sortable-helper)",distance:10,cursorAt:{top:-3,left:0},placeholder:"ui-bizagi-placeholder",delay:150,cancel:t.getMode()==="layout"?".ui-bizagi-render, .ui-bizagi-input-editable":".ui-bizagi-input-editable, .ui-bizagi-grid-cell",containment:"#main-panel .ui-bizagi-container-form",helper:function(n,i){return t.sortableHelper(i)},start:function(){$("#main-panel").addClass("ui-start-drag")},stop:function(){$("#main-panel").removeClass("ui-start-drag")},beforeStop:function(){window.x3=$("#mtool-container-helper")}}).disableSelection();t.loadHelperTemplate()},setConnectWith:function(n,t){var r=this,i;typeof n!="undefined"&&(i=".ui-bizagi-container-connectedSortable",i=i+"[id!= "+t+"]",n.container&&n.container.hasClass("ui-sortable")&&n.container.data()["ui-sortable"]&&n.container.sortable("option","connectWith",i),r.setConnectWith(n.parent,t))},addDraggableClassToContainer:function(){var n=this,r,t,u,i,f;if(n.isContainerDraggable()){if(n.container.addClass("ui-bizagi-draggable-item"),n.container.addClass("ui-dashed-layout"),n.properties.type==="horizontal"&&n.container.addClass("ui-table"),$(".ui-widget-content",n.container).children().length===0)$(".ui-widget-content",n.container).append('<div class="children"><\/div>');else if(n.container.hasClass("ui-bizagi-container-tab"))for(r=$(".ui-bizagi-container-tabItem",n.container),t=0;t<r.length;t++)u=$(r[t]),u.children().length===0&&u.append('<div class="children"><\/div>');if(!n.container.hasClass("ui-bizagi-container-nestedform")&&!n.container.hasClass("ui-bizagi-container-collectionnavigator"))for(i=$("> .ui-bizagi-container-panel",n.container),i.addClass("ui-col"),t=0;t<i.length;t++)f=$(i[t]),f.children().length===0&&f.append('<div class="children"><\/div>');n.container.hasClass("ui-dashed-layout")&&(n.container.data("display","Layout"),n.container.data("type","layout"));$("> .ui-bizagi-container-panel",n.container).mouseenter(function(){$(this).addClass("ui-col-hover")}).mouseleave(function(){$(this).removeClass("ui-col-hover")})}},isContainerDraggable:function(){var t=this,n;return t.isContainedInNestedForm()||t.isContainedInCollectionNavigator()?!1:(n=t.properties.type||"form",n=="group"||n=="nestedForm"||n=="tab"||n=="horizontal"||n=="contentPanel"||n=="collectionnavigator")?!0:!1},isContainerSortable:function(){var t=this,n;return t.isContainedInNestedForm()||t.isContainedInCollectionNavigator()?!1:(n=t.properties.type||"form",n=="form"||n=="group"||n=="panel"||n=="tabItem"||n=="queryForm"||n=="searchForm"||n=="contentPanel"||n=="offlineForm"||n=="adhocForm")?!0:!1},isElementSortAllowed:function(n){var i=this,t=i.getMode();if(t==="design"){if(n.hasClass("ui-bizagi-container-horizontal"))return!1}else if(t==="layout"&&n.hasClass("ui-bizagi-render"))return!1;return!0},isClickEventAllowed:function(){var t=this,i=t.getMode(),n;if(t.isContainedInNestedForm()||t.isContainedInCollectionNavigator())return!1;if(n=t.properties.type||"form",i=="design"){if(n=="panel")return!1}else if(i==="layout"&&(n=="form"||n=="group"||n=="panel"))return!1;return!0},sortableHelper:function(n){var u=this;if(!u.helperTemplate)return null;n.addClass("ui-dragging");var t=n.data(),f=t.type?t.type.toLowerCase():"render",e=t.guid,i=t.display,o=u.triggerGlobalHandler("getControlIcon",{type:f,id:e});i&&i!==""||(i=f);var s=$.tmpl(u.helperTemplate,{id:f,caption:i,icon:o}),r=s.appendTo(".wrapper-main-scroll").css({zIndex:900}),h=parseFloat($("label",r).width()),c=parseFloat($(".biz-ico",r).eq(0).width()),l=h+c+40+"px";return r.css("width",l),r},loadHelperTemplate:function(){var n=this;return $.when(bizagi.templateService.getTemplate(bizagi.getTemplate("bizagi.editor.component.renderingview").concat("#bizagi-render-drag-helper"))).pipe(function(t){return n.helperTemplate=t,n.helperTemplate})},getDragSource:function(n){var t={container:!1,toolbar:!1,xpathNavigator:!1,layout:!1,data:null};return $(n).hasClass("ui-bizagi-render")||$(n).hasClass("ui-bizagi-container")?(t.container=!0,t.data={guid:$(n).parents(".ui-bizagi-container").first().data("guid")}):$(n).hasClass("mtool-item")?(t.toolbar=!0,t.data=$(n).data("render")):$(n).hasClass("bizagi_editor_xpathnavigator_data")?(t.xpathNavigator=!0,t.data=$(n).data()):$(n).hasClass("bz-fm-layout-navigator-item")&&(t.layout=!0,t.data=$(n).data("id")),t},changeVisibility:function(n){var t=this,i=t.properties;i.visible=bizagi.util.parseBoolean(n);i.visible?$(t.container).removeClass("ui-state-disabled"):$(t.container).addClass("ui-state-disabled")},onSortStart:function(n){var t=this,i=$(n.item).parent().children(".ui-bizagi-itemfordrag").index(n.item),r;n.item.data("start-position",i);r=$(n.item).parents(".ui-bizagi-container").first().data("guid")||t.triggerGlobalHandler("getparentid",{guid:$(n.item).data("guid")});n.item.data("sourceContainer",r);i>=0&&t.triggerGlobalHandler("sortstart")},onSortFinish:function(n){var t=this;if(bizagi.sortContainerTimeout==null){bizagi.sortContainerTimeout=setTimeout(function(){bizagi.sortContainerTimeout=null},100);var i=$(n.item).parent().children(".ui-bizagi-itemfordrag").not(".ui-sortable-placeholder").index(n.item),r=$(n.item).parents(".ui-bizagi-container").first().data("guid")||t.triggerGlobalHandler("getparentid",{guid:$(n.item).data("guid")}),u=n.item.data("start-position"),f=n.item.data("sourceContainer");return t.isElementSortAllowed($(n.item))==!1?(t.container.sortable("cancel"),!1):(i>=0&&t.triggerGlobalHandler("sortfinish",{source:t.currentDragSource,initialPosition:u,finalPosition:i,sourceContainer:f,targetContainer:r}),!0)}},onClickCanvas:function(n){var t=this;n.stopImmediatePropagation();$(".ui-bizagi-render").removeClass("ui-state-active");$(".ui-bizagi-grid-cell").removeClass("ui-state-active");$(".ui-bizagi-container").removeClass("ui-bizagi-container-selected");t.unselectElement();(n.button==0||n.button==1)&&t.triggerGlobalHandler("selectcontainerform",{})},onClick:function(n){var t=this,i=t.container,r;n.stopImmediatePropagation();r=t.triggerGlobalHandler("checkCtrlKey",{});r?i.hasClass("ui-bizagi-container-selected")?t.unselectElement({ctrlIsPressed:!0}):t.selectElement({IsOnClickEvent:!0,ctrlIsPressed:!0}):(n.button==0||n.button==1)&&($(".ui-bizagi-render").removeClass("ui-state-active"),$(".ui-bizagi-container").not(i).removeClass("ui-bizagi-container-selected"),i.hasClass("ui-bizagi-container-selected")?t.unselectElement():t.selectElement({IsOnClickEvent:!0}))},onMouseDown:function(n){var t=this;if(n.button==0||n.button==1)t.setConnectWith(t.parent,t.container.data("guid"));else if(n.button==2)return t.triggerGlobalHandler("elementrightclick",{guid:t.properties.guid,position:{x:n.clientX,y:n.clientY}}),n.preventDefault(),n.stopPropagation(),!1}});
bizagi.rendering.form.original=$.extend(!0,{},bizagi.rendering.form.prototype);$.extend(bizagi.rendering.form.prototype,{postRenderContainer:function(n){var t=this,i,r;return bizagi.rendering.form.original.postRenderContainer.apply(this,arguments),i=typeof t.params.allowButtons!==undefined?t.params.allowButtons:!1,i||$(".ui-bizagi-button-container",n).remove(),t.properties.messageValidation&&t.properties.messageValidation.length>0&&(r=t.createMessageValidationElement(t.properties.messageValidation),n.prepend(r)),n},createMessageValidationElement:function(n){var i=this,r=bizagi.localization.getResource("formmodeler-validations-form"),t=$('<div class="ui-message-validation"/>');return $("<span>"+r+'<i class="biz-ico bz-studio bz-warning-red_16x16_standard" title="'+n+'"><\/i><\/span>').appendTo(t),$(t,"div").click(function(){i.triggerGlobalHandler("showPropertiesForm")}),t}});
bizagi.rendering.render.original=$.extend(!0,{},bizagi.rendering.render.prototype);$.extend(bizagi.rendering.render.prototype,{postRenderElement:function(n){var t=this,u=t.properties,i,r;return(bizagi.rendering.render.original.postRenderElement.apply(this,arguments),t.isReadOnlyForm())?n:(n.attr("guid",t.properties.guid),t.getFormType()=="template")?t.configureLayoutElement(n):(t.isContainedInNestedForm()||t.isContainedInCollectionNavigator()||(t.setMouseDownEvent(n),t.isContainedInGrid()||(n.addClass("ui-bizagi-draggable-item"),n.addClass("ui-bizagi-itemfordrag")),i=$(".ui-bizagi-render-search",n),i.length>0&&i.parent().addClass("ui-bizagi-display-as-search"),t.isClickEventAllowed()&&(r=t.getMode()=="design"&&t.properties.type=="grid"?t.getLabelGrid():t.getLabel(),n.click(function(i){t.onRenderClick(i,n)}),r.dblclick(function(){t.onLabelDoubleClick(r)}),t.properties.validationMessage&&t.showValidationMessage(t.properties.validationMessage))),n.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type}),t.resetStyle(n))},configureLayoutElement:function(n){var t=this;return t.configureDroppablePlugin(n),t.configureDraggablePlugin(n),n.click(function(i){t.onRenderClick(i,n)}),n.dblclick(function(){t.onLabelDoubleClick(n)}),n.find(".biz-template-editor-render-hide-control").click(function(i){t.onRemoveElement(i,n)}),t.setDeleteLayoutItem(n),n},setDeleteLayoutItem:function(n){var t=this,f=t.properties.type,r=$("<span class='biz-icon biz-tmpl-delete pull-right bz-studio bz-delete_16x16_standard'><\/span>"),u=$("<span class='biz-icon biz-tmpl-delete pull-right bz-studio bz-undo_16x16_black'><\/span>"),i=n.closest("[id]");setTimeout(function(){if(i.length==0&&t.triggerGlobalHandler("isDeleteOptionAllowed",{guid:t.properties.guid}))n.addClass("hover-applied"),n.hover(function(){$(this).append(u)},function(){$(this).find("span.biz-tmpl-delete").detach()}),function(){u.click(function(){t.triggerGlobalHandler("restoreItem",{guid:t.properties.guid})})}();else{if(i.attr("id")==undefined)return;if(i.hasClass("hover-applied"))return;i.addClass("hover-applied");i.hover(function(){$(this).append(r)},function(){$(this).find("span.biz-tmpl-delete").detach()}),function(n){r.click(function(){t.triggerGlobalHandler("deleteRepeaterItem",{guid:n.attr("id")})})}(i)}},10)},configureDraggablePlugin:function(n){var t=this;n.draggable({helper:"clone",zIndex:9999,opacity:.75,cursorAt:{left:5},containment:"document",cancel:".biz-template-editor-render-placeholder",start:function(n,t){$(t.helper).data("isLayoutElement",!0)}})},configureDroppablePlugin:function(n){var t=this;n.droppable({hoverClass:"ui-state-highlight",tolerance:"pointer",activeClass:"ui-editor-highlight",greedy:!0,drop:function(){$(this).addClass("ui-state-highlight")},activate:function(){t.getFormContainer().container.find("[noShow='true']").show()},deactivate:function(){t.getFormContainer().container.find("[noShow='true']").hide()}});n.on("drop",function(n,i){t.onDrop(i)})},getLabelGrid:function(){return $(".bz-rn-grid-header-title",this.element)},resetStyle:function(n){var t=n,u=this,i=t.css("color"),r=t.css("background-color");return i=="black"&&t.css("color",""),r=="white"&&t.css("background-color",""),t},selectElement:function(n){var t=this,r,u=t.properties,i;t.element&&(t.element.addClass("ui-state-active"),i=t.element.offset(),$.extend(i,{width:t.element.outerWidth(),height:t.element.outerHeight()}),r=$.extend(n,{position:i,guid:t.properties.guid,element:t.element,type:t.properties.type,isInternal:u.isInternal}),t.triggerGlobalHandler("selectelement",r))},unselectElement:function(n){var t=this;t.element.removeClass("ui-state-active");n&&$.extend(n,{guid:t.properties.guid});t.triggerGlobalHandler("unselectelement",n)},isClickEventAllowed:function(){var n=this,t=n.getMode();return t==="design"&&!(n.column||n.isColumn)?!0:!1},setMouseDownEvent:function(n){var t=this;t.isClickEventAllowed()&&n.bind("mousedown.contextmenu",function(n){return n.button==2?(t.triggerGlobalHandler("elementrightclick",{guid:t.properties.guid,position:{x:n.clientX,y:n.clientY}}),n.preventDefault(),n.stopPropagation(),!1):!0})},changeVisibility:function(n){var t=this,i=t.properties;bizagi.util.parseBoolean(n)==!0?$(t.element).removeClass("ui-state-disabled"):$(t.element).addClass("ui-state-disabled");i.visible=n},showValidationMessage:function(n){var t=this;t.setValidationMessage(n)},onRenderClick:function(n,t){var i=this,r;n.stopPropagation();n.preventDefault();r=i.triggerGlobalHandler("checkCtrlKey",{});r?t&&t.hasClass("ui-state-active")?i.unselectElement({ctrlIsPressed:!0}):($(document.activeElement).is("input")&&$(document.activeElement).closest(".bizagi_editor_component_properties").length>0&&($(document.activeElement).trigger("blur"),$(".bizagi_editor_component_properties").hide()),i.selectElement({IsOnClickEvent:!0,ctrlIsPressed:!0})):((n.button==0||n.button==1)&&($(".ui-bizagi-render").not(t).removeClass("ui-state-active"),$(".ui-bizagi-grid-cell").not(t).removeClass("ui-state-active"),$(".ui-bizagi-button").not(t).removeClass("bz-state-active"),$(".ui-bizagi-container").removeClass("ui-bizagi-container-selected"),$(".ui-bizagi-render-layout").not(t).removeClass("ui-state-active")),t&&t.hasClass("ui-state-active")?i.unselectElement():($(document.activeElement).is("input")&&$(document.activeElement).closest(".bizagi_editor_component_properties").length>0&&($(document.activeElement).trigger("blur"),$(".bizagi_editor_component_properties").hide()),i.selectElement({IsOnClickEvent:!0})))},onLabelDoubleClick:function(n){var t=this,i;t.triggerGlobalHandler("canChangeLabel",{guid:t.properties.guid})&&(t.triggerGlobalHandler("startlabeledition"),i=new bizagi.editor.component.editableLabel.presenter({label:n,value:t.properties.displayName}),i.subscribe("change",function(n,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})}),i.render())},onRemoveElement:function(){var n=this;n.triggerGlobalHandler("hideElement",{guid:n.properties.guid})},showElementLabelEditor:function(){var n=this;n.element.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||$("label",n.element).trigger("dblclick")},onDrop:function(n){var i=this,f=$(n.draggable),r=$(n.helper),t=f.data(),u=r.data(),e=bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity);i.triggerGlobalHandler("dropfinish",{guid:i.properties.guid,property:"xpath",value:e,renderType:t.nodeSubtype,sourceGuid:u&&u.isLayoutElement?r.attr("guid"):!1})}});
bizagi.rendering.group.original=$.extend(!0,{},bizagi.rendering.group.prototype);$.extend(bizagi.rendering.group.prototype,{postRenderContainer:function(n){var t=this,i,r;(bizagi.rendering.group.original.postRenderContainer.apply(this,arguments),t.isReadOnlyForm())||(i=n.find(".ui-bizagi-container-group-header:first a"),t.isInNestedform()||i.dblclick(function(){t.triggerGlobalHandler("startlabeledition");var n=new bizagi.editor.component.editableLabel.presenter({label:i,value:t.properties.displayName});n.subscribe("change",function(n,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})});n.render()}),r=t.properties.guid,setTimeout(function(){var n=t.triggerGlobalHandler("getLastInsertedElement");r==n&&(t.showElementLabelEditor(),t.triggerGlobalHandler("setLastInsertedElement",null))},0))},disableSortablePlugin:function(){var t=this,i=t.container.find(".ui-bizagi-container-group-wrapper"),n,r;for(i&&i.hasClass("ui-sortable")&&i.data()["ui-sortable"]&&i.sortable("destroy"),n=0,r=t.children.length;n<r;n=n+1)t.children[n].container&&t.children[n].disableSortablePlugin()},configureSortablePlugin:function(n){var t=this;return n=n.find(".ui-bizagi-container-group-wrapper"),bizagi.rendering.group.original.configureSortablePlugin.apply(this,arguments)},isInNestedform:function(){var i=this,n,t,r=!1;t=i.properties;n=i.parent;do if(t.type=="nestedForm"||t.type=="collectionnavigator"){r=!0;break}else t=n.properties,n=n.parent;while(n!==undefined);return r},showElementLabelEditor:function(){var n=this;n.container.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||n.container.find("a:first").trigger("dblclick")}});
bizagi.rendering.contentPanel.original=$.extend(!0,{},bizagi.rendering.contentPanel.prototype);$.extend(bizagi.rendering.contentPanel.prototype,{postRenderContainer:function(n){var t=this,i;bizagi.rendering.contentPanel.original.postRenderContainer.apply(this,arguments);n.addClass("ui-bizagi-container-contentpanel-formmodeler");i=n.find(".ui-bizagi-container-contentpanel-header");i.dblclick(function(){i.hide();t.triggerGlobalHandler("startlabeledition");var n=new bizagi.editor.component.editableLabel.presenter({label:i,value:t.properties.displayName});n.subscribe("change",function(n,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})});$.when(n.render()).done(function(){t.getElement().find(".ui-bizagi-container-input-editable").length==0?setTimeout(function(){i.hide();t.adjustEditLabel()},100):t.adjustEditLabel()})})},configureSortablePlugin:function(n){var t=this;return n=n.find(".ui-bizagi-container-contentpanel-wrapper"),bizagi.rendering.contentPanel.original.configureSortablePlugin.apply(this,arguments)},disableSortablePlugin:function(){var t=this,i=t.container.find(".ui-bizagi-container-contentpanel-wrapper"),n,r;for(i&&i.hasClass("ui-sortable")&&i.data()["ui-sortable"]&&i.sortable("destroy"),n=0,r=t.children.length;n<r;n=n+1)t.children[n].container&&t.children[n].disableSortablePlugin()},adjustEditLabel:function(){var n=this;n.getElement().find(".ui-bizagi-container-input-editable").css({width:"95%","background-color":"orange",top:"-18px","border-radius":"10px"});n.getElement().find(".ui-bizagi-container-input-editable input").css({"margin-left":"5px",width:"90%"});n.getElement().find(".ui-bizagi-render-confirmation").css({right:"10px",top:"5px"})},showElementLabelEditor:function(){var n=this;n.container.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||n.container.find("span:first").trigger("dblclick")}});
bizagi.rendering.tab.original=$.extend(!0,{},bizagi.rendering.tab.prototype);$.extend(bizagi.rendering.tab.prototype,{postRenderContainer:function(n){var t=this,u=t.properties,i,r;if(bizagi.rendering.tab.original.postRenderContainer.apply(this,arguments),!t.isReadOnlyForm()){t.isContainedInNestedForm()||t.isContainedInCollectionNavigator()||($(".bz-render-tab-add",n).click(function(n){return n.stopImmediatePropagation(),t.triggerGlobalHandler("addtab",{guid:u.guid}),!1}),$.each(t.children,function(t,i){var r=$("li[data-tab-guid="+i.properties.guid+"]",n);i.setTabHeader(r)}),i=$(".ui-tabs-nav",n),i.sortable({items:"li[data-tab-guid]",revert:!0,distance:10,axis:"x",cursorAt:{top:-3,left:0},placeholder:"ui-bizagi-tab-placeholder",delay:150,start:function(n,i){t.sortStart(n,i)},tolerance:"pointer",stop:function(n,i){t.sortFinish(n,i)}}),r=$(".ui-tabs-nav li",n),r.unbind("keydown"));n.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type});n.on("tabsload",function(){t.triggerGlobalHandler("controlRefreshCanvas",{})}).on("tabsactivate",function(){t.triggerGlobalHandler("controlRefreshCanvas",{})})}},sortStart:function(n,t){var r=this,i=$(t.item).parent().children("li[data-tab-guid]").not(".ui-bizagi-tab-placeholder").index(t.item);return t.item.data("start-position",i),r.initialPosition=i,!0},sortFinish:function(n,t){var i=this,r=$(t.item).parent().children("li[data-tab-guid]").not(".ui-bizagi-tab-placeholder").index(t.item);return i.triggerGlobalHandler("sortfinish",{source:{},initialPosition:t.item.data("start-position")||i.initialPosition,finalPosition:r,sourceContainer:i.properties.guid,targetContainer:i.properties.guid}),!0}});
bizagi.rendering.tabItem.original=$.extend(!0,{},bizagi.rendering.tabItem.prototype);$.extend(bizagi.rendering.tabItem.prototype,{setTabHeader:function(n){var t=this,i=t.properties;t.isContainedInNestedForm()||t.isContainedInCollectionNavigator()||($(".bz-render-tab-delete",n).click(function(){return t.triggerGlobalHandler("deletetab",{guid:i.guid}),!1}),$(".bz-render-tab-edit",n).click(function(){t.isEditableLabelActive()||t.editDisplayName(n)}),n.dblclick(function(){t.isEditableLabelActive()||t.editDisplayName(n)}).click(function(n){n.stopImmediatePropagation();t.isEditableLabelActive()||t.triggerGlobalHandler("showProperties",{guid:t.properties.guid,redraw:!0})}).mousedown(function(n){n.button===2&&(n.stopImmediatePropagation(),t.isEditableLabelActive()||t.triggerGlobalHandler("elementrightclick",{guid:t.properties.guid,position:{x:n.clientX,y:n.clientY}}))}),n.droppable({accept:".ui-bizagi-draggable-item",hoverClass:"ui-bizagi-tab-drop-hover",tolerance:"pointer",drop:function(n,i){t.dropRender(n,i)},activate:function(n,i){t.currentDragSource=t.getDragSource(i.draggable)}}))},activate:function(){var n=this;bizagi.rendering.tabItem.original.activate.apply(this,arguments);n.triggerGlobalHandler("activatetab",{guid:n.properties.guid})},editDisplayName:function(n){var t=this,r=$("a",n),i;t.triggerGlobalHandler("startlabeledition");i=t.editableLabelPresenter=new bizagi.editor.component.editableLabel.presenter({label:r,value:t.properties.displayName});i.subscribe("change",function(n,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})});i.subscribe("keyup",function(t,i){n.find(".ui-bizagi-container-input-editable").width(bizagi.measureString(i.value)+100)});i.render()},isEditableLabelActive:function(){var n=this;return n.editableLabelPresenter&&n.editableLabelPresenter.editableLabel?!0:!1},dropRender:function(n,t){var i=this;if(n.originalEvent.type==="mouseup"){var u=i.children.length,f=i.properties.guid,e=t.draggable?t.draggable.data("start-position"):null,o=t.draggable?t.draggable.data("sourceContainer"):null,r=i.currentDragSource;if(bizagi.editor.utilities.isObject(r)){if(bizagi.sortContainerTimeout!=null)return;bizagi.sortContainerTimeout=setTimeout(function(){bizagi.sortContainerTimeout=null},100);i.triggerGlobalHandler("sortfinish",{source:r,initialPosition:e,finalPosition:u,sourceContainer:o,targetContainer:f})}}}});
bizagi.rendering.search.original=$.extend(!0,{},bizagi.rendering.search.prototype);$.extend(bizagi.rendering.search.prototype,{postRender:function(){var n=this;(bizagi.rendering.search.original.postRender.apply(this,arguments),n.isReadOnlyForm())||n.advancedSearch&&!n.isContainedInNestedForm()&&n.advancedSearch.click(function(t){t.stopPropagation();n.triggerGlobalHandler("showsearchform",{guid:n.properties.guid})})}});
bizagi.rendering.imageNoFlash.original=$.extend(!0,{},bizagi.rendering.imageNoFlash.prototype);$.extend(bizagi.rendering.imageNoFlash.prototype,{postRender:function(){var n=this,t=n.getControl(),i=n.properties.width,r=n.parent.properties.type;bizagi.rendering.imageNoFlash.original.postRender.apply(this,arguments);setTimeout(function(){var s,h;if(i===-1){var f=$(".resizable_img",t),c=t.width(),o=t.height(),u=0,e=0;r=="grid"?u=$(".resizable_img",t).closest("td").height():n.parent.properties.id==n.getFormContainer().properties.id?u=50:(s=n.parent.getChildreCount(),h=n.parent.getChildrenSumHeight("image"),u=$(".resizable_img",t).closest(".ui-bizagi-container").height()-17,u=u<50?50:u,e=n.parent.countByRenderTypeWithParams("image",-1),s>1&&(u=u-h));f.width(c);e>1?null!=u&&u>0?$(".resizable_img",n.parent.container).height(u/e+"px"):$(".resizable_img",t).height(o+"px"):null!=u&&u>0?f.height(u+"px"):f.height(o+"px")}n.triggerGlobalHandler("controlRefreshCanvas")},160)},changeImageSize:function(n,t){var i=this,r=i.getControl();i.executeTriggerHandler(r,n,t,"string")},executeTriggerHandler:function(n,t,i,r){var e=this,u="",f="";r=="string"?(u=t.slice(0,-2),f=i.slice(0,-2)):(u=t,f=i);e.triggerGlobalHandler("resizeImage",{guid:e.properties.guid,properties:[{property:"thumbnail.width",value:u},{property:"thumbnail.height",value:f}]})}});
bizagi.rendering.collectionnavigator.original=$.extend(!0,{},bizagi.rendering.collectionnavigator.prototype);$.extend(bizagi.rendering.collectionnavigator.prototype,{postRender:function(){var n=this;bizagi.rendering.collectionnavigator.original.postRender.apply(this,arguments);$.when(n.isRendered()).done(function(){var t=n.properties,i=n.getControl(),r=i.find(".bz-collectionnavigator-navigationform");t.navigationform&&setTimeout(function(){n.triggerGlobalHandler("refreshControl",{guid:t.guid,canvas:r})},0)})}});
bizagi.rendering.date.original=$.extend(!0,{},bizagi.rendering.date.prototype);$.extend(bizagi.rendering.date.prototype,{setDisplayValue:function(){var r=this,i,u;bizagi.rendering.date.original.setDisplayValue.apply(this,arguments);var n=r.properties,f=r.getDateControl().parent(),t=$(".ui-bizagi-render-date",f);n.valueFormat.color&&n.valueFormat.color.length>0&&(i="bz-"+n.valueFormat.color.replace("#","")+"-placeholder",u="."+i+"::-webkit-input-placeholder{color:"+n.valueFormat.color+"}",bizagi.util.loadStyle(u,i),t.addClass(i));n.valueFormat.strikethru&&n.valueFormat.underline?t.addClass("biz-modify-placeholder-through-underline"):(t.removeClass("biz-modify-placeholder-through-underline"),n.valueFormat.strikethru?t.addClass("biz-modify-placeholder-through"):t.removeClass("biz-modify-placeholder-through"),n.valueFormat.underline?t.addClass("biz-modify-placeholder-underline"):t.removeClass("biz-modify-placeholder-underline"))}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.moveElementContainerCommand",{},{execute:function(){var n=this,t=n.arguments;return n.element||(n.element=n.model.findElementByPosition(t.posIni,t.parentSource)),n.controller.executeCommand({command:"removeElement",position:t.posIni,parent:t.parentSource,canUndo:!1}),n.controller.executeCommand({command:"insertElement",position:t.posEnd,parent:t.parentTarget,element:n.element,canUndo:!1}),!0},undo:function(){var n=this,t=n.arguments;return n.controller.executeCommand({command:"removeElement",position:t.posEnd,parent:t.parentTarget,canUndo:!1}),n.controller.executeCommand({command:"insertElement",position:t.posIni,parent:t.parentSource,element:n.element,canUndo:!1}),!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.removeElementCommand",{},{execute:function(){var n=this,t=n.arguments,r=n.controller.getContextInfo(),i=n.arguments.parent||r.guid;return t.canValidate=!0,n.arguments.position!==undefined?n.model.removeElement(t.position,i,t.element):n.model.removeLastElement(i),!0},undo:function(){return!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.insertElementCommand",{},{execute:function(){var n=this,r=n.controller.getContextInfo(),t=n.arguments.parent||r.guid,i;return n.validateModel(t)?(n.arguments.canValidate=!0,n.arguments.position!==undefined?n.model.insertElement(n.arguments.position,t,n.arguments.element):(i=n.model.addElement(n.arguments.element,t),n.arguments.position=i),n.controller.executeCommand({command:"applyOverridesElement",overrides:{properties:!0,requiredProperties:!0},guid:n.arguments.element.guid,canUndo:!1}),!0):!1},undo:function(){var n=this,t=n.controller.getContextInfo(),i=n.arguments.parent||t.guid;return n.model.removeElement(n.arguments.position,i),!0},validateModel:function(n){var r=this,i=!0,u=r.controller.getContext(),t;return u=="offlinegrid"&&(t=r.model.getElement(n),t&&$.isArray(t.elements)&&(i=t.elements.length<=3),i||bizagi.showMessageBox(bizagi.localization.getResource("formmodeler-component-gridcolumneditor-offline-max-columns"),"","warning",!1)),i}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.insertButtonCommand",{},{execute:function(){var n=this,r=n.controller.getContextInfo(),u=n.arguments.parent||r.guid,t=Math.guid(),i=n.createElement({guid:t,type:"formbutton",caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("formmodeler-component-editor-newbutton"),t,"caption")});return n.model.addButton(i),n.arguments.guid=i.guid,!0},undo:function(){var n=this;return n.model.removeElementById(n.arguments.guid),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getElementPropertiesCommand",{},{execute:function(){var n=this,t=n.arguments;return bizagi.editor.utilities.isGuidEmpty(t.guid)?n.processMultiselect():n.getElementProperties(t.guid),!0},searchContext:function(n,t){var i=this;return i.controller.isGridContext()?bizagi.editor.utilities.resolveContextEntityFromXpath(n):t?bizagi.editor.utilities.resolveRelatedEntityFromXpath(n):void 0},getElementProperties:function(n){var t=this,r=t.arguments,i=t.model.getElement(n);t.arguments.result=bizagi.clone(i.properties);i.properties.xpath&&$.extend(t.arguments.result,{context:t.searchContext(i.properties.xpath,r.getContext)})},processMultiselect:function(){var n=this,t;n.controller.isGridContext()?(t=n.controller.getGuidsSelected(),n.getElementProperties(t[0])):n.arguments.result=null}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getFormPropertiesModelCommand",{},{execute:function(){var n=this,r=n.arguments,i=n.model.getPropertiesModel(),t;return r.showValidations&&(t=n.model.getFormValidations(),t&&(i.validations=bizagi.clone(t))),n.arguments.result=i,!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getPropertiesModelCommand",{},{execute:function(){var n=this,i=n.arguments,r=n.model.getElement(i.guid),u=n.getPropertiesModel(r),t;return i.showValidations&&(t=r.getFormValidations(),t&&(u.validations=bizagi.clone(t))),n.arguments.result=u,!0},getPropertiesModel:function(n){var r=this,t,i;return t=n.getPropertiesModel(),t=r.resolveDependencies(t),i=n.getPropertiesExternal(),$.extend(t,i),t},resolveDependencies:function(n){var t=this,i;if(n.elements.length>1)throw"No code for this case";else i=n.elements[0].tabs,t.map={},t.generateElementMap(i,""),t.resolveAllDependencies(n),t.resolveSpecificDependencies(n);return n},generateElementMap:function(n,t){for(var s=this,i,f,e,u,h,o=s.map,r=0;r<n.length;r++)u="",n[r].property!==undefined?(i=n[r].property,u=i.subproperties!==undefined?"(property.subproperties)":"(property)"):n[r].group!==undefined?(i=n[r].group,u="(group.elements)"):n[r].category!==undefined?(i=n[r].category,u="(category)"):(i=n[r],u="(elements)"),e=t+""+r+u,i.name!==undefined&&i["bas-type"]!==undefined&&(i.subproperties!==undefined?(h=t+""+r+"(property)",o[i.name]=h):o[i.name]=e),f=i.elements!==undefined?i.elements:i.subproperties!==undefined?i.subproperties:undefined,f!==undefined&&$.isArray(f)&&f.length>0&&s.generateElementMap(f,e)},resolveAllDependencies:function(n){var s=this,r,u,f,e,o,t,i;for(r=n.elements[0].tabs,e=r.length,t=0;t<e;t++)for(u=r[t],o=u.elements.length,i=0;i<o;i++)f=u.elements[i].property,f!==undefined&&s.resolveEditorParametersRule(f,n)},resolveEditorParametersRule:function(n,t){var o=this,f,r,i,u,e;if(n["editor-parameters"]!==undefined){r=n["editor-parameters"];for(f in r)r[f]&&r[f].rule!==undefined&&(i=r[f].rule,i.search(/^<.*>$/)!=-1&&(i=i.substring(1,i.length-1),u=i.split(":"),u.length>1&&u[0]=="design"&&(e=u[1],u[2]===undefined&&o.updateDependency(n.name,e,"editorParameters",t))))}},processRules:function(n,t){var i=this;bizagi.editor.component.properties.processrules(n,t,i.map)},updateDependency:function(n,t,i,r){var f=this,u=f.getMapAttribute(t,"value",r);if(typeof u!="undefined")if(u===!1||u=="false")u=!1;else if(u===!0||u=="true")u=!0;else throw"value is "+u;f.setMapAttributeEditorParameter(n,t,u,r)},surfModel:function(n,t,i){var u=undefined,r;if(r=n.split("."),r.length>1)switch(r[0]){case"group":r[1]=="elements"&&(u=i[t][r[0]][r[1]]);break;case"property":r[1]=="subproperties"&&(u=i[t][r[0]][r[1]])}else switch(n){case"elements":u=i.elements[0].tabs[t][n];break;case"property":u=i[t][n]}return u},setMapAttributeWithChangeProperty:function(n,t,i,r){var u=this;u.setMapAttribute(n,t,i,r);u.controller.executeCommand({command:"changeProperty",guid:r.idRender,property:n,value:i,canUndo:!1})},setMapAttribute:function(n,t,i,r){var f=this,u;if(u=f.getPropertyFromMap(n,r),u)u[t]=i;else throw"Error with the reference (set)";},getMapAttribute:function(n,t,i){var f=this,r,u;if(r=f.getPropertyFromMap(n,i),r)u=r[t];else throw"Error with the reference (get)";return u},getPropertyFromMap:function(n,t){for(var f=this,e,h=f.map,o=h[n],s=o.match(/\d+/g),r=o.match(/\(([a-z]+|\.)+\)/g),u=t,i=0;i<s.length&&i<r.length;i++)e=r[i].substring(1,r[i].length-1),u=f.surfModel(e,s[i],u);return u},setMapAttributeEditorParameter:function(n,t,i,r){var f=this,u;if(u=f.getPropertyFromMap(n,r),u)u["editor-parameters"][t].value=i;else throw"Error with the reference for editor parameter (set)";},resolveSpecificDependencies:function(n){var t=this;t.resolveDatalistSubproperties(n);t.resolveDependenciesFromXpathForCombos(n);t.resolveDependenciesFromXpathForSearch(n);t.resolveDependenciesFromXpathForGrid(n);t.getRenderType(n)==="grid"&&t.updateFormsProperties(n);t.getRenderType(n)==="groupedgrid"&&t.updateGroupedGridProperties(n);t.getRenderType(n)==="offlinegrid"&&t.updateOfflineGridProperties(n);t.getRenderType(n)==="collectionnavigator"&&t.updateCollectionNavigatorProperties(n);(t.getRenderType(n)==="text"||t.getRenderType(n)==="columntext")&&t.updateText(n);t.getRenderType(n)==="actionlauncher"&&t.updateActionLauncher(n);t.getRenderType(n)==="entitytemplate"&&t.updateEntityTemplate(n);t.updateDecimalsForNumbers(n);t.updateMultipleSearch(n);t.resolveDocumentTemplatesButtonsVisibilityByAllowgenerate(n);t.resolveBindingButtonVisibility(n);t.resolveUserConfirmationMessageVisibility(n);t.resolveGroupProperties(n)},resolveDatalistSubproperties:function(n){var t=this,f=t.map,i,u,e,r;if(f.xpath!==undefined&&f.data!==undefined)if(i=t.getMapAttribute("xpath","value",n),i!==null&&typeof i=="object")for(t.hasMapProperty("data","notShow",n)&&t.deleteMarkNotShow("data",n),u=t.getMapAttribute("data","subproperties",n),r=0;r<u.length;r++)e=u[r].property,t.resolveDatalistSubpropertiesRule(e,i,n);else t.insertMarkNotShow("data",n)},resolveDependenciesFromXpathForCombos:function(n){var t=this,i;t.areThesePropertiesInMap(["xpath","data.displayattrib","data.additionalattrib","data.sortattribute","data.filter"])&&(i=t.getMapAttribute("xpath","value",n),i!==null&&typeof i=="object"?(t.deleteMarkNotShow("data.displayattrib",n),t.deleteMarkNotShow("data.additionalattrib",n),t.deleteMarkNotShow("data.sortattribute",n),t.deleteMarkNotShow("data.filter",n)):(t.insertMarkNotShow("data.displayattrib",n),t.insertMarkNotShow("data.additionalattrib",n),t.insertMarkNotShow("data.sortattribute",n),t.insertMarkNotShow("data.filter",n)))},resolveDependenciesFromXpathForSearch:function(n){var t=this,i;t.areThesePropertiesInMap(["xpath","searchforms","data.displayattrib","data.filter"])&&(i=t.getMapAttribute("xpath","value",n),i!==null&&typeof i=="object"?(t.deleteMarkNotShow("data.displayattrib",n),t.deleteMarkNotShow("data.filter",n)):(t.insertMarkNotShow("data.displayattrib",n),t.insertMarkNotShow("data.filter",n)))},resolveDependenciesFromXpathForGrid:function(n){var t=this,i,r;t.areThesePropertiesInMap(["xpath","gridvalidations","data.sortattribute","data.filter"])&&(i=t.getMapAttribute("xpath","value",n),i!==null&&typeof i=="object"?(t.deleteMarkNotShow("data.sortattribute",n),t.deleteMarkNotShow("data.filter",n),t.areThesePropertiesInMap(["data.sortattribute","data.sortorder"])&&(r=t.getMapAttribute("data.sortattribute","value",n),r!==null&&typeof r=="object"?t.deleteMarkNotShow("data.sortorder",n):t.insertMarkNotShow("data.sortorder",n))):(t.insertMarkNotShow("data.sortattribute",n),t.insertMarkNotShow("data.filter",n),t.areThesePropertiesInMap(["data.sortattribute","data.sortorder"])&&t.insertMarkNotShow("data.sortorder",n)))},resolveDocumentTemplatesButtonsVisibilityByAllowgenerate:function(n){var t=this,i;t.areThesePropertiesInMap(["validate","allowgenerate"])&&(i=t.getMapAttribute("allowgenerate","value",n),i&&t.hasMapProperty("validate","notShow",n)?t.deleteMarkNotShow("validate",n):i||(t.insertMarkNotShow("validate",n),t.setMapAttributeWithChangeProperty("validate","value",!1,n)))},resolveBindingButtonVisibility:function(n){var t=this,r=t.map,i;t.areThesePropertiesInMap(["xpath","groupmapping"])&&(i=t.getMapAttribute("xpath","value",n),i!==null&&typeof i=="object"?t.hasMapProperty("groupmapping","notShow",n)&&t.deleteMarkNotShow("groupmapping",n):t.insertMarkNotShow("groupmapping",n))},deleteMarkNotShow:function(n,t){this.setMapAttribute(n,"notShow",undefined,t)},insertMarkNotShow:function(n,t){this.setMapAttribute(n,"notShow",!0,t)},resolveDatalistSubpropertiesRule:function(n,t,i){var f=this,u,r;n["user-editable"]=="true"&&n.value!==null&&typeof n.value=="string"&&n.value.search(/^<.*>$/)!=-1&&(u=n.value.substring(1,n.value.length-1),r=u.split(":"),r[0]=="design"&&r[1]=="xpath"&&r[2]=="relatedentity"&&f.updateValueMapForSubproperty(n.name,t,i))},hasMapProperty:function(n,t,i){var u=this,r;return r=u.getPropertyFromMap(n,i),r[t]!==undefined},updateValueMapForSubproperty:function(n,t,i){this.setMapAttribute(n,"value",t,i)},updateMultipleSearch:function(n){var t=this,i;t.areThesePropertiesInMap(["newrecords"])&&(i=t.getMapAttribute("newrecords","value",n),t.isFalsifiable(i.allownew)?t.insertMarkNotShow("newrecords.allownewform",n):t.deleteMarkNotShow("newrecords.allownewform",n))},isFalsifiable:function(n){var t=!1;return n===undefined||n===null||n===!1||n=="false"?t=!0:(n===!0||n=="true")&&(t=!1),t},updateDecimalsForNumbers:function(n){var t=this,i;t.areThesePropertiesInMap(["allowdecimals","numdecimals"])&&(i=t.getMapAttribute("allowdecimals","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("numdecimals",n):t.deleteMarkNotShow("numdecimals",n))},resolveUserConfirmationMessageVisibility:function(n){var t=this;t.areThesePropertiesInMap(["userconfirmation.needsuserconfirmation"])&&(value=t.getMapAttribute("userconfirmation.needsuserconfirmation","value",n),t.isFalsifiable(value)?t.insertMarkNotShow("userconfirmation.userconfirmationmessage",n):t.deleteMarkNotShow("userconfirmation.userconfirmationmessage",n))},setMapAttributesWithChangeMultipleProperties:function(n,t){for(var r=this,i=0;i<n.length;i++)r.setMapAttribute(n[i].property,"value",n[i].value,t);r.controller.executeCommand({command:"changeMultipleProperties",properties:n,guid:t.idRender})},updateInlineaddAndWithform:function(n){var t=this;t.controller.mem===undefined?(t.controller.mem={},t.controller.mem[n.idRender]={},t.controller.mem[n.idRender].inlineadd=t.isFalsifiable(t.getMapAttribute("inlineadd","value",n))?!1:!0,t.controller.mem[n.idRender]["add.withform"]=t.isFalsifiable(t.getMapAttribute("add.withform","value",n))?!1:!0):t.controller.mem[n.idRender]===undefined&&(t.controller.mem[n.idRender]={},t.controller.mem[n.idRender].inlineadd=t.isFalsifiable(t.getMapAttribute("inlineadd","value",n))?!1:!0,t.controller.mem[n.idRender]["add.withform"]=t.isFalsifiable(t.getMapAttribute("add.withform","value",n))?!1:!0);t.controller.mem[n.idRender]!==undefined&&(t.isFalsifiable(t.getMapAttribute("inlineadd","value",n))!=t.isFalsifiable(t.controller.mem[n.idRender].inlineadd)?t.isFalsifiable(t.getMapAttribute("inlineadd","value",n))?(t.setMapAttributesWithChangeMultipleProperties([{property:"inlineadd",value:!1},{property:"add.withform",value:!0}],n),t.controller.mem[n.idRender].inlineadd=!1,t.controller.mem[n.idRender]["add.withform"]=!0):(t.setMapAttributesWithChangeMultipleProperties([{property:"inlineadd",value:!0},{property:"add.withform",value:!1}],n),t.controller.mem[n.idRender].inlineadd=!0,t.controller.mem[n.idRender]["add.withform"]=!1):t.isFalsifiable(t.getMapAttribute("add.withform","value",n))?(t.setMapAttributesWithChangeMultipleProperties([{property:"inlineadd",value:!0},{property:"add.withform",value:!1}],n),t.controller.mem[n.idRender].inlineadd=!0,t.controller.mem[n.idRender]["add.withform"]=!1):(t.setMapAttributesWithChangeMultipleProperties([{property:"inlineadd",value:!1},{property:"add.withform",value:!0}],n),t.controller.mem[n.idRender].inlineadd=!1,t.controller.mem[n.idRender]["add.withform"]=!0))},updateFormsProperties:function(n){var t=this,i,r;t.areThesePropertiesInMap(["allowadd","add.addlabel","inlineadd","add.withform","add.addform"])&&(i=t.getMapAttribute("allowadd","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("add.addlabel",n),t.insertMarkNotShow("inlineadd",n),t.insertMarkNotShow("add.withform",n),t.insertMarkNotShow("add.addform",n),t.insertMarkNotShow("add.validationrule",n),t.setMapAttribute("add.withform","value",!1,n)):(t.deleteMarkNotShow("add.addlabel",n),t.deleteMarkNotShow("inlineadd",n),t.insertMarkNotShow("add.withform",n),t.deleteMarkNotShow("add.addform",n),t.deleteMarkNotShow("add.validationrule",n)),t.updateInlineaddAndWithform(n),t.areThesePropertiesInMap(["add.withform","add.addform"])&&(i=t.getMapAttribute("add.withform","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("add.addform",n),t.insertMarkNotShow("add.validationrule",n)):t.isFalsifiable(t.getMapAttribute("allowadd","value",n))||(t.deleteMarkNotShow("add.addform",n),t.deleteMarkNotShow("add.validationrule",n))));t.areThesePropertiesInMap(["delete.allowdelete","delete.deletelabel","delete.validationrule"])&&(i=t.getMapAttribute("delete.allowdelete","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("delete.deletelabel",n),t.insertMarkNotShow("delete.validationrule",n)):(t.deleteMarkNotShow("delete.deletelabel",n),t.deleteMarkNotShow("delete.validationrule",n)));t.areThesePropertiesInMap(["allowedit","edit.editlabel","edit.editform","edit.validationrule","edit.inlineedit"])&&(i=t.getMapAttribute("allowedit","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("edit.editlabel",n),t.insertMarkNotShow("edit.inlineedit",n),t.insertMarkNotShow("edit.withform",n),t.insertMarkNotShow("edit.editform",n),t.insertMarkNotShow("edit.validationrule",n),t.setMapAttributeWithChangeProperty("edit.withform","value","false",n)):(t.deleteMarkNotShow("edit.editlabel",n),t.deleteMarkNotShow("edit.inlineedit",n),t.insertMarkNotShow("edit.withform",n),t.deleteMarkNotShow("edit.editform",n),t.deleteMarkNotShow("edit.validationrule",n),r=t.getMapAttribute("edit.editform","value",n),t.isFalsifiable(r)||$.isEmptyObject(r)?t.setMapAttributeWithChangeProperty("edit.withform","value","false",n):t.setMapAttributeWithChangeProperty("edit.withform","value","true",n)));t.areThesePropertiesInMap(["allowdetail","detail.detaillabel","detail.detailform"])&&(i=t.getMapAttribute("allowdetail","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("detail.detaillabel",n),t.insertMarkNotShow("detail.detailform",n)):(t.deleteMarkNotShow("detail.detaillabel",n),t.deleteMarkNotShow("detail.detailform",n)));t.areThesePropertiesInMap(["totalize.operation"])&&(i=t.getMapAttribute("totalize.operation","value",n),bizagi.util.isEmpty(i)?t.insertMarkNotShow("totalize.format",n):t.deleteMarkNotShow("totalize.format",n))},updateOfflineGridProperties:function(n){var t=this,i;t.areThesePropertiesInMap(["add.allowadd","add.addlabel"])&&(i=t.getMapAttribute("add.allowadd","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("add.addlabel",n):t.deleteMarkNotShow("add.addlabel",n));t.areThesePropertiesInMap(["delete.allowdelete","delete.deletelabel"])&&(i=t.getMapAttribute("delete.allowdelete","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("delete.deletelabel",n):t.deleteMarkNotShow("delete.deletelabel",n))},updateCollectionNavigatorProperties:function(n){var t=this,i,r;t.areThesePropertiesInMap(["allowadd","add.inlineadd","add.addform","add.validationrule"])&&(i=t.getMapAttribute("allowadd","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("add.inlineadd",n),t.insertMarkNotShow("add.addform",n),t.insertMarkNotShow("add.validationrule",n)):(t.deleteMarkNotShow("add.inlineadd",n),t.deleteMarkNotShow("add.addform",n),t.deleteMarkNotShow("add.validationrule",n)),t.isFalsifiable(i)||(i=t.getMapAttribute("add.addform","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("add.validationrule",n):t.deleteMarkNotShow("add.validationrule",n)));t.areThesePropertiesInMap(["allowedit","edit.editform","edit.inlineedit","edit.validationrule"])&&(i=t.getMapAttribute("allowedit","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("edit.inlineedit",n),t.insertMarkNotShow("edit.editform",n),t.insertMarkNotShow("edit.validationrule",n)):(t.deleteMarkNotShow("edit.inlineedit",n),t.deleteMarkNotShow("edit.editform",n),t.deleteMarkNotShow("edit.validationrule",n)),t.isFalsifiable(i)||(i=t.getMapAttribute("edit.editform","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("edit.validationrule",n):t.deleteMarkNotShow("edit.validationrule",n)));t.areThesePropertiesInMap(["delete.allowdelete","delete.validationrule"])&&(i=t.getMapAttribute("delete.allowdelete","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("delete.validationrule",n):t.deleteMarkNotShow("delete.validationrule",n));t.areThesePropertiesInMap(["allowdetail","detail.detailform"])&&(i=t.getMapAttribute("allowdetail","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("detail.detailform",n):t.deleteMarkNotShow("detail.detailform",n));t.areThesePropertiesInMap(["xpath","data.sortattribute","data.filter","data.sortorder"])&&(r=t.getMapAttribute("xpath","value",n),r!==null&&typeof r=="object"?(t.deleteMarkNotShow("data.sortattribute",n),t.deleteMarkNotShow("data.filter",n),i=t.getMapAttribute("data.sortattribute","value",n),i!==null&&typeof i=="object"?t.deleteMarkNotShow("data.sortorder",n):t.insertMarkNotShow("data.sortorder",n)):(t.insertMarkNotShow("data.sortattribute",n),t.insertMarkNotShow("data.filter",n),t.insertMarkNotShow("data.sortorder",n)))},updateGroupedGridProperties:function(n){var t=this,i;t.areThesePropertiesInMap(["allowadd","add.addform","add.addlabel","add.validationrule"])&&(i=t.getMapAttribute("allowadd","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("add.addform",n),t.insertMarkNotShow("add.addlabel",n),t.insertMarkNotShow("add.validationrule",n)):(t.deleteMarkNotShow("add.addform",n),t.deleteMarkNotShow("add.addlabel",n),t.deleteMarkNotShow("add.validationrule",n)),t.isFalsifiable(i)||(i=t.getMapAttribute("add.addform","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("add.validationrule",n):t.deleteMarkNotShow("add.validationrule",n)));t.areThesePropertiesInMap(["allowedit","edit.editform","edit.editlabel","edit.validationrule"])&&(i=t.getMapAttribute("allowedit","value",n),t.isFalsifiable(i)?(t.insertMarkNotShow("edit.editlabel",n),t.insertMarkNotShow("edit.editform",n),t.insertMarkNotShow("edit.validationrule",n)):(t.deleteMarkNotShow("edit.editlabel",n),t.deleteMarkNotShow("edit.editform",n),t.deleteMarkNotShow("edit.validationrule",n)),t.isFalsifiable(i)||(i=t.getMapAttribute("edit.editform","value",n),t.isFalsifiable(i)?t.insertMarkNotShow("edit.validationrule",n):t.deleteMarkNotShow("edit.validationrule",n)))},updateText:function(n){var t=this,i;t.areThesePropertiesInMap(["isextended","autoextend"])&&(i=t.getMapAttribute("isextended","value",n),t.isFalsifiable(i)?t.hideProperties(["autoextend"],n):t.showProperties(["autoextend"],n))},updateActionLauncher:function(n){var t=this;t.areThesePropertiesInMap(["ishorizontal","allowsearch","selecttemplate"])&&(fvalue=t.getMapAttribute("ishorizontal","value",n),fvalue?(t.hideProperties(["allowsearch"],n),t.showProperties(["selecttemplate"],n)):(t.showProperties(["allowsearch"],n),t.hideProperties(["selecttemplate"],n)))},updateEntityTemplate:function(n){var t=this;t.areThesePropertiesInMap(["allowactions","xpathmultiple","filter","maxitems","orientation"])&&(fvalue=t.getMapAttribute("allowactions","value",n),fvalue?(t.showProperties(["xpathmultiple"],n),t.showProperties(["filter"],n),t.showProperties(["maxitems"],n),t.showProperties(["orientation"],n),t.showProperties(["format"],n)):(t.hideProperties(["xpathmultiple"],n),t.hideProperties(["filter"],n),t.hideProperties(["maxitems"],n),t.hideProperties(["orientation"],n),t.hideProperties(["format"],n)));t.areThesePropertiesInMap(["allowactions","xpathmultiple"])&&(t.getMapAttribute("allowactions","value",n)===!0?t.showProperties(["xpathmultiple"],n):t.hideProperties(["xpathmultiple"],n))},resolveGroupProperties:function(n){var t=this,i;t.areThesePropertiesInMap(["groupby","showcolumn","displaytype"])&&(i=t.getMapAttribute("groupby","value",n),t.isFalsifiable(i)?(t.hideProperties(["showcolumn"],n),t.hideProperties(["displaytype"],n)):(t.showProperties(["showcolumn"],n),t.showProperties(["displaytype"],n)))},hideProperties:function(n,t){for(var r=this,i=0,u=n.length;i<u;)r.insertMarkNotShow(n[i++],t)},showProperties:function(n,t){for(var r=this,i=0,u=n.length;i<u;)r.deleteMarkNotShow(n[i++],t)},areThesePropertiesInMap:function(n){for(var r=this,u=r.map,i=!0,t=0;t<n.length;t++)if(u[n[t]]===undefined){i=!1;break}return i},getRenderType:function(n){return n.element.type}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.deleteRepeaterItemCommand",{},{execute:function(){var n=this,u=n.arguments,t=u.guid,i,r;return t?(i=n.model.getForm(),r=i.getLayout(),n.deleteItem(r,t),!0):!1},deleteItem:function(n,t){var u=this,f=n.properties.html,c,l=!0,a=f.split("{{/repeater}}"),y=/{{placeholder(:\w*)?(\s*\{"id":"([\w-]+)"\})?/g,e,i,v,o,s,h;for(u.originalHtml=f,u.originalElements={},j=0,r=a.length;j<r;j++){for(e=a[j].split("{{separator}}"),i=0,v=e.length;i<v;i++)if(o=e[i],o.indexOf(t)>=0){for(s=/{{repeater:item}}[\w\W]+{{\/repeater:item}}/g.exec(o)[0];(c=y.exec(s))!==null;)h=c[3],u.originalElements[h]=n.removeElementById(h);n.properties.html=f.replace(s+"{{separator}}","");l=!1;break}if(!l)break}},undo:function(){var n=this,i=n.model.getForm(),t=i.getLayout();t.properties.html=n.originalHtml;for(id in n.originalElements)t.addElement(n.originalElements[id]);return!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.changePropertyCommand",{},{execute:function(){var t=this,n=t.arguments,u,f,r,i;if($.isArray(n.guids)||typeof n.guid!="string"||(n.guids=[n.guid]),t.controller.getContext()!=="template"&&!t.checksDependenciesInAV())return!1;for(t.originalValue||(t.originalValue={}),u=0,f=n.guids.length;u<f;u++)r=n.guids[u],i=t.model.getElement(r),t.originalValue[r]||(t.originalValue=t.originalValue||{},t.property=n.exclusive?i.getExclusiveProperty(n.property):n.property,t.originalValue[r]=i.getProperty(t.property),n.canValidate=!0,i.isLocalizableProperty(n.property)&&(n.value=typeof n.value=="string"?t.processLocalizableProperty(i,t.originalValue[r]):t.verifyFormat(n.value,i))),i.assignProperty(n.property,n.value,n.exclusive),t.controller.isAdhocFormContext()&&n.property==="displayName"&&t.controller.executeCommand({command:"changeProperty",guids:n.guids,property:"xpathAdhoc",value:n.newValue}),n.property==="xpath"&&(t.controller.executeCommand({command:"applyOverridesElement",element:i}),n.refreshProperties=n.refreshProperties||i.properties.type=="number"),n.removeDefaultDisplayName&&i.removeDefaultDisplayName(),i.hasDesignValue(t.arguments.property)&&(t.arguments.refresh=!0);return t.hasDependencies(n.property)&&(n.refreshProperties=!0),n.validateForm&&(i.isRequiredProperty(n.property)||i.isDependentProperty(n.property))&&(t.controller.executeCommand({command:"formValidations",validations:["RequiredProperties","RequiredDependentProperties","SameXpath","ElementsInContainers"],canRefresh:!1}),n.refreshProperties=!0),!0},undo:function(){for(var r,u,n=this,t=n.arguments,i=0,f=t.guids.length;i<f;i++)r=t.guids[i],u=n.model.getElement(r),u.assignProperty(n.property,n.originalValue[r],t.exclusive),t.property==="xpath"&&n.controller.executeCommand({command:"applyOverridesElement",element:u});return!0},hasDependencies:function(n){return n=="typedinamic"||n=="allowdinamiclabel"||n=="multipleselection"||n=="allowactions"||n=="selecttemplate"||n=="ishorizontal"||n=="showtime"||n=="dateformat"||n=="rule"||n=="interface"||n=="allowadd"||n=="displayName"||n=="helptext"||n=="allowedit"||n=="allowdecimals"||n=="advancedsearch.advancedsearch"||n=="newrecords.allownew"||n=="userconfirmation.needsuserconfirmation"||n=="format"||n=="allowgenerate"||n=="delete.allowdelete"||n=="add.withform"||n=="allowdetail"||n=="buttonrule.rule"||n=="buttonrule.rule90"||n=="buttonrule.interface"||n=="data.filter"||n=="buttonrule"||n=="add.allowadd"||n=="navigationform"||n=="add.addform"||n=="xpathActions"||n=="inlineadd"||n=="add.withform"||n=="detail.withform"||n=="isextended"||n=="totalize.operation"||n=="edit.editform"||n=="data.sortattribute"?!0:!1},processLocalizableProperty:function(n,t){var u=this,i=u.arguments,f=bizagi.editorLanguage.key,r;return r=typeof t=="string"?bizagi.editor.utilities.buildComplexLocalizable(t,n.guid,i.property):t?$.extend({},u.verifyFormat(t,n)):{i18n:{"default":n.getDefaultLocalizableProperty(i.property),languages:{},uri:n.guid.toString()+":"+i.property}},f==="default"?r.i18n["default"]=i.value:r.i18n.languages[f]=i.value,r},verifyFormat:function(n,t){var f=this,r=f.arguments,u,i;if(n&&n.i18n&&((!n.i18n.uri||n.i18n.uri.indexOf("undefined")>=0)&&(n.i18n.uri=r.guid+":"+r.property),n.i18n["default"]&&n.i18n["default"].length!==0||(n.i18n["default"]=t.getDefaultLocalizableProperty(r.property)),n.i18n.languages)){u={};for(i in n.i18n.languages)n.i18n.languages[i]&&(u[i]=n.i18n.languages[i]);n.i18n.languages=u}return n},checksDependenciesInAV:function(){var n=this,t=n.arguments,i;return n.controller.hasEnableCommandsEditor()&&t.property==="xpath"&&(i=n.resolveResult(n.controller.executeCommand({command:"searchDependencies",guids:t.guids})),!i.result)?!1:!0}});bizagi.editor.changePropertyCommand.extend("bizagi.editor.changePropertyCommand",{},{execute:function(){var n=this,t=n.arguments,o=t.value,u=t.property,i,r,f,e;if(n.controller.isTemplateContext()){if(i=t.guid||t.guids[0],r=n.element=n.model.getElement(i),!r||u=="hide")return n._super();if(f=r.properties||{},e=f.type||"",r.type=="layoutPlaceholder")return n.processLayoutControl(i);if(u=="xpath"&&o==undefined)return e.search(/:image/ig)>=0?n._super():n.processLayoutControl(i)}return n._super()},processLayoutControl:function(n){var i=this,t=i.arguments,r=t.property;if(t.refreshProperties=!0,r=="displayName")i.controller.executeCommand({command:"updateElement",renderType:"label",property:r,value:bizagi.editor.utilities.buildComplexLocalizable(t.value,n,"displayName"),guid:n,canUndo:!1});else if(r=="xpath"||r=="link"){var f=i.controller.getXpathNavigatorModel(),u=f.getNodeByXpath(bizagi.editor.utilities.resolveComplexXpath(t.value)),e=u?u.getRenderType():"layoutPlaceholder";i.controller.executeCommand({command:"updateElement",renderType:e,property:"xpath",value:t.value,guid:n,canUndo:!1})}return!0},undo:function(){var n=this,t=n.arguments,i=t.property,f=t.value,r,u;if(n.controller.isTemplateContext()){if(r=n.element.properties||{},u=r.type||"",i=="hide")return n._super();if(n.element.type=="layoutPlaceholder"&&n.model.replaceElement(n.element.guid,n.element),i=="xpath"&&f==undefined){if(u.search(/:image/ig)>=0)return n._super();n.model.replaceElement(n.element.guid,n.element)}return!0}return n._super()}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.changeDesignAttributesCommand",{},{execute:function(){var r=this,n=r.arguments,u=r.model.getElement(n.guid),f=u.getIndexedProperties(),t=f[n.property],i;if(t)for(i in n.attributes)t["editor-parameters"]=t["editor-parameters"]||{},t["editor-parameters"][i]=n.attributes[i]}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.changePropertyElementsCommand",{},{execute:function(){var n=this,f=n.arguments,i=f.elements,t,e;for(n.originalValue||(n.originalValue={}),t=0,e=i.length;t<e;t++){var r=i[t].guid,u=i[t].property,s=i[t].value,o=n.model.getElement(r);n.originalValue[r]||(n.originalValue[r]={property:u,value:o.getProperty(u)},f.canValidate=!0);o.assignProperty(u,s)}return!0},undo:function(){var n=this;for(var t in n.originalValue){var i=n.originalValue[t].property,r=n.originalValue[t].value,u=n.model.getElement(t);u.assignProperty(i,r)}return!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.insertElementFromControlsNavigatorCommand",{map:{querycascadingcombo:"cascadingcombo",columnsearchlist:"searchlist"}},{validateArguments:function(){var n=this;return n.arguments.data===undefined||n.arguments.data.name===undefined?!1:!0},execute:function(){var n=this,r=n.arguments,t=r.data.name,i;return n.validateArguments()?(i=!1,n.needsWizard(t)&&(i=!0,n.precondition||(n.precondition=n.controller.publish("showControlWizard",{control:n.Class.map[t]||t}))),$.when(n.precondition).pipe(function(u){return i?u.success===undefined||u.success==!1?!0:n.processWizardResult(t,u):(n.insertElement(r,t),!0)})):!1},insertElement:function(n,t){var i=this;n.element||(n.element=i.createElement({type:t}),(!n.element.isVisualProperty("xpath")||i.needsDisplayName(t))&&(n.element.properties.displayName=bizagi.editor.utilities.buildComplexLocalizable(n.data.displayName,n.element.guid,"displayName"),i.model.context=="adhocform"&&(n.element.properties.displayName=n.element.properties.displayName.i18n.default)),(i.model.context=="adhocform"||i.model.context=="adhocgrid")&&i.setXpathAdhoc(n.element),n.canValidate=!0,i.isSpecialElement(i.arguments.data.name,n.element),i.parent=n.parent||i.controller.getContextInfo().guid);i.controller.executeCommand({command:"insertElement",position:n.position,parent:i.parent,element:n.element,canUndo:!1});i.controller.setLastInsertedElement(n.element.guid)},needsDisplayName:function(n){return n==="link"||n==="formlink"||n==="columnformlink"||n==="columnlink"||n===""?!0:!1},undo:function(){var n=this,t=n.arguments,i=n.controller.executeCommand({command:"removeElementById",position:t.position,parent:n.parent,element:t.element,guid:t.element.guid,searchformresult:t.searchformresult,canUndo:!1});return(i=n.resolveResult(i),i.error)?!1:!0},needsWizard:function(n){return n=="cascadingcombo"?!0:n=="association"?!0:n=="querycascadingcombo"?!0:n=="searchlist"?!0:n=="columnsearchlist"?!0:!1},processWizardResult:function(n,t){var i=this;return n=="cascadingcombo"?i.processCascadingCombo(n,t):n=="querycascadingcombo"?i.processCascadingCombo(n,t):n=="association"?i.processMultipleRelation(n,t):n=="searchlist"?i.processMultipleRelation(n,t):n=="columnsearchlist"?i.processMultipleRelation(n,t):void 0},processCascadingCombo:function(n,t){var i=this,r=i.arguments,u=r.parent||i.controller.getContextInfo().guid,f=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getparententities",id:t.guidRelatedEntity,xpath:t.xpath});return $.when(f.processRequest()).pipe(function(f){var s,e,o;return f.length<2?(s=bizagi.localization.getResource("bizagi-editor-form-validation-cascadingcombo"),bizagi.showMessageBox(s,"Bizagi","error",!1),!0):(i.cascadingComboElement={},$.each(f,function(f,s){i.cascadingComboElement[f]?r.element=i.cascadingComboElement[f]:(r.element=i.createElement({type:n,xpath:bizagi.editor.utilities.buildComplexXpath(s.xpath,t.contextEntity,!1,s.guid),parentcombo:e,parentrelation:s.parentRelation?bizagi.editor.utilities.buildComplexXpath(s.parentRelation,s.id,!1,s.parentEntity):undefined}),i.cascadingComboElement[f]=r.element);i.controller.executeCommand({command:"insertElement",parent:u,element:r.element,position:r.position+f,canUndo:!1});o!=null&&o.setProperty("childcombo",r.element.guid);e=r.element.guid;o=i.model.getElement(e)}),!0)})},processMultipleRelation:function(n,t){var u=this,r=u.arguments,i=t.model;bizagi.log("model is;",i);var o=r.parent||u.controller.getContextInfo().guid,s=i.leftxpath,f=bizagi.clone(s),e=f.xpath.baxpath;return e.xpath=e.xpath+"."+i.factxpath,i.xpath=f,i.type=n,$.when(u.getFactNames(i)).pipe(function(){return bizagi.log("ASSOCIATION MODEL",i),r.element=u.createElement(i),n=="searchlist"&&(r.element.properties.displayName=bizagi.editor.utilities.buildComplexLocalizable(i.factxpath,r.element.guid,"displayName")),u.controller.executeCommand({command:"insertElement",parent:o,element:r.element,position:r.position,canUndo:!1}),!0})},getFactNames:function(n){var t=this,u=n.leftxpath,f=n.leftfactname,e=n.rightxpath,i=n.rightfactname,r=new $.Deferred;return $.when(t.controller.getXpathNavigatorModel({context:u}),t.controller.getXpathNavigatorModel({context:e})).done(function(t,u){var o=t.getNodeByXpath(f),e;n.leftfactname=bizagi.editor.utilities.buildComplexXpath(o.xpath,o.contextScope,o.isScopeAttribute,o.guidRelatedEntity);i&&(e=u.getNodeByXpath(i),n.rightfactname=bizagi.editor.utilities.buildComplexXpath(e.xpath,e.contextScope,e.isScopeAttribute,e.guidRelatedEntity));r.resolve()}),r.promise()}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.removeElementByIdCommand",{},{execute:function(){var n=this,t=n.arguments,f,u,i,e,r;if(n.data=[],n.tabBackup=[],$.isArray(t.guids)||typeof t.guid!="string"||(t.guids=[t.guid]),t.action!=="convertTo"&&n.type!=="nestedForm"&&n.controller.hasEnableCommandsEditor()&&(f=n.resolveResult(n.controller.executeCommand({command:"searchDependencies",guids:t.guids})),!f.result))return!1;for(u=0;u<t.guids.length;u++)(i=n.model.getElement(t.guids[u]),i)&&(n.type=i.type,e=n.controller.getContextInfo(),r=i.parent?n.model.getElement(i.parent.guid):n.model.getElement(e.guid),t.canValidate=!0,i.type=="cascadingcombo"||i.type=="querycascadingcombo"?n.data.push(n.removeCascadingCombo(i)):n.data.push(n.model.removeElementById(t.guids[u])),r.type=="tab"&&r.elements.length==0&&(n.tabBackup.push({parent:r.parent.guid,data:r,guid:r.guid,position:r.position}),n.model.removeElementById(r.guid)),n.removeElementSelected());return t.result=n.data,!0},undo:function(){var n=this,t,i;if(n.tabBackup.length>0)for(t=n.tabBackup.length-1;t>=0;t--)for(n.model.insertElement(n.tabBackup[t].position,n.tabBackup[t].parent,n.tabBackup[t].data),i=n.data.length-1;i>=0;i--)n.model.insertElement(n.data[i].position,n.data[i].parent.guid,n.data[i]);else if($.isArray(n.data))for(t=n.data.length-1;t>=0;t--)n.data[t].entities?n.insertCascadingCombo(t):n.model.insertElement(n.data[t].position,n.data[t].parent.guid,n.data[t]);else n.type=="cascadingcombo"||n.type=="querycascadingcombo"?n.insertCascadingCombo():n.model.insertElement(n.data.position,n.data.parent.guid,n.data);return!0},removeCascadingCombo:function(n){for(var e=this,i=n,u=[],r=[],f=0,o={},s,h,t;i.getProperty("parentcombo")!=null;)s=i.getProperty("parentcombo"),i=e.model.getElement(s);for(u.push(i);i.getProperty("childcombo")!=null;)h=i.getProperty("childcombo"),i=e.model.getElement(h),u.push(i);for(t=0;t<u.length;t++)r.push(e.model.removeElementById(u[t].guid)),t===0?(f=r[t].position,o=r[t].parent):r[t].position<f&&(f=r[t].position);return{position:f,parent:o,entities:r}},insertCascadingCombo:function(n){var t=this;n===undefined?$.each(t.data.entities,function(n,i){t.model.insertElement(t.data.position+n,i.parent.guid,i)}):$.each(t.data[n].entities,function(i,r){t.model.insertElement(t.data[n].position+i,r.parent.guid,r)})},removeElementSelected:function(){var n=this;n.controller.removeSelectedElement()}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.insertElementFromXpathNavigatorCommand",{columnRenderMapping:{boolean:"columnboolean",button:"columnbutton",text:"columntext",number:"columnnumber",money:"columnmoney",date:"columndate",document:"columnDocument",combo:"columncombo",cascadingCombo:"columncombo",list:"columnlist",search:"columnsearch",formlink:"columnformlink",hidden:"columnhidden",label:"columnlabel",link:"columnlink",radio:"columnradio",upload:"columnupload",image:"columnimage",uploadecm:"columnuploadecm",letter:"columnletter"},offlineColumnRenderMapping:{boolean:"offlinecolumnboolean",text:"offlinecolumntext",number:"offlinecolumnnumber",money:"offlinecolumnmoney",date:"offlinecolumndate",combo:"offlinecolumncombo",radio:"offlinecolumnradio",search:"offlinecolumnsuggest"},offlineFormRenderMapping:{boolean:"offlineboolean",text:"offlinetext",number:"offlinenumber",money:"offlinemoney",date:"offlinedate",combo:"offlinecombo",cascadingCombo:"offlinecombo",list:"offlinecombo",radio:"offlinecombo",search:"offlinesuggest",grid:"offlinegrid",image:"offlineimage",upload:"offlineupload"},searchFormRenderMapping:{boolean:"searchboolean",text:"searchtext",number:"searchnumber",money:"searchmoney",date:"searchdate",combo:"searchcombo",cascadingCombo:"searchcombo",list:"searchcombo",radio:"searchcombo",search:"searchsuggest"},searchFormResultRenderMapping:{boolean:"columnResultBoolean",text:"columnResultText",number:"columnResultNumber",money:"columnResultMoney",date:"columnResultDate",combo:"columnResultText",cascadingCombo:"columnResultText",list:"columnResultText",radio:"columnResultText",search:"columnResultText"},queryFormRenderMapping:{boolean:"queryboolean",text:"querytext",number:"querynumber",money:"querymoney",date:"querydate",combo:"querycombo",list:"querylist",cascadingCombo:"querycascadingcombo",radio:"queryradio",search:"querycombo",application:"queryapplication",process:"queryprocess",creatorfullname:"querycreatorfullname",creatorposition:"querycreatorposition",creatorusername:"querycreatorusername",currentuser:"queryusercurrentuser",currentuserfullname:"queryuserfullname",currentuserusername:"queryuserusername",currentuserposition:"queryuserposition",previoususer:"queryuserprevioususer",previoususerfullname:"queryprevioususerfullname",previoususerusername:"queryprevioususerusername",previoususerposition:"queryprevioususerposition",currenttask:"querytaskcurrenttask",previoustask:"querytaskprevioustask",taskentrydate:"querytaskentrydate",taskexpirydate:"querytaskexpirydate",taskstate:"querytaskstate",casecreationdate:"querycasecreationdate",casecreator:"querycasecreator",caseid:"querycaseid",casenumber:"querycasenumber",casesolutiondate:"querycasesolutiondate",casestate:"querycasestate",nestedform:"nestedform"},propertiesOverrides:{float:{allowdecimals:"true"}}},{execute:function(){var n=this,r=n.arguments,t,i;if(typeof n.element=="undefined"){if(t=n.createElementData(),!t.type)return n.arguments.canUndo=!1,!0;n.arguments.canValidate=!0;i=n.createElement(t);n.isSpecialElement(r.data.renderType,i);n.element=i;n.parent=n.arguments.parent||n.controller.getContextInfo().guid}return n.controller.executeCommand({command:"insertElement",position:n.arguments.position,parent:n.parent,element:n.element,searchformresult:n.arguments.searchformresult,canUndo:!1}),!0},undo:function(){var n=this,t=n.controller.executeCommand({command:"removeElementById",position:n.arguments.position,parent:n.parent,element:n.element,guid:n.element.guid,searchformresult:n.arguments.searchformresult,canUndo:!1});return(t=n.resolveResult(t),t.error)?!1:!0},createElementData:function(){var i=this,n=i.arguments,t={};return t.type=i.resolveType(),n.data.context=="adhocform"||n.data.context=="adhocgrid"?(t.xpathAdhoc={xpath:n.data.xpath.xpath.baxpath.xpath,relatedEntity:n.data.parent?n.data.parent.guidRelatedEntity:null},t.draggedProperty=!0,t.displayName=n.data.displayName?n.data.displayName:n.data.name,n.data.guidRelatedEntity&&(t.data={datasource:{guid:n.data.guidRelatedEntity,type:n.data.entityContext}},n.data.predefinedValues&&(t.data.datasource.values=n.data.predefinedValues))):t.xpath=n.data.xpath,t.renderType=n.data.nodeSubtype,i.controller.isQueryFormContext()&&i.isColumn()&&(t.selectable=!1),n.data.renderType==="nestedform"&&(t.form=bizagi.editor.utilities.buildComplexReference(n.data.guid)),t.renderType&&i.Class.propertiesOverrides[t.renderType]&&(t=$.extend(t,i.Class.propertiesOverrides[t.renderType])),t},isColumn:function(){var n=this,i=n.arguments,r=n.controller.getXpathNavigatorModel(),u=bizagi.editor.utilities.resolveComplexXpath(i.data.xpath),t=r.getNodeByXpath(u);return t?t.parentIsGrid():!1},resolveType:function(){var n=this,t=n.controller.getContext();return t=="form"||t=="startform"?n.arguments.data.renderType==="form"?"nestedform":n.arguments.data.renderType:t=="grid"?this.Class.columnRenderMapping[n.arguments.data.renderType]:t=="offlinegrid"?this.Class.offlineColumnRenderMapping[n.arguments.data.renderType]:t=="searchform"?n.arguments.searchformresult?this.Class.searchFormResultRenderMapping[n.arguments.data.renderType]:this.Class.searchFormRenderMapping[n.arguments.data.renderType]:t=="offlineform"?this.Class.offlineFormRenderMapping[n.arguments.data.renderType]:t=="queryform"?this.Class.queryFormRenderMapping[n.arguments.data.renderType]:t=="adhocform"||t=="adhocgrid"?n.arguments.data.renderType:null}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.loadModelCommand",{},{execute:function(){var n=this,t=n.arguments,i=t.dataModel;return n.model.loadModel(n.controller.getContext(),i),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.saveModelCommand",{},{execute:function(){var t=this,n=t.arguments,i=n.dataModel;return n.dataModel=t.model.saveModel(),t.controller.setOriginalModel(n.dataModel),n.result=n.dataModel,!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.createAndInsertControlLayoutInModelCommand",{},{execute:function(){var n=this,i=n.arguments,t;return typeof n.layout=="undefined"&&(t=n.controller.getLayoutNavigatorModel().findControlById(i.id),typeof t=="object"&&(n.layout=n.model.createLayoutElement(t))),n.controller.executeCommand({command:"insertElement",position:n.arguments.position,parent:n.arguments.parent,element:n.layout,canUndo:!1}),!0},undo:function(){var n=this;return n.controller.executeCommand({command:"removeElement",position:n.arguments.position,parent:n.arguments.parent,element:n.layout,canUndo:!1}),!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.changeMultiplePropertiesCommand",{},{execute:function(){var i=this,n=i.arguments,s=!1,f,h,u,e,t,o,r,c;for(n.canValidate=!0,$.isArray(n.guids)||typeof n.guid!="string"||(n.guids=[n.guid]),i.originalValues||(i.originalValues={}),f=0,h=n.guids.length;f<h;f++){if(u=n.guids[f],e=i.model.getElement(u),!i.originalValues[u])for(i.originalValues[u]=[],t=0,o=n.properties.length;t<o;t+=1)r=n.properties[t].property,i.originalValues[u].push({property:r,value:e.getProperty(r)});for(t=0,o=n.properties.length;t<o;t+=1)r=n.properties[t].property,c=n.properties[t].value,e.assignProperty(r,c,n.exclusive),s=e.hasDesignValue(r)||s}return s&&(i.arguments.refresh=!0),!0},undo:function(){for(var f,e,i,t,o,s,h,n=this,r=n.arguments,u=0,c=r.guids.length;u<c;u++){f=r.guids[u];e=n.model.getElement(f);for(i in n.originalValues)for(t=0,o=n.originalValues[i].length;t<o;t++)s=n.originalValues[i][t].property,h=n.originalValues[i][t].value,e.assignProperty(s,h,r.exclusive)}return!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.changeContextCommand",{},{canUndo:function(){return!1},execute:function(){var i=this,n=i.arguments,t=n.guid?i.model.getElement(n.guid):null,u=t&&t.properties.xpath?t.properties.xpath:n.context==="grid"||n.context==="offlinegrid"||n.context==="adhocgrid"?"none":null,r={context:n.context,guid:n.guid};return n.context==="adhocgrid"?r.xpathAdhoc=t.properties.xpathAdhoc.xpath:r.xpath=u,i.controller.changeContext(r),!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.addControlLayoutInModelCommand",{},{execute:function(){var n=this,i=n.arguments,t;return typeof n.layout=="undefined"&&(t=n.controller.getLayoutNavigatorModel().findControlById(i.id),typeof t=="object"&&(n.layout=n.model.createLayoutElement(t))),n.model.addElement(n.layout),!0},undo:function(){var n=this;return n.model.removeLastElement(),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getGridColumnModelCommand",{},{execute:function(){var n=this,t=$.Deferred(),i=n.model.getElement(n.arguments.guid);return $.when(i.getGridColumnModel()).done(function(n){t.resolve(n)}),n.arguments.result=t.promise(),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getSearchResultModelCommand",{},{execute:function(){var n=this,t=$.Deferred();if(!n.controller.isSearchFormContext())throw"bizagi.editor.getSearchResultModelCommand - To use this command you must be in the searchform context";return $.when(n.model.getSearchResultRenderingModel()).done(function(n){t.resolve({model:bizagi.clone(n.result),resultValidations:n.resultValidations})}),n.arguments.result=t.promise(),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getButtonModelCommand",{},{execute:function(){var n=this,t=$.Deferred();if(!n.controller.isActivityForm())throw"bizagi.editor.getButtonModelCommand - To use this command you must use an activity form";return n.arguments.result=$.when(n.model.getButtonRenderingModel()),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getXpathEditorModelCommand",{},{execute:function(){var n=this,t=n.arguments,i=this.model.getElement(this.arguments.guid),r=new $.Deferred,u=n.controller.isGridContext()?n.controller.getXpathNavigatorModelGrid():n.controller.getXpathNavigatorModel();return $.when(u).done(function(f){var s,e,o,h,c;u.context!="adhocform"?(s=i.properties.xpath,e=f.getNodeByXpath(bizagi.editor.utilities.resolveComplexXpath(s)),e&&bizagi.util.parseBoolean(e.isScopeAttribute)?(e.setScopeAttribute("false"),o=f.getSubModel(s),e.setScopeAttribute("true")):o=f.getSubModel(s)):(h=n.resolveEditorParameter(t.editorParameters.entity,i),t.editorParameters.entityContext?(c=n.resolveEditorParameter(t.editorParameters.entityContext,i),o=f.getSubModelByEntity(h,c)):o=f.getSubModelByEntity(h));r.resolve(o)}),t.result=r.promise(),!0},resolveEditorParameter:function(n){return n=n.substring(1,n.length-1),parts=n.split(":"),parts.shift(),eval("element.properties."+parts.join("."))}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.insertTabItemCommand",{},{execute:function(){var n=this,u=n.arguments,i=n.model.getElement(n.arguments.tab);n.arguments.position=i.elements.length;n.arguments.canValidate=!0;var f=n.controller.isOfflineFormContext()?"offlinetabitem":"tabitem",r="Tab "+(i.elements.length+1),t=n.createElement({type:f,displayName:r});return t.properties.displayName=bizagi.editor.utilities.buildComplexLocalizable(r,t.guid,"displayName"),i.addElement(t),u.result=t,!0},undo:function(){var n=this;return n.model.removeElement(n.arguments.position,n.arguments.tab),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.updateModelCommand",{},{execute:function(){var n=this,t=n.arguments;return t.data.actiontype==="OpenNestedForm"?n.processNestedFormAction():t.data.actiontype==="CreateForm"?n.processCreateFormAction():t.data.actiontype==="CreateFormFromXpath"?n.processCreateFormFromXpathAction():t.data.actiontype==="ShowForm"?n.processShowForm():t.data.actiontype==="OpenWizardTemplates"&&n.processWizardTemplates(),!0},processNestedFormAction:function(){var i=this,n=i.arguments,u=n.data.json,f=n.data.guidrender,t,r;u&&f&&(t=i.model.getElement(f),r=i.processData(u,t),t.elements=r.length>0?r:t.elements);n.result={action:n.data.actiontype}},findElementInModel:function(n){var t=this;return t.model.getElement(n)},processData:function(n,t){var r=this,i=[];return n.elements&&$.each(n.elements,function(n,u){var f=r.model.createElement(u.type,u);f.setParent(t);i.push(f)}),i},processWizardTemplates:function(){var t=this,r=t.arguments,n=r.data,u=n.propertyName,i=n.guidControl,f=bizagi.editor.utilities.buildComplexReference(n.guidTemplate);t.model.changeProperty(i,u,f);t.model.changeProperty(i,"templatetype","template");r.result={action:n.actiontype,guid:i}},processCreateFormAction:function(){var t=this,r=t.arguments,n=r.data,u=[],f=n.propertyname,i=n.guidrender,e=bizagi.editor.utilities.buildComplexReference(n.idform);n.context&&n.context==="searchform"?(u.push(e),t.model.changeProperty(i,f,u)):t.model.changeProperty(i,f,e);bizagi.util.parseBoolean(n.showForm)&&t.processShowForm();r.result={action:n.actiontype,guid:i}},processCreateFormFromXpathAction:function(){var t=this,n=t.arguments;n.result={action:n.data.actiontype,idNode:n.data.guidForm}},processShowForm:function(){var t=this,n=t.arguments,i=n.data,r=t.model.getElement(i.guidrender);n.refresh=!0;r.loadForm();n.result={action:i.actiontype}}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.updateElementCommand",{renderLayout:{string:"layoutText",collection:"layoutLink",label:"layoutLabel",number:"layoutNumber",float:"layoutNumber",currency:"layoutMoney",date:"layoutDateTime",image:"layoutImage",collection:"layoutLink","entity-parametric":"layoutLink","entity-master":"layoutLink","entity-system":"layoutLink","entity-stakeholder":"layoutLink",boolean:"layoutBoolean",layoutPlaceholder:"layoutPlaceholder",attachment:"layoutUpload"}},{execute:function(){var n=this,t=n.arguments,o=t.renderType,i=t.guid,e=n.model.getForm(),r=e.getLayout(),u=n.createLayoutElement(),f=n.element=n.model.getElement(i);return(n.originalHtml||(n.originalHtml=r.properties.html,n.repeaters=bizagi.clone(r.repeaters)),n.canReplaceElement(f))?(n.setProperties(u,f),n.model.replaceElement(i,u),!0):!1},createLayoutElement:function(){var t=this,n=t.arguments,e=n.property,i=n.renderType,u=n.guid,f=t.Class.renderLayout[i],r={guid:u,properties:{rendertype:i}};return r.properties[n.property]=n.value,t.model.createElement(f,r)},canReplaceElement:function(n){var i=this,t=i.arguments,r=t.toInitialState,u=t.renderType;return n?r?!0:n.properties.type==":image"&&u!="image"?!1:!0:!0},setProperties:function(n,t){var u=this,i=u.arguments,f=i.toInitialState,e=i.guid,r;if(!f){r=n.designValueProperties;for(property in r)property!=i.property&&t.designValueProperties[property]&&n.assignProperty(property,t.getProperty(property))}t.properties.type&&n.assignProperty("type",t.getProperty("type"));n.assignProperty("hide",!1)},undo:function(){var n=this,f=n.arguments,e=f.guid,o=n.model.getForm(),r=o.getLayout(),i=r.repeaters,t,u;r.properties.html=n.originalHtml;n.model.replaceElement(e,n.element);for(t in i)if(!bizagi.editor.utilities.objectEquals(i[t].elements,n.repeaters[t].elements)){for(u in i[t].elements)n.model.removeElementById(u);i[t].elements=n.repeaters[t].elements}return!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.replaceAndRestoreElementCommand",{},{execute:function(){var n=this,t=n.arguments,i=t.sourceGuid,r,u;return(n.originalSourceElement=n.model.getElement(i),n.originalTargetElement=n.model.getElement(t.guid),r=n.originalSourceElement.properties||{},u=n.originalTargetElement.properties||{},n.isImageControl(u.type)&&!n.isImageControl(r.type))?!1:n.originalSourceElement.type=="layoutPlaceholder"?!1:(n.restoreSourceElement(i),n.replaceTargetElement(),!0)},restoreSourceElement:function(n){var t=this,i=t.originalSourceElement.properties,f=i.type,r,u;f.search(/image/ig)>=0||(r={guid:n,properties:{rendertype:"layoutPlaceholder",type:i.type}},u=t.model.createElement("layoutPlaceholder",r),t.model.replaceElement(n,u))},replaceTargetElement:function(){var n=this,r=n.arguments,t=bizagi.clone(n.originalSourceElement.properties),o=t.type||"",u=n.originalTargetElement.properties,s=u.type||"",i=r.guid,f={guid:i,properties:$.extend(t,{type:n.originalTargetElement.properties.type})},e=n.model.createElement(n.originalSourceElement.type,f);n.model.replaceElement(i,e)},isImageControl:function(n){var t=this,n=n||"";return n.search(/image/ig)>=0},undo:function(){var n=this,t=n.arguments,i=n.originalSourceElement.properties,r=t.sourceGuid,u=t.guid;return i.type.search(/image/ig)==-1&&n.model.replaceElement(r,n.originalSourceElement),n.model.replaceElement(u,n.originalTargetElement),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.updateGridColumnModelCommand",{},{execute:function(){var n=this,t=n.arguments,r=t.gridModel.guid,i=n.model.createElement(t.gridModel.type,t.gridModel);return i.type!="adhocgrid"&&i.restoreDefaultDisplayName(),n.model.replaceElement(r,i),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.updateAssociationModelCommand",{},{execute:function(){var t=this,e=["leftxpath","leftdisplayattrib","leftadditionalattrib","leftfilter","leftcaption","rightxpath","rightdisplayattrib","rightfilter","rightadditionalattrib","rightcaption","factxpath"],r=t.arguments,o=r.model,h=r.guid,u,f,i,s,n;for(t.changes={},u=t.model.getElement(h),f=u.properties,i=0,s=e.length;i<s;i++)n=e[i],bizagi.editor.utilities.objectEquals(o[n],f[n])||(r.refresh=!0,t.changes[n]=f[n],u.assignProperty(n,o[n]));return t.calculateXpathControl(),!0},calculateXpathControl:function(){var t=this,r=t.arguments,n=r.model,u=r.guid,i=t.model.getElement(u),o=r.control;if(t.changes.factxpath){var s=n.leftxpath,f=bizagi.clone(s),e=f.xpath.baxpath;e.xpath=e.xpath+"."+n.factxpath;i.assignProperty("xpath",f);o=="searchlist"&&i.assignProperty("displayName",bizagi.editor.utilities.buildComplexLocalizable(n.factxpath,u,"displayName"));$.when(t.getFactNames(n)).done(function(){i.assignProperty("leftfactname",n.leftfactname);i.assignProperty("rightfactname",n.rightfactname)})}},getFactNames:function(n){var t=this,u=n.leftxpath,f=n.leftfactname,e=n.rightxpath,i=n.rightfactname,r=new $.Deferred;return $.when(t.controller.getXpathNavigatorModel({context:u}),t.controller.getXpathNavigatorModel({context:e})).done(function(t,u){var o=t.getNodeByXpath(f),e;n.leftfactname=bizagi.editor.utilities.buildComplexXpath(o.xpath,o.contextScope,o.isScopeAttribute,o.guidRelatedEntity);i&&(e=u.getNodeByXpath(i),n.rightfactname=bizagi.editor.utilities.buildComplexXpath(e.xpath,e.contextScope,e.isScopeAttribute,e.guidRelatedEntity));r.resolve()}),r.promise()}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getDecoratorModelCommand",{},{execute:function(){var n=this,t=n.arguments.guid,i=n.model.getElement(t);return n.arguments.result=i.getDecoratorModel(),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getContextMenuModelCommand",{},{execute:function(){var n=this,t=n.arguments,r=t.guid,u=t.convertToModel,f=n.model.getElement(r),i=f.getContextMenuModel();return i.addConverToItem(u),n.arguments.result=i,!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getXpathDataForElementCommand",{},{execute:function(){var n=this,t=n.arguments,i=this.model.getElement(this.arguments.guid),r=bizagi.editor.utilities.resolveComplexXpath(i.properties.xpath),u=n.controller.isGridContext()?n.controller.getXpathNavigatorModelGrid():n.controller.getXpathNavigatorModel();return t.result=u.getNodeByXpath(r),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getElementPropertyCommand",{},{execute:function(){var n=this,t=n.arguments,i=n.model.getElement(t.guid);return n.arguments.result=i.getProperty(t.property),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getElementDesignPropertyCommand",{},{execute:function(){var n=this,t=n.arguments;return n.arguments.result=typeof t.guids=="undefined"?!1:n.model.getElement(t.guids[0]).getRenderingModel(),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getRibbonModelCommand",{},{execute:function(){var t=this,u=t.arguments,n=t.controller.getRibbonModel(),i=t.model.getElement(u.guid),e=u.convertToModel,f,r,o,s,h;if(n.reset(),i){for(f=i.getRibbonProperties(),r=0;r<f.length;r++)n.enableProperty(f[r],i.resolveProperty(f[r]));n.enableAction("copy-format");e.length>0&&(n.enableAction("convertto"),t.appendConvertToModel(n,e));n.enableAction("rename");(i.type==="nestedform"||i.type==="grid")&&n.disableAction("rename");n.enableAction("delete");t.isControlEditable(i)||n.disableProperty("editable")}else n.disableAction("convertto"),t.appendConvertToModel(n,[]);return t.controller.hasUndo()?n.enableAction("undo"):n.disableAction("undo"),n.enableAction("checkout"),t.controller.isReadOnlyForm()?n.enableAction("checkout"):n.disableAction("checkout"),t.controller.thereAreChangesInForm()?n.enableAction("save"):n.disableAction("save"),t.controller.hasRedo()?n.enableAction("redo"):n.disableAction("redo"),t.controller.isReadOnlyForm()?n.enableAction("actionsvalidations"):t.controller.isFormContext()?(n.enableAction("copy-from"),n.enableAction("actionsvalidations"),n.enableAction("useCustomButtons"),o=t.controller.getModel().getProperty("usecustombuttons"),o?(n.checkAction("useCustomButtons"),n.showGroup("email")):n.uncheckAction("useCustomButtons"),s=t.controller.getModel().getProperty("useemailoption"),s?(n.checkAction("enableEmail"),n.enableAction("emailTemplate")):(n.uncheckAction("enableEmail"),n.disableAction("emailTemplate"))):t.controller.isOfflineFormContext()?(n.enableAction("actionsvalidations"),n.showGroup("initForm"),n.enableAction("offlineAsOnline"),t.controller.isOfflineAsOnline()?n.checkAction("offlineAsOnline"):n.uncheckAction("offlineAsOnline")):t.controller.isQueryFormContext()?n.enableAction("actionsvalidations"):t.controller.isStartFormContext()&&(n.enableAction("actionsvalidations"),n.enableAction("copy-from"),bizagi.editor.flags.UseOfflineForms&&(t.controller.hasOfflineForm()?n.enableAction("offlineAsOnline"):n.disableAction("offlineAsOnline"),h=t.controller.getModel().getProperty("useofflineform"),h?(n.checkAction("useOfflineForm"),n.showGroup("initForm")):(n.hideGroup("initForm"),n.uncheckAction("useOfflineForm")),t.controller.isOfflineAsOnline()?n.checkAction("offlineAsOnline"):n.uncheckAction("offlineAsOnline"))),u.validFormChecked?n.checkAction("validate"):n.uncheckAction("validate"),t.controller.isReadOnlyForm()?(n.disableProperty("language"),n.disableAction("validate")):(n.enableAction("formproperties"),n.enableProperty("language",bizagi.editorLanguage),n.setCaption("language",bizagi.editorLanguage.key)),u.result=n,!0},appendConvertToModel:function(n,t){var u=this,r=n.getElementByAction("convertto"),i;if(r){for(r.elements=[],i=0;i<t.length;i++)r.elements.push({caption:t[i].caption,action:"convert",style:t[i].controlName,property:t[i].controlName,css:t[i].style});n.processElementsForConvertTo(r.elements)}},isControlEditable:function(n){return n.properties.editable!=undefined}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.insertElementsCommand",{},{execute:function(){var n=this,i=n.arguments,t=i.data||{};return i.canValidate=!0,n.elements||(n.processData(t),n.actions=t.actions||[],n.validations=t.validations||[],n.buttons=t.buttons||[]),n.addElements(),n.addActions(),n.addValidations(),n.addButtons(),!0},processData:function(n){var t=this,r,i;t.elements=[];r=!0;n&&n.elements&&(i=t.model.createElement("form",n,r),t.regenerateGuids(i,i.elements),t.elements=i.elements)},regenerateGuids:function(n,t){var i=this;t.forEach(function(t){t.elementType=="container"&&i.regenerateGuids(n,t.elements);t.type=="cascadingcombo"&&i.processCascadingCombo(n,t)})},processCascadingCombo:function(n,t){var e=this,i=t.resolveProperty("parentcombo"),r=t.resolveProperty("childcombo"),u,f;i&&(u=n.getElementByOldGuid(i),t.assignProperty("parentcombo",u.guid));r&&(f=n.getElementByOldGuid(r),t.assignProperty("childcombo",f.guid))},addElements:function(){var n=this,t,i;if(n.elements.length>0)for(t=0,i=n.elements.length;t<i;t+=1)n.model.addElement(n.elements[t])},deleteElements:function(){var n=this,t,i;if(n.elements.length>0)for(t=0,i=n.elements.length;t<i;t+=1)n.model.removeElementById(n.elements[t].guid)},addActions:function(){var n=this,t,i;if(n.actions.length>0)for(t=0,i=n.actions.length;t<i;t+=1)n.model.addAction(n.actions[t])},deleteActions:function(){var n=this,t,i;if(n.actions.length>0)for(t=0,i=n.actions.length;t<i;t+=1)n.model.deleteAction(n.actions[t].guid)},addValidations:function(){var n=this,t,i;if(n.validations.length>0)for(t=0,i=n.validations.length;t<i;t+=1)n.model.addValidation(n.validations[t])},deleteValidations:function(){var n=this,t,i;if(n.validations.length>0)for(t=0,i=n.validations.length;t<i;t+=1)n.model.deleteValidation(n.validations[t].guid)},addButtons:function(){var n=this;$.each(n.buttons,function(t,i){var r=n.model.createElement(i.type,i);n.model.addButton(r)})},deleteButtons:function(){var n=this,t,i;if(n.buttons.length>0)for(t=0,i=n.buttons.length;t<i;t+=1)n.model.removeElementById(n.buttons[t].guid)},undo:function(){var n=this;return n.deleteElements(),n.deleteActions(),n.deleteValidations(),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.validateGridColumnModelCommand",{},{execute:function(){var n=this,t=n.arguments,i=n.controller.getContextInfo(),r=n.model.getElement(i.guid);return t.result=!0,n.validateGroupBy(r)||(t.result=!1),!0},validateGroupBy:function(n){var t=!0,i;return n&&n.elements&&(i=$.grep(n.elements,function(n){if(n.properties&&n.properties.groupby)return n.properties.groupby===!0}),t=i.length<=1),t}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.formValidationsCommand",{},{execute:function(){var i=this,u=new $.Deferred,n=i.arguments,r,t,f;if(n.result={},n.refresh=n.canRefresh,n.canValidate=!0,r=[],$.isArray(n.validations)&&n.validations.length>0)for(t=0,f=n.validations.length;t<f;t+=1)$.isFunction(i["validate"+n.validations[t]])&&r.push(i["validate"+n.validations[t]]());return $.when.apply($,r).done(function(){u.resolve(!0)}),u.promise()},validateRequiredProperties:function(){var n=this,t=n.arguments;return n.model.validRequiredProperties()||$.extend(t.result,{requiredProperties:!0}),!0},validateRequiredDependentProperties:function(){var n=this,t=n.arguments;return n.model.validRequiredDependentProperties()||$.extend(t.result,{requiredDependentProperties:!0}),!0},validateSameXpath:function(){var n=this,r={},t={},f=n.arguments,i,u;if(n.model.getMapXpath(n.model.form,r),$.each(r,function(n,i){i.elements.length>1&&i.editables>1&&(t[n]=i)}),!$.isEmptyObject(t)){for(i in t)u=t[i],$.each(u.elements,function(t,r){r=n.model.getElement(r.guid);r&&r.validSameXpath&&r.validSameXpath(i)});$.extend(f.result,{sameXpath:!0})}return!0},validateElementsInContainers:function(){var n=this,t=n.arguments;return n.model.validElementsInContainer()||$.extend(t.result,{elementInContainers:!0}),!0},validateAttributesAdministrables:function(){var n=this,i=n.arguments,t=n.model.getForm(),r=t.getProperty("isadministrable"),u=t.triggerGlobalHandler("getContextEntityType")=="parameter";return u&&r?!0:(n.model.validAttributesAdministrables()||$.extend(i.result,{attributesAdministrables:!0}),!0)},validateLayoutPlaceholder:function(){var n=this,f=n.arguments,e=n.model.getForm(),o=e.getLayout(),t=o.repeaters,i=[],r,u;for(r in t){u=t[r];for(id in u.elements)i.push(id)}return n.model.validLayoutPlaceholder(i)||$.extend(f.result,{layoutPlaceholder:!0}),!0},validateAttributesNoEditables:function(){var n=this,t=$.Deferred(),i=n.arguments;return $.when(n.model.validAttributesNoEditables()).then(function(n){n||$.extend(i.result,{attributesNoEditables:!0});t.resolve(!0)}),t.promise()}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.validateActionsValidationsModelCommand",{},{execute:function(){var n=this;n.controller.isFormContext()&&$.when(n.controller.getCommandsEditorModel()).done(function(t){var i=t.getInvalidElements();i.actions&&n.removeActions(i.actions);i.validations&&n.removeValidations(i.validations)})},removeActions:function(n){for(var i=this,t=0,r=n.length;t<r;t++)i.model.deleteAction(n[t].guid)},removeValidations:function(n){for(var i=this,t=0,r=n.length;t<r;t++)i.model.deleteValidation(n[t].guid)}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getSelectFormModelCommand",{},{execute:function(){var t=this,i=t.arguments,r=t.model.getElement(i.guid),n={};return n.value=r.getProperty(i.property),n.xpath=r.getProperty("xpath"),n.name=i.propertyName,n.relatedForms=[],n.context=t.controller.getContext(),t.arguments.result=n,!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.removeValidationsInModelCommand",{},{execute:function(){var n=this,t=n.arguments;return t.refresh=t.canRefresh,n.model.removeValidations(),!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.convertToCommand",{},{execute:function(){var n=this,t=n.arguments,i=n.model.getElement(t.guid),r=!1;if(n.needsExternalData(t.convertTo)){if(!n.validateElement(i,t.convertTo))return t.canUndo=!1,!1;r=!0;n.precondition||(n.precondition=n.controller.publish("getExternalData",{control:t.convertTo,xpath:i.resolveProperty("xpath")}))}return $.when(n.precondition).pipe(function(i){r?n.processControl({control:t.convertTo,data:i}):n.converToElement()}).pipe(function(){return!0})},converToElement:function(){var n=this,t=n.arguments,i=$.Deferred(),r,u;return n.data||(r=n.getCommonProperties({exclude:{}}),u=n.getElements(),n.convertToElement=n.createElement($.extend(r,{type:t.convertTo}),u),n.controller.executeCommand({command:"applyOverridesElement",element:n.convertToElement})),$.when(n.controller.executeCommand({command:"removeElementById",guid:t.guid,canUndo:!1,action:"convertTo"})).done(function(r){r=n.resolveData(r);n.controller.removeSelectedElement(t.guid);n.model.insertElement(r.position,r.parent.guid,n.convertToElement);n.data=r;n.controller.executeCommand({command:"applyOverridesElement",element:n.data});i.resolve()}),i.promise()},undo:function(){var n=this,t=n.convertToElement.guid;return n.controller.executeCommand({command:"removeElementById",guid:t,action:"convertTo",canUndo:!1}),$.isArray(n.data.entities)?n.insertCascadingCombo():n.model.insertElement(n.data.position,n.data.parent.guid,n.data),!0},getCommonProperties:function(n){var t=this,e=t.arguments,c=n.exclude||{},o=t.controller.getControlsModel(),s=t.model.getElement(e.guid),h=o.getDesignProperties(s.type)||{},l=o.getDesignProperties(e.convertTo)||{},r={},i,u,f;r.renderType=!0;for(i in h)c[i]||(u=h[i],f=l[i],u&&f&&t.identicalProperties(u,f)&&(r[i]=!0));return t.setValueConvertToProperties(s,r)},getElements:function(){var t=this,i=t.arguments,n=t.model.getElement(i.guid);return n?n.elements?t.isContainer(n.type)||t.isCollection(n.type)?n.elements:undefined:undefined:undefined},isContainer:function(n){return n=="group"||n==="panel"||n==="tab"},isCollection:function(n){return n=="grid"||n==="groupedgrid"},identicalProperties:function(n,t){var i=this;return n["bas-type"]&&t["bas-type"]?n.subproperties^t.subproperties?!1:n.subproperties?i.identicalSubproperties(n.subproperties,t.subproperties):n["bas-type"]===t["bas-type"]:!1},identicalSubproperties:function(n,t){return bizagi.util.identicalObjects(n,t)},setValueConvertToProperties:function(n,t){var r=n.properties,u={};for(var i in t)r[i]&&(u[i]=bizagi.clone(r[i]));return u},needsExternalData:function(n){return n=="cascadingcombo"||n=="querycascadingcombo"?!0:!1},processControl:function(n){var t=this;if(n.control=="cascadingcombo"||n.control=="querycascadingcombo")return t.processCascadingCombo(n.data)},processCascadingCombo:function(n){var t=this,i=t.arguments,r=$.Deferred(),u,f;if(n.length<2){u=bizagi.localization.getResource("bizagi-editor-form-validation-convertto-cascadingcombo");bizagi.showMessageBox(u,"Bizagi","error",!1);r.resolve();return}f=t.getCommonProperties({exclude:{displayName:1,xpath:1,data:1}});$.when(t.controller.executeCommand({command:"removeElementById",guid:i.guid,canUndo:!1,action:"convertTo"})).done(function(u){u=t.resolveData(u);t.data=u;var s=u.parent.guid||t.controller.getContextInfo().guid,h=u.position,e,o;t.cascadingComboElements||(t.cascadingComboElements={});$.each(n,function(n,r){t.cascadingComboElements[n]?t.convertToElement=t.cascadingComboElements[n]:(t.convertToElement=t.createElement($.extend(f,{type:i.convertTo,xpath:bizagi.editor.utilities.buildComplexXpath(r.xpath,i.contextEntity,!1,r.id),parentcombo:e,parentrelation:r.parentRelation?bizagi.editor.utilities.buildComplexXpath(r.parentRelation,r.id,!1,r.parentEntity):undefined})),t.cascadingComboElements[n]=t.convertToElement);t.controller.executeCommand({command:"insertElement",parent:s,element:t.convertToElement,position:h+n,canUndo:!1});o!=null&&o.setProperty("childcombo",t.convertToElement.guid);e=t.convertToElement.guid;o=t.model.getElement(e)});r.resolve()});r.promise()},validateElement:function(n,t){var r=this,u=r.arguments,i;if(t==="cascadingcombo"||t==="querycascadingcombo"){if(i=n&&n.resolveProperty("xpath"),typeof i!="object")return bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-cascadingcombo-invaliddatasource"),"Bizagi","error",!1),!1;u.contextEntity=bizagi.editor.utilities.resolveContextEntityFromXpath(i)}return!0},insertCascadingCombo:function(){var n=this;$.each(n.data.entities,function(t,i){n.model.insertElement(n.data.position+t,i.parent.guid,i)})},resolveData:function(n){return $.isArray(n)?n[0]:n}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.loadWidgetsCommand",{},{execute:function(){var n=this,t=n.arguments,r,u,i;n.model.addWidgets(t.controls.widgets);r=n.controller.componentModels.controlsNavigator;u=n.controller.getControlsModel();$.each(t.controls.widgets,function(t,i){i.type&&i.type=="userfield"&&(n.controller.loadIconUserField(i),n.controller.loadUserfield(i))});r.processData({controls:t.controls.widgets});u.processData({controls:t.controls.widgets},[]);for(i in localStorage)i.indexOf("control.definitions")>=0&&localStorage.removeItem(i);return!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.copyFormatCommand",{},{execute:function(){var n=this,t=n.arguments,i=n.model.getElement(t.guid),r=i.getProperty("format");return n.controller.pushCopyFormat({guid:t.guid,properties:r}),!0}});
bizagi.editor.refreshableCommand.extend("bizagi.editor.changeLayoutCommand",{},{execute:function(){var t=this,i=t.arguments,r=t.model.getElement(i.guid),n,u,f;for(t.originalValue||(t.originalValue=bizagi.clone(r.getProperty("layout"))),r.assignProperty("layout",{elements:i.values}),n=0,u=i.values.length;n<u;n+=1)f=r.elements[n],f.assignProperty("width",i.values[n].width);return!0},undo:function(){var n=this,f=n.arguments,i=n.model.getElement(f.guid),t,r,u;for(i.assignProperty("layout",n.originalValue),t=0,r=n.originalValue.elements.length;t<r;t+=1)u=i.elements[t],u.assignProperty("width",n.originalValue.elements[t].width);return!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.propertyIsRequiredCommand",{},{execute:function(){var t=this,n=t.arguments,i=t.model.getElement(n.guid);return n.result=i.isRequiredProperty(n.property),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getXpathNavigatorModelCommand",{},{execute:function(){var n=this,i=n.arguments,t=new $.Deferred;return i.toogleView&&n.controller.toogleXPathNavigatorView(),$.when(n.controller.getXpathNavigatorModel()).done(function(i){if($.isPlainObject(i))t.resolve(i);else if(n.controller.isGridContext())t.resolve(i);else{var r=n.controller.getXpathNavigatorView();r===bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity?i.getProcessEntityModel():i.getAllModel();t.resolve(i)}}),i.result=t.promise(),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getAdhocXpathNavigatorModelCommand",{},{execute:function(){var n=this,t=n.arguments,i=new $.Deferred;return t.toogleView&&n.controller.toogleXPathNavigatorView(),$.when(n.controller.getAdhocXpathNavigatorModelGrid()).done(function(n){i.resolve(n)}),t.result=i.promise(),!0}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getConvertToModelCommand",{renderTypeMapping:{text:"string",currency:"number",float:"number",attachment:"upload","entity-master":["combo","formlink","list","search","radio","suggest","searchsuggest","searchcombo","entitytemplate","actionlauncher"],"entity-stakeholder":["combo","formlink","list","search","radio","suggest","searchsuggest","searchcombo","entitytemplate","actionlauncher"],"entity-system":["combo","formlink","list","search","radio","suggest","searchsuggest","searchcombo","entitytemplate","actionlauncher"],"entity-parametric":["cascadingcombo","combo","formlink","list","search","radio","suggest","searchsuggest","searchcombo","entitytemplate","actionlauncher"]},renderTypeOfflineMapping:{currency:"number",float:"number",attachment:"upload","entity-master":["offlinecombo","offlineradio","offlinesuggest","offlinelist"],"entity-stakeholder":["offlinecombo","offlineradio","offlinesuggest","offlinelist"],"entity-parametric":["offlinecombo","offlineradio","offlinesuggest","offlinelist"]},renderTypeQueryMapping:{currency:"querynumber",float:"querynumber","entity-master":["querycombo","queryradio","querysuggest","querylist"],"entity-stakeholder":["querycombo","queryradio","querysuggest","querylist"],"entity-parametric":["querycascadingcombo","querycombo","queryradio","querysuggest","querylist"]}},{execute:function(){var n=this,t=n.arguments,i=new $.Deferred,r=n.model.getElement(t.guid),f,u,e;return r?(f=r.properties,u=f.xpath,n.model=r.getConvertToModel(),t.result=n.model,u?(e=n.controller.isGridContext()?n.controller.getXpathNavigatorModelGrid():n.controller.getXpathNavigatorModel(),$.when(e).done(function(r){var f=r.getNodeByXpath(bizagi.editor.utilities.resolveComplexXpath(u)),e;f&&(e=f.getRenderType(),t.result=n.getModel(e));i.resolve(!0)})):i.resolve(!0)):(t.result=[],i.resolve(!0)),i.promise()},getModel:function(n){var t=this,i=t.model;return n=t.resolveType(n),$.isArray(n)?$.grep(i,function(t){return $.inArray(t.controlName,n)>=0}):$.grep(i,function(t){return t.controlName===n||$.inArray(n,t.filterBy)>=0})},resolveType:function(n){var t=this,r=t.controller.isOfflineContext()?t.Class.renderTypeOfflineMapping:t.controller.isQueryFormContext()?t.Class.renderTypeQueryMapping:t.Class.renderTypeMapping,i;return r[n]?(i=r[n],t.controller.isGridContext()&&$.isArray(i)&&(i=$.map(i,function(n){return"column"+n})),i):n}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.applyOverridesElementCommand",{propertiesOverrides:{currency:{allowdecimals:"true",thousands:"true"},float:{allowdecimals:"true",thousands:"true"},number:{allowdecimals:"false",thousands:"false"}},requiredPropertiesOverrides:{combo:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},columncombo:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},querycombo:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},searchcombo:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},list:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},columnlist:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},querylist:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},radio:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},columnradio:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}},queryradio:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0}}}},{execute:function(){var n=this,t=n.arguments;return n.controller.isOfflineFormContext()?!0:(n.element=t.element||n.model.getElement(t.guid),!bizagi.editor.utilities.isObject(n.element.properties.xpath))?!0:(n.xpathModel=n.controller.isGridContext()?n.controller.getXpathNavigatorModelGrid():n.controller.getXpathNavigatorModel(),t.overrides=t.overrides||{properties:!0,requiredProperties:!0},t.overrides.properties&&n.propertiesOverrides(),t.overrides.requiredProperties&&n.requiredPropertiesOverrides(),n.updateControlType(),!0)},propertiesOverrides:function(){var n=this,t=n.getRenderType();t&&n.Class.propertiesOverrides[t]&&n.element.propertiesOverrides(n.Class.propertiesOverrides[t])},requiredPropertiesOverrides:function(){var n=this,r=n.element.properties,u=r.type,i=n.getRenderType(),t=n.Class.requiredPropertiesOverrides[u];t&&t[i]&&n.element.requiredPropertiesOverrides(t[i])},getRenderType:function(){var n=this,i=n.element.properties,r=i.xpath,t=n.xpathModel.getNodeByXpath(bizagi.editor.utilities.resolveComplexXpath(r));return t?t.getRenderType():!1},updateControlType:function(){var n=this;(n.element.type=="hidden"||n.element.type=="offlinehidden"||n.element.type=="columnhidden"||n.element.type=="queryhidden"||n.element.type=="layoutPlaceholder")&&(n.element.controlType=n.getRenderType())}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.getMultiselectionPropertiesCommand",{properties:{visible:!1,editable:!1,required:!1,format:!1,layout:!1},defaultValueProperties:{visible:{fixedvalue:"true"},editable:{fixedvalue:"true"},required:{fixedvalue:"false"},format:{size:undefined,bold:undefined,italic:undefined,underline:undefined,strikethru:undefined,color:undefined,background:undefined},layout:{labelwidth:50,valuewidth:50}}},{execute:function(){var n=this,t=n.arguments||{};return n.mergeModel=bizagi.clone(n.Class.properties),n.selectedElements=n.controller.getGuidsSelected(),n.getPropertiesModel(n.selectedElements),n.findCommonProperties(),t.result=n.buildModel(),n.resetProperties(),!0},getPropertiesModel:function(n){var i=this,t,u,r,f;for(i.propertiesModel={},t=0,u=n.length;t<u;t++)r=n[t],f=i.model.getElement(r),i.propertiesModel[r]=$.extend(!0,{},f.getPropertiesModel())},resetProperties:function(){var n=this;for(var t in n.Class.properties)n.Class.properties[t]=!1},findCommonProperties:function(){var n=this,t,i;n.commonProperties={};for(t in n.propertiesModel)n.resetProperties(),n.commonProperties[t]={},i=n.propertiesModel[t].elements[0].tabs,n.findPropertiesInTabs(t,i)||n.removePropertiesInMergeModel()},findPropertiesInTabs:function(n,t){for(var u,f,o,i,r=this,e=0,s=t.length;e<s;e++)for(u=t[e],f=0,o=u.elements.length;f<o;f++)if(i=u.elements[f],i.property&&r.propertyIsValid(i.property.name)&&(typeof r.mergeModel[i.property.name]=="boolean"?r.mergeModel[i.property.name]={element:i,tab:u}:r.resolvePropertyValue(i),r.findAllProperties()))return!0;return!1},resolvePropertyValue:function(n){var i=this,t,f,r,e,u;if(i.mergeModel[n.property.name]&&(t=i.mergeModel[n.property.name].element,!bizagi.editor.utilities.objectEquals(n.property.value,t.property.value)&&(t.property.value=i.Class.defaultValueProperties[n.property.name],t.property.subproperties)))for(f=t.property.subproperties,r=0,e=f.length;r<e;r++)u=f[r].property,u&&(u.value=i.Class.defaultValueProperties[u.name])},propertyIsValid:function(n){var t=this;for(var i in t.Class.properties){if(!t.Class.properties.hasOwnProperty(i))break;if(i===n)return t.Class.properties[i]=!0,!0}return!1},findAllProperties:function(){var t=this,n=!0;for(var i in t.Class.properties)if(n&=t.Class.properties[i],!n)return n;return n},removePropertiesInMergeModel:function(){var n=this;for(var t in n.Class.properties)n.Class.properties[t]||delete n.mergeModel[t]},buildModel:function(){var r=this,n={},f=r.selectedElements.length,t,i,u;n.renderCaption=f+" "+bizagi.localization.getResource("bizagi-editor-properties-multiple-controls-caption");n.idRender="00000000-0000-0000-0000-000000000000";n.element={type:"multiselect"};n.elements=[];t={tabs:[]};i=r.mergeTabs();for(u in i)t.tabs.push(i[u]);return n.elements.push(t),n},mergeTabs:function(){var i=this,t={},r,n;for(r in i.mergeModel)n=i.mergeModel[r].tab,t[n.caption]?t[n.caption].elements.push(i.mergeModel[r].element):(t[n.caption]={elements:[],caption:n.caption,id:n.id},t[n.caption].elements.push(i.mergeModel[r].element));return t}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.searchDependenciesCommand",{},{execute:function(){var n=this,t=n.arguments,r=n.model.getActionValidationsModel(),f=n.controller.isGridContext()?bizagi.editor.utilities.resolveComplexXpath(n.controller.getContextInfo().xpath)+"[].":"",i,u;for(n.actions=r.actions,n.validations=r.validations,n.mapXpath=r.mapXpaths,$.isArray(t.guids)||typeof t.guid!="string"||(t.guids=[t.guid]),i=0;i<t.guids.length;i++)if(u=n.model.getElement(t.guids[i]),n.processElement(u,f))return!0;return t.result={result:!0},!0},processElement:function(n,t){var i=this,e=i.arguments,o,u,f,r,s;if(t=t||"",!n)return!1;if(o=n.properties,u=i.xpath=t+bizagi.editor.utilities.resolveComplexXpath(o.xpath),i.isUniqueXpath(u)){if(i.idElement=n.guid,f=n.resolveDisplayNameProperty(),!i.processActions())return i.showMessage(f),e.result={result:!1,fail:"Actions"},!0;if(!i.processValidations())return i.showMessage(f),e.result={result:!1,fail:"Validations"},!0;if(n.elements)for(r=0,s=n.elements.length;r<s;r++)if(i.processElement(n.elements[r],u+"[]."))return!0}return!1},processActions:function(){for(var t,n=this,i=0,r=n.actions.length;i<r;i++)if((t=n.actions[i],n.seachInDependencies(t.dependencies))||n.searchInCommands(t.commands)||n.searchInCommands(t.elseCommands))return!1;return!0},isUniqueXpath:function(n){var r=this,t;if(!n||!r.mapXpath[n]||(t=r.mapXpath[n].elements,t.length==1))return!0;for(var u=0,e=t.length,i={form:0,nestedForm:0},f;u<e;)f=t[u++],f.nestedForm?i.nestedForm++:i.form++;return i.form===1?!0:!1},processValidations:function(){for(var i,n=this,t=0,r=n.validations.length;t<r;t++)if(i=n.validations[t],n.searchInConditions(i.conditions))return!1;return!0},seachInDependencies:function(n){var i=this,t=!1;return n&&$.each(n,function(n,r){return i.xpath===bizagi.editor.utilities.resolveComplexXpath(r)?(t=!0,!1):i.idElement===bizagi.editor.utilities.resolveComplexXpath(r)?(t=!0,!1):void 0}),t},searchInCommands:function(n){var i=this,t=!1;return n&&$.each(n,function(n,r){return r.xpath&&i.xpath===bizagi.editor.utilities.resolveComplexXpath(r.xpath)?(t=!0,!1):r.container&&r.container===i.idElement?(t=!0,!1):void 0}),t},searchInConditions:function(n){var t=this,i=!1,r=n.expressions;return $.each(r,function(n,r){if(r.simple){if(t.xpath===bizagi.editor.utilities.resolveComplexXpath(r.simple.xpath))return i=!0,!1}else if(r.complex)return t.searchInConditions(r.complex.conditions)}),i},showMessage:function(n){var r=this,t=r.arguments.message,i=bizagi.localization.getResource("formmodeler-command-searchdependencies-error").replace("{0}",n);t&&(i=t.replace("{0}",n));bizagi.showMessageBox(i,"info","info",!1)}});
bizagi.editor.notUndoableCommand.extend("bizagi.editor.refreshControlCommand",{},{execute:function(){var t=this,i=t.arguments,n=t.model.getElement(i.guid);return n&&n.refreshControl&&n.refreshControl(i),!0}});
bizagi.editor.insertElementFromXpathNavigatorCommand.extend("bizagi.editor.addEntityChildrenCommand",{},{execute:function(){var n=this,t=n.arguments,r=t.node,i=new $.Deferred;return n.elements=[],t.refresh=!0,n.addElementToRender(r.getChildren()),i.resolve(!0),t.result=i.promise(),!0},addElementToRender:function(n){var t=this;n.forEach(function(n){var i=t.resolveType(n.renderType),r;i&&n.nodeType!="form"&&(r=t.model.createElement(i,{properties:{type:i,xpath:bizagi.editor.utilities.buildComplexXpath(n.xpath,n.contextScope,n.isScopeAttribute,n.guidRelatedEntity),renderType:n.nodeSubtype}}),t.elements.push(r),t.model.addElement(r))})},resolveType:function(n){var i=this,t=i.controller.getContext();return t=="form"||t=="startform"?n==="form"?"nestedform":n:t=="grid"?this.Class.columnRenderMapping[n]:t=="offlinegrid"?this.Class.offlineColumnRenderMapping[n]:t=="searchform"?this.Class.searchFormRenderMapping[n]:t=="offlineform"?this.Class.offlineFormRenderMapping[n]:t=="queryform"?this.Class.queryFormRenderMapping[n]:null},undo:function(){var n=this;return n.elements.forEach(function(t){n.model.removeElementById(t.guid)}),!0}});
bizagi.editor.component.controller("bizagi.editor.wizard.base",{init:function(n,t){this._super(n);this.params=t},render:function(){var n=this,t=new $.Deferred;return $.when(n.loadTemplates()).done(function(){n.renderWizard();var i=n.renderButtons();i.appendTo(n.element);t.resolve()}),t.promise()},loadTemplates:function(n){n=n||{};var n=$.extend(n,{"wizard-buttons":bizagi.getTemplate("bizagi.editor.wizard.base")+"#wizard-buttons"});return this._super(n)},getButtons:function(){return[{button:"cancel",caption:bizagi.localization.getResource("bizagi-editor-wizard-buttons-cancel")},{button:"finish",caption:bizagi.localization.getResource("bizagi-editor-wizard-buttons-finish")}]},renderWizard:function(){},renderButtons:function(){var n=this,i=n.getButtons(),t=$.tmpl(n.getTemplate("wizard-buttons"),{buttons:i});return $("button",t).button(),$("button",t).click(function(){var t=$(this).attr("data-button");n.processButton(t)}),t},processButton:function(n){var t=this;n=="cancel"&&t.presenter.closePopup({success:!1});n=="finish"&&t.processFinishButton()},processFinishButton:function(){var n=this;n.presenter.closePopup({success:!0})}});
bizagi.editor.observableClass.extend("bizagi.editor.wizard.presenter",{},{createWizard:function(n,t){try{var i=t.control,r=eval("var bafn = function(canvas, params) {  return new bizagi.editor.wizard."+i+"(canvas, params);};bafn");return r(n,t)}catch(f){throw"Can't create a wizard for "+i;}},show:function(n){var r=this,t=this.popupDeferred=new $.Deferred,i=this.popup=bizagi.createPopup({name:"bz-fm-wizard",container:"form-modeler",additionalClass:"bz-fm-wizard-popup-"+n.control,title:bizagi.localization.getResource("bizagi-editor-wizard-title-"+n.control),center:!0,onClose:function(n){t.resolve(n)}});return this.wizard=this.createWizard(i.content,$.extend(n,{presenter:this,popup:i})),this.wizard.render(),t.promise()},closePopup:function(n){this.popup.close(n)}});
bizagi.editor.wizard.base("bizagi.editor.wizard.cascadingcombo",{init:function(n,t){t=t||{};this._super(n,t);this.canvas=n;this.presenter=t.presenter},loadTemplates:function(){var n={"wizard-container":bizagi.getTemplate("bizagi.editor.wizard.cascadingcombo")+"#wizard-container"};return this._super(n)},renderWizard:function(){var n=this,t=$.tmpl(n.getTemplate("wizard-container"),{});n.drawXpathNavigator(t);t.appendTo(n.canvas)},drawXpathNavigator:function(n){var t=this,i=$(".bz-fm-wizard-cascadingcombo-xpath span",n);$.when(t.params.xpathModel).done(function(n){var r=new bizagi.editor.component.xpathnavigator.presenter({canvas:i,model:n});r.subscribe("nodeClick",function(n,i){t.onNodeClick(i)});r.subscribe("nodeDoubleClick",function(n,i){t.onNodeDoubleClick(i)});r.render({allowDrag:!1,filter:{typeFilter:"xpathtoentity"}})})},processFinishButton:function(){var n=this;if(n.selectedNode==null){bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-cascadingcombo-nodatasource"),"Bizagi","error",!1);return}if(n.selectedNode.nodeType=="entity-application"){bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-cascadingcombo-invaliddatasource"),"Bizagi","error",!1);return}n.presenter.closePopup({success:!0,xpath:n.selectedNode.xpath,displayName:n.selectedNode.displayName,contextEntity:n.selectedNode.contextScope,guidRelatedEntity:n.selectedNode.guidRelatedEntity})},onNodeClick:function(n){var t=this;t.selectedNode=n},onNodeDoubleClick:function(n){var t=this;t.selectedNode=n;t.processFinishButton()}});
bizagi.editor.wizard.base("bizagi.editor.wizard.association",{init:function(n,t){t=t||{};this._super(n,t);this.canvas=n;this.presenter=t.presenter;this.model=new bizagi.editor.wizard.association.model(t.model)},loadTemplates:function(){var n={"wizard-container":bizagi.getTemplate("bizagi.editor.wizard.association")+"#wizard-container-association"};return this._super(n)},renderWizard:function(){var n=this,t=n.element;t.empty();$.when(n.loadTemplates()).done(function(){var i=n.getTemplate("wizard-container");$.tmpl(i,n.model.getViewModel()).appendTo(t)})},refresh:function(){var n=this;n.render()},updateProperty:function(n,t,i){return this.model.updateProperty(n,t,i)},getFilterProperty:function(n){return this.model.getFilter(n)},getFilterTypes:function(n){return this.model.getFilterTypes(n)},getRelatedEntity:function(n){return this.model.getRelatedEntity(n)},getPropertyValue:function(n){return this.model.getPropertyValue(n)},processFinishButton:function(){var n=this;if(!n.model.isValid()){bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-association-invalidmodel"),"Bizagi","error",!1);return}$.when(n.relationshipIsValid()).done(function(t){if(t.isValid)n.presenter.closePopup({success:!0,model:n.model.getPersistenceModel(t)});else{bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-association-invalidrelationship"),"Bizagi","error",!1);return}})},getOffsetElement:function(n){var t=n.offset();return{top:t.top+n.outerHeight(!0),left:t.left}},buildComplexXpath:function(n){return bizagi.editor.utilities.buildComplexXpath(n.xpath,n.contextScope,n.isScopeAttribute,n.guidRelatedEntity)},resolveComplexXpath:function(n){return bizagi.editor.utilities.resolveComplexXpath(n)},getMultipleRelationship:function(n){var i=this,t=new $.Deferred;return $.when(i.presenter.publish("getMultipleRelationship",n)).done(function(){t.resolve()}),t.promise()},relationshipIsValid:function(){var n=this,t=new $.Deferred,i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.getPropertyValue("leftxpath")),r=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.getPropertyValue("rightxpath"));return $.when(n.presenter.publish("getMultipleRelationship",{leftEntity:n.getPropertyValue("leftxpath"),rightEntity:n.getPropertyValue("rightxpath")})).done(function(n){var e,o,f,s,u;if(n){for(e=n.leftfact,o=n.rightfact,f=0,s=e.length;f<s;f++)if(u=e[f],u.LeftEntity.Guid==i&&u.RightEntity.Guid==r){t.resolve({isValid:!0,factxpath:u.Name,leftfactname:u.Name,rightfactname:o[0]&&o[0].Name});break}}else t.resolve(!1);t.resolve(!1)}),t.promise()},".bizagi_editor_component_editor_xpath .bz-wizard-association-editor-xpath click":function(n){var t=this,f=n.prev("input"),i=n.data("property"),r={},u;r.position=t.getOffsetElement(f,r);u=undefined;t.getFilterProperty(i)&&(u={},u.typeFilter=t.getFilterProperty(i),r.typeEditor=u.typeFilter,t.getFilterTypes(i)&&(u.types=t.getFilterTypes(i)));r.filter=u;r.entity=t.resolveComplexXpath(t.getRelatedEntity(i));r.xpath=t.resolveComplexXpath(t.getPropertyValue(i));r.xpathProperty=i;$.when(t.presenter.publish("showXPathNavigatorEditor",r)).done(function(n){var r=t.buildComplexXpath(n);t.updateProperty(r,t.resolveComplexXpath(r),i);t.refresh()})},".biz-ico-filter-value click":function(n){var i=this,r=n.data("property"),u=i.getPropertyValue(r),t={},f;t.data=u?u:{bafilter:{filter:"filter"}};t.entity=i.resolveComplexXpath(i.getRelatedEntity(r));t.xpathNode=i.presenter.publish("getXpathData",{xpath:t.entity});t.protocol="loadfilter";f=bizagi.editor.communicationprotocol.factory.createProtocol(t);$.when(f.processRequest()).done(function(n){if(n){var u=n.isEmpty?undefined:bizagi.editor.utilities.buildComplexFilter(n,t.xpathNode);i.updateProperty(u,n,r);i.refresh()}})},".editor-localizablestring-input input blur":function(n){var i=this,t=n.val(),u=n.data("property"),r=i.getPropertyValue(u),e=n.next(".editor-localizablestring-localization"),o=n.parent(),f;e.removeClass("ui-control-fadeIn");o.toggleClass("ui-control-focus");t.length>0&&(bizagi.editor.utilities.isObject(r)?(f=bizagi.editorLanguage.key,f==="default"?r.i18n["default"]=t:r.i18n.languages[f]=t,t=r):t=bizagi.editor.utilities.buildComplexLocalizable(t,i.model.getElementGuid(),u),i.updateProperty(t,bizagi.editor.utilities.resolvei18n(t),u),i.refresh())},".editor-localizablestring-input input focus":function(n){var t=n.next(".editor-localizablestring-localization"),i=n.prev('input[type="text"]').parent();t.addClass("ui-control-fadeIn");i.toggleClass("ui-control-focus")},".editor-localizablestring-input .editor-localizablestring-localization mouseenter":function(n){n.addClass("editor_localizablestring_fadeIn")},".editor-localizablestring-input .editor-localizablestring-localization mouseleave":function(n){n.removeClass("editor_localizablestring_fadeIn")},".editor-localizablestring-localization click":function(n){var t=this,r=n.prev("input"),i=r.data("property"),u=t.getPropertyValue(i),f=t.model.getElementGuid();$.when(t.presenter.publish("setLocalization",{propertyName:i,propertyValue:u,elementGuid:f})).done(function(n){t.updateProperty(n,bizagi.editor.utilities.resolvei18n(n),i);t.refresh()})}});
bizagi.editor.observableClass.extend("bizagi.editor.wizard.association.model",{},{init:function(n){var t=this;n=n||{};t.elementGuid=n.guid||Math.guid();t.data=n;t.leftProperties={};t.rightProperties={};t.properties={};t.xpathProperty=null;t.processData(n)},processData:function(n){for(var t,i,r=this,e=r.getLeftPropertiesModel(),o=r.getRightPropertiesModel(),u=0,f=e.length;u<f;u++)t=e[u],t.value=n[t.property],t.displayValue=r.getDisplayValue(t),r.leftProperties[t.property]=t,r.properties[t.property]=t;for(u=0,f=o.length;u<f;u++)i=o[u],i.value=n[i.property],i.displayValue=r.getDisplayValue(i),r.rightProperties[i.property]=i,r.properties[i.property]=i},getDisplayValue:function(n){if(n.value){if(n.editor=="xpatheditor")return bizagi.editor.utilities.resolveComplexXpath(n.value);if(n.editor=="filter")return bizagi.editor.utilities.resolvefilterExpression(n.value);if(n.editor=="localizable")return bizagi.editor.utilities.resolvei18n(n.value)}},updateProperty:function(n,t,i){var u=this,r=u.properties[i];r&&(r.value=n,r.displayValue=t,u.cleanProperties(i))},cleanProperties:function(n){var i=this,u,t,r,f,e,o;if(n=="leftxpath")for(u=i.getLeftPropertiesModel(),t=1,r=u.length;t<r;t++)f=u[t],i.leftProperties[f.property].value=null,i.leftProperties[f.property].displayValue=null;else if(n=="rightxpath")for(e=i.getRightPropertiesModel(),t=1,r=e.length;t<r;t++)o=e[t],i.rightProperties[o.property].value=null,i.rightProperties[o.property].displayValue=null},update:function(n){var t=this;t.processModel(n)},getFilter:function(n){var i=this,t=i.properties[n];return t?t.filterBy:""},getFilterTypes:function(n){var i=this,t=i.properties[n];return t?t.types:null},getRelatedEntity:function(n){var t=this,i=t.properties[n];return i?t.getPropertyValue(i.entity):null},getEntity:function(n){var i=this,t=i.properties[n];return t?t.entity:null},getPropertyValue:function(n){var i=this,t=i.properties[n];return t?t.value:null},getProperty:function(n){var t=this;return t.properties[n]},getElementGuid:function(){return this.elementGuid},updateDependencies:function(){var n=this,u=bizagi.util.isEmpty(n.getPropertyValue("leftxpath")),t,r,i;for(t in n.leftProperties)t!="leftxpath"&&(n.leftProperties[t].readonly=u);r=bizagi.util.isEmpty(n.getPropertyValue("rightxpath"));for(i in n.rightProperties)i!="rightxpath"&&(n.rightProperties[i].readonly=r)},isValid:function(){var n=this;for(var t in n.properties)if(n.properties[t].required&&!n.properties[t].value)return!1;return!0},getViewModel:function(){var n=this;return n.updateDependencies(),{leftProperties:n.getViewLeftPropertiesModel(),rightProperties:n.getViewRightPropertiesModel()}},getViewLeftPropertiesModel:function(){var n=this,t=[];for(var i in n.leftProperties)t.push(n.leftProperties[i]);return t},getViewRightPropertiesModel:function(){var n=this,t=[];for(var i in n.rightProperties)t.push(n.rightProperties[i]);return t},getLeftPropertiesModel:function(){var n=[];return n.push({property:"leftxpath",value:null,editor:"xpatheditor",filterBy:"xpathtocollection",readonly:!1,displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftxpath")}),n.push({property:"leftdisplayattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"leftxpath",required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftdisplayattrib")}),n.push({property:"leftadditionalattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"leftxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftadditionalattrib")}),n.push({property:"leftfilter",value:null,editor:"filter",readonly:!0,displayValue:null,entity:"leftxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftfilter")}),n.push({property:"leftcaption",value:"",editor:"localizable",readonly:!0,displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftcaption")}),n},getRightPropertiesModel:function(){var n=[];return n.push({property:"rightxpath",value:null,readonly:!1,editor:"xpatheditor",filterBy:"xpathtocollection",displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightxpath")}),n.push({property:"rightdisplayattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"rightxpath",required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightdisplayattrib")}),n.push({property:"rightadditionalattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"rightxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightadditionalattrib")}),n.push({property:"rightfilter",value:null,editor:"filter",readonly:!0,displayValue:null,entity:"rightxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightfilter")}),n.push({property:"rightcaption",value:"",editor:"localizable",readonly:!0,displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightcaption")}),n},getPersistenceModel:function(n){var i=this,t={};for(var r in i.properties)i.properties[r].value&&(t[r]=i.properties[r].value);return t.factxpath=n.factxpath,t.guid=i.getElementGuid(),t.leftfactname=n.leftfactname,t.rightfactname=n.rightfactname,t}});
bizagi.editor.base.services=bizagi.editor.base.services||{};bizagi.editor.base.services.EndPoint=function(){function n(n,t,i,r,u){this._name=n;this._url=t;this._method=i;this._arguments=r;this._isArray=u}return n.prototype.getName=function(){return this._name},n.prototype.setName=function(n){this._name=n},n.prototype.getUrl=function(){return this._url},n.prototype.setUrl=function(n){this._url=n},n.prototype.getIsArray=function(){return this._isArray},n.prototype.setisArray=function(n){this._isArray=n},n.prototype.getMethod=function(){return this._method},n.prototype.setMethod=function(n){this._method=n},n.prototype.getArguments=function(){return this._arguments},n.prototype.setArguments=function(n){this._arguments=n},n.prototype.setHeaders=function(n){this._headers=n},n}();
bizagi.editor.base.services.EndPointArgument=function(){function n(n,t){this._name=n;this._type=t}return n.prototype.getName=function(){return this._name},n.prototype.setName=function(n){this._name=n},n.prototype.getType=function(){return this._type},n.prototype.setType=function(n){this._type=n},n}();
var EndPointArgument=bizagi.editor.base.services.EndPointArgument;bizagi.editor.base.services.EndPointArgumentBuilder=function(){function n(){}return n.prototype.setName=function(n){return this._name=n,this},n.prototype.setType=function(n){return this._type=n,this},n.prototype.create=function(){if(this._name==null)throw"Name is null";if(this._type==null)throw"Type is null";return new EndPointArgument(this._name,this._type)},n}();
var EndPointArgumentType;(function(n){n[n.UrlPath=0]="UrlPath";n[n.QueryString=1]="QueryString";n[n.Body=2]="Body";n[n.Form=3]="Form"})(EndPointArgumentType||(EndPointArgumentType={}));
bizagi.editor.base.services.EndPointBuilder=function(){function n(){this._name=null;this._url=null;this._method=null;this._arguments=null;this._headers=null;this._isArray=!1;this.EndPoint=bizagi.editor.base.services.EndPoint}return n.prototype.setName=function(n){return this._name=n,this},n.prototype.setUrl=function(n){return this._url=n,this},n.prototype.setMethod=function(n){return this._method=n,this},n.prototype.setArguments=function(n){return this._arguments=n,this},n.prototype.setIsArray=function(n){return this._isArray=n,this},n.prototype.create=function(){if(this._name==null)throw"Name is null";if(this._url==null)throw"Url is null";if(this._method==null)throw"Method is null";if(this._arguments==null)throw"Arguments is null";if(this._isArray==null)throw"isArray is null";return new this.EndPoint(this._name,this._url,this._method,this._arguments,this._isArray)},n}();
bizagi.editor.base.services.EndPointHeader=function(){function n(n,t){this._name=n;this._value=t}return n.prototype.getName=function(){return this._name},n.prototype.setName=function(n){this._name=n},n.prototype.getValue=function(){return this._value},n.prototype.setValue=function(n){this._value=n},n}();
var EndPointMethod;(function(n){n[n.GET=0]="GET";n[n.POST=1]="POST";n[n.PUT=2]="PUT";n[n.DELETE=3]="DELETE"})(EndPointMethod||(EndPointMethod={}));
var EndPointBuilder=bizagi.editor.base.services.EndPointBuilder;bizagi.editor.base.services.EndPointsHelper=function(){function n(){}return n.prototype.getResource=function(){return(new EndPointBuilder).setName("getResource").setUrl(BIZAGI_URL_REST_SERVICES+"api/forms-designer/resources").setMethod(EndPointMethod[EndPointMethod.POST]).setArguments([]).create()},n.prototype.getMultiResources=function(){return(new EndPointBuilder).setName("getMultiResources").setUrl(BIZAGI_URL_REST_SERVICES+"api/forms-designer/multiresources").setMethod(EndPointMethod[EndPointMethod.POST]).setArguments([]).create()},new n}();
bizagi.editor.base.services.Manager=function(){function n(){}return n.prototype.requestRestService=function(n,t){if(typeof BIZAGI_EDITOR_TEST!="undefined"){var i=n.actiontype.toLowerCase();return promise=$.ajax({url:"jquery/editor/base/mocks/stub."+i+".json.txt",dataType:"json",async:!0}).pipe(function(n){return n})}return $.ajax({url:t.getUrl(),data:JSON.stringify(n),type:t.getMethod(),contentType:"application/json; charset=utf-8",dataType:"json"})},new n}();
bizagi.editor.base.services.resourcesServices=function(){function n(){this._managerServices=bizagi.editor.base.services.Manager;this._endPointHelper=bizagi.editor.base.services.EndPointsHelper;this.batch={};this.batchTimer=50}return n.prototype.getResource=function(n){return this._managerServices.requestRestService(n,this._endPointHelper.getResource()).done(function(n){return $.isArray(n)?n[0]:n})},n.prototype.getMultiResources=function(n){return this.addResource(n)},n.prototype.addResource=function(n){var t=this,i=new $.Deferred,r,u;return clearTimeout(t.batchTimeout),r=n.tag=Math.guid(),u={request:n,deferred:i},t.batch[r]=u,t.batchTimeout=setTimeout(function(){t.fire()},t.batchTimer),i.promise()},n.prototype.fire=function(){var t=this,n={},r=new $.Deferred,i=[];return $.each(t.batch,function(t,r){i.push(r);n[t]=r}),t.batch={},this._managerServices.requestRestService(i,this._endPointHelper.getMultiResources()).done(function(t){$.each(t,function(t,i){var r=i.response,u=r.tag;r.error?n[u].deferred.reject(r.error):n[u].deferred.resolve(r);delete n[u]})}),r.promise()},new n}();
bizagi.editor.wizard.base("bizagi.editor.wizard.searchlist",{init:function(n,t){t=t||{};this._super(n,t);this.canvas=n;this.presenter=t.presenter;this.model=new bizagi.editor.wizard.searchlist.model(t.model,t.gridContextXpath)},loadTemplates:function(){var n={"wizard-container":bizagi.getTemplate("bizagi.editor.wizard.searchlist")+"#wizard-container-searchlist"};return this._super(n)},renderWizard:function(){var n=this,t=n.element;t.empty();$.when(n.loadTemplates()).done(function(){var i=n.getTemplate("wizard-container");$.tmpl(i,n.model.getViewModel()).appendTo(t)})},refresh:function(){var n=this;n.render()},updateProperty:function(n,t,i){return this.model.updateProperty(n,t,i)},getFilterProperty:function(n){return this.model.getFilter(n)},getFilterTypes:function(n){return this.model.getFilterTypes(n)},getRelatedEntity:function(n){return this.model.getRelatedEntity(n)},getPropertyValue:function(n){return this.model.getPropertyValue(n)},processFinishButton:function(){var n=this;if(!n.model.isValid()){bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-searchlist-invalidmodel"),"Bizagi","error",!1);return}$.when(n.relationshipIsValid()).done(function(t){if(t.isValid)n.presenter.closePopup({success:!0,model:n.model.getPersistenceModel(t)});else{bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-searchlist-invalidrelationship"),"Bizagi","error",!1);return}})},getOffsetElement:function(n){var t=n.offset();return{top:t.top+n.outerHeight(!0),left:t.left}},buildComplexXpath:function(n){return bizagi.editor.utilities.buildComplexXpath(n.xpath,n.contextScope,n.isScopeAttribute,n.guidRelatedEntity)},resolveComplexXpath:function(n){return bizagi.editor.utilities.resolveComplexXpath(n)},clearPropertyValue:function(n){var t=this,i=n.data("property");t.updateProperty(undefined,"",i);t.refresh()},getMultipleRelationship:function(n){var i=this,t=new $.Deferred;return $.when(i.presenter.publish("getMultipleRelationship",n)).done(function(){t.resolve()}),t.promise()},relationshipIsValid:function(){var n=this,t=new $.Deferred,r=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.getPropertyValue("leftxpath")),i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(n.getPropertyValue("rightxpath"));return $.when(n.presenter.publish("getMultipleRelationship",{leftEntity:n.getPropertyValue("leftxpath"),rightEntity:n.getPropertyValue("rightxpath")})).done(function(n){var f,r,e,u;if(n){for(f=n.leftfact,r=0,e=f.length;r<e;r++)if(u=f[r],u.RightEntity.Guid==i){t.resolve({isValid:!0,factxpath:u.Name,leftfactname:u.Name});break}}else t.resolve(!1);t.resolve(!1)}),t.promise()},".bizagi_editor_component_editor_xpath .bz-wizard-searchlist-editor-xpath click":function(n){var t=this,f=n.prev("input"),r=n.data("property"),i={},u;i.position=t.getOffsetElement(f,i);u=undefined;t.getFilterProperty(r)&&(u={},u.typeFilter=t.getFilterProperty(r),i.typeEditor=u.typeFilter,t.getFilterTypes(r)&&(u.types=t.getFilterTypes(r)));i.filter=u;i.entity=t.resolveComplexXpath(t.getRelatedEntity(r));i.xpath=t.resolveComplexXpath(t.getPropertyValue(r));i.xpathProperty=r;i.allowCollection=!0;$.when(t.presenter.publish("showXPathNavigatorEditor",i)).done(function(n){var i=t.buildComplexXpath(n);t.updateProperty(i,t.resolveComplexXpath(i),r);t.refresh()})},".filter-searchList-mainDiv-value click":function(n){var i=this,r=n.data("property"),u=i.getPropertyValue(r),t={},f;t.data=u&&u.bafilter?u:{bafilter:{filter:"filter"}};t.entity=i.resolveComplexXpath(i.getRelatedEntity(r));t.xpathNode=i.presenter.publish("getXpathData",{xpath:t.entity});t.protocol="loadfilter";f=bizagi.editor.communicationprotocol.factory.createProtocol(t);$.when(f.processRequest()).done(function(n){if(n){var u=n.isEmpty?undefined:bizagi.editor.utilities.buildComplexFilter(n,t.xpathNode);i.updateProperty(u,n,r);i.refresh()}})},".filter-searchList-mainDiv-rule click":function(n){var i=this,u=n.data("property"),r=i.getPropertyValue(u),t={},f;t.data=r&&r.rule?r:{rule:{baref:{ref:"expression"}}};t.categorytype="scripting";t.protocol="ruleexpression";f=bizagi.editor.communicationprotocol.factory.createProtocol(t);$.when(f.processRequest()).done(function(n){n&&(i.updateProperty(n,n.rule.displayName,u),i.refresh())})},".filter-searchList-mainDiv-delete click":function(n){var t=this;t.clearPropertyValue(n)},".biz-ico-default click":function(n){var t=this;t.clearPropertyValue(n)},".editor-localizablestring-input input blur":function(n){var i=this,t=n.val(),u=n.data("property"),r=i.getPropertyValue(u),e=n.next(".editor-localizablestring-localization"),o=n.parent(),f;e.removeClass("ui-control-fadeIn");o.toggleClass("ui-control-focus");t.length>0&&(bizagi.editor.utilities.isObject(r)?(f=bizagi.editorLanguage.key,f==="default"?r.i18n["default"]=t:r.i18n.languages[f]=t,t=r):t=bizagi.editor.utilities.buildComplexLocalizable(t,i.model.getElementGuid(),u),i.updateProperty(t,bizagi.editor.utilities.resolvei18n(t),u),i.refresh())},".editor-localizablestring-input input focus":function(n){var t=n.next(".editor-localizablestring-localization"),i=n.prev('input[type="text"]').parent();t.addClass("ui-control-fadeIn");i.toggleClass("ui-control-focus")},".editor-localizablestring-input .editor-localizablestring-localization mouseenter":function(n){n.addClass("editor_localizablestring_fadeIn")},".editor-localizablestring-input .editor-localizablestring-localization mouseleave":function(n){n.removeClass("editor_localizablestring_fadeIn")},".editor-localizablestring-localization click":function(n){var t=this,r=n.prev("input"),i=r.data("property"),u=t.getPropertyValue(i),f=t.model.getElementGuid();$.when(t.presenter.publish("setLocalization",{propertyName:i,propertyValue:u,elementGuid:f})).done(function(n){t.updateProperty(n,bizagi.editor.utilities.resolvei18n(n),i);t.refresh()})}});
bizagi.editor.observableClass.extend("bizagi.editor.wizard.searchlist.model",{},{init:function(n,t){var i=this;n=n||{};i.elementGuid=n.guid||Math.guid();i.data=n;i.leftProperties={};i.rightProperties={};i.properties={};i.xpathProperty=null;i.gridContextXpath=t;i.processData(n)},processData:function(n){for(var i,r=this,e=r.getLeftPropertiesModel(),o=r.getRightPropertiesModel(),u=0,f=e.length;u<f;u++){var t=e[u],s=t.value,h=t.displayValue;t.value=s?s:n[t.property];t.displayValue=h?h:r.getDisplayValue(t);r.leftProperties[t.property]=t;r.properties[t.property]=t}for(u=0,f=o.length;u<f;u++)i=o[u],i.value=n[i.property],i.displayValue=r.getDisplayValue(i),r.rightProperties[i.property]=i,r.properties[i.property]=i},getDisplayValue:function(n){if(n.value){if(n.editor=="xpatheditor")return bizagi.editor.utilities.resolveComplexXpath(n.value);if(n.editor=="filter")return bizagi.editor.utilities.resolvefilterExpression(n.value);if(n.editor=="localizable")return bizagi.editor.utilities.resolvei18n(n.value)}},updateProperty:function(n,t,i){var u=this,r=u.properties[i];r&&(r.value=n,r.displayValue=t,u.cleanProperties(i))},cleanProperties:function(n){var i=this,u,t,r,f,e,o;if(n=="leftxpath")for(u=i.getLeftPropertiesModel(),t=1,r=u.length;t<r;t++)f=u[t],i.leftProperties[f.property].value=null,i.leftProperties[f.property].displayValue=null;else if(n=="rightxpath")for(e=i.getRightPropertiesModel(),t=1,r=e.length;t<r;t++)o=e[t],i.rightProperties[o.property].value=null,i.rightProperties[o.property].displayValue=null},update:function(n){var t=this;t.processModel(n)},getFilter:function(n){var i=this,t=i.properties[n];return t?t.filterBy:""},getFilterTypes:function(n){var i=this,t=i.properties[n];return t?t.types:null},getRelatedEntity:function(n){var t=this,i=t.properties[n];return i?t.getPropertyValue(i.entity):null},getEntity:function(n){var i=this,t=i.properties[n];return t?t.entity:null},getPropertyValue:function(n){var i=this,t=i.properties[n];return t?t.value:null},getProperty:function(n){var t=this;return t.properties[n]},getElementGuid:function(){return this.elementGuid},updateDependencies:function(){var n=this,u=bizagi.util.isEmpty(n.getPropertyValue("leftxpath")),t,r,i;for(t in n.leftProperties)t!="leftxpath"&&(n.leftProperties[t].readonly=u);r=bizagi.util.isEmpty(n.getPropertyValue("rightxpath"));for(i in n.rightProperties)i!="rightxpath"&&(n.rightProperties[i].readonly=r)},isValid:function(){var n=this;for(var t in n.properties)if(n.properties[t].required&&!n.properties[t].value)return!1;return!0},getViewModel:function(){var n=this;return n.updateDependencies(),{leftProperties:n.getViewLeftPropertiesModel(),rightProperties:n.getViewRightPropertiesModel()}},getViewLeftPropertiesModel:function(){var n=this,t=[];for(var i in n.leftProperties)t.push(n.leftProperties[i]);return t},getViewRightPropertiesModel:function(){var n=this,t=[];for(var i in n.rightProperties)t.push(n.rightProperties[i]);return t},getLeftPropertiesModel:function(){var n=[],t=this;return n.push({property:"leftxpath",value:null,editor:"xpatheditor",filterBy:"xpathtoentity",readonly:!1,displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-leftxpath")}),n},getRightPropertiesModel:function(){var n=[];return n.push({property:"rightxpath",value:null,readonly:!1,editor:"xpatheditor",filterBy:"xpathtocollection",displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-rightxpath")}),n.push({property:"rightdisplayattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"rightxpath",required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-rightdisplayattrib")}),n.push({property:"rightadditionalattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"rightxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-rightadditionalattrib")}),n.push({property:"rightfilter",value:null,editor:"filter",readonly:!0,displayValue:null,entity:"rightxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-rightfilter")}),n},getPersistenceModel:function(n){var i=this,t={};for(var r in i.properties)i.properties[r].value&&(t[r]=i.properties[r].value);return t.factxpath=n.factxpath,t.guid=i.getElementGuid(),t.leftfactname=n.leftfactname,t.rightfactname=n.rightfactname,t}});
bizagi=typeof bizagi!="undefined"?bizagi:{};bizagi.form=typeof bizagi.form!="undefined"?bizagi.form:{};bizagi.form.modeler=typeof bizagi.form.modeler!="undefined"?bizagi.form.modeler:{};bizagi.form.modeler.initialize=function(n){n=n||{};BIZAGI_LANGUAGE=n.language||"default";BIZAGI_ENVIRONMENT=n.environment||"debug";BIZAGI_ENABLE_LOG=typeof n.enableLog!="undefined"?n.enableLog:!0;BIZAGI_ENABLE_CUSTOMIZATIONS=!1;BIZAGI_DEFAULT_DATETIME_INFO=!1;BIZAGI_URL_REST_SERVICES=n.urlRestServices||"http://localhost:3333/";BIZAGI_USER=n.user||"";BIZAGI_IDENTIFIER_MODEL=n.idModel||"";var t=bizagi.loader;t.init(function(){t.start("formModeler")})};bizagi.form.modeler.instance=null;bizagi.form.modeler.createForm=function(n){var t=typeof $!="undefined"?new $.Deferred:null;return bizagi.loader.whenModuleLoaded("formModeler",function(){bizagi.form.modeler.params=n;switch(n.context){case"template":bizagi.form.modeler.instance=new bizagi.editor.templateView(n);break;case"adhocform":bizagi.form.modeler.instance=new bizagi.editor.adhocModelerView(n);break;default:bizagi.form.modeler.instance=new bizagi.editor.modelerView(n)}t&&t.resolve(bizagi.form.modeler.instance)}),t?t.promise():null};bizagi.form.modeler.saveForm=function(n){return n&&n.encode?bizagi.util.unicode2htmlencode(JSON.encode(bizagi.form.modeler.instance.save())):JSON.encode(bizagi.form.modeler.instance.save())};bizagi.form.modeler.updateForm=function(n){bizagi.form.modeler.instance.updateForm(n)};bizagi.form.modeler.validateAndSaveForm=function(){return JSON.encode(bizagi.form.modeler.instance.validateAndSaveForm())};
bizagi.editor=bizagi.editor||{};bizagi.editor.overrides={EnableCssClassProperty:{group:{properties:{disable:["cssclass"]}},tab:{properties:{disable:["cssclass"]}},columncombo:{properties:{disable:["cssclass"]}},columndate:{properties:{disable:["cssclass"]}},columnboolean:{properties:{disable:["cssclass"]}},columnbutton:{properties:{disable:["cssclass"]}},columndocument:{properties:{disable:["cssclass"]}},columnformlink:{properties:{disable:["cssclass"]}},columnimage:{properties:{disable:["cssclass"]}},columnlabel:{properties:{disable:["cssclass"]}},columnletter:{properties:{disable:["cssclass"]}},columnlink:{properties:{disable:["cssclass"]}},columnlist:{properties:{disable:["cssclass"]}},columnmoney:{properties:{disable:["cssclass"]}},columnnumber:{properties:{disable:["cssclass"]}},columnradio:{properties:{disable:["cssclass"]}},columnsearch:{properties:{disable:["cssclass"]}},columnsuggest:{properties:{disable:["cssclass"]}},columntext:{properties:{disable:["cssclass"]}},columnupload:{properties:{disable:["cssclass"]}},columnuploadecm:{properties:{disable:["cssclass"]}},association:{properties:{disable:["cssclass"]}},boolean:{properties:{disable:["cssclass"]}},cascadingcombo:{properties:{disable:["cssclass"]}},combo:{properties:{disable:["cssclass"]}},contentpanel:{properties:{disable:["cssclass"]}},date:{properties:{disable:["cssclass"]}},document:{properties:{disable:["cssclass"]}},fileprint:{properties:{disable:["cssclass"]}},formlink:{properties:{disable:["cssclass"]}},grid:{properties:{disable:["cssclass"]}},groupedgrid:{properties:{disable:["cssclass"]}},image:{properties:{disable:["cssclass"]}},label:{properties:{disable:["cssclass"]}},letter:{properties:{disable:["cssclass"]}},link:{properties:{disable:["cssclass"]}},list:{properties:{disable:["cssclass"]}},money:{properties:{disable:["cssclass"]}},nestedform:{properties:{disable:["cssclass"]}},number:{properties:{disable:["cssclass"]}},panel:{properties:{disable:["cssclass"]}},radio:{properties:{disable:["cssclass"]}},search:{properties:{disable:["cssclass"]}},suggest:{properties:{disable:["cssclass"]}},tabitem:{properties:{disable:["cssclass"]}},text:{properties:{disable:["cssclass"]}},upload:{properties:{disable:["cssclass"]}},uploadecm:{properties:{disable:["cssclass"]}}}};
;
bizagi.editor.modelerView.extend("bizagi.editor.templateView",{},{init:function(n){var t=this;t._super(n)},load:function(n){var t=this;$.when(this.controller.ready()).done(function(){t.executeCommand({command:"loadModel",dataModel:n,canUndo:!1})})},save:function(){var t=this,n={command:"saveModel",dataModel:{},canUndo:!1};return t.executeCommand(n),n.dataModel},validateAndSaveForm:function(){var n=this;n.performSave(!0)},updateForm:function(n){var i=this,t;t={command:"updateModel",data:n,canUndo:!1};i.executeCommand(t)},setOriginalModel:function(){var n=this;$.when(this.controller.ready()).done(function(){n.controller.setOriginalModel()})},processLayout:function(n){var t=this,i=new $.Deferred,r;return t.mainContainer=$("<form-modeler />").attr("id","container-layout"),t.mainContainer.appendTo(n.canvas||"body"),t.configureHtmlPage(),r=new bizagi.editor.component.layout.presenter({canvas:t.mainContainer,context:n.context,isActivityForm:n.isActivityForm}),$.when(r.render()).done(function(){setTimeout(function(){t.configureLeftPane();t.drawRibbon();t.configureTemplateView();t.controller.isReadOnlyForm()&&t.showUserInformation();i.resolve()},100)}),i.promise()},configureHtmlPage:function(){var n=this;n.mainContainer.addClass("biz-template-editor");n.mainContainer.addClass("biz-font").addClass("biz-normal-font").addClass("biz-text-color");$("body").attr("oncontextmenu","return false")},configureLeftPane:function(){var n=this;$.when(n.drawXpathNavigator()).done(function(){n.mainContainer.find("#left-panel").tabs({});n.mainContainer.find("#left-panel li[tabindex]:gt(0)").remove()})},configureKeyHandlers:function(){var n=this;$(document).keydown(function(){}).keyup(function(t){t.keyCode===46&&($(document.activeElement).is("input, textarea")||n.deleteElement())});$(document).on("keydown",function(t){t.keyCode==17&&n.controller.setCtrlKey(!0)});$(document).on("keyup",function(){n.controller.isCtrlKeyPressed()&&n.controller.setCtrlKey(!1)})},needsRedrawAfterTabChange:function(n){var t=this;return t.currentTabIndex<2&&n===2?!0:t.currentTabIndex===2&&n<2?!0:!1},setBannerVisibility:function(n){var t=this,i=n?$("a",n.newTab).attr("data-banner"):"hide";i==="show"?t.showBanner():t.hideBanner()},preRender:function(n){var t=this;t.validateForm&&n.canValidate&&t.processTemplateValidations({canRefresh:!1})},render:function(n,t){var i=this;i.renderTemplate(n,t)},postRender:function(){var n=this,t=null;n.controller.thereAreMultiselection()&&(t=bizagi.editor.utilities.getGuidEmpty());n.refreshRibbon(t)},refreshCanvas:function(){var t,n,u,f,r,i;t=$("#main-panel");n=$(".wrapper-main-scroll");u=1;f=$("> .bz-design-template",t);r=$(".top-scroll-grad",n);i=$(".bottom-scroll-grad",n);var e=parseFloat(t.css("padding-top"))+parseFloat(t.css("padding-bottom")),o=Math.floor(n.height()*u-e),s=n.position().top,h=n.position().top+n.outerHeight(!0)-i.height(),c=f.prop("scrollHeight");c>o?(t.addClass("biz-auto-height"),i.css("top",h).css("width",n.width()),i.show(),r.css("top",s).css("width",n.width()),r.show()):(i.hide(),r.hide(),t.removeClass("biz-auto-height"));t.hasClass("biz-auto-height")&&($(".top-scroll-grad",n).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollTopInterval(n,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}),$(".bottom-scroll-grad",n).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollBottomInterval(n,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}))},renderTemplate:function(){var n=this;n.showRenderingModel()},renderForm:function(n,t){var i=this,r=$("#main-panel");if(i.refreshRenderingView(n,t),i.controller.isActivityForm()){if(i.refreshButtonEditor(),i.renderingMode=="design")r.on("widgetComplete",function(){i.refreshCanvas()});i.refreshCanvas()}},renderSearchForm:function(n){this.refreshRenderingView(n);this.refreshSearchFormResult()},renderGridColumnEditor:function(){this.refreshGridColumnEditor()},enableLayoutTab:function(){var n=this;n.mainContainer.find("#left-panel").tabs("option","disabled",[])},disableLayoutTab:function(){var n=this;n.mainContainer.find("#left-panel").tabs("option","disabled",[2])}});
bizagi.editor.modelerView.extend("bizagi.editor.adhocModelerView",{},{init:function(n){var t=this;t.initializeForm(n);t.formModelerParams=n;n=n||{};t.renderingMode="design";t.validateForm=!1;bizagi.editor.view.prototype.init.apply(this,[n]);t.currentTabIndex=0;bizagi.editorLanguage={displayname:"default",IsRightToLeft:!1,key:"default"};n.data?$.when(t.load(n.data),this.controller.ready()).done(function(){t.processLayout(n)}):$.when(this.controller.ready()).done(function(){t.processLayout(n)});n.autoGenerate&&t.autoGenerate();t.setOriginalModel();t.applyCustomOverrides()},configureLeftPane:function(){var n=this;$.when(n.drawControlsNavigator(),n.drawXpathNavigator(),n.drawLayoutNavigator(),n.drawBanner()).done(function(){n.mainContainer.find("#left-panel").tabs({beforeActivate:function(t,i){var r=$("a",i.newTab).data("rendering-mode");n.hidePropertyBox();n.needsRedrawAfterTabChange(i.newTab.index())&&(n.currentSelectedElement=null,n.controller.removeSelectedElement(),n.renderingMode=r,n.render(r));n.currentTabIndex=i.newTab.index();n.setBannerVisibility(i)}});n.setBannerVisibility()})},configureHtmlPage:function(n){var t=this,i=t.adhocCanvas=n.canvas;i.addClass("biz-work-area");$("body").attr("oncontextmenu","return false")},drawPropertyBox:function(n){var t=this;t.propertyBox&&t.hidePropertyBox();t.redrawPropertyBox=n.redraw?n.redraw:!1;t.propertyBox=t.formModelerParams?new bizagi.editor.component.properties.presenter({adhocProcessId:t.formModelerParams.adhocProcessId}):new bizagi.editor.component.properties.presenter;t.propertyBox.subscribe("propertyChanged",function(n,i){return t.onPropertiesChanged(i)});t.propertyBox.subscribe("getRenderElement",function(n,i){return t.onGetRenderElement(i)});t.propertyBox.subscribe("destroy",function(n,i){t.hidePropertyBox(i)});t.editorValidations={};t.guid=n.guid||t.currentSelectedElement;t.formProperties=n&&n.formProperties?!0:!1;t.refreshPropertyBox()},showElementXpath:function(){},saveForm:function(){var n=this,t=$.Deferred(),i=$("#container-layout");return $.when(n.executeCommand({command:"saveModel"})).done(function(r){var f={message:bizagi.localization.getResource("formmodeler-component-wait-message-save")},u=new bizagi.editor.component.wait.presenter({model:f,renderArea:i});$.when(u.render()).done(function(){var i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"saveform",jsonForm:r,adhocTaskId:n.formModelerParams.adhocTaskId,adhocProcessId:n.formModelerParams.adhocProcessId,isAdhocSummaryForm:n.formModelerParams.isAdhocSummaryForm?!0:!1});setTimeout(function(){$.when(i.processRequest()).done(function(){n.controller.setNewForm(!1);n.refreshRibbon();n.refreshPropertyBox();u.destroy();t.resolve()})},200)})}),t.promise()},load:function(n){var t=this;return $.when(this.controller.ready()).done(function(){t.executeCommand({command:"loadModel",dataModel:n,canUndo:!1,refresh:!0})})},applyCustomOverrides:function(){bizagi.editor.component.properties.commands.allowdecimals.prototype.execute=function(){};bizagi.editor.component.properties.commands.numberrange.prototype.execute=function(){var n=this;n.properties.allowdecimals=!0;n.indexedProperty.notShow=!1};bizagi.editor.component.properties.commands.thousands.prototype.execute=function(){};bizagi.editor.component.properties.commands.defaultvalue.prototype.execute=function(){var n=this;n.indexedProperty.notShow=!1};bizagi.editor.component.properties.commands.data.displayattrib.prototype.execute=function(){var n=this;n.element.properties.data.datasource&&n.element.properties.data.datasource.type==="bizagi"?n.indexedProperty.show=!0:(n.element.properties.data.datasource&&n.element.properties.data.datasource.type==="adhoc"&&(n.element.properties.data.displayattrib=undefined),n.indexedProperty.show=!1)}},changeXpathPropertyForElement:function(n,t,i){var r=this,e,f,u;(r.editorValidations[n]===undefined||(e=r.validateXpathChange(n,t,i),e))&&(f="",f=i.data.entityContext=="adhoc"?i.guid:bizagi.editor.utilities.buildComplexXpath(i.xpath,i.contextScope,i.isScopeAttribute,i.guidRelatedEntity),u={command:"changeProperty",guid:n,property:t,value:f,refreshProperties:!0,removeDefaultDisplayName:!0,renderTypeProperty:i.nodeSubtype,validateForm:r.validateForm},r.editorValidations[n]&&r.editorValidations[n].exclusive!==undefined&&(u=$.extend({},u,{exclusive:r.editorValidations[n].exclusive})),r.executeCommand(u))},initializeForm:function(n){n.data||(n.data={properties:{displayName:"AdhocForm_"+Math.guid()}})},refreshXpathNavigator:function(n){var t=this;t.controller.isGridContext()?$.when(t.executeCommand({command:"getAdhocXpathNavigatorModel"})).done(function(i){t.controller.setXpathNavigatorModelGrid(i);var r={model:n&&n.model||i,context:n?n.context:undefined,scope:t.controller.getContext(),isReadOnly:t.controller.isReadOnlyForm()};t.xpathNavigator.render(r)}):t._super(n)}});
