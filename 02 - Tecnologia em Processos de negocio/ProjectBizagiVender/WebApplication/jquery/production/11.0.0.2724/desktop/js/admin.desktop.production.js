$.bizagi||($.bizagi={processviewer:{}});$.bizagi.processviewer={configuration:{constants:{ELEMENT_TYPE:{PROCESS:"Process",LANE:"Lane",MILESTONES:"Milestone",TEXTANNOTATION:"TextAnnotation",ASSOCIATION:"Association",SEQUENCEFLOW:"SequenceFlow"},CONDITION_TYPE:{SUBPROCESSEXP:"SubprocessException",CANCELLATION:"Cancellation",NORMAL:"Normal",RELATION:"Relation",COMPENSATION:"Compensation"},PROPERTIES:{WAYPOINTS:"waypoints",BOUNDS:"bounds"},LANESETS:"laneSets",LANES:"lanes",BPMNLABELSTYLES:"bpmnLabelStyles"},validTypeDefinitions:["artifacts","flowElements","laneSets","milestones"]},design:{markers:{normal:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401","class":"normal"}},highlighted:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401","class":"highlighted"}},selected:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401","class":"highlighted"}},association:{type:"path",properties:{d:"M0.595,0.598  l8.8,4.132l-8.8,4.667","class":"association"}}}}};
(function(n){n.widget("ui.processviewer",{constants:n.bizagi.processviewer.configuration.constants,options:{image:null,zoomRange:50,hotspots:[],dragMessage:"Drag Image (Image Pane)",processMessage:"Process Image....",previewWidth:120,previewHeight:120,hotspotsCSS:"",draggable:!0,controls:!0,zoomImageOptions:!1,moveIncrement:20,isIE8:!1,device:"desktop",minZoom:.5,minZoomIE8:.5,maxZoomIE8:1.5,maxZoom:1.5,template:!1,unavailableImage:"img/unavailable_image.png",tmpl:"bizagi.processviewer.template",hotSpotsSVG:!1,formatStyles:{},milestonesHeight:25,animation:{path:[],interval:0,instance:0,time:200,counter:0},configuration:{localTemplate:"",processviewerStageId:"",processviewerStage:"",$processviewerStage:"",processviewerStageSet:"",processviewerImageStage:"",processviewerHotSpotsContainer:"",processviewerStagePathsSet:"",errorImageCSS:"processviewer-error-image",sliderOptions:{}},getTemplate:function(n){return bizagi.getTemplate(n)}},_create:function(){var t=this;n.support.touch="ontouchend"in document;t._isInWorkportal()?typeof bizagi!="undefined"&&typeof bizagi.util!="undefined"&&(t.options.isIE8=bizagi.util.isIE8(),t.options.device=bizagi.util.detectDevice()):bizagi={workportal:!1};t.$el=n('<div class="wdg-processviewer"><\/div>');t.$el.attr("role","widget.bizagi.processviewer");t.element.append(t.$el);t.options.jsonBizagi?typeof t.options.jsonBizagi.processDefinition=="string"&&typeof t.options.jsonBizagi.processDefinition=="string"?n.when(n.get(t.options.jsonBizagi.processDefinition),n.get(t.options.jsonBizagi.processGraphicsInfo)).done(function(n,i){t._processDataForPlugin({definition:n[0],graphics:i[0]})}).fail(function(n){t.$el.text(n.message)}):t._processDataForPlugin({definition:t.options.jsonBizagi.processDefinition,graphics:t.options.jsonBizagi.processGraphicsInfo}):t._loadTemplate()},_processDataForPlugin:function(t){var i=this;t.definition.status||t.graphics.status?i._triggers.error({message:t.definition.message,json:t}):n.when(n(t).processviewerQueries()).done(function(t){n.extend(i.options,t);i._loadTemplate()})},_triggerError:function(){},_loadTemplate:function(){var t=this,i=t.options.template;bizagi.workportal?(t.loader=new bizagi.ui.controls.tmplloader,i?i.indexOf(".html")&&n.when(t.loader.loadTemplates({processviewer:i})).done(function(){t.options.configuration.localTemplate=t.loader.getTemplate("processviewer");t._buildprocessviewer()}):(i=t.options.getTemplate(t.options.tmpl),n.when(t.loader.loadTemplates({processviewer:i})).done(function(){t.options.configuration.localTemplate=t.loader.getTemplate("processviewer");t._buildprocessviewer()}))):i?i.indexOf(".html")&&n.when(n.get(t.options.template)).done(function(n){t.options.configuration.localTemplate=n;t._buildprocessviewer()}):(i=t.options.getTemplate(t.options.tmpl),n.when(n.get(i)).done(function(n){t.options.configuration.localTemplate=n;t._buildprocessviewer()}))},_buildprocessviewer:function(){var t=this,i,r;t.$el.empty();i=t.options.configuration.processviewerStageId=t._generateID();r=n.tmpl(t.options.configuration.localTemplate,{id:i,isIE8:t.options.isIE8});t.$el.append(r);t._createStage()},resize:function(n,t){var i=this;t=t||i.options.width;h=n||i.options.height;i.$el.outerWidth(t);i.$el.outerHeight(n)},_createStage:function(){var t=this,r,u,o=0,s=0,f,e,i,a,h,c,l;r=t.options.width?t.options.width:"100%";u=t.options.height?t.options.height:150;t.$el.outerWidth(r);t.$el.outerHeight(u);c=t.options.dimentions.width*100/150+t.options.dimentions.width;l=t.options.dimentions.height*100/150+t.options.dimentions.height;t.options.configuration.processviewerStage=i=new Raphael(t._getStageContainer(),c,l);t.options.configuration.processviewerPathsStageGroup=a=i.group();i.canvas.setAttribute("id",t._generateID());i.canvas.setAttribute("id",t._generateID());i.canvas.setAttribute("class","processviewer-zvg-container");i.canvas.setAttribute("class","processviewer-zvg-nested");t.options.configuration.processviewerStageSet=i.set();t.options.configuration.processviewerstageHotSpotSet=i.set();n("[data-processviewercontainer]",t.element).height(t.options.dimentions.height);t.options.dimentions.height<u&&n("[data-processviewercontainer]",t.element).height(u);r.indexOf("%")&&(h=!0);h||t.options.dimentions.width<r?n("[data-processviewercontainer]",t.element).width("100%"):n("[data-processviewercontainer]",t.element).width(t.options.dimentions.width);t.options.dimentions.width<r&&n("[data-processviewercontainer]",t.element).width(r);t.options.image?n.when(t._verifyingImage(t.options.image)).done(function(n){f=n.width?n.width:"150";e=n.height?n.height:"150";t.options.configuration.processviewerImageStage=t.options.configuration.processviewerStage.image(n.src,o,s,f,e);t.options.configuration.processviewerStageSet.push(t.options.configuration.processviewerImageStage);t.options.configuration.processviewerRectStage.attr("fill","rgba(255,255,255,0)");t.options.configuration.processviewerRectStage.attr("stroke","none");t._createUIControls()}).fail(function(n){t._createUIFailView(n)}):(f=t.element.width()?t.element.width():"150",e=t.element.height()?t.element.height():"150",t.options.configuration.processviewerRectStage=t.options.configuration.processviewerStage.rect(o,s,r*2,u*2),t.options.configuration.processviewerRectStage.attr("fill","rgba(255,255,255,0)"),t.options.configuration.processviewerRectStage.attr("stroke","none"),t.options.configuration.processviewerRectStage[0].setAttribute("id","BaseStage"+t._generateID()),t._createUIControls())},_createUIControls:function(){var t=this,i=t.options.configuration.processviewerStage,r=t.options.configuration.processviewerImageStage;t.options.draggable&&t._setDraggable();n.when(t._createSVGProcessPool(),t._createSVGLanes(),t._createSVGMilestones(),t._createSVGSequenceFlows()).done(function(){t._createStyleFormats();t.options.isIE8||t._createMarkers();t._addHandlers();t._createSlider();t.options.hotSpotsSVG?t._createSVGHotSpots():n.when(t._createHTMLHotSpots()).done(function(){t._adjustLabelsPosition();var n={type:"pvComplete",message:"processviewer complete",time:new Date,ui:t.$el};t.element.trigger(n)})})},_createSlider:function(){var t=this,e=t.validateHTML5Features.checkInput("range"),i,r,u,f;n.support.touch||e?(n(".ui-for-desktop").remove(),i=n("input[type='range']"),i.attr("min",t.options.minZoom),i.attr("max",t.options.maxZoom),i.attr("step",.1),i.attr("value",1),n.support.touch&&t.options.device!=="desktop"?(i.change(function(){t._updateOutputSlider(this)}),i.bind("touchstart",function(){var i=n(this);i.prev("output").addClass("is-visible-output");t._updateOutputSlider(this)}),i.bind("touchend",function(){var i=n(this).val(),r=n(this);r.prev("output").removeClass("is-visible-output");t.options.configuration.processviewerPathsStageGroup.scale(i);t.options.configuration.processviewerHotSpotsContainer.css("font-size",i+"em");t._updateHotSpotsScale(i);t._updateOutputSlider(this)})):(i.mouseenter(function(){var i=n(this);i.prev("output").addClass("is-visible-output");t._updateOutputSlider(this)}).mouseleave(function(){var t=n(this);t.prev("output").removeClass("is-visible-output")}),i.change(function(i){var r,u;t._updateOutputSlider(this);r=n(this).val();t.options.configuration.processviewerPathsStageGroup.scale(r);t.options.configuration.processviewerHotSpotsContainer.css("font-size",r+"em");u=n(t.options.configuration.processviewerStage.defs);n(t.options.configuration.processviewerStage.canvas).append(u);t._updateHotSpotsScale(r);i.stopPropagation()}))):(n(".ui-for-touch").remove(),r=n(".processviewer-zvg-nested"),r.data("real-width",r.width()),r.data("real-height",r.height()),u=1,f=function(t,i){var r=i.value||u,f=Math.round(r*100)+"%",e='<div class="tooltip"><div class="tooltip-inner">'+f+"<\/div><\/div>";n(".sliderTooltip").html(e)},t.options.configuration.sliderOptions={min:t.options.minZoomIE8,max:t.options.maxZoomIE8,step:.1,value:u,create:f,slide:f,stop:function(n,i){i.value>1&&(r[0].setAttribute("width",r.data("real-width")*i.value),r[0].setAttribute("height",r.data("real-height")*i.value));t.options.configuration.processviewerPathsStageGroup.scale(i.value);t.options.configuration.processviewerHotSpotsContainer.css("font-size",i.value+"em");t._updateHotSpotsScale(i.value);t._setDraggable()}},n("[data-processviewerslider]",t.element).slider(t.options.configuration.sliderOptions))},_updateOutputSlider:function(t){var i=n(t);i.prev("output").text(Math.round(i.val()*100)+"%")},_updateHotSpotsScale:function(t){var e=this,u=e.options.configuration.hotspotsList,f,r;for(n("[data-processviewerhotspots]").hide(),f=n(".processviewer-hotspot-icon svg g"),f.each(function(){this.setAttribute("transform","scale("+t/10+")")}),r=0;r<u.length;r++){var i=n(u[r]),o=i.data("real-width")*t,s=i.data("real-height")*t,h=i.data("real-left")*t,c=i.data("real-top")*t;i.outerWidth(o);i.outerHeight(s);i.css("left",h);i.css("top",c)}n("[data-processviewerhotspots]").show()},_scaleSVG:function(){},_addHandlers:function(){var t=this;n(window).on("resize.processviewer",function(){t._setDraggable()})},_setDraggable:function(){var t=this,i,u,f;if(n.support.touch&&t.options.device!=="desktop"){var r=t.options.configuration.processviewerPathsStageGroup.getScale(),e=t.options.configuration.processviewerStage.canvas.getAttribute("width")*r,o=t.options.configuration.processviewerStage.canvas.getAttribute("height")*r;n(".processviewer-wrapper").addClass("ui-scroll-touch");n("[data-processviewercontainer]",t.element).width(e);n("[data-processviewercontainer]",t.element).height(o)}else if(t.options.configuration.$processviewerStage=n(t.options.configuration.processviewerStage.canvas).parent(),u=n("[data-processviewercontainer]",t.element).position(),u){var r=t.options.configuration.processviewerPathsStageGroup.getScale(),s=t.element.width(),h=t.element.height(),e=t.options.configuration.processviewerStage.width*r,o=t.options.configuration.processviewerStage.height*r;maxleft=u.left;maxTop=u.top;f=n("[data-processviewer-wrapper-container]",t.element).is(":ui-draggable");s<e||h<o?f||(t.$el.addClass(" processviewer-drag"),i=t._dragLimits(),t.options.configuration.$processviewerStage.draggable({refreshPositions:!0,drag:function(n,r){i=t._dragLimits();r.position.left>=0&&(r.position.left=0);r.position.top>=0&&(r.position.top=0);r.position.top<i.y&&(r.position.top=i.y);r.position.left<i.x&&(r.position.left=i.x)}})):f&&(t.options.configuration.$processviewerStage.draggable("destroy"),t.element.removeClass("processviewer-drag"),t.options.configuration.$processviewerStage.css({left:0,top:0}),t.options.configuration.processviewerHotSpotsContainer.css({left:0,top:0}))}},_dragLimits:function(){var n=this,t=n.options.configuration.processviewerPathsStageGroup.getScale(),i=n.element.width(),r=n.element.height(),u=n.options.configuration.processviewerStage.width*t,f=n.options.configuration.processviewerStage.height*t,e=0,o=0;return i<u&&(e=i-u),r<f&&(o=r-f),{x:e,y:o}},_movePaths:function(n,t){var i=this;i.options.configuration.processviewerStage.move(n,t)},_createMarkers:function(){var t=this,r=n.bizagi.processviewer.design.markers,i;if(r)for(i in r){var f=r[i].properties,e={id:i,css:i,markerHeight:10,markerWidth:10,refX:10,refY:5,orient:"auto"},u=t.options.configuration.processviewerStage.marker();n(u.node).attrSVG(e);n(u.node.lastElementChild).attrSVG(f);t.options.configuration.processviewerMarkerEndArrow||(t.options.configuration.processviewerMarkerEndArrow=[]);t.options.configuration.processviewerMarkerEndArrow.push(u)}},_createStyleFormats:function(){var e=this,u=e.options.formatStyles,f=n("<div><\/div>"),t="<style>",i,r;for(i in u)r="."+i.toLowerCase()+"{",f.css(u[i].css),r+=f.attr("style")+"}",t+=r;t+="<\/style>";n("head").append(n(t))},_asignLabelFormat:function(t,i){var o=this,f,e,r,u;if(i.bpmnLabel&&i.bpmnLabel.labelStyle)for(f=i.bpmnLabel.labelStyle,e=o.options.formatStyles[f],n(t).closest("svg").length>0&&n(t).css(e.css),r=e.cssClass,r.push(f),u=0;u<r.length;u++)n(t).addClass(r[u].toLowerCase())},_createSVGProcessPool:function(){for(var n=this,i=[],r=n.options.configuration.processviewerPathsStageGroup,t=n.options.hotspots.length-1;t>=0;t--)n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.PROCESS&&(i.push(n.options.hotspots[t]),n.options.hotspots.splice(t,1));n._createSVGRect(r,i,"processPool")},_createSVGLanes:function(){for(var n=this,i=[],r=n.options.configuration.processviewerPathsStageGroup,t=n.options.hotspots.length-1;t>=0;t--)n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.LANE&&(i.push(n.options.hotspots[t]),n.options.hotspots.splice(t,1));n._createSVGRect(r,i,"lanes")},_createSVGMilestones:function(){for(var n=this,i=[],r=n.options.configuration.processviewerPathsStageGroup,t=n.options.hotspots.length-1;t>=0;t--)n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.MILESTONES&&(i.push(n.options.hotspots[t]),n.options.hotspots.splice(t,1));n._createSVGRect(r,i,"milestones")},_createSVGSequenceFlows:function(){for(var n=this,i=[],r=n.options.configuration.processviewerPathsStageGroup,t=n.options.hotspots.length-1;t>=0;t--)(n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.SEQUENCEFLOW||n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.ASSOCIATION)&&n.options.hotspots[t].hasOwnProperty(n.constants.PROPERTIES.WAYPOINTS)&&(i.push(n.options.hotspots[t]),n.options.hotspots[t].conditionType===n.constants.CONDITION_TYPE.NORMAL&&n.options.hotspots.splice(t,1));n._createSVGPaths(r,i)},_createSVGRect:function(t,i){for(var r,e,o,d,g,a,u=this,f,s=0;s<i.length;s++)if(r=i[s],r[u.constants.PROPERTIES.BOUNDS]===undefined)console.log(r);else{if(e=r[u.constants.PROPERTIES.BOUNDS],o=t.rect(e.x,e.y,e.width,e.height),r.bpmnElementRef?o[0].setAttribute("id",r.bpmnElementRef):r.bpmnElement&&r.bpmnElement.baref&&r.bpmnElement.baref.ref&&o[0].setAttribute("id",r.bpmnElement.baref.ref),r.displayName===""&&(r.displayName="Lane"),r.displayName&&(f=t.text(e.height/-2,10,r.displayName)),r.elementType===u.constants.ELEMENT_TYPE.PROCESS&&(f.attr({"font-weight":"600",y:r.bounds.y+e.height/2,x:10}).data("rotation",-90),f.transform("r-90")),r.elementType===u.constants.ELEMENT_TYPE.MILESTONES){f.attr({"font-weight":"600",y:r.bounds.y+16,x:r.bounds.x+e.width/2});o.attr("height",u.options.milestonesHeight);var h=r.bounds.x+r.bounds.width,v=r.bounds.y+u.options.milestonesHeight,y=r.bounds.height,p=u._getPathString([{x:h,y:v},{x:h,y:y}]),w=t.path(p);w.attr({stroke:"#CCC","stroke-dasharray":"--"});var c=h-1,b=u._getPathString([{x:c,y:r.bounds.y},{x:c+u.options.milestonesHeight,y:u.options.milestonesHeight/2},{x:c,y:u.options.milestonesHeight}]),k=t.path(b);k.attr({stroke:"#CCC",fill:"#FFF"})}if(r.elementType===u.constants.ELEMENT_TYPE.LANE){d=n(f.node).width()/2+r.bounds.height/2;g=n(f.node).height();f.attr({y:r.bounds.y+r.bounds.height/2,x:r.bounds.x+10,"font-weight":"600"}).data("rotation",-90);f.transform("r-90");var l=r.bounds.x+30,nt=r.bounds.height,tt=u._getPathString([{x:l,y:r.bounds.y+25},{x:l,y:nt}]),it=t.path(tt);it.attr({stroke:"#E6E6E6",fill:"none"})}a=n(o[0]);a.attr("id")&&r.displayName&&n(f[0]).data("id",r.id);o.attr({stroke:"#E6E6E6",fill:"none"});u._asignLabelFormat(f[0],r)}},_createSVGPaths:function(t,i){for(var r,e,s,f,c,h,l,u=this,o=0;o<i.length;o++)r=i[o],r[u.constants.PROPERTIES.WAYPOINTS]===undefined?console.log(r):(e=!1,r.elementType!==u.constants.ELEMENT_TYPE.TEXTANNOTATION&&r.conditionType!==u.constants.CONDITION_TYPE.RELATION&&r.conditionType!==u.constants.CONDITION_TYPE.COMPENSATION&&(e=!0),s=u._getPathString(r[u.constants.PROPERTIES.WAYPOINTS]),s+=u.options.isIE8&&e?u._getArrowPathString(r[u.constants.PROPERTIES.WAYPOINTS]):"",f=t.path(s),r.bpmnElementRef?f[0].setAttribute("id",r.bpmnElementRef):r.bpmnElement&&r.bpmnElement.baref&&r.bpmnElement.baref.ref&&f[0].setAttribute("id",r.bpmnElement.baref.ref),e&&n(f.node).setMarkerSVG("normal"),c=f.getTotalLength()/2,h=f.getPointAtLength(c),r.displayName&&(nText=t.text(h.x,h.y,r.displayName)),l=n(f[0]),l.attr("id")&&r.displayName&&n(nText[0]).data("id",r.id),(r.conditionType===u.constants.CONDITION_TYPE.RELATION||r.conditionType===u.constants.CONDITION_TYPE.COMPENSATION)&&f.attr({"stroke-dasharray":".","stroke-width":"2"}),u._asignLabelFormat(f[0],r))},_createHTMLHotSpots:function(){for(var r,f,t=this,o=[],e=t.options.hotspots,i=t.options.configuration.processviewerHotSpotsContainer=n('<div class="processviewer-hotspots-container" data-processviewerhotspots style="position:absolute;"><\/div>'),u=0;u<e.length;u++)r=e[u],(r.bounds||r.x)&&(r.number=u,f=t._createHotSpotDiv(r),o.push(f),i.append(f));n("[data-processviewer-wrapper-container]",t.element).prepend(i);i.on("click",".processviewer-hotspot",function(i){var r=n(this).data("number"),u=n(this);if(t.options.hotspots[r].onClick)t.options.hotspots[r].onClick(i,u);t._triggers.click.apply(u,[t.element])});i.on("mouseenter",".processviewer-hotspot",function(i){var r=n(this).data("number"),u=n(this);if(t.options.hotspots[r].onMouseOver)t.options.hotspots[r].onMouseOver(i,u);t._triggers.onMouseOver.apply(u,[t.element])});i.on("mouseout",".processviewer-hotspot",function(i){var r=n(this).data("number"),u=n(this);if(t.options.hotspots[r].onMouseOut)t.options.hotspots[r].onMouseOut(i,u);t._triggers.onMouseOut.apply(u,[t.element])});t.options.configuration.hotspotsList=n(".processviewer-hotspot")},_createHotSpotDiv:function(t){var u=this,i=n('<div class="processviewer-hotspot processviewer-hotspot-div" data-processviewerhotspot><\/div>'),r=n('<div class="processviewer-hotspot-label" data-processviewerlabel><\/div>'),f=u._getHotSpotData(t);return i.outerWidth(f.w),i.outerHeight(f.h),i.css("left",f.x+"px"),i.css("top",f.y+"px"),i.data("number",t.number),i.attr("number",t.number),t.bounds&&(i.data("real-width",t.bounds.width),i.data("real-height",t.bounds.height),i.data("real-left",t.bounds.x),i.data("real-top",t.bounds.y)),t.displayName&&t.elementType!==u.constants.ELEMENT_TYPE.SEQUENCEFLOW&&(r.text(t.displayName),i.append(r)),t.elementType&&u._createIconsForHotSpots(i,t),t.text&&t.text.content&&(r.text(t.text.content),i.append(r)),t.dataState&&t.dataState.displayName&&(r.text(t.dataState.displayName),i.append(r)),t.radius&&i.css("border-radius",t.radius),t.css&&i.addClass(t.css),t.loopCharacteristics&&(t.loopCharacteristics.isSequential?i.addClass("issequential"):t.loopCharacteristics.isSequential||i.addClass("isparallel")),u._asignLabelFormat(r[0],t),t.elementType&&i.addClass(t.elementType.toLowerCase()),t.conditionType&&i.addClass(t.conditionType.toLowerCase()),t.eventType&&i.addClass(t.eventType.toLowerCase()),t.subProcessType&&i.addClass(t.subProcessType.toLowerCase()),t.isForCompensation&&i.addClass("isforcompensation"),t.bpmnElementRef?i.attr("id",t.bpmnElementRef):t.bpmnElement&&t.bpmnElement.baref&&t.bpmnElement.baref.ref&&i.attr("id",t.bpmnElement.baref.ref),t.content&&i.append(t.content),i},_createIconsForHotSpots:function(t,i){var w=this,s=i.elementType.toLowerCase(),h=n('<div class="processviewer-hotspot-icon" data-processviewericon><\/div>'),f,u,o;if(t.append(h),n.bizagi.processviewer.design.icons){var r=n.bizagi.processviewer.design.icons.scale,l=n.bizagi.processviewer.design.icons.bounds.width*r,a=n.bizagi.processviewer.design.icons.bounds.height*r,v=new Raphael(h[0],l,a),c=v.group();if(i.isForCompensation&&(s="isforcompensation"),f=n.bizagi.processviewer.design.icons.iconset[s],f)for(svgTmp=f.svg,u=0;u<svgTmp.length;u++){var e=svgTmp[u],y=e.type,p=c[y]();r<1&&c.node.setAttribute("transform","scale("+r+")");for(o in e.properties)p[0].setAttribute(o,e.properties[o])}}},_getPathString:function(n){for(var r=this,i="",t=0;t<n.length;t++)t===0&&(i+="M"),t>0&&(i+="L"),i+=n[t].x+",",i+=n[t].y+",";return i},_getArrowPathString:function(n){var r=n[n.length-1],u=n[n.length-2],s=u.x,t=r.x,h=u.y,i=r.y,f=Raphael.angle(t,i,s,h),e=Raphael.rad(f-135),o=Raphael.rad(f+135),c=t+Math.cos(e)*10,l=i+Math.sin(e)*10,a=t+Math.cos(o)*10,v=i+Math.sin(o)*10;return"M"+t+","+i+",L"+c+","+l+",M"+t+","+i+",L"+a+","+v},_getHotSpotData:function(n){var t={x:0,y:0,w:0,h:0};return n.x?t.x=n.x:n.bounds.x&&(t.x=n.bounds.x),n.y?t.y=n.y:n.bounds.y&&(t.y=n.bounds.y),n.w?t.w=n.w:n.bounds.width&&(t.w=n.bounds.width),n.h?t.h=n.h:n.bounds.height&&(t.h=n.bounds.height),t},_createSVGHotSpots:function(){for(var n,i,u,f,t=this,e=t.options.hotspots,r=0;r<e.length;r++)n=e[r],i=t.options.configuration.processviewerStage.rect(n.x,n.y,50,50),i.id=n.id,typeof n.onClick=="function"?i.click(n.onClick):i.click(t._triggers.click),u=t._triggers.onMouseOver,f=t._triggers.onMouseOut,typeof n.onMouseOver=="function"&&(u=n.onMouseOver),typeof n.onMouseOut=="function"&&(f=n.onMouseOut),i.hover(u,f),i.node.id=n.id,i.node["class"]=n.css,t.options.configuration.processviewerstageHotSpotSet.push(i);t.options.configuration.processviewerStageSet.push(t.options.configuration.processviewerstageHotSpotSet)},_triggers:{click:function(t){var i={type:"pvClick",message:"hotspot clicked",time:new Date,ui:{control:this,id:n(this).attr("id")}};t.trigger(i)},onMouseOver:function(t){var i={type:"pvMouseIn",message:"hotspot mouse in",time:new Date,ui:{control:this,id:n(this).attr("id")}};t.trigger(i)},onMouseOut:function(t){var i={type:"pvMouseOut",message:"hotspot mouse out",time:new Date,ui:{control:this,id:n(this).attr("id")}};t.trigger(i)},error:function(t){var r=this,i={type:"pvError",time:new Date};n.extend(t,i);n.event.trigger(t)}},_createUIFailView:function(t){var i=this,r=n('<div class="'+i.options.configuration.errorImageCSS+' svg-error-content"><div class="processviewer-absolute-center"><img src="'+i.options.unavailableImage+'" class="processviewer-absolute-center"/><\/div><span class="processviewer-message">'+t+"<\/span><\/div>");n("[data-processviewercontainer]",i.element).append(r)},_verifyingImage:function(t){var u=this,r=n.Deferred(),i=document.createElement("img");return i.onload=function(){r.resolve(i)},i.onerror=function(){r.reject(t)},i.src=t,r.promise()},_getStageContainer:function(){var t=this;return n("[data-processviewer-wrapper-container]",t.element)[0]},_generateID:function(){var r=this,t=(new Date).getTime(),i="processviewer-xxxxxxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?i:i&7|8).toString(16)});return n("#"+i).length>0?r._generateID():i},_adjustLabelsPosition:function(){for(var e,f=this,i=n(".processviewer-hotspot-label",f.element),s=i.closest(".processviewer-hotspot"),r=0;r<i.length;r++){var u=n(i[r]),t=u.closest(".processviewer-hotspot"),o=t.outerHeight();t.hasClass("subprocess")||t.hasClass("callactivity")||t.hasClass("dataobject")?(e=n._ptToem(o+10),u.css({paddingTop:e})):f.options.isIE8&&u.css({paddingTop:"1.8em"})}},_setOption:function(n,t){this.options[n]=t;this._update()},_update:function(){var n=this.options.value+"%";this.element.text(n);this.options.value===100&&this._trigger("complete",null,{value:100})},_destroy:function(){this.element.empty().removeAttr("style","").removeAttr("role","");clearInterval(this.options.animation.interval)},_getSelectedClassCSSByWorkitemState:function(n,t){var f=this,i,u,r;return t&&t.filter&&(i=t.filter(function(t){return t.guidTask===n})),u=i&&i.length>0&&i[0].wiState==14,r="processviewer-shape-selected",u&&(r="processviewer-shape-selected-standby"),r},selectShape:function(t,i){for(var r,e,s,o=this,f=n.isArray(t)?t:[t],u=0,h=f.length;u<h;u++)r=n("#"+f[u],o.$el),r.length&&(e=o._getSelectedClassCSSByWorkitemState(f[u],i),s=r.prop("tagName").toLowerCase(),s!=="div"?(r.addClassSVG(e),r.setMarkerSVG("selected")):r.addClass(e))},unSelectShape:function(t,i){for(var e=this,f=n.isArray(t)?t:[t],r=0,s=f.length;r<s;r++){var u=n("#"+f[r],e.$el),h=u.prop("tagName").toLowerCase(),o=e._getSelectedClassCSSByWorkitemState(f[r],i);h!=="div"?(u.removeClassSVG(o),u.reverseMarkerSVG()):u.removeClass(o)}},unSelectAllShapes:function(){for(var t,u,f=this,r=n(".processviewer-shape-selected",f.$el),i=0;i<r.length;i++)t=n(r[i]),u=t.prop("tagName").toLowerCase(),u!=="div"?(t.removeClassSVG("processviewer-shape-selected"),t.reverseMarkerSVG()):t.removeClass("processviewer-shape-selected")},drawRoute:function(t){for(var i,e,u=this,f=[],r=0;r<t.length;r++)i=n("#"+t[r],u.$el),i.length>0?(e=i.prop("tagName").toLowerCase(),e!=="div"?(i.addClassSVG("processviewer-highlighted"),i.setMarkerSVG("highlighted")):i.addClass("processviewer-highlighted")):f.push(t[r]);u._triggers.error({message:"Doesn't find element",ui:f})},animateRoute:function(t){var i=this,r=i.option.counter;n.isArray(t)&&(i.options.animation.counter=0,i.options.animation.path=t,i.options.animation.status=0);i.options.animation.status===0?i._startRouteAnimation():i._stopRouteAnimation()},_startRouteAnimation:function(){var t=this,i=t.options.animation.path;t.options.animation.status=1;t.options.animation.counter===0&&t.clearRoute();t.options.animation.interval=setInterval(function(){var r,u;t.options.animation.counter<i.length?(r=n("[id="+i[t.options.animation.counter]+"]",t.$el).last(),r.length>0&&(u=r.prop("tagName").toLowerCase(),u!=="div"?(r.addClassSVG("processviewer-highlighted"),r.setMarkerSVG("highlighted"),r[0].strokecolor="#FF7F00"):r.addClass("processviewer-highlighted")),t.options.animation.counter++):(t.element.trigger({type:"animationComplete",message:"animation end!",time:new Date,ui:t.$el}),t.options.animation.counter=0,t._stopRouteAnimation())},t.options.animation.time)},_stopRouteAnimation:function(){var n=this;n.options.animation.status=0;clearInterval(n.options.animation.interval)},_isInWorkportal:function(){var n=!1;return typeof bizagi!="undefined"&&typeof bizagi.workportal!="undefined"&&(n=!0),n},clearRoute:function(){for(var t,u,f=this,r=n(".processviewer-highlighted",f.$el),i=0;i<r.length;i++)t=n(r[i]),u=t.prop("tagName").toLowerCase(),u!=="div"?(t.removeClassSVG("processviewer-highlighted"),t[0].strokecolor="#000",t.reverseMarkerSVG()):t.removeClass("processviewer-highlighted")},validateHTML5Features:{checkInput:function(n){var t=document.createElement("input");return t.setAttribute("type",n),t.type==n}}});n.fn.addClassSVG=function(t){var i=arguments[0];return t=n.extend({},n.fn.addClassSVG.config,t),this.each(function(){var t=this,n=t.getAttribute("class"),r="";n===null&&(n="");typeof i=="string"&&n.indexOf(i)===-1&&(r=n+" "+i,t.setAttribute("class",r))})};n.fn.addClassSVG.config={};n.fn.setMarkerSVG=function(t){var i="url(#"+arguments[0]+")";return t=n.extend({},n.fn.addClassSVG.config,t),this.each(function(){var n=this,t=n.getAttribute("marker-end");t!=i&&(n.setAttribute("marker-end",i),n.setAttribute("toggle-marker-end",t))})};n.fn.reverseMarkerSVG=function(){return this.each(function(){var n=this,i=n.getAttribute("marker-end"),t=n.getAttribute("toggle-marker-end");t!==null&&i!==null&&(n.setAttribute("marker-end",t),n.removeAttribute("toggle-marker-end"))})};n.fn.removeClassSVG=function(t){var i=arguments[0];return t=n.extend({},n.fn.addClassSVG.config,t),this.each(function(){var t=this,n=t.getAttribute("class"),r="";n!==null&&typeof i=="string"&&n.indexOf(i)!==-1&&(r=n.replace(i,"").replace("  "," "),t.setAttribute("class",r))})};n.fn.removeClassSVG.config={};n.fn.hasClassSVG=function(){var n=arguments[0],r=this[0],t=r.getAttribute("class"),i=!1;return t!==null&&typeof n=="string"&&t.indexOf(n)!==-1&&(i=!0),i};n.fn.attrSVG=function(n){var t=this[0];for(var i in n)t.setAttribute(i,n[i]);return t};n._ptToem=function(n,t){return t||(t=12),n/t+"em"}})(jQuery);
(function(n){n.fn.processviewerQueries=function(){this.css("color","green");var t=this;return t.data=this[0],t.internalDataSource={elements:[]},t.datasource={hotspots:[],formatStyles:[]},t.deferred=n.Deferred(),t.padding=80,t.typeDefinitions=n.bizagi.processviewer.configuration.validTypeDefinitions,t.constants=n.bizagi.processviewer.configuration.constants,this.methods={init:function(){var t=this,i=n.Deferred();return t.typeDefinitions.unshift("owner"),t.data.definition.owner={processType:t.data.definition.processType,elementType:t.data.definition.elementType,displayName:t.data.definition.displayName,id:t.data.definition.id},n.when(t.methods.processElements.apply(t,[])).done(function(){i.resolve(t.datasource)}),i.promise()},processElements:function(){var t=this,i=[],u,f,o,r,s,e,h;for(u in t.data.definition)f=t.data.definition[u],t.methods.validateKindObject.apply(t,[u])&&(u===t.constants.LANESETS?f&&(o=t.methods.getLanesFromLaneSet.apply(t,[f]),i=i.concat(o)):i=i.concat(f));for(t.internalDataSource.elements=t.internalDataSource.elements.concat(i),r=0;r<t.internalDataSource.elements.length;r++)s=t.internalDataSource.elements[r].id,e=t.methods.getElementGraphicDataById.apply(t,[s]),e&&(h=n.extend({},e,t.internalDataSource.elements[r]),t.datasource.hotspots.push(h));t.datasource.dimentions=t.methods._getMaxDimentions.apply(t,[]);t.datasource.formatStyles=t.methods.getStylesFormat.apply(t,[])},getStylesFormat:function(){var i=this,u,f={},r,t,e;if(i.data.graphics[i.constants.BPMNLABELSTYLES])for(u=i.data.graphics[i.constants.BPMNLABELSTYLES],r=0;r<u.length;r++)t=u[r],e=t.font.size?n._ptToem(t.font.size):"1em",f[t.id]={css:{fontFamily:t.font.name||"Arial",fontSize:e,fontWeight:t.font.isBold?"bold":"normal",fontStyle:t.font.isItalic?"italic":"normal",color:t.font.color||"Black"},cssClass:["alignment-"+t.alignment]};return f},_getMaxDimentions:function(){var n=this,u=0,o=0,r=[],f,e,t,i;for(f in n.data.definition)e=n.data.definition[f],f===n.constants.LANESETS&&e&&(r=n.methods.getLanesFromLaneSet.apply(n,[e]));for(i=0;i<r.length;i++)r[i].id&&(t=n.methods.getElementGraphicDataById.apply(n,[r[i].id])),typeof t=="object"&&(u<t.bounds.width&&(u=t.bounds.width+n.padding),o+=t.bounds.height+n.padding);return{width:u,height:o}},_ptToEM:function(n){return n/t.pixelFontSize},getElementGraphicDataById:function(n){for(var r,u=this,i=u.data.graphics.bpmnPlane.diagramElements,f,t=0;t<i.length;t++)if(r=u.methods.hasReferenceId(i[t]),r&&(localID=r,localID===n)){f=i[t];break}return f},getLanesFromLaneSet:function(n){for(var r=this,t=[],i=0;i<n.length;i++)t=t.concat(n[i].lanes);return t},validateKindObject:function(n){for(var i=this,r=!1,t=0;t<i.typeDefinitions.length;t++)if(i.typeDefinitions[t]===n){r=!0;break}return r},hasReferenceId:function(n){var i=this,t=!1;return n.bpmnElement?n.bpmnElement.baref&&n.bpmnElement.baref.ref&&(t=n.bpmnElement.baref.ref):n.bpmnElementRef&&(t=n.bpmnElementRef),t}},this.methods.init.apply(this,[])}})(jQuery),function(n){function t(n,t){if(!(n.originalEvent.touches.length>1)){n.preventDefault();var i=n.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null);n.target.dispatchEvent(r)}}if(n.support.touch="ontouchend"in document,n.support.touch){var i=n.ui.mouse.prototype,u=i._mouseInit,r;i._touchStart=function(n){var i=this;!r&&i._mouseCapture(n.originalEvent.changedTouches[0])&&(r=!0,i._touchMoved=!1,t(n,"mouseover"),t(n,"mousemove"),t(n,"mousedown"))};i._touchMove=function(n){r&&(this._touchMoved=!0,t(n,"mousemove"))};i._touchEnd=function(n){r&&(t(n,"mouseup"),t(n,"mouseout"),this._touchMoved||t(n,"click"),r=!1)};i._mouseInit=function(){var t=this;t.element.bind("touchstart",n.proxy(t,"_touchStart")).bind("touchmove",n.proxy(t,"_touchMove")).bind("touchend",n.proxy(t,"_touchEnd"));u.call(t)}}}(jQuery);
(function(n){var o="0.4.2",e="hasOwnProperty",f=/[\.\/]/,s="*",h=function(){},c=function(n,t){return n-t},r,i,u={n:{}},t=function(n,f){var o,p;n=String(n);var k=u,w=i,v=Array.prototype.slice.call(arguments,2),s=t.listeners(n),a=0,e,l=[],y={},h=[],b=r;for(r=n,i=0,o=0,p=s.length;o<p;o++)"zIndex"in s[o]&&(l.push(s[o].zIndex),s[o].zIndex<0&&(y[s[o].zIndex]=s[o]));for(l.sort(c);l[a]<0;)if(e=y[l[a++]],h.push(e.apply(f,v)),i)return i=w,h;for(o=0;o<p;o++)if(e=s[o],"zIndex"in e)if(e.zIndex==l[a]){if(h.push(e.apply(f,v)),i)break;do if(a++,e=y[l[a]],e&&h.push(e.apply(f,v)),i)break;while(e)}else y[e.zIndex]=e;else if(h.push(e.apply(f,v)),i)break;return i=w,r=b,h.length?h:null};t._events=u;t.listeners=function(n){for(var a=n.split(f),t=u,i,v,o,e,p,h,c=[t],l=[],r=0,y=a.length;r<y;r++){for(h=[],e=0,p=c.length;e<p;e++)for(t=c[e].n,v=[t[a[r]],t[s]],o=2;o--;)i=v[o],i&&(h.push(i),l=l.concat(i.f||[]));c=h}return l};t.on=function(n,t){var e,i,r,o;if(n=String(n),typeof t!="function")return function(){};for(e=n.split(f),i=u,r=0,o=e.length;r<o;r++)i=i.n,i=i.hasOwnProperty(e[r])&&i[e[r]]||(i[e[r]]={n:{}});for(i.f=i.f||[],r=0,o=i.f.length;r<o;r++)if(i.f[r]==t)return h;return i.f.push(t),function(n){+n==+n&&(t.zIndex=+n)}};t.f=function(n){var i=[].slice.call(arguments,1);return function(){t.apply(null,[n,null].concat(i).concat([].slice.call(arguments,0)))}};t.stop=function(){i=1};t.nt=function(n){return n?new RegExp("(?:\\.|\\/|^)"+n+"(?:\\.|\\/|$)").test(r):r};t.nts=function(){return r.split(f)};t.off=t.unbind=function(n,i){var a,r,h,v,c,p,o,w,l,y;if(!n){t._events=u={n:{}};return}for(a=n.split(f),l=[u],c=0,p=a.length;c<p;c++)for(o=0;o<l.length;o+=v.length-2){if(v=[o,1],r=l[o].n,a[c]!=s)r[a[c]]&&v.push(r[a[c]]);else for(h in r)r[e](h)&&v.push(r[h]);l.splice.apply(l,v)}for(c=0,p=l.length;c<p;c++)for(r=l[c];r.n;){if(i){if(r.f){for(o=0,w=r.f.length;o<w;o++)if(r.f[o]==i){r.f.splice(o,1);break}r.f.length||delete r.f}for(h in r.n)if(r.n[e](h)&&r.n[h].f){for(y=r.n[h].f,o=0,w=y.length;o<w;o++)if(y[o]==i){y.splice(o,1);break}y.length||delete r.n[h].f}}else{delete r.f;for(h in r.n)r.n[e](h)&&r.n[h].f&&delete r.n[h].f}r=r.n}};t.once=function(n,i){var r=function(){return t.unbind(n,r),i.apply(this,arguments)};return t.on(n,r)};t.version=o;t.toString=function(){return"You are running Eve "+o};typeof module!="undefined"&&module.exports?module.exports=t:n.eve=t})(this),function(n,t){t(n,n.eve)}(this,function(n,t){function i(n){var r,u;return i.is(n,"function")?yi?n():t.on("raphael.DOMload",n):i.is(n,tt)?i._engine.create[v](i,n.splice(0,3+i.is(n[0],p))).add(n):(r=Array.prototype.slice.call(arguments,0),i.is(r[r.length-1],"function")?(u=r.pop(),yi?u.call(i._engine.create[v](i,r)):t.on("raphael.DOMload",function(){u.call(i._engine.create[v](i,r))})):i._engine.create[v](i,arguments))}function pt(n){var i,t;if(typeof n=="function"||Object(n)!==n)return n;i=new n.constructor;for(t in n)n[a](t)&&(i[t]=pt(n[t]));return i}function lu(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return n.push(n.splice(i,1)[0])}function it(n,t,i){function r(){var o=Array.prototype.slice.call(arguments,0),u=o.join("␀"),f=r.cache=r.cache||{},e=r.count=r.count||[];return f[a](u)?(lu(e,u),i?i(f[u]):f[u]):(e.length>=1e3&&delete f[e.shift()],e.push(u),f[u]=n[v](t,o),i?i(f[u]):f[u])}return r}function dt(){return this.hex}function hr(n,t){for(var i,f=[],r=0,u=n.length;u-2*!t>r;r+=2)i=[{x:+n[r-2],y:+n[r-1]},{x:+n[r],y:+n[r+1]},{x:+n[r+2],y:+n[r+3]},{x:+n[r+4],y:+n[r+5]}],t?r?u-4==r?i[3]={x:+n[0],y:+n[1]}:u-2==r&&(i[2]={x:+n[0],y:+n[1]},i[3]={x:+n[2],y:+n[3]}):i[0]={x:+n[u-2],y:+n[u-1]}:u-4==r?i[3]=i[2]:r||(i[0]={x:+n[r],y:+n[r+1]}),f.push(["C",(-i[0].x+6*i[1].x+i[2].x)/6,(-i[0].y+6*i[1].y+i[2].y)/6,(i[1].x+6*i[2].x-i[3].x)/6,(i[1].y+6*i[2].y-i[3].y)/6,i[2].x,i[2].y]);return f}function cr(n,t,i,r,u){var f=-3*t+9*i-9*r+3*u,e=n*f+6*t-12*i+6*r;return n*e-3*t+3*i}function lt(n,t,i,r,f,e,o,s,h){var c;h==null&&(h=1);h=h>1?1:h<0?0:h;var l=h/2,w=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],b=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],a=0;for(c=0;c<12;c++){var v=l*w[c]+l,y=cr(v,n,i,f,o),p=cr(v,t,r,e,s),k=y*y+p*p;a+=b[c]*u.sqrt(k)}return l*a}function au(n,t,i,r,u,f,e,o,s){if(!(s<0)&&!(lt(n,t,i,r,u,f,e,o)<s)){for(var a=1,l=a/2,h=a-l,c=lt(n,t,i,r,u,f,e,o,h);y(c-s)>.01;)l/=2,h+=(c<s?1:-1)*l,c=lt(n,t,i,r,u,f,e,o,h);return h}}function vu(n,t,i,r,u,f,e,s){if(!(o(n,i)<l(u,e))&&!(l(n,i)>o(u,e))&&!(o(t,r)<l(f,s))&&!(l(t,r)>o(f,s))){var p=(n*r-t*i)*(u-e)-(n-i)*(u*s-f*e),w=(n*r-t*i)*(f-s)-(t-r)*(u*s-f*e),a=(n-i)*(f-s)-(t-r)*(u-e);if(a){var v=p/a,y=w/a,h=+v.toFixed(2),c=+y.toFixed(2);if(!(h<+l(n,i).toFixed(2))&&!(h>+o(n,i).toFixed(2))&&!(h<+l(u,e).toFixed(2))&&!(h>+o(u,e).toFixed(2))&&!(c<+l(t,r).toFixed(2))&&!(c>+o(t,r).toFixed(2))&&!(c<+l(f,s).toFixed(2))&&!(c>+o(f,s).toFixed(2)))return{x:v,y:y}}}}function ai(n,t,r){var ut=i.bezierBBox(n),ft=i.bezierBBox(t),u,h,c,d,g;if(!i.isBBoxIntersect(ut,ft))return r?0:[];var et=lt.apply(0,n),ot=lt.apply(0,t),p=o(~~(et/5),1),w=o(~~(ot/5),1),nt=[],tt=[],rt={},it=r?0:[];for(u=0;u<p+1;u++)h=i.findDotsAtSegment.apply(i,n.concat(u/p)),nt.push({x:h.x,y:h.y,t:u/p});for(u=0;u<w+1;u++)h=i.findDotsAtSegment.apply(i,t.concat(u/w)),tt.push({x:h.x,y:h.y,t:u/w});for(u=0;u<p;u++)for(c=0;c<w;c++){var e=nt[u],a=nt[u+1],s=tt[c],v=tt[c+1],b=y(a.x-e.x)<.001?"y":"x",k=y(v.x-s.x)<.001?"y":"x",f=vu(e.x,e.y,a.x,a.y,s.x,s.y,v.x,v.y);if(f){if(rt[f.x.toFixed(4)]==f.y.toFixed(4))continue;rt[f.x.toFixed(4)]=f.y.toFixed(4);d=e.t+y((f[b]-e[b])/(a[b]-e[b]))*(a.t-e.t);g=s.t+y((f[k]-s[k])/(v[k]-s[k]))*(v.t-s.t);d>=0&&d<=1.001&&g>=0&&g<=1.001&&(r?it++:it.push({x:f.x,y:f.y,t1:l(d,1),t2:l(g,1)}))}}return it}function vi(n,t,r){var e,o,s,h,b,k,d,g,c,l,y,p,nt,a,w,tt,v,u,f,it;for(n=i._path2curve(n),t=i._path2curve(t),y=r?0:[],p=0,nt=n.length;p<nt;p++)if(a=n[p],a[0]=="M")e=b=a[1],o=k=a[2];else for(a[0]=="C"?(c=[e,o].concat(a.slice(1)),e=c[6],o=c[7]):(c=[e,o,e,o,b,k,b,k],e=b,o=k),w=0,tt=t.length;w<tt;w++)if(v=t[w],v[0]=="M")s=d=v[1],h=g=v[2];else if(v[0]=="C"?(l=[s,h].concat(v.slice(1)),s=l[6],h=l[7]):(l=[s,h,s,h,d,g,d,g],s=d,h=g),u=ai(c,l,r),r)y+=u;else{for(f=0,it=u.length;f<it;f++)u[f].segment1=p,u[f].segment2=w,u[f].bez1=c,u[f].bez2=l;y=y.concat(u)}return y}function st(n,t,i,r,u,f){n!=null?(this.a=+n,this.b=+t,this.c=+i,this.d=+r,this.e=+u,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function lr(){return this.x+at+this.y+at+this.width+" × "+this.height}function yu(n,t,i,r,u,f){function h(n){return((c*n+o)*n+e)*n}function a(n,t){var i=v(n,t);return((p*i+l)*i+s)*i}function v(n,t){for(var r,u,f,s,i=n,l=0;l<8;l++){if(f=h(i)-n,y(f)<t)return i;if(s=(3*c*i+2*o)*i+e,y(s)<1e-6)break;i=i-f/s}if(r=0,u=1,i=n,i<r)return r;if(i>u)return u;while(r<u){if(f=h(i),y(f-n)<t)return i;n>f?r=i:u=i;i=(u-r)/2+r}return i}var e=3*t,o=3*(r-t)-e,c=1-e-o,s=3*i,l=3*(u-i)-s,p=1-s-l;return a(n,1/(200*f))}function ft(n,t){var i=[],u={},r;if(this.ms=t,this.times=1,n){for(r in n)n[a](r)&&(u[h(r)]=n[r],i.push(h(r)));i.sort(ef)}this.anim=u;this.top=i[i.length-1];this.percents=i}function wt(n,r,u,e,o,c){var nt,v,et,l,at,dt,ii,tt,vt,gt,yt,d,rt,ht,ct,ni,ft,lt;u=h(u);var it,ot,pt,ti,wt,kt,w=n.ms,y={},g={},k={};if(e){for(v=0,et=f.length;v<et;v++)if(nt=f[v],nt.el.id==r.id&&nt.anim==n){nt.percent!=u?(f.splice(v,1),pt=1):ot=nt;r.attr(nt.totalOrigin);break}}else e=+g;for(v=0,et=n.percents.length;v<et;v++)if(n.percents[v]==u||n.percents[v]>e*n.top){u=n.percents[v];wt=n.percents[v-1]||0;w=w/n.top*(u-wt);ti=n.percents[v+1];it=n.anim[u];break}else e&&r.attr(n.anim[n.percents[v]]);if(it){if(ot)ot.initstatus=e,ot.start=new Date-ot.ms*e;else{for(l in it)if(it[a](l)&&(ki[a](l)||r.paper.customAttributes[a](l))){y[l]=r.attr(l);y[l]==null&&(y[l]=nf[l]);g[l]=it[l];switch(ki[l]){case p:k[l]=(g[l]-y[l])/w;break;case"colour":y[l]=i.getRGB(y[l]);at=i.getRGB(g[l]);k[l]={r:(at.r-y[l].r)/w,g:(at.g-y[l].g)/w,b:(at.b-y[l].b)/w};break;case"path":for(dt=bt(y[l],g[l]),ii=dt[1],y[l]=dt[0],k[l]=[],v=0,et=y[l].length;v<et;v++)for(k[l][v]=[0],tt=1,vt=y[l][v].length;tt<vt;tt++)k[l][v][tt]=(ii[v][tt]-y[l][v][tt])/w;break;case"transform":if(gt=r._,yt=pf(gt[l],g[l]),yt)for(y[l]=yt.from,g[l]=yt.to,k[l]=[],k[l].real=!0,v=0,et=y[l].length;v<et;v++)for(k[l][v]=[y[l][v][0]],tt=1,vt=y[l][v].length;tt<vt;tt++)k[l][v][tt]=(g[l][v][tt]-y[l][v][tt])/w;else d=r.matrix||new st,rt={_:{transform:gt.transform},getBBox:function(){return r.getBBox(1)}},y[l]=[d.a,d.b,d.c,d.d,d.e,d.f],uu(rt,g[l]),g[l]=rt._.transform,k[l]=[(rt.matrix.a-d.a)/w,(rt.matrix.b-d.b)/w,(rt.matrix.c-d.c)/w,(rt.matrix.d-d.d)/w,(rt.matrix.e-d.e)/w,(rt.matrix.f-d.f)/w];break;case"csv":if(ht=b(it[l])[ut](pi),ct=b(y[l])[ut](pi),l=="clip-rect")for(y[l]=ct,k[l]=[],v=ct.length;v--;)k[l][v]=(ht[v]-y[l][v])/w;g[l]=ht;break;default:for(ht=[][s](it[l]),ct=[][s](y[l]),k[l]=[],v=r.paper.customAttributes[l].length;v--;)k[l][v]=((ht[v]||0)-(ct[v]||0))/w}}if(ni=it.easing,ft=i.easing_formulas[ni],ft||(ft=b(ni).match(gu),ft&&ft.length==5?(lt=ft,ft=function(n){return yu(n,+lt[1],+lt[2],+lt[3],+lt[4],w)}):ft=sf),kt=it.start||n.start||+new Date,nt={anim:n,percent:u,timestamp:kt,start:kt+(n.del||0),status:0,initstatus:e||0,stop:!1,ms:w,easing:ft,from:y,diff:k,to:g,el:r,callback:it.callback,prev:wt,next:ti,repeat:c||n.times,origin:r.attr(),totalOrigin:o},f.push(nt),e&&!ot&&!pt&&(nt.stop=!0,nt.start=new Date-w*e,f.length==1))return or();pt&&(nt.start=new Date-nt.ms*e);f.length==1&&cu(or)}t("raphael.anim.start."+r.id,r,n)}}function ar(n){for(var t=0;t<f.length;t++)f[t].el.paper==n&&f.splice(t--,1)}var fi,ei,hf,af,et,kt,rr,ct,ou,g,yt,w,li;i.version="2.1.2";i.eve=t;var yi,pi=/[, ]+/,pu={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},wu=/\{(\d+)\}/g,a="hasOwnProperty",r={doc:document,win:n},wi={was:Object.prototype[a].call(r.win,"Raphael"),is:r.win.Raphael},vr=function(){this.ca=this.customAttributes={}},c,v="apply",s="concat",gt="ontouchstart"in r.win||r.win.DocumentTouch&&r.doc instanceof DocumentTouch,d="",at=" ",b=String,ut="split",yr="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[ut](at),ni={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},ti=b.prototype.toLowerCase,u=Math,o=u.max,l=u.min,y=u.abs,nt=u.pow,k=u.PI,p="number",ii="string",tt="array",bu=Object.prototype.toString,re=i._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,ku=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,du={NaN:1,Infinity:1,"-Infinity":1},gu=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,bi=u.round,h=parseFloat,ht=parseInt,pr=b.prototype.toUpperCase,nf=i._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ki=i._availableAnimAttrs={blur:p,"clip-rect":"csv",cx:p,cy:p,fill:"colour","fill-opacity":p,"font-size":p,height:p,opacity:p,path:"path",r:p,rx:p,ry:p,stroke:"colour","stroke-opacity":p,"stroke-width":p,transform:"transform",width:p,x:p,y:p},di=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,tf={hs:1,rg:1},rf=/,?([achlmqrstvxz]),?/gi,uf=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,ff=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,wr=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,ue=i._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,vt={},fe=function(n,t){return n.key-t.key},ef=function(n,t){return h(n)-h(t)},of=function(){},sf=function(n){return n},ri=i._rectPath=function(n,t,i,r,u){return u?[["M",n+u,t],["l",i-u*2,0],["a",u,u,0,0,1,u,u],["l",0,r-u*2],["a",u,u,0,0,1,-u,u],["l",u*2-i,0],["a",u,u,0,0,1,-u,-u],["l",0,u*2-r],["a",u,u,0,0,1,u,-u],["z"]]:[["M",n,t],["l",i,0],["l",0,r],["l",-i,0],["z"]]},br=function(n,t,i,r){return r==null&&(r=i),[["M",n,t],["m",0,-r],["a",i,r,0,1,1,0,2*r],["a",i,r,0,1,1,0,-2*r],["z"]]},ui=i._getPath={path:function(n){return n.attr("path")},circle:function(n){var t=n.attrs;return br(t.cx,t.cy,t.r)},ellipse:function(n){var t=n.attrs;return br(t.cx,t.cy,t.rx,t.ry)},rect:function(n){var t=n.attrs;return ri(t.x,t.y,t.width,t.height,t.r)},image:function(n){var t=n.attrs;return ri(t.x,t.y,t.width,t.height)},text:function(n){var t=n._getBBox();return ri(t.x,t.y,t.width,t.height)},set:function(n){var t=n._getBBox();return ri(t.x,t.y,t.width,t.height)}},gi=i.mapPath=function(n,t){if(!t)return n;var f,e,u,i,o,s,r;for(n=bt(n),u=0,o=n.length;u<o;u++)for(r=n[u],i=1,s=r.length;i<s;i+=2)f=t.x(r[i],r[i+1]),e=t.y(r[i],r[i+1]),r[i]=f,r[i+1]=e;return n};if(i._g=r,i.type=r.win.SVGAngle||r.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",i.type=="VML"){if(fi=r.doc.createElement("div"),fi.innerHTML='<v:shape adj="1"/>',ei=fi.firstChild,ei.style.behavior="url(#default#VML)",!(ei&&typeof ei.adj=="object"))return i.type=d;fi=null}i.svg=!(i.vml=i.type=="VML");i._Paper=vr;i.fn=c=vr.prototype=i.prototype;i._id=0;i._oid=0;i.is=function(n,t){return(t=ti.call(t),t=="finite")?!du[a](+n):t=="array"?n instanceof Array:t=="null"&&n===null||t==typeof n&&n!==null||t=="object"&&n===Object(n)||t=="array"&&Array.isArray&&Array.isArray(n)||bu.call(n).slice(8,-1).toLowerCase()==t};i.angle=function(n,t,r,f,e,o){if(e==null){var s=n-r,h=t-f;return!s&&!h?0:(180+u.atan2(-h,-s)*180/k+360)%360}return i.angle(n,t,e,o)-i.angle(r,f,e,o)};i.rad=function(n){return n%360*k/180};i.deg=function(n){return n*180/k%360};i.snapTo=function(n,t,r){var f,u;if(r=i.is(r,"finite")?r:10,i.is(n,tt)){for(f=n.length;f--;)if(y(n[f]-t)<=r)return n[f]}else{if(n=+n,u=t%n,u<r)return t-u;if(u>n-r)return t-u+n}return t};hf=i.createUUID=function(n,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(n,t).toUpperCase()}}(/[xy]/g,function(n){var t=u.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)});i.setWindow=function(n){t("raphael.setWindow",i,r.win,n);r.win=n;r.doc=r.win.document;i._engine.initWin&&i._engine.initWin(r.win)};var oi=function(n){var e,u,f,o,t;if(i.vml){e=/^\s+|\s+$/g;try{f=new ActiveXObject("htmlfile");f.write("<body>");f.close();u=f.body}catch(s){u=createPopup().document.body}o=u.createTextRange();oi=it(function(n){try{u.style.color=b(n).replace(e,d);var t=o.queryCommandValue("ForeColor");return t=(t&255)<<16|t&65280|(t&16711680)>>>16,"#"+("000000"+t.toString(16)).slice(-6)}catch(i){return"none"}})}else t=r.doc.createElement("i"),t.title="Raphaël Colour Picker",t.style.display="none",r.doc.body.appendChild(t),oi=it(function(n){return t.style.color=n,r.doc.defaultView.getComputedStyle(t,d).getPropertyValue("color")});return oi(n)},cf=function(){return"hsb("+[this.h,this.s,this.b]+")"},lf=function(){return"hsl("+[this.h,this.s,this.l]+")"},kr=function(){return this.hex},dr=function(n,t,r){if(t==null&&i.is(n,"object")&&"r"in n&&"g"in n&&"b"in n&&(r=n.b,t=n.g,n=n.r),t==null&&i.is(n,ii)){var u=i.getRGB(n);n=u.r;t=u.g;r=u.b}return(n>1||t>1||r>1)&&(n/=255,t/=255,r/=255),[n,t,r]},gr=function(n,t,r,u){n*=255;t*=255;r*=255;var f={r:n,g:t,b:r,hex:i.rgb(n,t,r),toString:kr};return i.is(u,"finite")&&(f.opacity=u),f};i.color=function(n){var t;return i.is(n,"object")&&"h"in n&&"s"in n&&"b"in n?(t=i.hsb2rgb(n),n.r=t.r,n.g=t.g,n.b=t.b,n.hex=t.hex):i.is(n,"object")&&"h"in n&&"s"in n&&"l"in n?(t=i.hsl2rgb(n),n.r=t.r,n.g=t.g,n.b=t.b,n.hex=t.hex):(i.is(n,"string")&&(n=i.getRGB(n)),i.is(n,"object")&&"r"in n&&"g"in n&&"b"in n?(t=i.rgb2hsl(n),n.h=t.h,n.s=t.s,n.l=t.l,t=i.rgb2hsb(n),n.v=t.b):(n={hex:"none"},n.r=n.g=n.b=n.h=n.s=n.v=n.l=-1)),n.toString=kr,n};i.hsb2rgb=function(n,t,i,r){this.is(n,"object")&&"h"in n&&"s"in n&&"b"in n&&(i=n.b,t=n.s,n=n.h,r=n.o);n*=360;var e,o,s,f,u;return n=n%360/60,u=i*t,f=u*(1-y(n%2-1)),e=o=s=i-u,n=~~n,e+=[u,f,0,0,f,u][n],o+=[f,u,u,f,0,0][n],s+=[0,0,f,u,u,f][n],gr(e,o,s,r)};i.hsl2rgb=function(n,t,i,r){this.is(n,"object")&&"h"in n&&"s"in n&&"l"in n&&(i=n.l,t=n.s,n=n.h);(n>1||t>1||i>1)&&(n/=360,t/=100,i/=100);n*=360;var e,o,s,f,u;return n=n%360/60,u=2*t*(i<.5?i:1-i),f=u*(1-y(n%2-1)),e=o=s=i-u/2,n=~~n,e+=[u,f,0,0,f,u][n],o+=[f,u,u,f,0,0][n],s+=[0,0,f,u,u,f][n],gr(e,o,s,r)};i.rgb2hsb=function(n,t,i){i=dr(n,t,i);n=i[0];t=i[1];i=i[2];var f,e,u,r;return u=o(n,t,i),r=u-l(n,t,i),f=r==0?null:u==n?(t-i)/r:u==t?(i-n)/r+2:(n-t)/r+4,f=(f+360)%6/6,e=r==0?0:r/u,{h:f,s:e,b:u,toString:cf}};i.rgb2hsl=function(n,t,i){i=dr(n,t,i);n=i[0];t=i[1];i=i[2];var e,h,u,f,s,r;return f=o(n,t,i),s=l(n,t,i),r=f-s,e=r==0?null:f==n?(t-i)/r:f==t?(i-n)/r+2:(n-t)/r+4,e=(e+360)%6/6,u=(f+s)/2,h=r==0?0:u<.5?r/(2*u):r/(2-2*u),{h:e,s:h,l:u,toString:lf}};i._path2string=function(){return this.join(",").replace(rf,"$1")};af=i._preload=function(n,t){var i=r.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em";i.onload=function(){t.call(this);this.onload=null;r.doc.body.removeChild(this)};i.onerror=function(){r.doc.body.removeChild(this)};r.doc.body.appendChild(i);i.src=n};i.getRGB=it(function(n){if(!n||!!((n=b(n)).indexOf("-")+1))return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:dt};if(n=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:dt};tf[a](n.toLowerCase().substring(0,2))||n.charAt()=="#"||(n=oi(n));var u,f,e,o,s,t,r=n.match(ku);return r?(r[2]&&(e=ht(r[2].substring(5),16),f=ht(r[2].substring(3,5),16),u=ht(r[2].substring(1,3),16)),r[3]&&(e=ht((s=r[3].charAt(3))+s,16),f=ht((s=r[3].charAt(2))+s,16),u=ht((s=r[3].charAt(1))+s,16)),r[4]&&(t=r[4][ut](di),u=h(t[0]),t[0].slice(-1)=="%"&&(u*=2.55),f=h(t[1]),t[1].slice(-1)=="%"&&(f*=2.55),e=h(t[2]),t[2].slice(-1)=="%"&&(e*=2.55),r[1].toLowerCase().slice(0,4)=="rgba"&&(o=h(t[3])),t[3]&&t[3].slice(-1)=="%"&&(o/=100)),r[5])?(t=r[5][ut](di),u=h(t[0]),t[0].slice(-1)=="%"&&(u*=2.55),f=h(t[1]),t[1].slice(-1)=="%"&&(f*=2.55),e=h(t[2]),t[2].slice(-1)=="%"&&(e*=2.55),(t[0].slice(-3)=="deg"||t[0].slice(-1)=="°")&&(u/=360),r[1].toLowerCase().slice(0,4)=="hsba"&&(o=h(t[3])),t[3]&&t[3].slice(-1)=="%"&&(o/=100),i.hsb2rgb(u,f,e,o)):r[6]?(t=r[6][ut](di),u=h(t[0]),t[0].slice(-1)=="%"&&(u*=2.55),f=h(t[1]),t[1].slice(-1)=="%"&&(f*=2.55),e=h(t[2]),t[2].slice(-1)=="%"&&(e*=2.55),(t[0].slice(-3)=="deg"||t[0].slice(-1)=="°")&&(u/=360),r[1].toLowerCase().slice(0,4)=="hsla"&&(o=h(t[3])),t[3]&&t[3].slice(-1)=="%"&&(o/=100),i.hsl2rgb(u,f,e,o)):(r={r:u,g:f,b:e,toString:dt},r.hex="#"+(16777216|e|f<<8|u<<16).toString(16).slice(1),i.is(o,"finite")&&(r.opacity=o),r):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:dt}},i);i.hsb=it(function(n,t,r){return i.hsb2rgb(n,t,r).hex});i.hsl=it(function(n,t,r){return i.hsl2rgb(n,t,r).hex});i.rgb=it(function(n,t,i){return"#"+(16777216|i|t<<8|n<<16).toString(16).slice(1)});i.getColor=function(n){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:n||.75},i=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),i.hex};i.getColor.reset=function(){delete this.start};i.parsePathString=function(n){var r,u,t;return n?(r=et(n),r.arr)?rt(r.arr):(u={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},t=[],i.is(n,tt)&&i.is(n[0],tt)&&(t=rt(n)),t.length||b(n).replace(uf,function(n,i,r){var f=[],e=i.toLowerCase();if(r.replace(wr,function(n,t){t&&f.push(+t)}),e=="m"&&f.length>2&&(t.push([i][s](f.splice(0,2))),e="l",i=i=="m"?"l":"L"),e=="r")t.push([i][s](f));else while(f.length>=u[e])if(t.push([i][s](f.splice(0,u[e]))),!u[e])break}),t.toString=i._path2string,r.arr=rt(t),t):null};i.parseTransformString=it(function(n){if(!n)return null;var t=[];return i.is(n,tt)&&i.is(n[0],tt)&&(t=rt(n)),t.length||b(n).replace(ff,function(n,i,r){var u=[],f=ti.call(i);r.replace(wr,function(n,t){t&&u.push(+t)});t.push([i][s](u))}),t.toString=i._path2string,t});et=function(n){var t=et.ps=et.ps||{};return t[n]?t[n].sleep=100:t[n]={sleep:100},setTimeout(function(){for(var i in t)t[a](i)&&i!=n&&(t[i].sleep--,t[i].sleep||delete t[i])}),t[n]};i.findDotsAtSegment=function(n,t,i,r,f,e,o,s,h){var c=1-h,w=nt(c,3),b=nt(c,2),l=h*h,d=l*h,tt=w*n+b*3*h*i+c*3*h*h*f+d*o,it=w*t+b*3*h*r+c*3*h*h*e+d*s,a=n+2*h*(i-n)+l*(f-2*i+n),v=t+2*h*(r-t)+l*(e-2*r+t),y=i+2*h*(f-i)+l*(o-2*f+i),p=r+2*h*(e-r)+l*(s-2*e+r),rt=c*n+h*i,ut=c*t+h*r,ft=c*f+h*o,et=c*e+h*s,g=90-u.atan2(a-y,v-p)*180/k;return(a>y||v<p)&&(g+=180),{x:tt,y:it,m:{x:a,y:v},n:{x:y,y:p},start:{x:rt,y:ut},end:{x:ft,y:et},alpha:g}};i.bezierBBox=function(n,t,r,u,f,e,o,s){i.is(n,"array")||(n=[n,t,r,u,f,e,o,s]);var h=ru.apply(null,n);return{x:h.min.x,y:h.min.y,x2:h.max.x,y2:h.max.y,width:h.max.x-h.min.x,height:h.max.y-h.min.y}};i.isPointInsideBBox=function(n,t,i){return t>=n.x&&t<=n.x2&&i>=n.y&&i<=n.y2};i.isBBoxIntersect=function(n,t){var r=i.isPointInsideBBox;return r(t,n.x,n.y)||r(t,n.x2,n.y)||r(t,n.x,n.y2)||r(t,n.x2,n.y2)||r(n,t.x,t.y)||r(n,t.x2,t.y)||r(n,t.x,t.y2)||r(n,t.x2,t.y2)||(n.x<t.x2&&n.x>t.x||t.x<n.x2&&t.x>n.x)&&(n.y<t.y2&&n.y>t.y||t.y<n.y2&&t.y>n.y)};i.pathIntersection=function(n,t){return vi(n,t)};i.pathIntersectionNumber=function(n,t){return vi(n,t,1)};i.isPointInsidePath=function(n,t,r){var u=i.pathBBox(n);return i.isPointInsideBBox(u,t,r)&&vi(n,[["M",t,r],["H",u.x2+10]],1)%2==1};i._removedFactory=function(n){return function(){t("raphael.log",null,"Raphaël: you are calling to method “"+n+"” of removed object",n)}};var nr=i.pathBBox=function(n){var c=et(n),h,p,u;if(c.bbox)return pt(c.bbox);if(!n)return{x:0,y:0,width:0,height:0,x2:0,y2:0};n=bt(n);var f=0,e=0,i=[],r=[],t;for(h=0,p=n.length;h<p;h++)t=n[h],t[0]=="M"?(f=t[1],e=t[2],i.push(f),r.push(e)):(u=ru(f,e,t[1],t[2],t[3],t[4],t[5],t[6]),i=i[s](u.min.x,u.max.x),r=r[s](u.min.y,u.max.y),f=t[5],e=t[6]);var a=l[v](0,i),y=l[v](0,r),w=o[v](0,i),b=o[v](0,r),k=w-a,d=b-y,g={x:a,y:y,x2:w,y2:b,width:k,height:d,cx:a+k/2,cy:y+d/2};return c.bbox=pt(g),g},rt=function(n){var t=pt(n);return t.toString=i._path2string,t},vf=i._pathToRelative=function(n){var v=et(n),u,p,f,t,s,w,h,b,c;if(v.rel)return rt(v.rel);i.is(n,tt)&&i.is(n&&n[0],tt)||(n=i.parsePathString(n));var r=[],o=0,e=0,l=0,a=0,y=0;for(n[0][0]=="M"&&(o=n[0][1],e=n[0][2],l=o,a=e,y++,r.push(["M",o,e])),u=y,p=n.length;u<p;u++){if(f=r[u]=[],t=n[u],t[0]!=ti.call(t[0])){f[0]=ti.call(t[0]);switch(f[0]){case"a":f[1]=t[1];f[2]=t[2];f[3]=t[3];f[4]=t[4];f[5]=t[5];f[6]=+(t[6]-o).toFixed(3);f[7]=+(t[7]-e).toFixed(3);break;case"v":f[1]=+(t[1]-e).toFixed(3);break;case"m":l=t[1];a=t[2];default:for(s=1,w=t.length;s<w;s++)f[s]=+(t[s]-(s%2?o:e)).toFixed(3)}}else for(f=r[u]=[],t[0]=="m"&&(l=t[1]+o,a=t[2]+e),h=0,b=t.length;h<b;h++)r[u][h]=t[h];c=r[u].length;switch(r[u][0]){case"z":o=l;e=a;break;case"h":o+=+r[u][c-1];break;case"v":e+=+r[u][c-1];break;default:o+=+r[u][c-2];e+=+r[u][c-1]}}return r.toString=i._path2string,v.rel=rt(r),r},nu=i._pathToAbsolute=function(n){var p=et(n),w,t,r,v,k,h,e,y,c,d;if(p.abs)return rt(p.abs);if(i.is(n,tt)&&i.is(n&&n[0],tt)||(n=i.parsePathString(n)),!n||!n.length)return[["M",0,0]];var o=[],u=0,f=0,l=0,a=0,b=0;for(n[0][0]=="M"&&(u=+n[0][1],f=+n[0][2],l=u,a=f,b++,o[0]=["M",u,f]),w=n.length==3&&n[0][0]=="M"&&n[1][0].toUpperCase()=="R"&&n[2][0].toUpperCase()=="Z",v=b,k=n.length;v<k;v++){if(o.push(t=[]),r=n[v],r[0]!=pr.call(r[0])){t[0]=pr.call(r[0]);switch(t[0]){case"A":t[1]=r[1];t[2]=r[2];t[3]=r[3];t[4]=r[4];t[5]=r[5];t[6]=+(r[6]+u);t[7]=+(r[7]+f);break;case"V":t[1]=+r[1]+f;break;case"H":t[1]=+r[1]+u;break;case"R":for(h=[u,f][s](r.slice(1)),e=2,y=h.length;e<y;e++)h[e]=+h[e]+u,h[++e]=+h[e]+f;o.pop();o=o[s](hr(h,w));break;case"M":l=+r[1]+u;a=+r[2]+f;default:for(e=1,y=r.length;e<y;e++)t[e]=+r[e]+(e%2?u:f)}}else if(r[0]=="R")h=[u,f][s](r.slice(1)),o.pop(),o=o[s](hr(h,w)),t=["R"][s](r.slice(-2));else for(c=0,d=r.length;c<d;c++)t[c]=r[c];switch(t[0]){case"Z":u=l;f=a;break;case"H":u=t[1];break;case"V":f=t[1];break;case"M":l=t[t.length-2];a=t[t.length-1];default:u=t[t.length-2];f=t[t.length-1]}}return o.toString=i._path2string,p.abs=rt(o),o},si=function(n,t,i,r){return[n,t,i,r,i,r]},tu=function(n,t,i,r,u,f){var e=1/3,o=2/3;return[e*n+o*i,e*t+o*r,e*u+o*i,e*f+o*r,u,f]},iu=function(n,t,i,r,f,e,o,h,c,l){var at=k*120/180,et=k/180*(+f||0),p=[],g,ot=it(function(n,t,i){var r=n*u.cos(i)-t*u.sin(i),f=n*u.sin(i)+t*u.cos(i);return{x:r,y:f}}),st,lt,w,gt;if(l)v=l[0],a=l[1],rt=l[2],ft=l[3];else{g=ot(n,t,-et);n=g.x;t=g.y;g=ot(h,c,-et);h=g.x;c=g.y;var oi=u.cos(k/180*f),si=u.sin(k/180*f),b=(n-h)/2,d=(t-c)/2,tt=b*b/(i*i)+d*d/(r*r);tt>1&&(tt=u.sqrt(tt),i=tt*i,r=tt*r);var ht=i*i,ct=r*r,vt=(e==o?-1:1)*u.sqrt(y((ht*ct-ht*d*d-ct*b*b)/(ht*d*d+ct*b*b))),rt=vt*i*d/r+(n+h)/2,ft=vt*-r*b/i+(t+c)/2,v=u.asin(((t-ft)/r).toFixed(9)),a=u.asin(((c-ft)/r).toFixed(9));v=n<rt?k-v:v;a=h<rt?k-a:a;v<0&&(v=k*2+v);a<0&&(a=k*2+a);o&&v>a&&(v=v-k*2);!o&&a>v&&(a=a-k*2)}if(st=a-v,y(st)>at){var ni=a,ti=h,ii=c;a=v+at*(o&&a>v?1:-1);h=rt+i*u.cos(a);c=ft+r*u.sin(a);p=iu(h,c,i,r,f,0,o,ti,ii,[a,ni,rt,ft])}st=a-v;var ri=u.cos(v),ui=u.sin(v),fi=u.cos(a),ei=u.sin(a),yt=u.tan(st/4),pt=4/3*i*yt,wt=4/3*r*yt,bt=[n,t],nt=[n+pt*ui,t-wt*ri],kt=[h+pt*ei,c-wt*fi],dt=[h,c];if(nt[0]=2*bt[0]-nt[0],nt[1]=2*bt[1]-nt[1],l)return[nt,kt,dt][s](p);for(p=[nt,kt,dt][s](p).join()[ut](","),lt=[],w=0,gt=p.length;w<gt;w++)lt[w]=w%2?ot(p[w-1],p[w],et).y:ot(p[w],p[w+1],et).x;return lt},hi=function(n,t,i,r,u,f,e,o,s){var h=1-s;return{x:nt(h,3)*n+nt(h,2)*3*s*i+h*3*s*s*u+nt(s,3)*e,y:nt(h,3)*t+nt(h,2)*3*s*r+h*3*s*s*f+nt(s,3)*o}},ru=it(function(n,t,i,r,f,e,s,h){var b=f-2*i+n-(s-2*f+i),c=2*(i-n)-2*(f-i),g=n-i,p=(-c+u.sqrt(c*c-4*b*g))/2/b,w=(-c-u.sqrt(c*c-4*b*g))/2/b,k=[t,h],d=[n,s],a;return y(p)>"1e12"&&(p=.5),y(w)>"1e12"&&(w=.5),p>0&&p<1&&(a=hi(n,t,i,r,f,e,s,h,p),d.push(a.x),k.push(a.y)),w>0&&w<1&&(a=hi(n,t,i,r,f,e,s,h,w),d.push(a.x),k.push(a.y)),b=e-2*r+t-(h-2*e+r),c=2*(r-t)-2*(e-r),g=t-r,p=(-c+u.sqrt(c*c-4*b*g))/2/b,w=(-c-u.sqrt(c*c-4*b*g))/2/b,y(p)>"1e12"&&(p=.5),y(w)>"1e12"&&(w=.5),p>0&&p<1&&(a=hi(n,t,i,r,f,e,s,h,p),d.push(a.x),k.push(a.y)),w>0&&w<1&&(a=hi(n,t,i,r,f,e,s,h,w),d.push(a.x),k.push(a.y)),{min:{x:l[v](0,d),y:l[v](0,k)},max:{x:o[v](0,d),y:o[v](0,k)}}}),bt=i._path2curve=it(function(n,t){var w=!t&&et(n),r,a;if(!t&&w.curve)return rt(w.curve);var u=nu(n),i=t&&nu(t),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},e={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},b=function(n,t,i){var r,u;if(!n)return["C",t.x,t.y,t.x,t.y,t.x,t.y];n[0]in{T:1,Q:1}||(t.qx=t.qy=null);switch(n[0]){case"M":t.X=n[1];t.Y=n[2];break;case"A":n=["C"][s](iu[v](0,[t.x,t.y][s](n.slice(1))));break;case"S":i=="C"||i=="S"?(r=t.x*2-t.bx,u=t.y*2-t.by):(r=t.x,u=t.y);n=["C",r,u][s](n.slice(1));break;case"T":i=="Q"||i=="T"?(t.qx=t.x*2-t.qx,t.qy=t.y*2-t.qy):(t.qx=t.x,t.qy=t.y);n=["C"][s](tu(t.x,t.y,t.qx,t.qy,n[1],n[2]));break;case"Q":t.qx=n[1];t.qy=n[2];n=["C"][s](tu(t.x,t.y,n[1],n[2],n[3],n[4]));break;case"L":n=["C"][s](si(t.x,t.y,n[1],n[2]));break;case"H":n=["C"][s](si(t.x,t.y,n[1],t.y));break;case"V":n=["C"][s](si(t.x,t.y,t.x,n[1]));break;case"Z":n=["C"][s](si(t.x,t.y,t.X,t.Y))}return n},k=function(n,t){if(n[t].length>7){n[t].shift();for(var r=n[t];r.length;)n.splice(t++,0,["C"][s](r.splice(0,6)));n.splice(t,1);a=o(u.length,i&&i.length||0)}},d=function(n,t,r,f,e){n&&t&&n[e][0]=="M"&&t[e][0]!="M"&&(t.splice(e,0,["M",f.x,f.y]),r.bx=0,r.by=0,r.x=n[e][1],r.y=n[e][2],a=o(u.length,i&&i.length||0))};for(r=0,a=o(u.length,i&&i.length||0);r<a;r++){u[r]=b(u[r],f);k(u,r);i&&(i[r]=b(i[r],e));i&&k(i,r);d(u,i,f,e,r);d(i,u,e,f,r);var c=u[r],l=i&&i[r],y=c.length,p=i&&l.length;f.x=c[y-2];f.y=c[y-1];f.bx=h(c[y-4])||f.x;f.by=h(c[y-3])||f.y;e.bx=i&&(h(l[p-4])||e.x);e.by=i&&(h(l[p-3])||e.y);e.x=i&&l[p-2];e.y=i&&l[p-1]}return i||(w.curve=rt(u)),i?[u,i]:u},null,rt),ee=i._parseDots=it(function(n){for(var f,s,c,e,u,l,r=[],t=0,o=n.length;t<o;t++){if(f={},s=n[t].match(/^([^:]*):?([\d\.]*)/),f.color=i.getRGB(s[1]),f.color.error)return null;f.color=f.color.hex;s[2]&&(f.offset=s[2]+"%");r.push(f)}for(t=1,o=r.length-1;t<o;t++)if(!r[t].offset){for(c=h(r[t-1].offset||0),e=0,u=t+1;u<o;u++)if(r[u].offset){e=r[u].offset;break}for(e||(e=100,u=o),e=h(e),l=(e-c)/(u-t+1);t<u;t++)c+=l,r[t].offset=c+"%"}return r}),ci=i._tear=function(n,t){n==t.top&&(t.top=n.prev);n==t.bottom&&(t.bottom=n.next);n.next&&(n.next.prev=n.prev);n.prev&&(n.prev.next=n.next)},oe=i._tofront=function(n,t){t.top!==n&&(ci(n,t),n.next=null,n.prev=t.top,t.top.next=n,t.top=n)},se=i._toback=function(n,t){t.bottom!==n&&(ci(n,t),n.next=t.bottom,n.prev=null,t.bottom.prev=n,t.bottom=n)},he=i._insertafter=function(n,t,i){ci(n,i);t==i.top&&(i.top=n);t.next&&(t.next.prev=n);n.next=t.next;n.prev=t;t.next=n},ce=i._insertbefore=function(n,t,i){ci(n,i);t==i.bottom&&(i.bottom=n);t.prev&&(t.prev.next=n);n.prev=t.prev;t.prev=n;n.next=t},yf=i.toMatrix=function(n,t){var r=nr(n),i={_:{transform:d},getBBox:function(){return r}};return uu(i,t),i.matrix},le=i.transformPath=function(n,t){return gi(n,yf(n,t))},uu=i._extractTransform=function(n,t){var w,tt;if(t==null)return n._.transform;t=b(t).replace(/\.{3}|\u2026/g,n._.transform||d);var a=i.parseTransformString(t),v=0,g=0,nt=0,y=1,p=1,e=n._,u=new st;if(e.transform=a||[],a)for(w=0,tt=a.length;w<tt;w++){var r=a[w],o=r.length,l=b(r[0]).toLowerCase(),k=r[0]!=l,s=k?u.invert():0,it,rt,h,c,f;l=="t"&&o==3?k?(it=s.x(0,0),rt=s.y(0,0),h=s.x(r[1],r[2]),c=s.y(r[1],r[2]),u.translate(h-it,c-rt)):u.translate(r[1],r[2]):l=="r"?o==2?(f=f||n.getBBox(1),u.rotate(r[1],f.x+f.width/2,f.y+f.height/2),v+=r[1]):o==4&&(k?(h=s.x(r[2],r[3]),c=s.y(r[2],r[3]),u.rotate(r[1],h,c)):u.rotate(r[1],r[2],r[3]),v+=r[1]):l=="s"?o==2||o==3?(f=f||n.getBBox(1),u.scale(r[1],r[o-1],f.x+f.width/2,f.y+f.height/2),y*=r[1],p*=r[o-1]):o==5&&(k?(h=s.x(r[3],r[4]),c=s.y(r[3],r[4]),u.scale(r[1],r[2],h,c)):u.scale(r[1],r[2],r[3],r[4]),y*=r[1],p*=r[2]):l=="m"&&o==7&&u.add(r[1],r[2],r[3],r[4],r[5],r[6]);e.dirtyT=1;n.matrix=u}n.matrix=u;e.sx=y;e.sy=p;e.deg=v;e.dx=g=u.e;e.dy=nt=u.f;y==1&&p==1&&!v&&e.bbox?(e.bbox.x+=+g,e.bbox.y+=+nt):e.dirtyT=1},fu=function(n){var t=n[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return n.length==4?[t,0,n[2],n[3]]:[t,0];case"s":return n.length==5?[t,1,1,n[3],n[4]]:n.length==3?[t,1,1]:[t,1]}},pf=i._equaliseTransform=function(n,t){t=b(t).replace(/\.{3}|\u2026/g,n);n=i.parseTransformString(n)||[];t=i.parseTransformString(t)||[];for(var l=o(n.length,t.length),s=[],h=[],u=0,f,c,r,e;u<l;u++){if(r=n[u]||fu(t[u]),e=t[u]||fu(r),r[0]!=e[0]||r[0].toLowerCase()=="r"&&(r[2]!=e[2]||r[3]!=e[3])||r[0].toLowerCase()=="s"&&(r[3]!=e[3]||r[4]!=e[4]))return;for(s[u]=[],h[u]=[],f=0,c=o(r.length,e.length);f<c;f++)f in r&&(s[u][f]=r[f]),f in e&&(h[u][f]=e[f])}return{from:s,to:h}};i._getContainer=function(n,t,u,f){var e;if(e=f==null&&!i.is(n,"object")?r.doc.getElementById(n):n,e!=null)return e.tagName?t==null?{container:e,width:e.style.pixelWidth||e.offsetWidth,height:e.style.pixelHeight||e.offsetHeight}:{container:e,width:t,height:u}:{container:1,x:n,y:t,width:u,height:f}};i.pathToRelative=vf;i._engine={};i.path2curve=bt;i.matrix=function(n,t,i,r,u,f){return new st(n,t,i,r,u,f)},function(n){function t(n){return n[0]*n[0]+n[1]*n[1]}function r(n){var i=u.sqrt(t(n));n[0]&&(n[0]/=i);n[1]&&(n[1]/=i)}n.add=function(n,t,i,r,u,f){var e=[[],[],[]],a=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],l=[[n,i,u],[t,r,f],[0,0,1]],o,s,h,c;for(n&&n instanceof st&&(l=[[n.a,n.c,n.e],[n.b,n.d,n.f],[0,0,1]]),o=0;o<3;o++)for(s=0;s<3;s++){for(c=0,h=0;h<3;h++)c+=a[o][h]*l[h][s];e[o][s]=c}this.a=e[0][0];this.b=e[1][0];this.c=e[0][1];this.d=e[1][1];this.e=e[0][2];this.f=e[1][2]};n.invert=function(){var n=this,t=n.a*n.d-n.b*n.c;return new st(n.d/t,-n.b/t,-n.c/t,n.a/t,(n.c*n.f-n.d*n.e)/t,(n.b*n.e-n.a*n.f)/t)};n.clone=function(){return new st(this.a,this.b,this.c,this.d,this.e,this.f)};n.translate=function(n,t){this.add(1,0,0,1,n,t)};n.scale=function(n,t,i,r){t==null&&(t=n);(i||r)&&this.add(1,0,0,1,i,r);this.add(n,0,0,t,0,0);(i||r)&&this.add(1,0,0,1,-i,-r)};n.rotate=function(n,t,r){n=i.rad(n);t=t||0;r=r||0;var f=+u.cos(n).toFixed(9),e=+u.sin(n).toFixed(9);this.add(f,e,-e,f,t,r);this.add(1,0,0,1,-t,-r)};n.x=function(n,t){return n*this.a+t*this.c+this.e};n.y=function(n,t){return n*this.b+t*this.d+this.f};n.get=function(n){return+this[b.fromCharCode(97+n)].toFixed(4)};n.toString=function(){return i.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};n.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};n.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};n.split=function(){var n={},f,e,o;return n.dx=this.e,n.dy=this.f,f=[[this.a,this.c],[this.b,this.d]],n.scalex=u.sqrt(t(f[0])),r(f[0]),n.shear=f[0][0]*f[1][0]+f[0][1]*f[1][1],f[1]=[f[1][0]-f[0][0]*n.shear,f[1][1]-f[0][1]*n.shear],n.scaley=u.sqrt(t(f[1])),r(f[1]),n.shear/=n.scaley,e=-f[0][1],o=f[1][1],o<0?(n.rotate=i.deg(u.acos(o)),e<0&&(n.rotate=360-n.rotate)):n.rotate=i.deg(u.asin(e)),n.isSimple=!+n.shear.toFixed(9)&&(n.scalex.toFixed(9)==n.scaley.toFixed(9)||!n.rotate),n.isSuperSimple=!+n.shear.toFixed(9)&&n.scalex.toFixed(9)==n.scaley.toFixed(9)&&!n.rotate,n.noRotation=!+n.shear.toFixed(9)&&!n.rotate,n};n.toTransformString=function(n){var t=n||this[ut]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:d)+(t.scalex!=1||t.scaley!=1?"s"+[t.scalex,t.scaley,0,0]:d)+(t.rotate?"r"+[t.rotate,0,0]:d)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(st.prototype);kt=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);c.safari=navigator.vendor=="Apple Computer, Inc."&&(kt&&kt[1]<4||navigator.platform.slice(0,2)=="iP")||navigator.vendor=="Google Inc."&&kt&&kt[1]<8?function(){var n=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){n.remove()})}:of;var wf=function(){this.returnValue=!1},bf=function(){return this.originalEvent.preventDefault()},kf=function(){this.cancelBubble=!0},df=function(){return this.originalEvent.stopPropagation()},eu=function(n){var t=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,i=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft;return{x:n.clientX+i,y:n.clientY+t}},gf=function(){return r.doc.addEventListener?function(n,t,i,r){var u=function(n){var t=eu(n);return i.call(r,n,t.x,t.y)},f;return n.addEventListener(t,u,!1),gt&&ni[t]&&(f=function(t){for(var f=eu(t),e=t,u=0,o=t.targetTouches&&t.targetTouches.length;u<o;u++)if(t.targetTouches[u].target==n){t=t.targetTouches[u];t.originalEvent=e;t.preventDefault=bf;t.stopPropagation=df;break}return i.call(r,t,f.x,f.y)},n.addEventListener(ni[t],f,!1)),function(){return n.removeEventListener(t,u,!1),gt&&ni[t]&&n.removeEventListener(ni[t],u,!1),!0}}:r.doc.attachEvent?function(n,t,i,u){var f=function(n){n=n||r.win.event;var t=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,f=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft,e=n.clientX+f,o=n.clientY+t;return n.preventDefault=n.preventDefault||wf,n.stopPropagation=n.stopPropagation||kf,i.call(u,n,e,o)};return n.attachEvent("on"+t,f),function(){return n.detachEvent("on"+t,f),!0}}:void 0}(),ot=[],tr=function(n){for(var f=n.clientX,e=n.clientY,v=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,y=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft,i,l=ot.length,s,o;l--;){if(i=ot[l],gt&&n.touches){for(s=n.touches.length;s--;)if(o=n.touches[s],o.identifier==i.el._drag.id){f=o.clientX;e=o.clientY;(n.originalEvent?n.originalEvent:n).preventDefault();break}}else n.preventDefault();var u=i.el.node,h,a=u.nextSibling,c=u.parentNode,p=u.style.display;r.win.opera&&c.removeChild(u);u.style.display="none";h=i.el.paper.getElementByPoint(f,e);u.style.display=p;r.win.opera&&(a?c.insertBefore(u,a):c.appendChild(u));h&&t("raphael.drag.over."+i.el.id,i.el,h);f+=y;e+=v;t("raphael.drag.move."+i.el.id,i.move_scope||i.el,f-i.el._drag.x,e-i.el._drag.y,f,e,n)}},ir=function(n){i.unmousemove(tr).unmouseup(ir);for(var u=ot.length,r;u--;)r=ot[u],r.el._drag={},t("raphael.drag.end."+r.el.id,r.end_scope||r.start_scope||r.move_scope||r.el,n);ot=[]},e=i.el={};for(rr=yr.length;rr--;)(function(n){i[n]=e[n]=function(t,u){return i.is(t,"function")&&(this.events=this.events||[],this.events.push({name:n,f:t,unbind:gf(this.shape||this.node||r.doc,n,t,u||this)})),this};i["un"+n]=e["un"+n]=function(t){for(var r=this.events||[],u=r.length;u--;)r[u].name==n&&(i.is(t,"undefined")||r[u].f==t)&&(r[u].unbind(),r.splice(u,1),r.length||delete this.events);return this}})(yr[rr]);e.data=function(n,r){var u=vt[this.id]=vt[this.id]||{},f;if(arguments.length==0)return u;if(arguments.length==1){if(i.is(n,"object")){for(f in n)n[a](f)&&this.data(f,n[f]);return this}return t("raphael.data.get."+this.id,this,u[n],n),u[n]}return u[n]=r,t("raphael.data.set."+this.id,this,r,n),this};e.removeData=function(n){return n==null?vt[this.id]={}:vt[this.id]&&delete vt[this.id][n],this};e.getData=function(){return pt(vt[this.id]||{})};e.hover=function(n,t,i,r){return this.mouseover(n,i).mouseout(t,r||i)};e.unhover=function(n,t){return this.unmouseover(n).unmouseout(t)};ct=[];e.drag=function(n,u,f,e,o,s){function h(h){var l,c;(h.originalEvent||h).preventDefault();var a=h.clientX,v=h.clientY,y=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,p=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft;if(this._drag.id=h.identifier,gt&&h.touches)for(l=h.touches.length;l--;)if(c=h.touches[l],this._drag.id=c.identifier,c.identifier==this._drag.id){a=c.clientX;v=c.clientY;break}this._drag.x=a+p;this._drag.y=v+y;ot.length||i.mousemove(tr).mouseup(ir);ot.push({el:this,move_scope:e,start_scope:o,end_scope:s});u&&t.on("raphael.drag.start."+this.id,u);n&&t.on("raphael.drag.move."+this.id,n);f&&t.on("raphael.drag.end."+this.id,f);t("raphael.drag.start."+this.id,o||e||this,h.clientX+p,h.clientY+y,h)}return this._drag={},ct.push({el:this,start:h}),this.mousedown(h),this};e.onDragOver=function(n){n?t.on("raphael.drag.over."+this.id,n):t.unbind("raphael.drag.over."+this.id)};e.undrag=function(){for(var n=ct.length;n--;)ct[n].el==this&&(this.unmousedown(ct[n].start),ct.splice(n,1),t.unbind("raphael.drag.*."+this.id));ct.length||i.unmousemove(tr).unmouseup(ir);ot=[]};c.circle=function(n,t,r){var u=i._engine.circle(this,n||0,t||0,r||0);return this.__set__&&this.__set__.push(u),u};c.rect=function(n,t,r,u,f){var e=i._engine.rect(this,n||0,t||0,r||0,u||0,f||0);return this.__set__&&this.__set__.push(e),e};c.ellipse=function(n,t,r,u){var f=i._engine.ellipse(this,n||0,t||0,r||0,u||0);return this.__set__&&this.__set__.push(f),f};c.path=function(n){!n||i.is(n,ii)||i.is(n[0],tt)||(n+=d);var t=i._engine.path(i.format[v](i,arguments),this);return this.__set__&&this.__set__.push(t),t};c.image=function(n,t,r,u,f){var e=i._engine.image(this,n||"about:blank",t||0,r||0,u||0,f||0);return this.__set__&&this.__set__.push(e),e};c.text=function(n,t,r){var u=i._engine.text(this,n||0,t||0,b(r));return this.__set__&&this.__set__.push(u),u};c.set=function(n){i.is(n,"array")||(n=Array.prototype.splice.call(arguments,0,arguments.length));var t=new yt(n);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t};c.setStart=function(n){this.__set__=n||this.set()};c.setFinish=function(){var n=this.__set__;return delete this.__set__,n};c.setSize=function(n,t){return i._engine.setSize.call(this,n,t)};c.setViewBox=function(n,t,r,u,f){return i._engine.setViewBox.call(this,n,t,r,u,f)};c.top=c.bottom=null;c.raphael=i;ou=function(n){var u=n.getBoundingClientRect(),f=n.ownerDocument,t=f.body,i=f.documentElement,e=i.clientTop||t.clientTop||0,o=i.clientLeft||t.clientLeft||0,s=u.top+(r.win.pageYOffset||i.scrollTop||t.scrollTop)-e,h=u.left+(r.win.pageXOffset||i.scrollLeft||t.scrollLeft)-o;return{y:s,x:h}};c.getElementByPoint=function(n,t){var o=this,f=o.canvas,i=r.doc.elementFromPoint(n,t),s,u,e;if(r.win.opera&&i.tagName=="svg"&&(s=ou(f),u=f.createSVGRect(),u.x=n-s.x,u.y=t-s.y,u.width=u.height=1,e=f.getIntersectionList(u,null),e.length&&(i=e[e.length-1])),!i)return null;while(i.parentNode&&i!=f.parentNode&&!i.raphael)i=i.parentNode;return i==o.canvas.parentNode&&(i=f),i&&i.raphael?o.getById(i.raphaelid):null};c.getElementsByBBox=function(n){var t=this.set();return this.forEach(function(r){i.isBBoxIntersect(r.getBBox(),n)&&t.push(r)}),t};c.getById=function(n){for(var t=this.bottom;t;){if(t.id==n)return t;t=t.next}return null};c.forEach=function(n,t){for(var i=this.bottom;i;){if(n.call(t,i)===!1)return this;i=i.next}return this};c.getElementsByPoint=function(n,t){var i=this.set();return this.forEach(function(r){r.isPointInside(n,t)&&i.push(r)}),i};e.isPointInside=function(n,t){var r=this.realPath=ui[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(r=i.transformPath(r,this.attr("transform"))),i.isPointInsidePath(r,n,t)};e.getBBox=function(n){if(this.removed)return{};var t=this._;return n?((t.dirty||!t.bboxwt)&&(this.realPath=ui[this.type](this),t.bboxwt=nr(this.realPath),t.bboxwt.toString=lr,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&((t.dirty||!this.realPath)&&(t.bboxwt=0,this.realPath=ui[this.type](this)),t.bbox=nr(gi(this.realPath,this.matrix)),t.bbox.toString=lr,t.dirty=t.dirtyT=0),t.bbox)};e.clone=function(){if(this.removed)return null;var n=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(n),n};e.glow=function(n){var r;if(this.type=="text")return null;n=n||{};var t={width:(n.width||10)+(+this.attr("stroke-width")||1),fill:n.fill||!1,opacity:n.opacity||.5,offsetx:n.offsetx||0,offsety:n.offsety||0,color:n.color||"#000"},u=t.width/2,f=this.paper,e=f.set(),i=this.realPath||ui[this.type](this);for(i=this.matrix?gi(i,this.matrix):i,r=1;r<u+1;r++)e.push(f.path(i).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/u*r).toFixed(3),opacity:+(t.opacity/u).toFixed(3)}));return e.insertBefore(this).translate(t.offsetx,t.offsety)};var ur=function(n,t,r,u,f,e,o,s,h){return h==null?lt(n,t,r,u,f,e,o,s):i.findDotsAtSegment(n,t,r,u,f,e,o,s,au(n,t,r,u,f,e,o,s,h))},fr=function(n,t){return function(r,u,f){var y,p;r=bt(r);var s,h,e,a,c="",v={},o,l=0;for(y=0,p=r.length;y<p;y++){if(e=r[y],e[0]=="M")s=+e[1],h=+e[2];else{if(a=ur(s,h,e[1],e[2],e[3],e[4],e[5],e[6]),l+a>u){if(t&&!v.start){if(o=ur(s,h,e[1],e[2],e[3],e[4],e[5],e[6],u-l),c+=["C"+o.start.x,o.start.y,o.m.x,o.m.y,o.x,o.y],f)return c;v.start=c;c=["M"+o.x,o.y+"C"+o.n.x,o.n.y,o.end.x,o.end.y,e[5],e[6]].join();l+=a;s=+e[5];h=+e[6];continue}if(!n&&!t)return o=ur(s,h,e[1],e[2],e[3],e[4],e[5],e[6],u-l),{x:o.x,y:o.y,alpha:o.alpha}}l+=a;s=+e[5];h=+e[6]}c+=e.shift()+e}return v.end=c,o=n?l:t?v:i.findDotsAtSegment(s,h,e[0],e[1],e[2],e[3],e[4],e[5],1),o.alpha&&(o={x:o.x,y:o.y,alpha:o.alpha}),o}},su=fr(1),hu=fr(),er=fr(0,1);i.getTotalLength=su;i.getPointAtLength=hu;i.getSubpath=function(n,t,i){if(this.getTotalLength(n)-i<1e-6)return er(n,t).end;var r=er(n,i,1);return t?er(r,t).end:r};e.getTotalLength=function(){var n=this.getPath();if(n)return this.node.getTotalLength?this.node.getTotalLength():su(n)};e.getPointAtLength=function(n){var t=this.getPath();if(t)return hu(t,n)};e.getPath=function(){var n,t=i._getPath[this.type];if(this.type!="text"&&this.type!="set")return t&&(n=t(this)),n};e.getSubpath=function(n,t){var r=this.getPath();if(r)return i.getSubpath(r,n,t)};g=i.easing_formulas={linear:function(n){return n},"<":function(n){return nt(n,1.7)},">":function(n){return nt(n,.48)},"<>":function(n){var i=.48-n/1.04,r=u.sqrt(.1734+i*i),f=r-i,o=nt(y(f),1/3)*(f<0?-1:1),e=-r-i,s=nt(y(e),1/3)*(e<0?-1:1),t=o+s+.5;return(1-t)*3*t*t+t*t*t},backIn:function(n){var t=1.70158;return n*n*((t+1)*n-t)},backOut:function(n){n=n-1;var t=1.70158;return n*n*((t+1)*n+t)+1},elastic:function(n){return n==!!n?n:nt(2,-10*n)*u.sin((n-.075)*2*k/.3)+1},bounce:function(n){var r=7.5625,t=2.75,i;return n<1/t?i=r*n*n:n<2/t?(n-=1.5/t,i=r*n*n+.75):n<2.5/t?(n-=2.25/t,i=r*n*n+.9375):(n-=2.625/t,i=r*n*n+.984375),i}};g.easeIn=g["ease-in"]=g["<"];g.easeOut=g["ease-out"]=g[">"];g.easeInOut=g["ease-in-out"]=g["<>"];g["back-in"]=g.backIn;g["back-out"]=g.backOut;var f=[],cu=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(n){setTimeout(n,16)},or=function(){for(var ft=+new Date,b=0,n,v,r,u,g,c,nt,w,ut;b<f.length;b++)if(n=f[b],!n.el.removed&&!n.paused){var k=ft-n.start,h=n.ms,et=n.easing,o=n.from,l=n.diff,tt=n.to,ot=n.t,y=n.el,it={},e,rt={},d;if(n.initstatus?(k=(n.initstatus*n.anim.top-n.prev)/(n.percent-n.prev)*h,n.status=n.initstatus,delete n.initstatus,n.stop&&f.splice(b--,1)):n.status=(n.prev+(n.percent-n.prev)*(k/h))/n.anim.top,!(k<0))if(k<h){v=et(k/h);for(r in o)if(o[a](r)){switch(ki[r]){case p:e=+o[r]+v*h*l[r];break;case"colour":e="rgb("+[sr(bi(o[r].r+v*h*l[r].r)),sr(bi(o[r].g+v*h*l[r].g)),sr(bi(o[r].b+v*h*l[r].b))].join(",")+")";break;case"path":for(e=[],u=0,g=o[r].length;u<g;u++){for(e[u]=[o[r][u][0]],c=1,nt=o[r][u].length;c<nt;c++)e[u][c]=+o[r][u][c]+v*h*l[r][u][c];e[u]=e[u].join(at)}e=e.join(at);break;case"transform":if(l[r].real)for(e=[],u=0,g=o[r].length;u<g;u++)for(e[u]=[o[r][u][0]],c=1,nt=o[r][u].length;c<nt;c++)e[u][c]=o[r][u][c]+v*h*l[r][u][c];else w=function(n){return+o[r][n]+v*h*l[r][n]},e=[["m",w(0),w(1),w(2),w(3),w(4),w(5)]];break;case"csv":if(r=="clip-rect")for(e=[],u=4;u--;)e[u]=+o[r][u]+v*h*l[r][u];break;default:for(ut=[][s](o[r]),e=[],u=y.paper.customAttributes[r].length;u--;)e[u]=+ut[u]+v*h*l[r][u]}it[r]=e}y.attr(it),function(n,i,r){setTimeout(function(){t("raphael.anim.frame."+n,i,r)})}(y.id,y,n.anim)}else{if(function(n,r,u){setTimeout(function(){t("raphael.anim.frame."+r.id,r,u);t("raphael.anim.finish."+r.id,r,u);i.is(n,"function")&&n.call(r)})}(n.callback,y,n.anim),y.attr(tt),f.splice(b--,1),n.repeat>1&&!n.next){for(d in tt)tt[a](d)&&(rt[d]=n.totalOrigin[d]);n.el.attr(rt);wt(n.anim,n.el,n.anim.percents[0],null,n.totalOrigin,n.repeat-1)}n.next&&!n.stop&&wt(n.anim,n.el,n.next,null,n.totalOrigin,n.repeat)}}i.svg&&y&&y.paper&&y.paper.safari();f.length&&cu(or)},sr=function(n){return n>255?255:n<0?0:n};e.animateWith=function(n,t,r,u,e,o){var s=this,c,h,l;if(s.removed)return o&&o.call(s),s;for(c=r instanceof ft?r:i.animation(r,u,e,o),wt(c,s,c.percents[0],null,s.attr()),h=0,l=f.length;h<l;h++)if(f[h].anim==t&&f[h].el==n){f[l-1].start=f[h].start;break}return s};e.onAnimation=function(n){return n?t.on("raphael.anim.frame."+this.id,n):t.unbind("raphael.anim.frame."+this.id),this};ft.prototype.delay=function(n){var t=new ft(this.anim,this.ms);return t.times=this.times,t.del=+n||0,t};ft.prototype.repeat=function(n){var t=new ft(this.anim,this.ms);return t.del=this.del,t.times=u.floor(o(n,0))||1,t};i.animation=function(n,t,r,u){if(n instanceof ft)return n;(i.is(r,"function")||!r)&&(u=u||r||null,r=null);n=Object(n);t=+t||0;var e={},o;for(var f in n)n[a](f)&&h(f)!=f&&h(f)+"%"!=f&&(o=!0,e[f]=n[f]);return o?(r&&(e.easing=r),u&&(e.callback=u),new ft({100:e},t)):new ft(n,t)};e.animate=function(n,t,r,u){var f=this,e;return f.removed?(u&&u.call(f),f):(e=n instanceof ft?n:i.animation(n,t,r,u),wt(e,f,e.percents[0],null,f.attr()),f)};e.setTime=function(n,t){return n&&t!=null&&this.status(n,l(t,n.ms)/n.ms),this};e.status=function(n,t){var u=[],r=0,e,i;if(t!=null)return wt(n,this,-1,l(t,1)),this;for(e=f.length;r<e;r++)if(i=f[r],i.el.id==this.id&&(!n||i.anim==n)){if(n)return i.status;u.push({anim:i.anim,status:i.status})}return n?0:u};e.pause=function(n){for(var i=0;i<f.length;i++)f[i].el.id!=this.id||n&&f[i].anim!=n||t("raphael.anim.pause."+this.id,this,f[i].anim)!==!1&&(f[i].paused=!0);return this};e.resume=function(n){for(var r,i=0;i<f.length;i++)f[i].el.id!=this.id||n&&f[i].anim!=n||(r=f[i],t("raphael.anim.resume."+this.id,this,r.anim)!==!1&&(delete r.paused,this.status(r.anim,r.status)));return this};e.stop=function(n){for(var i=0;i<f.length;i++)f[i].el.id!=this.id||n&&f[i].anim!=n||t("raphael.anim.stop."+this.id,this,f[i].anim)!==!1&&f.splice(i--,1);return this};t.on("raphael.remove",ar);t.on("raphael.clear",ar);e.toString=function(){return"Raphaël’s object"};yt=function(n){if(this.items=[],this.length=0,this.type="set",n)for(var t=0,i=n.length;t<i;t++)n[t]&&(n[t].constructor==e.constructor||n[t].constructor==yt)&&(this[this.items.length]=this.items[this.items.length]=n[t],this.length++)};w=yt.prototype;w.push=function(){for(var n,t,i=0,r=arguments.length;i<r;i++)n=arguments[i],n&&(n.constructor==e.constructor||n.constructor==yt)&&(t=this.items.length,this[t]=this.items[t]=n,this.length++);return this};w.pop=function(){return this.length&&delete this[this.length--],this.items.pop()};w.forEach=function(n,t){for(var i=0,r=this.items.length;i<r;i++)if(n.call(t,this.items[i],i)===!1)return this;return this};for(li in e)e[a](li)&&(w[li]=function(n){return function(){var t=arguments;return this.forEach(function(i){i[n][v](i,t)})}}(li));w.attr=function(n,t){var r,f,u,e;if(n&&i.is(n,tt)&&i.is(n[0],"object"))for(r=0,f=n.length;r<f;r++)this.items[r].attr(n[r]);else for(u=0,e=this.items.length;u<e;u++)this.items[u].attr(n,t);return this};w.clear=function(){while(this.length)this.pop()};w.splice=function(n,t){var r;n=n<0?o(this.length+n,0):n;t=o(0,l(this.length-n,t));for(var u=[],e=[],f=[],i=2;i<arguments.length;i++)f.push(arguments[i]);for(i=0;i<t;i++)e.push(this[n+i]);for(;i<this.length-n;i++)u.push(this[n+i]);for(r=f.length,i=0;i<r+u.length;i++)this.items[n+i]=this[n+i]=i<r?f[i]:u[i-r];for(i=this.items.length=this.length-=t-r;this[i];)delete this[i++];return new yt(e)};w.exclude=function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]==n)return this.splice(t,1),!0};w.animate=function(n,t,r,u){var o;(i.is(r,"function")||!r)&&(u=r||null);var e=this.items.length,f=e,h,c=this,s;if(!e)return this;for(u&&(s=function(){--e||u.call(c)}),r=i.is(r,ii)?r:s,o=i.animation(n,t,r,s),h=this.items[--f].animate(o);f--;)this.items[f]&&!this.items[f].removed&&this.items[f].animateWith(h,o,o),this.items[f]&&!this.items[f].removed||e--;return this};w.insertAfter=function(n){for(var t=this.items.length;t--;)this.items[t].insertAfter(n);return this};w.getBBox=function(){for(var n,t=[],i=[],r=[],u=[],f=this.items.length;f--;)this.items[f].removed||(n=this.items[f].getBBox(),t.push(n.x),i.push(n.y),r.push(n.x+n.width),u.push(n.y+n.height));return t=l[v](0,t),i=l[v](0,i),r=o[v](0,r),u=o[v](0,u),{x:t,y:i,x2:r,y2:u,width:r-t,height:u-i}};w.clone=function(n){n=this.paper.set();for(var t=0,i=this.items.length;t<i;t++)n.push(this.items[t].clone());return n};w.toString=function(){return"Raphaël‘s set"};w.glow=function(n){var t=this.paper.set();return this.forEach(function(i){var r=i.glow(n);r!=null&&r.forEach(function(n){t.push(n)})}),t};w.isPointInside=function(n,t){var i=!1;return this.forEach(function(r){if(r.isPointInside(n,t))return i=!0,!1}),i};i.registerFont=function(n){var i,u,f,r,t,e;if(!n.face)return n;this.fonts=this.fonts||{};i={w:n.w,face:{},glyphs:{}};u=n.face["font-family"];for(f in n.face)n.face[a](f)&&(i.face[f]=n.face[f]);if(this.fonts[u]?this.fonts[u].push(i):this.fonts[u]=[i],!n.svg){i.face["units-per-em"]=ht(n.face["units-per-em"],10);for(r in n.glyphs)if(n.glyphs[a](r)&&(t=n.glyphs[r],i.glyphs[r]={w:t.w,k:{},d:t.d&&"M"+t.d.replace(/[mlcxtrv]/g,function(n){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[n]||"M"})+"z"},t.k))for(e in t.k)t[a](e)&&(i.glyphs[r].k[e]=t.k[e])}return n};c.getFont=function(n,t,r,u){var f,h,o,e,s,c;if(u=u||"normal",r=r||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,i.fonts){if(f=i.fonts[n],!f){h=new RegExp("(^|\\s)"+n.replace(/[^\w\d\s+!~.:_-]/g,d)+"(\\s|$)","i");for(o in i.fonts)if(i.fonts[a](o)&&h.test(o)){f=i.fonts[o];break}}if(f)for(s=0,c=f.length;s<c;s++)if(e=f[s],e.face["font-weight"]==t&&(e.face["font-style"]==r||!e.face["font-style"])&&e.face["font-stretch"]==u)break;return e}};c.print=function(n,t,r,u,f,e,s,h){var a,et,k,y;e=e||"middle";s=o(l(s||0,1),-1);h=o(l(h||1,3),1);var v=b(r)[ut](d),g=0,p=0,tt=d,c;if(i.is(u,"string")&&(u=this.getFont(u)),u){c=(f||16)/u.face["units-per-em"];var w=u.face.bbox[ut](pi),it=+w[0],nt=w[3]-w[1],rt=0,ft=+w[1]+(e=="baseline"?nt+ +u.face.descent:nt/2);for(a=0,et=v.length;a<et;a++)v[a]=="\n"?(g=0,y=0,p=0,rt+=nt*h):(k=p&&u.glyphs[v[a-1]]||{},y=u.glyphs[v[a]],g+=p?(k.w||u.w)+(k.k&&k.k[v[a]]||0)+u.w*s:0,p=1),y&&y.d&&(tt+=i.transformPath(y.d,["t",g*c,rt*c,"s",c,c,it,ft,"t",(n-it)/c,(t-ft)/c]))}return this.path(tt).attr({fill:"#000",stroke:"none"})};c.add=function(n){if(i.is(n,"array"))for(var u=this.set(),r=0,f=n.length,t;r<f;r++)t=n[r]||{},pu[a](t.type)&&u.push(this[t.type]().attr(t));return u};i.format=function(n,t){var r=i.is(t,tt)?[0][s](t):arguments;return n&&i.is(n,ii)&&r.length-1&&(n=n.replace(wu,function(n,t){return r[++t]==null?d:r[t]})),n||d};i.fullfill=function(){var n=/\{([^\}]+)\}/g,t=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,i=function(n,i,r){var u=r;return i.replace(t,function(n,t,i,r,f){t=t||r;u&&(t in u&&(u=u[t]),typeof u=="function"&&f&&(u=u()))}),u=(u==null||u==r?n:u)+""};return function(t,r){return String(t).replace(n,function(n,t){return i(n,t,r)})}}();i.ninja=function(){return wi.was?r.win.Raphael=wi.is:delete Raphael,i};i.st=w,function(n,t,r){function u(){/in/.test(n.readyState)?setTimeout(u,9):i.eve("raphael.DOMload")}n.readyState==null&&n.addEventListener&&(n.addEventListener(t,r=function(){n.removeEventListener(t,r,!1);n.readyState="complete"},!1),n.readyState="loading");u()}(document,"DOMContentLoaded");t.on("raphael.DOMload",function(){yi=!0});return function(){var nt,v;if(i.svg){var t="hasOwnProperty",u=String,f=parseFloat,tt=parseInt,c=Math,k=c.max,y=c.abs,d=c.pow,l=/[, ]+/,p=i.eve,o="",w=" ",a="http://www.w3.org/1999/xlink",ft={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},e={};i.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var n=function(r,f){if(f){typeof r=="string"&&(r=n(r));for(var e in f)f[t](e)&&(e.substring(0,6)=="xlink:"?r.setAttributeNS(a,e.substring(6),u(f[e])):r.setAttribute(e,u(f[e])))}else r=i._g.doc.createElementNS("http://www.w3.org/2000/svg",r),r.style&&(r.style.webkitTapHighlightColor="rgba(0,0,0,0)");return r},it=function(t,r){var w="linear",l=t.id+r,b=.5,s=.5,tt=t.node,it=t.paper,g=tt.style,a=i._g.doc.getElementById(l),v,e,nt,p,h,rt;if(!a){if(r=u(r).replace(i._radial_gradient,function(n,t,i){if(w="radial",t&&i){b=f(t);s=f(i);var r=(s>.5)*2-1;d(b-.5,2)+d(s-.5,2)>.25&&(s=c.sqrt(.25-d(b-.5,2))*r+.5)&&s!=.5&&(s=s.toFixed(5)-1e-5*r)}return o}),r=r.split(/\s*\-\s*/),w=="linear"){if(v=r.shift(),v=-f(v),isNaN(v))return null;e=[0,0,c.cos(i.rad(v)),c.sin(i.rad(v))];nt=1/(k(y(e[2]),y(e[3]))||1);e[2]*=nt;e[3]*=nt;e[2]<0&&(e[0]=-e[2],e[2]=0);e[3]<0&&(e[1]=-e[3],e[3]=0)}if(p=i._parseDots(r),!p)return null;if(l=l.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&l!=t.gradient.id&&(it.defs.removeChild(t.gradient),delete t.gradient),!t.gradient)for(a=n(w+"Gradient",{id:l}),t.gradient=a,n(a,w=="radial"?{fx:b,fy:s}:{x1:e[0],y1:e[1],x2:e[2],y2:e[3],gradientTransform:t.matrix.invert()}),it.defs.appendChild(a),h=0,rt=p.length;h<rt;h++)a.appendChild(n("stop",{offset:p[h].offset?p[h].offset:h?"100%":"0%","stop-color":p[h].color||"#fff"}))}return n(tt,{fill:"url(#"+l+")",opacity:1,"fill-opacity":1}),g.fill=o,g.opacity=1,g.fillOpacity=1,1},b=function(t){var i=t.getBBox(1);n(t.pattern,{patternTransform:t.matrix.invert()+" translate("+i.x+","+i.y+")"})},s=function(r,f,s){var b,k,g,tt,it,rt;if(r.type=="path"){for(var ut=u(f).toLowerCase().split("-"),ht=r.paper,h=s?"end":"start",ct=r.node,l=r.attrs,d=l["stroke-width"],et=ut.length,a="classic",p,w,ot,st,c,v=3,y=3,nt=5;et--;)switch(ut[et]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":a=ut[et];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":v=5;break;case"short":v=2}a=="open"?(v+=2,y+=2,nt+=2,ot=1,st=s?4:1,c={fill:"none",stroke:l.stroke}):(st=ot=v/2,c={fill:l.stroke,stroke:"none"});r._.arrows?s?(r._.arrows.endPath&&e[r._.arrows.endPath]--,r._.arrows.endMarker&&e[r._.arrows.endMarker]--):(r._.arrows.startPath&&e[r._.arrows.startPath]--,r._.arrows.startMarker&&e[r._.arrows.startMarker]--):r._.arrows={};a!="none"?(b="raphael-marker-"+a,k="raphael-marker-"+h+a+v+y,i._g.doc.getElementById(b)?e[b]++:(ht.defs.appendChild(n(n("path"),{"stroke-linecap":"round",d:ft[a],id:b})),e[b]=1),g=i._g.doc.getElementById(k),g?(e[k]++,tt=g.getElementsByTagName("use")[0]):(g=n(n("marker"),{id:k,markerHeight:y,markerWidth:v,orient:"auto",refX:st,refY:y/2}),tt=n(n("use"),{"xlink:href":"#"+b,transform:(s?"rotate(180 "+v/2+" "+y/2+") ":o)+"scale("+v/nt+","+y/nt+")","stroke-width":(2/(v/nt+y/nt)).toFixed(4)}),g.appendChild(tt),ht.defs.appendChild(g),e[k]=1),n(tt,c),it=ot*(a!="diamond"&&a!="oval"),s?(p=r._.arrows.startdx*d||0,w=i.getTotalLength(l.path)-it*d):(p=it*d,w=i.getTotalLength(l.path)-(r._.arrows.enddx*d||0)),c={},c["marker-"+h]="url(#"+k+")",(w||p)&&(c.d=i.getSubpath(l.path,p,w)),n(ct,c),r._.arrows[h+"Path"]=b,r._.arrows[h+"Marker"]=k,r._.arrows[h+"dx"]=it,r._.arrows[h+"Type"]=a,r._.arrows[h+"String"]=f):(s?(p=r._.arrows.startdx*d||0,w=i.getTotalLength(l.path)-p):(p=0,w=i.getTotalLength(l.path)-(r._.arrows.enddx*d||0)),r._.arrows[h+"Path"]&&n(ct,{d:i.getSubpath(l.path,p,w)}),delete r._.arrows[h+"Path"],delete r._.arrows[h+"Marker"],delete r._.arrows[h+"dx"],delete r._.arrows[h+"Type"],delete r._.arrows[h+"String"]);for(c in e)e[t](c)&&!e[c]&&(rt=i._g.doc.getElementById(c),rt&&rt.parentNode.removeChild(rt))}},et={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},rt=function(t,i,r){if(i=et[u(i).toLowerCase()],i){for(var e=t.attrs["stroke-width"]||"1",s={round:e,square:e,butt:0}[t.attrs["stroke-linecap"]||r["stroke-linecap"]]||0,o=[],f=i.length;f--;)o[f]=i[f]*e+(f%2?1:-1)*s;n(t.node,{"stroke-dasharray":o.join(",")})}},g=function(r,f){var h=r.node,c=r.attrs,pt=h.style.visibility,v,e,d,vt,g,et,nt,p,st,at,ht,ct,lt,w,ut,ft,yt;h.style.visibility="hidden";for(v in f)if(f[t](v)){if(!i._availableAttrs[t](v))continue;e=f[v];c[v]=e;switch(v){case"blur":r.blur(e);break;case"title":d=h.getElementsByTagName("title");d.length&&(d=d[0])?d.firstChild.nodeValue=e:(d=n("title"),vt=i._g.doc.createTextNode(e),d.appendChild(vt),h.appendChild(d));break;case"href":case"target":g=h.parentNode;g.tagName.toLowerCase()!="a"&&(et=n("a"),g.insertBefore(et,h),et.appendChild(h),g=et);v=="target"?g.setAttributeNS(a,"show",e=="blank"?"new":e):g.setAttributeNS(a,v,e);break;case"cursor":h.style.cursor=e;break;case"transform":r.transform(e);break;case"arrow-start":s(r,e);break;case"arrow-end":s(r,e,1);break;case"clip-rect":nt=u(e).split(l);nt.length==4&&(r.clip&&r.clip.parentNode.parentNode.removeChild(r.clip.parentNode),p=n("clipPath"),st=n("rect"),p.id=i.createUUID(),n(st,{x:nt[0],y:nt[1],width:nt[2],height:nt[3]}),p.appendChild(st),r.paper.defs.appendChild(p),n(h,{"clip-path":"url(#"+p.id+")"}),r.clip=st);e||(at=h.getAttribute("clip-path"),at&&(ht=i._g.doc.getElementById(at.replace(/(^url\(#|\)$)/g,o)),ht&&ht.parentNode.removeChild(ht),n(h,{"clip-path":o}),delete r.clip));break;case"path":r.type=="path"&&(n(h,{d:e?c.path=i._pathToAbsolute(e):"M0,0"}),r._.dirty=1,r._.arrows&&("startString"in r._.arrows&&s(r,r._.arrows.startString),"endString"in r._.arrows&&s(r,r._.arrows.endString,1)));break;case"width":if(h.setAttribute(v,e),r._.dirty=1,c.fx)v="x",e=c.x;else break;case"x":c.fx&&(e=-c.x-(c.width||0));case"rx":if(v=="rx"&&r.type=="rect")break;case"cx":h.setAttribute(v,e);r.pattern&&b(r);r._.dirty=1;break;case"height":if(h.setAttribute(v,e),r._.dirty=1,c.fy)v="y",e=c.y;else break;case"y":c.fy&&(e=-c.y-(c.height||0));case"ry":if(v=="ry"&&r.type=="rect")break;case"cy":h.setAttribute(v,e);r.pattern&&b(r);r._.dirty=1;break;case"r":r.type=="rect"?n(h,{rx:e,ry:e}):h.setAttribute(v,e);r._.dirty=1;break;case"src":r.type=="image"&&h.setAttributeNS(a,"href",e);break;case"stroke-width":(r._.sx!=1||r._.sy!=1)&&(e/=k(y(r._.sx),y(r._.sy))||1);r.paper._vbSize&&(e*=r.paper._vbSize);h.setAttribute(v,e);c["stroke-dasharray"]&&rt(r,c["stroke-dasharray"],f);r._.arrows&&("startString"in r._.arrows&&s(r,r._.arrows.startString),"endString"in r._.arrows&&s(r,r._.arrows.endString,1));break;case"stroke-dasharray":rt(r,e,f);break;case"fill":if(ct=u(e).match(i._ISURL),ct){p=n("pattern");lt=n("image");p.id=i.createUUID();n(p,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});n(lt,{x:0,y:0,"xlink:href":ct[1]});p.appendChild(lt),function(t){i._preload(ct[1],function(){var i=this.offsetWidth,u=this.offsetHeight;n(t,{width:i,height:u});n(lt,{width:i,height:u});r.paper.safari()})}(p);r.paper.defs.appendChild(p);n(h,{fill:"url(#"+p.id+")"});r.pattern=p;r.pattern&&b(r);break}if(w=i.getRGB(e),w.error){if((r.type=="circle"||r.type=="ellipse"||u(e).charAt()!="r")&&it(r,e)){("opacity"in c||"fill-opacity"in c)&&(ut=i._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,o)),ut&&(ft=ut.getElementsByTagName("stop"),n(ft[ft.length-1],{"stop-opacity":("opacity"in c?c.opacity:1)*("fill-opacity"in c?c["fill-opacity"]:1)})));c.gradient=e;c.fill="none";break}}else delete f.gradient,delete c.gradient,!i.is(c.opacity,"undefined")&&i.is(f.opacity,"undefined")&&n(h,{opacity:c.opacity}),!i.is(c["fill-opacity"],"undefined")&&i.is(f["fill-opacity"],"undefined")&&n(h,{"fill-opacity":c["fill-opacity"]});w[t]("opacity")&&n(h,{"fill-opacity":w.opacity>1?w.opacity/100:w.opacity});case"stroke":w=i.getRGB(e);h.setAttribute(v,w.hex);v=="stroke"&&w[t]("opacity")&&n(h,{"stroke-opacity":w.opacity>1?w.opacity/100:w.opacity});v=="stroke"&&r._.arrows&&("startString"in r._.arrows&&s(r,r._.arrows.startString),"endString"in r._.arrows&&s(r,r._.arrows.endString,1));break;case"gradient":(r.type=="circle"||r.type=="ellipse"||u(e).charAt()!="r")&&it(r,e);break;case"opacity":c.gradient&&!c[t]("stroke-opacity")&&n(h,{"stroke-opacity":e>1?e/100:e});case"fill-opacity":if(c.gradient){ut=i._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,o));ut&&(ft=ut.getElementsByTagName("stop"),n(ft[ft.length-1],{"stop-opacity":e}));break}default:v=="font-size"&&(e=tt(e,10)+"px");yt=v.replace(/(\-.)/g,function(n){return n.substring(1).toUpperCase()});h.style[yt]=e;r._.dirty=1;h.setAttribute(v,e)}}ot(r,f);h.style.visibility=pt},ut=1.2,ot=function(r,f){var y,h,l,e,a,p,v;if(r.type=="text"&&(f[t]("text")||f[t]("font")||f[t]("font-size")||f[t]("x")||f[t]("y"))){var c=r.attrs,s=r.node,w=s.firstChild?tt(i._g.doc.defaultView.getComputedStyle(s.firstChild,o).getPropertyValue("font-size"),10):10;if(f[t]("text")){for(c.text=f.text;s.firstChild;)s.removeChild(s.firstChild);for(y=u(f.text).split("\n"),h=[],e=0,a=y.length;e<a;e++)l=n("tspan"),e&&n(l,{dy:w*ut,x:c.x}),l.appendChild(i._g.doc.createTextNode(y[e])),s.appendChild(l),h[e]=l}else for(h=s.getElementsByTagName("tspan"),e=0,a=h.length;e<a;e++)e?n(h[e],{dy:w*ut,x:c.x}):n(h[0],{dy:0});n(s,{x:c.x,y:c.y});r._.dirty=1;p=r._getBBox();v=c.y-(p.y+p.height/2);v&&i.is(v,"finite")&&n(h[0],{dy:v})}},h=function(n,t){this[0]=this.node=n;n.raphael=!0;this.id=i._oid++;n.raphaelid=this.id;this.matrix=i.matrix();this.realPath=null;this.paper=t;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};t.bottom||(t.bottom=this);this.prev=t.top;t.top&&(t.top.next=this);t.top=this;this.next=null},r=i.el;h.prototype=r;r.constructor=h;i._engine.path=function(t,i){var u=n("path"),r;return i.canvas&&i.canvas.appendChild(u),r=new h(u,i),r.type="path",g(r,{fill:"none",stroke:"#000",path:t}),r};r.rotate=function(n,t,i){if(this.removed)return this;if(n=u(n).split(l),n.length-1&&(t=f(n[1]),i=f(n[2])),n=f(n[0]),i==null&&(t=i),t==null||i==null){var r=this.getBBox(1);t=r.x+r.width/2;i=r.y+r.height/2}return this.transform(this._.transform.concat([["r",n,t,i]])),this};r.scale=function(n,t,i,r){if(this.removed)return this;if(n=u(n).split(l),n.length-1&&(t=f(n[1]),i=f(n[2]),r=f(n[3])),n=f(n[0]),t==null&&(t=n),r==null&&(i=r),i==null||r==null)var e=this.getBBox(1);return i=i==null?e.x+e.width/2:i,r=r==null?e.y+e.height/2:r,this.transform(this._.transform.concat([["s",n,t,i,r]])),this};r.translate=function(n,t){return this.removed?this:(n=u(n).split(l),n.length-1&&(t=f(n[1])),n=f(n[0])||0,t=+t||0,this.transform(this._.transform.concat([["t",n,t]])),this)};r.transform=function(r){var u=this._,f;return r==null?u.transform:(i._extractTransform(this,r),this.clip&&n(this.clip,{transform:this.matrix.invert()}),this.pattern&&b(this),this.node&&n(this.node,{transform:this.matrix}),(u.sx!=1||u.sy!=1)&&(f=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1,this.attr({"stroke-width":f})),this)};r.hide=function(){return this.removed||this.paper.safari(this.node.style.display="none"),this};r.show=function(){return this.removed||this.paper.safari(this.node.style.display=""),this};r.remove=function(){var n,t;if(!this.removed&&this.node.parentNode){n=this.paper;n.__set__&&n.__set__.exclude(this);p.unbind("raphael.*.*."+this.id);this.gradient&&n.defs.removeChild(this.gradient);i._tear(this,n);this.node.parentNode.tagName.toLowerCase()=="a"?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(t in this)this[t]=typeof this[t]=="function"?i._removedFactory(t):null;this.removed=!0}};r._getBBox=function(){var t,n;this.node.style.display=="none"&&(this.show(),t=!0);n={};try{n=this.node.getBBox()}catch(i){}finally{n=n||{}}return t&&this.hide(),n};r.attr=function(n,r){var e,c,a,s,o,h,f,u,v,y;if(this.removed)return this;if(n==null){e={};for(c in this.attrs)this.attrs[t](c)&&(e[c]=this.attrs[c]);return e.gradient&&e.fill=="none"&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(r==null&&i.is(n,"string")){if(n=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(n=="transform")return this._.transform;for(a=n.split(l),s={},o=0,h=a.length;o<h;o++)n=a[o],s[n]=n in this.attrs?this.attrs[n]:i.is(this.paper.customAttributes[n],"function")?this.paper.customAttributes[n].def:i._availableAttrs[n];return h-1?s:s[a[0]]}if(r==null&&i.is(n,"array")){for(s={},o=0,h=n.length;o<h;o++)s[n[o]]=this.attr(n[o]);return s}r!=null?(f={},f[n]=r):n!=null&&i.is(n,"object")&&(f=n);for(u in f)p("raphael.attr."+u+"."+this.id,this,f[u]);for(u in this.paper.customAttributes)if(this.paper.customAttributes[t](u)&&f[t](u)&&i.is(this.paper.customAttributes[u],"function")){v=this.paper.customAttributes[u].apply(this,[].concat(f[u]));this.attrs[u]=f[u];for(y in v)v[t](y)&&(f[y]=v[y])}return g(this,f),this};r.toFront=function(){if(this.removed)return this;this.node.parentNode.tagName.toLowerCase()=="a"?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var n=this.paper;return n.top!=this&&i._tofront(this,n),this};r.toBack=function(){var n,t;return this.removed?this:(n=this.node.parentNode,n.tagName.toLowerCase()=="a"?n.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):n.firstChild!=this.node&&n.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper),t=this.paper,this)};r.insertAfter=function(n){if(this.removed)return this;var t=n.node||n[n.length-1].node;return t.nextSibling?t.parentNode.insertBefore(this.node,t.nextSibling):t.parentNode.appendChild(this.node),i._insertafter(this,n,this.paper),this};r.insertBefore=function(n){if(this.removed)return this;var t=n.node||n[0].node;return t.parentNode.insertBefore(this.node,t),i._insertbefore(this,n,this.paper),this};r.blur=function(t){var r=this,u,f;return+t!=0?(u=n("filter"),f=n("feGaussianBlur"),r.attrs.blur=t,u.id=i.createUUID(),n(f,{stdDeviation:+t||1.5}),u.appendChild(f),r.paper.defs.appendChild(u),r._blur=u,n(r.node,{filter:"url(#"+u.id+")"})):(r._blur&&(r._blur.parentNode.removeChild(r._blur),delete r._blur,delete r.attrs.blur),r.node.removeAttribute("filter")),r};i._engine.circle=function(t,i,r,u){var e=n("circle"),f;return t.canvas&&t.canvas.appendChild(e),f=new h(e,t),f.attrs={cx:i,cy:r,r:u,fill:"none",stroke:"#000"},f.type="circle",n(e,f.attrs),f};i._engine.rect=function(t,i,r,u,f,e){var s=n("rect"),o;return t.canvas&&t.canvas.appendChild(s),o=new h(s,t),o.attrs={x:i,y:r,width:u,height:f,r:e||0,rx:e||0,ry:e||0,fill:"none",stroke:"#000"},o.type="rect",n(s,o.attrs),o};i._engine.ellipse=function(t,i,r,u,f){var o=n("ellipse"),e;return t.canvas&&t.canvas.appendChild(o),e=new h(o,t),e.attrs={cx:i,cy:r,rx:u,ry:f,fill:"none",stroke:"#000"},e.type="ellipse",n(o,e.attrs),e};i._engine.image=function(t,i,r,u,f,e){var o=n("image"),s;return n(o,{x:r,y:u,width:f,height:e,preserveAspectRatio:"none"}),o.setAttributeNS(a,"href",i),t.canvas&&t.canvas.appendChild(o),s=new h(o,t),s.attrs={x:r,y:u,width:f,height:e,src:i},s.type="image",s};i._engine.text=function(t,r,u,f){var o=n("text"),e;return t.canvas&&t.canvas.appendChild(o),e=new h(o,t),e.attrs={x:r,y:u,"text-anchor":"middle",text:f,font:i._availableAttrs.font,stroke:"none",fill:"#000"},e.type="text",g(e,e.attrs),e};i._engine.setSize=function(n,t){return this.width=n||this.width,this.height=t||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this};i._engine.create=function(){var u=i._getContainer.apply(0,arguments),t=u&&u.container,o=u.x,s=u.y,f=u.width,e=u.height,r,h,c;if(!t)throw new Error("SVG container not found.");return r=n("svg"),h="overflow:hidden;",o=o||0,s=s||0,f=f||512,e=e||342,n(r,{height:e,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),t==1?(r.style.cssText=h+"position:absolute;left:"+o+"px;top:"+s+"px",i._g.doc.body.appendChild(r),c=1):(r.style.cssText=h+"position:relative",t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r)),t=new i._Paper,t.width=f,t.height=e,t.canvas=r,t.clear(),t._left=t._top=0,c&&(t.renderfix=function(){}),t.renderfix(),t};i._engine.setViewBox=function(t,i,r,u,f){p("raphael.setViewBox",this,this._viewBox,[t,i,r,u,f]);var o=k(r/this.width,u/this.height),e=this.top,c=f?"xMidYMid meet":"xMinYMin",s,h;for(t==null?(this._vbSize&&(o=1),delete this._vbSize,s="0 0 "+this.width+w+this.height):(this._vbSize=o,s=t+w+i+w+r+w+u),n(this.canvas,{viewBox:s,preserveAspectRatio:c});o&&e;)h="stroke-width"in e.attrs?e.attrs["stroke-width"]:1,e.attr({"stroke-width":h}),e._.dirty=1,e._.dirtyT=1,e=e.prev;return this._viewBox=[t,i,r,u,!!f],this};i.prototype.renderfix=function(){var n=this.canvas,u=n.style,t,i,r;try{t=n.getScreenCTM()||n.createSVGMatrix()}catch(f){t=n.createSVGMatrix()}i=-t.e%1;r=-t.f%1;(i||r)&&(i&&(this._left=(this._left+i)%1,u.left=this._left+"px"),r&&(this._top=(this._top+r)%1,u.top=this._top+"px"))};i.prototype.clear=function(){i.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null;(this.desc=n("desc")).appendChild(i._g.doc.createTextNode("Created with Raphaël "+i.version));t.appendChild(this.desc);t.appendChild(this.defs=n("defs"))};i.prototype.remove=function(){p("raphael.remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var n in this)this[n]=typeof this[n]=="function"?i._removedFactory(n):null};nt=i.st;for(v in r)r[t](v)&&!nt[t](v)&&(nt[v]=function(n){return function(){var t=arguments;return this.forEach(function(i){i[n].apply(i,t)})}}(v))}}(),function(){var s,d,y;if(i.vml){var h="hasOwnProperty",t=String,f=parseFloat,c=Math,e=c.round,k=c.max,g=c.min,p=c.abs,l="fill",a=/[, ]+/,ut=i.eve,ft=" progid:DXImageTransform.Microsoft",o=" ",u="",nt={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},et=/([clmz]),?([^clmz]*)/gi,ot=/ progid:\S+Blur\([^\)]+\)/g,st=/-?[^,\s-]+/g,tt="position:absolute;left:0;top:0;width:1px;height:1px",n=21600,ht={path:1,rect:1,image:1},ct={circle:1,ellipse:1},lt=function(r){var l=/[ahqstv]/ig,a=i._pathToAbsolute,v,c,y,f,s,w,h,p;if(t(r).match(l)&&(a=i._path2curve),l=/[clmz]/g,a==i._pathToAbsolute&&!t(r).match(l))return t(r).replace(et,function(t,i,r){var u=[],o=i.toLowerCase()=="m",f=nt[i];return r.replace(st,function(t){o&&u.length==2&&(f+=u+nt[i=="m"?"l":"L"],u=[]);u.push(e(t*n))}),f+u});for(c=a(r),v=[],s=0,w=c.length;s<w;s++){for(y=c[s],f=c[s][0].toLowerCase(),f=="z"&&(f="x"),h=1,p=y.length;h<p;h++)f+=e(y[h]*n)+(h!=p-1?",":u);v.push(f)}return v.join(o)},it=function(n,t,r){var u=i.matrix();return u.rotate(-n,.5,.5),{dx:u.x(t,r),dy:u.y(t,r)}},w=function(t,i,r,u,f,e){var v=t._,k=t.matrix,h=v.fillpos,c=t.node,y=c.style,w=1,b="",d=n/i,g=n/r,a,s;(y.visibility="hidden",i&&r)&&(c.coordsize=p(d)+o+p(g),y.rotation=e*(i*r<0?-1:1),e&&(a=it(e,u,f),u=a.dx,f=a.dy),i<0&&(b+="x"),r<0&&(b+=" y")&&(w=-1),y.flip=b,c.coordorigin=u*-d+o+f*-g,(h||v.fillsize)&&(s=c.getElementsByTagName(l),s=s&&s[0],c.removeChild(s),h&&(a=it(e,k.x(h[0],h[1]),k.y(h[0],h[1])),s.position=a.dx*w+o+a.dy*w),v.fillsize&&(s.size=v.fillsize[0]*p(i)+o+v.fillsize[1]*p(r)),c.appendChild(s)),y.visibility="visible")};i.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var rt=function(n,i,r){for(var u=t(i).toLowerCase().split("-"),o=r?"end":"start",f=u.length,s="classic",h="medium",c="medium",e;f--;)switch(u[f]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":s=u[f];break;case"wide":case"narrow":c=u[f];break;case"long":case"short":h=u[f]}e=n.node.getElementsByTagName("stroke")[0];e[o+"arrow"]=s;e[o+"arrowlength"]=h;e[o+"arrowwidth"]=c},v=function(r,c){var yt,nt,ot,ut,ft,y,si,pt,st,tt,d,dt,gt,et,ni,vt,ri,bt,hi;r.attrs=r.attrs||{};var b=r.node,v=r.attrs,it=b.style,ui=ht[r.type]&&(c.x!=v.x||c.y!=v.y||c.width!=v.width||c.height!=v.height||c.cx!=v.cx||c.cy!=v.cy||c.rx!=v.rx||c.ry!=v.ry||c.r!=v.r),ci=ct[r.type]&&(v.cx!=c.cx||v.cy!=c.cy||v.r!=c.r||v.rx!=c.rx||v.ry!=c.ry),p=r;for(yt in c)c[h](yt)&&(v[yt]=c[yt]);if(ui&&(v.path=i._getPath[r.type](r),r._.dirty=1),c.href&&(b.href=c.href),c.title&&(b.title=c.title),c.target&&(b.target=c.target),c.cursor&&(it.cursor=c.cursor),"blur"in c&&r.blur(c.blur),(c.path&&r.type=="path"||ui)&&(b.path=lt(~t(v.path).toLowerCase().indexOf("r")?i._pathToAbsolute(v.path):v.path),r.type=="image"&&(r._.fillpos=[v.x,v.y],r._.fillsize=[v.width,v.height],w(r,1,1,0,0,0))),"transform"in c&&r.transform(c.transform),ci){var kt=+v.cx,fi=+v.cy,ei=+v.rx||+v.r||0,oi=+v.ry||+v.r||0;b.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",e((kt-ei)*n),e((fi-oi)*n),e((kt+ei)*n),e((fi+oi)*n),e(kt*n));r._.dirty=1}if("clip-rect"in c&&(nt=t(c["clip-rect"]).split(a),nt.length==4&&(nt[2]=+nt[2]+ +nt[0],nt[3]=+nt[3]+ +nt[1],ot=b.clipRect||i._g.doc.createElement("div"),ut=ot.style,ut.clip=i.format("rect({1}px {2}px {3}px {0}px)",nt),b.clipRect||(ut.position="absolute",ut.top=0,ut.left=0,ut.width=r.paper.width+"px",ut.height=r.paper.height+"px",b.parentNode.insertBefore(ot,b),ot.appendChild(b),b.clipRect=ot)),c["clip-rect"]||b.clipRect&&(b.clipRect.style.clip="auto")),r.textpath&&(ft=r.textpath.style,c.font&&(ft.font=c.font),c["font-family"]&&(ft.fontFamily='"'+c["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,u)+'"'),c["font-size"]&&(ft.fontSize=c["font-size"]),c["font-weight"]&&(ft.fontWeight=c["font-weight"]),c["font-style"]&&(ft.fontStyle=c["font-style"])),"arrow-start"in c&&rt(p,c["arrow-start"]),"arrow-end"in c&&rt(p,c["arrow-end"],1),(c.opacity!=null||c["stroke-width"]!=null||c.fill!=null||c.src!=null||c.stroke!=null||c["stroke-width"]!=null||c["stroke-opacity"]!=null||c["fill-opacity"]!=null||c["stroke-dasharray"]!=null||c["stroke-miterlimit"]!=null||c["stroke-linejoin"]!=null||c["stroke-linecap"]!=null)&&(y=b.getElementsByTagName(l),si=!1,y=y&&y[0],y||(si=y=s(l)),r.type=="image"&&c.src&&(y.src=c.src),c.fill&&(y.on=!0),(y.on==null||c.fill=="none"||c.fill===null)&&(y.on=!1),y.on&&c.fill&&(pt=t(c.fill).match(i._ISURL),pt?(y.parentNode==b&&b.removeChild(y),y.rotate=!0,y.src=pt[1],y.type="tile",st=r.getBBox(1),y.position=st.x+o+st.y,r._.fillpos=[st.x,st.y],i._preload(pt[1],function(){r._.fillsize=[this.offsetWidth,this.offsetHeight]})):(y.color=i.getRGB(c.fill).hex,y.src=u,y.type="solid",i.getRGB(c.fill).error&&(p.type in{circle:1,ellipse:1}||t(c.fill).charAt()!="r")&&at(p,c.fill,y)&&(v.fill="none",v.gradient=c.fill,y.rotate=!1))),("fill-opacity"in c||"opacity"in c)&&(tt=((+v["fill-opacity"]+1||2)-1)*((+v.opacity+1||2)-1)*((+i.getRGB(c.fill).o+1||2)-1),tt=g(k(tt,0),1),y.opacity=tt,y.src&&(y.color="none")),b.appendChild(y),d=b.getElementsByTagName("stroke")&&b.getElementsByTagName("stroke")[0],dt=!1,d||(dt=d=s("stroke")),(c.stroke&&c.stroke!="none"||c["stroke-width"]||c["stroke-opacity"]!=null||c["stroke-dasharray"]||c["stroke-miterlimit"]||c["stroke-linejoin"]||c["stroke-linecap"])&&(d.on=!0),(c.stroke=="none"||c.stroke===null||d.on==null||c.stroke==0||c["stroke-width"]==0)&&(d.on=!1),gt=i.getRGB(c.stroke),d.on&&c.stroke&&(d.color=gt.hex),tt=((+v["stroke-opacity"]+1||2)-1)*((+v.opacity+1||2)-1)*((+gt.o+1||2)-1),et=(f(c["stroke-width"])||1)*.75,tt=g(k(tt,0),1),c["stroke-width"]==null&&(et=v["stroke-width"]),c["stroke-width"]&&(d.weight=et),et&&et<1&&(tt*=et)&&(d.weight=1),d.opacity=tt,c["stroke-linejoin"]&&(d.joinstyle=c["stroke-linejoin"]||"miter"),d.miterlimit=c["stroke-miterlimit"]||8,c["stroke-linecap"]&&(d.endcap=c["stroke-linecap"]=="butt"?"flat":c["stroke-linecap"]=="square"?"square":"round"),"stroke-dasharray"in c&&(ni={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},d.dashstyle=ni[h](c["stroke-dasharray"])?ni[c["stroke-dasharray"]]:u),dt&&b.appendChild(d)),p.type=="text"){p.paper.canvas.style.display=u;var ti=p.paper.span,ii=100,wt=v.font&&v.font.match(/\d+(?:\.\d*)?(?=px)/);for(it=ti.style,v.font&&(it.font=v.font),v["font-family"]&&(it.fontFamily=v["font-family"]),v["font-weight"]&&(it.fontWeight=v["font-weight"]),v["font-style"]&&(it.fontStyle=v["font-style"]),wt=f(v["font-size"]||wt&&wt[0])||10,it.fontSize=wt*ii+"px",p.textpath.string&&(ti.innerHTML=t(p.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>")),vt=ti.getBoundingClientRect(),p.W=v.w=(vt.right-vt.left)/ii,p.H=v.h=(vt.bottom-vt.top)/ii,p.X=v.x,p.Y=v.y+p.H/2,(("x"in c)||("y"in c))&&(p.path.v=i.format("m{0},{1}l{2},{1}",e(v.x*n),e(v.y*n),e(v.x*n)+1)),ri=["x","y","text","font","font-family","font-weight","font-style","font-size"],bt=0,hi=ri.length;bt<hi;bt++)if(ri[bt]in c){p._.dirty=1;break}switch(v["text-anchor"]){case"start":p.textpath.style["v-text-align"]="left";p.bbx=p.W/2;break;case"end":p.textpath.style["v-text-align"]="right";p.bbx=-p.W/2;break;default:p.textpath.style["v-text-align"]="center";p.bbx=0}p.textpath.style["v-text-kern"]=!0}},at=function(n,r,e){var l,s,a,h,w;n.attrs=n.attrs||{};var b=n.attrs,v=Math.pow,y="linear",p=".5 .5";if((n.attrs.gradient=r,r=t(r).replace(i._radial_gradient,function(n,t,i){return y="radial",t&&i&&(t=f(t),i=f(i),v(t-.5,2)+v(i-.5,2)>.25&&(i=c.sqrt(.25-v(t-.5,2))*((i>.5)*2-1)+.5),p=t+o+i),u}),r=r.split(/\s*\-\s*/),y=="linear"&&(l=r.shift(),l=-f(l),isNaN(l)))||(s=i._parseDots(r),!s))return null;if(n=n.shape||n.node,s.length){for(n.removeChild(e),e.on=!0,e.method="none",e.color=s[0].color,e.color2=s[s.length-1].color,a=[],h=0,w=s.length;h<w;h++)s[h].offset&&a.push(s[h].offset+o+s[h].color);e.colors=a.length?a.join():"0% "+e.color;y=="radial"?(e.type="gradientTitle",e.focus="100%",e.focussize="0 0",e.focusposition=p,e.angle=0):(e.type="gradient",e.angle=(270-l)%360);n.appendChild(e)}return 1},b=function(n,t){this[0]=this.node=n;n.raphael=!0;this.id=i._oid++;n.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=t;this.matrix=i.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};t.bottom||(t.bottom=this);this.prev=t.top;t.top&&(t.top.next=this);t.top=this;this.next=null},r=i.el;b.prototype=r;r.constructor=b;r.transform=function(r){var e,a,l;if(r==null)return this._.transform;e=this.paper._viewBoxShift;a=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:u;e&&(l=r=t(r).replace(/\.{3}|\u2026/g,this._.transform||u));i._extractTransform(this,a+r);var s=this.matrix.clone(),h=this.skew,c=this.node,f,v=~t(this.attrs.fill).indexOf("-"),d=!t(this.attrs.fill).indexOf("url(");if(s.translate(1,1),d||v||this.type=="image")if(h.matrix="1 0 0 1",h.offset="0 0",f=s.split(),v&&f.noRotation||!f.isSimple){c.style.filter=s.toFilter();var y=this.getBBox(),p=this.getBBox(1),b=y.x-p.x,k=y.y-p.y;c.coordorigin=b*-n+o+k*-n;w(this,1,1,b,k,0)}else c.style.filter=u,w(this,f.scalex,f.scaley,f.dx,f.dy,f.rotate);else c.style.filter=u,h.matrix=t(s),h.offset=s.offset();return l&&(this._.transform=l),this};r.rotate=function(n,i,r){if(this.removed)return this;if(n!=null){if(n=t(n).split(a),n.length-1&&(i=f(n[1]),r=f(n[2])),n=f(n[0]),r==null&&(i=r),i==null||r==null){var u=this.getBBox(1);i=u.x+u.width/2;r=u.y+u.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",n,i,r]])),this}};r.translate=function(n,i){return this.removed?this:(n=t(n).split(a),n.length-1&&(i=f(n[1])),n=f(n[0])||0,i=+i||0,this._.bbox&&(this._.bbox.x+=n,this._.bbox.y+=i),this.transform(this._.transform.concat([["t",n,i]])),this)};r.scale=function(n,i,r,u){if(this.removed)return this;if(n=t(n).split(a),n.length-1&&(i=f(n[1]),r=f(n[2]),u=f(n[3]),isNaN(r)&&(r=null),isNaN(u)&&(u=null)),n=f(n[0]),i==null&&(i=n),u==null&&(r=u),r==null||u==null)var e=this.getBBox(1);return r=r==null?e.x+e.width/2:r,u=u==null?e.y+e.height/2:u,this.transform(this._.transform.concat([["s",n,i,r,u]])),this._.dirtyT=1,this};r.hide=function(){return this.removed||(this.node.style.display="none"),this};r.show=function(){return this.removed||(this.node.style.display=u),this};r._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}};r.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this);i.eve.unbind("raphael.*.*."+this.id);i._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var n in this)this[n]=typeof this[n]=="function"?i._removedFactory(n):null;this.removed=!0}};r.attr=function(n,t){var f,c,y,o,e,s,r,u,p,w;if(this.removed)return this;if(n==null){f={};for(c in this.attrs)this.attrs[h](c)&&(f[c]=this.attrs[c]);return f.gradient&&f.fill=="none"&&(f.fill=f.gradient)&&delete f.gradient,f.transform=this._.transform,f}if(t==null&&i.is(n,"string")){if(n==l&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;for(y=n.split(a),o={},e=0,s=y.length;e<s;e++)n=y[e],o[n]=n in this.attrs?this.attrs[n]:i.is(this.paper.customAttributes[n],"function")?this.paper.customAttributes[n].def:i._availableAttrs[n];return s-1?o:o[y[0]]}if(this.attrs&&t==null&&i.is(n,"array")){for(o={},e=0,s=n.length;e<s;e++)o[n[e]]=this.attr(n[e]);return o}t!=null&&(r={},r[n]=t);t==null&&i.is(n,"object")&&(r=n);for(u in r)ut("raphael.attr."+u+"."+this.id,this,r[u]);if(r){for(u in this.paper.customAttributes)if(this.paper.customAttributes[h](u)&&r[h](u)&&i.is(this.paper.customAttributes[u],"function")){p=this.paper.customAttributes[u].apply(this,[].concat(r[u]));this.attrs[u]=r[u];for(w in p)p[h](w)&&(r[w]=p[w])}r.text&&this.type=="text"&&(this.textpath.string=r.text);v(this,r)}return this};r.toFront=function(){return this.removed||this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&i._tofront(this,this.paper),this};r.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper)),this)};r.insertAfter=function(n){return this.removed?this:(n.constructor==i.st.constructor&&(n=n[n.length-1]),n.node.nextSibling?n.node.parentNode.insertBefore(this.node,n.node.nextSibling):n.node.parentNode.appendChild(this.node),i._insertafter(this,n,this.paper),this)};r.insertBefore=function(n){return this.removed?this:(n.constructor==i.st.constructor&&(n=n[0]),n.node.parentNode.insertBefore(this.node,n.node),i._insertbefore(this,n,this.paper),this)};r.blur=function(n){var t=this.node.runtimeStyle,r=t.filter;return r=r.replace(ot,u),+n!=0?(this.attrs.blur=n,t.filter=r+o+ft+".Blur(pixelradius="+(+n||1.5)+")",t.margin=i.format("-{0}px 0 0 -{0}px",e(+n||1.5))):(t.filter=r,t.margin=0,delete this.attrs.blur),this};i._engine.path=function(t,i){var f=s("shape"),r,h,e;return f.style.cssText=tt,f.coordsize=n+o+n,f.coordorigin=i.coordorigin,r=new b(f,i),h={fill:"none",stroke:"#000"},t&&(h.path=t),r.type="path",r.path=[],r.Path=u,v(r,h),i.canvas.appendChild(f),e=s("skew"),e.on=!0,f.appendChild(e),r.skew=e,r.transform(u),r};i._engine.rect=function(n,t,r,u,f,e){var h=i._rectPath(t,r,u,f,e),o=n.path(h),s=o.attrs;return o.X=s.x=t,o.Y=s.y=r,o.W=s.width=u,o.H=s.height=f,s.r=e,s.path=h,o.type="rect",o};i._engine.ellipse=function(n,t,i,r,u){var f=n.path(),e=f.attrs;return f.X=t-r,f.Y=i-u,f.W=r*2,f.H=u*2,f.type="ellipse",v(f,{cx:t,cy:i,rx:r,ry:u}),f};i._engine.circle=function(n,t,i,r){var u=n.path(),f=u.attrs;return u.X=t-r,u.Y=i-r,u.W=u.H=r*2,u.type="circle",v(u,{cx:t,cy:i,r:r}),u};i._engine.image=function(n,t,r,u,f,e){var a=i._rectPath(r,u,f,e),o=n.path(a).attr({stroke:"none"}),s=o.attrs,c=o.node,h=c.getElementsByTagName(l)[0];return s.src=t,o.X=s.x=r,o.Y=s.y=u,o.W=s.width=f,o.H=s.height=e,s.path=a,o.type="image",h.parentNode==c&&c.removeChild(h),h.rotate=!0,h.src=t,h.type="tile",o._.fillpos=[r,u],o._.fillsize=[f,e],c.appendChild(h),w(o,1,1,0,0,0),o};i._engine.text=function(r,f,h,c){var a=s("shape"),y=s("path"),p=s("textpath"),l,k,w;return f=f||0,h=h||0,c=c||"",y.v=i.format("m{0},{1}l{2},{1}",e(f*n),e(h*n),e(f*n)+1),y.textpathok=!0,p.string=t(c),p.on=!0,a.style.cssText=tt,a.coordsize=n+o+n,a.coordorigin="0 0",l=new b(a,r),k={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:c},l.shape=a,l.path=y,l.textpath=p,l.type="text",l.attrs.text=t(c),l.attrs.x=f,l.attrs.y=h,l.attrs.w=1,l.attrs.h=1,v(l,k),a.appendChild(p),a.appendChild(y),r.canvas.appendChild(a),w=s("skew"),w.on=!0,a.appendChild(w),l.skew=w,l.transform(u),l};i._engine.setSize=function(n,t){var r=this.canvas.style;return this.width=n,this.height=t,n==+n&&(n+="px"),t==+t&&(t+="px"),r.width=n,r.height=t,r.clip="rect(0 "+n+" "+t+" 0)",this._viewBox&&i._engine.setViewBox.apply(this,this._viewBox),this};i._engine.setViewBox=function(n,t,r,u,f){i.eve("raphael.setViewBox",this,this._viewBox,[n,t,r,u,f]);var e=this.width,o=this.height,c=1/k(r/e,u/o),s,h;return f&&(s=o/u,h=e/r,r*s<e&&(n-=(e-r*s)/2/s),u*h<o&&(t-=(o-u*h)/2/h)),this._viewBox=[n,t,r,u,!!f],this._viewBoxShift={dx:-n,dy:-t,scale:c},this.forEach(function(n){n.transform("...")}),this};i._engine.initWin=function(n){var t=n.document;t.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{t.namespaces.rvml||t.namespaces.add("rvml","urn:schemas-microsoft-com:vml");s=function(n){return t.createElement("<rvml:"+n+' class="rvml">')}}catch(i){s=function(n){return t.createElement("<"+n+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}};i._engine.initWin(i._g.win);i._engine.create=function(){var e=i._getContainer.apply(0,arguments),f=e.container,r=e.height,u=e.width,c=e.x,l=e.y;if(!f)throw new Error("VML container not found.");var t=new i._Paper,s=t.canvas=i._g.doc.createElement("div"),h=s.style;return c=c||0,l=l||0,u=u||512,r=r||342,t.width=u,t.height=r,u==+u&&(u+="px"),r==+r&&(r+="px"),t.coordsize=n*1e3+o+n*1e3,t.coordorigin="0 0",t.span=i._g.doc.createElement("span"),t.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",s.appendChild(t.span),h.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",u,r),f==1?(i._g.doc.body.appendChild(s),h.left=c+"px",h.top=l+"px",h.position="absolute"):f.firstChild?f.insertBefore(s,f.firstChild):f.appendChild(s),t.renderfix=function(){},t};i.prototype.clear=function(){i.eve("raphael.clear",this);this.canvas.innerHTML=u;this.span=i._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};i.prototype.remove=function(){i.eve("raphael.remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var n in this)this[n]=typeof this[n]=="function"?i._removedFactory(n):null;return!0};d=i.st;for(y in r)r[h](y)&&!d[h](y)&&(d[y]=function(n){return function(){var t=arguments;return this.forEach(function(i){i[n].apply(i,t)})}}(y))}}(),wi.was?r.win.Raphael=i:Raphael=i,i});
(function(n){Raphael.fn.nestedSVG=function(t,i,r){function o(f,e){var s,h=u.set(e),o=new Raphael(t,i,r);return o.canvas.setAttribute("x",0),o.canvas.setAttribute("y",0),u.canvas.appendChild(o.canvas),s={move:function(n,t){o.canvas.setAttribute("x",n);o.canvas.setAttribute("y",t)}},n.extend(o,s),o}var u=this,f=arguments[0]instanceof Array?{}:arguments[0],e=arguments[0]instanceof Array?arguments[0]:arguments[1];return o(f,e)}})(jQuery);
(function(){Raphael.fn.marker=function(){function r(t,i){var f=n.set(i),r=n.raphael.vml?document.createElement("marker"):document.createElementNS("http://www.w3.org/2000/svg","marker"),u=n.path("M2,2 L2,10 L10,6 L2,2");return u.node.setAttribute("fill","black"),n.defs.appendChild(r),r.appendChild(u.node),{scale:function(n,t){var i=r.getAttribute("transform");return r.attr("transform",updateScale(i,n,t)),this},move:function(n,t){r.setAttribute("x",n);r.setAttribute("y",t)},attr:function(n,t){r.setAttribute(n,t)},attrs:function(n){for(var t in n)r.setAttribute(t,n[t])},type:"marker",node:r}}var n=this,t=arguments[0]instanceof Array?{}:arguments[0],i=arguments[0]instanceof Array?arguments[0]:arguments[1];return r(t,i)}})(jQuery);
(function(n){Raphael.fn.group=function(){function u(i,r){var u,e=t.set(r),f=t.raphael.vml?document.createElement("group"):document.createElementNS("http://www.w3.org/2000/svg","g");return t.canvas.appendChild(f),f.canvas=f,u={setScale:function(n){return t.raphael.vml?this.forEach(function(t){var i=t.data("rotation")||0;t.transform("S"+n+","+n+", 0, 0, r"+i)}):f.setAttribute("transform","scale("+n+")"),this},getScale:function(){var n=f.getAttribute("transform");return n===null&&(n="scale(1)"),n.replace("scale(","").replace(")","")}},n.extend(u,t),u.scale=u.setScale,u.canvas=f,u[0]=f,u.type="group",u.node=f,u}var t=this,i=arguments[0]instanceof Array?{}:arguments[0],r=arguments[0]instanceof Array?arguments[0]:arguments[1];return u(i,r)}})(jQuery);
(function(n){n.widget("diagram.activityMap",{options:{width:100,height:100,format:{},spaceInterLine:110,verticalPadding:50,background:{lineColor:"#D8D8D8"},activities:{},legendProcess:{},showByTime:!1,timeWindowInterval:2e3,cssClass:"activity-map-tooltip activity-map-activity-default-status",cssClassHighlight:"activity-map-tooltip activity-map-activity-highlight",colorCurrentActivity:"rgba(255, 0, 0, 0.2)",colorList:"#FEC107,#FF5521,#795549,#0173BF,#7cb5ec,#434348,#90ed7d,#f7a35c,#8085e9,#f15c80,#e4d354,#2b908f,#F44236,#E91D62,#9C26B0,#6739B6,#3E50B4,#01BBD4,#019587,#4BAF4F,#8BC24A".split(","),data:{},currentActivity:""},_create:function(){var t=this,i=this.options,u=i.data||{},c=t.element.context.id||"body",l=n("<div id='legend-box'><\/div>"),r,e,o;n(t.element.parent()).prepend(l);t._stickPath=!1;t._stickActivity="";t.activitiesPositionReference={};t.nodePosition={};t.mouseEventHelper={hover:function(n,t,i){var r=!1;n.hover(function(n){r||(t(n),r=!0)},function(n){i(n);r=!1})}};this.diagram=Raphael(c,i.width,i.height);var f=t._mapProcessListWithColors(t._getProcessList(u.processes),i.colorList),a=t._getLegendProcess({paper:"#legend-box",processList:f});n(this.diagram.canvas).append();r=t.sortWorkItemsByDate(u.activities);e=t._getUniqueTimeReference(r);t.dateColumnsPosition=t._drawBackgroundDateColumns({paper:this.diagram,dateList:e,positionX:0,spaceInterLine:i.spaceInterLine,lineColor:i.background.lineColor});o=t._drawActivities({paper:this.diagram,activityList:t._getActivityTree(r),processList:f,positionX:i.spaceInterLine/2,positionY:80,spaceInterLine:i.spaceInterLine,verticalPadding:50,circleRadius:10,textPosition:"top",cssClass:i.cssClass,cssClassHighlight:i.cssClassHighlight,attributes:{"font-size":"11"}});t.lines=t._drawActivityLines({paper:this.diagram,activitiesPositionReference:o,attributes:{}});t._viewBoxWidth=t.element.outerWidth();t._viewBoxHeight=t.element.outerHeight();t.viewBox=this.diagram.setViewBox(-1,-1,t._viewBoxWidth,t._viewBoxHeight);t.viewBox.X=0;t.viewBox.Y=0;var s=t.diagram.canvas.getBBox&&t.diagram.canvas.getBBox()&&t.diagram.canvas.getBBox().width?t.diagram.canvas.getBBox().width:t.diagram.canvas.attributes.width,h=t.diagram.canvas.getBBox&&t.diagram.canvas.getBBox()&&t.diagram.canvas.getBBox().height?t.diagram.canvas.getBBox().height:t.diagram.canvas.attributes.height,v=t.element.outerWidth()>s?t.element.outerWidth():s+25,y=t.element.outerHeight()>h?t.element.outerHeight():h;t._configureHandlers()},_configureHandlers:function(){var n=this,u,f,t=!1,i=0,r=0;n.element.bind("zoom",function(t,i){n._zoom(i)});n.element.mousedown(function(i){n.diagram.getElementByPoint(i.pageX,i.pageY)==null&&(t=!0,u=i.pageX,f=i.pageY)});n.element.mousemove(function(e){if(t!=!1){i=u-e.pageX;r=f-e.pageY;var o=n._viewBoxWidth/n.element.outerWidth(),s=n._viewBoxHeight/n.element.outerHeight();i*=o;r*=s;n.diagram.setViewBox(n.viewBox.X+i,n.viewBox.Y+r,n._viewBoxWidth,n._viewBoxHeight)}});n.element.mouseup(function(){t!=!1&&(n.viewBox.X+=i,n.viewBox.Y+=r,t=!1)})},_zoom:function(n){var t=this.element.outerHeight(),i=this.element.outerWidth();n=parseFloat(n);this._viewBoxWidth=i*(2-n);this._viewBoxHeight=t*(2-n);this.diagram.setViewBox(this.viewBox.X,this.viewBox.Y,this._viewBoxWidth,this._viewBoxHeight)},_circleCollision:function(n,t,i,r,u,f){var e={radius:i,x:n,y:t},o={radius:f,x:r,y:u},s=e.x-o.x,h=e.y-o.y,c=Math.sqrt(s*s+h*h);return c<e.radius+o.radius},_hasNodeCollision:function(t,i,r,u){u=u||[];r=r||"";var f=!1,e=20,o=this;return n.each(u,function(n,u){u.rendered&&r!=u.guidWorkitem&&o._circleCollision(u.x,u.y,e,t,i,e)&&(f=!0)}),f},_getLegendProcess:function(t){var f=this,r=t.processList||{},i,u=n("<div><\/div>");n.each(r,function(t,r){i=n('<div class="activity-map-legend-row"><a class="activity-map-legend-row-process"><\/a><span class="activity-map-legend-row-label">'+r.name+"<\/span><\/div>");i.find(".activity-map-legend-row-process").css({"background-color":r.color,"border-color":r.color});i.data({guidProcess:t});u.append(i)});Object.keys(r).length>1&&n(t.paper).append('<h2 class="activity-map-legend-title">Processes<\/h2>');n(t.paper).append(u);f.element.bind("activity.mouseenter",function(t,i){n(".activity-map-legend-row").filter(function(){return n(this).data("guidProcess")==i.guidProcess}).each(function(){n(this).addClass("activity-map-highlight")})}).bind("activity.mouseleave",function(){n(".activity-map-highlight").removeClass("activity-map-highlight")})},_getProcessList:function(n){return n||{}},_mapProcessListWithColors:function(t,i){var u={},r;return t=t||[],i=i||[],n.each(t,function(n,t){r=r&&r.length>0?r:i.slice(0);u[n]={name:t,color:r.pop()}}),u},_getActivityList:function(n){return n||{}},_getActivityTree:function(t){var i=[],r;return t=t||{},r=function(i,r){var u=[];return i=i||"",n.each(t,function(n,t){typeof t[i]!="undefined"&&t[i]==r&&(t.referenced=!0,u.push(t))}),u},n.each(t,function(n,t){t.children=r("parentWorkItem",t.guidWorkitem);i.push(t)}),i},_addNodePosition:function(n,t){n=n||"";this.nodePosition[n]=t},_getNodePosition:function(n){return n?this.nodePosition[n]:this.nodePosition},_getActivityPositionEngine:function(n){var i=n.activity,r=n.previousActivity,t={x:n.positionX||10,y:n.positionY||10},e=n.verticalPadding||20,h=n.spaceInterLine||50,o=n.activityList||[],f,u,s;return r?(f=this._getColumnPositionByGuidWorkItem(i.guidWorkitem),u=function(n){t.y=n?n.y:t.y;t.y=t.y+e},r.guidProcess==i.guidProcess&&r.idCase==i.idCase&&i.parentWorkItem==r.guidWorkitem?this._hasNodeCollision(f,t.y,i.guidWorkitem,o)&&u():r.parentWorkItem==i.parentWorkItem?u():(s=this._getNodePosition(i.parentWorkItem),u()),t.x=f,t):t},_sortWorkItemsByParentGuidProcess:function(n,t){n=n||[];try{n.sort(function(n,i){return n.guidProcess==t?-1:i.guidProcess==t?1:0})}catch(i){i.toString()}return n},sortWorkItemsByDate:function(n){n=n||[];var r,u,t,i;try{n.sort(function(n,f){return r=new Date(n.creationDate),u=new Date(f.creationDate),t=r.getTime(),i=u.getTime(),t<i?-1:t>i?1:0})}catch(f){f.toString()}return n},_getUniqueTimeReference:function(t){t=t||{};var i={},f,r,u=0,e=this.options.timeWindowInterval;return n.each(t,function(n,t){var o;f=new Date(t.creationDate);r?f.getTime()<u+e?i[r].push(t):(i[t.creationDate]=[],i[t.creationDate].push(t),r=t.creationDate,o=new Date(t.creationDate),u=o.getTime()):(i[t.creationDate]=[],i[t.creationDate].push(t),r=t.creationDate,o=new Date(t.creationDate),u=o.getTime())}),i},_getColumnPositionByGuidWorkItem:function(t){var r=this,i=0;return t=t||"",n.each(r.dateColumnsPosition,function(n,r){n==t&&(i=r)}),i},_drawBackgroundDateColumns:function(t){var a=t.dateList||[],u=t.paper||Raphael("body",0,0),v={x:t.positionX||0},i,f,e,o,r,s={},y="M%d,%d L%d,%d",h=t.spaceInterLine||50,p=t.lineColor||"#000000",c=this.diagram.canvas.getBBox&&this.diagram.canvas.getBBox()&&this.diagram.canvas.getBBox().height?this.diagram.canvas.getBBox().height:this.diagram.canvas.attributes.height,w=this.element.outerHeight()>c?this.element.outerHeight()+150:c+150,l=0;return n.each(a,function(t,c){var a,b,k;i=i?i:n.extend(!0,{},v);f=new Date(t);e=n.datepicker.formatDate("M, dd",f);o=t.split(" ")[1];r=i.x+h/2;l>0&&(a=u.path(printf(y,i.x,0,i.x,w)).attr({stroke:p,"stroke-width":"1px","stroke-opacity":.4}),n(a.node).addClass("activity-map-background-line"));b=u.text(r,10,e).attr({"font-size":"20px"});b.node.setAttribute("class","activity-map-activity-date");k=u.text(r,30,o).attr({"font-size":"16px"});k.node.setAttribute("class","activity-map-activity-time");n.each(c,function(n,t){s[t.guidWorkitem]=r});i.x=i.x+h;l+=1}),s},_drawActivities:function(t){var i=this,f=t.paper||Raphael("body",0,0),l=t.activityList||[],y=t.textPosition||"top",p={x:t.positionX||0,y:t.positionY||10},w=t.processList||{},b=t.verticalPadding||20,k=t.spaceInterLine||50,e=t.circleRadius||10,o=e*2,u,r,s,a,d=t.attributes||{},g=t.cssClass||"",c=f.set(),v=function(t){t.rendered||(u=u?u:n.extend(!0,{},p),u=i._getActivityPositionEngine({previousActivity:a,activity:t,positionX:u.x,positionY:u.y,verticalPadding:b,spaceInterLine:k,activityList:l}),t.x=u.x,t.y=u.y,nt(u,t),t.children.length>0&&(t.children=i._sortWorkItemsByParentGuidProcess(t.children,t.guidProcess),n.each(t.children,function(n,t){v(t)})))},h=function(n,t){n.data({guidProcess:t.guidProcess,guidWorkitem:t.guidWorkitem,idCase:t.idCase,idWorkflow:t.idWorkFlow})},nt=function(t,u){var o,l;return s=w[u.guidProcess].color,o=f.circle(t.x,t.y,e).attr({fill:s,stroke:s}),h(n(o.node),u),h(o,u),o.toFront(),i.options.currentActivity==u.idCase&&(l=f.circle(t.x,t.y,e+5).attr({fill:i.options.colorCurrentActivity,stroke:i.options.colorCurrentActivity}),h(n(l.node),u),h(l,u),l.toBack(),c.push(l)),o.node.setAttribute("class",g),c.push(o),o.hover(function(){var t=this.data();i.element.trigger("activity.mouseenter",[t]);i._stickPath||(n(this.node).addClass("activity-map-activity-highlight"),i._highlight({guidWorkitem:t.guidWorkitem,highlight:!0}))},function(){var t=this.data();i.element.trigger("activity.mouseleave",[t]);i._stickPath||(n(this.node).removeClass("activity-map-activity-highlight"),i._highlight({guidWorkitem:t.guidWorkitem,highlight:!1}))}).click(function(){var n=this.data();i._stickAllPath(n.guidWorkitem)}),n("#bz-activity-map").mouseover(function(){n(".activity-map-tooltip").mouseout()}),r=tt(u.name,t,u.guidWorkitem,u.creationDate),i._addNodePosition(u.guidWorkitem,{positionReference:t,positionReferenceText:r,color:s,parentWorkItem:u.parentWorkItem,circleRadius:e}),a=u,u.rendered=!0,t},tt=function(t,i){switch(y){case"top":r={x:i.x,y:i.y-o};break;case"bottom":r={x:i.x,y:i.y+o};break;case"left":r={x:i.x-o,y:i.y,"text-anchor":"end"};break;case"right":r={x:i.x+o,y:i.y,"text-anchor":"start"}}return r=n.extend({fill:"#3E5664"},d,r),f.text(r.x,r.y,t+" ").attr(r),r};return n.each(l,function(n,t){v(t)}),i.activities=c,f.setFinish(),i._getNodePosition()},_stickAllPath:function(n){var t=this;t._stickPath=t._stickActivity!=""&&t._stickActivity!==n?!0:!t._stickPath;t._stickActivity=n;t.activities.items.forEach(function(i){i.data("guidWorkitem")!==n&&i.node.setAttribute("class",t.options.cssClass)});t.lines.items.forEach(function(n){n.data("visible")?(n.toBack(),n.node.setAttribute("class",t.options.cssClass)):n.toFront()});t._highlight({guidWorkitem:n,highlight:t._stickPath})},_highlight:function(n){var t=this,i;n.guidWorkitem&&(i=n.highlight||!1,t.activities&&t.activities.items.forEach(function(r){r.data("guidWorkitem")==n.guidWorkitem&&(i?r.node.setAttribute("class",t.options.cssClassHighlight):r.node.setAttribute("class",t.options.cssClass))}),t.lines&&t.lines.items.filter(function(t){return t.data("workItem")==n.guidWorkitem&&t.data("visible")}).forEach(function(n){i?(n.toFront(),n.node.setAttribute("class",t.options.cssClassHighlight)):(n.toBack(),n.node.setAttribute("class",t.options.cssClass));t._highlight({guidWorkitem:n.data("parentWorkItem"),highlight:i})}))},_getPath:function(t,i){var e,o=[],s,f,h=0;t=t||"";i=i||[];var r=[],u=5,c=u*2;return n.each(i,function(n,i){i.maxY<t.maxY&&i.maxY>t.minY&&i.minX<t.minX&&i.maxX>t.minX&&o.push(i.strPath)}),o.length>0?(e=Raphael.pathIntersection(t.strPath,o),n.each(e,function(n,i){s=n==0?t.minY:e[n-1].y+u;f=i.y-u;r.push(printf("M%d,%d L%d,%d",t.minX,s,t.minX,f));r.push(printf("M%d,%d A%d,%d 0 0,%d %d,%d",t.minX,f,u,u,h,t.minX,f+c))}),r.push(printf("L%d,%d L%d,%d",t.minX,t.maxY,t.maxX,t.maxY))):r.push(t.strPath),r},_drawActivityLines:function(t){var u=this,h=t.paper||Raphael("body",0,0),a=t.activitiesPositionReference||{},w="M%d,%d L%d,%d L%d,%d",v,i,f,r,c,e,o,y=3,s=t.circleRadius||10,p=t.attributes||{},b=[],l;return p=n.extend(p,{"arrow-end":"classic-wide-long","stroke-linejoin":"round"}),l=h.set(),n.each(a,function(n,t){var g,d,k;t.parentWorkItem!=""&&a[t.parentWorkItem]&&(v=a[t.parentWorkItem],i=v.positionReference,v.positionReference.y==t.positionReference.y?(r=i.x+s,c=t.positionReference.x-s-y,e=i.y,o=t.positionReference.y,f=printf(w,r,e,c,o)):i.x==t.positionReference.x?(r=i.x,e=i.y+s,o=t.positionReference.y-s-y,f=printf("M%d,%d L%d,%d",r,e,r,o)):(r=i.x,c=t.positionReference.x-s-y,e=i.y+s,o=t.positionReference.y,f=printf(w,r,e,i.x,t.positionReference.y,c,o)),g={strPath:f,minX:r,maxX:c,minY:e,maxY:o},f=u._getPath(g,b,h),b.push(g),d=h.path(f).attr(p).toBack(),d.data({workItem:n,parentWorkItem:t.parentWorkItem,visible:!0}),d.node.setAttribute("class","activity-map-connector"),d.node.setAttribute("stroke","#7cb5ec"),k=h.path(f).attr({"stroke-opacity":0,"stroke-width":15}),k.data({workItem:n,parentWorkItem:t.parentWorkItem,visible:!1}),u.mouseEventHelper.hover(k,function(){u._stickPath||(u._highlight({guidWorkitem:k.data("workItem"),highlight:!0}),k.toFront())},function(){u._stickPath||(u._highlight({guidWorkitem:k.data("workItem"),highlight:!1}),k.toFront())}),k.click(function(){var n=this.data();u._stickAllPath(n.workItem);this.toFront()}),l.push(d),l.push(k))}),n("#raphael-marker-endclassic55 use").attr("fill","#7cb5ec"),h.setFinish(),l},destroy:function(){n.Widget.prototype.destroy.call(this)}})})(jQuery);
(function(n){n.widget("diagram.processMap",{options:{data:{}},_create:function(){var n=this,t=this.options,i=t.data||{},r=n.indexingData(i);return n.element.addClass("tree"),n.drawEngine(r),n._configureHandlers(),this},_configureHandlers:function(){var n=this;n.element.bind("zoom",function(t,i){n._zoom(i)});n.element.draggable()},_zoom:function(t){var i=this;n(i.element).css({"font-size":t+"em"})},indexingData:function(t){var i=this,u,e,r,f;return i.indexedData={maxVerticalLevels:0,maxHorizontalNodes:0,parentNode:{},latestChild:{},data:t||{},nodesByLevel:{},nodesById:{}},f=function(t,r){var u=[];return t=t||"",n.each(i.indexedData.data,function(n,i){typeof i[t]!="undefined"&&i[t]==r&&u.push(i)}),u},n.each(i.indexedData.data,function(n,t){u=f("guidCase",t.guidParentCase);e=f("guidParentCase",t.guidCase);u.length==0?(r=0,i.indexedData.parentNode=t):r=u[0].relation?u[0].relation.depth+1:0;i.indexedData.data[n].relation={parent:u,children:e,depth:r,limitX:{min:0,max:0}};typeof i.indexedData.nodesByLevel[r]=="undefined"&&(i.indexedData.nodesByLevel[r]=[]);i.indexedData.nodesByLevel[r].push(i.indexedData.data[n]);i.indexedData.nodesByLevel[r].length>i.indexedData.maxHorizontalNodes&&(i.indexedData.maxHorizontalNodes=i.indexedData.nodesByLevel[r].length);r>i.indexedData.maxVerticalLevels&&(i.indexedData.maxVerticalLevels=r,i.indexedData.latestChild=i.indexedData.data[n]);i.indexedData.nodesById[t.guidCase]=i.indexedData.data[n]}),i.indexedData},drawEngine:function(t){function e(n,t){var i={idcase:t.idCase,idworkflow:t.idWorkFlow,enddate:t.finishDate,startdate:t.creationDate,process:t.name};return n.data(i),n.addClass("subprocess-tooltip"),n}function o(t){var f,s,r,h,u,i;if(t.relation.children.length){for(u=n("<ul>"),i=0;i<t.relation.children.length;i++)f=e(n("<a>"),t.relation.children[i]),h=n("<span class='arrow'>"),s=f.html(t.relation.children[i].name),r=n("<li>"),r.append(h),r.append(s),r.append(o(t.relation.children[i])),u.append(r);return u}return null}var u=this,i,f,r,s,h;i=n("<ul>");f=e(n("<a>"),t.parentNode).html(t.parentNode.name);r=n("<li class='center'>").append(f);i.append(r);r.append(o(t.parentNode));u.element.css({"min-width":"5000px",transform:"translateY(20%)","-ms-transform":"translateY(20%)","-moz-transform":"translateY(20%)","-webkit-transform":"translateY(20%)"});u.element.html(i);$element=n(".bz-subprocess-map");$parent=$element.parent();s=$parent.width();h=$element.width();$parent.scrollLeft((h-s)/2)}})})(jQuery);
(function(n){n.widget("diagram.zoom",{options:{min:50,max:150,step:10,value:100,onZoom:function(){}},_create:function(){var n=this,t=this.options;n._bindSlider();n._bindTooltip()},_bindSlider:function(){var t=this;options=t.options;t.element.slider({min:options.min,max:options.max,step:options.step,value:options.value,change:function(t,i){options.onZoom(i.value);var r=i.value.toString()+"%";n("#zoom-value").text(r)}})},_bindTooltip:function(){var i=this,t=n("<div class='zoom-tooltip'><label id='zoom-value'><\/label><\/div>");n(".bz-zoom-container").append(t);n(".bz-zoom-container").mouseenter(function(){t.addClass("is-visible-output");var r=i.element.slider("option","value")+"%";n("#zoom-value").text(r)}).mouseleave(function(){t.removeClass("is-visible-output")})},destroy:function(){n.Widget.prototype.destroy.call(this)}})})(jQuery);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.graphicquery",{},{init:function(n,t,i){var r=this;r.subprocesses=[];r.currentTasks=[];r.path=[];r.callStack=[];r.currentWorkflow={idCase:i.data.idCase,idWorkflow:i.data.idWorkflow};r._super(n,t,i);r.loadTemplates({"graphicquery-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-wrapper"),"graphicquery-tooltip-currenttask":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-tooltip-currenttask"),"graphicquery-tooltip-subcases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-tooltip-subcases"),"graphicquery-subcases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-subcases"),"graphicquery-parentsummary":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-parentsummary"),"graphicquery-summary":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-summary"),"graphicquery-tooltip-users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-tooltip-users"),"graphicquery-actionbar":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-actionbar"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GRAPHIC_QUERY},renderContent:function(){var n=this,t=n.getTemplate("graphicquery-wrapper");return n.content=$.tmpl(t)}});
bizagi.workportal.widgets.graphicquery.extend("bizagi.workportal.widgets.graphicquery",{},{postRender:function(){var n=this;n.dateFormat=n.getResource("dateFormat")+" "+n.getResource("timeFormat");n.$header=$(".bz-gq-header",n.content);n.$actionBar=$("#bz-gq-actionbar-container",n.$header);n.$pvCanvas=$("#bz-gq-processviewer-canvas",n.content);n.$summary=$("#bz-gq-summary-container",n.$header);n.renderProcessViewer();n.eventsHandler()},refreshContent:function(n){var t=this;t.path=[];t.subprocesses=[];t.currentTasks=[];t.currentWorkflow={idCase:n.idCase,idWorkflow:n.idWorkflow,idParentWorkItem:n.idParentWorkItem};t.renderProcessViewer();t.$pvCanvas.processviewer("destroy");t.$actionBar.empty();t.$summary.empty()},setCallStack:function(){var n=this;n.callStack.push(n.currentWorkflow)},renderHeader:function(n){var t=this,i=t.callStack.length;i&&(n.parentCase=n.parentCase||{},$.extend(n.parentCase,t.callStack[i-1]));t.renderActionBar(n.parentCase);t.renderSummary(n)},renderActionBar:function(n){var t=this,i=t.getTemplate("graphicquery-actionbar");t.$actionBar.html($.tmpl(i,{parentCase:n}))},renderSummary:function(n){var t=this,u=t.getTemplate("graphicquery-summary"),i=$.tmpl(u,n),r;bizagi.util.formatInvariantDate(i,t.dateFormat);t.$summary.html(i);n.parentCase&&(r=t.getTemplate("graphicquery-parentsummary"),t.$summary.append($.tmpl(r,n.parentCase)))},renderProcessViewer:function(){var n=this,r=n.getContent(),t="processId="+n.currentWorkflow.idWorkflow,i="idCase="+n.currentWorkflow.idCase+"&idWorkFlow="+n.currentWorkflow.idWorkflow;i+=n.currentWorkflow.idParentWorkItem?"&idParentWorkItem="+n.currentWorkflow.idParentWorkItem:"";$.when(n.dataService.processDefinition(t),n.dataService.graphicInfo(t),n.dataService.getGraphicQueryInfo(i)).done(function(t,i,r){$.extend(n.currentWorkflow,{idProcess:r[0].idProcess,nameProcess:r[0].nameProcess,radicationNumber:r[0].currentCase.radicationNumber});n.renderHeader(r[0]);n.pathWorkItems=r[0].pathWorkItems;n.$pvCanvas.processviewer({height:n.getPVHeight(),jsonBizagi:{processDefinition:t[0],processGraphicsInfo:i[0]},zoomRange:5})}).fail(function(t){var i=JSON.parse(t.responseText);n.publish("closeCurrentDialog");bizagi.showMessageBox(i.message,"Bizagi","warning")})},toggleHighlight:function(){for(var n=this,t=[],i=0,r=n.currentTasks.length;i<r;i++)t.push(n.currentTasks[i].guidTask);n.highlighted?(n.highlighted=!1,n.$pvCanvas.processviewer("unSelectShape",t,n.currentTasks)):(n.highlighted=!0,n.$pvCanvas.processviewer("selectShape",t,n.currentTasks))},eventsHandler:function(){var n=this;n.applyViewerTooltip();n.$actionBar.on("click","#bz-gq-button-parent, #bz-gq-button-path, #bz-gq-button-status",function(){var t;if(this.id==="bz-gq-button-status")n.toggleHighlight();else if(this.id==="bz-gq-button-parent"){if(n.callStack.length)var i=n.callStack.pop(),r=i.idWorkflow,t=i.idCase;else t=$(this).data("idcase"),r=$(this).data("idworkflow");n.refreshContent({idWorkflow:r,idCase:t})}else this.id==="bz-gq-button-path"&&($("i",this).toggleClass("bz-gq-icon-path-stop"),n.drawCasePath())});n.$pvCanvas.on("animationComplete",function(){$("#bz-gq-button-path i",n.$actionBar).removeClass("bz-gq-icon-path-stop")});n.$pvCanvas.on("pvComplete",function(t){n.highlighted=!1;n.getRelevantData();n.toggleHighlight();n.showSubCases();t.stopPropagation()})},applyViewerTooltip:function(){var n=this;n.$pvCanvas.tooltip({items:"div.processviewer-shape-selected, div.has-subprocess, div.processviewer-highlighted",content:function(){return n.getTooltipContent($(this))},show:{duration:120,effect:"none"},tooltipClass:"bz-gq-tooltip-wrapper",hide:{delay:250,duration:120},close:function(n,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(120,1)},function(){$(this).fadeOut(120,function(){$(this).remove()})})}})},getTooltipContent:function(n){var t=this,i="",r=n.find(".processviewer-hotspot-label").text(),u=n.prop("id"),f=$.Deferred();return n.hasClass("has-subprocess")?(i=t.getSubCasesContent(r,u),t.bindTooltipEvent(i)):!n.hasClass("processviewer-shape-selected")||n.hasClass("end")||n.hasClass("start")||n.hasClass("scripttask")||n.hasClass("servicetask")||n.hasClass("sendtask")||n.hasClass("receivetask")?n.hasClass("processviewer-highlighted")&&n.hasClass("manualtask")&&(i=t.renderPreviousTaskTooltip(r,u,f)):i=t.renderCurrentTaskTooltip(r,u,f),f.promise().done(function(n){bizagi.util.formatInvariantDate(n,t.dateFormat)}),i},getSubCasesContent:function(n,t){for(var i,u=this,s=u.getTemplate("graphicquery-tooltip-subcases"),f="",e=[],r=0,o=u.subprocesses.length;r<o;r++)i=u.subprocesses[r],i.guidTask===t&&(taskType=i.subProcess.taskType,f=i.subProcess.taskName,e=i.subProcess.items,r=o);return $.tmpl(s,{taskName:n,taskType:taskType,subprocess:f,cases:e})},renderCurrentTaskTooltip:function(n,t,i){var u=this,r=$("<div><\/div>");return $.when(u.getCurrentTaskContent(t)).done(function(t){var f=u.getTemplate("graphicquery-tooltip-currenttask"),e={taskName:n,entryDate:t.wiEntryDate,expireDate:t.wiEstimatedSolutionDate,users:bizagi.override.showAssignees?t.usersAssignees:[]};r=$.tmpl(f,e);$(".bz-gq-tooltip-wrapper").html(r);i.resolve(r)}),r},getCurrentTaskContent:function(n){for(var t=this,f=t.getTemplate("graphicquery-tooltip-currenttask"),r=$.Deferred(),i=0,u=t.currentTasks.length;i<u;i++)if(n===t.currentTasks[i].guidTask){t.currentTasks[i].usersAssignees.length===0?t.dataService.getUserInfoByTask(t.currentWorkflow.idCase,n).done(function(n){t.currentTasks[i].usersAssignees=n;r.resolve(t.currentTasks[i])}).fail(function(){r.reject(t.currentTasks[i])}):r.resolve(t.currentTasks[i]);break}return r.promise()},showSubCases:function(){for(var n=this,r=n.getTemplate("graphicquery-subcases"),t=0,u=n.subprocesses.length;t<u;t++){var f=n.subprocesses[t].guidTask,i=n.$pvCanvas.find("#"+f),e=n.subprocesses[t].subProcess.items.length;i.addClass("has-subprocess");i.prepend($.tmpl(r,{ncases:e}))}},renderPreviousTaskTooltip:function(n,t,i){var u=this,r=$("<div><\/div>");return $.when(u.getUsersDataForPreviousTask(t)).done(function(t){var f=u.getTemplate("graphicquery-tooltip-users");r=$.tmpl(f,$.extend(t,{taskName:n}));$(".bz-gq-tooltip-wrapper").html(r);i.resolve(r)}),r},getUsersDataForPreviousTask:function(n){for(var t=this,r=$.Deferred(),i=0,u=t.pathWorkItems.length;i<u;i++)if(n===t.pathWorkItems[i].guidTask){t.pathWorkItems[i].usersAssignees.length===0?t.dataService.getUserInfoByTask(t.currentWorkflow.idCase,n).done(function(n){t.pathWorkItems[i].usersAssignees=n;r.resolve(t.pathWorkItems[i])}).fail(function(){r.reject(t.pathWorkItems[i])}):r.resolve(t.pathWorkItems[i]);break}return r.promise()},getPVHeight:function(){var n=this,t=n.$header.height()+45,i=n.content.parent().height();return i-t},bindTooltipEvent:function(n){var t=this;$(".bz-gq-tooltip-list li",n).on("click",function(){$(this).closest(".ui-tooltip").remove();var n={idWorkflow:$(this).data("idworkflow"),idCase:$(this).data("idcase"),idParentWorkItem:$(this).data("idparentworkitem")};t.currentWorkflow.task=$(this).parent().data("parenttaskname");t.currentWorkflow.idParentWorkItem=n.idParentWorkItem;t.setCallStack();t.refreshContent(n)})},getRelevantData:function(){for(var n=this,t=n.pathWorkItems.length-1;t>=0;t--)n.pathWorkItems[t].subProcess&&n.subprocesses.push(n.pathWorkItems[t]),n.pathWorkItems[t].wiClosed||n.currentTasks.push(n.pathWorkItems[t])},drawCasePath:function(){var n=this,t;n.path.length?n.$pvCanvas.processviewer("animateRoute"):(t="idCase="+n.currentWorkflow.idCase+"&idWorkFlow="+n.currentWorkflow.idWorkflow,$.when(n.dataService.getCasePath(t)).done(function(t){for(var i=0,r=t.length;i<r;i++)i===0&&t[0].guidTaskFrom===""&&(n.path.push(t[i+1]?t[i+1].guidTaskFrom:""),n.path.push(t[i].guidTransition),n.path.push(t[i].guidTaskTo)),n.path.push(t[i].guidTaskFrom),n.path.push(t[i].guidTransition),n.path.push(t[i].guidTaskTo);n.path=n.cleanPathArray(n.path);n.path=n.removeRepeatedItemsInPath(n.path);n.$pvCanvas.processviewer("animateRoute",n.path)}))},clearCasePath:function(){var n=this;n.$pvCanvas.processviewer("stopRouteAnimation")},cleanPathArray:function(n){for(var i=[],t=0,r=n.length;t<r;t++)n[t]&&i.push(n[t]);return i},removeRepeatedItemsInPath:function(n){var t={boolean:{},number:{},string:{}},i=[];return n.filter(function(n){var r=typeof n;return r in t?t[r].hasOwnProperty(n)?!1:t[r][n]=!0:i.indexOf(n)>=0?!1:i.push(n)})}});
$.Class.extend("bizagi.bpmn.modeler.observable",{},{subscribe:function(){this.observableElement().bind.apply(this.observableElement(),arguments)},unsubscribe:function(){this.observableElement().unbind.apply(this.observableElement(),arguments)},publish:function(){return this.observableElement().triggerHandler.apply(this.observableElement(),arguments)},observableElement:function(){return this._observableElement?this._observableElement:this._observableElement=$({})}});
bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.model",{},{init:function(){this.tasks={};this.canvas={}},setModel:function(n){this.tasks=n.tasks;this.canvas=n.canvas;this.triggerModelRedraw()},getViewModel:function(){var n=[];for(val in this.tasks)n.push(this.tasks[val]);return{tasks:n,canvas:this.canvas,isGateway:this.isGateway}},getPersistenceModel:function(){var n={tasks:jQuery.extend({},this.tasks),canvas:jQuery.extend({},this.canvas)};return $.each(n.tasks,function(n,t){delete t.showAura}),n},getTaskById:function(n){return this.tasks[n]},getConnectionRule:function(n,t){var r=this.tasks[n],i;return this.isGateway(r.type)?(i=$.grep(r.rules,function(n){return n.target==t}),i.length>0?i[0].expression:null):null},successorConnectionsCanContainRule:function(n){var n=this.tasks[n];return this.isGateway(n.type)},setCanvasBounds:function(n){this.canvas=n;this.triggerModelChange({redraw:!1})},setExtendedProperty:function(n,t,i){this.tasks[n]&&(this.tasks[n].extendedProperties=this.tasks[n].extendedProperties||{},this.tasks[n].extendedProperties[t]=i,this.triggerModelChange({redraw:!1}))},getExtendedProperty:function(n,t){return this.tasks[n]?this.tasks[n].extendedProperties[t]:null},addTask:function(n,t,i){var r={id:this.newGuid(),type:n,displayName:this.getDefaultName(n),duration:this.getDuration(n),position:t,showAura:!1,predecessors:[],successors:[],rules:[],extendedProperties:{}};i&&r.predecessors.push(i);this.tasks[r.id]=r;this.tasks[i]&&this.tasks[i].successors.push(r.id);this.setAura(r.id,!0);this.triggerModelChange()},addConnection:function(n,t){var i=this.tasks[n],r=this.tasks[t];i.successors.push(t);r.predecessors.push(n);this.triggerModelChange()},changeTaskName:function(n,t){if(this.tasks[n]){if(this.tasks[n].displayName==t)return;this.tasks[n].displayName=t;this.triggerModelChange({redraw:!1})}},changeDuration:function(n,t){if(this.tasks[n]){if(this.tasks[n].duration==t)return;this.tasks[n].duration=t;this.triggerModelChange({redraw:!1})}},changeTaskType:function(n,t){if(this.tasks[n]){if(this.tasks[n].type==t)return;this.tasks[n].type=t;this.triggerModelChange()}},moveTask:function(n,t){this.tasks[n]&&(this.tasks[n].position=t,this.triggerModelChange())},setAura:function(n,t){$.each(this.tasks,function(n,t){t.showAura=!1});this.tasks[n]&&(this.tasks[n].showAura=t)},setConnectionRule:function(n,t,i){var u=this.tasks[n],r=$.grep(u.rules,function(n){return n.target==t}),f=r.length>0?r[0]:{target:t};r.length==0&&u.rules.push(f);f.expression=i;this.triggerModelChange()},deleteTask:function(n){$.each(this.tasks,function(t,i){i.predecessors&&i.predecessors.length>0&&i.predecessors.removeAll(n);i.successors&&i.successors.length>0&&i.successors.removeAll(n)});delete this.tasks[n];this.triggerModelChange()},deleteArrow:function(n,t){var i=this.tasks[n],r=this.tasks[t];i&&i.successors.removeAll(t);r&&r.predecessors.removeAll(n);this.triggerModelChange()},newGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})},getDefaultName:function(n){if(n=="UserTask"){var t=$.grep(Object.values(this.tasks),function(n){return n.type=="UserTask"});return"Task "+(t.length+1)}return null},getDuration:function(n){return n=="UserTask"?1:null},triggerModelRedraw:function(){this.publish("model.redraw")},triggerModelChange:function(n){n=n||{redraw:!0};this.publish("model.change");n.redraw&&this.triggerModelRedraw()},isGateway:function(n){return n=="ExclusiveGateway"||n=="ParallelGateway"||n=="InclusiveGateway"||n=="ComplexGateway"}});
bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.aura",{externalOptions:{form:"bz-icon bz-icon-template-outline",assignee:"bz-icon bz-icon-user-manage"},getClassForExternalOption:function(n){return this.externalOptions[n]}},{init:function(n){$.views.converters("externaloption_class",function(n){return bizagi.bpmn.modeler.aura.getClassForExternalOption(n)});$.templates({bpm_modeler_aura:'<aura class="bpm-aura-for-{{:type}}">                                     {{if showArrow}}                                             <aura-option class="bpm-option-arrow bpmn-icon-connection-multi" data-predecessor="{{:~root.id}}"><\/aura-option>                                     {{/if}}                                     {{for options tmpl="bpm_modeler_auraOption"/}}                                     <special-options {{if showRuleOption}} class="bpm-show-rule-option" {{/if}}>                                         <special-option class="bpm-option-delete bpmn-icon-trash"><\/special-option>                                         {{if showRuleOption}}                                             <special-option class="bpm-option-expression bpmn-icon-conditional-flow"><\/special-option>                                             <special-option class="bpm-option-else bpmn-icon-default-flow"><\/special-option>                                         {{/if}}                                         {{if changeTo && changeTo.length > 0}}                                         <special-option class="bpm-option-change bz-icon bz-icon-asynchronous-outline"><\/special-option>                                         <aura-change>                                             {{for changeTo tmpl="bpm_modeler_auraChangeTo"/}}                                         <\/aura-change>                                         {{/if}}                                     <\/special-options>                                     {{if externalOptions && externalOptions.length > 0}}                                         <external-options>                                             {{for externalOptions tmpl="bpm_modeler_auraExternalOption"/}}                                         <\/external-options>                                     {{/if}}                                 <\/aura>',bpm_modeler_auraOption:'<aura-option class="bpm-{{:#data}} {{tasktype_class: #data}} bpm-cloneable"                                             data-type="{{:#data}}"                                             data-predecessor="{{:~root.id}}">                                         <\/aura-option>',bpm_modeler_auraChangeTo:'<aura-change-to class="bpm-{{:#data}} {{tasktype_class: #data}}"                                                  data-type="{{:#data}}"                                                 data-task="{{:~root.id}}">                                         <\/aura-change-to>',bpm_modeler_auraExternalOption:'<external-option class="bpm-{{:#data}} {{externaloption_class: #data}}"                                                         data-option="{{:#data}}"                                                         data-task="{{:~root.id}}">                                                 <\/external-option>'});this.model=n;this.previousElementId=null;this.aura=null},showForTask:function(n){var t=this,i=n.attr("id"),f={type:"UserTask",options:this.getOptions(n),changeTo:this.getChangeTo(n),externalOptions:this.getExternalOptions(n),showArrow:!0,positioning:"right"},r=this.show(n,f),u;if(r){u=this.aura.find("special-options");u.position({of:n,my:"center-8 top+10",at:"center bottom",collision:"none"});this.aura.find("special-option.bpm-option-change").on("click",function(){t.showChangeToOptions(this)});this.aura.find("special-option.bpm-option-delete").on("click",function(){t.deleteTask(i)});this.aura.find("external-option").on("click",function(){t.manageExternalOption($(this),i)});this.aura.find("aura-option.bpm-option-arrow").draggable({helper:"clone",containment:"#bpm-drawing",grid:[20,20],drag:function(n,r){t.dragArrow(r,i)}})}return r},showForArrow:function(n,t){var f=this,i=n.attr("id"),e={type:"arrow",positioning:"center",showRuleOption:t},r=this.show(n,e),u;if(r){u=this.aura.find("special-options");u.position({of:n,my:"center center",at:"center center",collision:"none"});this.aura.find("special-option.bpm-option-delete").on("click",function(){f.deleteArrow(i)});this.addHandlersForExpressions(i)}return r},show:function(n,t){var e=this,i=n.attr("id"),r,u,f;return this.previousElementId&&(r=this.previousElementId==i,this.hide(this.previousElementId),r)?!1:(this.previousElementId=i,u=$.templates.bpm_modeler_aura.render($.extend(t,{id:i})),this.aura=$(u),n.after(this.aura),this.moveTo(n,t.positioning),t.externalOptions&&(f=this.aura.find("external-options"),f.position({of:n,my:"center-15 bottom+16",at:"center top",collision:"none"})),this.aura.find("aura-option").draggable({helper:"clone",containment:"#bpm-drawing",grid:[20,20],drag:function(n,t){e.publish("item.drag",t)}}),!0)},hide:function(n){(n=n||this.previousElementId,n!=null)&&(this.aura&&this.aura.detach(),this.previousElementId=null)},moveTo:function(n,t){var i=n.attr("id");if(i!=this.previousElementId){this.hide();return}t=t||"right";t=="right"&&this.aura.position({of:n,my:"left+20 center",at:"right center",collision:"none"})},showChangeToOptions:function(n){var t=this.aura.find("aura-change");t.toggleClass("visible");t.position({of:n,my:"center top+10",at:"center bottom",collision:"none"});t.find("aura-change-to").click($.proxy(this.changeTo,this))},addHandlersForExpressions:function(n){var t=this;this.aura.find(".bpm-option-else").click(function(){var i=bizagi.bpmn.modeler.connector.getSourceTaskFromId(n),r=bizagi.bpmn.modeler.connector.getTargetTaskFromId(n);t.publish("arrow.setElse",n);t.model.setConnectionRule(i,r,"else")});this.aura.find(".bpm-option-expression").click(function(){t.publish("arrow.setExpression",n)})},deleteTask:function(n){this.model.deleteTask(n)},deleteArrow:function(n){var t=bizagi.bpmn.modeler.connector.getSourceTaskFromId(n),i=bizagi.bpmn.modeler.connector.getTargetTaskFromId(n);this.model.deleteArrow(t,i)},dragArrow:function(n,t){this.publish("arrow.drag",{source:t,target:n.offset})},changeTo:function(n){var t=$(n.currentTarget),i=t.data("type"),r=t.data("task");this.model.changeTaskType(r,i)},manageExternalOption:function(n,t){var i=n.data("option");this.publish("task.externaloption",{task:t,option:i})},getOptions:function(n){var t=n.data("type");return t=="EndEvent"?[]:["IntermediateEvent","EndEvent","ExclusiveGateway","UserTask"]},getChangeTo:function(n){var t=n.data("type"),i=[];return(t=="ExclusiveGateway"||t=="ParallelGateway"||t=="InclusiveGateway"||t=="ComplexGateway"?i=["ParallelGateway","InclusiveGateway","ComplexGateway","ExclusiveGateway"]:(t=="EndEvent"||t=="TerminateEvent")&&(i=["EndEvent","TerminateEvent"]),i.length>0)?(i.removeOne(t),i):null},getExternalOptions:function(n){var t=n.data("type");return t!="UserTask"&&t!="IntermediateEvent"?[]:["form","assignee"]}});
$.Class.extend("bizagi.bpmn.modeler.path",{},{curve:8,arrowHeight:10,calculateAnchors:function(n,t){var e=Math.min(n.width,t.width),o=Math.min(n.height,t.height),u=n.x+n.width/2,f=t.x+t.width/2,i=n.y+n.height/2,r=t.y+t.height/2;if(n.x+n.width+e<t.x)return{el1:"right",el2:"left"};if(n.x>t.x+t.width+e)return{el1:"left",el2:"right"};if(this.areElementsVeryCloseInXAxis(n,t,e)){if(n.y+n.height<t.y)return{el1:"bottom",el2:"top"};if(n.y>t.y+t.height)return{el1:"top",el2:"bottom"}}if(Math.abs(i-r)<o){if(n.x<t.x)return{el1:"right",el2:"left"};if(n.x>=t.x)return{el1:"left",el2:"right"}}return u<f&&i<r?{el1:"bottom",el2:"left"}:u>f&&i<r?{el1:"bottom",el2:"right"}:u<f&&i>r?{el1:"top",el2:"left"}:u>f&&i>r?{el1:"top",el2:"right"}:void 0},getPath:function(n,t,i,r){var f=Math.min(i.width,r.width),e=Math.min(i.height,r.height),u={x:this.arrowHeight,y:this.arrowHeight,w:n.width-this.arrowHeight,h:n.height-this.arrowHeight};if(this.areVerticalAnchors(t)&&Math.abs(i.x-r.x)<10){if(i.y<r.y)return this.getPathTopToBottom(u,i,r);if(i.y>r.y)return this.getPathBottomToTop(u,i,r)}if(this.areHorizontalAnchors(t)&&Math.abs(i.y-r.y)<10){if(i.x<r.x)return this.getPathLeftToRight(u);if(i.x>r.x)return this.getPathRightToLeft(u)}if(this.areHorizontalAnchors(t)){if(i.x<r.x&&i.y<r.y)return this.getPathLeftToRightBottom(u);if(i.x<r.x&&i.y>r.y)return this.getPathLeftToRightTop(u);if(i.x>r.x&&i.y<r.y)return this.getPathRightToLeftBottom(u);if(i.x>r.x&&i.y>r.y)return this.getPathRightToLeftTop(u)}if(this.areVerticalAnchors(t)){if(i.x<r.x&&i.y<r.y)return this.getPathTopToBottomLeft(u);if(i.x<r.x&&i.y>r.y)return this.getPathBottomToTopLeft(u);if(i.x>r.x&&i.y<r.y)return this.getPathTopToBottomRight(u);if(i.x>r.x&&i.y>r.y)return this.getPathBottomToTopRight(u)}return t.el1=="bottom"&&t.el2=="left"?this.getPathBottomToLeft(u):t.el1=="bottom"&&t.el2=="right"?this.getPathBottomToRight(u):t.el1=="top"&&t.el2=="left"?this.getPathTopToLeft(u):t.el1=="top"&&t.el2=="right"?this.getPathTopToRight(u):void 0},getTransform:function(n,t,i){return this.areVerticalAnchors(n)&&Math.abs(t.x-i.x)<this.arrowHeight?"translate(5, 0)":(n.el1=="left"||n.el1=="right")&&Math.abs(t.y-i.y)<this.arrowHeight?"translate(0, 5)":""},areHorizontalAnchors:function(n){return n.el1=="left"&&n.el2=="right"||n.el1=="right"&&n.el2=="left"},areVerticalAnchors:function(n){return n.el1=="top"&&n.el2=="bottom"||n.el1=="bottom"&&n.el2=="top"},areElementsVeryCloseInXAxis:function(n,t,i){var r=n.x+n.width/2,u=t.x+t.width/2;return Math.abs(r-u)<i?!0:Math.abs(r-t.x)<i?!0:Math.abs(r-t.x+t.width)<i?!0:Math.abs(u-n.x)<i?!0:Math.abs(u-n.x+n.width)<i?!0:!1},getPathLeftToRight:function(n){var r=n.x,t=n.w,u=n.h/2,i=n.h/2;return"M "+r+","+u+" L "+t+","+i+" "+this.getArrowRight(t,i)},getPathRightToLeft:function(n){var r=n.w,t=n.x,u=n.h/2,i=n.h/2;return"M "+r+","+u+" L "+t+","+i+" "+this.getArrowLeft(t,i)},getPathTopToBottom:function(n,t,i){var r=t.x<i.x?this.arrowHeight:n.w,e=r/2,u=r/2,o=n.y,f=n.h;return"M "+e+","+o+" L "+u+","+f+" "+this.getArrowDown(u,f)},getPathBottomToTop:function(n,t,i){var r=t.x<i.x?this.arrowHeight:n.w,e=r/2,u=r/2,o=n.h,f=n.y;return"M "+e+","+o+" L "+u+","+f+" "+this.getArrowUp(u,f)},getPathLeftToRightBottom:function(n){var e=n.x,f=n.w,r=n.y,i=n.h,t=n.w/2,o=n.h/2,u=this.curve;return"M "+e+","+r+" L "+(t-u)+","+r+" S "+t+","+r+" "+t+","+(r+u)+" L "+t+","+(i-u)+" S "+t+","+i+" "+(t+u)+","+i+" L "+f+","+i+" "+this.getArrowRight(f,i)},getPathLeftToRightTop:function(n){var e=n.x,f=n.w,r=n.h,i=n.y,t=n.w/2,o=n.h/2,u=this.curve;return"M "+e+","+r+" L "+(t-u)+","+r+" S "+t+","+r+" "+t+","+(r-u)+" L "+t+","+(i+u)+" S "+t+","+i+" "+(t+u)+","+i+" L "+f+","+i+" "+this.getArrowRight(f,i)},getPathRightToLeftBottom:function(n){var e=n.w,f=n.x,r=n.y,i=n.h,t=n.w/2,o=n.h/2,u=this.curve;return"M "+e+","+r+" L "+(t+u)+","+r+" S "+t+","+r+" "+t+","+(r+u)+" L "+t+","+(i-u)+" S "+t+","+i+" "+(t-u)+","+i+" L "+f+","+i+" "+this.getArrowLeft(f,i)},getPathRightToLeftTop:function(n){var e=n.w,f=n.x,r=n.h,i=n.y,t=n.w/2,o=n.h/2,u=this.curve;return"M "+e+","+r+" L "+(t+u)+","+r+" S "+t+","+r+" "+t+","+(r-u)+" L "+t+","+(i+u)+" S "+t+","+i+" "+(t-u)+","+i+" L "+f+","+i+" "+this.getArrowLeft(f,i)},getPathTopToBottomLeft:function(n){var r=n.x,i=n.w,e=n.y,f=n.h,o=n.w/2,t=n.h/2,u=this.curve;return"M "+r+","+e+" L "+r+","+(t-u)+" S "+r+","+t+" "+(r+u)+","+t+" L "+(i-u)+","+t+" S "+i+","+t+" "+i+","+(t+u)+" L "+i+","+f+" "+this.getArrowDown(i,f)},getPathTopToBottomRight:function(n){var r=n.w,i=n.x,e=n.y,f=n.h,o=n.w/2,t=n.h/2,u=this.curve;return"M "+r+","+e+" L "+r+","+(t-u)+" S "+r+","+t+" "+(r-u)+","+t+" L "+(i+u)+","+t+" S "+i+","+t+" "+i+","+(t+u)+" L "+i+","+f+" "+this.getArrowDown(i,f)},getPathBottomToTopLeft:function(n){var r=n.x,i=n.w,e=n.h,f=n.y,o=n.w/2,t=n.h/2,u=this.curve;return"M "+r+","+e+" L "+r+","+(t+u)+" S "+r+","+t+" "+(r+u)+","+t+" L "+(i-u)+","+t+" S "+i+","+t+" "+i+","+(t-u)+" L "+i+","+f+" "+this.getArrowUp(i,f)},getPathBottomToTopRight:function(n){var r=n.w,i=n.x,e=n.h,f=n.y,o=n.w/2,t=n.h/2,u=this.curve;return"M "+r+","+e+" L "+r+","+(t+u)+" S "+r+","+t+" "+(r-u)+","+t+" L "+(i+u)+","+t+" S "+i+","+t+" "+i+","+(t-u)+" L "+i+","+f+" "+this.getArrowUp(i,f)},getPathBottomToLeft:function(n){var i=n.x,r=n.w,f=n.y,t=n.h,u=this.curve;return"M "+i+","+f+" L "+i+","+(t-u)+" S "+i+","+t+" "+(i+u)+","+t+" L "+r+","+t+" "+this.getArrowRight(r,t)},getPathBottomToRight:function(n){var i=n.w,r=n.x,f=n.y,t=n.h,u=this.curve;return"M "+i+","+f+" L "+i+","+(t-u)+" S "+i+","+t+" "+(i-u)+","+t+" L "+r+","+t+" "+this.getArrowLeft(r,t)},getPathTopToLeft:function(n){var i=n.x,r=n.w,f=n.h,t=n.y,u=this.curve;return"M "+i+","+f+" L "+i+","+(t+u)+" S "+i+","+t+" "+(i+u)+","+t+" L "+r+","+t+" "+this.getArrowRight(r,t)},getPathTopToRight:function(n){var i=n.w,r=n.x,f=n.h,t=n.y,u=this.curve;return"M "+i+","+f+" L "+i+","+(t+u)+" S "+i+","+t+" "+(i-u)+","+t+" L "+r+","+t+" "+this.getArrowLeft(r,t)},getArrowRight:function(){var n=this.arrowHeight/2;return"m -"+n+",-"+n+" l "+n+","+n+" l -"+n+","+n},getArrowLeft:function(){var n=this.arrowHeight/2;return"m "+n+",-"+n+" l -"+n+","+n+" l "+n+","+n},getArrowUp:function(){var n=this.arrowHeight/2;return"m -"+n+","+n+" l "+n+",-"+n+" l "+n+","+n},getArrowDown:function(){var n=this.arrowHeight/2;return"m -"+n+",-"+n+" l "+n+","+n+" l "+n+",-"+n}});
$.Class.extend("bizagi.bpmn.modeler.connector",{buildConnectorId:function(n,t){return"svgFrom_"+n+"_to_"+t},getSourceTaskFromId:function(n){var t=n.indexOf("svgFrom_"),i=n.indexOf("_to_");return n.substring(t+8,i)},getTargetTaskFromId:function(n){var t=n.indexOf("_to_");return n.substring(t+4)}},{init:function(){$.templates({bpm_modeler_connector:'<connector style="position:absolute;left:{{:left}}px;top:{{:top}}px"                                                 id="{{:id}}"                                                 class="bpm-{{:expression}}"                                                 data-expression="{{:expression}}">                                         <svg width="{{:width}}" height="{{:height}}">                                             <path d="{{:path}}" fill="none" stroke="{{:stroke}}" transform="{{:transform}}"/>                                         <\/svg>                                         {{if expression == "else"}} <connector-label>else<\/connection-label> {{/if}}                                     <\/connector>'});this.path=new bizagi.bpmn.modeler.path;this.stroke="#000"},connect:function(n,t,i,r){var u=this.getBounds(t),f=this.getBounds(i),e=this.Class.buildConnectorId(t.attr("id"),i.attr("id"));this.drawLine(n,e,u,f,r)},drawLine:function(n,t,i,r,u){var e=this.modifyPositions(i,r),f={id:t,top:this.getTop(i,r),left:this.getLeft(i,r),width:this.getWidth(i,r),height:this.getHeight(i,r),transform:this.path.getTransform(e,i,r),expression:u,stroke:this.stroke},o,s,h;f.path=this.path.getPath(f,e,i,r);o=$.templates.bpm_modeler_connector.render(f);connector=$(o);n.append(connector);u=="else"&&(s=connector.find("svg"),h=connector.find("connector-label"),h.position({of:s,my:"center center",at:"center center",collision:"none"}))},refresh:function(n,t,i){var u=this.Class.buildConnectorId(t.attr("id"),i.attr("id")),r=$("#"+u),f=r.data("expression");r.detach();this.connect(n,t,i,f)},drawTemporalConnector:function(n,t,i){var r="svgTemporalConnector",u,f;n.find("#"+r).detach();u=this.getBounds(t);f={x:i.left,y:i.top,width:0,height:0};this.drawLine(n,r,u,f)},removeTemporalConnector:function(n){n.find("#svgTemporalConnector").detach()},getBounds:function(n){var t=n.position();return{x:t.left,y:t.top,width:n.outerWidth(),height:n.outerHeight()}},getLeft:function(n,t){return Math.min(n.x,t.x)-this.path.arrowHeight},getTop:function(n,t){return Math.min(n.y,t.y)-this.path.arrowHeight},getWidth:function(n,t){return Math.abs(n.x-t.x)+this.path.arrowHeight*2},getHeight:function(n,t){return Math.abs(n.y-t.y)+this.path.arrowHeight*2},modifyPositions:function(n,t){var i=this.path.calculateAnchors(n,t);return this.adjustToAnchor(n,i.el1),this.adjustToAnchor(t,i.el2),i},adjustToAnchor:function(n,t){(t=="top"||t=="bottom")&&(n.x=n.x+n.width/2);(t=="left"||t=="right")&&(n.y=n.y+n.height/2);t=="bottom"&&(n.y=n.y+n.height);t=="right"&&(n.x=n.x+n.width)}});
bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.drawing",{},{init:function(n){var t=this;$.templates({bpm_modeler_drawing:'<drawing>                                     {{for tasks tmpl="bpm_modeler_drawingItem"/}}                                   <\/drawing>',bpm_modeler_drawingItem:'<item id="{{: id}}" class="bpm-{{:type}} bpm-moveable"                                             style="left:{{:position.x}}px; top:{{:position.y}}px"                                             data-type="{{: type}}"                                            data-show-aura="{{:showAura}}">                                             <label class="label_task_name">{{:displayName}}<\/label>                                             {{if ~root.isGateway(type)}}<gateway-helper><\/gateway-helper>{{/if}}                                             {{if duration}}<duration>{{:duration}}<\/duration>{{/if}}                                        <\/item>'});this.drawingWidth=0;this.drawingHeight=0;this.model=n;this.model.subscribe("model.redraw",$.proxy(this.refresh,this));this.aura=new bizagi.bpmn.modeler.aura(this.model);this.aura.subscribe("item.drag",$.proxy(this.onElementDragging,this));this.aura.subscribe("arrow.drag",$.proxy(this.onArrowDragging,this));this.aura.subscribe("arrow.setExpression",$.proxy(this.editExpressionForArrow,this));this.aura.subscribe("arrow.setElse",$.proxy(this.triggerElseExpressionForArrow,this));this.aura.subscribe("task.externaloption",$.proxy(this.manageExternalOption,this));this.connector=new bizagi.bpmn.modeler.connector},render:function(n,t){var r=this,u,i,f;this.readOnly=t||!1;u=this.canvas==null;this.canvas=n;i=this.model.getViewModel();f=$.templates.bpm_modeler_drawing.render(i);n.append(f);this.drawing=n.find("drawing");this.canvasWidth=n.width();this.canvasHeight=n.height();this.scrollTop=i.canvas.top||0;this.scrollLeft=i.canvas.left||0;this.drawingWidth=i.canvas.width||this.canvasWidth;this.drawingHeight=i.canvas.height||this.canvasHeight;this.canvas.scrollLeft(this.scrollLeft);this.canvas.scrollTop(this.scrollTop);setTimeout(function(){r.addConnectors(i)},0);this.addHandlers();u&&!this.readOnly&&this.addGeneralHandlers();this.drawing.find("item[data-show-aura=true]").click();$("#bpm-drawing").find(".label_task_name ").each(function(n,t){var i=$(t).text();r.setNameTask(i,$(t))?$(t).text(i.substring(0,20)+"..."):$(t).text(i)})},refresh:function(){this.canvas.empty();this.aura.hide();this.render(this.canvas)},addHandlers:function(){this.drawing.find("item").draggable({containment:"#bpm-drawing",grid:[20,20],drag:$.proxy(this.onTaskDragging,this)});this.configureDroppable()},addGeneralHandlers:function(){this.canvas.on("click","item",$.proxy(this.showAura,this));this.canvas.on("dblclick","item label",$.proxy(this.editTaskName,this));this.canvas.on("dblclick","item duration",$.proxy(this.editDuration,this));this.canvas.on("click","connector",$.proxy(this.showAuraForArrow,this))},configureDroppable:function(){var n=this;this.drawing.droppable({drop:function(t,i){setTimeout(function(){i.helper.hasClass("bpm-cloneable")?n.addTask(i):i.helper.hasClass("bpm-moveable")?n.moveTask(i):i.helper.hasClass("bpm-option-arrow")&&n.addArrow(i)},0)},accept:".bpm-cloneable, .bpm-moveable, .bpm-option-arrow"})},addTask:function(n){var u=n.draggable.data("type"),f=n.draggable.data("predecessor"),r=this.fixPosition(n.offset),t=r.left,i=r.top;t=t-t%20;i=i-i%20;this.model.addTask(u,{x:t,y:i},f)},moveTask:function(n){var u=n.draggable.data("type"),r=n.draggable.attr("id"),t=n.position.left,i=n.position.top;t=t-t%20;i=i-i%20;this.model.moveTask(r,{x:t,y:i})},editTaskName:function(n){var i=this,t=$(n.currentTarget),u=t.parent().attr("id"),r=$("<input type='text' />");r.val(t.text());this.showPopupEditor(t,r,function(n){i.model.changeTaskName(u,n);i.setNameTask(n,t)?t.text(n.substring(0,20)+"..."):t.text(n)})},manageExternalOption:function(n,t){this.publish("drawing.externaloption",t)},editDuration:function(n){var r=this,t=$(n.currentTarget),u=t.parent().attr("id"),i=$('<input type="number" min="1" onkeypress="if(this.value.length==4) return false; return event.charCode >= 48 && event.charCode <= 57"/>');i.val(t.text());this.showPopupEditor(t,i,function(n){r.model.changeDuration(u,n);t.text(n)})},addArrow:function(n){var r=n.draggable.data("predecessor"),u=this.fixPosition(n.offset),t=this.getTasksAtPosition(u),i;t.length==1?(i=t.attr("id"),this.model.addConnection(r,i)):this.connector.removeTemporalConnector(this.canvas)},editExpressionForArrow:function(n,t){var i=bizagi.bpmn.modeler.connector.getSourceTaskFromId(t),r=bizagi.bpmn.modeler.connector.getTargetTaskFromId(t);this.publish("drawing.externaloption",{option:"rule",source:i,target:r})},triggerElseExpressionForArrow:function(n,t){var i=bizagi.bpmn.modeler.connector.getSourceTaskFromId(t),r=bizagi.bpmn.modeler.connector.getTargetTaskFromId(t);this.publish("drawing.externaloption",{option:"else",source:i,target:r})},setExpressionForArrow:function(n,t){this.model.setConnectionRule(n,t,"boolean")},moveCanvas:function(n){var t=100,r=$(n.target),i=r.prop("tagName").toLowerCase();i=="move-right"&&(this.scrollLeft+=t,this.canvasWidth+this.scrollLeft>=this.drawingWidth&&(this.drawingWidth+=t));i=="move-left"&&(this.scrollLeft-=t);i=="move-top"&&(this.scrollTop-=t);i=="move-bottom"&&(this.scrollTop+=t,this.canvasHeight+this.scrollTop>=this.drawingHeight&&(this.drawingHeight+=t));this.scrollTop<0&&(this.scrollTop=0);this.scrollLeft<0&&(this.scrollLeft=0);this.drawing.width(this.drawingWidth);this.drawing.height(this.drawingHeight);this.canvas.scrollLeft(this.scrollLeft);this.canvas.scrollTop(this.scrollTop);this.model.setCanvasBounds({top:this.scrollTop,left:this.scrollLeft,width:this.drawingWidth,height:this.drawingHeight})},onTaskDragging:function(n,t){this.redrawConnector(t.helper.attr("id"),t.position);this.aura.moveTo(t.helper);this.onElementDragging(n,t)},onArrowDragging:function(n,t){var i=this.drawing,r=this.fixPosition(t.target),u;this.connector.drawTemporalConnector(i,i.find("#"+t.source),r);u=this.getTasksAtPosition(r);i.find("item").removeClass("dragging-arrow");u.addClass("dragging-arrow")},onElementDragging:function(){},redrawConnector:function(n){var i=this,r=this.model.getTaskById(n),t=this.drawing;$.each(r.predecessors,function(r,u){u&&i.connector.refresh(t,t.find("#"+u),t.find("#"+n))});$.each(r.successors,function(r,u){u&&i.connector.refresh(t,t.find("#"+n),t.find("#"+u))})},addConnectors:function(n){var t=this;$.each(n.tasks,function(n,i){$.each(i.successors,function(n,r){t.addConnector(i.id,r)})})},addConnector:function(n,t){var i=this.model.getConnectionRule(n,t);this.connector.connect(this.drawing,this.drawing.find("#"+n),this.drawing.find("#"+t),i)},showAura:function(n){var t=$(n.currentTarget),i=this.aura.showForTask(t);this.model.setAura(t.id,i);this.drawing.find("*").removeClass("active");i&&t.addClass("active")},showAuraForArrow:function(n){var t=$(n.currentTarget),i=t.attr("id"),r=bizagi.bpmn.modeler.connector.getSourceTaskFromId(i),u=this.model.successorConnectionsCanContainRule(r),f=this.aura.showForArrow(t,u);this.drawing.find("*").removeClass("active");f&&t.addClass("active")},getTasksAtPosition:function(n){return this.drawing.find("item").filter(function(){var i=$(this),r=i.position(),t={x:r.left,y:r.top,w:i.width(),h:i.height()};return t.x<=n.left&&n.left<=t.x+t.w&&t.y<=n.top&&n.top<=t.y+t.h})},showPopupEditor:function(n,t,i){n.hide();n.after(t);t.focus();t.select();var r=function(){var r=t.val();i(r);n.show();t.detach()};t.keypress(function(n){n.key=="Enter"&&r()});t.click(function(n){return n.preventDefault(),!1});this.drawing.one("click",r)},fixPosition:function(n){var t=this.drawing.offset();return n.left-=t.left,n.top-=t.top,n},setNameTask:function(n,t){if(n.length>20||t.height()>34)return!0}});
bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.toolbar",{bpmShapes:{StartEvent:"bpmn-icon-start-event-none",IntermediateEvent:"bpmn-icon-intermediate-event-none",EndEvent:"bpmn-icon-end-event-none",TerminateEvent:"bpmn-icon-end-event-terminate",ExclusiveGateway:"bpmn-icon-gateway-xor",ParallelGateway:"bpmn-icon-gateway-parallel",InclusiveGateway:"bpmn-icon-gateway-or",ComplexGateway:"bpmn-icon-gateway-complex",UserTask:"bpmn-icon-task"},getClassForType:function(n){return this.bpmShapes[n]}},{init:function(){$.views.converters("tasktype_class",function(n){return bizagi.bpmn.modeler.toolbar.getClassForType(n)});$.templates({bpm_modeler_toolbar:'<toolbar> {{for items tmpl="bpm_modeler_toolbarItem"/}}<\/toolbar>',bpm_modeler_toolbarItem:'<item class="bpm-{{:#data}} {{tasktype_class: #data}}  bpm-cloneable" data-type="{{:#data}}"><\/item>'});this.items=["StartEvent","IntermediateEvent","EndEvent","ExclusiveGateway","UserTask"]},render:function(n){var i=this,t;this.canvas=n;t=$.templates.bpm_modeler_toolbar.render({items:this.items});this.canvas.append(t);n.find("item").draggable({helper:"clone",containment:"#bpm-drawing",grid:[20,20],drag:$.proxy(this.onItemDragging,this)})},onItemDragging:function(n,t){this.publish("item.dragging",t)}});
bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.viewer",{},{init:function(n){$.templates({bpm_modeler_viewer_container:'<bpm-modeler>                             <div id="bpm-toolbar"><\/div>                             <div id="bpm-drawing"><\/div>                             <move-helper>                                 <move-top class="bpm-move"><\/move-top>                                 <move-left class="bpm-move"><\/move-left>                                 <move-bottom class="bpm-move"><\/move-bottom>                                 <move-right class="bpm-move"><\/move-right>                             <\/move-helper>                         <\/bpm-modeler>'});this.model=new bizagi.bpmn.modeler.model;this.model.subscribe("model.change",$.proxy(this.changed,this));n&&n.model&&this.model.setModel(n.model);this.drawing=new bizagi.bpmn.modeler.drawing(this.model);this.drawing.subscribe("drawing.externaloption",$.proxy(this.manageExternalOption,this));this.toolbar=new bizagi.bpmn.modeler.toolbar;this.toolbar.subscribe("item.dragging",$.proxy(this.onToolbarItemDragging,this));this.model.isReadOnly=typeof n=="undefined"?!1:n.isReadOnly},render:function(n){this.canvas=n;this.isReadOnly=this.validateIsReadOnly(this.model);var t=$.templates.bpm_modeler_viewer_container.render();this.canvas.html(t);this.isReadOnly?this.renderDrawing(this.isReadOnly):(this.renderToolbar(),this.renderDrawing(this.isReadOnly));this.canvas.on("click",".bpm-move",$.proxy(this.moveCanvas,this))},validateIsReadOnly:function(n){if(n.isReadOnly)return!0},renderToolbar:function(){var n=this.canvas.find("#bpm-toolbar");this.toolbar.render(n)},renderDrawing:function(n){var t=this.canvas.find("#bpm-drawing");this.drawing.render(t,n)},moveCanvas:function(n,t){this.drawing.moveCanvas(n,t)},onToolbarItemDragging:function(n,t){this.drawing.onElementDragging(n,t)},manageExternalOption:function(n,t){this.publish("bpm.modeler.externalOption",t)},setConnectionExpression:function(n,t){this.drawing.setExpressionForArrow(n,t)},save:function(){return this.model.getPersistenceModel()},load:function(n){this.model.setModel(n)},changed:function(){this.publish("bpm.modeler.changed")},setExtendedProperty:function(n,t,i){this.model.setExtendedProperty(n,t,i)},getExtendedProperty:function(n,t){return this.model.getExtendedProperty(n,t)}});Array.prototype.removeOne||(Array.prototype.removeOne=function(n){for(var t=this.length;t--;)if(this[t]===n){this.splice(t,1);return}});Array.prototype.removeAll||(Array.prototype.removeAll=function(n){for(var t=this.length;t--;)this[t]===n&&this.splice(t,1)});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.activity.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ACTIVITY_LOG},renderContent:function(){var n=this,t=n.getTemplate("activity.log");return n.idCase=n.params.idCase,n.idWorkflow=n.params.idWorkflow,n.content=$.tmpl(t,{idCase:n.idCase})}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.authentication.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_AUTHENTICATION_LOG},renderContent:function(){var n=this,t=n.getTemplate("authentication.log");return n.content=$.tmpl(t,{})}});
bizagi.workportal.widgets.activity.log.extend("bizagi.workportal.widgets.activity.log",{},{init:function(n,t,i){var r=this;r.totalPages=0;r.maxRows=10;r.maxPages=10;r.currentPage=1;r._super(n,t,i);r.loadTemplates({"activity.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log"),"activity.log.general.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-general-content"),"activity.log.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-header"),"activity.log.detail.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-header"),"activity.log.detail.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-content"),useNewEngine:!1})},postRender:function(){var n=this,t,i;n.generalContentTmpl=n.getTemplate("activity.log.general.content");n.generalHeaderContentTmpl=n.getTemplate("activity.log.header");n.detailHeaderTmpl=n.getTemplate("activity.log.detail.header");n.detailContentTmpl=n.getTemplate("activity.log.detail.content");n.logCategories={ACTIVITIES:{id:"ActivityLog",serviceMethod:"getActivityLog",detailServiceMethod:"getActivityDetailLog",selectedDetailId:0},ENTITIES:{id:"EntityLog",serviceMethod:"getEntityLog",detailServiceMethod:"getEntityDetailLog",selectedDetailId:0},USERS:{id:"UserLog",serviceMethod:"getUserLog",detailServiceMethod:"getUserDetailLog",selectedDetailId:0},ADMINISTRATION:{id:"AdminLog",serviceMethod:"getAdminLog"}};n.containtersID={GENERAL:"general",DETAIL:"detail"};t=typeof n.dataService.serviceLocator.proxyPrefix!=undefined?n.dataService.serviceLocator.proxyPrefix:"";i=new bizagi.render.services.service({proxyPrefix:t});i.getCaseNumber({idCase:n.idCase}).done(function(t){var i=t.caseNumber;n.caseNumber=i?i:n.idCase;n.initWidget()})},initWidget:function(){var n=this;n.displayNoResults(!1);n.setupHeader()},setupHeader:function(){var n=this,t;content=n.getContent();t=$("#activity-log-data-header-wrapper",content);$.when(n.dataService.supportedLogTypes()).done(function(i){$.tmpl(n.generalHeaderContentTmpl,{supportedLogTypes:i.Supported}).appendTo(t);var r=n.getFirstAvailableLogTypes(i.Supported);n.currentPage=1;n.getActivityLogByCategory(n.logCategories[r]);n.bindHeaderElementInteraction($("#LnkActivities",n.content),n.logCategories.ACTIVITIES);n.bindHeaderElementInteraction($("#LnkEntities",n.content),n.logCategories.ENTITIES);n.bindHeaderElementInteraction($("#LnkUsers",n.content),n.logCategories.USERS);n.bindHeaderElementInteraction($("#LnkAdmin",n.content),n.logCategories.ADMINISTRATION)}).fail(function(){})},getFirstAvailableLogTypes:function(n){var r=this,i,t;for(i in r.logCategories)for(t in n)if(r.logCategories[i].id==t&&(n[t]=="true"||n[t]==!0))return i;return""},bindHeaderElementInteraction:function(n,t){var i=this;n.click(function(){$(this).hasClass("active")||($(".active",i.content).removeClass("active"),$(this).addClass("active"),i.currentPage=1,i.getActivityLogByCategory(t))})},getActivityLogByCategory:function(n){var t=this,i={},r;t.selectedCategoryObj=$.isEmptyObject(n)?t.selectedCategoryObj:$.extend({},n);i={idCase:t.idCase,idActualPage:t.currentPage,pageSize:t.maxRows};r=$("#activity-log-data-general-wrapper",content);r.addClass("ui-bizagi-component-loading");$.when(t.dataService[t.selectedCategoryObj.serviceMethod](i)).done(function(n){t.totalPages=n.total;t.generalActivityDataValidator(n)}).fail(function(n){bizagi.showErrorAlertDialog=!1;bizagi.showMessageBox(JSON.parse(n.responseText).message,"Bizagi","Error")})},generalActivityDataValidator:function(n){var i=this,u=i.getContent(),f=$("#activity-log-data-general-wrapper",u),t,r;if(n.rows){if(i.selectedCategoryObj.id==i.logCategories.ADMINISTRATION.id)for(t=n.rows.length;t-->0;)r=n.rows[t][3].indexOf("-->")!==-1?[].concat(n.rows[t][3].split("-->")[0].split(":").concat(n.rows[t][3].split("-->")[1].split(": :"))):[].concat(n.rows[t][3].split("-->")[0].split(":")),n.rows[t][3]=[].concat(r);i.currentLogData=[].concat(n.rows)}else i.currentLogData=[];i.renderContentByCategory()},renderContentByCategory:function(){var n=this,i=n.getContent(),t=$("#activity-log-data-general-wrapper",i),u=$("#activity-log-data-detail-wrapper",i),r;t.removeClass("ui-bizagi-component-loading");t.empty();n.switchContent(n.containtersID.GENERAL);r=n.getPaginationData();$.tmpl(n.generalContentTmpl,{logCategory:n.selectedCategoryObj.id,idCase:n.caseNumber,logItems:n.currentLogData,pagData:r}).appendTo(t);n.setUpPagination($("#biz-wp-activitylog-category-pager ul",n.content),"getActivityLogByCategory");n.currentLogData.length>0?(n.displayNoResults(!1),$(".activity-log-table",t).show()):(n.displayNoResults(!0),$(".activity-log-table",t).hide());$(".detail-item",t).click(function(t){t.preventDefault();n.selectedLogItemIndex=$($(t.currentTarget).closest("tr")[0]).index()-1;n.currentPage=1;n.preprocessDetailRender($(this))});$(".listHeaderLinks",t).click(function(n){n.preventDefault()})},getPaginationData:function(){for(var n=this,r=n.totalPages>1?!0:!1,i={page:n.currentPage,pagesArray:[],pagination:r},u=n.maxPages>n.totalPages?n.totalPages:n.maxPages,t=0;t<u;t++)i.pagesArray.push(t+1);return i},setUpPagination:function(n,t){var i=this;n.bizagiPagination({maxElemShow:i.maxRows,totalPages:i.totalPages,actualPage:i.currentPage,listElement:n,clickCallBack:function(r){i.currentPage=parseInt(r.page);i[t]({},n)}})},preprocessDetailRender:function(n){var t=this,r=t.getContent(),i=t.getDetailRenderParams(n);t.selectedCategoryObj.detailServiceMethod&&$.when(t.dataService[t.selectedCategoryObj.detailServiceMethod](i)).done(function(n){t.totalPages=n.total;t.switchContent(t.containtersID.DETAIL);t.currentDetailLogData=n.rows?[].concat(n.rows):[];t.renderLogDetail(n)}).fail(function(){})},getDetailRenderParams:function(n){var t=this,r,i;switch(t.selectedCategoryObj.id){case t.logCategories.ACTIVITIES.id:$.isEmptyObject(n)?i=t.logCategories.ACTIVITIES.selectedDetailId:t.logCategories.ACTIVITIES.selectedDetailId=i=n.attr("data-id");r={idCase:t.idCase,idWorkItemFrom:i};break;case t.logCategories.ENTITIES.id:$.isEmptyObject(n)?i=t.logCategories.ENTITIES.selectedDetailId:t.logCategories.ENTITIES.selectedDetailId=i=n.attr("data-id");r={idCase:t.idCase,idEntity:i};break;case t.logCategories.USERS.id:$.isEmptyObject(n)?i=t.logCategories.USERS.selectedDetailId:t.logCategories.USERS.selectedDetailId=i=n.attr("data-id");r={idCase:t.idCase,idUser:i}}return $.extend(r,{idActualPage:t.currentPage,pageSize:t.maxRows}),r},renderLogDetail:function(){var n=this,i=n.getContent(),t=$("#activity-log-data-detail-wrapper",i);t.empty();t.removeClass("ui-bizagi-component-loading");$.when(n.renderDetailContent()).done(function(){var r=$("#log-filter-wrapper",i);n.showDetailResultMessage();$("#back-general-content",t).click(function(t){t.preventDefault();n.displayNoResults(!1);n.switchContent(n.containtersID.GENERAL)});$("#apply-filter",r).click(function(t){t.preventDefault();n.currentPage=1;n.applyDetailFilter()});$("#remove-filter",r).click(function(t){t.preventDefault();$("input",r).val("");n.currentPage=1;n.applyDetailFilter()});$(".listHeaderLinks",t).click(function(n){n.preventDefault()})})},showDetailResultMessage:function(){var n=this,t=$("#activity-log-data-detail-wrapper",n.getContent());n.currentDetailLogData.length>0?(n.displayNoResults(!1),$(".activity-log-table",t).show()):(n.displayNoResults(!0),$(".activity-log-table",t).hide())},applyDetailFilter:function(){var n=this,i=n.getFilterParams(),t=n.getContent();n.selectedCategoryObj.detailServiceMethod&&$.when(n.dataService[n.selectedCategoryObj.detailServiceMethod](i)).done(function(i){n.totalPages=i.total;n.currentDetailLogData=i.rows?[].concat(i.rows):[];var r=n.getPaginationData(),u=$.tmpl(n.detailContentTmpl,{logCategory:n.selectedCategoryObj.id,title:n.selectedCategoryObj.title,detailItems:n.currentDetailLogData,pagData:r});$("#bz-workportal-activitylog-detailcontent-wrapper",t).remove();$(u).insertAfter("#activity-log-data-detail-header-wrapper",t);n.showDetailResultMessage();n.setUpPagination($("#biz-wp-activitylog-detail-pager ul",t),"applyDetailFilter")})},getFilterParams:function(){var n=this,e=n.getContent(),t=$("#log-filter-wrapper",e),i=n.getDetailRenderParams(),r,u,f;return n.selectedCategoryObj.id==n.logCategories.ENTITIES.id?r=$("#filterUser",t).val().toLowerCase():n.selectedCategoryObj.id==n.logCategories.USERS.id&&(f=$("#filterEntity",t).val().toLowerCase()),u=$("#filterAttribute",t).val().toLowerCase(),$.extend(i,{userFullName:r,attribDisplayName:u,entDisplayName:f}),i},renderDetailContent:function(){var n=this,r=n.getContent(),t=$.Deferred(),i=$("#activity-log-data-detail-wrapper",r),u=n.getPaginationData();return $.when($.tmpl(n.detailHeaderTmpl,{logCategory:n.selectedCategoryObj.id,idCase:n.caseNumber,data:n.currentLogData[n.selectedLogItemIndex]}),$.tmpl(n.detailContentTmpl,{logCategory:n.selectedCategoryObj.id,title:n.selectedCategoryObj.title,detailItems:n.currentDetailLogData,pagData:u})).done(function(r,u){i.append(r);u.insertAfter("#activity-log-data-detail-header-wrapper",i);n.setUpPagination($("#biz-wp-activitylog-detail-pager ul",n.content),"preprocessDetailRender");t.resolve()}),t.promise()},switchContent:function(n){var t=this,i=t.getContent(),r=$("#activity-log-data-general-wrapper",i),u=$("#activity-log-data-detail-wrapper",i);t.containtersID.DETAIL==n?(r.hide(),u.show()):(r.show(),u.hide())},displayNoResults:function(n){var i=this,t=i.getContent();n?$("#activity-log-no-results",t).show():$("#activity-log-no-results",t).hide()}});bizagi.injector.register("bizagi.workportal.widgets.activity.log",["workportalFacade","dataService",bizagi.workportal.widgets.activity.log],!0);
bizagi.workportal.widgets.authentication.log.extend("bizagi.workportal.widgets.authentication.log",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"authentication.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log"),"authentication.log.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-fields"),"authentication.log.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-button"),"authentication.log.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-result"),"authentication.log.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-pagination"),useNewEngine:!1})},postRender:function(){var n=this;n.maxElemShow=10;n.maxPageToShow=5;n.generalContentTmpl=n.getTemplate("authentication.log");n.fieldsContentTmpl=n.getTemplate("authentication.log.fields");n.buttonContentTmpl=n.getTemplate("authentication.log.button");n.resultContentTmpl=n.getTemplate("authentication.log.result");n.paginationTmpl=n.getTemplate("authentication.log.pagination");n.setupInitialData()},setupInitialData:function(){var n=this,i=n.getContent(),t=[{dataType:"domains"},{dataType:"events"},{dataType:"subEvents"}];$.when(n.dataService.getAuthenticationLogData(t[0]),n.dataService.getAuthenticationLogData(t[1]),n.dataService.getAuthenticationLogData(t[2])).done(function(t,r,u){n.eventTypeList=r[0].response;n.subEventTypeList=u[0].response;var f=$.tmpl(n.fieldsContentTmpl,{domainList:t[0],eventTypeList:r[0].response,subEvenTypes:u[0].response});i.append(f);n.setupDatePicker();n.setupFooterButtons()}).fail(function(n){bizagi.log(n)})},setupDatePicker:function(){var n=this,t=n.getContent();$(".biz-wp-form-datepicker",t).datetimepicker({controlType:"select",timeFormat:"HH:mm"})},setupFooterButtons:function(){var t=this,n=t.getContent(),r=$.tmpl(t.buttonContentTmpl,{}),i;n.append(r);i=$("#authentication-log-data-buttonset",n);$("#btn-authentication-search",i).click(function(){var i,r;$(".biz-wp-table").remove();$("#biz-wp-table-summary-wrapper").remove();i=t.validateData();i.fieldsAreEmpty||i.errorMessage!=""?bizagi.showMessageBox(i.errorMessage,"Bizagi","warning"):(r={action:"AuthLog",domain:$("#domainList",n).val()!="none"?$("#domainList",n).val():"",userName:$("#auth-log-user",n).val(),dtFrom:$("#sinceDate",n).val(),dtTo:$("#toDate",n).val(),eventSubType:$("#subEventType",n).val()!=t.subEventTypeList[0].displayName?$("#subEventType",n).val():"",eventType:$("#eventType",n).val()!=t.eventTypeList[0].displayName?$("#eventType",n).val():"",pagSize:t.maxElemShow},t.findResults(n,r))})},validateData:function(){var u=this,n=u.getContent(),i={fieldsAreEmpty:!1,errorMessage:""},t="",r="";return $("#domainList",n).val()=="none"&&$("#auth-log-user",n).val()==""&&$("#eventType",n).val()==u.eventTypeList[0].id&&$("#subEventType",n).val()==u.subEventTypeList[0].id&&$("#sinceDate",n).val()==""&&$("#toDate",n).val()==""?(i.fieldsAreEmpty=!0,i.errorMessage=bizagi.localization.getResource("workportal-widget-authentication-log-emptyfields-message")):$("#sinceDate",n).val()==""||bizagi.util.isDate($("#sinceDate",n).val())?$("#toDate",n).val()==""||bizagi.util.isDate($("#toDate",n).val())||(r=bizagi.localization.getResource("workportal-widget-authentication-log-dateto"),t=bizagi.localization.getResource("workportal-general-invalid-date"),t=t.replace("{0}",r),i.errorMessage=t):(r=bizagi.localization.getResource("workportal-widget-authentication-log-datesince"),t=bizagi.localization.getResource("workportal-general-invalid-date"),t=t.replace("{0}",r),i.errorMessage=t),i},findResults:function(n,t,i){var r=this;t.pag=i?i:1;$.when(r.dataService.getAuthenticationLogResult(t)).done(function(i){var e,f;if($(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove(),r.totalRecords=i.records,r.totalPages=i.total,i.rows.length>0){e=$.tmpl(r.resultContentTmpl,{resultList:i.rows});n.append(e);var s=r.maxPageToShow>r.totalPages?r.totalPages:r.maxPageToShow,h=$("#biz-wp-table-pager-wrapper"),u={},o;for(u.pagination=r.totalPages>1?!0:!1,u.page=i.page,u.pages={},f=1;f<=s;f++)u.pages[f]={pageNumber:f};o=$.tmpl(r.paginationTmpl,u).html();h.append(o);$("ul").bizagiPagination({maxElemShow:r.maxElemShow,totalPages:r.totalPages,actualPage:i.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(i){r.findResults(n,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),"Bizagi","warning")}).fail(function(n){bizagi.log(n)})}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.encrypt.passwords",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ENCRYPT_PASSWORDS},renderContent:function(){var n=this,t=n.getTemplate("encrypt.passwords");return n.content=$.tmpl(t,{})}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.users.requests",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_REQUESTS},renderContent:function(){var n=this,t=n.getTemplate("users.requests");return n.content=$.tmpl(t)}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.defaults.assignation.user",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_DEFAULTS_ASSIGNATION_USER},renderContent:function(){var n=this,i=n.getTemplate("defaults.assignation.user"),t;return t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.user.profiles",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_PROFILES},renderContent:function(){var n=this,t=n.getTemplate("user.profiles"),i=n.content=$.tmpl(t,{});return n.loadtemplates(),i},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.dimensions",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_DIMENSIONS},renderContent:function(){var n=this,i=n.getTemplate("dimensions"),t;return t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.alarms",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ALARMS},renderContent:function(){var n=this,t=n.getTemplate("alarms");return n.content=$.tmpl(t)}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.user.licenses",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_LICENSES},renderContent:function(){var n=this,i=n.getTemplate("user.licenses"),t;return t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.document.templates",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_DOCUMENT_TEMPLATES},renderContent:function(){var n=this,i=n.getTemplate("admin.document.templates"),t;return t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.processes",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PROCESSES},renderContent:function(){var n=this,i=n.getTemplate("admin.processes.wrapper"),t;return n.comboProcess=n.getTemplate("admin.processes.combo.process"),n.processEditTmpl=n.getTemplate("admin.processes.proc.edit"),n.taskEditTmpl=n.getTemplate("admin.processes.task.edit"),t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES},renderContent:function(){var n=this,i=n.getTemplate("admin.business.policies.wrapper"),t;return n.generalContentTmpl=n.getTemplate("admin.business.policies.content"),t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.decision.table",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_DECISION_TABLE},renderContent:function(){},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.rules",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_RULES},renderContent:function(){},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.tabs",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_TABS},renderContent:function(){},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.politics",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_POLITICS},renderContent:function(){},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.vocabularies",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_VOCABULARIES},renderContent:function(){},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.language",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_LANGUAGE},renderContent:function(){var n=this,i=n.getTemplate("admin.language.wrapper"),t;return n.panelWrapper=$.tmpl(n.getTemplate("admin.language.panel.wrapper")),n.generalTemplateListTmpl=n.getTemplate("admin.language.template.list"),n.fileCultureName=n.getTemplate("admin.language.upload.file.culturename"),n.bizagiObjectsList=n.getTemplate("admin.language.bizagi.objects.list"),n.entitiesListTmpl=n.getTemplate("admin.language.entities.list"),t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.preferences",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PREFERENCES},renderContent:function(){var n=this,i=n.getTemplate("admin.preferences.wrapper"),t;return t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.entities",{},{renderContent:function(){var n=this,t=n.getTemplate("admin.entity.wrapper");return n.content=$.tmpl(t,{}),n.loadtemplates(),n.content},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ENTITIES},getFormEntity:function(n){var t=this;t.currentGuidForm=n.guidForm;t.currentIdRow=n.idRow;bizagi.loader.start("rendering").then(function(){var i=new bizagi.rendering.facade;$.when(t.dataService.getAdminEntitiesForm(n)).done(function(r){r.form.contextType="entity";$.when(i.execute({data:r,contexttype:"entity",canvas:$("#detailEntity",t.panelWrapper),isEntityForm:!0})).done(function(i){t._referrer==="stakeholder"&&(t._associatedUser=i.getRender("associatedUser").value);n.idRow&&(i.surrogatekey=n.idRow);i.unbind("refresh");i.bind("refresh",function(n,r){i.dispose();t.configureRefresh(n,r)});i.internalSubmitOnChange=function(){var n=$.Deferred();return $.when(t.internalSubmitOnChangeEntity(i)).done(function(r){if(r){var u=t.getSelectedItem();u.idPageCache=i.idPageCache;u.guidForm=t.currentGuidForm;u.guid=u.guidEntity;u.idRow=t.currentIdRow;t.getFormEntity(u);n.resolve()}}).fail(function(){n.reject()}),n.promise()};i.processButton=function(n){if(i.endLoading(),n.action=="save"){if(i.validateForm())return $.when(t.saveFormEntity(i)).done(function(n){n&&t.drawSimpleGrid(t.getSelectedItem())})}else n.action==="cancel"&&t.drawSimpleGrid(t.getSelectedItem())}})})})},internalSubmitOnChangeEntity:function(n){var r=this,t=$.Deferred(),f=r.getSelectedItem(),u=new bizagi.render.services.service,i={};return n.collectRenderValues(i),$.when(u.multiactionService.submitData({action:"SUBMITONCHANGE",contexttype:"entity",data:i,surrogatekey:typeof n.surrogatekey!="undefined"?n.surrogatekey:!1,idPageCache:n.idPageCache})).done(function(n){n.type=="success"?t.resolve(!0):t.reject()}).fail(function(n){bizagi.showMessageBox(n.message);t.reject()}),t.promise()}});
bizagi.workportal.widgets.admin.encrypt.passwords.extend("bizagi.workportal.widgets.admin.encrypt.passwords",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"encrypt.passwords":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.encrypt.passwords").concat("#ui-bizagi-workportal-widget-admin-encrypt-passwords"),useNewEngine:!1})},postRender:function(){var n=this;n.generalContentTmpl=n.getTemplate("encrypt.passwords");n.setupFooterButtons()},setupFooterButtons:function(){var n=this,r=n.getContent(),u={},f=$("#encryp-password-data-buttonset",r),t,i;$("#btn-encrypt",f).click(function(){u.entry=$("#txtTextToEncrypt").val();t=n.validateData();i=n.comparePasswords();t&&i?$.when(n.dataService.encryptString(u)).done(function(n){$("#txtEncryptedText",r).val(n.encryptedPassword)}).fail(function(){}):t?i||bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-encrypt-passwords-emptyfields-message-equals"),"Bizagi","warning"):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-encrypt-passwords-emptyfields-message"),"Bizagi","warning")})},comparePasswords:function(){var t=this,n=t.getContent(),i=$("#txtTextToEncrypt",n).val(),r=$("#txtConfirmTextToEncrypt",n).val();return i!=r?!1:!0},validateData:function(){var i=this,t=i.getContent(),n=!1;return $("#txtTextToEncrypt",t).val()!=""?n=!0:$("#txtConfirmTextToEncrypt",t).val()!=""&&(n=!0),n}});
bizagi.workportal.widgets.admin.users.requests.extend("bizagi.workportal.widgets.admin.users.requests",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"users.requests":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests"),"users.requests.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-list"),"users.requests.detail":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-detail"),"users.requests.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-pagination"),"users.requests.email":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-email"),useNewEngine:!1})},postRender:function(){var n=this,t=n.getContent();n.maxElemShow=10;n.maxPageToShow=5;n.currentPage=1;n.userRequest=n.getTemplate("users.requests");n.userRequestList=n.getTemplate("users.requests.list");n.userRequestDetail=n.getTemplate("users.requests.detail");n.userRequestpaginationTmpl=n.getTemplate("users.requests.pagination");n.userRequestemailTmpl=n.getTemplate("users.requests.email");n.userRequestListWrapper=$("#users-request-list-wrapper",t);n.userRequestDetailWrapper=$("#users-request-detail-wrapper",t);n.containtersID={LIST:"list",DETAIL:"detail"};n.setupInitialData()},setupInitialData:function(n){var t=this,i;t.switchContent(t.containtersID.LIST);n&&(t.currentPage=n);i={pag:t.currentPage,pagSize:t.maxElemShow};$.when(t.dataService.userPendingRequests(i)).done(function(n){t.renderUserRequestList(n)})},authenticationInfo:function(n){var t=this,i={idUser:n};$.when(t.dataService.userAuthenticationInfo(i)).done(function(n){t.renderUserRequestDetails(n)})},renderUserRequestList:function(n){var t=this,f=t.getContent(),u,e,o,s,i,r;if(t.userRequestListWrapper.empty(),u=$.tmpl(t.userRequestList,{userData:n.rows}),bizagi.util.formatInvariantDate(u,t.getResource("dateFormat")+" "+t.getResource("timeFormat")),t.userRequestListWrapper.append(u),e=$("#users-requests-pager-wrapper",f),t.totalRecords=n.records,t.totalPages=n.total,n.rows.length>0){for(o=t.maxPageToShow>t.totalPages?t.totalPages:t.maxPageToShow,i={},i.pagination=t.totalPages>1,i.page=n.page,i.pages={},$("#biz-wp-userrequest-norequest").css("display","none"),$("#users-request-list-wrapper .biz-wp-window ").css("display","block"),$("#users-request-list-wrapper .biz-wp-table ").css("display","table"),r=1;r<=o;r++)i.pages[r]={pageNumber:r};s=$.tmpl(t.userRequestpaginationTmpl,i).html();e.append(s);$("ul").bizagiPagination({maxElemShow:t.maxElemShow,totalPages:t.totalPages,actualPage:n.page,listElement:$("#users-requests-pager-wrapper"),clickCallBack:function(n){t.setupInitialData(n.page)}})}else $("#biz-wp-userrequest-norequest").show("500"),$("#users-request-list-wrapper .biz-wp-window ").css("display","none"),$("#users-request-list-wrapper .biz-wp-table ").css("display","none");$(".selectLink",f).click(function(n){t.authenticationInfo(n.currentTarget.id)})},renderUserRequestDetails:function(n){var t=this,r,i=t.getContent(),u=$.tmpl(t.userRequestDetail,{resultAuthentication:n});t.switchContent(t.containtersID.DETAIL);t.userRequestDetailWrapper.empty();t.userRequestDetailWrapper.append(u);t.idUser=n.idUser;t.password=n.password;t.enabled=n.Enabled;t.isExpired=n.expired;t.isLocked=n.locked;$("#btn-passwordRandom",i).click(function(){$.when(t.dataService.generateRandomPassword()).done(function(n){$("#txtPasswordRequest",i).val(n.randomPassword)})});$("#btn-updateRequest",i).click(function(){var n=$("#txtPasswordRequest").val();r=t.validateKey();t.password=n;r?t.dataService.generateDataToSendByEmail({idUser:t.idUser}).done(function(n){t.showEmailtPopup(n);t.updateUser()}):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-request-emptyfields-message"),"Bizagi","warning")});$("#btn-cancelRequest",i).click(function(){t.setupInitialData()})},switchContent:function(n){var t=this;t.containtersID.DETAIL==n?(t.userRequestListWrapper.hide(),t.userRequestDetailWrapper.show()):(t.userRequestListWrapper.show(),t.userRequestDetailWrapper.hide())},updateUser:function(){var n=this,t=n.getContent(),i=$("#chkExpired",t).length==1?$("#chkExpired",t).is(":checked"):$("label[data-expired]",t).data("expired"),r={idUser:n.idUser,password:n.password,enabled:$("#chkActive").is(":checked"),expired:i,locked:$("#chkBlocked").is(":checked")};$.when(n.dataService.updateUserAuthenticationInfo(r)).done(function(){}).fail(function(n){bizagi.log(n)})},setupFooterButtons:function(){var n=this,t=n.getContent(),i=$("#users-request-data-buttonset-Password",t);$("#btn-passwordRandom",i).click(function(){$.when(n.dataService.generateRandomPassword()).done(function(n){$("#txtPasswordRequest",t).val(n.randomPassword)})})},showEmailtPopup:function(n){var t=this,u=window.document,f=t.getTemplate("users.requests.email"),i=t.dialogBoxEmail=$("<div class= users-requests-email/>"),r;i.empty();i.appendTo("body",u);r={};r[t.getResource("workportal-widget-admin-users-requests-button-label-send")]=function(){var n={eMailTo:$("#txtTextTo",i).val(),subject:$("#txtSubject",i).val(),body:$("#txtBody",i).val(),userSecret:t.getUserSecret(t.password)};$.when(t.dataService.sendUserEmail(n)).done(function(){t.closeUploadDialogEmail()});bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-request-Send-message"),"Bizagi","warning")};r[t.getResource("workportal-widget-admin-users-requests-button-label-notSend")]=function(){t.closeUploadDialogEmail()};n.body=n.body.replace(/\\n/g,"\n").replace(/\\/g,"");$.tmpl(f,{messageResponse:n}).appendTo(i);$(".ui-bizagi-loading-message").remove();i.dialog({width:500,title:t.getResource("workportal-widget-admin-users-request-subtitle-email"),modal:!0,buttons:r,close:function(){t.closeUploadDialogEmail()},resizeStop:function(n,i){t.form&&t.form.resize(i.size)}})},closeUploadDialogEmail:function(){var n=this;n.dialogBoxEmail.dialog("destroy");n.dialogBoxEmail.remove();n.setupInitialData()},validateKey:function(){var t=this,i=t.getContent(),n=!1;return $("#txtPasswordRequest",i).val()!==""&&(n=!0),n},getUserSecret:function(n){var t=CryptoJS,i=t.enc.Utf8.parse("pc30n84e15lvdD68"),r=CryptoJS.enc.Latin1.parse("1v00628X62bJE2mi"),u=t.algo.AES.createEncryptor(i,{mode:t.mode.CBC,padding:t.pad.Pkcs7,iv:r}),f=u.finalize(n);return t.enc.Base64.stringify(f)}});
bizagi.workportal.widgets.admin.defaults.assignation.user.extend("bizagi.workportal.widgets.admin.defaults.assignation.user",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"defaults.assignation.user":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user"),"defaults.assignation.user.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user-fields"),"defaults.assignation.user.search":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user-search"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.generalContent=n.getTemplate("defaults.assignation.user");n.fieldsContent=n.getTemplate("defaults.assignation.user.fields");n.searchContent=n.getTemplate("defaults.assignation.user.search")},postRender:function(){var n=this;n.maxElemShow=10;n.maxPageToShow=5;n.processNavigation=[];n.setupData()},setupData:function(){var n=this;n.setupInitialData();n.setupProcessTree()},setupInitialData:function(){var n=this,i=n.getContent(),t;n.processTree="";t=$.tmpl(n.fieldsContent,{});$("#defaults-assignation-user-home",i).append(t);n.setupSearchusersButton()},setupProcessTree:function(){var n=this,t=n.getContent();bizagi.treeRoutSelected=[];$("#treeLinksId").remove();$("#processTree",t).bind("processSelected",function(){n.setupAssignationToProcess()});n.processTree=new bizagi.workportal.widgets.processtree(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#processTree",t)}));n.processTree.render()},setupAssignationToProcess:function(){var n=this,t,i;content=n.getContent();t={};i=n.processTree.getTreeRouteSelected();i.length>0&&(t.idWfClass=i[0]);$.when(n.dataService.getDefaultAssignationUserToProcess(t)).done(function(n){$("#txtTextUserAssignation",content).val(n.user)})},setupUsersSearchForm:function(){var n=this,t=n.getContent(),i=$.Deferred();$("#defaults-assignation-user-home").hide();n.usersTable=new bizagi.workportal.widgets.userstable(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#dinamicContent",t),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-select-link")],parentDef:i}));n.usersTable.render();$.when(i).done(function(i,r){$("#dinamicContent",t).html("");$("#defaults-assignation-user-home",t).show();$("#txtTextUserAssignation",t).val(r);n.selectedUserId=i})},saveAssignation:function(){var n=this,t=n.getContent(),r=n.processTree.getTreeRouteSelected(),i={idWfClass:r.length>0?r[0]:-1,idUser:$("#txtTextUserAssignation",t).val()!=""?n.selectedUserId:-1};i.idWfClass==-1?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail-select-process"),"Bizagi","warning"):i.idUser==-1?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail-select-user"),"Bizagi","warning"):$.when(n.dataService.setDefaultAssignationUserToProcess(i)).done(function(i){i.assigned==="true"||i.assigned===!0?(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-ok"),"Bizagi","warning"),$("#txtTextUserAssignation",t).val(""),n.setupProcessTree()):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail"),"Bizagi","warning")}).fail(function(i){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail"),"Bizagi","warning");$("#txtTextUserAssignation",t).val("");n.setupProcessTree();bizagi.log(i)})},setupSearchusersButton:function(){var t=this,n=t.getContent();$("#btn-searchUser",n).click(function(){t.setupUsersSearchForm()});$("#btn-clearUser",n).click(function(){$("#txtTextUserAssignation",n).val("")});$("#btn-saveUser",n).click(function(){t.saveAssignation()})}});
bizagi.workportal.widgets.admin.user.profiles.extend("bizagi.workportal.widgets.admin.user.profiles",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"user.profiles":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles"),"user.profiles.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-fields"),"user.profiles.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-table"),"user.profiles.table.administrator":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-table-administrator"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.userProfilesFields=n.getTemplate("user.profiles.fields");n.userProfilesTable=n.getTemplate("user.profiles.table");n.userProfilesTableAdministrator=n.getTemplate("user.profiles.table.administrator")},postRender:function(){var n=this;n.maxElemShow=10;n.maxPageToShow=5;n.setupData()},setupData:function(){var n=this;n.setupInitialData()},setupInitialData:function(){var n=this,t=n.getContent();$.when(n.dataService.getProfilesTypes({dataType:"profiles"}),n.dataService.getOrganizationsList()).done(function(i,r){var u=$.tmpl(n.userProfilesFields,{profileList:i[0].response,orgList:r[0].response});n.comboDefaultValue=i[0].response[0].id;$("#general-content",t).html("");$("#general-content",t).append(u);n.setupMainButtons();n.setupProfileComboEvent();$("#dinamicContent",t).html("");$("#dinamicContent2",t).html("");$("#general-content",t).show()}).fail(function(n){bizagi.log(n)})},searchProfiles:function(){var n=this,t=n.getContent(),r=$("#txtTextnameProfile",t).val(),i;n.profileTypeId=$("#profileTypeList").val();n.profileTypeName=$("#profileTypeList option:selected").text();n.organizationId=n.profileTypeId=="8"?$("#organizationList",t).val():"";i={action:"searchProfiles",profileName:r,profileType:n.profileTypeId,orgId:n.organizationId};$.when(n.dataService.searchProfiles(i)).done(function(i){var r=$.tmpl(n.userProfilesTable,{profileList:i.response});$("#profilesTableId").remove();$("#general-content",t).append(r);n.setupManageLink()}).fail(function(n){bizagi.log(n)})},getUserByProfileId:function(n){var t=this,i=t.getContent();params={action:"getUsersByProfile",idProfile:n,profileType:t.profileTypeId};t.profileId=n;$("#general-content").hide();$.when(t.dataService.getUsersByProfile(params)).done(function(n){var r=$.tmpl(t.userProfilesTableAdministrator,{userList:n.users});$("#dinamicContent",i).hide();$("#dinamicContent2",i).html("");$("#dinamicContent2",i).append(r);t.setupManageButtons()}).fail(function(n){bizagi.log(n)})},removeUserFromProfile:function(n){var t=this,i=t.getContent();params={action:"removeUserFromProfile",idProfile:t.profileId,profileType:t.profileTypeId,idUser:n};$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-user-profiles-invalidate-confirm-msg"),"Bizagi","warning")).done(function(){$.when(t.dataService.removeUserFromProfile(params)).done(function(){t.getUserByProfileId(t.profileId)}).fail(function(n){bizagi.log(n)})})},setupUsersSearchForm:function(){var n=this,i=n.getContent(),t=$.Deferred();$("#dinamicContent2").html("");n.usersTable=new bizagi.workportal.widgets.userstable(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#dinamicContent2",i),userLinkLabel:[bizagi.localization.getResource("workportal-general-select")],parentDef:t}));n.usersTable.render();$.when(t).done(function(t){n.addUserToProfile(t)})},addUserToProfile:function(n){var t=this,r=t.getContent(),i={idProfile:t.profileId,profileType:t.profileTypeId,idUser:n};$.when(t.dataService.addUserToProfile(i)).done(function(){t.getUserByProfileId(t.profileId)}).fail(function(n){bizagi.log(n)})},setupMainButtons:function(){var n=this,t=n.getContent();$("#btn-searchUserProfiles",t).click(function(){n.searchProfiles()});$("#btn-clearUserProfiles",t).click(function(){$("#txtTextnameProfile",t).val("");$("#profileTypeList").val(n.comboDefaultValue);$("#profilesTableId",t).remove();n.setupProfileComboEvent()})},setupManageLink:function(){var n=this,t=n.getContent();$(".manageLink",t).click(function(){var t=this.getAttribute("id");n.profileId=t;n.getUserByProfileId(n.profileId)})},setupManageButtons:function(){var n=this,t=n.getContent();$("#btn-returnUserProfiles",t).click(function(){n.setupData()});$("#btn-newUserProfiles",t).click(function(){n.setupUsersSearchForm()});$(".deleteLink",t).click(function(){n.removeUserFromProfile($(this)[0].getAttribute("id"))})},setupProfileComboEvent:function(){var i=this,t=i.getContent(),n=$("#profileTypeList",t).find("option:selected").val();n=="8"&&$("#organizationListDiv").show();$("#profileTypeList",t).change(function(){n=$(this).find("option:selected").val();n=="8"?$("#organizationListDiv").show():$("#organizationListDiv").hide()})}});
bizagi.workportal.widgets.admin.dimensions.extend("bizagi.workportal.widgets.admin.dimensions",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({dimensions:bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions"),"dimensions.administrable":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-administrable"),"dimensions.properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-properties"),"dimensions.edit.properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-edit-properties"),"dimensions.process.tree":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-process-tree"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.generalContent=n.getTemplate("dimensions");n.listContent=n.getTemplate("dimensions.administrable");n.detailsContent=n.getTemplate("dimensions.properties");n.detailsEditContent=n.getTemplate("dimensions.edit.properties");n.detailsProcessTreeContent=n.getTemplate("dimensions.process.tree")},postRender:function(){var n=this;n.setupData()},setupData:function(){var n=this;n.setupInitialData()},setupInitialData:function(){var n=this,t=n.getContent(),i=$("#column-dimensions-admin-wrapper",t),r=$("#column-dimensions-properties-wrapper",t),u=$.tmpl(n.listContent,{}),f=$.tmpl(n.detailsContent,{});i.html(u);r.html(f);n.setupListProcessPanel1();n.setupListProcessPanel2();n.setupMainButtonsleft();n.setupMainButtonsRight()},setupDimensionsPanel1:function(n){var t=this,i=t.getContent(),r=$.Deferred();return $.when(t.dataService.getDimensions()).done(function(u){t.dimensions=u;var f=$("#DimenListAdmin",i),e=$("#DimenListFixed",i);$("dd",f).remove();$("dd",e).remove();$.each(u.dimensions,function(n,t){var i;bizagi.util.parseBoolean(t.administrable)?(i=f.find("dt#admin_"+t.idWfClass),i.append('<dd id="'+t.id+'" class="ddDimensionsSelect"><span>'+t.displayName+"<\/span><\/dd>")):(i=e.find("dt#fixed_"+t.guidWfClass.toLowerCase()),i.append('<dd id="'+t.guid+'" class="ddDimensionsSelect"><span>'+t.displayName+"<\/span><\/dd>"));i.show()});t.setupManageLink();n&&t.setupDimensionsPanel2();r.resolve()}),r.promise()},setupDimensionsPanel2:function(){var r=this,v=r.getContent();if(r.dimensions.dimensions.length>0){var n=r.dimensions.dimensions[0],e=n.description,o=n.displayName,s=n.id,h=n.guid||"",c=n.idWfClass,l=n.guidWfClass||"",u=n.administrable,a=n.name,f=4,t="",i=n.entityPath;for(r.fullPath=i,i=i.split(".");f<i.length;)t+=i[f]+".",f+=3;t=t.substring(0,t.length-1);$("#lblNameRead").text(a);$("#lblDisplayNameRead").text(o);$("#lblDescriptionRead").text(e);$("#lblPhatRead").text(t);u?($("#lblId").val(s),$("#lblidWfClass").val(c)):($("#lblId").val(h),$("#lblidWfClass").val(l));$("#lblIsAdministrable").val(u);bizagi.util.parseBoolean(u)||($("#btn-deleteDimensions").hide(),$("#btn-editDimensions").hide())}else $("#content-table-dimensions-admin").hide()},setupListProcessPanel1:function(){var n=this,t=n.getContent();$.when(n.dataService.getActiveWFClasses()).done(function(i){n.processList=i;var r=$("#DimenListAdmin",t),u=$("#DimenListFixed",t);$.each(i.WFClasses,function(n,t){r.append("<dt id=admin_"+t.id+' class="titleDimensionProcess">'+t.displayName+"<\/dt>");u.append("<dt id=fixed_"+t.guid+' class="titleDimensionProcess">'+t.displayName+"<\/dt>")});n.setupDimensionsPanel1(!0)})},setupListProcessPanel2:function(){var n=this,t=n.getContent();$.when(n.dataService.getActiveWFClasses()).done(function(n){$.each(n,function(n,t){$.each(t,function(n,t){var i=t,r=i.displayName;$("#lblProcessRead").text(r)})})})},displayDimensionsById:function(n){var t=this,i=t.getContent();$.each(t.dimensions.dimensions,function(i,r){return r.guid!==undefined&&r.guid.toLowerCase()===n.toLowerCase()?(t.fillFieldsWithSelectedDimension(r,n),!1):r.guid===undefined&&r.id==n?(t.fillFieldsWithSelectedDimension(r,n),!1):void 0});$("#content-table-dimensions-edit").remove();$("#content-table-dimensions-admin").show()},fillFieldsWithSelectedDimension:function(n,t){var u=this,l=u.getContent(),s=n.description,h=n.displayName,c=n.name,i=n.entityPath,e=n.idWfClass,o=n.administrable,f=4,r="";for(u.fullPath=i,i=i.split(".");f<i.length;)r+=i[f]+".",f+=3;r=r.substring(0,r.length-1);$("#lblNameRead").text(c);$("#lblDisplayNameRead").text(h);$("#lblDescriptionRead").text(s);$("#lblPhatRead").text(r);$("#lblId").val(t);$("#lblIsAdministrable").val(o);$("#lblidWfClass").val(e);u.displayProcessById(e);bizagi.util.parseBoolean(o)?($("#btn-deleteDimensions").show(),$("#btn-editDimensions").show(),$("#img_select_path").focus()):($("#btn-deleteDimensions").hide(),$("#btn-editDimensions").hide())},displayProcessById:function(n){var t=this,i=t.getContent();$.when(t.dataService.getActiveWFClasses()).done(function(t){$.each(t,function(t,i){$.each(i,function(t,i){var r=i,f=r.Id||r.id,u;if(n==f)return u=r.displayName,$("#lblProcessRead").text(u),!1})})})},newDimensionAdmin:function(){var n=this,t=$.tmpl(n.detailsEditContent,{processList:n.processList.WFClasses});n.action="create";$("#content-table-dimensions-edit").remove();$("#content-table-dimensions-admin").hide();$("#column-dimensions-properties-wrapper").append(t);n.setupManageButtons();n.processComboOnChange();$("#btn-newDimensions").unbind("click");n.setupPathLink()},validateData:function(){var t=this,n=t.getContent();return $("#txtNameEdit",n).val()==""?bizagi.localization.getResource("workportal-widget-admin-dimensions-text-name"):$("#txtDisplayNameEdit",n).val()==""?bizagi.localization.getResource("workportal-widget-admin-dimensions-text-displayName"):$("#txtPhatEdit",n).val()==""?bizagi.localization.getResource("workportal-widget-admin-dimensions-text-path"):"true"},applyDimensionsAdmin:function(){var n=this,o=n.getContent(),i=$("#txtDisplayNameEdit").val(),r=$("#txtNameEdit").val(),u=$("#processTypeList").val(),f=$("#txtDescriptionEdit").val(),e={displayName:i,name:r,idWfClass:u,entityPath:n.fullPath,description:f},t=n.validateData();t=="true"?$.when(n.dataService.createAdministrableDimension(e)).done(function(t){t.id?(n.setupMainButtonsleft(),$("#content-table-dimensions-edit").hide(),$("#content-table-dimensions-admin").show(),$.when(n.setupDimensionsPanel1(!1)).done(function(){n.displayDimensionsById(t.id)})):bizagi.showMessageBox(t.message,"Bizagi","warning")}).fail(function(n){var t=jQuery.parseJSON(n.responseText);bizagi.showMessageBox(t.message,"Bizagi","warning")}):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-dimensions-comfirm-message")+": "+t,"Bizagi","warning")},cancelDimensionsAdmin:function(){var n=this,t=n.getContent();$("#content-table-dimensions-edit").remove();n.dimensions.dimensions.length>0&&$("#content-table-dimensions-admin").show();n.setupMainButtonsleft()},deleteDimensionsAdmin:function(){var n=this,u=n.getContent(),t=$("#lblId").val(),i=$("#lblIsAdministrable").val(),r={id:t,administrable:i};$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-dimensions-invalidate-confirm-msg"),"Bizagi","warning")).done(function(){$.when(n.dataService.deleteDimension(r)).done(function(){n.setupData()}).fail(function(n){bizagi.log(n)})})},showEditInfo:function(){var n=this,t=$.tmpl(n.detailsEditContent,{processList:n.processList.WFClasses});n.action="edit";$("#content-table-dimensions-admin").hide();$("#column-dimensions-properties-wrapper").append(t);$("#processTypeList").val($("#lblidWfClass").val());$("#txtNameEdit").val($("#lblNameRead").text());$("#txtDisplayNameEdit").val($("#lblDisplayNameRead").text());$("#txtDescriptionEdit").val($("#lblDescriptionRead").text());$("#txtPhatEdit").val($("#lblPhatRead").text());n.setupManageButtons();n.processComboOnChange();n.setupMainButtonsleft();n.setupPathLink();$("#img_select_path.iconSelectPath").focus()},editDimensionsAdmin:function(){var n=this,s=n.getContent,t=$("#lblId").val(),r=$("#txtDisplayNameEdit").val(),u=$("#txtNameEdit").val(),f=$("#processTypeList").val(),e=$("#txtDescriptionEdit").val(),o={id:t,displayName:r,name:u,idWfClass:f,entityPath:n.fullPath,description:e},i=n.validateData();i=="true"?$.when(n.dataService.editDimension(o)).done(function(i){i.id?($("#lblidWfClass").val($("#processTypeList").val()),$("#lblNameRead").text($("#txtNameEdit").val()),$("#lblDisplayNameRead").text($("#txtDisplayNameEdit").val()),$("#lblDescriptionRead").text($("#txtDescriptionEdit").val()),$("#lblPhatRead").text($("#txtPhatEdit").val()),$("#lblId").val(t),$("#content-table-dimensions-edit").remove(),$("#content-table-dimensions-admin").show(),n.setupDimensionsPanel1(!1)):bizagi.showMessageBox(i.message,"Bizagi","warning")}).fail(function(n){var t=jQuery.parseJSON(n.responseText);bizagi.showMessageBox(t.message,"Bizagi","warning")}):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-dimensions-comfirm-message")+": "+i,"Bizagi","warning")},displayPath:function(){var n=this,t=n.getContent;$("#entities-tree-wrapper",t).show();$("#entities-tree-wrapper").draggable();$("#shadow-panel").css({width:$(".ui-dialog").width(),height:$(".ui-dialog").height(),"background-color":"grey",opacity:.1});n.setupEntitiesTree();n.setupEntitiesTreeButtons()},setupEntitiesTree:function(){var n=this,t=n.getContent();n.entitiesTree=new bizagi.workportal.widgets.entitiestree(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#tree-content",t),idWfClass:$("#lblidWfClass").val()}));n.entitiesTree.render()},setupMainButtonsleft:function(){var n=this,t=n.getContent();$("#btn-newDimensions",t).click(function(){n.newDimensionAdmin()})},setupMainButtonsRight:function(){var n=this,t=n.getContent();$("#btn-editDimensions",t).click(function(){n.showEditInfo()});$("#btn-deleteDimensions",t).click(function(){n.deleteDimensionsAdmin()})},setupManageButtons:function(){var n=this,t=n.getContent();$("#btn-applyDimensions",t).click(function(){n.action=="create"?n.applyDimensionsAdmin():n.editDimensionsAdmin()});$("#btn-cancelDimensions",t).click(function(){n.cancelDimensionsAdmin()})},setupManageLink:function(){var n=this,t=n.getContent();$(".ddDimensionsSelect",t).click(function(){var t=this.getAttribute("id");n.dimensionId=t;n.displayDimensionsById(n.dimensionId);n.setupMainButtonsleft()})},setupPathLink:function(){var n=this,t=n.getContent();$("#img_select_path").focus();$("#img_select_path",t).click(function(){n.displayPath()})},processComboOnChange:function(){var n=this,t=n.getContent();$("#processTypeList").click(function(){$("#txtPhatEdit").val("")})},setupEntitiesTreeButtons:function(){var t=this,n=t.getContent();$("#btn-close-tree",n).unbind("click").bind("click",function(){$("#entities-tree-wrapper",n).hide();$("#tree-content",n).html("");$("#shadow-panel").removeAttr("style")});$("#btn-cancel-tree",n).unbind("click").bind("click",function(){$("#entities-tree-wrapper",n).hide();$("#tree-content",n).html("");$("#shadow-panel").removeAttr("style")});$("#btn-save-tree",n).unbind("click").bind("click",function(){var i=t.entitiesTree.getTreeRouteSelected();t.fullPath=i.path;$("#txtPhatEdit",n).val(i.name);$("#entities-tree-wrapper",n).hide();$("#tree-content",n).html("");$("#shadow-panel").removeAttr("style")})}});
bizagi.workportal.widgets.admin.alarms.extend("bizagi.workportal.widgets.admin.alarms",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({alarms:bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms"),"alarms.task.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-list"),"alarms.task.list.item":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-list-item"),"alarms.task.detail":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail"),"alarms.task.detail.alarm.editor":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-alarm-editor"),"alarms.task.detail.list.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-list-table"),"alarms.task.detail.alarm.recipients":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-alarm-recipients"),"alarms.task.detail.alarm.recipients.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-alarm-recipients-table"),useNewEngine:!1})},postRender:function(){var n=this;n.containtersID={GENERAL:"general",DETAIL:"detail"};n.listID={APPLICATION:{name:"ListBoxApplication",update:"WORKFLOW",serviceMethod:"getApplicationCategoriesList"},WORKFLOW:{name:"ListBoxWFClass",update:"VERSION",serviceMethod:"getApplicationProcesses"},VERSION:{name:"ListBoxWFVersion",update:"TASKS",serviceMethod:"getProcessVersion"},TASKS:{name:"ListBoxWorkFlow",update:"",serviceMethod:"getProcessTasks"}};n.widgetMode={VIEW_MODE:"viewMode",EDIT_MODE:"editMode"};n.alertData={};n.taskListTmpl=n.getTemplate("alarms.task.list");n.taskListItemTmpl=n.getTemplate("alarms.task.list.item");n.taskDetailTmpl=n.getTemplate("alarms.task.detail");n.taskDetailAlarmEditor=n.getTemplate("alarms.task.detail.alarm.editor");n.taskListTableTmpl=n.getTemplate("alarms.task.detail.list.table");n.taskDetailAlarmRecipientsTmpl=n.getTemplate("alarms.task.detail.alarm.recipients");n.taskDetailAlarmRecipientsTableTmpl=n.getTemplate("alarms.task.detail.alarm.recipients.table");n.initRenderTaskList()},initRenderTaskList:function(){var n=this,t;n.switchContent(n.containtersID.GENERAL);t={action:"Applications"};$.when(n.dataService.getApplicationCategoriesList(t)).done(function(t){n.renderTaskList(t)})},renderTaskList:function(n){var t=this,r=this.getContent(),i=$("#form-alarm-task-list",r);i.empty();$.tmpl(t.taskListTmpl).appendTo(i);t.fillTaskListColumnByID("APPLICATION",n);$("#btn-alarms",i).click(function(){t.alertData&&t.alertData.idTask&&t.alertData.idTask!=""&&$.when(t.dataService.getTaskAlarms({idTask:t.alertData.idTask}),t.dataService.getLapseMode(),t.dataService.getRecurrMode(),t.dataService.getScheduleType(),t.dataService.getBossList()).done(function(n,i,r,u,f){t.renderTaskDetail();t.renderTaskListTable(n[0]);t.renderAlarmEditor(i[0],r[0],u[0]);t.renderAlarmRecipients(f[0],!0);t.switchContent(t.containtersID.DETAIL);t.switchWidgetMode(t.widgetMode.VIEW_MODE)})})},renderTaskDetail:function(){var n=this,i=this.getContent(),t=$("#form-alarm-task-detail",i);t.empty();var r=n.alertData.idAppText,u=n.alertData.idWFClassText,f=n.alertData.versionText,e=n.alertData.idTaskText,o=n.getTemplate("alarms.task.detail"),s=$.tmpl(o,{application:r,workflow:u,version:f,task:e});t.append(s).show();$("#btn-alarm-browser",t).click(function(){n.alertData={};n.initRenderTaskList()});$("#btn-disable-alarms",t).click(function(){n.callEnableDisableAlarmsService()});$("#btn-enable-alarms",t).click(function(){n.callEnableDisableAlarmsService()});$("#btn-save-changes",t).click(function(){var t=n.validateAlarmEditor();t==""?n.sendAlarmEditorData(!0):bizagi.showMessageBox(t,"Bizagi","warning")});$("#btn-back",t).click(function(){n.switchWidgetMode(n.widgetMode.VIEW_MODE);n.clearSelectedAlarm();n.resetAlarmEditor();n.resetAlarmRecipientsTable()});$("#btn-add-alarm",t).click(function(){var t=n.validateAlarmEditor();t==""?n.sendAlarmEditorData():bizagi.showMessageBox(t,"Bizagi","warning")})},renderAlarmEditor:function(n,t,i){var r=this,e=this.getContent(),u=$("#form-alarm-task-detail",e),f=$("#alarm-editor-form-wrapper",u);f.empty();r.alarmEditorData||(r.alarmEditorData={lapseModeList:n.lapseMode,recurrModeList:t.recurrMode,scheduleTypeList:i.scheduleType});$.tmpl(r.taskDetailAlarmEditor,{lapseModeList:r.alarmEditorData.lapseModeList,recurrModeList:r.alarmEditorData.recurrModeList,scheduleTypeList:r.alarmEditorData.scheduleTypeList}).appendTo(f);$("input:radio[name=RadioButtonListLapseMode]",u).on("change",function(n){r.handleRadioButtonFields(n.currentTarget)});$("input:radio[name=RadioButtonListRecurMode]",u).on("change",function(n){r.handleRadioButtonFields(n.currentTarget)});$("#TextBoxAlarmTime",u).on("change",function(n){r.validateInputFields(n.currentTarget)});$("#TextBoxRecurTime",u).on("change",function(n){r.validateInputFields(n.currentTarget)})},sendAlarmEditorData:function(n){var i=this,e=this.getContent(),o=$("#form-alarm-task-detail",e),r=$("#alarm-editor-form-wrapper",o),f=$("#CheckBoxToCurrentAssignee",r).is(":checked"),t={},u;t.idTask=i.alertData.idTask;t.idRecurrMode=$("input:radio[name=RadioButtonListRecurMode]:checked").val();t.idLapseMode=$("input:radio[name=RadioButtonListLapseMode]:checked").val();t.scheduleType=$("#DropDownListRecurTime",r).val();t.alarmTime=$("#TextBoxAlarmTime",r).val();t.alarmRecurrTime=$("#TextBoxRecurTime",r).val();t.alarmTime==""&&(t.alarmTime=0);t.alarmRecurrTime==""&&(t.alarmRecurrTime=0);f===!0?t.sendToCurrentAssignee=1:f===!1&&(t.sendToCurrentAssignee=0);n?(t.idAlarm=i.selectedAlarm.idAlarm,u="editAlarm"):u="addAlarm";$.when(i.dataService[u](t)).done(function(n){n.response&&i.refreshTaskListTable()})},refreshTaskListTable:function(){var n=this;n.clearSelectedAlarm();n.resetAlarmEditor();n.switchWidgetMode(n.widgetMode.VIEW_MODE);$.when(n.dataService.getTaskAlarms({idTask:n.alertData.idTask})).done(function(t){n.renderTaskListTable(t)})},refreshAlarmRecipientsTable:function(){var n=this,t={idAlarm:n.selectedAlarm.idAlarm};$.when(n.dataService.getAlarmRecipients(t)).done(function(t){n.renderAlarmRecipientsTable(t)})},renderTaskListTable:function(n){var t=this,r=this.getContent(),u=$("#form-alarm-task-detail",r),i=$("#alarm-list-table-wrapper",u);i.empty();$.tmpl(t.taskListTableTmpl,{alarmList:n.alarms}).appendTo(i);t.alarmsList=[].concat(n.alarms);t.alarmsList.length>0?t.alarmsList[0].active=="true"?t.switchEnableAlarms(!0):t.switchEnableAlarms(!1):t.switchEnableAlarms(!1);t.selectedAlarm=undefined;$(".edit",i).click(function(n){t.switchWidgetMode(t.widgetMode.EDIT_MODE);t.clearSelectedAlarm();$($(n.currentTarget).closest("tr")[0]).addClass("selected");t.fillAlarmDetailForm($(n.currentTarget).data("idalarm"));var i={idAlarm:$(n.currentTarget).data().idalarm};$.when(t.dataService.getAlarmRecipients(i)).done(function(n){t.renderAlarmRecipientsTable(n)})});$(".delete",i).click(function(n){var i=$(n.currentTarget).data("idalarm");$.when(t.dataService.deleteAlarm({idAlarm:i})).done(function(n){n.response===!0&&(t.switchWidgetMode(t.VIEW_MODE),t.refreshTaskListTable())})})},clearSelectedAlarm:function(){var n=this,t=this.getContent(),i=$("#alarm-list-table-wrapper",t);$("tr",i).removeClass("selected");n.selectedAlarm=undefined},resetAlarmEditor:function(){for(var i=this,r=this.getContent(),n=$("#alarm-editor-form-wrapper",r),t=$("input[name = RadioButtonListLapseMode]",n).length+1;t-->1;)$("input[name=RadioButtonListLapseMode][value="+t+"]",n)[0].checked=!1,$("input[name=RadioButtonListRecurMode][value="+t+"]",n)[0].checked=!1;$("#TextBoxAlarmTime",n).val("");$("#TextBoxRecurTime",n).val("");$("#DropDownListRecurTime",n).val("1");$("#CheckBoxToCurrentAssignee",n).attr("checked",!1);i.resetAlarmRecipientsTable()},resetAlarmRecipientsTable:function(){var i=this,n=this.getContent(),t=$("#alarm-recipients-table-wrapper",n);t.empty();$("#DropDownListRecipients",n).val(0)},renderAlarmRecipients:function(n){var t=this,u=this.getContent(),r=$("#form-alarm-task-detail",u),i=$("#alarm-recipients-form-wrapper",r);$.tmpl(t.taskDetailAlarmRecipientsTmpl,{bossList:n.bosses}).appendTo(i);$("#btn-add-recipient",i).click(function(){if(t.currentWidgetMode==t.widgetMode.EDIT_MODE){var n={idRecipient:$("#DropDownListRecipients",i).val(),idAlarm:t.selectedAlarm.idAlarm};$.when(t.dataService.addRecipientToAlarm(n)).done(function(n){n.response===!0?t.refreshAlarmRecipientsTable():bizagi.showMessageBox("Dato ya ingresado","Bizagi","warning")})}});$("#btn-delete-recipient",i).click(function(){var f,n,i,u,e,o;if(t.currentWidgetMode==t.widgetMode.EDIT_MODE&&(f=$("#alarm-recipients-table-wrapper",r),n=$("input:checked",f),n.length>0)){for(i=[],u=n.length;u-->0;)i.push($(n[u]).data("idrecipient"));e=JSON.stringify({recipients:i});o={idRecipients:e};$.when(t.dataService.deleteRecipientsFromAlarm(o)).done(function(n){n.deletedRecipients.length>0&&t.refreshAlarmRecipientsTable()})}})},renderAlarmRecipientsTable:function(n){var i=this,r=this.getContent(),u=$("#form-alarm-task-detail",r),t=$("#alarm-recipients-table-wrapper",u);t.empty();$.tmpl(i.taskDetailAlarmRecipientsTableTmpl,{recipientsList:n.recipients}).appendTo(t)},fillAlarmDetailForm:function(n){for(var r=this,f=this.getContent(),e=$("#form-alarm-task-detail",f),i=$("#alarm-editor-form-wrapper",e),u=r.alarmsList.length,t;u-->0;)if(r.alarmsList[u].idAlarm==n){t=r.alarmsList[u];break}r.selectedAlarm=t;$("input[name=RadioButtonListLapseMode][value="+t.idLapseMode+"]",i)[0].checked=!0;$("input[name=RadioButtonListRecurMode][value="+t.idRecurrMode+"]",i)[0].checked=!0;$("#TextBoxAlarmTime",i).val(t.alarmTime);$("#TextBoxRecurTime",i).val(t.alarmRecurrTime);$("#DropDownListRecurTime",i).val(t.idScheduleType);$("#CheckBoxToCurrentAssignee",i).prop("checked",t.sendToCurrAssignee)},handleRadioButtonFields:function(n){var u=this,r=this.getContent(),t=$("#alarm-editor-form-wrapper",r),i=n.value;n.name=="RadioButtonListLapseMode"?i!=2?$("#TextBoxAlarmTime",t).attr("disabled",!1):($("#TextBoxAlarmTime",t).val(""),$("#TextBoxAlarmTime",t).attr("disabled",!0)):n.name=="RadioButtonListRecurMode"&&(i!=1?($("#TextBoxRecurTime",t).attr("disabled",!0),$("#TextBoxRecurTime",t).val("")):$("#TextBoxRecurTime",t).attr("disabled",!1))},validateInputFields:function(n){var s=this,f=this.getContent(),h=$("#alarm-editor-form-wrapper",f),u="",t=parseInt(n.value),i,r,e,o;isNaN(t)?n.value="":t<0?n.value=t*-1:n.id=="TextBoxAlarmTime"?(i=$($("input:radio[name=RadioButtonListLapseMode][checked=checked]")[0]).val(),r=t,i!=2&&r>0||(u="Unless the selected lapse mode is On Expiration the alarm time cannot be empty")):n.id=="TextBoxRecurTime"&&(e=$($("input:radio[name=RadioButtonListRecurMode][checked=checked]")[0]).val(),o=t,i==1&&r>0||(u="Please review the Alarm Editor fields, the folowing are empty or unselected"))},validateAlarmEditor:function(){var o=this,e=this.getContent(),n="",f=$("#alarm-editor-form-wrapper",e),r=$("input:radio[name=RadioButtonListLapseMode]:checked").val(),t=$("#TextBoxAlarmTime",f).val(),u=$("input:radio[name=RadioButtonListRecurMode]:checked").val(),i=$("#TextBoxRecurTime",f).val();return r?r!=2&&t>0||r==2&&(t==""||t==0)||(n+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-on-expiration")+"<\/li>"):(n+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-lapse")+"<\/li>",t==""&&(n+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-timing")+" - "+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-lapse")+"<\/li>")),u?u!=1&&(i==""||i==0)||u==1&&i>0||(n+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-each-recurr")+"<\/li>"):(n+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-alarm-recur")+"<\/li>",i==""&&(n+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-timing")+" - "+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-alarm-recur-time")+"<\/li>")),n!=""&&(n=bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-review")+"<\/br><\/br> <ul>"+n+"<\/ul>"),n},fillTaskListColumnByID:function(n,t){var i=this,u=this.getContent(),f=i.listID[n],e=$("#form-alarm-task-list",u),r=$("#"+f.name,e);switch(n){case"APPLICATION":$.tmpl(i.taskListItemTmpl,{taskField:n,elementList:t.items}).appendTo(r);break;case"WORKFLOW":$.tmpl(i.taskListItemTmpl,{taskField:n,elementList:t.processes}).appendTo(r);break;case"VERSION":$.tmpl(i.taskListItemTmpl,{taskField:n,elementList:t.versions}).appendTo(r);break;case"TASKS":$.tmpl(i.taskListItemTmpl,{taskField:n,elementList:t.tasks}).appendTo(r)}r.unbind("change");r.bind("change",function(n){i.updateListsContent(n.currentTarget)})},updateListsContent:function(n){var t=this,u=t.getListCategoryByID(n.id),i,r;t.captureSelectedData(u,n);i=t.getElementToUpdate(n.id);i!=""&&(r={},t.processLists(n.id),r=t.setupParametersbyListID(i),$.when(t.dataService[t.listID[i].serviceMethod](r)).done(function(n){t.fillTaskListColumnByID(i,n)}))},captureSelectedData:function(n,t){var i=this;switch(n){case"APPLICATION":i.alertData.idApp=$(t.options[t.selectedIndex]).val();i.alertData.idAppText=t.options[t.selectedIndex].text;break;case"WORKFLOW":i.alertData.idWFClass=$(t.options[t.selectedIndex]).val();i.alertData.idWFClassText=t.options[t.selectedIndex].text;break;case"VERSION":i.alertData.version=$(t.options[t.selectedIndex]).val();i.alertData.versionText=t.options[t.selectedIndex].text;break;case"TASKS":i.alertData.idTask=$(t.options[t.selectedIndex]).val();i.alertData.idTaskText=t.options[t.selectedIndex].text}},setupParametersbyListID:function(n){var i=this,t={};switch(n){case"APPLICATION":t={action:"getApplications"};break;case"WORKFLOW":t.idApp=i.alertData.idApp;break;case"VERSION":t.idWFClass=i.alertData.idWFClass;break;case"TASKS":t.idWFClass=i.alertData.idWFClass;t.version=i.alertData.version}return t},resetParametersbyListID:function(n){var t=this;switch(n){case"APPLICATION":t.alertData.idApp="";break;case"WORKFLOW":t.alertData.idWFClass="";break;case"VERSION":t.alertData.version="";break;case"TASKS":t.alertData.idTask=""}},processLists:function(n){var i=this,u=i.getContent(),r=$("#form-alarm-task-list",u),t=i.getElementToUpdate(n);if(t!="")for($("#"+i.listID[t].name,r).empty(),i.resetParametersbyListID(t);t!="";)t=i.getElementToUpdate(i.listID[t].name),t!=""&&($("#"+i.listID[t].name,r).empty(),$("#"+i.listID[t].name,r).empty())},getElementToUpdate:function(n){var t=this,i=t.getListCategoryByID(n);return t.listID[i].update},getListCategoryByID:function(n){var t=this;for(var i in t.listID)if(n==t.listID[i].name)return i;return""},callEnableDisableAlarmsService:function(){var n=this,t={idTask:n.alertData.idTask};$.when(n.dataService.enableAlarm(t)).done(function(t){t.response===!0&&(n.switchEnableAlarms(),n.refreshTaskListTable())})},switchEnableAlarms:function(n){var i=this,r=i.getContent(),t=$("#form-alarm-task-detail",r);n?($("#btn-enable-alarms",t).hide(),$("#btn-disable-alarms",t).show()):($("#btn-enable-alarms",t).show(),$("#btn-disable-alarms",t).hide())},switchContent:function(n){var t=this,i=t.getContent(),r=$("#form-alarm-task-list",i),u=$("#form-alarm-task-detail",i);t.containtersID.DETAIL==n?(r.hide(),u.show()):(r.show(),u.hide())},switchWidgetMode:function(n){var i=this,r=i.getContent(),u=$("#form-alarm-task-list",r),t=$("#form-alarm-task-detail",r);switch(n){case i.widgetMode.VIEW_MODE:$("#btn-save-changes",t).hide();$("#btn-back",t).hide();$("#btn-delete-recipient",t).show();$("#alarm-recipients-table-content",t).show();$("#btn-add-recipient",t).show();$("#btn-add-alarm",t).show();break;case i.widgetMode.EDIT_MODE:$("#btn-save-changes",t).show();$("#btn-back",t).show();$("#btn-delete-recipient",t).show();$("#alarm-recipients-table-content",t).show();$("#btn-add-recipient",t).show();$("#btn-add-alarm",t).hide()}i.currentWidgetMode=n}});
bizagi.workportal.widgets.admin.user.licenses.extend("bizagi.workportal.widgets.admin.user.licenses",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"user.licenses":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.licenses").concat("#ui-bizagi-workportal-widget-admin-user-licenses"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.generalContent=n.getTemplate("user.licenses")},postRender:function(){var n=this;n.setupData()},setupData:function(){var n=this;n.setupInitialData();n.setupButton()},setupInitialData:function(){var n=this,t=n.getContent();$.when(n.dataService.licenses()).done(function(n){var t;n.licenseType=="none"?($("#licenseAlert").show(),$("#licenseContent").hide()):($("#licenseContent").show(),$("#licenseAlert").hide(),t=n.expirationDate==""?"12/31/9999":n.expirationDate.substring(0,11),n.licenseType=="Volume"?$("#users").text(n.activeUsers+" "+bizagi.localization.getResource("workportal-widget-admin-user-licenses-titles-usersLicenses-text")):$("#users").text(n.activeUsers+"/"+n.licensedUsersAccount+"  "+bizagi.localization.getResource("workportal-widget-admin-user-licenses-titles-usersLicenses-text")),$("#licenses").text(n.customerName),$("#date").text(t),$("#licenseType").text(n.licenseType),$("#licenseCluster").text(n.clustered))})},setupButton:function(){var n=this,t=n.getContent();$("#btn-buyNowLicenses",t).click(function(){window.open("http://www.bizagi.com/","name","height=600,width=800")});$("#btn-auditLicenses",t).click(function(){$.when(n.dataService.getAuditLicense()).done(function(){}).fail(function(){})})}});
bizagi.workportal.widgets.admin.document.templates.extend("bizagi.workportal.widgets.admin.document.templates",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.document.templates":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates"),"admin.document.templates.upload.template":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates-upload-template"),"admin.document.templates.uploaded.templates.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates-uploaded-template-list"),useNewEngine:!1})},postRender:function(){var n=this;n.uploadTemplateTmpl=n.getTemplate("admin.document.templates.upload.template");n.uploadedTemplatesTmpl=n.getTemplate("admin.document.templates.uploaded.templates.list");n.lockedInteractions=!1;n.config={maxSize:"31457280",validExtensions:".bdt",xpath:"documentTemplates",uploadDialogTemplateName:"upload.template.dialog"};n.renderUploadForm();n.initUploadedTemplates()},initUploadedTemplates:function(){var n=this,t=n.getContent(),i=$("#uploaded-template-list-wrapper",t);i.empty();$.when(n.dataService.storeDocumentTemplates()).done(function(t){n.renderUploadedTemplates(t)})},renderUploadForm:function(){var n=this,i=n.getContent(),r=$("#template-upload-form-wrapper",i),t;$.tmpl(n.uploadTemplateTmpl).appendTo(r);t=typeof n.dataService.serviceLocator.proxyPrefix!=undefined?n.dataService.serviceLocator.proxyPrefix:"";bizagi.loader.start("rendering").then(function(){var i=new bizagi.rendering.facade({proxyPrefix:t});n.dialogTemplate=i.deviceFactory.cachedFactory.getTemplate(n.config.uploadDialogTemplateName);n.dialogTemplate?n.addFormInteractions():$.when(i.deviceFactory.getRenderFactory()).done(function(){n.dialogTemplate=i.deviceFactory.cachedFactory.getTemplate(n.config.uploadDialogTemplateName);n.addFormInteractions()})})},renderUploadedTemplates:function(n){var t=this,r=t.getContent(),i=$("#uploaded-template-list-wrapper",r);i.empty();$.tmpl(t.uploadedTemplatesTmpl,{documentTemplates:n.documentTemplate}).appendTo(i);$(".template-to-recover",i).click(function(n){if(n.preventDefault(),!t.lockedInteractions){t.lockedInteractions=!0;var i={Guid:$(n.currentTarget).data("guid")};$.when(t.dataService.restoreDocumentTemplates(i)).done(function(n){t.lockedInteractions=!1;n.DocumentTemplateRestored&&(t.initUploadedTemplates(),t.displayMessage(n))})}})},addFormInteractions:function(){var t=this,r=t.getContent(),n={},i;n.addUrl=t.dataService.serviceLocator.getUrl("admin-document-templates-uploadDocumentTemplate");n.xpath=t.config.xpath;n.idRender="";n.xpathContext="";n.idPageCache="";n.sessionId="";n.validExtensions=t.config.validExtensions;n.maxSize=t.config.maxSize;n.contexttype="";n.maxfiles="1";n.filesCount="";i=$("#template-upload-form-wrapper",r);$(".ui-bizagi-render-upload-wrapper",i).bizagiUpload({renderReference:this,dialogTemplate:t.dialogTemplate,properties:{url:n.addUrl,xpath:n.xpath,idRender:n.idRender,xpathContext:n.xpathContext,idPageCache:n.idPageCache,idSession:n.sessionId,validExtensions:n.validExtensions,maxSize:n.maxSize,contexttype:n.contexttype},onUploadFileCompletedCallback:function(n,i){t.displayMessage(JSON.parse(i));t.initUploadedTemplates()},maxAllowedFiles:n.maxfiles,uploadedFiles:n.filesCount,dialogTitle:t.getResource("render-upload-link-label")})},displayMessage:function(n){var i=this,r=i.getContent(),t=$("#message-container",r);t.show();n.DocumentTemplateRestored==!0?($("#template-uploaded",t).hide(),$("#template-recovered",t).show(),$("#template-no-results",t).hide()):n.DocumentTemplateUploaded==!0?($("#template-uploaded",t).show(),$("#template-recovered",t).hide(),$("#template-no-results",t).hide()):($("#template-uploaded",t).hide(),$("#template-recovered",t).hide(),$("#template-no-results",t).show())}});
bizagi.workportal.widgets.admin.processes.extend("bizagi.workportal.widgets.admin.processes",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.processes.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-wrapper"),"admin.processes.combo.process":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-combo-process"),"admin.processes.proc.edit":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-process-edit"),"admin.processes.task.edit":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-task-edit"),useNewEngine:!1})},postRender:function(){var n=this;n.formType={TASK_FORM:"task",PROCESS_FORM:"process"};n.containersMode={VIEW_MODE:"viewMode",EDIT_MODE:"editMode"};$.when(n.dataService.getWorkFlowClasses()).done(function(t){n.processesData=t;n.renderSections()})},renderSections:function(){var n=this,u=n.getContent(),r=$("#processes-header-wrapper",n.content),t,i;$.tmpl(n.comboProcess).appendTo(r);t=$("#admin-processes-map-wrapper",n.content);i=$("#ui-process-name",n.content);n.renderProcessesCombo(i);n.renderProcessesEditWrapper();n.loadProcessData("1");n.renderTaskEditWrapper();n.displayTaskEdit(!1);n.renderProcessViewer(t)},loadProcessData:function(n){var t=this,i=t.processesData.processes.length,r;for(t.currentSelectedProcessData={};i-->0;)if(n==t.processesData.processes[i].id){t.currentSelectedProcessData=t.processesData.processes[i];break}t.bindProcessDetail();r={idWorkflow:n};$.when(t.dataService.getTaskByWorkFlow(r)).done(function(n){t.processTaskData=n})},renderProcessViewer:function(n){var t=this,i="processId="+t.currentSelectedProcessData.id,r;t.viewerPlugin&&t.viewerPlugin.processviewer("destroy");r=t.dataService;$.when(t.dataService.processDefinition(i),t.dataService.graphicInfo(i)).done(function(i,r){t.processTaskDefinition=i[0].flowElements;t.viewerPlugin=n.processviewer({height:400,width:"100%",jsonBizagi:{processDefinition:i[0],processGraphicsInfo:r[0]},zoomRange:5});setTimeout(function(){$(".processviewer-hotspot").click(function(n){n.preventDefault();t.preprocessBindTaskDetail(this.id)})},150)})},renderProcessesCombo:function(n){var t=this,u=t.getContent(),r=$.Deferred(),i={combo:[],id:"processName"};return $.each(t.processesData.processes,function(n,t){i.combo.push({id:t.id,name:t.name})}),n.empty(),n.uicombo({isEditable:!1,data:i,itemValue:function(n){return n.id},itemText:function(n){return n.name},onComplete:function(){r.resolve()},onChange:function(n){t.loadProcessData(n.ui.data("value"));t.loadSelectedTask(n.ui.data("value"),-1)},initValue:i.combo[0]}),r},renderProcessesEditWrapper:function(){var n=this,i=n.getContent(),t=$("#process-edit-wrapper",i);$.tmpl(n.processEditTmpl).appendTo(t);n.switchFormState(n.formType.PROCESS_FORM,n.containersMode.VIEW_MODE);$("#btn-process-edit",t).click(function(){n.switchFormState(n.formType.PROCESS_FORM,n.containersMode.EDIT_MODE)});$("#btn-process-apply",t).click(function(){n.saveProcess();n.switchFormState(n.formType.PROCESS_FORM,n.containersMode.VIEW_MODE)});$("#btn-process-cancel",t).click(function(){n.switchFormState(n.formType.PROCESS_FORM,n.containersMode.VIEW_MODE)});$("#txt-process-duration-edit-days",t).on("change",function(){$(this).val(n.correctIntegerInInput($(this).val(),0,1e3,0))});$("#txt-process-duration-edit-hours",t).on("change",function(){$(this).val(n.correctIntegerInInput($(this).val(),0,23,0))});$("#txt-process-duration-edit-minutes",t).on("change",function(){$(this).val(n.correctIntegerInInput($(this).val(),0,59,0))})},renderTaskEditWrapper:function(){var n=this,i=n.getContent(),t=$("#task-edit-wrapper",i);$.tmpl(n.taskEditTmpl).appendTo(t);n.switchFormState(n.formType.TASK_FORM,n.containersMode.VIEW_MODE);$("#btn-task-edit",t).click(function(){n.switchFormState(n.formType.TASK_FORM,n.containersMode.EDIT_MODE)});$("#btn-task-apply",t).click(function(){n.saveTask();n.switchFormState(n.formType.TASK_FORM,n.containersMode.VIEW_MODE)});$("#btn-task-cancel",t).click(function(){n.switchFormState(n.formType.TASK_FORM,n.containersMode.VIEW_MODE)});$("#txt-task-duration-edit-days",t).on("change",function(){$(this).val(n.correctIntegerInInput($(this).val(),0,1e3,0))});$("#txt-task-duration-edit-hours",t).on("change",function(){$(this).val(n.correctIntegerInInput($(this).val(),0,23,0))});$("#txt-task-duration-edit-minutes",t).on("change",function(){$(this).val(n.correctIntegerInInput($(this).val(),0,59,0))})},bindProcessDetail:function(){var n=this,i=n.getContent(),t=$("#process-edit-wrapper",i);n.switchFormState(n.formType.PROCESS_FORM,n.containersMode.VIEW_MODE);n.parseObjectTime(n.currentSelectedProcessData);$("#process-name",t).text(n.currentSelectedProcessData.name);$("#process-description",t).text(n.currentSelectedProcessData.description);$("#process-duration",t).text(n.currentSelectedProcessData.durationText);$("#txt-process-duration-edit-days",t).val(n.currentSelectedProcessData.durationDays);$("#txt-process-duration-edit-hours",t).val(n.currentSelectedProcessData.durationHours);$("#txt-process-duration-edit-minutes",t).val(n.currentSelectedProcessData.durationMinutes);n.currentSelectedTaskData=undefined;n.displayTaskEdit(!1)},preprocessBindTaskDetail:function(n){var t=this,i=t.getTaskByID(n);i?t.bindTaskDetail(i):t.displayTaskEdit(!1)},bindTaskDetail:function(n){var t=this,u=t.getContent(),i=$("#task-edit-wrapper",u),r=n;t.shouldShowTaskProperties(r)?(t.displayTaskEdit(!0),t.switchFormState(t.formType.PROCESS_FORM,t.containersMode.VIEW_MODE),t.switchFormState(t.formType.TASK_FORM,t.containersMode.VIEW_MODE),t.parseObjectTime(r),t.currentSelectedTaskData=r,$("#task-name",i).text(t.currentSelectedTaskData.name),$("#task-description",i).text(t.currentSelectedTaskData.description),$("#task-duration",i).text(t.currentSelectedTaskData.durationText),$("#txt-task-duration-edit-days",i).val(t.currentSelectedTaskData.durationDays),$("#txt-task-duration-edit-hours",i).val(t.currentSelectedTaskData.durationHours),$("#txt-task-duration-edit-minutes",i).val(t.currentSelectedTaskData.durationMinutes)):(t.currentSelectedTaskData=undefined,t.displayTaskEdit(!1))},getTaskByID:function(n){for(var t=this,i=t.processTaskData.Tasks.length;i-->0;)if(n==t.processTaskData.Tasks[i].guid)return t.processTaskData.Tasks[i]},shouldShowTaskProperties:function(n){return n.idTaskType&&(n.idTaskType==2||n.idTaskType==7||n.idTaskType==14||n.idTaskType==21||n.idTaskType==38||n.idTaskType==39||n.idTaskType==41)},displayTaskEdit:function(n){var i=this,r=i.getContent(),t=$("#task-edit-wrapper",r);n?t.show():t.hide()},switchFormState:function(n,t){var r=this,i=r.getContent();switch(t){case r.containersMode.VIEW_MODE:n==r.formType.PROCESS_FORM?($("#process-view-fields-wrapper",i).show(),$("#process-edit-fields-wrapper",i).hide()):n==r.formType.TASK_FORM&&($("#task-view-fields-wrapper",i).show(),$("#task-edit-fields-wrapper",i).hide());break;case r.containersMode.EDIT_MODE:n=="process"?($("#process-view-fields-wrapper",i).hide(),$("#process-edit-fields-wrapper",i).show()):n==r.formType.TASK_FORM&&($("#task-view-fields-wrapper",i).hide(),$("#task-edit-fields-wrapper",i).show())}},loadSelectedTask:function(){var n=this,i=n.getContent(),t=$("#admin-processes-map-wrapper",n.content);n.renderProcessViewer(t)},correctIntegerInInput:function(n,t,i,r){var f=this,u=f.tryParseInt(n,r);return u<t?t:u>i?i:u},tryParseInt:function(n,t){var i=t;return n!=null&&jQuery.trim(new String(n)).length>0&&(isNaN(n)||(i=parseInt(n))),i},saveProcess:function(){var n=this,u=n.getContent(),t=$("#process-edit-wrapper",u),r=n.getMinutesFromTimeUnits($("#txt-process-duration-edit-days",t).val(),$("#txt-process-duration-edit-hours",t).val(),$("#txt-process-duration-edit-minutes",t).val()),i={};i.idWorkflow=n.currentSelectedProcessData.id;i.duration=r;r!=NaN&&$.when(n.dataService.modifyProcessDuration(i)).done(function(t){t.workflow&&(n.currentSelectedProcessData.duration=t.workflow.duration,n.bindProcessDetail())})},saveTask:function(){var n=this,u=n.getContent(),t=$("#task-edit-wrapper",u),r=n.getMinutesFromTimeUnits($("#txt-task-duration-edit-days",t).val(),$("#txt-task-duration-edit-hours",t).val(),$("#txt-task-duration-edit-minutes",t).val()),i={};i.idTask=n.currentSelectedTaskData.id;i.duration=r;r!=NaN&&$.when(n.dataService.modifyTaskDuration(i)).done(function(t){t.task&&(n.currentSelectedTaskData.duration=t.task.duration,n.bindTaskDetail(n.currentSelectedTaskData))})},getMinutesFromTimeUnits:function(n,t,i){return parseInt(n)*480+parseInt(t)*60+parseInt(i)},parseObjectTime:function(n){var i=this,t=i.getTimeArrayFromMinutes(n.duration);n.durationText=i.getDurationStringFromMinutes(n.duration);n.durationDays=t[0];n.durationHours=t[1];n.durationMinutes=t[2]},getTimeArrayFromMinutes:function(n){var i=this;n=i.tryParseInt(n,0);var t=480,r=n/t|0,u=n%t/60|0,f=n%60;return[r,u,f]},getDurationStringFromMinutes:function(n){var r=this,t=r.getTimeArrayFromMinutes(n),i=t[0]+bizagi.localization.getResource("workportal-widget-processes-field-abreviation-day")+" ";return i+=t[1]+bizagi.localization.getResource("workportal-widget-processes-field-abreviation-hour")+":",i+(t[2]+bizagi.localization.getResource("workportal-widget-processes-field-abreviation-minute"))},displayTaskEdit:function(n){var i=this,r=i.getContent(),t=$("#task-edit-wrapper",r);n?t.show():t.hide()}});
bizagi.workportal.widgets.admin.business.policies.extend("bizagi.workportal.widgets.admin.business.policies",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.business.policies.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-wrapper"),"admin.business.policies.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-content"),useNewEngine:!1})},postRender:function(){var n=this;n.setupData()},setupData:function(){var n=this,t=n.getContent(),i=$.tmpl(n.generalContentTmpl,{});t.append(i)},setupPoliciesTree:function(){var n=this,t=n.getContent();bizagi.treeRoutSelected=[];$("#treeLinksId").remove();n.processTree=new bizagi.workportal.widgets.tree(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#processTree",t)}));n.processTree.render()}});
bizagi.workportal.widgets.admin.business.policies.decision.table.extend("bizagi.workportal.widgets.admin.business.policies.decision.table",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.business.policies.decision.table.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-decision-table-wrapper"),"admin.business.policies.decision.table.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-decision-table-content"),useNewEngine:!1})},renderContent:function(){var n=this,i=n.getTemplate("admin.business.policies.decision.table.wrapper"),t;return n.decisionTableContent=n.getTemplate("admin.business.policies.decision.table.content"),t=n.content=$.tmpl(i,{}),n.params.canvas&&(t=$(n.params.canvas).append(t)),t},postRender:function(){var n=this}});
bizagi.workportal.widgets.admin.business.policies.rules.extend("bizagi.workportal.widgets.admin.business.policies.rules",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.business.policies.rules.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-rules-wrapper"),"admin.business.policies.rules.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-rules-content"),useNewEngine:!1})},renderContent:function(){var n=this,i=n.getTemplate("admin.business.policies.rules.wrapper"),t;return n.decisionTableContent=n.getTemplate("admin.business.policies.rules.content"),t=n.content=$.tmpl(i,{}),n.params.canvas&&(t=$(n.params.canvas).append(t)),t},postRender:function(){var n=this}});
bizagi.workportal.widgets.admin.business.policies.tabs.extend("bizagi.workportal.widgets.admin.business.policies.tabs",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.business.policies.tabs.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-tabs-wrapper"),"admin.business.policies.tabs.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-tabs-content"),useNewEngine:!1})},renderContent:function(){var n=this,i=n.getTemplate("admin.business.policies.tabs.wrapper"),t;return n.decisionTableContent=n.getTemplate("admin.business.policies.tabs.content"),t=n.content=$.tmpl(i,{}),n.params.canvas&&(t=$(n.params.canvas).append(t)),t},postRender:function(){var n=this}});
bizagi.workportal.widgets.admin.business.policies.politics.extend("bizagi.workportal.widgets.admin.business.policies.politics",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.business.policies.politics.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-politics-wrapper"),"admin.business.policies.politics.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-politics-content"),useNewEngine:!1})},renderContent:function(){var n=this,i=n.getTemplate("admin.business.policies.politics.wrapper"),t;return n.decisionTableContent=n.getTemplate("admin.business.policies.politics.content"),t=n.content=$.tmpl(i,{}),n.params.canvas&&(t=$(n.params.canvas).append(t)),t},postRender:function(){var n=this}});
bizagi.workportal.widgets.admin.language.extend("bizagi.workportal.widgets.admin.language",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.language.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-wrapper"),"admin.language.panel.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-panel-wrapper"),"admin.language.template.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-template-list"),"admin.language.upload.file.culturename":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-combo-culturename"),"admin.language.bizagi.objects.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-bizagi-objects-list"),"admin.language.entities.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-entities-list"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.config={maxSize:"10000000",validExtensions:".xlsx",uploadFormTemplateName:"bizagi.workportal.desktop.fileupload.form",cultureName:"en"};n.generalUploadFile=n.workportalFacade.getTemplate("admin.language.upload.file");n.formTemplate1=n.workportalFacade.getTemplate(n.config.uploadFormTemplateName);n.formTemplate2=n.workportalFacade.getTemplate(n.config.uploadFormTemplateName);n.formTemplate3=n.workportalFacade.getTemplate(n.config.uploadFormTemplateName);n.formTemplate4=n.workportalFacade.getTemplate(n.config.uploadFormTemplateName)},postRender:function(){var n=this,t=n.getContent();n.startTab="entities";n.loadtemplates();n.setupData();$.when(n.initLanguageTemplatesList(n.startTab)).done(function(){n.renderUploadForm();n.initBizagiObjectsList();n.initEntities();t.html(n.panelWrapper);session.isProduction||$("#tab_reset").parent().addClass("hidden");$("#admin-language-wrapper").tabs();$("#entities_internal_tabs").tabs({create:function(n,t){t.tab.parent().removeClass("hidden")}});$("#entities-accordion").accordion({heightStyle:"content"});n.activeTab=n.startTab;n.handleTabEvents()})},setupData:function(){var n=this,t=n.getContent()},renderUploadForm:function(){var n=this,r=n.getContent(),t=$("#languages-upload-form-wrapper",n.panelWrapper),i=$("#massive-resources-upload-form-wrapper",n.panelWrapper);t.empty();i.empty()},initLanguageTemplatesList:function(n){var i=$.Deferred(),t=this,f=t.getContent(),u="#"+n+"-language-list-wrapper",r=$(u,t.panelWrapper);return r.empty(),$.when(t.dataService.getStoreLanguageTemplates()).done(function(u){var f;u.result.sort(function(n,t){return n.value>t.value?1:n.value<t.value?-1:0});t.templateList=u;f=n==="all"?t.getResource("workportal-widget-admin-language-all-language-list"):t.getResource("workportal-widget-admin-language-current-language-settings");$.tmpl(t.generalTemplateListTmpl,{languageTemplates:u.result,listTitle:f,source:n}).appendTo(r);t.downloadTemplateEvent(n);i.resolve();t.addUploadMassiveResources();n==="reset"&&t.initReset()}),i.promise()},initBizagiObjectsList:function(){var n=this,t;t=$("#bizagi-objects-list-wrapper",n.panelWrapper);$.when(this.dataService.getBizagiObjects()).done(function(i){i.result.sort(function(n,t){return n.value>t.value?1:n.value<t.value?-1:0});n.bizagiObjects=i.result;$.tmpl(n.bizagiObjectsList,{elementList:n.bizagiObjects}).appendTo(t);n.bizagiObjectsEvents()})},bizagiObjectsEvents:function(){var n=this;$("table tr",".objects-container").bind("selectstart",function(n){n.preventDefault()});$(".ui-bizagi-object").click(function(){var n=this;$("td",n).hasClass("bizagi-objects-object-selected")?$("td",n).removeClass("bizagi-objects-object-selected"):$("td",n).addClass("bizagi-objects-object-selected")});$(".objects-buttons").click(function(n){n.preventDefault()});$("#move-all-objects-right").click(function(){$("#table-objects-selected tbody").append($("#table-bizagi-ojects-list td").closest("tr"));$("#table-objects-selected tbody tr td").removeClass("bizagi-objects-object-selected");$("#table-objects-selected tbody tr").show();n.readyToDownload("bizagi_objects")});$("#move-objects-right").click(function(){$("#table-objects-selected tbody").append($("#table-bizagi-ojects-list .bizagi-objects-object-selected").closest("tr"));$("#table-objects-selected tbody tr td").removeClass("bizagi-objects-object-selected");n.readyToDownload("bizagi_objects")});$("#move-objects-left").click(function(){$("#table-bizagi-ojects-list tbody").append($("#table-objects-selected .bizagi-objects-object-selected").closest("tr"));$("#table-bizagi-ojects-list tbody tr td").removeClass("bizagi-objects-object-selected");n.readyToDownload("bizagi_objects")});$("#move-all-objscts-left").click(function(){$("#table-bizagi-ojects-list tbody").append($("#table-objects-selected td").closest("tr"));$("#table-bizagi-ojects-list tbody tr td").removeClass("bizagi-objects-object-selected");n.readyToDownload("bizagi_objects")})},initEntities:function(){var n=this,t;t=$("#entities-list-wrapper",n.panelWrapper);$.when(this.dataService.getEntitiesList()).done(function(i){i.entities.sort(function(n,t){return n.name>t.name?1:n.name<t.name?-1:0});n.entitiesList=i.entities;$.tmpl(n.entitiesListTmpl,{elementList:n.entitiesList}).appendTo(t);n.entitiesEvents()})},entitiesEvents:function(){var n=this;$("table tr",".entities-container").bind("selectstart",function(n){n.preventDefault()});$("#ui-entities-filter").keyup(function(){var n=$(this).val();$("#table-entities-list .ui-bizagi-entity").show();n&&$("#table-entities-list .ui-bizagi-entity").not(":FilterEntity("+n+")").hide()});$.expr[":"].FilterEntity=function(n,t,i){var r=i[3];return r?new RegExp(r,"i").test($(n).text()):!1};$(".ui-bizagi-entity").click(function(){var n=this;$("td",n).hasClass("bizagi-entities-entity-selected")?$("td",n).removeClass("bizagi-entities-entity-selected"):$("td",n).addClass("bizagi-entities-entity-selected")});$(".entities-buttons").click(function(n){n.preventDefault()});$("#move-all-right").click(function(){$("#table-entities-selected tbody").append($("#table-entities-list td").closest("tr"));$("#table-entities-selected tbody tr td").removeClass("bizagi-entities-entity-selected");$("#table-entities-selected tbody tr").show();n.readyToDownload("entities")});$("#move-right").click(function(){$("#table-entities-selected tbody").append($("#table-entities-list .bizagi-entities-entity-selected").closest("tr"));$("#table-entities-selected tbody tr td").removeClass("bizagi-entities-entity-selected");n.readyToDownload("entities")});$("#move-left").click(function(){$("#table-entities-list tbody").append($("#table-entities-selected .bizagi-entities-entity-selected").closest("tr"));$("#table-entities-list tbody tr td").removeClass("bizagi-entities-entity-selected");n.readyToDownload("entities")});$("#move-all-left").click(function(){$("#table-entities-list tbody").append($("#table-entities-selected td").closest("tr"));$("#table-entities-list tbody tr td").removeClass("bizagi-entities-entity-selected");n.readyToDownload("entities")})},getEntitiesSelected:function(){var t=$("#table-entities-selected tbody tr"),n=[];return $.each(t,function(t,i){n.push($(i).data("id"))}),n},getObjectsSelected:function(){var t=$("#table-objects-selected tbody tr"),n=[];return $.each(t,function(t,i){n.push($(i).data("value"))}),n},initAllLangs:function(){var n=this;n.allLangsEvents()},allLangsEvents:function(){var n=this;$("input.ui-all-languages-filter").keyup(function(){var n=$(this).val();$(".ui-bizagi-grid-table .ui-bizagi-language").show();n&&$(".ui-bizagi-grid-table .ui-bizagi-language").not(":FilterLanguage("+n+")").hide()});$.expr[":"].FilterLanguage=function(n,t,i){var r=i[3];return r?new RegExp(r,"i").test($(n).text()):!1};n.modifiedLangs={};$("#all-language-list-wrapper .ui-bizagi-cell-readonly").find("input[type=checkbox]").on("change",function(){var i=$(this),t;t=i.attr("value");$.each(n.modifiedLangs,function(i,r){for(var u in r)u===t&&delete n.modifiedLangs[t]});n.modifiedLangs[t]=i.is(":checked")?!0:!1});$("#all-language-list-wrapper #save-lang-list-btn").on("click",function(){n.saveLangsList()})},saveLangsList:function(){var n=this,t;t={languages:this.modifiedLangs};$.when(this.dataService.setLanguages(JSON.stringify(t))).done(function(t){var i;t.result?$("#tab_all_languages").click():(i=$("#all-language-list-wrapper .multilang-error-msg"),i.removeClass("dp-hidden"),setTimeout(function(){i.addClass("dp-hidden")},5e3),$.each(n.modifiedLangs,function(n,t){var i=$("#all-language-list-wrapper .ui-bizagi-cell-readonly").find("input[value="+n+"]");t?i.removeAttr("checked"):i.prop("checked",!0)}));n.modifiedLangs={}})},initReset:function(){var n=this;n.resetEvents();$("#message-container").hide();$("#template-reset").hide()},resetEvents:function(){var n=this;$("button#lang-reset-btn").on("click",function(){n.loadingOption();$("#message-container").hide();$("#template-reset").hide();var t=bizagi.localization.getResource("workportal-widget-admin-language-reset-confirmation");$.when(bizagi.showConfirmationBox(t,"Bizagi","warning")).done(function(){$.when(n.dataService.resetPersonalization()).done(function(n){n.result&&($("#message-container").show(),$("#template-reset").show())})});n.notLoading()})},loadingOption:function(){$("div.ui-dialog").append("<div class='loading-language ui-bizagi-loading-icon'><div class='loading-language-icon'><\/div><\/div>")},notLoading:function(){$("div.loading-language").remove();$("body").removeClass("cursor-loading")},addUploadMassiveResources:function(){var n=this,i=$("#internals",n.panelWrapper),r=$("#extended",n.panelWrapper),u=$("#bizagi_objects",n.panelWrapper),f=$("#entities_localization ",n.panelWrapper),e=n.dataService.serviceLocator.getUrl("admin-language-entities"),t=n.dataService.serviceLocator.getUrl("admin-language-resource");n.renderUploadPlugin(i,n.formTemplate1,t,"internals");n.renderCultureCombo(i,n.panelWrapper);n.renderUploadPlugin(r,n.formTemplate2,t,"extended");n.renderCultureCombo(r,n.panelWrapper);n.renderUploadPlugin(u,n.formTemplate3,t,"objects");n.renderCultureCombo(u);n.renderUploadPlugin(f,n.formTemplate4,e,"entities");n.renderCultureCombo(f)},renderUploadPlugin:function(n,t,i,r){var f=this,u={};u.addUrl=i;u.validExtensions=f.config.validExtensions;u.maxSize=f.config.maxSize;u.maxfiles="1";u.filesCount="";$("#massive-resources-upload-form-wrapper",n).bizagiFileUpload({showLoading:!0,alertAfterUpload:f.getResource("workportal-widget-admin-language-alert-after-upload"),alerFailtAfterUpload:f.getResource("workportal-widget-admin-language-alert-fail-after-upload"),formTemplate:t,properties:{cultureName:f.config.cultureName,url:u.addUrl,validExtensions:u.validExtensions,maxSize:u.maxSize,xpath:r},onUploadFileCompletedCallback:function(n,t){f.handleResponse("alert-upload-massive-resources-template",t);$("div.loading-language").remove();$("body").removeClass("cursor-loading")},onUploadFileFailCallback:function(n){console.log(n);$("div.loading-language").remove();$("body").removeClass("cursor-loading")},onUploadFileProcess:function(){$("div.ui-dialog").append("<div class='loading-language ui-bizagi-loading-icon'><div class='loading-language-icon'><\/div><\/div>")},maxAllowedFiles:u.maxfiles,uploadedFiles:u.filesCount})},renderCultureCombo:function(n){var i=this,f=i.getContent(),u=$.Deferred(),t={combo:[],id:"cultureName"},r;return t.combo.push({id:"default",name:""}),$.each(i.templateList.result,function(n,i){i.enabled&&t.combo.push({id:i.key,name:i.value})}),r=$(".ui-bizagi-culturecombo",n),r.empty(),r.uicombo({isEditable:!1,data:t,itemValue:function(n){return n.id},itemText:function(n){return n.name},onComplete:function(){$("[name='cultureName']",n).val(t.combo[0].id);u.resolve()},onChange:function(t){var r=$("button#upload-file","#"+i.activeTab+"_upload_file"),u=t.ui.data("value");u!=="default"?r.prop("disabled",!1):r.prop("disabled",!0);$("[name='cultureName']",n).val(u)},initValue:t.combo[0]}),u},handleResponse:function(n,t){var i=this,f=t.length,r="Error",u;f==0?i.initLanguageTemplatesList(i.startTab):(response=JSON.parse(t),typeof response.detail!="undefined"&&(r=response.detail.length>200?response.detail.substring(0,197)+" ...":response.detail),u=bizagi.localization.getResource(response.message),$("#"+n).html(u+" : "+r),$("#"+n).parent().removeClass("ui-hidden"))},downloadTemplateEvent:function(n){var t=this,i=$("#"+n+"-language-list-wrapper .ui-bizagi-grid-table",t.panelWrapper),r=$(".lang-list-button button#"+n+"-tmpl-download-btn",t.panelWrapper);i.find('input[type="radio"]').click(function(){t.readyToDownload(n,i,r)});r.click(function(r){var f,e,o,s,u;r.preventDefault();o=i.find('input[type="radio"]:checked').data("guid");u={cultureName:o};n==="bizagi_objects"?(f={elements:t.getObjectsSelected()},u.elements=JSON.stringify(f)):n==="entities"?(e={entities:t.getEntitiesSelected()},u.entities=JSON.stringify(e)):n==="extended"&&(s={elements:["extended"]},u.elements=JSON.stringify(s));t.dataService.getLanguageTemplate(u)})},readyToDownload:function(n,t,i){var u=this,r=!1,f=!1;t||(t=$("#"+n+"-language-list-wrapper .ui-bizagi-grid-table",u.panelWrapper));i||(i=$(".lang-list-button button#"+n+"-tmpl-download-btn",u.panelWrapper));n==="internals"?r=!0:n==="extended"?r=!0:n==="bizagi_objects"?r=u.getObjectsSelected().length>0?!0:!1:n==="entities"&&(r=u.getEntitiesSelected().length>0?!0:!1);t.find('input[type="radio"]:checked').length>0&&(f=!0);r&&f?i.removeAttr("disabled"):i.attr("disabled",!0)},handleTabEvents:function(){var t=this,n=!1,i=$("#admin-language-wrapper"),r;r=t.getContent();$(".ui-tabs-anchor","#admin-language-wrapper").click(function(){$("#message-container").hide();$("#template-reset").hide();$("input.ui-all-languages-filter").val("")});$("#tab_internals").click(function(r){n?r.preventDefault():(n=!0,i.tabs("disable"),$.when(t.initLanguageTemplatesList("internals")).done(function(){$("#internals_internal_tabs").tabs({create:function(n,t){t.tab.parent().removeClass("hidden")}});t.activeTab="internals";i.tabs("enable");n=!1}))});$("#tab_extended").click(function(r){n?r.preventDefault():(n=!0,i.tabs("disable"),$.when(t.initLanguageTemplatesList("extended")).done(function(){$("#extended_internal_tabs").tabs({create:function(n,t){t.tab.parent().removeClass("hidden")}});t.activeTab="extended";i.tabs("enable");n=!1}))});$("#tab_bizagi_objects").click(function(r){n?r.preventDefault():(n=!0,i.tabs("disable"),$.when(t.initLanguageTemplatesList("bizagi_objects")).done(function(){$("#bizagi_objects_internal_tabs").tabs({create:function(n,t){t.tab.parent().removeClass("hidden")}});$("#bizagi-objects-accordion").accordion({heightStyle:"content"});t.activeTab="bizagi_objects";i.tabs("enable");n=!1}))});$("#tab_entities_localization").click(function(r){n?r.preventDefault():(n=!0,i.tabs("disable"),$.when(t.initLanguageTemplatesList("entities")).done(function(){$("#entities_internal_tabs").tabs({create:function(n,t){t.tab.parent().removeClass("hidden")}});$("#entities-accordion").accordion({heightStyle:"content"});t.activeTab="entities";i.tabs("enable");n=!1}))});$("#tab_all_languages").click(function(r){n?r.preventDefault():(n=!0,i.tabs("disable"),$.when(t.initLanguageTemplatesList("all")).done(function(){t.initAllLangs();t.activeTab="all";i.tabs("enable");n=!1}))});$("#tab_reset").click(function(r){n?r.preventDefault():(n=!0,i.tabs("disable"),$.when(t.initLanguageTemplatesList("reset")).done(function(){t.allLangsEvents();t.activeTab="reset";i.tabs("enable");n=!1}))});$(".tab_upload_file").click(function(){t.addUploadMassiveResources()});$("#tab_reset").parent().hide();$("#tab_internals").parent().show()}});
bizagi.workportal.widgets.admin.preferences.extend("bizagi.workportal.widgets.admin.preferences",{},{init:function(n,t,i){var r=this;r.guidForm;r.isNewForm;r._super(n,t,i);r.loadTemplates({"admin.preferences.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-admin-preferences-wrapper"),"admin.preferences.container":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preferences-container"),"admin.preferences.buttons":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preference-buttons"),"admin.preferences.iframe":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preference-iframe"),"admin.preferences.error":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preferences-errormessage"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.container=n.getTemplate("admin.preferences.container");n.buttons=n.getTemplate("admin.preferences.buttons");n.iframe=n.getTemplate("admin.preferences.iframe");n.errorMessage=n.getTemplate("admin.preferences.error")},postRender:function(){var n=this;$.when(n.dataService.getPreferenceFormParams()).done(function(t){n.guidForm=t.id!=="-1"?t.id:"";t.errorMessage===!0?n.renderErrorMessage():t.isNewForm===!0?n.renderPreferences():n.renderPreferencesOldForm()})},renderErrorMessage:function(){var n=this,t=n.getResource("workportal-widget-admin-entities-message-migrate"),i;t=t.replace("{build}",bizagi.loader.productBuildToAbout);i=$.tmpl(n.errorMessage,{errorMessage:t});n.content.html(i)},setupData:function(){var n=this,t=n.getContent()},renderPreferencesOldForm:function(){var n=this,r=n.getContent(),u=n.dataService.getUrl({endPoint:"PreferenceFormOld"})+"?idForm="+n.guidForm+"&referer=userPreferences",t=$.tmpl(n.iframe,{url:u}),i=$("iframe",t);t.addClass("loading-iframe");i.hide();i.load(function(){$(this).fadeIn()});r.html(t)},renderPreferences:function(){var n=this,i=n.getContent(),r,t;n.currentUser=bizagi.currentUser.idUser;r={h_action:"LOADUSERPREFERENCESFORM",h_contexttype:"entity",h_guidForm:n.guidForm};t=$.tmpl(n.container);bizagi.loader.start("rendering").then(function(){var u=new bizagi.rendering.facade;n.dataService.getPreferencesForm(r).done(function(r){var f={canvas:t,data:r,type:""};u.execute(f).done(function(){n.preferenceForm=u.form;n.preferenceForm&&n.preferenceForm.properties?n.preferenceForm.properties.contexttype?"":n.preferenceForm.properties.contexttype="entity":"";$("#preferences",i).html(t);i.find("#preferences-buttons").css("display","block");n.handleEvents()})})})},handleEvents:function(){var n=this,t=n.getContent();$("#preferences-buttons",t).html($.tmpl(n.buttons));$("#update-preferences",t).click(function(){n.updateData()})},updateData:function(){var n=this;if(n.preferenceForm.validateForm()){var r=new bizagi.render.services.service,t=n.preferenceForm.collectRenderValuesForSubmit(),i=n.getContent();n.startLoading(i);$.when(r.multiactionService.submitData({action:"SAVEUSER",contexttype:"entity",data:t,surrogatekey:n.currentUser,idPageCache:n.preferenceForm.idPageCache})).done($.proxy(function(){i.removeClass("loading-iframe");t.language&&$.when(n.dataService.getCurrentUser()).done(function(n){assignLanguage(n.language);bizagi.util.changeData({language:n.language})}).fail(function(){});n.renderPreferences()},t))}},startLoading:function(n){n.find("#preferences-main-container").css("display","none");n.find("#preferences-buttons").css("display","none");n.addClass("loading-iframe")}});
bizagi.workportal.widgets.admin.entities.extend("bizagi.workportal.widgets.admin.entities",{},{init:function(n,t,i){var u=this,r="bizagi.workportal.desktop.widgets.admin.entities";u._super(n,t,i);u._referrer="entity";u.loadTemplates({"admin.entity.wrapper":bizagi.getTemplate(r).concat("#ui-bizagi-workportal-widget-admin-entity-wrapper"),"admin.entity.panel.wrapper":bizagi.getTemplate(r).concat("#ui-bizagi-workportal-widget-admin-entity-panel-wrapper"),"admin.entity.list":bizagi.getTemplate(r).concat("#ui-bizagi-workportal-widget-admin-entity-list"),"admin.entity.error":bizagi.getTemplate(r).concat("#ui-bizagi-workportal-widget-admin-entity-error"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.panelWrapper=$.tmpl(n.getTemplate("admin.entity.panel.wrapper"));n.entitiesList=n.getTemplate("admin.entity.list");n.entitiesError=n.getTemplate("admin.entity.error")},postRender:function(){var n=this,t=n.getContent();t.empty();$.when(n.dataService.getAdminEntitiesList()).done(function(i){var r,u;i.length>0?(n.entities=i,r=$("#admin-entity-list-wrapper",n.panelWrapper),t.html(n.panelWrapper),$.tmpl(n.entitiesList,{entitiesList:n.entities}).appendTo(r),$("#entitiesList option:first",r).attr("selected","selected"),n.configureHandlers()):(u=n.getResource("workportal-general-first-line-no-records-found"),t.html($.tmpl(n.entitiesError,{errorMessage:u})))}).fail(function(){n.entities=undefined;var i=n.getResource("workportal-widget-admin-entities-error");t.html($.tmpl(n.entitiesError,{errorMessage:i}))})},configureHandlers:function(){var t=this,n=$("#admin-entity-list-wrapper",t.panelWrapper);$("#searchEntity",n).keyup(function(){var i=!1,r=$(this).val().toLowerCase();$("#entitiesList option",n).remove();$.each(t.entities,function(){r.length>1?this.displayName.toLowerCase().indexOf(r)!=-1&&(i=!0):i=!0;i&&($("#entitiesList",n).append($("<option>",{value:this.guid,text:this.displayName,"data-allowAdd":this.allowAdd,"data-allowEdit":this.allowEdit})),i=!1)})});$("#entitiesList",n).change(function(){t.drawSimpleGrid()}).trigger("change")},drawSimpleGrid:function(){var t=this,n=t.getSelectedItem(),i;n.idDisplayForm&&n.idDisplayForm!="00000000-0000-0000-0000-000000000000"?(i={guid:n.guidEntity,guidForm:n.idDisplayForm,isStakeholder:!1},$.when(t.dataService.getAdminEntitiesForm(i)).done(function(i){t.performSimpleGrid(n,i)})):t.performSimpleGrid(n)},resolveEntityForm:function(n){var i=this,u=new $.Deferred,f={},t,r=function(n){var t=[];return n=n||{},$.each(n,function(n,i){i.container?t.push.apply(t,r(i.container.elements)):t.push(i.render.properties)}),t},e=function(t){var i="";return $.each(n.header,function(n,r){r.fieldValue==t.xpath&&r.entity&&(i=r.entity)}),i},o=function(n){var t=[];return n=r(n||{}),$.each(n,function(n,i){var r=i.dataType,f=e(i),u={};switch(i.type){case"upload":r=1002;break;case"image":r=1003}u=$.extend(i,{fieldValue:i.xpath,attributeType:r});f&&(u.entity=f);t.push(u)}),t},s=function(n){var u=new $.Deferred,f=[],e=[],s=i.getSelectedItem(),o={guid:s.guidEntity,guidForm:s.idDisplayForm,isStakeholder:!1};return n=n||[],n.length==0?$.when(i.dataService.getAdminEntitiesForm(o)).done(function(n){t||(t=n);u.resolve([])}):($.each(n,function(n,t){o.idRow=t;e.push(i.dataService.getAdminEntitiesForm(o))}),$.when.apply($,e).done(function(){$.map(e,function(i,e){var o=i.responseJSON;t||(t=o);var h=r(o.form.elements),c=n[e],s=[c];$.each(h,function(n,t){var i=t.value;switch(t.type){case"image":case"upload":i="...";break;case"boolean":i=t.value?"X":"";break;case"combo":i=typeof t.value=="object"&&t.value.length>0?typeof t.value[0].value=="object"?t.value[0].value.join(","):t.value[0].value:""}s.push(i)});f.push(s);f.length==n.length&&u.resolve(f)})})),u.promise()},h=function(n){var t=[];return n=n||{},n.row&&$.each(n.row,function(n,i){t.push(i[0])}),t},c=function(n,t){if(n.length==t.length)return n.forEach(function(n,i){n.fieldValue=t[i].fieldValue}),n},l=h(n);return $.when(s(l)).done(function(i){var r=[n.header[0]];r.push.apply(r,o(t.form.elements));r=c(r,n.header);f={header:r,entity:n.entity,row:i,total:n.total,page:n.page,records:n.records};u.resolve(f)}),u.promise()},performSimpleGrid:function(n,t){var i=this,r={allowAdd:n.allowAdd,allowEdit:n.allowEdit,displayName:n.displayName,pageSize:10,onDataBinding:function(r){var u=$.Deferred();return $.when(i.dataService.getAdminEntitiesRowData($.extend(r,{guidEntity:n.guidEntity}))).done(function(r){if(n.guidEntity==i.getSelectedItem().guidEntity)if(t){r.relatedEntity=n.guidEntity;var f=i.reshapeEntity(r,t);$.when(i.resolveEntityForm(r)).done(function(n){u.resolve(n)})}else u.resolve(r)}).fail(function(){var n=i.getResource("workportal-widget-admin-entities-instances-error");$("#admin-entity-instances-wrapper",i.getContent()).html($.tmpl(i.entitiesError,{errorMessage:n}))}),u.promise()},onLoadFilter:function(n){if(n.type==="Entity")return i.dataService.getAdminEntityData(n)},onAdd:function(){i.validateVersionForm(this,"New")},onEdit:function(n,t){i.validateVersionForm(t,"Edit")},getResource:function(n){i.getResource(n)}};$("#admin-entity-instances-wrapper",i.panelWrapper).simpleGrid(i,r).render()},getSelectedItem:function(){var t=this,n=$("#entitiesList option:selected",t.panelWrapper);return{guidEntity:n.val(),displayName:n.text(),allowAdd:n.attr("data-allowAdd").toLowerCase()==="true"?!0:!1,allowEdit:n.attr("data-allowEdit").toLowerCase()==="true"?!0:!1,idDisplayForm:n.attr("data-idDisplayForm")}},validateVersionForm:function(n,t){var r=this,f=$("#entitiesList option:selected",r.panelWrapper),u=r.entities.find(function(n){return n.guid===f.val()}),i={guid:f.val()};t==="New"?i.guidForm=typeof u.idAddForm!="undefined"?u.idAddForm:"00000000-0000-0000-0000-000000000000":t=="Edit"&&(i.idRow=$(n).attr("data-idrowentity"),i.guidForm=typeof u.idEditForm!="undefined"?u.idEditForm:"00000000-0000-0000-0000-000000000000");$("#detailEntity",r.panelWrapper).empty();i.guidForm==="00000000-0000-0000-0000-000000000000"?r.getFormEntity(i):$.when(r.dataService.getAdminEntityMigrated(i.guidForm)).done(function(n){var u,f;n.result==0||n.result==10?r.getFormEntity(i):n.result==-9?(u=r.getResource("workportal-widget-admin-entities-instances-error"),$("#admin-entity-instances-wrapper",r.getContent()).html($.tmpl(r.entitiesError,{errorMessage:u}))):(t=="New"&&(i.idRow=-1),f="App/Admin/Entity.aspx?giudEntity="+i.guid+"&idSurrogateKey="+i.idRow+"&referer=entityadmin&Action="+t+"&idForm="+i.idForm,r.loadIframeForm(f,"otherForm"))})},saveFormEntity:function(n){var r=this,t=$.Deferred(),f=r.getSelectedItem(),u=new bizagi.render.services.service,i={};return n.collectRenderValues(i),$.when(u.multiactionService.submitData({action:"SAVE",contexttype:"entity",data:i,surrogatekey:typeof n.surrogatekey!="undefined"?n.surrogatekey:!1,idPageCache:n.idPageCache})).done(function(n){n.type=="success"?t.resolve(!0):t.reject()}).fail(function(n){bizagi.showMessageBox(n.message);t.reject()}),t.promise()},reshapeEntity:function(n,t){var o=this,i={},r,f,e,u;return i.entity=n.entity,i.page=n.page,i.records=n.records,i.total=n.total,i.header=[],i.row=[],r=[],$.each(t.form.elements,function(t,u){o.mergeFormAndTable(u,i,r,n)}),r.push(n.header.length-1),f=n.header.slice(-1).pop(),i.header.push(f),r.indexOf(0)==-1&&(n.header[0].dataType=-11,e=n.header[0],i.header.unshift(e),r.unshift(0)),u=0,$.each(n.row,function(n,t){for(var e=[],f=0;f<r.length;f++)u=r[f],e[f]=t[u];i.row[n]=e}),i},renderTable:function(n,t,i,r){var f=this,u;if(n.container)for(u=0;u<n.container.elements.length;u++)f.renderTable(n.container.elements[u],t,i,r);else $.each(r.header,function(r,u){n.render.properties.xpath&&n.render.properties.xpath.toUpperCase()==u.fieldValue.toUpperCase()&&(t.header.push($.extend(n.render.properties,u)),i.push(r))})},mergeFormAndTable:function(n,t,i,r){var f=this,u;if(n.container)for(u=0;u<n.container.elements.length;u++)f.renderTable(n.container.elements[u],t,i,r);else $.each(r.header,function(r,u){n.render.properties.xpath&&n.render.properties.xpath.toUpperCase()==u.fieldValue.toUpperCase()&&(t.header.push($.extend(u,n.render.properties)),i.push(r))})}});
bizagi.workportal.widgets.admin.entities.extend("bizagi.workportal.widgets.admin.stakeholders",{},{init:function(n,t,i){var u=this,r="bizagi.workportal.desktop.widgets.admin.stakeholders";u._super(n,t,i);u._referrer="stakeholder";u.loadTemplates({"admin.entity.wrapper":bizagi.getTemplate(r).concat("#ui-bizagi-workportal-widget-admin-stakeholder-wrapper"),"admin.stakeholder.panel.wrapper":bizagi.getTemplate(r).concat("#ui-bizagi-workportal-widget-admin-stakeholder-panel-wrapper"),"admin.stakeholder.list":bizagi.getTemplate(r).concat("#ui-bizagi-workportal-widget-admin-stakeholder-list"),"admin.stakeholder.error":bizagi.getTemplate(r).concat("#ui-bizagi-workportal-widget-admin-stakeholder-error"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.panelWrapper=$.tmpl(n.getTemplate("admin.stakeholder.panel.wrapper"));n.stakeholdersList=n.getTemplate("admin.stakeholder.list");n.stakeholdersError=n.getTemplate("admin.stakeholder.error")},postRender:function(){var n=this,t=n.getContent();t.empty();$.when(n.dataService.getAdminStakeholdersList()).done(function(i){var r,u;i.length>0?(n.stakeholders=i,r=$("#admin-stakeholder-list-wrapper",n.panelWrapper),t.html(n.panelWrapper),$.tmpl(n.stakeholdersList,{stakeholdersList:n.stakeholders}).appendTo(r),$("#stakeholdersList option:first",r).attr("selected","selected"),n.configureHandlers()):(u=n.getResource("workportal-general-first-line-no-records-found"),t.html($.tmpl(n.stakeholdersError,{errorMessage:u})))}).fail(function(){n.stakeholders=undefined;var i=n.getResource("workportal-widget-admin-stakeholders-error");t.html($.tmpl(n.stakeholdersError,{errorMessage:i}))})},configureHandlers:function(){var t=this,n=$("#admin-stakeholder-list-wrapper",t.panelWrapper);$("#searchStakeholder",n).keyup(function(){var i=!1,r=$(this).val().toLowerCase();$("#stakeholdersList option",n).remove();$.each(t.stakeholders,function(){r.length>1?this.displayName.toLowerCase().indexOf(r)!=-1&&(i=!0):i=!0;i&&($("#stakeholdersList",n).append($("<option>",{value:this.guid,text:this.displayName,"data-allowAdd":this.allowAdd,"data-allowEdit":this.allowEdit})),i=!1)})});$("#stakeholdersList",n).change(function(){t.drawSimpleGrid()}).trigger("change")},drawSimpleGrid:function(){var n=this,t=n.getSelectedItem(),i;t.idDisplayForm&&t.idDisplayForm!="00000000-0000-0000-0000-000000000000"?(i={guid:t.guidEntity,guidForm:t.idDisplayForm,isStakeholder:!1},$.when(n.dataService.getAdminEntitiesForm(i)).done(function(t){n.performSimpleGrid(t)})):n.performSimpleGrid()},performSimpleGrid:function(n){var t=this,i=t.getSelectedItem(),r={allowAdd:i.allowAdd,allowEdit:i.allowEdit,displayName:i.displayName,pageSize:7,onDataBinding:function(r){var u=$.Deferred();return $.when(t.dataService.getAdminEntitiesRowData($.extend(r,{guidEntity:i.guidEntity}))).done(function(i){if(n){var r=t.reshapeEntity(i,n);u.resolve(r)}else u.resolve(i)}).fail(function(){var n=t.getResource("workportal-widget-admin-stakeholders-instances-error");$("#admin-stakeholder-instances-wrapper",t.getContent()).html($.tmpl(t.stakeholdersError,{errorMessage:n}))}),u.promise()},onLoadFilter:function(n){if(n.type==="Entity")return t.dataService.getAdminEntityData(n)},onAdd:function(){t.validateVersionForm(this,"New")},onEdit:function(n,i){t.validateVersionForm(i,"Edit")},getResource:function(n){t.getResource(n)}};$("#admin-stakeholder-instances-wrapper",t.panelWrapper).simpleGrid(t,r).render()},getSelectedItem:function(){var t=this,n=$("#stakeholdersList option:selected",t.panelWrapper);return{guidEntity:n.val(),displayName:n.text(),allowAdd:n.attr("data-allowAdd").toLowerCase()==="true"?!0:!1,allowEdit:n.attr("data-allowEdit").toLowerCase()==="true"?!0:!1,idDisplayForm:n.attr("data-idDisplayForm")}},validateVersionForm:function(n,t){var r=this,f=$("#stakeholdersList option:selected",r.panelWrapper),u=r.stakeholders.find(function(n){return n.guid===f.val()}),i={guid:f.val(),isStakeholder:!0};t==="New"?i.guidForm=typeof u.idAddForm!="undefined"?u.idAddForm:"00000000-0000-0000-0000-000000000000":t=="Edit"&&(i.idRow=$(n).attr("data-idrowentity"),i.guidForm=typeof u.idEditForm!="undefined"?u.idEditForm:"00000000-0000-0000-0000-000000000000");$("#detailEntity",r.panelWrapper).empty();i.guidForm==="00000000-0000-0000-0000-000000000000"?r.getFormEntity(i):$.when(r.dataService.getAdminEntityMigrated(i.guidForm)).done(function(n){var u,f;n.result==0||n.result==10?r.getFormEntity(i):n.result==-9?(u=r.getResource("workportal-widget-admin-stakeholders-instances-error"),$("#admin-stakeholder-instances-wrapper",r.getContent()).html($.tmpl(r.stakeholdersError,{errorMessage:u}))):(t=="New"&&(i.idRow=-1),f="App/Admin/Entity.aspx?giudEntity="+i.guid+"&idSurrogateKey="+i.idRow+"&referer=entityadmin&Action="+t+"&idForm="+i.idForm,r.loadIframeForm(f,"otherForm"))})},saveFormEntity:function(n){var t=this,i=$.Deferred(),u=t.getSelectedItem(),r={};return n.collectRenderValues(r),t.associatedUserHasChange(r)?$.when(t.dataService.getUserStakeholders({idUser:r.associatedUser.id})).done(function(f){var e,o;f.length>0?(e=f.find(function(n){return n.idEntity===u.guidEntity}),typeof e!="undefined"?(o=bizagi.localization.getResource("render-stakeholder-delete-associate-instance-other-user-confirm-msg"),$.when(bizagi.showConfirmationBox(o,"Bizagi","warning")).done(function(){t.submitFormData(n,r,i)}).fail(function(){i.reject()})):t.submitFormData(n,r,i)):t.submitFormData(n,r,i)}).fail(function(n){bizagi.showMessageBox(n.message);i.reject()}):t.submitFormData(n,r,i),i.promise()},submitFormData:function(n,t,i){var u=this,r=new bizagi.render.services.service;$.when(r.multiactionService.submitData({action:"SAVE",contexttype:"entity",data:t,surrogatekey:typeof n.surrogatekey!="undefined"?n.surrogatekey:!1,idPageCache:n.idPageCache})).done(function(n){n.type=="success"?i.resolve(!0):i.reject()}).fail(function(n){bizagi.showMessageBox(n.message);i.reject()})},associatedUserHasChange:function(n){var i=this,t=!1;return typeof i._associatedUser!="undefined"?typeof n.associatedUser!="undefined"&&i._associatedUser.id!==n.associatedUser.id&&(t=!0):typeof n.associatedUser!="undefined"&&(t=!0),t}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.oauth2Applications",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_OAUTH2APPLICATIONS},init:function(n,t,i){var r=this,u="bizagi.workportal.desktop.widgets.admin.oauth2.applications";r._super(n,t,i);r.loadTemplates({"admin.oauth2applications":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-oauth2applications"),"admin.edit.oauth2applications":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-edit-oauth2applications"),"admin.add.oauth2applications":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-add-oauth2applications"),useNewEngine:!1});r.CurrentClientData={}},renderContent:function(){var n=this;return n.content=$.tmpl(n.getTemplate("admin.oauth2applications")),n.content},loadtemplates:function(){var n=this;n.contentOauth=$.tmpl(n.getTemplate("admin.oauth2applications"))},postRender:function(){var n=this,t=n.getContent();t.html(n.contentOauth);n.performSimpleGrid()},performSimpleGrid:function(){var n=this,t={allowAdd:!0,allowEdit:!0,allowDelete:!0,allow:!0,displayName:"Oauth",pageSize:10,onDataBinding:function(){var t=$.Deferred();return $.when(n.dataService.getOAuth2Applications().done(function(i){var r={},u;i.data.length&&(u=["Id","Name","Description","ClientId","ClientSecret","AuthorizationGrantType","DefaultUserDomain","DefaultUserName","RedirectUri","RedirectUriStrategy","Website"],r.header=$.map($(u).filter(Object.keys(i.data[0])),function(n){return{attributeType:1004,dataType:2,displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-applications-"+n.toLowerCase()),fieldValue:"idGuestSH",xpath:"GuestSH"}}));n.namesApplications=[];r.row=$.map(i.data,function(t){return n.namesApplications.push(t.Name),[$.map($(u).filter(Object.keys(i.data[0])),function(n){return t[n]})]});t.resolve(r)}).fail(function(n){bizagi.log(n)})),$.when(n.dataService.getCurrentUser()).done(function(t){n.userFullName=t.user}).fail(function(){}),t.promise()},onAdd:function(){n.addApplication(this,"New")},onEdit:function(t,i){n.editApplication($(i).attr("data-idrowentity"))},onDelete:function(t,i){n.deleteApplication($(i).attr("data-idrowentity"))},getResource:function(){}};$("#admin-oauth2-applications-table",n.getContent()).simpleGrid(n,t).render()},addApplication:function(){var n=this,t=$.tmpl(n.getTemplate("admin.add.oauth2applications"),{});t.appendTo("#admin-oauth2-add-application");$("#admin-oauth2-applications-wrapper").hide();$("#admin-oauth2-add-application").show();n.setupAddApplicationEvents();n.setupCombos("add")},setupAddApplicationEvents:function(){var n=this;$("#btn-admin-oauth2-add").click(function(){n.save()});$("#btn-admin-oauth2-cancel").click(function(){n.cancel("add")})},setupCombos:function(n){var t=this,i=[{displayName:"Authorization Code",id:"authorization_code"},{displayName:"Client credentials",id:"client_credentials"},{displayName:"All",id:"any"}],r=[{displayName:"Web Application",id:"WebApplication"},{displayName:"Mobile Title Bar Browser",id:"MobileTitleBarBrowser"},{displayName:"Mobile Localhost Port",id:"MobileLocalhostPort"}];if(n==="add"){var u=$("#biz-wp-oauth2-grant-type-input"),s=$("#biz-wp-oauth2-allowed-scope-input"),f=$("#biz-wp-oauth2-redirect-uri-strategy-input");t.setupCombo(u,i,"grantType");t.setupCombo(f,r,"RedirectUri")}if(n==="edit"){var e=$("#biz-wp-oauth2-edit-grant-type-input"),h=$("#biz-wp-oauth2-edit-allowed-scope-input"),o=$("#biz-wp-oauth2-edit-redirect-uri-strategy-input");t.setupCombo(e,i,"editGrantType");t.setupCombo(o,r,"editRedirectUri")}},setupCombo:function(n,t,i){var r=this;i==="grantType"&&(r.grantType=t[0].id);i==="RedirectUri"&&(r.RedirectUri=t[0].id);r.pos=0;i==="editGrantType"&&(r.editGrantType=r.editGrantType||t[0].id,$.each(t,function(n){t[n].id===r.editGrantType&&(r.pos=n)}));i==="editRedirectUri"&&(r.editRedirectUri=r.editRedirectUri||t[0].id,$.each(t,function(n){t[n].id===r.editRedirectUri&&(r.pos=n)}));n.uicombo({data:{combo:t},initValue:t[r.pos],itemValue:function(n){return n.id},itemText:function(n){return n.displayName},onChange:function(n){(i==="grantType"||i==="editGrantType")&&(i==="grantType"&&(r.grantType=n.ui.data("value")),i==="editGrantType"&&(r.editGrantType=n.ui.data("value")),n.ui.data("value")==="client_credentials"?($(".bz-oauth2-only-edit-authorization-code").hide(),$(".bz-oauth2-only-authorization-code").hide(),$(".bz-oauth2-only-edit-client-credentials").show(),$(".bz-oauth2-only-client-credentials").show()):n.ui.data("value")==="authorization_code"?($(".bz-oauth2-only-client-credentials").hide(),$(".bz-oauth2-only-authorization-code").show(),$(".bz-oauth2-only-edit-client-credentials").hide(),$(".bz-oauth2-only-edit-authorization-code").show()):($(".bz-oauth2-only-client-credentials").show(),$(".bz-oauth2-only-authorization-code").show(),$(".bz-oauth2-only-edit-client-credentials").show(),$(".bz-oauth2-only-edit-authorization-code").show()));(i==="RedirectUri"||i==="editRedirectUri")&&(i==="RedirectUri"&&(r.RedirectUri=n.ui.data("value")),i==="editRedirectUri"&&(r.editRedirectUri=n.ui.data("value")),n.ui.data("value")==="WebApplication"?($("#bz-oauth2-only-MobileLocalhostPort").hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort").hide(),$("#bz-oauth2-only-WebApplication").show(),$("#bz-oauth2-edit-only-WebApplication").show()):n.ui.data("value")==="MobileTitleBarBrowser"?($("#bz-oauth2-only-WebApplication").hide(),$("#bz-oauth2-only-MobileLocalhostPort").hide(),$("#bz-oauth2-edit-only-WebApplication").hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort").hide()):($("#bz-oauth2-only-WebApplication").hide(),$("#bz-oauth2-edit-only-WebApplication").hide(),$("#bz-oauth2-only-MobileLocalhostPort").show(),$("#bz-oauth2-edit-only-MobileLocalhostPort").show()));i==="AllowedScope"&&(r.AllowedScope=n.ui.data("value"));i==="editAllowedScope"&&(r.editAllowedScope=n.ui.data("value"))}})},save:function(){var n=this,f,y,p,w,t,r,i;$(".biz-wp-oauth2-warnings__alert").hide();$("#bz-oauth2-applications-error-fields-required").hide();$("#bz-oauth2-applications-error-scope-required").hide();var s=$("#biz-wp-oauth2-name-input").val(),b=$("#biz-wp-oauth2-applications-description-input").val(),k=$("#biz-wp-oauth2-web-site-input").val(),u=$("#biz-wp-oauth2-redirect-uri-input").val(),h=$("#biz-wp-oauth2-user-domain-input").val(),c=$("#biz-wp-oauth2-default-user-name-input").val(),e=parseInt($("#biz-wp-oauth2-access-token-input").val(),10),l=parseInt($("#biz-wp-oauth2-mobile-host-port").val(),10),a=$("#biz-wp-oauth2-scope-api-input").is(":checked"),v=$("#biz-wp-oauth2-scope-login-input").is(":checked"),o="";if(a&&(o+="api"),v&&(o+=" login"),f=!1,validateGrandType=function(){return n.grantType==="authorization_code"?s&&u&&e?!0:!1:n.grantType==="client_credentials"?h&&c?!0:!1:s&&u&&e&&h&&c?!0:!1},validateScope=function(){return a||v?!0:!1},n.RedirectUri==="WebApplication"&&(n.grantType==="authorization_code"||n.grantType==="any")?(y=u,f=/^(ftp|http|https):\/\/[^ "]+$/.test(y)):n.RedirectUri==="MobileTitleBarBrowser"&&(n.grantType==="authorization_code"||n.grantType==="any")?(u="bz:oauth:2.0:server:mobiletitlebarbrowser",f=!0):(u=l,f=!0),e<1){$("#bz-oauth2-applications-error-time-invalid").show();return}if(l<1){$("#bz-oauth2-applications-error-port-invalid").show();return}if(p=validateGrandType()&&validateScope(),p)if(w=$.grep(n.namesApplications,function(n){return n===$("#biz-wp-oauth2-name-input").val()}),w.length===0)if(f){for(t={},t.authorization_grant_type=n.grantType,t.allowed_scope=o,t.username_creator=n.userFullName,t.redirect_uri_strategy=n.RedirectUri,n.grantType==="client_credentials"&&(t.redirect_uri="http://localhost--"),r=$("#formAddOAuthApp :input").serializeArray(),i=0;i<r.length;i++)r[i].value&&(r[i].name==="redirect_uri_port"&&n.RedirectUri==="MobileLocalhostPort"?t.redirect_uri=r[i].value:t[r[i].name]=r[i].value);n.dataService.createOAuth2Application(t).done(function(){n.performSimpleGrid();n.cancel("add")})}else $("#bz-oauth2-applications-error-url-invalid").show();else $("#bz-oauth2-applications-error-name-duplicated").show();else $("#bz-oauth2-applications-error-fields-required").show(),validateScope()||$("#bz-oauth2-applications-error-scope-required").show()},getGrantType:function(n){return{authorization_code:"Authorization Code",client_credentials:"Client credentials",any:"All"}[n]},getRedirectStrategy:function(n){return{WebApplication:"Web Application",MobileTitleBarBrowser:"Mobile Title Bar Browser",MobileLocalhostPort:"Mobile Localhost Port"}[n]},getMobileLocalhostPort:function(n,t){if(t==="MobileLocalhostPort"){var i=n.match(/:([0-9]+)/)[1];return parseInt(i)}return""},editApplication:function(n){var t=this,i=t.getContent();i=i[4]?i[4]:i[2];$.when(t.dataService.getOAuth2Application(n)).done(function(n){if(n.success){t.CurrentClientData=n.data;var u=$.tmpl(t.getTemplate("admin.edit.oauth2applications"),{editGrantType:t.CurrentClientData.AuthorizationGrantType,data:t.CurrentClientData},{getGrantType:t.getGrantType,getRedirectStrategy:t.getRedirectStrategy,getMobileLocalhostPort:t.getMobileLocalhostPort});u.appendTo(i);t.ActualNameForEdit=t.CurrentClientData.Name;t.DataAllowedScope=t.CurrentClientData.AllowedScope;t.editGrantType=t.CurrentClientData.AuthorizationGrantType;t.editRedirectUri=t.CurrentClientData.RedirectUriStrategy;function r(n){return $.grep(t.CurrentClientData.AllowedScope,function(t){return t===n}).length}r("api")>0&&$("#biz-wp-oauth2-edit-scope-api-input",i).prop("checked",!0);r("login")>0&&$("#biz-wp-oauth2-edit-scope-login-input",i).prop("checked",!0);t.CurrentClientData.IsNative?($("#biz-wp-oauth2-edit-scope-api-input",i).attr("disabled",!0),$("#biz-wp-oauth2-edit-scope-login-input",i).attr("disabled",!0)):(t.setupCombos("edit"),t.editGrantType==="client_credentials"?($(".bz-oauth2-only-edit-client-credentials",i).show(),$(".bz-oauth2-only-edit-authorization-code",i).hide()):t.editGrantType==="authorization_code"?($(".bz-oauth2-only-edit-client-credentials",i).hide(),$(".bz-oauth2-only-edit-authorization-code",i).show()):($(".bz-oauth2-only-edit-client-credentials",i).show(),$(".bz-oauth2-only-edit-authorization-code",i).show()),t.CurrentClientData.RedirectUriStrategy==="WebApplication"?($("#bz-oauth2-edit-only-WebApplication",i).show(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).hide()):t.CurrentClientData.RedirectUriStrategy==="MobileTitleBarBrowser"?($("#bz-oauth2-edit-only-WebApplication",i).hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).hide()):($("#bz-oauth2-edit-only-WebApplication",i).hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).show()))}$("#admin-oauth2-applications-wrapper").hide();$(i).show();$("#btn-admin-oauth2-update-keys",i).click(function(){t.updateApplicationKeys()});$("#btn-admin-edit-oauth2-cancel",i).click(function(){t.cancel("edit")});t.CurrentClientData.IsNative?$("#btn-admin-edit-oauth2-add",i).click(function(){t.updateNaviteApplication()}):$("#btn-admin-edit-oauth2-add",i).click(function(){t.updateApplication()})}).fail(function(){})},updateNaviteApplication:function(){var n=this,t={accessTokenLifetimeInMinutes:""};t.accessTokenLifetimeInMinutes=parseInt($("#biz-wp-oauth2-edit-access-token-input").val(),10);t.accessTokenLifetimeInMinutes>0?n.dataService.updateOAuth2Application(t,n.CurrentClientData.Id).done(function(){n.performSimpleGrid();n.cancel("edit")}):$("#bz-oauth2-applications-error-time-invalid").show()},updateApplication:function(){function y(t){return $.grep(n.DataAllowedScope,function(n){return n===t}).length}function p(t,i){y(t)>0&&!i?n.DataAllowedScope=$.grep(n.DataAllowedScope,function(n){return n!==t}):y(t)===0&&i&&n.DataAllowedScope.push(t)}var n=this,w,b,k,t,r,i;$(".biz-wp-oauth2-warnings__alert").hide();var o=$("#biz-wp-oauth2-edit-name-input").val(),d=$("#biz-wp-oauth2-edit-id-input").val(),g=$("#biz-wp-oauth2-applications-edit-description-input").val(),nt=$("#biz-wp-oauth2-edit-web-site-input").val(),u=$("#biz-wp-oauth2-edit-redirect-uri-input").val(),s=$("#biz-wp-oauth2-edit-user-domain-input").val(),h=$("#biz-wp-oauth2-default-edit-user-name-input").val(),e=parseInt($("#biz-wp-oauth2-edit-access-token-input").val(),10),c=parseInt($("#biz-wp-oauth2-edit-mobile-host-port").val(),10),f=!1,l=[],a=$("#biz-wp-oauth2-edit-scope-api-input").is(":checked"),v=$("#biz-wp-oauth2-edit-scope-login-input").is(":checked");if(p("api",a),p("login",v),w=n.DataAllowedScope.join(" "),validateScope=function(){return a||v?!0:!1},validateGrandType=function(){return n.editGrantType==="authorization_code"?o&&u&&e?!0:!1:n.editGrantType==="client_credentials"?s&&h?!0:!1:o&&u&&e&&s&&h?!0:!1},n.editRedirectUri==="WebApplication"&&(n.editGrantType==="authorization_code"||n.editGrantType==="any")?(b=u,f=/^(ftp|http|https):\/\/[^ "]+$/.test(b)):n.editRedirectUri==="MobileTitleBarBrowser"&&(n.editGrantType==="authorization_code"||n.editGrantType==="any")?($("#biz-wp-oauth2-edit-redirect-uri-input").val("bz:oauth:2.0:server:mobiletitlebarbrowser"),f=!0):(u=c,f=!0),e<1){$("#bz-oauth2-applications-error-time-invalid").show();return}if(c<1){$("#bz-oauth2-applications-error-port-invalid").show();return}if(k=validateGrandType()&&validateScope(),k)if($("#biz-wp-oauth2-edit-name-input").val()!=n.ActualNameForEdit&&(l=$.grep(n.namesApplications,function(n){return n===$("#biz-wp-oauth2-edit-name-input").val()})),l.length===0){if(f){for(t={},t.authorization_grant_type=n.editGrantType,t.allowed_scope=w,t.username_creator=n.userFullName,t.redirect_uri_strategy=n.editRedirectUri,n.editGrantType==="client_credentials"&&(t.redirect_uri="http://localhost--"),r=$("#formEditOAuthApp :input").serializeArray(),i=0;i<r.length;i++)r[i].value&&(r[i].name==="redirect_uri_port"&&n.editRedirectUri==="MobileLocalhostPort"?t.redirect_uri="http://localhost:"+r[i].value:t[r[i].name]=r[i].value);n.dataService.updateOAuth2Application(t,d).done(function(){n.performSimpleGrid();n.cancel("edit")})}}else $("#bz-oauth2-applications-error-name-duplicated").show();else $("#bz-oauth2-applications-error-fields-required").show(),validateScope()||$("#bz-oauth2-applications-edit-error-scope-required").show()},updateApplicationKeys:function(){var n=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-applications-update-keys-confirmation"),"Bizagi","warning")).done(function(){var t=$("#biz-wp-oauth2-edit-id-input").val(),i={client_id:n.CurrentClientData.ClientId,client_secret:n.CurrentClientData.ClientSecret};n.dataService.updateClientSecretKeysOAuth2Application(i,t).done(function(t){t.success?(n.performSimpleGrid(),n.cancel("edit")):$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-error-update-keys"),null,"warning")).done(function(){n.performSimpleGrid();n.cancel("edit")})}).fail(function(){$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-error-update-keys"),null,"warning")).done(function(){n.performSimpleGrid();n.cancel("edit")})})})},deleteApplication:function(n){var t=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-grid-delete-confirmation"),"Bizagi","warning")).done(function(){t.dataService.deleteOAuth2Application(n);t.performSimpleGrid()})},cancel:function(n){var t=this;n==="add"&&$("#admin-oauth2-add-application").children().remove();n==="edit"&&$("#admin-oauth2-edit-application").children().remove();$("#admin-oauth2-applications-wrapper").show();t.cleanData()},cleanData:function(){self.AllowedScope=null;self.editAllowedScope=null;self.userFullName=null;self.grantType=null;self.editGrantType=null;self.RedirectUri=null;self.editRedirectUri=null;$(".biz-wp-input-text").val("");$(".biz-wp-oauth2-select-control").children().remove();self.CurrentClientData={}}});
bizagi.workportal.widgets.admin.business.policies.vocabularies.extend("bizagi.workportal.widgets.admin.business.policies.vocabularies",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.business.policies.vocabularies.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-vocabularies-wrapper"),"admin.business.policies.vocabularies.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-vocabularies-content"),useNewEngine:!1})},renderContent:function(){var n=this,i=n.getTemplate("admin.business.policies.vocabularies.wrapper"),t;return n.decisionTableContent=n.getTemplate("admin.business.policies.vocabularies.content"),t=n.content=$.tmpl(i,{}),n.params.canvas&&(t=$(n.params.canvas).append(t)),t},postRender:function(){var n=this}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.async.activities",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ASYNC_ACTIVITIES},renderContent:function(){var n=this,i=n.getTemplate("admin.async.activities"),t;return t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){}});
bizagi.workportal.widgets.admin.cases.extend("bizagi.workportal.widgets.admin.cases",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.cases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-cases"),useNewEngine:!1})},postRender:function(){var n=this;n.userTableConf={pageSize:10};$.when(n.dataService.getOrganizationInfo("Skill"),n.dataService.getOrganizationInfo("Location"),n.dataService.getOrganizationInfo("Role")).done(function(t,i,r){n.renderSearchCaseForm(r[0],t[0],i[0])})},renderSearchCaseForm:function(n,t,i){var r=this,u=r.getContent(),f=r.getTemplate("admin.search.cases");$.tmpl(f,{skill:t.profiles.length,role:n.profiles.length,location:i.profiles.length}).appendTo($("#form-search-cases",u));t.profiles.length&&(r.skillInput=$("#skill-wrapper",u),r.skillInput.searchList({list:t.profiles,cases:[]}));n.profiles.length&&(r.roleInput=$("#role-wrapper",u),r.roleInput.searchList({list:n.profiles,cases:[]}));i.profiles.length&&(r.locationInput=$("#location-wrapper",u),r.locationInput.searchList({list:i.profiles,cases:[]}));r.searchCasesForm=$(".admin-form-search-cases",u);r.searchCaseFormEventHandler()},renderSearchUserForm:function(n){var t=this,i=t.getContent(),r=t.getTemplate("admin.search.users");$.tmpl(r).appendTo($("#form-search-users",i));$("#cases-found-message-wrapper .message",i).text(printf(t.resources.getResource("workportal-widget-admincase-casesfound"),n));t.eventHandlerSearchUserForm()},showSearchCaseForm:function(n){var t=this,i=t.getContent();n?($("#form-search-cases",i).show(),t.searchCasesForm.show()):$("#form-search-cases",i).hide()},showSearchUsersForm:function(n){var t=this,i=t.getContent();n?t.renderSearchUserForm():$("#form-search-users",i).html("")},eventHandlerSearchUserForm:function(){var n=this,t=n.getContent();$("#search-user",t).bind("click",function(i){var u,r;i.preventDefault();u=$("#admin-form-search-users-wrapper",t);n.showConfirmAssignCasesForm(!1);r={};r.userName=$("#txtSAMAccount",u).val();r.fullname=$("#txtFullName",u).val();r.domain=$("#txtDomain",u).val();r.skills=$("#skill",t).val();r.locations=$("#location",t).val();r.roles=$("#role",t).val();n.showLoaderAtContainer($("#user-list-wrapper"));$.when(n.dataService.searchUsers(r)).done(function(t){n.closeLoader();n.updateTotalUsersForm(t)})});$("#back-search-case-form",t).bind("click",function(t){t.preventDefault();n.showSearchUsersForm(!1);n.showSearchCaseForm(!0)});$("#confirm-assign-cases",t).bind("click",function(i){i.preventDefault();for(var o=$("#admin-form-search-users-wrapper",t),r={},u=$("#user-list-wrapper .user-list-item label",o).filter(".ui-radio-state-checked").parent(),f=[],e=u.length;e-->0;)f.push(Number($("input",u[e]).val()));r.user=f;r.skills=n.getCasesSearchParams().skills;r.locations=n.getCasesSearchParams().locations;r.roles=n.getCasesSearchParams().roles;$.when(n.dataService.reassignCases(r)).done(function(){n.showConfirmAssignCasesMessage(!0)}).fail(function(){})});$("#cancel-assign-cases",t).bind("click",function(t){t.preventDefault();n.showConfirmAssignCasesForm(!1)})},searchCaseFormEventHandler:function(){var n=this,t=n.getContent();$("li[name=role], li[name=skill], li[name=location]",t).bind("click",function(){var n=$(this).find("span.ui-icon");n.attr("data-state")=="uncheck"?n.attr("data-state","check"):n.attr("data-state","uncheck")});$("#search-case",t).bind("click",function(t){t.preventDefault();var r=n.skillInput?n.skillInput.searchList("option","cases"):[],u=n.roleInput?n.roleInput.searchList("option","cases"):[],f=n.locationInput?n.locationInput.searchList("option","cases"):[],i={skills:r,locations:f,roles:u};n.searchCasesForm.hide();n.showLoaderAtContainer(n.searchCasesForm);$.when(n.dataService.getCasesByOrganization(i)).done(function(t){n.closeLoader();n.updateTotalCasesFound(i,t)})})},showLoaderAtContainer:function(n){self.dialogBox=$("<div class='ui-bizagi-component-loading'/>");n.after(self.dialogBox)},closeLoader:function(){self.dialogBox.remove()},setCasesSearchParams:function(n){this.caseSearchParams=n},getCasesSearchParams:function(){return this.caseSearchParams},updateTotalCasesFound:function(n,t){var i=this,u=i.getContent(),r=$("#no-cases-found-message-wrapper",u);i.setCasesSearchParams(n);t.totalCases>0?(r.hide(),i.showSearchCaseForm(!1),i.renderSearchUserForm(t.totalCases)):(i.showSearchCaseForm(!0),r.show())},updateTotalUsersForm:function(n){var t=this,r=t.getContent(),i=$("#no-users-found-message-wrapper",r);n.users.length>0?(i.hide(),t.userList={data:n.users},t.createPage(1)):i.show()},createPage:function(n){var t=this,o=t.getContent(),s=$("#user-list-wrapper",o),l=t.getTemplate("admin.table.users"),f=Math.ceil(t.userList.data.length/t.userTableConf.pageSize),h=new Array(f),r=[],u=t.userTableConf.pageSize*(n-1),e,i,c;for(e=t.userTableConf.pageSize+u<=t.userList.data.length?t.userTableConf.pageSize:t.userList.data.length-u,$(".user-list-item",s).remove(),e+=u,i=0;i<f;i++)h[i]=i+1;r=[].concat(t.userList.data);r=r.splice(u,e);c=$.tmpl(l,{users:r,pages:h});s.html(c);t.tableUsersHandlers();t.updateTableUsersPager(n);$("ul").bizagiPagination({maxElemShow:10,totalPages:f,actualPage:n,listElement:$("#user-list-footer-wrapper",o),clickCallBack:function(n){t.createPage(n.page);t.showConfirmAssignCasesForm(!1)}})},tableUsersHandlers:function(){var t=this,i=t.getContent(),n=$("#user-list-wrapper",i);$(".user-list-item",n).click(function(){$("label",this).toggleClass("ui-radio-state-checked");var i=$(".ui-radio label",n).filter(".ui-radio-state-checked").length>0;t.showConfirmAssignCasesForm(i);t.showConfirmAssignCasesMessage(!i)});$(".user-list-item",n).hover(function(){$(this).attr("data-value")||$("label",this).addClass("ui-radio-state-hover")},function(){$(this).attr("data-value")||$("label",this).removeClass("ui-radio-state-hover")});$("tbody tr",n).each(function(){$(this).index()%2<1&&$(this).addClass("biz-ui-even")})},updateTableUsersPager:function(n){var t=this,i=t.getContent(),r=$("#table",i);$("#user-list span[data-value="+n+"]",r).addClass("current-page")},showConfirmAssignCasesForm:function(n){var i=this,t=i.getContent();n?$("#assing-cases-confirm-form-wrappper",t).show():$("#assing-cases-confirm-form-wrappper",t).hide()},showConfirmAssignCasesMessage:function(n){var i=this,t=i.getContent();n?($("#assing-cases-confirm-form",t).hide(),$("#assign-cases-message-wrapper",t).show()):($("#assing-cases-confirm-form",t).show(),$("#assign-cases-message-wrapper",t).hide());$("#users-found-message-wrapper",t).hide()}});
bizagi.workportal.widgets.admin.caseSearch.extend("bizagi.workportal.widgets.admin.caseSearch",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.selectedCaseAdmin=[];r.selectedWorkItemAdmin=[];r.columnsID={caseNumber:"I_radNumber",process:"I_wfClsDisplayName",task:"I_tskDisplayName",processCreationDate:"I_casCreationDate",taskDueDate:"I_wiEstimatedSolutionDate",processDueDate:"I_casSolutionDate",userName:"I_userName",userfullName:"I_fullName",userLocation:"I_locName"};r.loadTemplates({"admin.case.search":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search"),"admin.case.search.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-fields"),"admin.case.search.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-buttons"),"admin.case.search.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-result"),"admin.case.search.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-pagination"),"admin.case.search.invalidate":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-invalidate"),"admin.case.search.reassign":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign"),"admin.case.search.reassign.form":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign-form"),"admin.case.search.action.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-action-result"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.generalContentTmpl=n.getTemplate("admin.case.search");n.fieldsContentTmpl=n.getTemplate("admin.case.search.fields");n.buttonContentTmpl=n.getTemplate("admin.case.search.button");n.resultContentTmpl=n.getTemplate("admin.case.search.result");n.paginationTmpl=n.getTemplate("admin.case.search.pagination");n.invalidateContentTmpl=n.getTemplate("admin.case.search.invalidate");n.reassignContentTmpl=n.getTemplate("admin.case.search.reassign");n.reassignFormTmpl=n.getTemplate("admin.case.search.reassign.form");n.actionResultContentTmpl=n.getTemplate("admin.case.search.action.result")},postRender:function(){var n=this;n.defaultMaxRows=10;n.maxElemShow=n.defaultMaxRows;n.maxPageToShow=5;n.processNavigation=[];n.setupData()},initPositionsCombo:function(){var n=this;$.when(n.dataService.getUserPositions()).done(function(t){var i={combo:[],id:"positions"};i.combo.push({id:"",name:"........."});$.each(t.positions,function(n,t){i.combo.push({id:t.idPosition,name:t.displayName})});n.renderPositionsCombo(i)}).fail(function(n){bizagi.log(n)})},renderPositionsCombo:function(n){var u=this,t=u.getContent(),i=$.Deferred(),r=$("#userPositionInput",t);return r.empty(),r.uicombo({isEditable:!1,data:n,itemValue:function(n){return n.id},itemText:function(n){return n.name},onComplete:function(){i.resolve()},onChange:function(n){var i=n.ui.data("value");$("#userPositionInput",t).val(i)},initValue:n.combo[0]}),i},setupData:function(){var n=this;n.setupInitialData();n.setupDatePicker();n.setupProcessTree();n.setupMainButtons();n.initPositionsCombo()},setupInitialData:function(){var n=this,t=n.getContent(),i;n.buttonBackAction="backToMainForm";n.selectedUserId="";n.selectedUserName="";n.selectedTasks="";n.selectedTasksToShow="";n.searchParams="";n.processTree="";$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle"));$("#mainForm",t).remove();$("#dinamicContent",t).remove();$("#case-search-log-data-buttonset",t).remove();i=$.tmpl(n.fieldsContentTmpl,{});t.append(i)},setupDatePicker:function(){var n=this,t=n.getContent(),i=bizagi.localization.getResource("dateFormat").replaceAll("yyyy","yy").replaceAll("MM","mm");$(".biz-wp-form-datepicker",t).datepicker({controlType:"select",dateFormat:i})},setupProcessTree:function(){var n=this,t=n.getContent();bizagi.treeRoutSelected=[];$("#treeLinksId").remove();n.processTree=new bizagi.workportal.widgets.processtree(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#processTree",t)}));n.processTree.render()},setupUsersSearchForm:function(){var n=this,i=n.getContent(),t=$.Deferred();$("#biz-wp-users-table-form").html("");n.usersTable=new bizagi.workportal.widgets.userstable(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#biz-wp-users-table-form",i),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admincasesearch-reassign")],parentDef:t}));n.usersTable.render();$.when(t).done(function(t,i){n.assignEventReassignLinks(t,i)})},findResults:function(n,t,i){var r=this;t.Page=i?i:1;$.when(r.dataService.getAdminCasesList(t)).done(function(i){var f;if($("#generalTitle").show(),$(".biz-wp-table").remove(),$(".case-search-action-wrapper").remove(),$("#biz-wp-table-summary-wrapper").remove(),r.totalRecords=i.records,r.totalPages=i.total,i.rows.length>0){r.showCasesSearchResultFrame(n,i);r.setupActionsButton(n);var o=r.maxPageToShow>r.totalPages?r.totalPages:r.maxPageToShow,s=$("#biz-wp-table-pager-wrapper"),u={},e;for(u.pagination=r.totalPages>1?!0:!1,u.page=i.page,u.pages={},f=1;f<=o;f++)u.pages[f]={pageNumber:f};e=$.tmpl(r.paginationTmpl,u).html();s.append(e);$("ul").bizagiPagination({maxElemShow:r.maxElemShow,totalPages:r.totalPages,actualPage:i.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(i){r.findResults(n,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),"Bizagi","warning")}).fail(function(n){bizagi.log(n)})},showCasesSearchResultFrame:function(n,t){var i=this,r=bizagi.override.disableAbortCases?!0:!1,u=i.preprocessResultList(t.headers,t),f=$.tmpl(i.resultContentTmpl,{headers:t.headers,rows:u,groupByCaseNumber:bizagiConfig.groupByCaseNumber,securityGraphicQuery:bizagi.menuSecurity.GraphicQuery,resultList:t},{getRadNumberColumnIndex:function(){for(var t=this.data,i=-1,n=0,r=t.headers.length;n<r;n++)t.headers[n].fieldName=="I_radNumber"&&(i=n);return i},showColumn:function(n){var t=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&t==n?" hidden ":""},createGroupedHeader:function(n){var i=this.data.resultList,t=!1,u=this.getRadNumber(i.rows[n]),r;return this.data.groupByCaseNumber&&(n==0?t=!0:(r=this.getRadNumber(i.rows[n-1]),u!=r&&(t=!0))),t},getRadNumber:function(n){var t=this.getRadNumberColumnIndex();return t>=0?n.data[t]:""}}),e=$.tmpl(i.invalidateContentTmpl,{}),o=$.tmpl(i.reassignContentTmpl,{});$("#mainForm",n).hide();$("#dinamicContent",n).html(f);r||$(".case-search-action-wrapper",n).append(e);$(".case-search-action-wrapper",n).append(o);$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title"));$("#btn-admin-case-search-clear",n).hide();$("#btn-admin-case-search",n).hide();$("#btn-admin-case-back",n).css("display","inline");i.setupActivitiesLink(n);i.setupGraphicQueryEvent(n);i.selectedItemsPersistence(n)},selectedItemsPersistence:function(n){var i=this,t="";$.each(i.selectedCaseAdmin,function(i,r){t="input:checkbox[name=CaseAdmin][value="+r+"]";$(t,n).prop("checked",!0)});$.each(i.selectedWorkItemAdmin,function(i,r){t="input:checkbox[name=workItemAdmin][value='"+r+"']";$(t,n).prop("checked",!0)})},preprocessResultList:function(n,t){for(var u=this,r=[],f=t.rows.length,i=0;i<f;i++)r.push(u.processResultItem(n,t.rows[i]));return r},processResultItem:function(n,t){var i=this,e=t.data,a=t.idCase,d=t.idWorkFlow,g=t.radNumber,nt=t.idParentCase,tt=t.isSubprocess,p=[],r=[],h,y,v,u=[],w,o=-1,f=0,b=!1,k,c,l,s;for(r.push({id:"checkCaseAdmin",value:a,radNumber:g,idParentCase:nt,isSubProcess:tt});o++<n.length-1;)switch(n[o].fieldName){case i.columnsID.caseNumber:r.push({id:"caseNumber",value:{idCase:a,caseNumber:e[f]}});f++;break;case i.columnsID.process:r.push({id:"idWorkItem",value:e[f]});f++;break;case i.columnsID.userName:case i.columnsID.userfullName:case i.columnsID.task:case i.columnsID.taskDueDate:if(h===undefined){for(s=e.length;s-->0;)if(Array.isArray(e[s])){h=e[s];b=!0;break}f++}b?(v=h[0],i.columnsID.userName==n[o].fieldName?(r=r.concat(i.processTaskObjectUser(v)),u.indexOf(i.columnsID.userName)==-1&&u.push(i.columnsID.userName)):i.columnsID.userfullName==n[o].fieldName?(r=r.concat(i.processTaskObjectUser(v)),u.indexOf(i.columnsID.userfullName)==-1&&u.push(i.columnsID.userfullName)):i.columnsID.task==n[o].fieldName?(r=r.concat(i.processTaskObject(v,a)),u.indexOf(i.columnsID.task)==-1&&u.push(i.columnsID.task)):i.columnsID.taskDueDate==n[o].fieldName&&(r=r.concat(i.processTaskObjectDate(v)),u.indexOf(i.columnsID.taskDueDate)==-1&&(n[o].fieldName==i.columnsID.taskDueDate&&e.splice(f,1),u.push(i.columnsID.taskDueDate)))):n[o].fieldName==i.columnsID.taskDueDate&&(r=r.concat({estimatedSolutionDate:e[o]}),u.indexOf(i.columnsID.taskDueDate)==-1&&u.push(i.columnsID.taskDueDate));break;case i.columnsID.processCreationDate:r.push({id:"processCreationDate",value:e[f]});f++;break;case i.columnsID.processDueDate:r.push({id:"processDueDate",value:e[f]});f++;break;default:k=bizagi.util.formatValueByDataType(e[f],n[o].type);r.push({id:"customField",value:k});f++}if(r.push({id:"viewProcess",value:{idCase:a,idworkflow:d}}),p.push({attr:"first_row",data:r}),y=h?h.length:0,y>1)for(w=u.length,c=1;c<y;c++){for(l=[],s=-1;s++<w-1;)u[s]==i.columnsID.task?l.push(i.processTaskObject(h[c],a)):u[s]==i.columnsID.taskDueDate?l.push(i.processTaskObjectDate(h[c])):u[s]==i.columnsID.userName?l.push(i.processTaskObjectUser(h[c])):u[s]==i.columnsID.userfullName&&l.push(i.processTaskObjectUser(h[c]));p.push({attr:"next_row",data:l})}return{data:p,totalTask:y}},processTaskObject:function(n,t){var i={taskName:n.taskName,colorState:n.colorState,taskType:n.taskType,idCase:t,idWorkItem:n.idWorkItem,idTask:n.idTask};return n.taskType==="Wait"?i.skip=!0:"",i},processTaskObjectDate:function(n){var t={};return t.estimatedSolutionDate=n.estimatedSolutionDate?n.estimatedSolutionDate:"",n.taskType==="Wait"?t.skip=!0:"",t},processTaskObjectUser:function(n){var t={};return t.userName=n.assignee?n.assignee:"",t},invalidateCases:function(n){var r=this,t="",u="",i={cases:[]},f;$("input:checkbox[name=CaseAdmin]:checked",n).each(function(){var n=$(this).val();$(this).data("subprocess")&&(t=t+" "+$(this).data("parentcase")+",");i.cases.push({idCase:n})});i.cases.length==0?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-empty-msg"),"Bizagi","warning"):(u=bizagi.util.isEmpty(t)?bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-confirm-msg"):bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-subprocess-confirm-msg")+t.substring(0,t.length-1),f={dialogClass:"widget-admincasesearch-invalidate-cases-confirm",width:400,minWidth:400},$.when(bizagi.showConfirmationBox(u,"Bizagi","warning",null,f)).done(function(){var t=$("#txtReason",n).val(),u={action:"abort",cases:JSON.stringify(i),reason:t};$.when(r.dataService.abortReassignItems(u)).done(function(t){r.showActionResultFrame(n,t.response,"invalidate")}).fail(function(n){bizagi.log(n)})}))},showReassignTasksFrame:function(n){var i=this,r={cases:[]},t=[];$("input:checkbox[name=workItemAdmin]:checked",n).each(function(){var n=$(this).val();n=n.split("|");r.cases.push({idCase:n[0],idWorkItem:n[1]});t.push({taskItem:n[0]+": "+n[2],idWorkItem:n[1]})});t.length==0?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-empty-msg"),"Bizagi","warning"):(i.selectedTasks=r,i.selectedTasksToShow=t,i.showReassignForm(n,t))},showReassignForm:function(n,t){var i=this,r;i.buttonBackAction="backToCases";r=$.tmpl(i.reassignFormTmpl,{tasks:t});$("#dinamicContent",n).hide();$("#dinamicContent2",n).html(r);$("#btn-admin-case-search-clear",n).hide();$("#btn-admin-case-search",n).hide();$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-title"));i.setupUsersSearchForm()},reassignTasks:function(){var n=this,t=n.getContent(),i={action:"reassignItems",cases:JSON.stringify(n.selectedTasks),idNewUser:n.selectedUserId};$.when(n.dataService.abortReassignItems(i)).done(function(i){n.showActionResultFrame(t,i.response,"reassign")}).fail(function(n){bizagi.log(n)})},showActionResultFrame:function(n,t,i){var h=this,s=t.length>1?"-several":"",f="",u="",o=[],r,e,c;if(s=i+s,s=="invalidate")for(r=0;r<t.length;r++)t[r].deleted==!0?(f=t[r].idCase,f+=r+1<t.length?", ":"",o[0]=!0):(u=t[r].idCase,u+=r+1<t.length?", ":"",o[1]=!1);else if(s=="invalidate-several")for(r=0;r<t.length;r++)t[r].deleted==!0?(f+=t[r].idCase,f+=r+1<t.length?", ":"",o[0]=!0):(u+=t[r].idCase,u+=r+1<t.length?", ":"",o[1]=!1);else if(s=="reassign")for(r=0;r<t.length;r++)t[r].reassigned==!0?(f+=t[r].idCase,f+=r+1<t.length?", ":"",o[0]=!0):(u=t[r].idCase,u+=r+1<t.length?", ":"",o[1]=!1);else if(s=="reassign-several"){for(f+="<br/><br/>",u+="<br/><br/>",r=0;r<t.length;r++)t[r].reassigned==!0?(f+=t[r].idCase+"<br/>",o[0]=!0):(u+=t[r].idCase+"<br/>",o[1]=!1);f+="<br/>";u+="<br/>"}e=$.tmpl(h.actionResultContentTmpl,{action:s,resultStatus:o,exceptionMessage:u.substring(u.indexOf("|")+1)});e=e[0].innerHTML.replace("{0}","<strong>"+f+"<\/strong>");c=u.substring(0,u.indexOf("|")===-1?undefined:u.indexOf("|"));e=e.replace("{3}","<strong>"+c+"<\/strong>");e=e.replace("{1}",h.selectedUserName);e=e.replace("{1}",h.selectedUserName);i=="invalidate"&&$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-result-title"));$("#mainForm",n).html("");$("#dinamicContent",n).css("display","inline");$("#dinamicContent",n).html(e);$("#dinamicContent2",n).remove();$("#usersTable",n).remove();$("#btn-admin-case-back",n).css("display","none");$("#btn-admin-case-search-clear",n).css("display","none");$("#btn-admin-case-search",n).css("display","none");$("#btn-admin-case-finish",n).css("display","inline")},setupMainButtons:function(){var n=this,t=n.getContent(),r=$.tmpl(n.buttonContentTmpl,{}),i;t.append(r);i=$("#case-search-log-data-buttonset",t);$("#btn-admin-case-search-clear",i).click(function(){$(".biz-wp-input-text",t).val("");$(".biz-wp-form-datepicker",t).val("");n.setupProcessTree()});$("#btn-admin-case-search",i).click(function(){var s="",h="",c="",i="",o="",f=n.processTree.getTreeRouteSelected(),l,r,u,e;f.length>0&&(f.length==2?(s=f[1],c=f[0],h=""):(s=f[f.length-1],h="",c=f[0]));l=parseInt($("#resultsNumber").val());n.maxElemShow=bizagi.util.isNumeric(l)?l:n.defaultMaxRows;r=$("#sinceDate");r=r.datepicker("getDate");r=r?bizagi.util.dateFormatter.formatInvariant(r,!1):"";u=$("#toDate");u=u.datepicker("getDate");u=u?bizagi.util.dateFormatter.formatInvariant(u,!1):"";e={h_action:"getCases",I_ProcessState:"Running",h_idApp:"",I_Users:"ALL",eventAsTask:!0,orderType:1,order:"",orderField:"",group:bizagiConfig.groupByCaseNumber?"T_RADNUMBER":null,I_radNumber:$("#caseInput").val(),I_idWFClass:c,I_USERNAME:$("#userNameInput").val(),I_USERFULLNAME:$("#userFullNameInput").val(),I_USERPOSITION:$("#userPositionInput").val(),I_From__CreationDate:r?r:$("#sinceDate").val(),I_To__CreationDate:u?u:$("#toDate").val(),h_idWFClassAuth:"",I_idCategory:h,I_idApplication:s,PageSize:n.maxElemShow};e.I_From__CreationDate==""||bizagi.util.isDate(e.I_From__CreationDate)?e.I_To__CreationDate==""||bizagi.util.isDate(e.I_To__CreationDate)?(n.searchParams=e,n.selectedCaseAdmin=[],n.selectedWorkItemAdmin=[],n.findResults(t,e)):(i=bizagi.localization.getResource("workportal-general-invalid-date"),o=bizagi.localization.getResource("workportal-widget-admincasesearch-to-date"),i=i.replace("{0}",o),bizagi.showMessageBox(i,"Bizagi","warning")):(i=bizagi.localization.getResource("workportal-general-invalid-date"),o=bizagi.localization.getResource("workportal-widget-admincasesearch-date-since"),i=i.replace("{0}",o),bizagi.showMessageBox(i,"Bizagi","warning"))});$("#btn-admin-case-back",i).click(function(){n.buttonBackAction=="backToMainForm"?n.backToMainForm():n.buttonBackAction=="backToCases"&&n.backToCases()});$("#btn-admin-case-finish",i).click(function(){n.setupData()});$("#resultsNumber",t).bind("keypress",function(n){var t=n.charCode?n.charCode:n.keyCode;if(t!=8&&(t<48||t>57))return!1})},getDateInvariantByControlIDSelector:function(n){var t="",i=$(n).datepicker("getDate");if(i!==null)try{t=bizagi.util.dateFormatter.formatInvariant(i,!1)}catch(r){t="";$(n).val("")}return t},backToCases:function(){var t=this,n=t.getContent();t.buttonBackAction="backToMainForm";$("#dinamicContent",n).show();$("#dinamicContent2",n).html("");$("#usersTable").remove();$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title"));$("#btn-admin-case-search-clear",n).hide();$("#btn-admin-case-search",n).hide()},backToMainForm:function(){var t=this,n=t.getContent();$("#mainForm",n).show();$("#dinamicContent",n).html("");$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle"));$("#btn-admin-case-search-clear",n).show();$("#btn-admin-case-search",n).show();$("#btn-admin-case-back",n).css("display","none")},assignEventReassignLinks:function(n,t){var i=this;i.selectedUserId=n;i.selectedUserName=t;i.reassignTasks()},setupActionsButton:function(n){var t=this;$("input:checkbox[name=CaseAdmin]",n).click(function(){valueSelected=$(this).val();$(this).is(":checked")?t.selectedCaseAdmin.push(valueSelected):t.selectedCaseAdmin.splice($.inArray(valueSelected,t.selectedCaseAdmin),1)});$("input:checkbox[name=workItemAdmin]",n).click(function(){valueSelected=$(this).val();$(this).is(":checked")?t.selectedWorkItemAdmin.push(valueSelected):t.selectedWorkItemAdmin.splice($.inArray(valueSelected,t.selectedWorkItemAdmin),1)});$("#btn-admin-case-invalidate",n).click(function(){t.invalidateCases(n)});$("#btn-admin-case-reassign",n).click(function(){t.showReassignTasksFrame(n)})},setupActivitiesLink:function(n){var t=this;$(".activityClicked",n).click(function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:$(this)[0].getAttribute("data-idworkItem"),idTask:$(this)[0].getAttribute("data-idTask")});t.publish("closeCurrentDialog")});$(".caseClicked",n).click(function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:"",idTask:""});t.publish("closeCurrentDialog")});$(".cases-column-header",n).click(function(){var r=$(this)[0].getAttribute("data-columnorder"),i=$(this)[0].getAttribute("data-ordertype"),u=$(this)[0].getAttribute("data-columnOrderName");i=i=="1"?0:1;t.searchParams.order=r;t.searchParams.orderType=i;t.searchParams.orderField=u;t.findResults(n,t.searchParams,t.searchParams.Page)})},setupGraphicQueryEvent:function(n){var t=this;$(".biz-wp-diagram-view-icon",n).click(function(){var n=$(this).data("idcase"),i=$(this).data("idworkflow");t.showGraphicQuery({idCase:n,idWorkflow:i})})}});
bizagi.workportal.widgets.admin.async.activities.extend("bizagi.workportal.widgets.admin.async.activities",{ASYNC_CHECK_TIMER:3e3},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({async:bizagi.getTemplate("bizagi.workportal.desktop.widget.async"),"admin.async.activities":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities"),"admin.async.activities.tabs":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tabs"),"admin.async.activities.tab1":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tab1"),"admin.async.activities.tab2":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tab2"),"admin.async.activities.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-log"),"admin.async.activities.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-pagination"),"admin.async.activities.error.page":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-error-page"),"admin.async.activities.processing":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-processing"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.tabsTmpl=n.getTemplate("admin.async.activities.tabs");n.tab1Tmpl=n.getTemplate("admin.async.activities.tab1");n.tab2Tmpl=n.getTemplate("admin.async.activities.tab2");n.logTmpl=n.getTemplate("admin.async.activities.log");n.paginatorTmpl=n.getTemplate("admin.async.activities.pagination");n.errorPage=n.getTemplate("admin.async.activities.error.page");n.processingPage=n.getTemplate("admin.async.activities.processing")},postRender:function(){var n=this;n.maxElemShow=10;n.maxPageToShow=5;n.setupData()},setupData:function(){var n=this;n.setupInitialData();n.setupTabs()},setupInitialData:function(){var t=this,n=t.getContent(),i=$(".async-act-main-content",n),r;$("#generalTitle",n).html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle"));i.html("");$("#main-screen",n).show();$("#dinamic-screen",n).html("");r=$.tmpl(t.tabsTmpl,{});i.append(r);t.loadTabsContent()},loadTabsContent:function(){var n=this,t=n.getContent(),i="",r="";i={action:"getActivities",page:1,pageSize:n.maxElemShow};r={action:"getActivitiesByTask",page:1,pageSize:n.maxElemShow};n.renderTab1Table(t,i);n.renderTab2Table(t,r)},setupTabs:function(){var n=this,t=n.getContent();$("#async-tabs",t).tabs()},renderTab1Table:function(n,t,i){var r=this,u=$("#main-screen",n);t.page=i?i:1;$.when(r.dataService.asyncActivitiesServices(t)).done(function(i){var o,e;if($("#async-tabs-1").remove(),r.totalRecords=i.records,r.totalPages=i.total,i.rows.length){o=$.tmpl(r.tab1Tmpl,{rows:i.rows});bizagi.util.formatInvariantDate(o,r.getResource("dateFormat")+" "+r.getResource("timeFormat"));$("#async-tabs",n).append(o);r.setupTab1ActivitiesLink();r.setupActionsButton();var h=r.maxPageToShow>r.totalPages?r.totalPages:r.maxPageToShow,c=$("#async-table-pager-wrapper"),f={},s;for(f.pagination=r.totalPages>1?!0:!1,f.page=i.page,f.pages={},f.additionalparameters=!0,f.totalPages=r.totalPages,f.totalRecords=r.totalRecords,e=1;e<=h;e++)f.pages[e]={pageNumber:e};s=$.tmpl(r.paginatorTmpl,f).html();c.append(s);$("ul").bizagiPagination({maxElemShow:r.maxElemShow,totalPages:r.totalPages,actualPage:i.page,listElement:$(".pager-content",u),clickCallBack:function(i){r.renderTab1Table(n,t,i.page)}})}else $("#async-tabs",n).hide(),$("#tabs-wrapper",n).append(bizagi.localization.getResource("workportal-general-no-records-found"))}).fail(function(n){bizagi.log(n)})},renderTab2Table:function(n,t){var i=this;$.when(i.dataService.asyncActivitiesServices(t)).done(function(t){var u,s,h,f,l;if($("#async-tabs-2").remove(),t.rows.length){var e=[],r=t.rows,c=[],o=0;for(u=0;u<r.length;u++)if(s=r[u].idWfClass,h=Number(r[u].count),c.indexOf(s)<0){for(c.push(s),e[o]={wfClsDisplayName:r[u].wfClsDisplayName,idWfClass:r[u].idWfClass,childs:[{idTask:r[u].idTask,tskDisplayName:r[u].tskDisplayName,count:r[u].count}]},f=u+1;f<r.length;f++)s==r[f].idWfClass&&(h+=Number(r[f].count),e[o].childs.push({idTask:r[f].idTask,tskDisplayName:r[f].tskDisplayName,count:r[f].count}));e[o].count=h;o+=1}l=$.tmpl(i.tab2Tmpl,{rows:e});$("#async-tabs",n).append(l);i.setupTab2ActivitiesLink()}}).fail(function(n){bizagi.log(n)})},executeActivity:function(n){var t=this,u=t.getContent(),e=$("#main-screen",u),f=$("#dinamic-screen",u),i="",r="";$.when(t.dataService.asyncActivitiesServices(n)).done(function(u){if(u.executed){var e=$.Deferred();$.when(t.checkAsycnExecutionState(1,n.idCase,n.idAsynchWorkitem,e)).done(function(){t.goToCase(n.idCase)}).fail(function(){i=bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-message");r=$.tmpl(t.errorPage,{errorMessage:i});f.html("");f.append(r);t.setupErrorPageLink("#go-to-pending")})}else i=bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-retry"),r=$.tmpl(t.errorPage,{errorMessage:i})}).fail(function(n){bizagi.log(n)})},getRetryStatus:function(n,t,i){var r=this,u={action:"getAsyncExecution",idCase:t};return setTimeout(function(){$.when(r.dataService.getAsynchExecutionState({idCase:t,idAsynchWorkitem:idAsynchWorkitem})).done(function(n){n.status!="error"&&i.resolve()}).fail(function(){n<=3?(n+=1,r.getRetryStatus(n,t,idAsynchWorkitem,i)):i.reject()})},1e3),i.promise()},checkAsycnExecutionState:function(n,t,i,r){var u=this,f=u.getContent(),s=$("#main-screen",f),e=$("#dinamic-screen",f),o="",h=$("#ui-bizagi-wp-async-box",f);return $.when(u.dataService.getAsynchExecutionState({idCase:t,idAsynchWorkitem:i})).done(function(h){var c=u.getTemplate("async");h.state=="Error"&&typeof h.errorMessage=="undefined"&&(h.errorMessage=bizagi.localization.getResource("render-async-error"));o=$.tmpl(c,h);s.hide();e.html("");e.append(o);$("#ui-bizagi-wp-async-box",f).css({top:0,left:0,"margin-top":0,"margin-left":0,"padding-top":0,"margin-right":0,width:"96%","max-height":"80",height:"80"});u.setupErrorPageLink($("#link-go-to-inbox").find("a"));$("#link-back").css("display","inline");u.setupBackToMainPage();h.state=="Processing"?h.errorMessage.length==0&&setTimeout(function(){n+=1;u.checkAsycnExecutionState(n,t,i,r)},u.Class.ASYNC_CHECK_TIMER):h.state=="Finished"&&r.resolve(u.content)}),r.promise()},showLog:function(n,t,i){var r=this,u=r.getContent();n.page=i?i:1;$.when(r.dataService.asyncActivitiesServices(n)).done(function(i){var o,e;if(r.totalRecords=i.records,r.totalPages=i.total,i.response.length){o=$.tmpl(r.logTmpl,{rows:i.response,data:t});bizagi.util.formatInvariantDate(o,r.getResource("dateFormat")+" "+r.getResource("timeFormat"));$("#dinamic-screen",u).html("");$("#dinamic-screen",u).append(o);r.setupLogButtons();var c=r.maxPageToShow>r.totalPages?r.totalPages:r.maxPageToShow,s=$("#log-table-pager-wrapper"),f={},h;for(f.pagination=r.totalPages>1?!0:!1,f.page=i.page,f.pages={},f.additionalparameters=!0,f.totalPages=r.totalPages,f.totalRecords=r.totalRecords,e=1;e<=c;e++)f.pages[e]={pageNumber:e};h=$.tmpl(r.paginatorTmpl,f).html();s.append(h);$("ul",s).bizagiPagination({maxElemShow:r.maxElemShow,totalPages:r.totalPages,actualPage:i.page,listElement:$(".pager-content",s),clickCallBack:function(i){r.showLog(n,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-general-no-records-found"),"Bizagi","warning")}).fail(function(n){bizagi.log(n)})},enableActivities:function(n,t){var i=this,r={action:"enableExecution",idTask:t,idWfClass:n};$.when(i.dataService.asyncActivitiesServices(r)).done(function(){i.setupData()}).fail(function(){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")})},enableMultipleActivities:function(n){var t=this,i={action:"enableMultiple",cases:JSON.stringify(n)};$.when(t.dataService.asyncActivitiesServices(i)).done(function(n){n.executed?t.setupData():bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")}).fail(function(){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")})},goToCase:function(n){var t=this;t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:n,idWorkItem:"",idTask:""});t.publish("closeCurrentDialog")},setupActionsButton:function(){var n=this,t=n.getContent(),i=$.tmpl(n.buttonContentTmpl,{});t.append(i);$("#async-act-refresh-link",t).unbind();$("#async-act-refresh-link",t).click(function(){n.setupData()});$(".async-act-log-link",t).click(function(){var i={action:"asyncExecutionLog",idCase:this.getAttribute("data-idCase"),idWorkItem:this.getAttribute("data-idWorkItem"),pageSize:n.maxElemShow,idAsynchWorkitem:this.getAttribute("data-idAsynchWorkitem")},r={idCase:this.getAttribute("data-idCase"),radNumber:this.getAttribute("data-radNumber"),taskName:this.getAttribute("data-taskName"),processName:this.getAttribute("data-processName")};$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-activitieslog"));$("#main-screen",t).hide();n.showLog(i,r)});$(".async-act-retry-link",t).click(function(){var t={action:"retryNow",idCase:this.getAttribute("data-idCase"),idWorkitem:this.getAttribute("data-idWorkItem"),processName:this.getAttribute("data-processName"),idAsynchWorkitem:this.getAttribute("data-idAsynchWorkitem"),taskName:this.getAttribute("data-taskName")};n.executeActivity(t)});$("#async-act-enable-checks",t).click(function(){for(var f,i=document.getElementsByName("enableChecks"),r={cases:[]},t=0,e=i.length;t<e;t++)if(i[t].checked){var u=i[t].value,o=i[t].getAttribute("data-idWorkItem"),f=i[t].getAttribute("data-idAsynchWorkitem");f=u!=-1?-1:i[t].getAttribute("data-idAsynchWorkitem");r.cases.push({idCase:u,idWorkItem:o,idAsynchWorkitem:f})}n.enableMultipleActivities(r)})},setupLogButtons:function(){var t=this,n=t.getContent();$("#async-act-button-back",n).click(function(){$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle"));$("#main-screen",n).show();$("#dinamic-screen",n).html("")})},setupTab1ActivitiesLink:function(n){var t=this;$(".async-activity-click",n).click(function(){t.goToCase($(this)[0].getAttribute("data-idCase"))})},setupTab2ActivitiesLink:function(n){var t=this;$(".async-act-process-tree-link",n).click(function(){$("div",this).hasClass("biz-wp-tree-expand-icon")?($("div",this).removeClass("biz-wp-tree-expand-icon"),$("div",this).addClass("biz-wp-tree-collapse-icon"),$(this).closest("tr").find(".async-act-childs").css("display","block"),$(this).closest("tr").find(".async-act-childs").addClass("clearfix")):($("div",this).removeClass("biz-wp-tree-collapse-icon"),$("div",this).addClass("biz-wp-tree-expand-icon"),$(this).closest("tr").find(".async-act-childs").css("display","none"),$(this).closest("tr").find(".async-act-childs").removeClass("clearfix"))});$(".async-act-enable-link").click(function(){var n=this.getAttribute("data-idWfClass"),i=this.getAttribute("data-idTask")?this.getAttribute("data-idTask"):0;t.enableActivities(n,i)})},setupErrorPageLink:function(n){var t=this;$(n).click(function(){var r=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX,n=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID,i,u=$.isFunction(bizagi.cookie)?bizagi.cookie("bizagiDefaultWidget"):n;switch(u){case r:i=r;break;case n:i=n;break;default:i=n}t.publish("changeWidget",{widgetName:i});t.publish("closeCurrentDialog")})},setupBackToMainPage:function(){var n=this,t=n.getContent(),i=$("#ui-bizagi-wp-async-box",t);$("#link-back",i).click(function(){n.setupData()})}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.usersAdministration",{},{init:function(n,t,i){var r=this;r.maxRows=18;r.maxPages=10;r.currentPage=1;r.orderType="ASC";r.orderField="";r.totalPages=0;r.userData={};r.allowCreation=!0;r.userLinks=[{name:"edition",label:bizagi.localization.getResource("bz-rp-components-dimension-edit"),icon:"bz-icon-pencil-outline"},{name:"log",label:bizagi.localization.getResource("render-actions-log"),icon:"bz-icon-log-outline"}];r._super(n,t,i);r.loadTemplates({"admin.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users"),"admin.users.formbuttons":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-formbuttons"),"admin.users.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-log"),"admin.users.licenses":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-licenses"),"admin.users.email":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-email"),"admin.search.cases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-search-cases"),"admin.search.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-search-users"),"admin.table.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-table-users"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_ADMINISTRATION},renderContent:function(){var n=this,t=n.getTemplate("admin.users");return n.content=$.tmpl(t)}});
bizagi.workportal.widgets.admin.usersAdministration.extend("bizagi.workportal.widgets.admin.usersAdministration",{},{postRender:function(){var n=this;n.dateFormat=n.getResource("dateFormat")+" "+n.getResource("timeFormat");n.$userTable=$("#bz-wp-widget-adminuser-usertable",n.content);n.$renderForm=$("#bz-wp-widget-adminuser-renderform",n.content);n.$buttonsContainer=$("#bz-wp-widget-adminuser-buttonset",n.content);n.$usersLicenses=$("#bz-wp-widget-adminuser-licenses",n.content);$.when(n.queryUserPermissions()).done(function(){n.renderUsersTable()});n.addEventsHandler()},renderUsersTable:function(){var n=this;n.usersTable=new bizagi.workportal.widgets.userstable(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:n.$userTable,userLinkLabel:n.userLinks}));n.usersTable.render()},queryUserPermissions:function(){var n=this,t=$.Deferred();return $.when(n.queryLicenses(),n.dataService.createUserAdministrationForm()).done(function(i,r){n.allowCreation=!i||!r[0].createUser?!1:!0;t.resolve()}),t.promise()},queryLicenses:function(){var n=this,t=$.Deferred();return $.when(n.dataService.queryUsersLicenses()).done(function(i){n.showLicensesMessage(i);t.resolve(i.canAddNewUser)}),t.promise()},showLicensesMessage:function(n){var t=this,i;(!n.canAddNewUser||n.areLicensedUsersLimitNear)&&(i=t.getTemplate("admin.users.licenses"),t.$renderForm.height("82%"),t.$usersLicenses.html($.tmpl(i,{users:n.activeUsers,licenses:n.licensedUsersAccount})))},addEventsHandler:function(){var n=this;n.$userTable.on("clickUserLink",function(t,i){n.userData=i;switch(i.type){case"log":n.resetLogValues();n.getUsersLogData();break;case"edition":n.renderForm()}});n.$userTable.on("completeUserForm",function(){n.renderFormButtons("query")});n.$userTable.on("click","#bz-wp-widget-adminuser-createbutton-wrapper",function(){n.userData={};n.renderForm()});$("#bz-wp-widget-adminuser-buttonset",n.content).on("click","button",function(){n.returnToUserTable()});n.$renderForm.on("click","table .sortColumnsData",function(){var t=$(this).data("orderfield"),i=$(this).data("ordertype");n.getUsersLogData({orderType:i,orderField:t})});n.$usersLicenses.on("click","button",function(t){var i=$(this).data("type");switch(i){case"buy":n.buyLicense();break;case"licenses":n.renderLicensesWidgets()}t.stopPropagation()})},resetLogValues:function(){var n=this;n.currentPage=1;n.orderType="ASC";n.orderField=""},renderLicensesWidgets:function(){var n=this;n.publish("showDialogWidget",{widgetName:"userlicenses",data:{idCase:"Licenses"},modalParameters:{title:n.getResource("workportal-menu-submenu-Licenses"),width:"907px",showCloseButton:!0,id:"Licenses"}})},buyLicense:function(){window.open("http://www.bizagi.com","_black")},returnToUserTable:function(){var n=this;n.toggleForm(!0);n.removeButtons();n.$renderForm.empty()},getUsersLogData:function(n){var t=this,n=n||{};t.orderType=n.orderType||t.orderType;t.orderField=n.orderField||t.orderField;$.when(t.dataService.getUsersAdministrationLog({idUser:t.userData.id,Pag:t.currentPage,pagSize:t.maxRows,orderField:t.orderField,orderType:t.orderType})).done(function(n){t.totalPages=n.total;t.renderUserLogTable(n)})},removeButtons:function(){var n=this;n.$buttonsContainer.empty()},renderUserLogTable:function(n){var t=this,r=t.getTemplate("admin.users.log"),e=t.$renderForm,u=t.totalPages>1,f=t.getPagesArray(),i;t.toggleForm(!1);i=$.tmpl(r,n,{userName:t.userData.name,page:t.currentPage,pagination:u,pagesArray:f,orderType:t.orderType,orderField:t.orderField});bizagi.util.formatInvariantDate(i,t.dateFormat);t.$renderForm.html(i);t.setUpPagination();t.renderFormButtons("back")},setUpPagination:function(){var n=this,t=$("#biz-wp-usersadministration-pager ul",n.content);t.bizagiPagination({maxElemShow:n.maxRows,totalPages:n.totalPages,actualPage:n.currentPage,listElement:t,clickCallBack:function(t){n.currentPage=parseInt(t.page);n.getUsersLogData()}})},getPagesArray:function(){for(var n=this,r=n.maxPages>n.totalPages?n.totalPages:n.maxPages,i=[],t=0;t<r;t++)i.push(t+1);return i},renderFormButtons:function(n){var t=this,r=t.getTemplate("admin.users.formbuttons"),i=$.tmpl(r,{type:n,allowCreation:t.allowCreation});n==="query"?$("#bz-wp-widget-adminuser-usertable #users-table-buttonset",t.content).append(i):t.$buttonsContainer.html(i)},toggleForm:function(n){var t=this;switch(n){case!0:t.$userTable.show();t.$renderForm.hide();break;case!1:t.$userTable.hide();t.$renderForm.show()}},getPages:function(){for(var n=this,r=n.maxPages>n.totalPages?n.totalPages:n.maxPages,i=[],t=0;t<r;t++)i.push(t+1);return i},renderForm:function(){var n=this;bizagi.loader.start("rendering").then(function(){var r=n.$renderForm,t=new bizagi.rendering.facade,i=n.userData.id||0,u=n.userData.id?"edit":"add",f=n.getLoadFormParams(i);n.toggleForm(!1);n.removeButtons();n.dataService.getUsersForm(f).done(function(f){var e={canvas:r,data:f,type:"usersForm",userId:i,action:u};t.execute(e).done(function(){n.userForm=t.form;n.userForm.bind("endUsersForm",function(t,i){n.performActionsAfterSave(i)})})})})},getLoadFormParams:function(n){var t={h_action:"LOADUSERADMINFORM",h_contexttype:"entity"};return n?$.extend(t,{h_xpathContext:"@Context.Users[id == "+n+"]",h_optionform:"edit"}):$.extend(t,{h_optionform:"add"}),t},performActionsAfterSave:function(n){var t=this,i=n.userId||t.userData.id;n.sendMail&&t.sendMail(i,n.password);n.formAction==="save"||n.formAction==="cancel"?$.when(t.queryUserPermissions()).done(function(){t.usersTable.excecuteQuery();t.allowCreation||$("#bz-wp-widget-adminuser-createbutton-wrapper",t.content).remove();n.error||(t.userForm.endLoading(),t.returnToUserTable())}):t.returnToUserTable()},sendMail:function(n,t){var i=this;i.dataService.generateDataToSendByEmail({idUser:n}).done(function(n){i.showEmailPopup(n,t)})},showEmailPopup:function(n,t){var i=this,f=window.document,e=i.getTemplate("admin.users.email"),r=i.dialogBoxEmail=$("<div class= admin-users-email/>"),u;r.empty();r.appendTo("body",f);u={};u[i.getResource("workportal-widget-admin-users-button-label-send")]=function(){if($("#txtTextTo",r).val()!==""){var n={eMailTo:$("#txtTextTo",r).val(),subject:$("#txtSubject",r).val(),body:$("#txtBody",r).val(),userSecret:t};$.when(i.dataService.sendUserEmail(n)).done(function(n){i.closeUploadDialogEmail();var t=bizagi.localization.getResource("workportal-widget-admin-users-Send-message");n.logOff&&n.logOff=="false"&&(t=bizagi.localization.getResource("workportal-widget-admin-users-Not-Send-message"));bizagi.showMessageBox(t,"Bizagi","warning")})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-empty-email-to"),"Bizagi","warning")};u[i.getResource("workportal-widget-admin-users-button-label-notSend")]=function(){i.closeUploadDialogEmail()};n.body=n.body.replace(/\\n/g,"\n").replace(/\\/g,"");$.tmpl(e,{messageResponse:n}).appendTo(r);$(".ui-bizagi-loading-message").remove();r.dialog({width:500,title:i.getResource("workportal-widget-admin-users-subtitle-email"),modal:!0,maximize:!1,resizable:!1,draggable:!1,buttons:u,close:function(){i.closeUploadDialogEmail()},resizeStop:function(n,t){i.form&&i.form.resize(t.size)}})},closeUploadDialogEmail:function(){var n=this;n.dialogBoxEmail.dialog("destroy");n.dialogBoxEmail.remove()}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.holidays",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_HOLIDAYS},init:function(n,t,i){var r=this;r.holidaysObj={calendarSelector:null,activeCalendar:"",schemas:[],schema:{},holidays:{},holidaysInServer:{}};r._super(n,t,i);r.loadTemplates({"admin.holidays":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.holidays").concat("#ui-bizagi-workportal-widget-admin-holidays"),"admin.holidays.calendar.schema":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.holidays").concat("#ui-bizagi-workportal-widget-admin-holidays-calendar-schema"),useNewEngine:!1})},renderContent:function(){var n=this,t=n.getTemplate("admin.holidays");return n.content=$.tmpl(t)},postRender:function(){var n=this;$.when(n.dataService.getHolidaysSchemas()).done(function(t){n.holidaysObj.schemas=t;$.each(t,function(t,i){n.holidaysObj.schema[i.id]={}});n.renderHolidaysSchema(t)}).fail(function(n){console.log("ERROR",n)})},_getSchemas:function(n){n=n||[];var t={};return $.each(n,function(n,i){t[i.id]=i}),t},_getDaysBySchema:function(n,t){return n=n||"",t=t||{},t[n]||[]},_calendarHasChanges:function(){var n=this,t=!1;return n.holidaysObj.activeCalendar!=""&&n.holidaysObj.schema[n.holidaysObj.activeCalendar].modified&&(t=!0),t},_getChanges:function(n){var t=this,r=[],u=[],i=[];if(n){var f=function(n){var t,r,i;return n.date.length==19?t=n:(r=n.date.split("T"),i=new Date(n.date),n.date=$.datepicker.formatDate("yy-mm-ddT00:00:00",i),t=n),t},e=function(n,t){var i=-1;return n=n||new Date,$.each(t,function(t,r){new Date(r.date).getTime()==n.getTime()&&(i=t)}),i},o=function(n,t,o){var s=o=="add"?u:r,h=o=="add"?r:u;$.each(n,function(n,r){var u=e(new Date(r.date),t),c,l,o;u>=0?(c=e(new Date(r.date),i),c==-1&&i.push(r),t[u].description!=r.description&&(l=e(new Date(t[u].date),h),l==-1&&(h.push(f(t[u])),s.push(f(r))))):(o=f(r),s.push(o),i.push(o))})};return o(t.holidaysObj.holidays[n],t.holidaysObj.holidaysInServer[n],"add"),o(t.holidaysObj.holidaysInServer[n],t.holidaysObj.holidays[n],"delete"),{"delete":r,add:u,actually:i}}},saveSchema:function(n){var t=this,r=t.getContent(),i=$(".bz-ui-save-status",r);$.when(t._saveSchema(n)).done(function(){t.showSuccess(bizagi.localization.getResource("workportal-general-success"),i)}).fail(function(n){t.showError(bizagi.localization.getResource("workportal-general-error")+" : "+n.toString(),i)})},_saveSchema:function(n){var t=this,r=t._getChanges(n),i=new $.Deferred,u={add:r.add,"delete":r.delete};return t.holidaysObj.calendarSelector.startLoading({overlay:!0}),$.when(t.dataService.saveHolidaysBySchema({schema:n,data:JSON.encode(u)})).done(function(){t._resetSchemaChanges(n);setTimeout(function(){t._changeSchema(n);t.holidaysObj.calendarSelector.endLoading();i.resolve()},1e3)}).fail(function(n){t.holidaysObj.calendarSelector.endLoading();i.reject(n.toString())}),i.promise()},showError:function(n,t){var i='<i class="bz-icon bz-icon-error"><\/i>&nbsp; Error:'+n;t.empty();t.show();t.removeClass("status-success");t.addClass("status-error");t.html(i)},showSuccess:function(n,t){var i='<i class="bz-icon bz-icon-test"><\/i>&nbsp;'+n;t.empty();t.show();t.removeClass("status-error");t.addClass("status-success");t.html(i);window.setTimeout(function(){t.fadeOut(600)},5e3)},_resetSchemaChanges:function(n){if(n){var t=this;t.holidaysObj.schema[n].modified=!1;t.holidaysObj.holidays[n]={}}},renderHolidaysSchema:function(n){n=n||[];var t=this,r=t.getTemplate("admin.holidays.calendar.schema"),f=t.getContent(),u=t._getSchemas(n),i=$.tmpl(r,{schemas:u});t.holidaysObj.calendarSelector=$("#biz-wp-admin-holidays-calendar",i);$("#biz-wp-admin-holidays-schemas").append(i);t.holidaysSchemaHandlers();t.renderHolidaysCalendar();$("[name='save']",i).on("click",function(){t._calendarHasChanges()&&t.saveSchema(t.holidaysObj.activeCalendar)});$("[name='cancel']",i).on("click",function(){t.params.dialogBox.dialog("close")});$("button",i).button()},_changeSchema:function(n){var t=this;t.holidaysObj.activeCalendar=n;n==""?t.renderHolidaysCalendar():(t.holidaysObj.calendarSelector.startLoading(),$.when(t.dataService.getHolidaysBySchema({schema:n})).done(function(i){t.holidaysObj.holidaysInServer[n]=JSON.parse(JSON.encode(i));t.holidaysObj.holidays[n]=i;t.renderHolidaysCalendar({dates:t.holidaysObj.holidays[n]||[]})}).always(function(){t.holidaysObj.calendarSelector.endLoading()}))},holidaysSchemaHandlers:function(){var n=this,t=$("#biz-wp-admin-holidays-schemas select");t.change(function(t){n.holidays=[];var i=t.currentTarget.value;n._calendarHasChanges()?$.when(bizagi.showSaveBox(n.getResource("confirmation-savebox-message1"),n.getResource("confirmation-box-title"),"warning")).done(function(){$.when(n.saveSchema(n.holidaysObj.activeCalendar)).done(function(){n._changeSchema(i)})}).fail(function(){n._resetSchemaChanges(n.holidaysObj.activeCalendar);n._changeSchema(i)}):n._changeSchema(i)})},renderHolidaysCalendar:function(n){n=n||{};var t=this,u=t.getContent(),i=n.dates||[],f=$("#biz-wp-admin-holidays-calendar",u),e=(new Date).getFullYear(),o=n.datePickerOptions||{},s=$.extend({minDate:"-5y",maxDate:"+10y",stepMonths:12,numberOfMonths:[3,4],defaultDate:"1/1/"+e,onSelect:function(n){l(n)},beforeShowDay:function(n){if(t.holidaysObj&&t.holidaysObj.activeCalendar=="")return[!1,"ui-datepicker-notselected"];var f=new Date,i=r(n),u=f.getTime()>new Date(n).getTime()?!1:!0;return i.position>-1?[u,"ui-datepicker-selected",i.description]:[u,"ui-datepicker-notselected","no selected"]}},o),r=function(n){for(var f,e,r={position:-1,description:""},u="yy/mm/dd",t=0,o=i.length;t<o;t++)f=i[t].date.split("T"),e=f[0].replace(/-/g,"/"),$.datepicker.formatDate(u,new Date(n))==$.datepicker.formatDate(u,new Date(e))&&(r.position=t,r.description=i[t].description);return r},h=function(n){n.date=new Date(n.date);n.date.setHours(0);n.date.setMinutes(0);n.date.setSeconds(0);n.date=n.date.toISOString();i.push(n)},c=function(n){i.splice(n,1)},l=function(n){var i=r(n);i.position>-1?c(i.position):h({date:n,description:""});t.holidaysObj.schema[t.holidaysObj.activeCalendar].modified=!0};t.holidaysObj.calendarSelector.data("datepicker")&&t.holidaysObj.calendarSelector.datepicker("destroy");t.holidaysObj.calendarSelector.datepicker(s);$("td.ui-datepicker-notselected",f).tooltip()},_showNotification:function(n,t,i){var u=this,r=new NotificationMessage(n,{body:t,iconType:_NOTIFICATION_ICON_TYPE.CSS});r.onClick=function(n){return n.preventDefault(),this.close(),!1};u.publish("notification",{notification:r,type:i})}});var tooltip=function(n){n=n||{};n.element=n.element||$("div");var t=function(){u()},i=function(){r()},r=function(){typeof n.onClose=="function"&&n.onClose()},u=function(){typeof n.onOpen=="function"&&n.onOpen()};return{open:t,close:i}}();
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.projectName",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PROJECTNAME},init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.projectname":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.projectname").concat("#ui-bizagi-workportal-widget-admin-projectname"),useNewEngine:!1})},renderContent:function(){var n=this,i=n.getTemplate("admin.projectname"),t=n.content=$.tmpl(i);return $("button",t).button(),t},showError:function(n,t){var i='<i class="bz-icon bz-icon-error"><\/i>&nbsp; Error:'+n;t.empty();t.show();t.removeClass("status-success");t.addClass("status-error");t.html(i)},showSuccess:function(n,t){var i='<i class="bz-icon bz-icon-test"><\/i>&nbsp;'+n;t.empty();t.show();t.removeClass("status-error");t.addClass("status-success");t.html(i)},postRender:function(){var t=this,n=t.getContent(),i=$(".projectname-message-status",n);$("input",n).on("keypress",function(){i.hide();$(this).val().length>=0&&$("input",n).removeClass("status-error")});$.when(t.dataService.getProjectName()).done(function(t){$("input",n).val(t.projectName)}).fail(function(n){console.log("ERROR",n)});$("[name='cancel']",n).on("click",function(){t.params.dialogBox.dialog("close")});$("[name='save']",n).on("click",function(){var r=$("input",n).val();if($(n).startLoading({overlay:!0}),r.length==0){$("input",n).addClass("status-error");$(n).endLoading();return}$.when(t.dataService.setProjectName(r)).done(function(){$(n).endLoading();t.showSuccess(bizagi.localization.getResource("workportal-widget-admin-projectname-success"),i)}).fail(function(r){r.responseText=r.responseText||{message:bizagi.localization.getResource("workportal-general-error")};var u=JSON.parse(r.responseText);console.log("Error:",r);$(n).endLoading();t.showError(u.message,i)})})}});
bizagi.workportal.widgets.widget.extend("adhoc.processes.admin.authorization",{},{init:function(n,t,i){var r=this;r.notifier=bizagi.injector.get("notifier");r._super(n,t,i);r.loadTemplates({"adhoc.processes.authorization.editor.popup":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#adhoc-process-authorization-popup-template"),"adhoc.processes.authorization.editor.popup.items":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#adhoc-process-authorization-popup-items-template"),"adhoc.processes.authorization.editor.usergroup.popup":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#adhoc-process-authorization-item-popup-template"),useNewEngine:!1})},renderAuthorizationItems:function(n,t,i,r){var u=this,f;u.currentProcessId=t;f=u.getTemplate("adhoc.processes.authorization.editor.popup.items");$.when(u.dataService.loadAuthItemInfoByInstance(i)).done(function(t){var e=$.tmpl(f,{authItemList:t}),o,s;n.append(e);o=$("#addUserButton",e);s=$(".item-delete-button",e);o.on("click",$.proxy(u.onAddAuthorizationItem,u,i,r));s.on("click",$.proxy(u.onRemoveAuthorizationItem,u,i,r))}).fail(function(n){bizagi.log(n)})},showUserGroupEditorPopup:function(n,t){var i=this,f=$(window).width()-$(window).width()*15/100+"px",r=[],u;t!=null&&t.allowTo.count()>0&&(r=t.allowTo);u={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ADHOC_USER_GROUPS,data:{allowSelection:!0,selectedItem:n.inputUserName.val().length>0?"":n.authItemId.val()},closeVisible:!1,modalParameters:{title:i.getResource("workportal-menu-submenu-AdhocUserGroupAdmin"),id:"AdhocUserGroupAdmin"},buttons:[{text:i.getResource("workportal-adhoc-process-auth-search-form-group-link"),click:function(){var u=this,f=$(this).dialog("option","widget"),t=f.currentUserGroup||{},e=r.some(function(n){return n.instance===t.id});e?bizagi.showMessageBox(i.getResource("workportal-adhoc-process-auth-select-group-validation"),"Bizagi","warning"):(Object.keys(t).length!==0&&(n.authItemId.val(t.id),n.authItemId.data("itemtype","group"),n.userGroupName.text(t.displayName),n.userGroupLink.text("Change Group"),n.userGroupName.show(),n.inputUserName.val("")),$(u).dialog("close"))}}]};i.publish("showDialogWidget",u)},onAddAuthorizationItem:function(n,t,i){i.preventDefault();var u=this,f=u.getTemplate("adhoc.processes.authorization.editor.usergroup.popup"),r={};r.isAdhocTask=t;r.formContent=$.tmpl(f);r.inputUserName=$("#input-displayname-user",r.formContent);r.userGroupName=$("#userGroupName",r.formContent);r.userGroupLink=$("#groupEditorLink",r.formContent);r.authItemId=$("#authItemId",r.formContent);r.buttonSave=$("#button-accept-adhoc-user-group-form",r.formContent);r.buttonCancel=$("#button-cancel-adhoc-user-group-form",r.formContent);r.buttonSave.on("click",$.proxy(u.onSaveAuthorizationItem,u,r,n));r.buttonCancel.on("click",$.proxy(u.closeDialogBox,u,r.formContent));r.userGroupLink.on("click",$.proxy(u.showUserGroupEditorPopup,u,r,n));r.authItemId.val("");this.subscribe("setSelectedAuthItem",function(n,t){r.authItemId.val(t.itemId);r.authItemId.data("itemtype",t.type);t.type==="group"?(r.userGroupName.text(t.itemName),r.userGroupLink.text("Change Group"),r.userGroupName.show(),r.inputUserName.val(""),u.publish("closeCurrentDialog")):(r.userGroupName.text(""),r.userGroupLink.text("Select Group"),r.userGroupName.hide())});r.formContent.dialog({resizable:!1,draggable:!1,width:"400px",modal:!0,title:bizagi.localization.getResource("workportal-adhoc-auth-search-popup-title"),maximize:!1,close:$.proxy(u.closeDialogBox,u,r.formContent)});u.initializeUserAutoComplete(r.inputUserName)},onSaveAuthorizationItem:function(n,t,i){i.preventDefault();var r=this,u={level:n.authItemId.data("itemtype"),instance:n.authItemId.val()};t.allowTo.push(u);$.when(r.dataService.saveAdhocAuthorizationInfo({processId:r.currentProcessId,auth:t,isAdhocTask:n.isAdhocTask})).done(function(){r.closeDialogBox(n.formContent);r.publish("refreshAuthItems",{auth:t});r.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-process-assignment-form-save"),""))}).fail(function(n){bizagi.log(n)})},onRemoveAuthorizationItem:function(n,t,i){i.preventDefault();var r=this,u=$(i.currentTarget).data("id"),f=n.allowTo,e=f.filter(function(n){return n.instance!==u.toString()});n.allowTo=e;$.when(r.dataService.saveAdhocAuthorizationInfo({processId:r.currentProcessId,auth:n,isAdhocTask:t})).done(function(){r.publish("refreshAuthItems",{auth:n})}).fail(function(n){bizagi.log(n)})},initializeUserAutoComplete:function(n){var t=this,i=t.dataService.serviceLocator.getUrl("admin-getUsersList");n.autocomplete({minLength:2,source:function(n,t){$.ajax({url:i,data:{domain:"",userName:"",fullName:n.term,organization:"",pag:1,pagSize:100,orderField:"fullName"},success:function(n){t($.map(n.users,function(n){return{label:n.user,value:n.idUser}}))}})},select:function(i,r){var u=r.item.label;return n.val(u),$(n).data("userid",r.item.value),t.publish("setSelectedAuthItem",{type:"user",itemId:r.item.value}),!1},focus:function(){return!1},change:function(i,r){return r.item===null&&(n.val(""),t.publish("setSelectedAuthItem",{type:"user",itemId:""})),!1}})},closeDialogBox:function(n){var i=this,t=n;t.dialog("destroy");t.detach()}});
adhoc.processes.admin.authorization.extend("bizagi.workportal.widgets.admin.adhoc.processes",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ADHOC_PROCESSES},init:function(n,t,i){var r=this;r._super(n,t,i);r.filterData={};r.maxRows=8;r.maxPages=10;r.$canvas=i.canvas;r.users=[];r.totalPages=0;r.currentPage=1;r.orderType="ASC";r.orderField="";r.tableHeaders=[{displayName:r.getResource("workportal-widget-adhoc-process-table-name"),fieldValue:"displayName"},{displayName:r.getResource("workportal-widget-adhoc-process-table-creation-date"),fieldValue:"displayCreationDate"},{displayName:r.getResource("workportal-widget-adhoc-process-table-state"),fieldValue:"state"}];r.adhocProcessLinks=[{name:"edition",label:bizagi.localization.getResource("bz-rp-components-dimension-edit"),icon:"bz-icon-cog-outline",alwaysShow:!0},{name:"workflow",label:bizagi.localization.getResource("workportal-widget-admin-alarms-task-table-title-workflow"),icon:"bz-icon-diagram-outline",alwaysShow:!0},{name:"clone",label:bizagi.localization.getResource("workportal-adhoc-process-clone-button"),icon:"bz-icon-window-create-outline",alwaysShow:!1},{name:"delete",label:bizagi.localization.getResource("bz-rp-components-dimension-delete"),icon:"bz-icon-trash",alwaysShow:!1},{name:"auth",label:bizagi.localization.getResource("workportal-adhoc-process-authorization-button"),icon:"bz-icon-authentication-outline",alwaysShow:!1}];r.stateList=[{id:"",displayName:"----------------"},{id:"Draft",displayName:"Draft"},{id:"Pilot",displayName:"Pilot"},{id:"Published",displayName:"Published"}];r.allowCreation=!0;r.adhocProcesses=[];r.loadTemplates({"admin.adhoc.processes":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#ui-bizagi-workportal-widget-admin-adhoc-processes"),"admin.adhoc.processes.formbuttons":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#ui-bizagi-workportal-widget-admin-adhoc-processes-formbuttons"),"admin.adhoc.processes.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#ui-bizagi-workportal-widget-admin-adhoc-processes-wrapper"),"admin.adhoc.processes.query.form":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#ui-bizagi-workportal-widget-admin-adhoc-processes-query-form"),"admin.adhoc.processes.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#ui-bizagi-workportal-widget-admin-adhoc-processes-table"),"admin.adhoc.processes.message":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#ui-bizagi-workportal-widget-admin-adhoc-processes-message"),"admin.adhoc.processes.create.popup":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#adhoc-process-popup-template"),"admin.adhoc.processes.edit.popup":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#ui-bizagi-workportal-widget-admin-adhoc-processes-edit-form"),useNewEngine:!1})},renderContent:function(){var n=this,t=n.getTemplate("admin.adhoc.processes");return n.content=$.tmpl(t),n.content},postRender:function(){var n=this;n.dateFormat=n.getResource("dateFormat")+" "+n.getResource("timeFormat");n.$adhocProcessTable=$("#bz-wp-widget-admin-adhoc-process-table",n.content);n.$processModelerCanvas=$("#bz-wp-widget-admin-adhoc-process-renderform",n.content);n.$formModelerCanvas=$("#bz-wp-widget-admin-adhoc-process-form-modeler",n.content);n.$buttonsContainer=$("#bz-wp-widget-admin-adhoc-process-buttonset",n.content);$.when(n.dataService.getAllCategories()).done(function(t){n.catList=$.parseJSON(t);n.catList.unshift({categoryName:"----------------",guidCategory:""});n.renderQueryForm()}).fail(function(n){bizagi.log(n)});n.addEventsHandler()},renderQueryForm:function(){var n=this,t=$.tmpl(n.getTemplate("admin.adhoc.processes.query.form"),{catList:n.catList.length}),i=$.tmpl(n.getTemplate("admin.adhoc.processes.wrapper"),{});$("#biz-wp-admin-adhoc-processes-wrapperform",i).html(t);$("#bz-wp-widget-admin-adhoc-process-table",n.content).html(i);n.setupPredefinedCombo(t.find("#biz-wp-admin-adhoc-processes-state"),n.stateList,n.stateList[0]);n.setupCatCombo(t.find("#biz-wp-admin-adhoc-processes-cat"),n.catList,n.catList[0]);n.setupFormEventsHandler();n.renderButtons("query")},addEventsHandler:function(){var n=this,t;n.$adhocProcessTable.on("click","#bz-wp-widget-admin-adhocprocess-createbutton-wrapper",function(){n.adhocProcessData={};n.showPopupCreateProcess()});t=$("#bz-wp-widget-admin-adhoc-process-buttonset",n.content);t.on("click","button",function(){n.workflowView.formModeler&&n.workflowView.formModeler.editor&&n.workflowView.formModeler.editor.controller.thereAreChangesInForm()?$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("confirmation-savebox-message2"),"","info")).done(function(){n.returnToContainer($("button",t).data("backto"))}):n.returnToContainer($(this).data("backto"))})},setupFormEventsHandler:function(){var n=this,t=$("#biz-wp-admin-adhoc-processes-wrapperform form",n.content);t.on("submit",function(t){t.preventDefault();n.currentPage=1;n.orderType="DES";n.orderField="displayCreationDate";n.filterData={filter:{},pag:n.currentPage,pagSize:n.maxRows,orderField:n.orderField,orderType:n.orderType};this.elements[0].value.length>0&&(n.filterData.filter.displayName=this.elements[0].value);$(this.elements[1]).data("value")!=""&&(n.filterData.filter.state=$(this.elements[1]).data("value"));$(this.elements[2]).data("value")!=""&&(n.filterData.filter.category=$(this.elements[2]).data("value"));n.getAdhocProcessTableData()});t.on("reset",function(t){t.preventDefault();this.elements[0].value="";$(this.elements[1]).data("value","").val("----------------");$(this.elements[2]).data("value","").val("----------------");$("#biz-wp-admin-adhoc-processes-wrapperlist",n.content).empty()})},getAdhocProcessTableData:function(n){var t=this,i=n||{};t.orderType=i.orderType||t.orderType;t.orderField=i.orderField||t.orderField;$.when(t.dataService.getAdhocProcessesList($.extend(t.filterData,i))).done(function(n){t.adhocProcesses=n.adhocProcesses;t.totalPages=n.total;t.showAdhocProcessesTable();t.setAdhocProcessActions()}).fail(function(n){bizagi.log(n)})},showAdhocProcessesTable:function(){var n=this,t=$("#biz-wp-admin-adhoc-processes-wrapperlist",n.content),i;if(t.empty(),n.adhocProcesses.length>0){var r=n.totalPages>1,u=n.getPagesArray(),f=n.adhocProcessLinks&&Object.prototype.toString.apply(n.adhocProcessLinks)==="[object Array]"?n.adhocProcessLinks:[n.adhocProcessLinks],e=$.tmpl(n.getTemplate("admin.adhoc.processes.table"),{adhocProcesses:n.adhocProcesses,headers:n.tableHeaders,links:f,page:n.currentPage,pagination:r,pagesArray:u,orderField:n.orderField,orderType:n.orderType});t.html(e);n.setUpPagination();n.setUpSortColumnLinks()}else i=bizagi.localization.getResource("workportal-widget-usertable-empty"),t.html($.tmpl(n.usersTableMessage,{message:i}))},getPagesArray:function(){for(var n=this,r=n.maxPages>n.totalPages?n.totalPages:n.maxPages,i=[],t=0;t<r;t++)i.push(t+1);return i},setUpPagination:function(){var n=this,t=$("#biz-wp-admin-adhoc-processes-pager ul",n.content);t.bizagiPagination({maxElemShow:n.maxRows,totalPages:n.totalPages,actualPage:n.currentPage,listElement:t,clickCallBack:function(t){n.filterData.pag=n.currentPage=parseInt(t.page);n.getAdhocProcessTableData()}})},setUpSortColumnLinks:function(){var n=this;$(".biz-wp-table-head th",n.content).click(function(){var t=$(this).data("orderfield"),i=$(this).data("ordertype");n.getAdhocProcessTableData({orderType:i,orderField:t});n.setAdhocProcessActions()})},setAdhocProcessActions:function(){var n=this;$(".bizagi-wp-admin-adhoc-processes-link",n.content).click(function(){var t=this.id;n.currentProcess&&n.currentProcess.id==t||(n.currentProcess=n.adhocProcesses.filter(function(n){return n.id===t})[0]);switch($(this).data("linkname")){case"edition":n.showPopupEditAdhocProcess();break;case"delete":n.deleteAdhocProcess();break;case"workflow":n.renderAdhocProcessEditor();break;case"clone":n.cloneAdhocProcess();break;case"auth":n.showPopupAuthAdhocProcess()}})},returnToContainer:function(n){var t=this;t.toggleForm(n)},removeButtons:function(){var n=this;n.$buttonsContainer.empty()},renderButtons:function(n,t){var i=this,u=i.getTemplate("admin.adhoc.processes.formbuttons"),r=$.tmpl(u,{type:n,allowCreation:i.allowCreation,backTo:t});n==="query"?$("#bz-wp-widget-admin-adhoc-process-table #admin-adhoc-processes-table-buttonset",i.content).append(r):i.$buttonsContainer.html(r)},toggleForm:function(n){var t=this;t.removeButtons();switch(n){case"table":t.getAdhocProcessTableData();t.$adhocProcessTable.show();t.$processModelerCanvas.hide();t.$processModelerCanvas.empty();t.$formModelerCanvas.hide();t.currentProcess=null;break;case"form":t.$adhocProcessTable.hide();t.$formModelerCanvas.hide();t.$processModelerCanvas.show();t.renderButtons("back","table");break;case"modeler":t.$adhocProcessTable.hide();t.$processModelerCanvas.hide();t.$formModelerCanvas.show();t.renderButtons("back","form")}},renderAdhocProcessEditor:function(){var n=this;n.$processModelerCanvas.empty();n.workflowView=new adhoc.processes.workflow(n.workportalFacade,n.dataService,{adhocProcessInfo:n.currentProcess,formModelerCanvas:n.$formModelerCanvas});n.workflowView.render(n.$processModelerCanvas);n.subscribe("refreshAdhocProcessesCanvas",function(t,i){n.toggleForm(i.canvasName)});n.toggleForm("form")},deleteAdhocProcess:function(){var n=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-adhoc-process-delete-confirmation"),"","info")).done(function(){$.when(n.dataService.deleteAdhocProcess(n.currentProcess.id)).done(function(){n.currentProcess=null;n.getAdhocProcessTableData()})})},cloneAdhocProcess:function(){var n=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-adhoc-process-clone-confirmation"),"","info")).done(function(){$.when(n.dataService.cloneAdhocProcess(n.currentProcess)).done(function(){n.getAdhocProcessTableData()})})},setupPredefinedCombo:function(n,t,i){n.uicombo({data:{combo:t},initValue:i,itemValue:function(n){return n.id},itemText:function(n){return n.displayName},onChange:function(t){var i=t.ui.data("value");n.val(i)}})},setupCatCombo:function(n,t,i){n.uicombo({data:{combo:t},initValue:i,itemValue:function(n){return n.guidCategory},itemText:function(n){return n.categoryName},onChange:function(t){var i=t.ui.data("value");n.val(i)}})},showPopupCreateProcess:function(){var t=this,i=t.getTemplate("admin.adhoc.processes.create.popup"),n={};n.formContent=$.tmpl(i);n.elements={inputName:$("#input-name-adhoc-process",n.formContent),buttonSave:$("#button-accept-create-adhoc-process",n.formContent),buttonCancel:$("#button-cancel-create-adhoc-process",n.formContent)};n.elements.buttonSave.on("click",$.proxy(t.onCreateProcess,t,n));n.elements.buttonCancel.on("click",$.proxy(t.closeDialogBox,t,n.formContent));n.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-adhoc-process-create-popup-title"),maximize:!1,close:function(){n.formContent.dialog("destroy");n.formContent.detach()}})},showPopupEditAdhocProcess:function(){var t=this,r=t.getTemplate("admin.adhoc.processes.edit.popup"),n={},i;n.formContent=$.tmpl(r);n.elements={inputName:$("#input-name-adhoc-process",n.formContent),inputDesc:$("#input-desc-adhoc-process",n.formContent),inputCat:$("#input-cat-adhoc-process",n.formContent),inputState:$("#input-state-adhoc-process",n.formContent),inputAlarms:$("#input-alarms-adhoc-process",n.formContent),inputCaseNumber:$("#input-case-number-adhoc-process",n.formContent),inputCaseNumberPreffix:$("#input-case-number-preffix",n.formContent),inputCaseNumberSuffix:$("#input-case-number-suffix",n.formContent),validator:$("#input-case-number-validator",n.formContent),buttonSave:$("#button-accept-edit-adhoc-process",n.formContent),buttonCancel:$("#button-cancel-edit-adhoc-process",n.formContent)};n.elements.buttonSave.on("click",$.proxy(t.onEditAdhocProcess,t,n));n.elements.buttonCancel.on("click",$.proxy(t.closeDialogBox,t,n.formContent));n.elements.inputCaseNumber.change(function(){$(".case-number-container",n.formContent).toggle(this.checked)}).change();n.elements.inputCat.html("");i=t.catList[0];t.currentProcess.category&&t.currentProcess.category!=null&&(i=t.catList.filter(function(n){return n.guidCategory===t.currentProcess.category})[0]);t.setupCatCombo(n.elements.inputCat,t.catList,i);n.elements.inputName.val(t.currentProcess.displayName);n.elements.inputDesc.val(t.currentProcess.description);n.elements.inputCat.val(t.currentProcess.category);n.elements.inputState.html(t.currentProcess.state);t.currentProcess.enableAlarms&&n.elements.inputAlarms.attr("checked",!0);t.currentProcess.enableCustomizedCaseNumber?(n.elements.inputCaseNumber.attr("checked",!0),n.elements.inputCaseNumberPreffix.val(t.currentProcess.caseNumberSequence.prefix),n.elements.inputCaseNumberSuffix.val(t.currentProcess.caseNumberSequence.suffix),$(".case-number-container",n.formContent).show()):$(".case-number-container",n.formContent).hide();n.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-adhoc-process-popup-title"),maximize:!1,close:function(){n.formContent.dialog("destroy");n.formContent.detach()}})},showPopupAuthAdhocProcess:function(){var n=this,i=n.getTemplate("adhoc.processes.authorization.editor.popup"),t=$.tmpl(i,{});n.currentProcess.authorization!=null&&n.currentProcess.authorization[0].allowTo||(n.currentProcess.authorization=[{id:Math.guid(),allowTo:[]}]);n.renderAuthorizationItems($("#authorizationItems",t),n.currentProcess.id,n.currentProcess.authorization[0],!1);this.unsubscribe("refreshAuthItems");this.subscribe("refreshAuthItems",function(i,r){$("#authorizationItems",t).empty();n.currentProcess.authorization[0]=r.auth;n.renderAuthorizationItems($("#authorizationItems",t),n.currentProcess.id,r.auth,!1)});t.dialog({resizable:!1,draggable:!1,height:"auto",width:"615px",modal:!0,title:bizagi.localization.getResource("workportal-adhoc-process-auth-popup-title"),maximize:!1,close:$.proxy(n.closeDialogBox,n,t)})},onCreateProcess:function(n,t){var i,r;t.preventDefault();i=this;i.validateParams(n)&&(r={id:Math.guid(),displayName:n.elements.inputName.val(),state:"Draft",activities:[]},$.when(i.dataService.createAdhocProcess(r)).done(function(t){i.currentProcess=t;i.adhocProcesses.push(t);i.closeDialogBox(n.formContent);i.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-process-created"),""));i.renderAdhocProcessEditor(r.id)}).fail(function(n){bizagi.log(n)}))},onEditAdhocProcess:function(n,t){t.preventDefault();var i=this;i.validateParams(n)&&(i.currentProcess.displayName=n.elements.inputName.val(),i.currentProcess.description=n.elements.inputDesc.val(),i.currentProcess.category=n.elements.inputCat.val(),i.currentProcess.enableAlarms=n.elements.inputAlarms.is(":checked"),n.elements.inputCaseNumber.is(":checked")?(i.currentProcess.enableCustomizedCaseNumber=!0,i.currentProcess.caseNumberSequence!=null?(i.currentProcess.caseNumberSequence.prefix=n.elements.inputCaseNumberPreffix.val(),i.currentProcess.caseNumberSequence.suffix=n.elements.inputCaseNumberSuffix.val()):(i.currentProcess.caseNumberId=Math.guid(),i.currentProcess.caseNumberSequence={id:i.currentProcess.caseNumberId,prefix:n.elements.inputCaseNumberPreffix.val(),suffix:n.elements.inputCaseNumberSuffix.val()})):i.currentProcess.enableCustomizedCaseNumber=!1,$.when(i.dataService.updateAdhocProcess(i.currentProcess)).done(function(){i.closeDialogBox(n.formContent);i.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-process-saved"),""));i.getAdhocProcessTableData()}).fail(function(n){bizagi.log(n)}))},validateParams:function(n){var f=this,t=!0,r=n.elements.inputName,i,u;return r.val()&&r.val()!==""?t=!0:(i=bizagi.localization.getResource("workportal-general-error-field-required"),i=i.replace("{0}","Name"),r.next().find("span").html(i),t=!1),n.elements.inputCaseNumber&&n.elements.inputCaseNumber.is(":checked")&&(n.elements.inputCaseNumberPreffix.val()!==""||n.elements.inputCaseNumberSuffix.val()!==""?t=!0:(u=bizagi.localization.getResource("workportal-general-error-field-required"),u=i.replace("{0}","Preffix/Suffix"),n.elements.validator.find("span").html(u),t=!1)),t},dispose:function(){var n=this;bizagi.rendering&&($(window).unbind("resize.windowPanel"),$(window).unbind("resize.rendering"),n.restoreMethod("container","postRenderContainer"),n.restoreMethod("group","postRenderContainer"),n.restoreMethod("contentPanel","postRenderContainer"),n.restoreMethod("tab","postRenderContainer"),n.restoreMethod("form","postRenderContainer"),n.restoreMethod("render","postRenderElement"),n.restoreMethod("search","postRender"),n.restoreMethod("imageNoFlash","postRender"),n.restoreMethod("collectionnavigator","postRender"));n.workflowView&&n.workflowView.dispose();n._super()},restoreMethod:function(n,t,i){var r=this;bizagi.rendering.form.editorInstance&&(bizagi.rendering[n].prototype[t]=function(){return i?bizagi.rendering[n].editorInstance[t].apply(this,arguments):bizagi.rendering[n].original[t].apply(this,arguments)})}});
adhoc.processes.admin.authorization.extend("adhoc.processes.workflow",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"adhoc.processes.workflow":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#adhoc-process-tasks"),useNewEngine:!1})},render:function(n){var t=this,i,r;n?t.container=n:t.container.empty();i=t.getTemplate("adhoc.processes.workflow");r=t.content=$.tmpl(i,t.params.adhocProcessInfo);r.appendTo(t.container);t.postRender()},postRender:function(){var n=this;if(n.params.adhocProcessInfo.state==="Draft")$("#to-pilot-process",n.content).on("click",$.proxy(n.onClickPilotAdhocProcess,n));else if(n.params.adhocProcessInfo.state==="Pilot")$("#to-publish-process",n.content).on("click",$.proxy(n.onClickPublishAdhocProcess,n));$("#summary-form",n.content).on("click",$.proxy(n.onClickShowSummaryForm,n));n.renderAdhocProcessModeler()},renderAdhocProcessModeler:function(){var n=this,i=$(".adhoc-process-task-list",n.content),t;i.empty();t=new bizagi.bpmn.modeler.viewer;t.render(i);t.subscribe("bpm.modeler.externalOption",function(t,i){i.option=="form"?n.renderFormModeler(i.task):i.option=="assignee"?n.showPopupAssignments(i.task):i.option=="rule"&&n.showPopupEditBooleanExpression(i.source,i.target)});t.subscribe("bpm.modeler.changed",function(){n.saveDiagram("",!0)});n.params.adhocProcessInfo.diagramId&&n.params.adhocProcessInfo.diagramId!=null&&$.when(n.dataService.getAdhocProcessDiagram(n.params.adhocProcessInfo.id,n.params.adhocProcessInfo.diagramId)).done(function(n){t.load(n)}).fail(function(n){bizagi.log(n)});n.processModeler=t},renderFormModeler:function(n,t){var i=this;i.params.formModelerCanvas.empty();i.formModeler=new adhoc.processes.formmodeler({idProcess:i.params.adhocProcessInfo.id,idTask:n,isAdhocSummaryForm:t});i.formModeler.render(i.params.formModelerCanvas)},showPopupAssignments:function(n){var t=this,i=t.getTemplate("adhoc.processes.authorization.editor.popup");$.when(t.dataService.getAdhocTask(t.params.adhocProcessInfo.id,n)).done(function(r){var u=$.tmpl(i,{isAdhocTask:!0}),f;r.assignee!=null&&r.assignee.length!=0&&r.assignee[0].allowTo?r.assignee[0].parentId=n:r.assignee=[{id:Math.guid(),allowTo:[],parentId:n}];f=$("input[type=radio][name=assignmentType]",u);$("input[type=radio][name=assignmentType][value="+r.assignmentType+"]",u).attr("checked","checked");f.on("change",function(){t.onSaveAssignmentType($(this).val(),r)});t.renderAuthorizationItems($("#authorizationItems",u),t.params.adhocProcessInfo.id,r.assignee[0],!0);t.unsubscribe("refreshAuthItems");t.subscribe("refreshAuthItems",function(n,i){$("#authorizationItems",u).empty();t.renderAuthorizationItems($("#authorizationItems",u),t.params.adhocProcessInfo.id,i.auth,!0)});u.dialog({resizable:!1,draggable:!1,height:"auto",width:"615px",modal:!0,title:bizagi.localization.getResource("workportal-adhoc-process-assignment-popup-title"),maximize:!1,close:$.proxy(t.closeDialogBox,t,u)})}).fail(function(n){bizagi.log(n)})},showPopupEditBooleanExpression:function(n,t){var i=this;$.when(i.dataService.getAdhocTask(i.params.adhocProcessInfo.id,n)).done(function(r){var u=r.successors.filter(function(n){return n.taskGuid===t})[0],f={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ADHOC_BOOLEAN_EXP,data:{booleanExp:u.expression,adhocProcessId:i.params.adhocProcessInfo.id},closeVisible:!1,modalParameters:{resizable:!1,title:i.getResource("workportal-adhoc-process-boolean-exp-popup-title"),id:"AdhocBooleanExpAdmin",width:"790px",height:"auto"},buttons:[{text:i.getResource("text-save"),click:function(){var o=this,e=$(this).dialog("option","widget"),f=e.booleanExp||{};u.expression=f.conditions!=null&&f.conditions.count()>0?f:null;$.when(i.dataService.updateAdhocTask({idProcess:i.params.adhocProcessInfo.id,task:r})).done(function(){e.dispose();$(o).dialog("close");i.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-process-boolean-exp-saved"),""));i.processModeler.setConnectionExpression(n,t)}).fail(function(n){bizagi.log(n)})}},{text:i.getResource("text-cancel"),click:function(){var n=this,t=$(this).dialog("option","widget");t.dispose();$(n).dialog("close")}}]};i.publish("showDialogWidget",f)}).fail(function(n){bizagi.log(n)})},onSaveAssignmentType:function(n,t){var i=this;t.assignmentType=n;$.when(i.dataService.updateAdhocTask({idProcess:i.params.adhocProcessInfo.id,task:t})).fail(function(n){bizagi.log(n)})},onClickShowSummaryForm:function(n){n.preventDefault();var t=this;t.renderFormModeler(null,!0)},transform:function(n){var i=[],t,r;for(obj in n.tasks)t=n.tasks[obj],r={id:t.id,type:t.type,displayName:t.displayName,duration:t.duration,position:t.position,predecessors:t.predecessors,successors:t.successors,rules:t.rules},i.push(r);return i},saveDiagram:function(n,t){var i=this,r=new $.Deferred;if(!i.saving){i.saving=!0;i.params.adhocProcessInfo.diagramId&&i.params.adhocProcessInfo.diagramId!=null||(i.params.adhocProcessInfo.diagramId=Math.guid());var u=i.processModeler.save(),f=i.transform(u),e={id:i.params.adhocProcessInfo.diagramId,elements:f,canvas:u.canvas};$.when(i.dataService.saveAdhocProcessDiagram(i.params.adhocProcessInfo.id,e)).done(function(){i.saving=!1;t||i.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-process-diagram-saved"),""));r.resolve()}).fail(function(n){i.saving=!1;bizagi.log(n)})}return r.promise()},onClickPilotAdhocProcess:function(n){n.preventDefault();var t=this;t.params.adhocProcessInfo.authorization!==null&&t.params.adhocProcessInfo.authorization[0].allowTo?(t.params.adhocProcessInfo.state="PILOT",$.when(t.dataService.publishAdhocProcess(t.params.adhocProcessInfo)).done(function(){t.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-process-pilot"),""));t.render()}).fail(function(n){bizagi.log(n)})):$.when(bizagi.showConfirmationBox("do you want to set process authorization first?","","",[{label:"Test",action:"resolve"},{label:"Later"}])).done(function(){t.showPopupAuthAdhocProcess()}).fail(function(){t.params.adhocProcessInfo.state="PILOT";$.when(t.dataService.publishAdhocProcess(t.params.adhocProcessInfo)).done(function(){t.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-process-pilot"),""));t.render()}).fail(function(n){bizagi.log(n)})})},onClickPublishAdhocProcess:function(n){n.preventDefault();var t=this;t.params.adhocProcessInfo.state="PUBLISHED";$.when(t.dataService.publishAdhocProcess(t.params.adhocProcessInfo)).done(function(){t.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-process-published"),""));t.render()}).fail(function(n){bizagi.log(n)})},showPopupAuthAdhocProcess:function(){var n=this,i=n.getTemplate("adhoc.processes.authorization.editor.popup"),t=$.tmpl(i,{});n.params.adhocProcessInfo.authorization!=null&&n.params.adhocProcessInfo.authorization[0].allowTo||(n.params.adhocProcessInfo.authorization=[{id:Math.guid(),allowTo:[]}]);n.renderAuthorizationItems($("#authorizationItems",t),n.params.adhocProcessInfo.id,n.params.adhocProcessInfo.authorization[0],!1);this.unsubscribe("refreshAuthItems");this.subscribe("refreshAuthItems",function(i,r){$("#authorizationItems",t).empty();n.params.adhocProcessInfo.authorization[0]=r.auth;n.renderAuthorizationItems($("#authorizationItems",t),n.params.adhocProcessInfo.id,r.auth,!1)});t.dialog({resizable:!1,draggable:!1,height:"auto",width:"615px",modal:!0,title:bizagi.localization.getResource("workportal-adhoc-process-auth-popup-title"),maximize:!1,close:$.proxy(n.closeDialogBox,n,t)})},dispose:function(){var n=this;n.formModeler&&n.formModeler.dispose();n._super()}});
bizagi.workportal.widgets.widget.extend("adhoc.processes.formmodeler",{},{init:function(n){var t=this;t.params=n},render:function(n){var t=this;t.loadModeler(n);t.publish("refreshAdhocProcessesCanvas",{canvasName:"modeler"})},loadModeler:function(n){var t=this;window.jQuery&&window.jQuery.ui.dialog&&$(document).unbind("focusin.dialog");bizagi.loader.start("formModeler").loadFile({src:bizagi.getStyleSheet("bizagi.editor.portal.overrides"),type:"css"}).then(function(){t.makeBackupForHacks();$.when(bizagi.localization.loadLanguageExtension(bizagi.language)).done(function(){var i,r;bizagi.form.modeler.initialize({urlRestServices:location.protocol+"//"+location.host+location.pathname,environment:bizagiConfig.environment});BIZAGI_ACTION_VALIDATIONS_IMPR=!1;i="adhocform";bizagi.editor.communicationprotocol.factory.setContext(i);r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadform",form:t.params.idTask,loadByParent:!0,adhocProcessId:t.params.idProcess,isAdhocSummaryForm:t.params.isAdhocSummaryForm});$.when(r.processRequest()).done(function(r){$.when(bizagi.form.modeler.createForm({context:i,isActivityForm:!1,canvas:n,adhocTaskId:t.params.idTask,data:r,adhocProcessId:t.params.idProcess,isAdhocSummaryForm:t.params.isAdhocSummaryForm})).done(function(n){t.editor=n})})})})},makeBackupForHacks:function(){var n=this;bizagi.rendering.container.editorInstance?(n.restoreMethod("container","postRenderContainer",!0),n.restoreMethod("group","postRenderContainer",!0),n.restoreMethod("contentPanel","postRenderContainer",!0),n.restoreMethod("tab","postRenderContainer",!0),n.restoreMethod("form","postRenderContainer",!0),n.restoreMethod("render","postRenderElement",!0),n.restoreMethod("search","postRender",!0),n.restoreMethod("imageNoFlash","postRender",!0),n.restoreMethod("collectionnavigator","postRender",!0)):(bizagi.rendering.container.editorInstance=$.extend(!0,{},bizagi.rendering.container.prototype),bizagi.rendering.group.editorInstance=$.extend(!0,{},bizagi.rendering.group.prototype),bizagi.rendering.contentPanel.editorInstance=$.extend(!0,{},bizagi.rendering.contentPanel.prototype),bizagi.rendering.tab.editorInstance=$.extend(!0,{},bizagi.rendering.tab.prototype),bizagi.rendering.form.editorInstance=$.extend(!0,{},bizagi.rendering.form.prototype),bizagi.rendering.render.editorInstance=$.extend(!0,{},bizagi.rendering.render.prototype),bizagi.rendering.search.editorInstance=$.extend(!0,{},bizagi.rendering.search.prototype),bizagi.rendering.imageNoFlash.editorInstance=$.extend(!0,{},bizagi.rendering.imageNoFlash.prototype),bizagi.rendering.collectionnavigator.editorInstance=$.extend(!0,{},bizagi.rendering.collectionnavigator.prototype))},restoreMethod:function(n,t,i){var r=this;bizagi.rendering.form.editorInstance&&(bizagi.rendering[n].prototype[t]=function(){return i?bizagi.rendering[n].editorInstance[t].apply(this,arguments):bizagi.rendering[n].original[t].apply(this,arguments)})},dispose:function(){var n=this;delete n.editor}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.adhoc.booleanexp",{},{init:function(n,t,i){var r=this;r.booleanExp=i.data&&i.data.booleanExp?i.data.booleanExp:{evaluationType:"ALL",conditions:[]};r.booleanExp.conditions||(r.booleanExp.conditions=[]);r.adhocProcessId=i.data&&i.data.adhocProcessId?i.data.adhocProcessId:null;r.operList=[{label:"is equal to",value:"=="},{label:"is different to",value:"!="},{label:"is greater than or equal to",value:">="},{label:"is greater than",value:">"},{label:"is less than or equal to",value:"<="},{label:"is less than",value:"<"}];r.propertyTypeList=[{label:"TEXT",value:"adhoctext"},{label:"NUMBER",value:"adhocnumber"},{label:"BOOLEAN",value:"adhocboolean"},{label:"DATE",value:"adhocdate"},{label:"MONEY",value:"adhocmoney"}];r.notifier=bizagi.injector.get("notifier");r._super(n,t,i);r.loadTemplates({"adhoc.processes.boolean.exp.editor.popup":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.adhoc.processes").concat("#adhoc-process-boolean-expression-template"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ADHOC_BOOLEAN_EXP},renderContent:function(){var n=this,t=n.getTemplate("adhoc.processes.boolean.exp.editor.popup");return n.content=$.tmpl(t)},postRender:function(){var n=this,t=n.getContent(),r=$("#conditionType",t),i;n.conditionGrid=$("#conditionContainer",t);r.on("change",function(){var i=$(this).val();i=="ALL"?$(".condition-type-text",t).text(bizagi.localization.getResource("workportal-adhoc-processes-boolean-exps-option-all-label")):$(".condition-type-text",t).text(bizagi.localization.getResource("workportal-adhoc-processes-boolean-exps-option-any-label"));n.booleanExp.evaluationType=i});i=n.booleanExp.evaluationType;$("option[value="+i+"]",r).attr("selected","selected");$(".condition-type-text",t).text(bizagi.localization.getResource("workportal-adhoc-processes-boolean-exps-option-"+i.toLowerCase()+"-label"));$.when(n.getAdhocDataSchema()).done(function(t){n.buildSuggestField(n.conditionGrid,t);n.conditionGrid.jsGrid({width:"100%",height:"300px",inserting:!0,editing:!0,sorting:!1,paging:!1,deleteConfirm:bizagi.localization.getResource("workportal-adhoc-processes-boolean-exps-delete-confirmation"),autoload:!0,controller:{loadData:function(){return n.booleanExp.conditions}},fields:[{name:"property",title:bizagi.localization.getResource("workportal-adhoc-processes-boolean-exps-col-prop"),type:"suggest",width:150,validate:"required",editing:!1},{name:"propertyType",title:bizagi.localization.getResource("workportal-adhoc-processes-boolean-exps-col-type"),type:"select",validate:"required",editing:!1,items:n.propertyTypeList,valueField:"value",textField:"label"},{name:"oper",title:bizagi.localization.getResource("workportal-adhoc-processes-boolean-exps-col-oper"),type:"select",items:n.operList,valueField:"value",textField:"label",validate:"required"},{name:"value",title:bizagi.localization.getResource("workportal-adhoc-processes-boolean-exps-col-value"),type:"text",width:150,validate:"required"},{type:"control"}]})})},buildSuggestField:function(n,t){var r=this,i;jsGrid.fields.suggest||(i=function(n){jsGrid.Field.call(this,n)},i.prototype=new jsGrid.Field({insertTemplate:function(){var n=$("<input>");return r.initializeAdhocXpathAutoComplete(n,t),this._insertAutoComplete=n},editTemplate:function(i){var e=n.jsGrid("fieldOption","property","editing"),u,f;return e?(u=$("<input>"),i&&(f=t.filter(function(n){return n.value.key===i.key})[0],u.val(f?f.label:"")),r.initializeAdhocXpathAutoComplete(u,t),this._editAutoComplete=u):i},insertValue:function(){return this._insertAutoComplete.val()},editValue:function(){return this._editAutoComplete.val()}}),jsGrid.fields.suggest=i)},initializeAdhocXpathAutoComplete:function(n,t){var i=this;n.autocomplete({minLength:2,source:t,select:function(t,i){var r=i.item.label;return n.val(i.item.value),$(this).parent(".jsgrid-cell").next().find("select").val(i.item.type),$(this).parent(".jsgrid-cell").next().find("select").attr("disabled","disabled"),!1},focus:function(){return!1},change:function(t,i){return i.item===null&&(n.val(t.currentTarget.value),$(this).parent(".jsgrid-cell").next().find("select").removeAttr("disabled"),$(this).parent(".jsgrid-cell").next().find("select").val("adhoctext")),!1}})},getAdhocDataSchema:function(){var n=this,t=new $.Deferred;return $.when(n.dataService.getAdhocDataSchema(n.adhocProcessId)).done(function(n){var i=$.parseJSON(n),r=[];i.properties&&$.each(i.properties,function(n,t){r.push({label:t.name,value:t.name,type:t.type})});t.resolve(r)}),t.promise()},dispose:function(){var n=this;n.conditionGrid.jsGrid("destroy");jsGrid.fields.suggest=undefined}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.adhoc.entities",{},{init:function(n,t,i){var r=this,u;r._super(n,t,i);r.dialogBox={};r.entities=[];r.entityMap={};r.parametricEntityMap={};r.masterEntityMap={};r.entityInstancesMap={};r.attribTypes=[{name:"Common Type",options:[{value:{id:15,type:15},label:"VarChar"},{value:{id:6,type:6},label:"Decimal"},{value:{id:7,type:7},label:"Numeric"},{value:{id:8,type:8},label:"Money"},{value:{id:5,type:5},label:"Boolean"},{value:{id:12,type:12},label:"DateTime"}]}];u="bizagi.workportal.desktop.widgets.admin.adhoc.entities";r.initializeJSGrid();r.notifier=bizagi.injector.get("notifier");r.loadTemplates({"admin.adhoc.entity.wrapper":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-entity-wrapper"),"admin.adhoc.entity.panel.wrapper":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-entity-panel-wrapper"),"admin.adhoc.entity.list":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-entity-list"),"admin.adhoc.entity.error":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-entity-error"),"admin.adhoc.entity.nodata":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-entity-nodata"),"admin.adhoc.entity.form":bizagi.getTemplate(u).concat("#adhoc-entity-form-popup"),"admin.adhoc.entity.form.attribtype":bizagi.getTemplate(u).concat("#adhoc-entity-form-attribtype"),"admin.adhoc.entity.form.displayattrib":bizagi.getTemplate(u).concat("#adhoc-entity-form-displayattrib"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ADHOC_ENTITIES},renderContent:function(){var n=this,t=n.getTemplate("admin.adhoc.entity.wrapper");return n.content=$.tmpl(t)},postRender:function(){var n=this,t;n.panelWrapper=$.tmpl(n.getTemplate("admin.adhoc.entity.panel.wrapper"));n.entitiesList=n.getTemplate("admin.adhoc.entity.list");n.entitiesError=n.getTemplate("admin.adhoc.entity.error");n.entitiesNoData=n.getTemplate("admin.adhoc.entity.nodata");t=n.getContent();t.empty();$.when(n.dataService.getAdhocEntitiesList()).done(function(i){if(i.length>0)n.createEntityMap(i),n.renderEntitiesListPanel();else{var u=n.getResource("workportal-general-first-line-no-records-found"),r=$.tmpl(n.entitiesNoData,{errorMessage:u});$("#entityNoData",r).click(function(){n.showAdhocEntityForm()});t.html(r)}}).fail(function(){n.entityMap=undefined;var i=n.getResource("workportal-widget-admin-entities-error");t.html($.tmpl(n.entitiesError,{errorMessage:i}))})},renderEntitiesListPanel:function(n){var t=this,f=t.getContent(),i=$("#admin-entity-list-wrapper",t.panelWrapper),r,u;i.empty();f.html(t.panelWrapper);r=$.map(t.parametricEntityMap,function(n){return n});u=$.map(t.masterEntityMap,function(n){return n});$.tmpl(t.entitiesList,{parametricEntityList:r,masterEntityList:u}).appendTo(i);n?$("#entitiesList option[value="+n+"]",i).attr("selected","selected"):$("#entitiesList option:first",i).attr("selected","selected");t.configureHandlers()},configureHandlers:function(){var n=this,t=$("#admin-entity-list-wrapper",n.panelWrapper),i=$("#admin-entity-instances-wrapper",n.panelWrapper);$("#searchEntity",t).keyup(function(){var i=!1,r=$(this).val().toLowerCase();$("#entitiesList option",t).remove();$.each(n.entityMap,function(){r.length>1?this.displayName.toLowerCase().indexOf(r)!=-1&&(i=!0):i=!0;i&&($("#entitiesList",t).append($("<option>",{value:this.id,text:this.displayName})),i=!1)})});$("#entitiesList",t).change(function(){n.setCurrentEntity();n.performSimpleGrid()}).trigger("change");$("#adhocEntityAdd",t).click(function(){n.showAdhocEntityForm(!0)});$("#adhocEntityEdit",i).click(function(){n.showAdhocEntityForm()})},performSimpleGrid:function(){var n=this;$("#jsGrid",n.panelWrapper).jsGrid("destroy");$.when(n.buildColumnsToGrid(n.currentEntity)).done(function(t){$("#jsGrid",n.panelWrapper).jsGrid({width:"100%",height:"460px",inserting:n.currentEntity.entityType==1?!1:!0,editing:n.currentEntity.entityType==1?!1:!0,sorting:!1,paging:!0,autoload:!0,controller:{loadData:function(){var t=$.Deferred();return $.when(n.dataService.getAdhocEntityInstances(n.currentEntity.id)).done(function(n){t.resolve(n)}).fail(function(){var t=n.getResource("workportal-widget-admin-entities-instances-error");$("#admin-entity-instances-wrapper",n.getContent()).html($.tmpl(n.entitiesError,{errorMessage:t}))}),t.promise()},insertItem:function(t){return n.saveAdhocEntityInstance($.extend(!0,{},t),!0),t},updateItem:function(t){return n.saveAdhocEntityInstance($.extend(!0,{},t),!1),t}},fields:t})});$("#pager").on("change",function(){var n=parseInt($(this).val(),10);$("#jsGrid").jsGrid("openPage",n)})},saveAdhocEntityInstance:function(n,t){var i=this,r={};t?r.id=Math.guid():(r.id=n.id,delete n.id);r.disabled=n.disabled;delete n.disabled;r.data=JSON.stringify(n);$.when(i.dataService.saveAdhocEntityInstance({entityId:i.currentEntity.id,isNew:t,instance:r})).done(function(){i.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-entity-instance-save"),""))}).fail(function(){var n=i.getResource("workportal-widget-admin-entities-instances-error");$("#admin-entity-instances-wrapper",i.getContent()).html($.tmpl(i.entitiesError,{errorMessage:n}))})},buildColumnsToGrid:function(n){var t=this,e=new $.Deferred,f=new bizagiQueue,u,r;if(n.gridColumns)return n.gridColumns;if(!n.attributes||n.attributes.length==0)return[];for(u=[],i=0;i<n.attributes.length;i++){r={guid:n.attributes[i].attribGuid,name:n.attributes[i].name,title:n.attributes[i].displayName};n.attributes[i].width&&(r.width=n.attributes[i].size);n.attributes[i].required&&(r.validate="required");switch(n.attributes[i].attribType.type){case 15:r.type="text";break;case 7:r.type="number";break;case 5:r.type="checkbox";break;case 12:r.type="datetime";break;case 8:r.type="money";break;case 6:r.type="float";break;case 25:t.entityInstancesMap[n.attributes[i].attribType.relatedEntity]?t.buildEntityField(t.entityInstancesMap[n.attributes[i].attribType.relatedEntity],n.attributes[i].attribType.relatedEntity,"bizagi"):f.add($.when(t.getEntityValues("bizagi",n.attributes[i].attribType.relatedEntity)).done(function(n){t.entityInstancesMap[n[0].value.entity]=n;t.buildEntityField(n,n[0].value.entity,"bizagi")}));r.type="bizagientity"+n.attributes[i].attribType.relatedEntity;break;case 36:t.entityInstancesMap[n.attributes[i].attribType.relatedEntity]?t.buildEntityField(t.entityInstancesMap[n.attributes[i].attribType.relatedEntity],n.attributes[i].attribType.relatedEntity,"adhoc"):f.add($.when(t.getEntityValues("adhoc",n.attributes[i].attribType.relatedEntity)).done(function(n){t.entityInstancesMap[n[0].value.entity]=n;t.buildEntityField(n,n[0].value.entity,"adhoc")}));r.type="adhocentity"+n.attributes[i].attribType.relatedEntity;break;default:text="text"}u.push(r)}return u.push({name:"disabled",title:t.getResource("workportal-adhoc-entity-instance-col-disabled"),type:"checkbox",width:50}),n.entityType==21&&u.push({type:"control",deleteButton:!1}),u.push({name:"id",visible:!1}),n.gridColumns=u,$.when(f.execute()).done(function(){e.resolve(u)}),e.promise()},setCurrentEntity:function(){var n=this,t=$("#entitiesList option:selected",n.panelWrapper);n.currentEntity=n.entityMap[t.val()]},showAdhocEntityForm:function(n){var t=this,i=t.getTemplate("admin.adhoc.entity.form");t.dialogBox.formContent=$.tmpl(i);t.dialogBox.elements={inputName:$("#input-name-adhoc-entity",t.dialogBox.formContent),inputDisplayName:$("#input-displayname-adhoc-entity",t.dialogBox.formContent),inputDesc:$("#input-desc-adhoc-entity",t.dialogBox.formContent),selectType:$("#entType",t.dialogBox.formContent),gridFields:$("#entityFieldsGrid",t.dialogBox.formContent),buttonSave:$("#button-accept-adhoc-entity-form",t.dialogBox.formContent),buttonCancel:$("#button-cancel-adhoc-entity-form",t.dialogBox.formContent)};t.dialogBox.elements.buttonSave.on("click",$.proxy(t.onSaveAdhocEntity,t));t.dialogBox.elements.buttonCancel.on("click",$.proxy(t.closeDialogBox,t));!n&&t.currentEntity?(t.dialogBox.data=t.currentEntity.attributes?$.extend(!0,[],t.currentEntity.attributes):[],t.dialogBox.adhocEntityGuid=t.currentEntity.id,t.dialogBox.elements.inputName.val(t.currentEntity.name),t.dialogBox.elements.inputDisplayName.val(t.currentEntity.displayName),t.dialogBox.elements.inputDesc.val(t.currentEntity.description),$("option[value="+t.currentEntity.entityType+"]",t.dialogBox.elements.selectType).attr("selected","selected"),t.refreshAttribListControl(t.currentEntity.displayAttrib)):(t.dialogBox.data=[],t.dialogBox.adhocEntityGuid=Math.guid(),t.dialogBox.isNew=!0,t.refreshAttribListControl());t.dialogBox.elements.gridFields.jsGrid({width:"100%",height:"200px",inserting:!0,editing:!0,sorting:!1,paging:!1,deleteConfirm:"Do you really want to delete this field?",autoload:!0,controller:{loadData:function(){return t.dialogBox.data},insertItem:function(n){return n.attribGuid||(n.attribGuid=Math.guid()),n},updateItem:function(n){return n},deleteItem:function(){}},onItemInserted:function(){t.refreshAttribListControl($("#attribsList",t.dialogBox.formContent).val())},onItemUpdated:function(){t.refreshAttribListControl($("#attribsList",t.dialogBox.formContent).val())},onItemDeleted:function(){t.refreshAttribListControl($("#attribsList",t.dialogBox.formContent).val())},fields:[{name:"attribGuid",visible:!1},{name:"name",title:t.getResource("workportal-adhoc-entity-form-attrib-name"),type:"text",width:150,validate:"required"},{name:"displayName",title:t.getResource("workportal-adhoc-entity-form-attrib-display-name"),type:"text",width:150},{name:"attribType",title:t.getResource("workportal-adhoc-entity-form-attrib-type"),type:"customselect",width:150,validate:"required"},{name:"size",title:t.getResource("workportal-adhoc-entity-form-attrib-size"),type:"number",width:70},{name:"required",title:t.getResource("workportal-adhoc-entity-form-attrib-required"),type:"checkbox",width:60},{type:"control"}]});t.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"700px",modal:!0,title:bizagi.localization.getResource("Crear Entidad"),maximize:!1,close:function(){t.dialogBox.formContent.dialog("destroy");t.dialogBox.formContent.detach()}})},closeDialogBox:function(){var n=this;n.dialogBox.elements.gridFields.jsGrid("destroy");n.dialogBox.formContent.dialog("destroy");n.dialogBox.formContent.detach()},onSaveAdhocEntity:function(n){var t,i;n.preventDefault();t=this;t.validateParams()&&(i={id:t.dialogBox.adhocEntityGuid,name:t.dialogBox.elements.inputName.val(),displayName:t.dialogBox.elements.inputDisplayName.val(),description:t.dialogBox.elements.inputDesc.val(),displayAttrib:$("#attribsList",t.dialogBox.formContent).val(),entityType:t.dialogBox.elements.selectType.val(),attributes:t.dialogBox.data},$.when(t.dataService.saveAdhocEntity(i)).done(function(){t.entityMap[i.id]=i;i.entityType==1?t.masterEntityMap[i.id]=i:t.parametricEntityMap[i.id]=i;t.closeDialogBox();t.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-entity-form-save"),""));t.renderEntitiesListPanel(i.id);t.setAttribTypes()}).fail(function(n){bizagi.log(n)}))},createEntityMap:function(n){var t=this;$.each(n,function(n,i){t.entityMap[i.id]=i;i.entityType==1?t.masterEntityMap[i.id]=i:t.parametricEntityMap[i.id]=i})},validateParams:function(){var i=this,t=i.dialogBox.elements.inputName,n;return t.val()&&t.val()!==""?!0:(n=bizagi.localization.getResource("workportal-general-error-field-required"),n=n.replace("{0}","Name"),t.next().find("span").html(n),!1)},initializeJSGrid:function(){var n=this;n.buildDateTimeField();n.buildMoneyField();n.buildFloatField();n.buildCustomSelectField();n.setAttribTypes()},setAttribTypes:function(){var n=this;$.when(n.getEntities()).done(function(t){n.attribTypes.push({name:"Bizagi Entities",options:t.bizagiEntities});n.attribTypes.push({name:"Adhoc Entities",options:t.adhocEntities})})},getEntities:function(){var t=this,n=new $.Deferred;return $.when(t.dataService.getAllEntities()).done(function(t){var i={},r=[],u=[];$.each(t,function(n,t){t.type==="bizagi"?r.push({value:{id:t.entId,type:25,relatedEntity:t.entId},label:t.entName}):u.push({value:{id:t.entId,type:36,relatedEntity:t.entId},label:t.entName})});i.bizagiEntities=r;i.adhocEntities=u;n.resolve(i)}),n.promise()},getEntityValues:function(n,t){var r=this,i=new $.Deferred;return $.when(r.dataService.getEntityValues(n,t)).done(function(n){var t=[];$.each(n,function(n,i){t.push({value:i.id,label:i.displayValue})});i.resolve(t)}),i.promise()},buildCustomSelectField:function(){var n=this,t=function(n){jsGrid.Field.call(this,n)};t.prototype=new jsGrid.Field({itemTemplate:function(t){var r="",i;return t&&(r=t.type==25||t.type==36?t.relatedEntity:t.type),i=n.getSelectedAttribType(r),i?i.label:""},insertTemplate:function(){var t=$.tmpl(n.getTemplate("admin.adhoc.entity.form.attribtype"),{categories:n.attribTypes,selectedValue:15});return this._insertCustomSelect=t},editTemplate:function(t){var i=t.type==25||t.type==36?t.relatedEntity:t.type,r=$.tmpl(n.getTemplate("admin.adhoc.entity.form.attribtype"),{categories:n.attribTypes,selectedValue:i});return this._editCustomSelect=r},insertValue:function(){var t=n.getSelectedAttribType(this._insertCustomSelect.find(":selected").data("id"));return t.value},editValue:function(){var t=n.getSelectedAttribType(this._editCustomSelect.find(":selected").data("id"));return t.value}});jsGrid.fields.customselect=t},buildDateTimeField:function(){var n=function(n){jsGrid.Field.call(this,n)};n.prototype=new jsGrid.Field({sorter:function(n,t){return new Date(n)-new Date(t)},itemTemplate:function(n){return new Date(n).toDateString()},insertTemplate:function(){return this._insertPicker=$("<input>").datepicker({defaultDate:new Date})},editTemplate:function(n){return this._editPicker=$("<input>").datepicker().datepicker("setDate",new Date(n))},insertValue:function(){return this._insertPicker.datepicker("getDate").toISOString()},editValue:function(){return this._editPicker.datepicker("getDate").toISOString()}});jsGrid.fields.datetime=n},buildMoneyField:function(){var n=function(n){jsGrid.NumberField.call(this,n)};n.prototype=new jsGrid.NumberField({itemTemplate:function(n){return"$"+parseFloat(n).toLocaleString()},filterValue:function(){return parseFloat(this.filterControl.val()||0)},insertValue:function(){return parseFloat(this.insertControl.val()||0)},editValue:function(){return parseFloat(this.editControl.val()||0)}});jsGrid.fields.money=n},buildFloatField:function(){var n=function(n){jsGrid.NumberField.call(this,n)};n.prototype=new jsGrid.NumberField({filterValue:function(){return parseFloat(this.filterControl.val())},insertValue:function(){return parseFloat(this.insertControl.val())},editValue:function(){return parseFloat(this.editControl.val())}});jsGrid.fields.float=n},buildEntityField:function(n,t,i){var r=this,u=function(n){jsGrid.Field.call(this,n)};u.prototype=new jsGrid.Field({itemTemplate:function(t){if(t){var i=n.filter(function(n){return n.value.key===t.key})[0];return i?i.label:""}return""},insertTemplate:function(){var t=$("<input>");return r.initializeAutoComplete(t,n),this._insertAutoComplete=t},editTemplate:function(t){var i=$("<input>"),u;return t&&(u=n.filter(function(n){return n.value.key===t.key})[0],i.val(u?u.label:"")),r.initializeAutoComplete(i,n),this._editAutoComplete=i},insertValue:function(){return this._insertAutoComplete.data("entityValue")},editValue:function(){return this._editAutoComplete.data("entityValue")}});jsGrid.fields[i+"entity"+t]=u},initializeAutoComplete:function(n,t){var i=this;n.autocomplete({minLength:2,source:t,select:function(t,i){var r=i.item.label;return n.val(r),n.data("entityValue",i.item.value),!1},focus:function(){return!1},change:function(t,i){return i.item===null&&(n.val(t.currentTarget.value),n.data("entityValue",null)),!1}})},getSelectedAttribType:function(n){var i=this,t;return $.each(i.attribTypes,function(i,r){var u=r.options.filter(function(t){return t.value.id===n})[0];if(u)return t=u,!1}),t},refreshAttribListControl:function(n){var i=this,t=$("#adhoc-entity-displayattrib-wrapper",i.dialogBox.formContent),u=$.tmpl(i.getTemplate("admin.adhoc.entity.form.displayattrib"),{attribsList:i.dialogBox.data}),r;t.empty();t.html(u);r=$("#attribsList option[value="+n+"]",t);n&&r[0]?r.attr("selected","selected"):$("#attribsList option:first",t).attr("selected","selected")}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.adhoc.usergroup",{},{init:function(n,t,i){var r=this,u;r._super(n,t,i);r.allowSelection=i.data?i.data.allowSelection:!1;r.selectedGroup=i.data?i.data.selectedItem:null;r.dialogBox={};r.userGroups=[];r.userGroupMap={};r.adhocUserGroupMap={};r.bizagiUserGroupMap={};r.userInstancesMap={};u="bizagi.workportal.desktop.widgets.admin.adhoc.usergroup";r.notifier=bizagi.injector.get("notifier");r.loadTemplates({"admin.adhoc.usergroup.wrapper":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-user-group-wrapper"),"admin.adhoc.usergroup.panel.wrapper":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-user-group-panel-wrapper"),"admin.adhoc.usergroup.list":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-user-group-list"),"admin.adhoc.usergroup.data":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-user-group-data"),"admin.adhoc.usergroup.error":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-user-group-error"),"admin.adhoc.usergroup.nodata":bizagi.getTemplate(u).concat("#ui-bizagi-workportal-widget-admin-adhoc-user-group-nodata"),"admin.adhoc.usergroup.form":bizagi.getTemplate(u).concat("#adhoc-user-group-form-popup"),"admin.adhoc.usergroup.data.searchform":bizagi.getTemplate(u).concat("#adhoc-user-group-data-form-popup"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ADHOC_USER_GROUPS},renderContent:function(){var n=this,t=n.getTemplate("admin.adhoc.usergroup.wrapper");return n.content=$.tmpl(t)},postRender:function(){var n=this,t;n.panelWrapper=$.tmpl(n.getTemplate("admin.adhoc.usergroup.panel.wrapper"));n.userGroupList=n.getTemplate("admin.adhoc.usergroup.list");n.userGroupData=n.getTemplate("admin.adhoc.usergroup.data");n.userGroupError=n.getTemplate("admin.adhoc.usergroup.error");n.userGroupNoData=n.getTemplate("admin.adhoc.usergroup.nodata");t=n.getContent();t.empty();$.when(n.dataService.getAdhocUserGroupList()).done(function(i){if(i.length>0)n.createUserGroupMap(i),n.renderUserGroupListPanel();else{var u=n.getResource("workportal-general-first-line-no-records-found"),r=$.tmpl(n.userGroupNoData,{errorMessage:u});$("#userGroupNoData",r).click(function(){n.showAdhocUserGroupForm()});t.html(r)}}).fail(function(){n.self.userGroupMap=undefined;var i=n.getResource("workportal-widget-admin-user-group-error");t.html($.tmpl(n.userGroupError,{errorMessage:i}))})},renderUserGroupListPanel:function(n){var t=this,f=t.getContent(),i=$("#admin-user-group-list-wrapper",t.panelWrapper),r,u;i.empty();f.html(t.panelWrapper);r=$.map(t.adhocUserGroupMap,function(n){return n});u=$.map(t.bizagiUserGroupMap,function(n){return n});$.tmpl(t.userGroupList,{adhocUserGroupList:r,bizagiUserGroupList:u,allowSelection:t.allowSelection}).appendTo(i);!n&&t.selectedGroup&&t.selectedGroup.length>0&&(n=t.selectedGroup);n?$("#userGroupList option[value="+n+"]",i).attr("selected","selected"):$("#userGroupList option:first",i).attr("selected","selected");t.configureHandlers()},configureHandlers:function(){var t=this,n=$("#admin-user-group-list-wrapper",t.panelWrapper),i=$("#admin-user-instances-wrapper",t.panelWrapper);$("#searchUserGroup",n).keyup(function(){var i=!1,r=$(this).val().toLowerCase(),u;$("#userGroupList option",n).remove();u=$("optgroup");$.each(t.userGroupMap,function(){r.length>1?this.displayName.toLowerCase().indexOf(r)!=-1&&(i=!0):i=!0;i&&($("<option>",{value:this.id,text:this.displayName}).appendTo(u[this.isAdhoc?1:0]),i=!1)})});$("#userGroupList",n).change(function(){t.setCurrentUserGroup();t.currentUserGroup.isAdhoc?($("#adhocUserGroupEdit",n).show(),$("#adhocUserGroupDelete",n).show()):($("#adhocUserGroupEdit",n).hide(),$("#adhocUserGroupDelete",n).hide());t.loadUsers()}).trigger("change");$("#adhocUserGroupAdd",n).click(function(){t.showAdhocUserGroupForm(!0)});$("#adhocUserGroupEdit",n).click(function(){t.showAdhocUserGroupForm()});$("#adhocUserGroupDelete",n).click(function(){t.deleteAdhocGroup()})},loadUsers:function(){var n=this,t;$("#admin-user-group-description-wrapper",n.panelWrapper).html(n.currentUserGroup.description);t=$("#admin-user-instances-wrapper",n.panelWrapper);$.when(n.dataService.loadUsersByGroup(n.currentUserGroup.id)).done(function(i){$.tmpl(n.userGroupData,{userList:i,context:n.currentUserGroup.isAdhoc?"adhoc":"bizagi"}).appendTo(t);$(".item-delete-button",t).click(function(){n.removeUserFromGroup($(this).data("id"))});n.currentUserGroup.isAdhoc&&$("#addUserButton",t).click(function(){n.showUserSearchForm()})}).fail(function(){var i=n.getResource("workportal-widget-admin-user-group-instances-error");t.html($.tmpl(n.userGroupError,{errorMessage:i}))})},saveAdhocUserInstance:function(n,t){var i=this,r={};t?r.id=Math.guid():(r.id=n.id,delete n.id);r.disabled=n.disabled;delete n.disabled;r.data=JSON.stringify(n);$.when(i.dataService.addUserToGroup({entityId:i.currentUserGroup.id,isNew:t,instance:r})).done(function(){i.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-user-instance-save"),""))}).fail(function(){var n=i.getResource("workportal-widget-admin-user-group-instance-add-error");$("#admin-entity-instances-wrapper",i.getContent()).html($.tmpl(i.entitiesError,{errorMessage:n}))})},deleteAdhocGroup:function(){var n=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-adhoc-user-group-delete-confirmation"),"","info")).done(function(){$.when(n.dataService.deleteAdhocGroup(n.currentUserGroup.id)).done(function(){delete n.adhocUserGroupMap[n.currentUserGroup.id];n.currentUserGroup=null;n.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-user-group-delete"),""));n.renderUserGroupListPanel()})})},removeUserFromGroup:function(n){var t=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-adhoc-user-group-data-remove-confirmation"),"","info")).done(function(){$.when(t.dataService.removeUserFromGroup(t.currentUserGroup.id,n)).done(function(){t.loadUsers()})})},setCurrentUserGroup:function(){var n=this,t=$("#userGroupList option:selected",n.panelWrapper);n.currentUserGroup=n.userGroupMap[t.val()]},showAdhocUserGroupForm:function(n){var t=this,i=t.getTemplate("admin.adhoc.usergroup.form");t.dialogBox.formContent=$.tmpl(i);t.dialogBox.elements={inputDisplayName:$("#input-displayname-adhoc-user-group",t.dialogBox.formContent),inputDesc:$("#input-desc-adhoc-user-group",t.dialogBox.formContent),buttonSave:$("#button-accept-adhoc-user-group-form",t.dialogBox.formContent),buttonCancel:$("#button-cancel-adhoc-user-group-form",t.dialogBox.formContent)};t.dialogBox.elements.buttonSave.on("click",$.proxy(t.onSaveAdhocUserGroup,t));t.dialogBox.elements.buttonCancel.on("click",$.proxy(t.closeDialogBox,t));!n&&t.currentUserGroup?(t.dialogBox.adhocGroupGuid=t.currentUserGroup.id,t.dialogBox.elements.inputDisplayName.val(t.currentUserGroup.displayName),t.dialogBox.elements.inputDesc.val(t.currentUserGroup.description),$("option[value="+t.currentUserGroup.id+"]",t.dialogBox.elements.selectType).attr("selected","selected")):(t.dialogBox.data=[],t.dialogBox.adhocGroupGuid=Math.guid(),t.dialogBox.isNew=!0);t.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"700px",modal:!0,title:bizagi.localization.getResource("workportal-adhoc-usergroup-create-popup-title"),maximize:!1,close:function(){t.dialogBox.formContent.dialog("destroy");t.dialogBox.formContent.detach()}})},showUserSearchForm:function(){var n=this,t=n.getTemplate("admin.adhoc.usergroup.data.searchform");n.dialogBox.formContent=$.tmpl(t);n.dialogBox.elements={inputDisplayName:$("#input-displayname-user",n.dialogBox.formContent),buttonSave:$("#button-accept-adhoc-user-group-form",n.dialogBox.formContent),buttonCancel:$("#button-cancel-adhoc-user-group-form",n.dialogBox.formContent)};n.dialogBox.elements.buttonSave.on("click",$.proxy(n.onSaveUserToGroup,n));n.dialogBox.elements.buttonCancel.on("click",$.proxy(n.closeDialogBox,n));n.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"400px",modal:!0,title:bizagi.localization.getResource("workportal-adhoc-usergroup-user-search-popup-title"),maximize:!1,close:function(){n.dialogBox.formContent.dialog("destroy");n.dialogBox.formContent.detach()}});n.initializeUserAutoComplete(n.dialogBox.elements.inputDisplayName)},closeDialogBox:function(){var n=this;n.dialogBox.formContent.dialog("destroy");n.dialogBox.formContent.detach()},onSaveAdhocUserGroup:function(n){var t,i;n.preventDefault();t=this;t.validateParams()&&(i={id:t.dialogBox.adhocGroupGuid,displayName:t.dialogBox.elements.inputDisplayName.val(),description:t.dialogBox.elements.inputDesc.val(),isAdhoc:!0},$.when(t.dataService.saveAdhocGroup(i)).done(function(){t.currentUserGroup=i;t.userGroupMap[i.id]=i;i.isAdhoc==1?t.adhocUserGroupMap[i.id]=i:t.bizagiUserGroupMap[i.id]=i;t.closeDialogBox();t.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-usergroup-form-save"),""));t.renderUserGroupListPanel(i.id)}).fail(function(n){bizagi.log(n)}))},onSaveUserToGroup:function(n){var t,i;n.preventDefault();t=this;t.validateParams()&&(i={groupId:t.currentUserGroup.id,userId:t.currentAssignee},$.when(t.dataService.addUserToGroup(i)).done(function(){t.closeDialogBox();t.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-adhoc-usergroup-instance-save"),""));t.loadUsers()}).fail(function(n){bizagi.log(n)}))},createUserGroupMap:function(n){var t=this;$.each(n,function(n,i){t.userGroupMap[i.id]=i;i.isAdhoc?t.adhocUserGroupMap[i.id]=i:t.bizagiUserGroupMap[i.id]=i})},validateParams:function(){var i=this,t=i.dialogBox.elements.inputDisplayName,n;return t.val()&&t.val()!==""?!0:(n=bizagi.localization.getResource("workportal-general-error-field-required"),n=n.replace("{0}","Name"),t.next().find("span").html(n),!1)},initializeUserAutoComplete:function(n){var t=this,i=t.dataService.serviceLocator.getUrl("admin-getUsersList");n.autocomplete({minLength:2,source:function(n,t){$.ajax({url:i,data:{domain:"",userName:"",fullName:n.term,organization:"",pag:1,pagSize:100,orderField:"fullName"},success:function(n){t($.map(n.users,function(n){return{label:n.user,value:n.idUser}}))}})},select:function(i,r){var u=r.item.label;return n.val(u),t.currentAssignee=r.item.value,!1},focus:function(){return!1},change:function(n,i){return i.item===null&&t.dialogBox.elements.inputUser.val(""),!1}})}});
(function(n){n.fn.bizagiSearchUser=function(t){var l=this;t=t||{};var u={},h=10,c=9,o=[],e=1,f=0,i={},s=t.editingUser,r={init:function(){r.bindElements()},bindElements:function(){l.click(function(){r.openUploadDialog()})},openUploadDialog:function(){var u=this,e=window.document,f=u.dialogBox=n("<div class='ui-bizagi-component-search-user'/>");i=f.dialog({width:950,maximize:!1,resize:!1,draggable:!1,height:650,title:t.title,modal:!0});r.showFilters();r.showButtons();r.addHandlers()},showFilters:function(){var r=n("<div id='filtersContainer' class='filters-container clearfix'><\/div>");n.each(t.filters,function(u,f){n(r,i).append("<div class='filters-row clearfix'><div class='filters-cell'><span>"+t.displayNames[u]+"<\/span><\/div><div class='filters-cell'><input id="+f+" type='text'> <\/input><\/div><\/div>")});r.appendTo(i)},showButtons:function(){var u=n("<div id='buttonsContainer'class='biz-wp-buttonset'><\/div>"),f;n(u,i).append("<button id='btnSearchUsers' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+t.searchButtonName+"<\/span><\/button>");n(u,i).append("<button id='btnClear' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+t.clearButtonName+"<\/span><\/button>");t.allowAddUser?(f="<button id='btnNew' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+bizagi.localization.getResource("workportal-widget-admin-user-profiles-button-label-newUserProfiles")+"<\/span><\/button>",n(u,i).append(f),u.appendTo(i),n("#btnNew",i).bizagiCreateUser(t.dataService,t.renderFactory,{canvas:n(i),onCreate:t.selectItem(),onCancel:function(){n(i).dialog("option","title",t.title);n(i).empty();r.showFilters();r.showButtons();r.addHandlers()}})):u.appendTo(i)},addHandlers:function(){return n("#btnSearchUsers",i).click(function(){r.getUsersTableData()}),n("#btnClear",i).click(function(){r.clickClearPluginValues()}),this},clickClearPluginValues:function(){n.each(t.filters,function(t,r){n("#"+r,i).val("")});n("#searchResults",i).remove()},getUsersTableData:function(){var e=this,i;r.updateFiltersInformation();i=t.searchUsers(u);n.when(i).done(function(n){o=n.users;f=n.total;r.showUsersTable()}).fail(function(n){t.showError(n)})},updateFiltersInformation:function(){n.each(t.filters,function(t,r){u[r]=n("#"+r,i).val()});u.pag=e;u.pagSize=c;typeof s!="undefined"&&s!==""&&(u.editingUser=s)},showUsersTable:function(){var u,s,h;o.length>0?(u=f>1?!0:!1,s=r.getPagesArray(),n("#searchResults",i).remove(),h=t.getTableTemplate(o,e,u,s),n(i).append(h),r.addTableHandlers(),r.setUpPagination()):(t.showMessageBox("workportal-widget-usertable-empty"),n("#searchResults",i).remove())},addTableHandlers:function(){n("table :button",i).click(function(){var f=n(this),r={},u;n.each(t.valuesToSelect,function(n,t){r[t]=f.data(t)});u=t.selectItem();u.resolve(r);i.remove()})},getPagesArray:function(){for(var i=h>f?f:h,t=[],n=0;n<i;n++)t.push(n+1);return t},setUpPagination:function(){var r=this,t=n("#biz-wp-userstable-pager ul",i);t.bizagiPagination({maxElemShow:c,totalPages:f,actualPage:e,listElement:t,clickCallBack:function(n){u.pag=e=parseInt(n.page);r.getUsersTableData()}})}};return r.init(),r}})(jQuery);
(function(n){n.fn.bizagiCreateUser=function(t,i,r){var e=this,u,f;return r=r||{},u=r.canvas,onCreate=r.onCreate||function(){},onCancel=r.onCancel||function(){},displayName=bizagi.localization.getResource("workportal-widget-admin-user-profiles-button-label-newUserProfiles"),f={init:function(){f.addHandlers()},addHandlers:function(){e.on("click",function(){f.newUser()})},newUser:function(){var i=this;u.empty();n.tmpl("<div {{loading}}><\/div>").appendTo(u);t.getUsersForm({h_action:"LOADUSERADMINFORM",h_contexttype:"entity",h_optionform:"add"}).done(function(n){var t=new bizagi.rendering.facade,f={canvas:u,data:n,type:"usersForm",userId:0,action:"add"};u.dialog("option","title",displayName);t.execute(f).done(function(n){t.form.bind("endUsersForm",function(t,f){typeof f.error=="undefined"&&(f.formAction==="save"?(f.sendMail&&i.sendEmail(f.userId,f.password),r.onCreate.resolve({iduser:f.userId,user:f.fullName}),u.remove()):f.formAction==="cancel"&&r.onCancel(),n.endLoading())})})})},sendEmail:function(n,i){var r=this;t.generateDataToSendByEmail({idUser:n,password:i}).done(function(n){r.showEmailPopup(n,i)})},showEmailPopup:function(r,u){var e=this,s=window.document,h=i.getTemplate("render-user-email"),f=e.dialogBoxEmail=n("<div class= admin-users-email/>"),o={};f.empty();f.appendTo("body",s);o[bizagi.localization.getResource("workportal-widget-admin-users-button-label-send")]=function(){if(n("#txtTextTo",f).val()!=""){var i={eMailTo:n("#txtTextTo",f).val(),subject:n("#txtSubject",f).val(),body:n("#txtBody",f).val(),userSecret:u};n.when(t.sendUserEmail(i)).done(function(){e.closeUploadDialogEmail();bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-Send-message"),"Bizagi","warning")})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-empty-email-to"),"Bizagi","warning")};o[bizagi.localization.getResource("workportal-widget-admin-users-button-label-notSend")]=function(){e.closeUploadDialogEmail()};f.dialog({width:500,height:400,title:bizagi.localization.getResource("workportal-widget-admin-users-subtitle-email"),modal:!0,maximize:!1,resizable:!1,draggable:!1,buttons:o,close:function(){e.closeUploadDialogEmail()},resizeStop:function(n,t){e.form&&e.form.resize(t.size)}});r.body=r.body.replace(/\\n/g,"\n").replace(/\\/g,"");n.tmpl(h,{messageResponse:r}).appendTo(f)},closeUploadDialogEmail:function(){var n=this;n.dialogBoxEmail.dialog("destroy");n.dialogBoxEmail.remove()}},f.init(),f}})(jQuery);
(function(n){n.fn.simpleGrid=function(t,i){function e(){r.empty();n.when(r.initialized).done(function(){var i=[{pag:u.page,pagSize:u.pageSize,orderType:u.orderType,orderField:u.orderField,filters:h(u.filters)}],t=r.data("numRequest");r.data("numRequest",t?t+=1:1);t=r.data("numRequest");n.when(u.onDataBinding.apply(r.get(0),i)).done(n.proxy(function(i){t===r.data("numRequest")&&(r.append(n.tmpl(r.panelWrapper)),r.grid.totalRecords=i.records,r.grid.totalPages=i.total,c(i),i.records>u.pageSize&&(r.grid.page=i.page,l()))},t))})}function h(n){var t=Object.keys(n).map(function(t){return n[t]});return t.filter(function(n){if(n.key==="is-null"||n.key!=="is-null"&&typeof n.value!="undefined"&&n.value!==null)return!0})}function c(t){var i=n(".ui-bizagi-simple-grid-wrapper",r).html(n.tmpl(r.panelContent,{displayName:u.displayName,headers:t.header,rows:t.row,orderType:u.orderType,orderField:u.orderField,guidForms:t.entity,allowAdd:u.allowAdd,allowEdit:u.allowEdit,allowDelete:u.allowDelete,filterApplied:u.filters,attributeSupportFilter:s,attributeSupportOrder:p}));a(i);v(i,t.header)}function l(){for(var f=u.maxPageToShow>r.grid.totalPages?r.grid.totalPages:u.maxPageToShow,o=n(".bz-rn-grid-footer-pagination",r),i={pagination:r.grid.totalPages>1,page:r.grid.page,pages:{}},t=1;t<=f;t++)i.pages[t]={pageNumber:t};o.append(n.tmpl(r.panelPaginator,i));n("ul#bz-widget-simple-grid-pager-wrapper",r).bizagiPagination({totalPages:r.grid.totalPages,actualPage:r.grid.page,listElement:n("#biz-wp-table-pager-wrapper"),clickCallBack:function(n){u.page=n.page;e()}})}function a(t){var r=n("a[data-type='1']",t),e=n("a[data-type='2'][data-attributeType='2']",t),o=n("a[data-type='3']",t),s=n("a[data-type='4']",t),h=n("a[data-type='5']",t),c=n("a[data-type='6']",t),l=n("a[data-type='7']",t),a=n("a[data-type='8']",t),v=n("a[data-type='10']",t),p=n("a[data-type='11']",t),w=n("a[data-type='12']",t),b=n("a[data-type='29']",t),k=typeof bizagi.currentUser.symbol!="undefined"?bizagi.currentUser:u.getResource("numericFormat"),i=bizagi.clone(k);i.decimalDigits=0;n.each(w,function(i,r){if(n(r).parent().css("display")!="none"){var u=Number(r.getAttribute("data-index"));n(".ui-bizagi-grid-table tr",t).find("td:eq("+u+")").find("span:contains(':')").addClass("formatDate")}});bizagi.util.formatInvariantDate(t,u.dateFormat);n.each(a,function(r,u){var e,o;if(n(u).parent().css("display")!="none"){var h=Number(u.getAttribute("data-index")),s=n(".ui-bizagi-grid-table tr",t).find("td:eq("+h+")"),c=u.getAttribute("data-allowdecimals")?bizagi.util.parseBoolean(u.getAttribute("data-allowdecimals")):!0;u.setAttribute("data-allowdecimals",c);s.find("span").addClass("formatMoney");e=f(u,i);o=bizagi.util.parseBoolean(u.getAttribute("data-showsymbol"));e.symbol=o===null||o?typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol:"";bizagi.util.formatInvariantMoney(s,e)}});n.each(v,function(r,u){var e;if(n(u).parent().css("display")!="none"){var s=Number(u.getAttribute("data-index")),o=n(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")"),h=u.getAttribute("data-allowdecimals")?bizagi.util.parseBoolean(u.getAttribute("data-allowdecimals")):!0;u.setAttribute("data-allowdecimals",h);o.find("span").addClass("formatMoney");e=f(u,i);e.allowDecimals&&e.decimalDigits===0&&(e.decimalDigits=typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2);bizagi.util.formatInvariantNumber(o,e)}});n.each(c,function(r,u){if(n(u).parent().css("display")!="none"){var o=Number(u.getAttribute("data-index")),e=n(".ui-bizagi-grid-table tr",t).find("td:eq("+o+")");e.find("span").addClass("formatMoney");bizagi.util.formatInvariantNumber(e,f(u,i))}});n.each(p,function(r,u){var s,o,e;n(u).parent().css("display")!="none"&&(s=Number(u.getAttribute("data-index")),o=n(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")"),o.find("span").addClass("formatMoney"),e=f(u,i),e.allowDecimals&&e.decimalDigits===0&&(e.decimalDigits=typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2),bizagi.util.formatInvariantNumber(o,e))});n.each(r,function(r,u){if(n(u).parent().css("display")!="none"){var o=Number(u.getAttribute("data-index")),e=n(".ui-bizagi-grid-table tr",t).find("td:eq("+o+")");e.find("span").addClass("formatMoney");bizagi.util.formatInvariantNumber(e,f(u,i))}});n.each(e,function(r,u){if(n(u).parent().css("display")!="none"){var o=Number(u.getAttribute("data-index")),e=n(".ui-bizagi-grid-table tr",t).find("td:eq("+o+")");e.find("span").addClass("formatMoney");bizagi.util.formatInvariantNumber(e,f(u,i))}});n.each(o,function(r,u){if(n(u).parent().css("display")!="none"){var o=Number(u.getAttribute("data-index")),e=n(".ui-bizagi-grid-table tr",t).find("td:eq("+o+")");e.find("span").addClass("formatMoney");bizagi.util.formatInvariantNumber(e,f(u,i))}});n.each(s,function(r,u){if(n(u).parent().css("display")!="none"){var o=Number(u.getAttribute("data-index")),e=n(".ui-bizagi-grid-table tr",t).find("td:eq("+o+")");e.find("span").addClass("formatMoney");bizagi.util.formatInvariantNumber(e,f(u,i))}});n.each(l,function(r,u){if(n(u).parent().css("display")!="none"){var o=Number(u.getAttribute("data-index")),e=n(".ui-bizagi-grid-table tr",t).find("td:eq("+o+")");e.find("span").addClass("formatMoney");bizagi.util.formatInvariantNumber(e,f(u,i))}});n.each(h,function(i,r){if(n(r).parent().css("display")!="none"){var u=Number(r.getAttribute("data-index")),f=n(".ui-bizagi-grid-table tr",t).find("td:eq("+u+")").find("span");u>0&&n.each(f,function(t,i){var r=n.trim(n(i).text()).toLowerCase();(r==="true"||r==="1")&&n(i).text("X");(r==="false"||r==="0")&&n(i).text("")})}});n.each(b,function(i,r){if(n(r).parent().css("display")!="none"){var u=Number(r.getAttribute("data-index")),f=n(".ui-bizagi-grid-table tr",t).find("td:eq("+u+")").find("span");n.each(f,function(t,i){var r=n.trim(n(i).text());n(i).text(bizagi.util.scientificNotationFormat(r))})}});n("a[data-type='-11']").length>0&&(n(".admin-entities-rightframe #detailEntity table.ui-bizagi-grid-table td:nth-child(1)").css("display","none"),n(".admin-entities-rightframe #detailEntity table.ui-bizagi-grid-table th:nth-child(1)").css("display","none"));y(t)}function v(i,f){var o=u.filters,h=i.find(".ui-bizagi-grid-header .ui-bizagi-render-icon-filter");n.each(h,function(i,h){var c=n(h),a=c.parent(),v=c.data("index"),l=f[v];s(l)&&function(i){var f=i.fieldValue;c.bizagi_filters({type:i.dataType,attributeType:i.attributeType,parent:a,templates:{filterWrapper:t.getTemplate("filter-wrapper"),filterString:t.getTemplate("filter-string"),filterNumber:t.getTemplate("filter-number"),filterDate:t.getTemplate("filter-date"),filterBoolean:t.getTemplate("filter-boolean")},data:o[f],entity:i.relatedEntity,dataService:{getAdminEntityData:function(t){return n.when(r.grid.internalData[f]||u.onLoadFilter.apply(u,new Array(n.extend(t,{type:"Entity"})))).then(function(n){return r.grid.internalData[f]=n,n})}}});c.on("bizagi_filterschange",function(t,r){n.isEmptyObject(r)?delete o[f]:(r.dataType=i.dataType,r.field=f,typeof i.entity!="undefined"&&(r.entity=i.entity),o[f]=r);e()});o[f]&&c.addClass("ui-bizagi-column-filter-applied")}(l)})}function y(t){n(".link-order-entity",t).click(function(){u.orderField=n(this).attr("data-columnOrderField");u.orderType=n(this).attr("data-orderType");e()});n(".ui-bizagi-grid-body tr",t).click(function(){n(this).attr("class")==="ui-bizagi-state-selected"?(n(this).removeClass("ui-bizagi-state-selected"),r.elementSelected=null):(n(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),n(this).addClass("ui-bizagi-state-selected"),r.elementSelected=this)});n("#addRowEntity",t).click(function(n){u.onAdd.apply(this,[n,{context:r.get(0)}])});n("#editRowEntity",t).click(function(i){r.elementSelected==null?bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row")):(u.onEdit.apply(this,[i,r.elementSelected]),n(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),r.elementSelected=null)});n("#deleteRowEntity",t).click(function(i){r.elementSelected==null?bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row")):(u.onDelete.apply(this,[i,r.elementSelected]),n(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),r.elementSelected=null)})}function s(n){var t=n.attributeType,i=n.dataType,r=n.xpath||"";return n.masterEntity?!1:i<0?!1:r.indexOf(".")>-1?!1:t==1003?!1:t==1002?!1:t==1004?!1:t==1005?!1:!0}function p(n){var t=n.attributeType,i=n.dataType,r=n.xpath||"";return i<0?!1:r.indexOf(".")>-1?!1:t==1003?!1:t==1002?!1:!0}function f(n,t){var i={decimalDigits:0,decimalSeparator:t.decimalSeparator},u=n.getAttribute("data-allowdecimals")||!1,f=n.getAttribute("data-numdecimals")||0,e=n.getAttribute("data-percentage")||!1,r=n.getAttribute("data-thousands")||!0;return u=bizagi.util.parseBoolean(u),r=bizagi.util.parseBoolean(r),i.allowDecimals=u,i.decimalDigits=f,i.thousands=r,i.groupSeparator=r?t.groupSeparator:"",i.percentage=e,i}var r,u,o;if(typeof t=="undefined")throw"Debe pasar como parametro el widget de bizagi, para la carga del template";return r=this,u=n.extend({allowAdd:!1,allowEdit:!1,allowDelete:!1,displayName:"",dateFormat:bizagi.localization.getResource("dateFormat"),filters:[],maxPageToShow:5,orderType:"ASC",orderField:"",page:1,pageSize:10,onDataBinding:function(){},onLoadFilter:function(){},onAdd:function(){},onEdit:function(){},getResource:function(){}},i),r.grid={internalData:{}},o={render:e},function(){r.initialized=t.loadTemplates({"bizagi.simpleGrid.wrapper":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid"),"bizagi.simpleGrid.content":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid-content"),"bizagi.simpleGrid.paginator":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid-paginator"),"filter-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-wrapper"),"filter-string":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-string"),"filter-number":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-number"),"filter-date":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-date"),"filter-boolean":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-boolean"),useNewEngine:!1}).then(function(){r.panelWrapper=t.getTemplate("bizagi.simpleGrid.wrapper");r.panelContent=t.getTemplate("bizagi.simpleGrid.content");r.panelPaginator=t.getTemplate("bizagi.simpleGrid.paginator")})}(),o}})(jQuery);
