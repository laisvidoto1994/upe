$.bizagi||($.bizagi={processviewer:{}});$.bizagi.processviewer={configuration:{constants:{ELEMENT_TYPE:{PROCESS:"Process",LANE:"Lane",MILESTONES:"Milestone",TEXTANNOTATION:"TextAnnotation",ASSOCIATION:"Association",SEQUENCEFLOW:"SequenceFlow"},CONDITION_TYPE:{SUBPROCESSEXP:"SubprocessException",CANCELLATION:"Cancellation",NORMAL:"Normal",RELATION:"Relation",COMPENSATION:"Compensation"},PROPERTIES:{WAYPOINTS:"waypoints",BOUNDS:"bounds"},LANESETS:"laneSets",LANES:"lanes",BPMNLABELSTYLES:"bpmnLabelStyles"},validTypeDefinitions:["artifacts","flowElements","laneSets","milestones"]},design:{markers:{normal:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401","class":"normal"}},highlighted:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401","class":"highlighted"}},selected:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401","class":"highlighted"}},association:{type:"path",properties:{d:"M0.595,0.598  l8.8,4.132l-8.8,4.667","class":"association"}}}}};
(function(n){n.widget("ui.processviewer",{constants:n.bizagi.processviewer.configuration.constants,options:{image:null,zoomRange:50,hotspots:[],dragMessage:"Drag Image (Image Pane)",processMessage:"Process Image....",previewWidth:120,previewHeight:120,hotspotsCSS:"",draggable:!0,controls:!0,zoomImageOptions:!1,moveIncrement:20,isIE8:!1,device:"desktop",minZoom:.5,minZoomIE8:.5,maxZoomIE8:1.5,maxZoom:1.5,template:!1,unavailableImage:"img/unavailable_image.png",tmpl:"bizagi.processviewer.template",hotSpotsSVG:!1,formatStyles:{},milestonesHeight:25,animation:{path:[],interval:0,instance:0,time:200,counter:0},configuration:{localTemplate:"",processviewerStageId:"",processviewerStage:"",$processviewerStage:"",processviewerStageSet:"",processviewerImageStage:"",processviewerHotSpotsContainer:"",processviewerStagePathsSet:"",errorImageCSS:"processviewer-error-image",sliderOptions:{}},getTemplate:function(n){return bizagi.getTemplate(n)}},_create:function(){var t=this;n.support.touch="ontouchend"in document;t._isInWorkportal()?typeof bizagi!="undefined"&&typeof bizagi.util!="undefined"&&(t.options.isIE8=bizagi.util.isIE8(),t.options.device=bizagi.util.detectDevice()):bizagi={workportal:!1};t.$el=n('<div class="wdg-processviewer"><\/div>');t.$el.attr("role","widget.bizagi.processviewer");t.element.append(t.$el);t.options.jsonBizagi?typeof t.options.jsonBizagi.processDefinition=="string"&&typeof t.options.jsonBizagi.processDefinition=="string"?n.when(n.get(t.options.jsonBizagi.processDefinition),n.get(t.options.jsonBizagi.processGraphicsInfo)).done(function(n,i){t._processDataForPlugin({definition:n[0],graphics:i[0]})}).fail(function(n){t.$el.text(n.message)}):t._processDataForPlugin({definition:t.options.jsonBizagi.processDefinition,graphics:t.options.jsonBizagi.processGraphicsInfo}):t._loadTemplate()},_processDataForPlugin:function(t){var i=this;t.definition.status||t.graphics.status?i._triggers.error({message:t.definition.message,json:t}):n.when(n(t).processviewerQueries()).done(function(t){n.extend(i.options,t);i._loadTemplate()})},_triggerError:function(){},_loadTemplate:function(){var t=this,i=t.options.template;bizagi.workportal?(t.loader=new bizagi.ui.controls.tmplloader,i?i.indexOf(".html")&&n.when(t.loader.loadTemplates({processviewer:i})).done(function(){t.options.configuration.localTemplate=t.loader.getTemplate("processviewer");t._buildprocessviewer()}):(i=t.options.getTemplate(t.options.tmpl),n.when(t.loader.loadTemplates({processviewer:i})).done(function(){t.options.configuration.localTemplate=t.loader.getTemplate("processviewer");t._buildprocessviewer()}))):i?i.indexOf(".html")&&n.when(n.get(t.options.template)).done(function(n){t.options.configuration.localTemplate=n;t._buildprocessviewer()}):(i=t.options.getTemplate(t.options.tmpl),n.when(n.get(i)).done(function(n){t.options.configuration.localTemplate=n;t._buildprocessviewer()}))},_buildprocessviewer:function(){var t=this,i,r;t.$el.empty();i=t.options.configuration.processviewerStageId=t._generateID();r=n.tmpl(t.options.configuration.localTemplate,{id:i,isIE8:t.options.isIE8});t.$el.append(r);t._createStage()},resize:function(n,t){var i=this;t=t||i.options.width;h=n||i.options.height;i.$el.outerWidth(t);i.$el.outerHeight(n)},_createStage:function(){var t=this,r,u,o=0,s=0,f,e,i,a,h,c,l;r=t.options.width?t.options.width:"100%";u=t.options.height?t.options.height:150;t.$el.outerWidth(r);t.$el.outerHeight(u);c=t.options.dimentions.width*100/150+t.options.dimentions.width;l=t.options.dimentions.height*100/150+t.options.dimentions.height;t.options.configuration.processviewerStage=i=new Raphael(t._getStageContainer(),c,l);t.options.configuration.processviewerPathsStageGroup=a=i.group();i.canvas.setAttribute("id",t._generateID());i.canvas.setAttribute("id",t._generateID());i.canvas.setAttribute("class","processviewer-zvg-container");i.canvas.setAttribute("class","processviewer-zvg-nested");t.options.configuration.processviewerStageSet=i.set();t.options.configuration.processviewerstageHotSpotSet=i.set();n("[data-processviewercontainer]",t.element).height(t.options.dimentions.height);t.options.dimentions.height<u&&n("[data-processviewercontainer]",t.element).height(u);r.indexOf("%")&&(h=!0);h||t.options.dimentions.width<r?n("[data-processviewercontainer]",t.element).width("100%"):n("[data-processviewercontainer]",t.element).width(t.options.dimentions.width);t.options.dimentions.width<r&&n("[data-processviewercontainer]",t.element).width(r);t.options.image?n.when(t._verifyingImage(t.options.image)).done(function(n){f=n.width?n.width:"150";e=n.height?n.height:"150";t.options.configuration.processviewerImageStage=t.options.configuration.processviewerStage.image(n.src,o,s,f,e);t.options.configuration.processviewerStageSet.push(t.options.configuration.processviewerImageStage);t.options.configuration.processviewerRectStage.attr("fill","rgba(255,255,255,0)");t.options.configuration.processviewerRectStage.attr("stroke","none");t._createUIControls()}).fail(function(n){t._createUIFailView(n)}):(f=t.element.width()?t.element.width():"150",e=t.element.height()?t.element.height():"150",t.options.configuration.processviewerRectStage=t.options.configuration.processviewerStage.rect(o,s,r*2,u*2),t.options.configuration.processviewerRectStage.attr("fill","rgba(255,255,255,0)"),t.options.configuration.processviewerRectStage.attr("stroke","none"),t.options.configuration.processviewerRectStage[0].setAttribute("id","BaseStage"+t._generateID()),t._createUIControls())},_createUIControls:function(){var t=this,i=t.options.configuration.processviewerStage,r=t.options.configuration.processviewerImageStage;t.options.draggable&&t._setDraggable();n.when(t._createSVGProcessPool(),t._createSVGLanes(),t._createSVGMilestones(),t._createSVGSequenceFlows()).done(function(){t._createStyleFormats();t.options.isIE8||t._createMarkers();t._addHandlers();t._createSlider();t.options.hotSpotsSVG?t._createSVGHotSpots():n.when(t._createHTMLHotSpots()).done(function(){t._adjustLabelsPosition();var n={type:"pvComplete",message:"processviewer complete",time:new Date,ui:t.$el};t.element.trigger(n)})})},_createSlider:function(){var t=this,e=t.validateHTML5Features.checkInput("range"),i,r,u,f;n.support.touch||e?(n(".ui-for-desktop").remove(),i=n("input[type='range']"),i.attr("min",t.options.minZoom),i.attr("max",t.options.maxZoom),i.attr("step",.1),i.attr("value",1),n.support.touch&&t.options.device!=="desktop"?(i.change(function(){t._updateOutputSlider(this)}),i.bind("touchstart",function(){var i=n(this);i.prev("output").addClass("is-visible-output");t._updateOutputSlider(this)}),i.bind("touchend",function(){var i=n(this).val(),r=n(this);r.prev("output").removeClass("is-visible-output");t.options.configuration.processviewerPathsStageGroup.scale(i);t.options.configuration.processviewerHotSpotsContainer.css("font-size",i+"em");t._updateHotSpotsScale(i);t._updateOutputSlider(this)})):(i.mouseenter(function(){var i=n(this);i.prev("output").addClass("is-visible-output");t._updateOutputSlider(this)}).mouseleave(function(){var t=n(this);t.prev("output").removeClass("is-visible-output")}),i.change(function(i){var r,u;t._updateOutputSlider(this);r=n(this).val();t.options.configuration.processviewerPathsStageGroup.scale(r);t.options.configuration.processviewerHotSpotsContainer.css("font-size",r+"em");u=n(t.options.configuration.processviewerStage.defs);n(t.options.configuration.processviewerStage.canvas).append(u);t._updateHotSpotsScale(r);i.stopPropagation()}))):(n(".ui-for-touch").remove(),r=n(".processviewer-zvg-nested"),r.data("real-width",r.width()),r.data("real-height",r.height()),u=1,f=function(t,i){var r=i.value||u,f=Math.round(r*100)+"%",e='<div class="tooltip"><div class="tooltip-inner">'+f+"<\/div><\/div>";n(".sliderTooltip").html(e)},t.options.configuration.sliderOptions={min:t.options.minZoomIE8,max:t.options.maxZoomIE8,step:.1,value:u,create:f,slide:f,stop:function(n,i){i.value>1&&(r[0].setAttribute("width",r.data("real-width")*i.value),r[0].setAttribute("height",r.data("real-height")*i.value));t.options.configuration.processviewerPathsStageGroup.scale(i.value);t.options.configuration.processviewerHotSpotsContainer.css("font-size",i.value+"em");t._updateHotSpotsScale(i.value);t._setDraggable()}},n("[data-processviewerslider]",t.element).slider(t.options.configuration.sliderOptions))},_updateOutputSlider:function(t){var i=n(t);i.prev("output").text(Math.round(i.val()*100)+"%")},_updateHotSpotsScale:function(t){var e=this,u=e.options.configuration.hotspotsList,f,r;for(n("[data-processviewerhotspots]").hide(),f=n(".processviewer-hotspot-icon svg g"),f.each(function(){this.setAttribute("transform","scale("+t/10+")")}),r=0;r<u.length;r++){var i=n(u[r]),o=i.data("real-width")*t,s=i.data("real-height")*t,h=i.data("real-left")*t,c=i.data("real-top")*t;i.outerWidth(o);i.outerHeight(s);i.css("left",h);i.css("top",c)}n("[data-processviewerhotspots]").show()},_scaleSVG:function(){},_addHandlers:function(){var t=this;n(window).on("resize.processviewer",function(){t._setDraggable()})},_setDraggable:function(){var t=this,i,u,f;if(n.support.touch&&t.options.device!=="desktop"){var r=t.options.configuration.processviewerPathsStageGroup.getScale(),e=t.options.configuration.processviewerStage.canvas.getAttribute("width")*r,o=t.options.configuration.processviewerStage.canvas.getAttribute("height")*r;n(".processviewer-wrapper").addClass("ui-scroll-touch");n("[data-processviewercontainer]",t.element).width(e);n("[data-processviewercontainer]",t.element).height(o)}else if(t.options.configuration.$processviewerStage=n(t.options.configuration.processviewerStage.canvas).parent(),u=n("[data-processviewercontainer]",t.element).position(),u){var r=t.options.configuration.processviewerPathsStageGroup.getScale(),s=t.element.width(),h=t.element.height(),e=t.options.configuration.processviewerStage.width*r,o=t.options.configuration.processviewerStage.height*r;maxleft=u.left;maxTop=u.top;f=n("[data-processviewer-wrapper-container]",t.element).is(":ui-draggable");s<e||h<o?f||(t.$el.addClass(" processviewer-drag"),i=t._dragLimits(),t.options.configuration.$processviewerStage.draggable({refreshPositions:!0,drag:function(n,r){i=t._dragLimits();r.position.left>=0&&(r.position.left=0);r.position.top>=0&&(r.position.top=0);r.position.top<i.y&&(r.position.top=i.y);r.position.left<i.x&&(r.position.left=i.x)}})):f&&(t.options.configuration.$processviewerStage.draggable("destroy"),t.element.removeClass("processviewer-drag"),t.options.configuration.$processviewerStage.css({left:0,top:0}),t.options.configuration.processviewerHotSpotsContainer.css({left:0,top:0}))}},_dragLimits:function(){var n=this,t=n.options.configuration.processviewerPathsStageGroup.getScale(),i=n.element.width(),r=n.element.height(),u=n.options.configuration.processviewerStage.width*t,f=n.options.configuration.processviewerStage.height*t,e=0,o=0;return i<u&&(e=i-u),r<f&&(o=r-f),{x:e,y:o}},_movePaths:function(n,t){var i=this;i.options.configuration.processviewerStage.move(n,t)},_createMarkers:function(){var t=this,r=n.bizagi.processviewer.design.markers,i;if(r)for(i in r){var f=r[i].properties,e={id:i,css:i,markerHeight:10,markerWidth:10,refX:10,refY:5,orient:"auto"},u=t.options.configuration.processviewerStage.marker();n(u.node).attrSVG(e);n(u.node.lastElementChild).attrSVG(f);t.options.configuration.processviewerMarkerEndArrow||(t.options.configuration.processviewerMarkerEndArrow=[]);t.options.configuration.processviewerMarkerEndArrow.push(u)}},_createStyleFormats:function(){var e=this,u=e.options.formatStyles,f=n("<div><\/div>"),t="<style>",i,r;for(i in u)r="."+i.toLowerCase()+"{",f.css(u[i].css),r+=f.attr("style")+"}",t+=r;t+="<\/style>";n("head").append(n(t))},_asignLabelFormat:function(t,i){var o=this,f,e,r,u;if(i.bpmnLabel&&i.bpmnLabel.labelStyle)for(f=i.bpmnLabel.labelStyle,e=o.options.formatStyles[f],n(t).closest("svg").length>0&&n(t).css(e.css),r=e.cssClass,r.push(f),u=0;u<r.length;u++)n(t).addClass(r[u].toLowerCase())},_createSVGProcessPool:function(){for(var n=this,i=[],r=n.options.configuration.processviewerPathsStageGroup,t=n.options.hotspots.length-1;t>=0;t--)n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.PROCESS&&(i.push(n.options.hotspots[t]),n.options.hotspots.splice(t,1));n._createSVGRect(r,i,"processPool")},_createSVGLanes:function(){for(var n=this,i=[],r=n.options.configuration.processviewerPathsStageGroup,t=n.options.hotspots.length-1;t>=0;t--)n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.LANE&&(i.push(n.options.hotspots[t]),n.options.hotspots.splice(t,1));n._createSVGRect(r,i,"lanes")},_createSVGMilestones:function(){for(var n=this,i=[],r=n.options.configuration.processviewerPathsStageGroup,t=n.options.hotspots.length-1;t>=0;t--)n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.MILESTONES&&(i.push(n.options.hotspots[t]),n.options.hotspots.splice(t,1));n._createSVGRect(r,i,"milestones")},_createSVGSequenceFlows:function(){for(var n=this,i=[],r=n.options.configuration.processviewerPathsStageGroup,t=n.options.hotspots.length-1;t>=0;t--)(n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.SEQUENCEFLOW||n.options.hotspots[t].elementType===n.constants.ELEMENT_TYPE.ASSOCIATION)&&n.options.hotspots[t].hasOwnProperty(n.constants.PROPERTIES.WAYPOINTS)&&(i.push(n.options.hotspots[t]),n.options.hotspots[t].conditionType===n.constants.CONDITION_TYPE.NORMAL&&n.options.hotspots.splice(t,1));n._createSVGPaths(r,i)},_createSVGRect:function(t,i){for(var r,e,o,d,g,a,u=this,f,s=0;s<i.length;s++)if(r=i[s],r[u.constants.PROPERTIES.BOUNDS]===undefined)console.log(r);else{if(e=r[u.constants.PROPERTIES.BOUNDS],o=t.rect(e.x,e.y,e.width,e.height),r.bpmnElementRef?o[0].setAttribute("id",r.bpmnElementRef):r.bpmnElement&&r.bpmnElement.baref&&r.bpmnElement.baref.ref&&o[0].setAttribute("id",r.bpmnElement.baref.ref),r.displayName===""&&(r.displayName="Lane"),r.displayName&&(f=t.text(e.height/-2,10,r.displayName)),r.elementType===u.constants.ELEMENT_TYPE.PROCESS&&(f.attr({"font-weight":"600",y:r.bounds.y+e.height/2,x:10}).data("rotation",-90),f.transform("r-90")),r.elementType===u.constants.ELEMENT_TYPE.MILESTONES){f.attr({"font-weight":"600",y:r.bounds.y+16,x:r.bounds.x+e.width/2});o.attr("height",u.options.milestonesHeight);var h=r.bounds.x+r.bounds.width,v=r.bounds.y+u.options.milestonesHeight,y=r.bounds.height,p=u._getPathString([{x:h,y:v},{x:h,y:y}]),w=t.path(p);w.attr({stroke:"#CCC","stroke-dasharray":"--"});var c=h-1,b=u._getPathString([{x:c,y:r.bounds.y},{x:c+u.options.milestonesHeight,y:u.options.milestonesHeight/2},{x:c,y:u.options.milestonesHeight}]),k=t.path(b);k.attr({stroke:"#CCC",fill:"#FFF"})}if(r.elementType===u.constants.ELEMENT_TYPE.LANE){d=n(f.node).width()/2+r.bounds.height/2;g=n(f.node).height();f.attr({y:r.bounds.y+r.bounds.height/2,x:r.bounds.x+10,"font-weight":"600"}).data("rotation",-90);f.transform("r-90");var l=r.bounds.x+30,nt=r.bounds.height,tt=u._getPathString([{x:l,y:r.bounds.y+25},{x:l,y:nt}]),it=t.path(tt);it.attr({stroke:"#E6E6E6",fill:"none"})}a=n(o[0]);a.attr("id")&&r.displayName&&n(f[0]).data("id",r.id);o.attr({stroke:"#E6E6E6",fill:"none"});u._asignLabelFormat(f[0],r)}},_createSVGPaths:function(t,i){for(var r,e,s,f,c,h,l,u=this,o=0;o<i.length;o++)r=i[o],r[u.constants.PROPERTIES.WAYPOINTS]===undefined?console.log(r):(e=!1,r.elementType!==u.constants.ELEMENT_TYPE.TEXTANNOTATION&&r.conditionType!==u.constants.CONDITION_TYPE.RELATION&&r.conditionType!==u.constants.CONDITION_TYPE.COMPENSATION&&(e=!0),s=u._getPathString(r[u.constants.PROPERTIES.WAYPOINTS]),s+=u.options.isIE8&&e?u._getArrowPathString(r[u.constants.PROPERTIES.WAYPOINTS]):"",f=t.path(s),r.bpmnElementRef?f[0].setAttribute("id",r.bpmnElementRef):r.bpmnElement&&r.bpmnElement.baref&&r.bpmnElement.baref.ref&&f[0].setAttribute("id",r.bpmnElement.baref.ref),e&&n(f.node).setMarkerSVG("normal"),c=f.getTotalLength()/2,h=f.getPointAtLength(c),r.displayName&&(nText=t.text(h.x,h.y,r.displayName)),l=n(f[0]),l.attr("id")&&r.displayName&&n(nText[0]).data("id",r.id),(r.conditionType===u.constants.CONDITION_TYPE.RELATION||r.conditionType===u.constants.CONDITION_TYPE.COMPENSATION)&&f.attr({"stroke-dasharray":".","stroke-width":"2"}),u._asignLabelFormat(f[0],r))},_createHTMLHotSpots:function(){for(var r,f,t=this,o=[],e=t.options.hotspots,i=t.options.configuration.processviewerHotSpotsContainer=n('<div class="processviewer-hotspots-container" data-processviewerhotspots style="position:absolute;"><\/div>'),u=0;u<e.length;u++)r=e[u],(r.bounds||r.x)&&(r.number=u,f=t._createHotSpotDiv(r),o.push(f),i.append(f));n("[data-processviewer-wrapper-container]",t.element).prepend(i);i.on("click",".processviewer-hotspot",function(i){var r=n(this).data("number"),u=n(this);if(t.options.hotspots[r].onClick)t.options.hotspots[r].onClick(i,u);t._triggers.click.apply(u,[t.element])});i.on("mouseenter",".processviewer-hotspot",function(i){var r=n(this).data("number"),u=n(this);if(t.options.hotspots[r].onMouseOver)t.options.hotspots[r].onMouseOver(i,u);t._triggers.onMouseOver.apply(u,[t.element])});i.on("mouseout",".processviewer-hotspot",function(i){var r=n(this).data("number"),u=n(this);if(t.options.hotspots[r].onMouseOut)t.options.hotspots[r].onMouseOut(i,u);t._triggers.onMouseOut.apply(u,[t.element])});t.options.configuration.hotspotsList=n(".processviewer-hotspot")},_createHotSpotDiv:function(t){var u=this,i=n('<div class="processviewer-hotspot processviewer-hotspot-div" data-processviewerhotspot><\/div>'),r=n('<div class="processviewer-hotspot-label" data-processviewerlabel><\/div>'),f=u._getHotSpotData(t);return i.outerWidth(f.w),i.outerHeight(f.h),i.css("left",f.x+"px"),i.css("top",f.y+"px"),i.data("number",t.number),i.attr("number",t.number),t.bounds&&(i.data("real-width",t.bounds.width),i.data("real-height",t.bounds.height),i.data("real-left",t.bounds.x),i.data("real-top",t.bounds.y)),t.displayName&&t.elementType!==u.constants.ELEMENT_TYPE.SEQUENCEFLOW&&(r.text(t.displayName),i.append(r)),t.elementType&&u._createIconsForHotSpots(i,t),t.text&&t.text.content&&(r.text(t.text.content),i.append(r)),t.dataState&&t.dataState.displayName&&(r.text(t.dataState.displayName),i.append(r)),t.radius&&i.css("border-radius",t.radius),t.css&&i.addClass(t.css),t.loopCharacteristics&&(t.loopCharacteristics.isSequential?i.addClass("issequential"):t.loopCharacteristics.isSequential||i.addClass("isparallel")),u._asignLabelFormat(r[0],t),t.elementType&&i.addClass(t.elementType.toLowerCase()),t.conditionType&&i.addClass(t.conditionType.toLowerCase()),t.eventType&&i.addClass(t.eventType.toLowerCase()),t.subProcessType&&i.addClass(t.subProcessType.toLowerCase()),t.isForCompensation&&i.addClass("isforcompensation"),t.bpmnElementRef?i.attr("id",t.bpmnElementRef):t.bpmnElement&&t.bpmnElement.baref&&t.bpmnElement.baref.ref&&i.attr("id",t.bpmnElement.baref.ref),t.content&&i.append(t.content),i},_createIconsForHotSpots:function(t,i){var w=this,s=i.elementType.toLowerCase(),h=n('<div class="processviewer-hotspot-icon" data-processviewericon><\/div>'),f,u,o;if(t.append(h),n.bizagi.processviewer.design.icons){var r=n.bizagi.processviewer.design.icons.scale,l=n.bizagi.processviewer.design.icons.bounds.width*r,a=n.bizagi.processviewer.design.icons.bounds.height*r,v=new Raphael(h[0],l,a),c=v.group();if(i.isForCompensation&&(s="isforcompensation"),f=n.bizagi.processviewer.design.icons.iconset[s],f)for(svgTmp=f.svg,u=0;u<svgTmp.length;u++){var e=svgTmp[u],y=e.type,p=c[y]();r<1&&c.node.setAttribute("transform","scale("+r+")");for(o in e.properties)p[0].setAttribute(o,e.properties[o])}}},_getPathString:function(n){for(var r=this,i="",t=0;t<n.length;t++)t===0&&(i+="M"),t>0&&(i+="L"),i+=n[t].x+",",i+=n[t].y+",";return i},_getArrowPathString:function(n){var r=n[n.length-1],u=n[n.length-2],s=u.x,t=r.x,h=u.y,i=r.y,f=Raphael.angle(t,i,s,h),e=Raphael.rad(f-135),o=Raphael.rad(f+135),c=t+Math.cos(e)*10,l=i+Math.sin(e)*10,a=t+Math.cos(o)*10,v=i+Math.sin(o)*10;return"M"+t+","+i+",L"+c+","+l+",M"+t+","+i+",L"+a+","+v},_getHotSpotData:function(n){var t={x:0,y:0,w:0,h:0};return n.x?t.x=n.x:n.bounds.x&&(t.x=n.bounds.x),n.y?t.y=n.y:n.bounds.y&&(t.y=n.bounds.y),n.w?t.w=n.w:n.bounds.width&&(t.w=n.bounds.width),n.h?t.h=n.h:n.bounds.height&&(t.h=n.bounds.height),t},_createSVGHotSpots:function(){for(var n,i,u,f,t=this,e=t.options.hotspots,r=0;r<e.length;r++)n=e[r],i=t.options.configuration.processviewerStage.rect(n.x,n.y,50,50),i.id=n.id,typeof n.onClick=="function"?i.click(n.onClick):i.click(t._triggers.click),u=t._triggers.onMouseOver,f=t._triggers.onMouseOut,typeof n.onMouseOver=="function"&&(u=n.onMouseOver),typeof n.onMouseOut=="function"&&(f=n.onMouseOut),i.hover(u,f),i.node.id=n.id,i.node["class"]=n.css,t.options.configuration.processviewerstageHotSpotSet.push(i);t.options.configuration.processviewerStageSet.push(t.options.configuration.processviewerstageHotSpotSet)},_triggers:{click:function(t){var i={type:"pvClick",message:"hotspot clicked",time:new Date,ui:{control:this,id:n(this).attr("id")}};t.trigger(i)},onMouseOver:function(t){var i={type:"pvMouseIn",message:"hotspot mouse in",time:new Date,ui:{control:this,id:n(this).attr("id")}};t.trigger(i)},onMouseOut:function(t){var i={type:"pvMouseOut",message:"hotspot mouse out",time:new Date,ui:{control:this,id:n(this).attr("id")}};t.trigger(i)},error:function(t){var r=this,i={type:"pvError",time:new Date};n.extend(t,i);n.event.trigger(t)}},_createUIFailView:function(t){var i=this,r=n('<div class="'+i.options.configuration.errorImageCSS+' svg-error-content"><div class="processviewer-absolute-center"><img src="'+i.options.unavailableImage+'" class="processviewer-absolute-center"/><\/div><span class="processviewer-message">'+t+"<\/span><\/div>");n("[data-processviewercontainer]",i.element).append(r)},_verifyingImage:function(t){var u=this,r=n.Deferred(),i=document.createElement("img");return i.onload=function(){r.resolve(i)},i.onerror=function(){r.reject(t)},i.src=t,r.promise()},_getStageContainer:function(){var t=this;return n("[data-processviewer-wrapper-container]",t.element)[0]},_generateID:function(){var r=this,t=(new Date).getTime(),i="processviewer-xxxxxxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?i:i&7|8).toString(16)});return n("#"+i).length>0?r._generateID():i},_adjustLabelsPosition:function(){for(var e,f=this,i=n(".processviewer-hotspot-label",f.element),s=i.closest(".processviewer-hotspot"),r=0;r<i.length;r++){var u=n(i[r]),t=u.closest(".processviewer-hotspot"),o=t.outerHeight();t.hasClass("subprocess")||t.hasClass("callactivity")||t.hasClass("dataobject")?(e=n._ptToem(o+10),u.css({paddingTop:e})):f.options.isIE8&&u.css({paddingTop:"1.8em"})}},_setOption:function(n,t){this.options[n]=t;this._update()},_update:function(){var n=this.options.value+"%";this.element.text(n);this.options.value===100&&this._trigger("complete",null,{value:100})},_destroy:function(){this.element.empty().removeAttr("style","").removeAttr("role","");clearInterval(this.options.animation.interval)},_getSelectedClassCSSByWorkitemState:function(n,t){var f=this,i,u,r;return t&&t.filter&&(i=t.filter(function(t){return t.guidTask===n})),u=i&&i.length>0&&i[0].wiState==14,r="processviewer-shape-selected",u&&(r="processviewer-shape-selected-standby"),r},selectShape:function(t,i){for(var r,e,s,o=this,f=n.isArray(t)?t:[t],u=0,h=f.length;u<h;u++)r=n("#"+f[u],o.$el),r.length&&(e=o._getSelectedClassCSSByWorkitemState(f[u],i),s=r.prop("tagName").toLowerCase(),s!=="div"?(r.addClassSVG(e),r.setMarkerSVG("selected")):r.addClass(e))},unSelectShape:function(t,i){for(var e=this,f=n.isArray(t)?t:[t],r=0,s=f.length;r<s;r++){var u=n("#"+f[r],e.$el),h=u.prop("tagName").toLowerCase(),o=e._getSelectedClassCSSByWorkitemState(f[r],i);h!=="div"?(u.removeClassSVG(o),u.reverseMarkerSVG()):u.removeClass(o)}},unSelectAllShapes:function(){for(var t,u,f=this,r=n(".processviewer-shape-selected",f.$el),i=0;i<r.length;i++)t=n(r[i]),u=t.prop("tagName").toLowerCase(),u!=="div"?(t.removeClassSVG("processviewer-shape-selected"),t.reverseMarkerSVG()):t.removeClass("processviewer-shape-selected")},drawRoute:function(t){for(var i,e,u=this,f=[],r=0;r<t.length;r++)i=n("#"+t[r],u.$el),i.length>0?(e=i.prop("tagName").toLowerCase(),e!=="div"?(i.addClassSVG("processviewer-highlighted"),i.setMarkerSVG("highlighted")):i.addClass("processviewer-highlighted")):f.push(t[r]);u._triggers.error({message:"Doesn't find element",ui:f})},animateRoute:function(t){var i=this,r=i.option.counter;n.isArray(t)&&(i.options.animation.counter=0,i.options.animation.path=t,i.options.animation.status=0);i.options.animation.status===0?i._startRouteAnimation():i._stopRouteAnimation()},_startRouteAnimation:function(){var t=this,i=t.options.animation.path;t.options.animation.status=1;t.options.animation.counter===0&&t.clearRoute();t.options.animation.interval=setInterval(function(){var r,u;t.options.animation.counter<i.length?(r=n("[id="+i[t.options.animation.counter]+"]",t.$el).last(),r.length>0&&(u=r.prop("tagName").toLowerCase(),u!=="div"?(r.addClassSVG("processviewer-highlighted"),r.setMarkerSVG("highlighted"),r[0].strokecolor="#FF7F00"):r.addClass("processviewer-highlighted")),t.options.animation.counter++):(t.element.trigger({type:"animationComplete",message:"animation end!",time:new Date,ui:t.$el}),t.options.animation.counter=0,t._stopRouteAnimation())},t.options.animation.time)},_stopRouteAnimation:function(){var n=this;n.options.animation.status=0;clearInterval(n.options.animation.interval)},_isInWorkportal:function(){var n=!1;return typeof bizagi!="undefined"&&typeof bizagi.workportal!="undefined"&&(n=!0),n},clearRoute:function(){for(var t,u,f=this,r=n(".processviewer-highlighted",f.$el),i=0;i<r.length;i++)t=n(r[i]),u=t.prop("tagName").toLowerCase(),u!=="div"?(t.removeClassSVG("processviewer-highlighted"),t[0].strokecolor="#000",t.reverseMarkerSVG()):t.removeClass("processviewer-highlighted")},validateHTML5Features:{checkInput:function(n){var t=document.createElement("input");return t.setAttribute("type",n),t.type==n}}});n.fn.addClassSVG=function(t){var i=arguments[0];return t=n.extend({},n.fn.addClassSVG.config,t),this.each(function(){var t=this,n=t.getAttribute("class"),r="";n===null&&(n="");typeof i=="string"&&n.indexOf(i)===-1&&(r=n+" "+i,t.setAttribute("class",r))})};n.fn.addClassSVG.config={};n.fn.setMarkerSVG=function(t){var i="url(#"+arguments[0]+")";return t=n.extend({},n.fn.addClassSVG.config,t),this.each(function(){var n=this,t=n.getAttribute("marker-end");t!=i&&(n.setAttribute("marker-end",i),n.setAttribute("toggle-marker-end",t))})};n.fn.reverseMarkerSVG=function(){return this.each(function(){var n=this,i=n.getAttribute("marker-end"),t=n.getAttribute("toggle-marker-end");t!==null&&i!==null&&(n.setAttribute("marker-end",t),n.removeAttribute("toggle-marker-end"))})};n.fn.removeClassSVG=function(t){var i=arguments[0];return t=n.extend({},n.fn.addClassSVG.config,t),this.each(function(){var t=this,n=t.getAttribute("class"),r="";n!==null&&typeof i=="string"&&n.indexOf(i)!==-1&&(r=n.replace(i,"").replace("  "," "),t.setAttribute("class",r))})};n.fn.removeClassSVG.config={};n.fn.hasClassSVG=function(){var n=arguments[0],r=this[0],t=r.getAttribute("class"),i=!1;return t!==null&&typeof n=="string"&&t.indexOf(n)!==-1&&(i=!0),i};n.fn.attrSVG=function(n){var t=this[0];for(var i in n)t.setAttribute(i,n[i]);return t};n._ptToem=function(n,t){return t||(t=12),n/t+"em"}})(jQuery);
(function(n){n.fn.processviewerQueries=function(){this.css("color","green");var t=this;return t.data=this[0],t.internalDataSource={elements:[]},t.datasource={hotspots:[],formatStyles:[]},t.deferred=n.Deferred(),t.padding=80,t.typeDefinitions=n.bizagi.processviewer.configuration.validTypeDefinitions,t.constants=n.bizagi.processviewer.configuration.constants,this.methods={init:function(){var t=this,i=n.Deferred();return t.typeDefinitions.unshift("owner"),t.data.definition.owner={processType:t.data.definition.processType,elementType:t.data.definition.elementType,displayName:t.data.definition.displayName,id:t.data.definition.id},n.when(t.methods.processElements.apply(t,[])).done(function(){i.resolve(t.datasource)}),i.promise()},processElements:function(){var t=this,i=[],u,f,o,r,s,e,h;for(u in t.data.definition)f=t.data.definition[u],t.methods.validateKindObject.apply(t,[u])&&(u===t.constants.LANESETS?f&&(o=t.methods.getLanesFromLaneSet.apply(t,[f]),i=i.concat(o)):i=i.concat(f));for(t.internalDataSource.elements=t.internalDataSource.elements.concat(i),r=0;r<t.internalDataSource.elements.length;r++)s=t.internalDataSource.elements[r].id,e=t.methods.getElementGraphicDataById.apply(t,[s]),e&&(h=n.extend({},e,t.internalDataSource.elements[r]),t.datasource.hotspots.push(h));t.datasource.dimentions=t.methods._getMaxDimentions.apply(t,[]);t.datasource.formatStyles=t.methods.getStylesFormat.apply(t,[])},getStylesFormat:function(){var i=this,u,f={},r,t,e;if(i.data.graphics[i.constants.BPMNLABELSTYLES])for(u=i.data.graphics[i.constants.BPMNLABELSTYLES],r=0;r<u.length;r++)t=u[r],e=t.font.size?n._ptToem(t.font.size):"1em",f[t.id]={css:{fontFamily:t.font.name||"Arial",fontSize:e,fontWeight:t.font.isBold?"bold":"normal",fontStyle:t.font.isItalic?"italic":"normal",color:t.font.color||"Black"},cssClass:["alignment-"+t.alignment]};return f},_getMaxDimentions:function(){var n=this,u=0,o=0,r=[],f,e,t,i;for(f in n.data.definition)e=n.data.definition[f],f===n.constants.LANESETS&&e&&(r=n.methods.getLanesFromLaneSet.apply(n,[e]));for(i=0;i<r.length;i++)r[i].id&&(t=n.methods.getElementGraphicDataById.apply(n,[r[i].id])),typeof t=="object"&&(u<t.bounds.width&&(u=t.bounds.width+n.padding),o+=t.bounds.height+n.padding);return{width:u,height:o}},_ptToEM:function(n){return n/t.pixelFontSize},getElementGraphicDataById:function(n){for(var r,u=this,i=u.data.graphics.bpmnPlane.diagramElements,f,t=0;t<i.length;t++)if(r=u.methods.hasReferenceId(i[t]),r&&(localID=r,localID===n)){f=i[t];break}return f},getLanesFromLaneSet:function(n){for(var r=this,t=[],i=0;i<n.length;i++)t=t.concat(n[i].lanes);return t},validateKindObject:function(n){for(var i=this,r=!1,t=0;t<i.typeDefinitions.length;t++)if(i.typeDefinitions[t]===n){r=!0;break}return r},hasReferenceId:function(n){var i=this,t=!1;return n.bpmnElement?n.bpmnElement.baref&&n.bpmnElement.baref.ref&&(t=n.bpmnElement.baref.ref):n.bpmnElementRef&&(t=n.bpmnElementRef),t}},this.methods.init.apply(this,[])}})(jQuery),function(n){function t(n,t){if(!(n.originalEvent.touches.length>1)){n.preventDefault();var i=n.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null);n.target.dispatchEvent(r)}}if(n.support.touch="ontouchend"in document,n.support.touch){var i=n.ui.mouse.prototype,u=i._mouseInit,r;i._touchStart=function(n){var i=this;!r&&i._mouseCapture(n.originalEvent.changedTouches[0])&&(r=!0,i._touchMoved=!1,t(n,"mouseover"),t(n,"mousemove"),t(n,"mousedown"))};i._touchMove=function(n){r&&(this._touchMoved=!0,t(n,"mousemove"))};i._touchEnd=function(n){r&&(t(n,"mouseup"),t(n,"mouseout"),this._touchMoved||t(n,"click"),r=!1)};i._mouseInit=function(){var t=this;t.element.bind("touchstart",n.proxy(t,"_touchStart")).bind("touchmove",n.proxy(t,"_touchMove")).bind("touchend",n.proxy(t,"_touchEnd"));u.call(t)}}}(jQuery);
(function(n){var o="0.4.2",e="hasOwnProperty",f=/[\.\/]/,s="*",h=function(){},c=function(n,t){return n-t},r,i,u={n:{}},t=function(n,f){var o,p;n=String(n);var k=u,w=i,v=Array.prototype.slice.call(arguments,2),s=t.listeners(n),a=0,e,l=[],y={},h=[],b=r;for(r=n,i=0,o=0,p=s.length;o<p;o++)"zIndex"in s[o]&&(l.push(s[o].zIndex),s[o].zIndex<0&&(y[s[o].zIndex]=s[o]));for(l.sort(c);l[a]<0;)if(e=y[l[a++]],h.push(e.apply(f,v)),i)return i=w,h;for(o=0;o<p;o++)if(e=s[o],"zIndex"in e)if(e.zIndex==l[a]){if(h.push(e.apply(f,v)),i)break;do if(a++,e=y[l[a]],e&&h.push(e.apply(f,v)),i)break;while(e)}else y[e.zIndex]=e;else if(h.push(e.apply(f,v)),i)break;return i=w,r=b,h.length?h:null};t._events=u;t.listeners=function(n){for(var a=n.split(f),t=u,i,v,o,e,p,h,c=[t],l=[],r=0,y=a.length;r<y;r++){for(h=[],e=0,p=c.length;e<p;e++)for(t=c[e].n,v=[t[a[r]],t[s]],o=2;o--;)i=v[o],i&&(h.push(i),l=l.concat(i.f||[]));c=h}return l};t.on=function(n,t){var e,i,r,o;if(n=String(n),typeof t!="function")return function(){};for(e=n.split(f),i=u,r=0,o=e.length;r<o;r++)i=i.n,i=i.hasOwnProperty(e[r])&&i[e[r]]||(i[e[r]]={n:{}});for(i.f=i.f||[],r=0,o=i.f.length;r<o;r++)if(i.f[r]==t)return h;return i.f.push(t),function(n){+n==+n&&(t.zIndex=+n)}};t.f=function(n){var i=[].slice.call(arguments,1);return function(){t.apply(null,[n,null].concat(i).concat([].slice.call(arguments,0)))}};t.stop=function(){i=1};t.nt=function(n){return n?new RegExp("(?:\\.|\\/|^)"+n+"(?:\\.|\\/|$)").test(r):r};t.nts=function(){return r.split(f)};t.off=t.unbind=function(n,i){var a,r,h,v,c,p,o,w,l,y;if(!n){t._events=u={n:{}};return}for(a=n.split(f),l=[u],c=0,p=a.length;c<p;c++)for(o=0;o<l.length;o+=v.length-2){if(v=[o,1],r=l[o].n,a[c]!=s)r[a[c]]&&v.push(r[a[c]]);else for(h in r)r[e](h)&&v.push(r[h]);l.splice.apply(l,v)}for(c=0,p=l.length;c<p;c++)for(r=l[c];r.n;){if(i){if(r.f){for(o=0,w=r.f.length;o<w;o++)if(r.f[o]==i){r.f.splice(o,1);break}r.f.length||delete r.f}for(h in r.n)if(r.n[e](h)&&r.n[h].f){for(y=r.n[h].f,o=0,w=y.length;o<w;o++)if(y[o]==i){y.splice(o,1);break}y.length||delete r.n[h].f}}else{delete r.f;for(h in r.n)r.n[e](h)&&r.n[h].f&&delete r.n[h].f}r=r.n}};t.once=function(n,i){var r=function(){return t.unbind(n,r),i.apply(this,arguments)};return t.on(n,r)};t.version=o;t.toString=function(){return"You are running Eve "+o};typeof module!="undefined"&&module.exports?module.exports=t:n.eve=t})(this),function(n,t){t(n,n.eve)}(this,function(n,t){function i(n){var r,u;return i.is(n,"function")?yi?n():t.on("raphael.DOMload",n):i.is(n,tt)?i._engine.create[v](i,n.splice(0,3+i.is(n[0],p))).add(n):(r=Array.prototype.slice.call(arguments,0),i.is(r[r.length-1],"function")?(u=r.pop(),yi?u.call(i._engine.create[v](i,r)):t.on("raphael.DOMload",function(){u.call(i._engine.create[v](i,r))})):i._engine.create[v](i,arguments))}function pt(n){var i,t;if(typeof n=="function"||Object(n)!==n)return n;i=new n.constructor;for(t in n)n[a](t)&&(i[t]=pt(n[t]));return i}function lu(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return n.push(n.splice(i,1)[0])}function it(n,t,i){function r(){var o=Array.prototype.slice.call(arguments,0),u=o.join("␀"),f=r.cache=r.cache||{},e=r.count=r.count||[];return f[a](u)?(lu(e,u),i?i(f[u]):f[u]):(e.length>=1e3&&delete f[e.shift()],e.push(u),f[u]=n[v](t,o),i?i(f[u]):f[u])}return r}function dt(){return this.hex}function hr(n,t){for(var i,f=[],r=0,u=n.length;u-2*!t>r;r+=2)i=[{x:+n[r-2],y:+n[r-1]},{x:+n[r],y:+n[r+1]},{x:+n[r+2],y:+n[r+3]},{x:+n[r+4],y:+n[r+5]}],t?r?u-4==r?i[3]={x:+n[0],y:+n[1]}:u-2==r&&(i[2]={x:+n[0],y:+n[1]},i[3]={x:+n[2],y:+n[3]}):i[0]={x:+n[u-2],y:+n[u-1]}:u-4==r?i[3]=i[2]:r||(i[0]={x:+n[r],y:+n[r+1]}),f.push(["C",(-i[0].x+6*i[1].x+i[2].x)/6,(-i[0].y+6*i[1].y+i[2].y)/6,(i[1].x+6*i[2].x-i[3].x)/6,(i[1].y+6*i[2].y-i[3].y)/6,i[2].x,i[2].y]);return f}function cr(n,t,i,r,u){var f=-3*t+9*i-9*r+3*u,e=n*f+6*t-12*i+6*r;return n*e-3*t+3*i}function lt(n,t,i,r,f,e,o,s,h){var c;h==null&&(h=1);h=h>1?1:h<0?0:h;var l=h/2,w=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],b=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],a=0;for(c=0;c<12;c++){var v=l*w[c]+l,y=cr(v,n,i,f,o),p=cr(v,t,r,e,s),k=y*y+p*p;a+=b[c]*u.sqrt(k)}return l*a}function au(n,t,i,r,u,f,e,o,s){if(!(s<0)&&!(lt(n,t,i,r,u,f,e,o)<s)){for(var a=1,l=a/2,h=a-l,c=lt(n,t,i,r,u,f,e,o,h);y(c-s)>.01;)l/=2,h+=(c<s?1:-1)*l,c=lt(n,t,i,r,u,f,e,o,h);return h}}function vu(n,t,i,r,u,f,e,s){if(!(o(n,i)<l(u,e))&&!(l(n,i)>o(u,e))&&!(o(t,r)<l(f,s))&&!(l(t,r)>o(f,s))){var p=(n*r-t*i)*(u-e)-(n-i)*(u*s-f*e),w=(n*r-t*i)*(f-s)-(t-r)*(u*s-f*e),a=(n-i)*(f-s)-(t-r)*(u-e);if(a){var v=p/a,y=w/a,h=+v.toFixed(2),c=+y.toFixed(2);if(!(h<+l(n,i).toFixed(2))&&!(h>+o(n,i).toFixed(2))&&!(h<+l(u,e).toFixed(2))&&!(h>+o(u,e).toFixed(2))&&!(c<+l(t,r).toFixed(2))&&!(c>+o(t,r).toFixed(2))&&!(c<+l(f,s).toFixed(2))&&!(c>+o(f,s).toFixed(2)))return{x:v,y:y}}}}function ai(n,t,r){var ut=i.bezierBBox(n),ft=i.bezierBBox(t),u,h,c,d,g;if(!i.isBBoxIntersect(ut,ft))return r?0:[];var et=lt.apply(0,n),ot=lt.apply(0,t),p=o(~~(et/5),1),w=o(~~(ot/5),1),nt=[],tt=[],rt={},it=r?0:[];for(u=0;u<p+1;u++)h=i.findDotsAtSegment.apply(i,n.concat(u/p)),nt.push({x:h.x,y:h.y,t:u/p});for(u=0;u<w+1;u++)h=i.findDotsAtSegment.apply(i,t.concat(u/w)),tt.push({x:h.x,y:h.y,t:u/w});for(u=0;u<p;u++)for(c=0;c<w;c++){var e=nt[u],a=nt[u+1],s=tt[c],v=tt[c+1],b=y(a.x-e.x)<.001?"y":"x",k=y(v.x-s.x)<.001?"y":"x",f=vu(e.x,e.y,a.x,a.y,s.x,s.y,v.x,v.y);if(f){if(rt[f.x.toFixed(4)]==f.y.toFixed(4))continue;rt[f.x.toFixed(4)]=f.y.toFixed(4);d=e.t+y((f[b]-e[b])/(a[b]-e[b]))*(a.t-e.t);g=s.t+y((f[k]-s[k])/(v[k]-s[k]))*(v.t-s.t);d>=0&&d<=1.001&&g>=0&&g<=1.001&&(r?it++:it.push({x:f.x,y:f.y,t1:l(d,1),t2:l(g,1)}))}}return it}function vi(n,t,r){var e,o,s,h,b,k,d,g,c,l,y,p,nt,a,w,tt,v,u,f,it;for(n=i._path2curve(n),t=i._path2curve(t),y=r?0:[],p=0,nt=n.length;p<nt;p++)if(a=n[p],a[0]=="M")e=b=a[1],o=k=a[2];else for(a[0]=="C"?(c=[e,o].concat(a.slice(1)),e=c[6],o=c[7]):(c=[e,o,e,o,b,k,b,k],e=b,o=k),w=0,tt=t.length;w<tt;w++)if(v=t[w],v[0]=="M")s=d=v[1],h=g=v[2];else if(v[0]=="C"?(l=[s,h].concat(v.slice(1)),s=l[6],h=l[7]):(l=[s,h,s,h,d,g,d,g],s=d,h=g),u=ai(c,l,r),r)y+=u;else{for(f=0,it=u.length;f<it;f++)u[f].segment1=p,u[f].segment2=w,u[f].bez1=c,u[f].bez2=l;y=y.concat(u)}return y}function st(n,t,i,r,u,f){n!=null?(this.a=+n,this.b=+t,this.c=+i,this.d=+r,this.e=+u,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function lr(){return this.x+at+this.y+at+this.width+" × "+this.height}function yu(n,t,i,r,u,f){function h(n){return((c*n+o)*n+e)*n}function a(n,t){var i=v(n,t);return((p*i+l)*i+s)*i}function v(n,t){for(var r,u,f,s,i=n,l=0;l<8;l++){if(f=h(i)-n,y(f)<t)return i;if(s=(3*c*i+2*o)*i+e,y(s)<1e-6)break;i=i-f/s}if(r=0,u=1,i=n,i<r)return r;if(i>u)return u;while(r<u){if(f=h(i),y(f-n)<t)return i;n>f?r=i:u=i;i=(u-r)/2+r}return i}var e=3*t,o=3*(r-t)-e,c=1-e-o,s=3*i,l=3*(u-i)-s,p=1-s-l;return a(n,1/(200*f))}function ft(n,t){var i=[],u={},r;if(this.ms=t,this.times=1,n){for(r in n)n[a](r)&&(u[h(r)]=n[r],i.push(h(r)));i.sort(ef)}this.anim=u;this.top=i[i.length-1];this.percents=i}function wt(n,r,u,e,o,c){var nt,v,et,l,at,dt,ii,tt,vt,gt,yt,d,rt,ht,ct,ni,ft,lt;u=h(u);var it,ot,pt,ti,wt,kt,w=n.ms,y={},g={},k={};if(e){for(v=0,et=f.length;v<et;v++)if(nt=f[v],nt.el.id==r.id&&nt.anim==n){nt.percent!=u?(f.splice(v,1),pt=1):ot=nt;r.attr(nt.totalOrigin);break}}else e=+g;for(v=0,et=n.percents.length;v<et;v++)if(n.percents[v]==u||n.percents[v]>e*n.top){u=n.percents[v];wt=n.percents[v-1]||0;w=w/n.top*(u-wt);ti=n.percents[v+1];it=n.anim[u];break}else e&&r.attr(n.anim[n.percents[v]]);if(it){if(ot)ot.initstatus=e,ot.start=new Date-ot.ms*e;else{for(l in it)if(it[a](l)&&(ki[a](l)||r.paper.customAttributes[a](l))){y[l]=r.attr(l);y[l]==null&&(y[l]=nf[l]);g[l]=it[l];switch(ki[l]){case p:k[l]=(g[l]-y[l])/w;break;case"colour":y[l]=i.getRGB(y[l]);at=i.getRGB(g[l]);k[l]={r:(at.r-y[l].r)/w,g:(at.g-y[l].g)/w,b:(at.b-y[l].b)/w};break;case"path":for(dt=bt(y[l],g[l]),ii=dt[1],y[l]=dt[0],k[l]=[],v=0,et=y[l].length;v<et;v++)for(k[l][v]=[0],tt=1,vt=y[l][v].length;tt<vt;tt++)k[l][v][tt]=(ii[v][tt]-y[l][v][tt])/w;break;case"transform":if(gt=r._,yt=pf(gt[l],g[l]),yt)for(y[l]=yt.from,g[l]=yt.to,k[l]=[],k[l].real=!0,v=0,et=y[l].length;v<et;v++)for(k[l][v]=[y[l][v][0]],tt=1,vt=y[l][v].length;tt<vt;tt++)k[l][v][tt]=(g[l][v][tt]-y[l][v][tt])/w;else d=r.matrix||new st,rt={_:{transform:gt.transform},getBBox:function(){return r.getBBox(1)}},y[l]=[d.a,d.b,d.c,d.d,d.e,d.f],uu(rt,g[l]),g[l]=rt._.transform,k[l]=[(rt.matrix.a-d.a)/w,(rt.matrix.b-d.b)/w,(rt.matrix.c-d.c)/w,(rt.matrix.d-d.d)/w,(rt.matrix.e-d.e)/w,(rt.matrix.f-d.f)/w];break;case"csv":if(ht=b(it[l])[ut](pi),ct=b(y[l])[ut](pi),l=="clip-rect")for(y[l]=ct,k[l]=[],v=ct.length;v--;)k[l][v]=(ht[v]-y[l][v])/w;g[l]=ht;break;default:for(ht=[][s](it[l]),ct=[][s](y[l]),k[l]=[],v=r.paper.customAttributes[l].length;v--;)k[l][v]=((ht[v]||0)-(ct[v]||0))/w}}if(ni=it.easing,ft=i.easing_formulas[ni],ft||(ft=b(ni).match(gu),ft&&ft.length==5?(lt=ft,ft=function(n){return yu(n,+lt[1],+lt[2],+lt[3],+lt[4],w)}):ft=sf),kt=it.start||n.start||+new Date,nt={anim:n,percent:u,timestamp:kt,start:kt+(n.del||0),status:0,initstatus:e||0,stop:!1,ms:w,easing:ft,from:y,diff:k,to:g,el:r,callback:it.callback,prev:wt,next:ti,repeat:c||n.times,origin:r.attr(),totalOrigin:o},f.push(nt),e&&!ot&&!pt&&(nt.stop=!0,nt.start=new Date-w*e,f.length==1))return or();pt&&(nt.start=new Date-nt.ms*e);f.length==1&&cu(or)}t("raphael.anim.start."+r.id,r,n)}}function ar(n){for(var t=0;t<f.length;t++)f[t].el.paper==n&&f.splice(t--,1)}var fi,ei,hf,af,et,kt,rr,ct,ou,g,yt,w,li;i.version="2.1.2";i.eve=t;var yi,pi=/[, ]+/,pu={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},wu=/\{(\d+)\}/g,a="hasOwnProperty",r={doc:document,win:n},wi={was:Object.prototype[a].call(r.win,"Raphael"),is:r.win.Raphael},vr=function(){this.ca=this.customAttributes={}},c,v="apply",s="concat",gt="ontouchstart"in r.win||r.win.DocumentTouch&&r.doc instanceof DocumentTouch,d="",at=" ",b=String,ut="split",yr="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[ut](at),ni={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},ti=b.prototype.toLowerCase,u=Math,o=u.max,l=u.min,y=u.abs,nt=u.pow,k=u.PI,p="number",ii="string",tt="array",bu=Object.prototype.toString,re=i._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,ku=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,du={NaN:1,Infinity:1,"-Infinity":1},gu=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,bi=u.round,h=parseFloat,ht=parseInt,pr=b.prototype.toUpperCase,nf=i._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ki=i._availableAnimAttrs={blur:p,"clip-rect":"csv",cx:p,cy:p,fill:"colour","fill-opacity":p,"font-size":p,height:p,opacity:p,path:"path",r:p,rx:p,ry:p,stroke:"colour","stroke-opacity":p,"stroke-width":p,transform:"transform",width:p,x:p,y:p},di=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,tf={hs:1,rg:1},rf=/,?([achlmqrstvxz]),?/gi,uf=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,ff=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,wr=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,ue=i._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,vt={},fe=function(n,t){return n.key-t.key},ef=function(n,t){return h(n)-h(t)},of=function(){},sf=function(n){return n},ri=i._rectPath=function(n,t,i,r,u){return u?[["M",n+u,t],["l",i-u*2,0],["a",u,u,0,0,1,u,u],["l",0,r-u*2],["a",u,u,0,0,1,-u,u],["l",u*2-i,0],["a",u,u,0,0,1,-u,-u],["l",0,u*2-r],["a",u,u,0,0,1,u,-u],["z"]]:[["M",n,t],["l",i,0],["l",0,r],["l",-i,0],["z"]]},br=function(n,t,i,r){return r==null&&(r=i),[["M",n,t],["m",0,-r],["a",i,r,0,1,1,0,2*r],["a",i,r,0,1,1,0,-2*r],["z"]]},ui=i._getPath={path:function(n){return n.attr("path")},circle:function(n){var t=n.attrs;return br(t.cx,t.cy,t.r)},ellipse:function(n){var t=n.attrs;return br(t.cx,t.cy,t.rx,t.ry)},rect:function(n){var t=n.attrs;return ri(t.x,t.y,t.width,t.height,t.r)},image:function(n){var t=n.attrs;return ri(t.x,t.y,t.width,t.height)},text:function(n){var t=n._getBBox();return ri(t.x,t.y,t.width,t.height)},set:function(n){var t=n._getBBox();return ri(t.x,t.y,t.width,t.height)}},gi=i.mapPath=function(n,t){if(!t)return n;var f,e,u,i,o,s,r;for(n=bt(n),u=0,o=n.length;u<o;u++)for(r=n[u],i=1,s=r.length;i<s;i+=2)f=t.x(r[i],r[i+1]),e=t.y(r[i],r[i+1]),r[i]=f,r[i+1]=e;return n};if(i._g=r,i.type=r.win.SVGAngle||r.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",i.type=="VML"){if(fi=r.doc.createElement("div"),fi.innerHTML='<v:shape adj="1"/>',ei=fi.firstChild,ei.style.behavior="url(#default#VML)",!(ei&&typeof ei.adj=="object"))return i.type=d;fi=null}i.svg=!(i.vml=i.type=="VML");i._Paper=vr;i.fn=c=vr.prototype=i.prototype;i._id=0;i._oid=0;i.is=function(n,t){return(t=ti.call(t),t=="finite")?!du[a](+n):t=="array"?n instanceof Array:t=="null"&&n===null||t==typeof n&&n!==null||t=="object"&&n===Object(n)||t=="array"&&Array.isArray&&Array.isArray(n)||bu.call(n).slice(8,-1).toLowerCase()==t};i.angle=function(n,t,r,f,e,o){if(e==null){var s=n-r,h=t-f;return!s&&!h?0:(180+u.atan2(-h,-s)*180/k+360)%360}return i.angle(n,t,e,o)-i.angle(r,f,e,o)};i.rad=function(n){return n%360*k/180};i.deg=function(n){return n*180/k%360};i.snapTo=function(n,t,r){var f,u;if(r=i.is(r,"finite")?r:10,i.is(n,tt)){for(f=n.length;f--;)if(y(n[f]-t)<=r)return n[f]}else{if(n=+n,u=t%n,u<r)return t-u;if(u>n-r)return t-u+n}return t};hf=i.createUUID=function(n,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(n,t).toUpperCase()}}(/[xy]/g,function(n){var t=u.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)});i.setWindow=function(n){t("raphael.setWindow",i,r.win,n);r.win=n;r.doc=r.win.document;i._engine.initWin&&i._engine.initWin(r.win)};var oi=function(n){var e,u,f,o,t;if(i.vml){e=/^\s+|\s+$/g;try{f=new ActiveXObject("htmlfile");f.write("<body>");f.close();u=f.body}catch(s){u=createPopup().document.body}o=u.createTextRange();oi=it(function(n){try{u.style.color=b(n).replace(e,d);var t=o.queryCommandValue("ForeColor");return t=(t&255)<<16|t&65280|(t&16711680)>>>16,"#"+("000000"+t.toString(16)).slice(-6)}catch(i){return"none"}})}else t=r.doc.createElement("i"),t.title="Raphaël Colour Picker",t.style.display="none",r.doc.body.appendChild(t),oi=it(function(n){return t.style.color=n,r.doc.defaultView.getComputedStyle(t,d).getPropertyValue("color")});return oi(n)},cf=function(){return"hsb("+[this.h,this.s,this.b]+")"},lf=function(){return"hsl("+[this.h,this.s,this.l]+")"},kr=function(){return this.hex},dr=function(n,t,r){if(t==null&&i.is(n,"object")&&"r"in n&&"g"in n&&"b"in n&&(r=n.b,t=n.g,n=n.r),t==null&&i.is(n,ii)){var u=i.getRGB(n);n=u.r;t=u.g;r=u.b}return(n>1||t>1||r>1)&&(n/=255,t/=255,r/=255),[n,t,r]},gr=function(n,t,r,u){n*=255;t*=255;r*=255;var f={r:n,g:t,b:r,hex:i.rgb(n,t,r),toString:kr};return i.is(u,"finite")&&(f.opacity=u),f};i.color=function(n){var t;return i.is(n,"object")&&"h"in n&&"s"in n&&"b"in n?(t=i.hsb2rgb(n),n.r=t.r,n.g=t.g,n.b=t.b,n.hex=t.hex):i.is(n,"object")&&"h"in n&&"s"in n&&"l"in n?(t=i.hsl2rgb(n),n.r=t.r,n.g=t.g,n.b=t.b,n.hex=t.hex):(i.is(n,"string")&&(n=i.getRGB(n)),i.is(n,"object")&&"r"in n&&"g"in n&&"b"in n?(t=i.rgb2hsl(n),n.h=t.h,n.s=t.s,n.l=t.l,t=i.rgb2hsb(n),n.v=t.b):(n={hex:"none"},n.r=n.g=n.b=n.h=n.s=n.v=n.l=-1)),n.toString=kr,n};i.hsb2rgb=function(n,t,i,r){this.is(n,"object")&&"h"in n&&"s"in n&&"b"in n&&(i=n.b,t=n.s,n=n.h,r=n.o);n*=360;var e,o,s,f,u;return n=n%360/60,u=i*t,f=u*(1-y(n%2-1)),e=o=s=i-u,n=~~n,e+=[u,f,0,0,f,u][n],o+=[f,u,u,f,0,0][n],s+=[0,0,f,u,u,f][n],gr(e,o,s,r)};i.hsl2rgb=function(n,t,i,r){this.is(n,"object")&&"h"in n&&"s"in n&&"l"in n&&(i=n.l,t=n.s,n=n.h);(n>1||t>1||i>1)&&(n/=360,t/=100,i/=100);n*=360;var e,o,s,f,u;return n=n%360/60,u=2*t*(i<.5?i:1-i),f=u*(1-y(n%2-1)),e=o=s=i-u/2,n=~~n,e+=[u,f,0,0,f,u][n],o+=[f,u,u,f,0,0][n],s+=[0,0,f,u,u,f][n],gr(e,o,s,r)};i.rgb2hsb=function(n,t,i){i=dr(n,t,i);n=i[0];t=i[1];i=i[2];var f,e,u,r;return u=o(n,t,i),r=u-l(n,t,i),f=r==0?null:u==n?(t-i)/r:u==t?(i-n)/r+2:(n-t)/r+4,f=(f+360)%6/6,e=r==0?0:r/u,{h:f,s:e,b:u,toString:cf}};i.rgb2hsl=function(n,t,i){i=dr(n,t,i);n=i[0];t=i[1];i=i[2];var e,h,u,f,s,r;return f=o(n,t,i),s=l(n,t,i),r=f-s,e=r==0?null:f==n?(t-i)/r:f==t?(i-n)/r+2:(n-t)/r+4,e=(e+360)%6/6,u=(f+s)/2,h=r==0?0:u<.5?r/(2*u):r/(2-2*u),{h:e,s:h,l:u,toString:lf}};i._path2string=function(){return this.join(",").replace(rf,"$1")};af=i._preload=function(n,t){var i=r.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em";i.onload=function(){t.call(this);this.onload=null;r.doc.body.removeChild(this)};i.onerror=function(){r.doc.body.removeChild(this)};r.doc.body.appendChild(i);i.src=n};i.getRGB=it(function(n){if(!n||!!((n=b(n)).indexOf("-")+1))return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:dt};if(n=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:dt};tf[a](n.toLowerCase().substring(0,2))||n.charAt()=="#"||(n=oi(n));var u,f,e,o,s,t,r=n.match(ku);return r?(r[2]&&(e=ht(r[2].substring(5),16),f=ht(r[2].substring(3,5),16),u=ht(r[2].substring(1,3),16)),r[3]&&(e=ht((s=r[3].charAt(3))+s,16),f=ht((s=r[3].charAt(2))+s,16),u=ht((s=r[3].charAt(1))+s,16)),r[4]&&(t=r[4][ut](di),u=h(t[0]),t[0].slice(-1)=="%"&&(u*=2.55),f=h(t[1]),t[1].slice(-1)=="%"&&(f*=2.55),e=h(t[2]),t[2].slice(-1)=="%"&&(e*=2.55),r[1].toLowerCase().slice(0,4)=="rgba"&&(o=h(t[3])),t[3]&&t[3].slice(-1)=="%"&&(o/=100)),r[5])?(t=r[5][ut](di),u=h(t[0]),t[0].slice(-1)=="%"&&(u*=2.55),f=h(t[1]),t[1].slice(-1)=="%"&&(f*=2.55),e=h(t[2]),t[2].slice(-1)=="%"&&(e*=2.55),(t[0].slice(-3)=="deg"||t[0].slice(-1)=="°")&&(u/=360),r[1].toLowerCase().slice(0,4)=="hsba"&&(o=h(t[3])),t[3]&&t[3].slice(-1)=="%"&&(o/=100),i.hsb2rgb(u,f,e,o)):r[6]?(t=r[6][ut](di),u=h(t[0]),t[0].slice(-1)=="%"&&(u*=2.55),f=h(t[1]),t[1].slice(-1)=="%"&&(f*=2.55),e=h(t[2]),t[2].slice(-1)=="%"&&(e*=2.55),(t[0].slice(-3)=="deg"||t[0].slice(-1)=="°")&&(u/=360),r[1].toLowerCase().slice(0,4)=="hsla"&&(o=h(t[3])),t[3]&&t[3].slice(-1)=="%"&&(o/=100),i.hsl2rgb(u,f,e,o)):(r={r:u,g:f,b:e,toString:dt},r.hex="#"+(16777216|e|f<<8|u<<16).toString(16).slice(1),i.is(o,"finite")&&(r.opacity=o),r):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:dt}},i);i.hsb=it(function(n,t,r){return i.hsb2rgb(n,t,r).hex});i.hsl=it(function(n,t,r){return i.hsl2rgb(n,t,r).hex});i.rgb=it(function(n,t,i){return"#"+(16777216|i|t<<8|n<<16).toString(16).slice(1)});i.getColor=function(n){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:n||.75},i=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),i.hex};i.getColor.reset=function(){delete this.start};i.parsePathString=function(n){var r,u,t;return n?(r=et(n),r.arr)?rt(r.arr):(u={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},t=[],i.is(n,tt)&&i.is(n[0],tt)&&(t=rt(n)),t.length||b(n).replace(uf,function(n,i,r){var f=[],e=i.toLowerCase();if(r.replace(wr,function(n,t){t&&f.push(+t)}),e=="m"&&f.length>2&&(t.push([i][s](f.splice(0,2))),e="l",i=i=="m"?"l":"L"),e=="r")t.push([i][s](f));else while(f.length>=u[e])if(t.push([i][s](f.splice(0,u[e]))),!u[e])break}),t.toString=i._path2string,r.arr=rt(t),t):null};i.parseTransformString=it(function(n){if(!n)return null;var t=[];return i.is(n,tt)&&i.is(n[0],tt)&&(t=rt(n)),t.length||b(n).replace(ff,function(n,i,r){var u=[],f=ti.call(i);r.replace(wr,function(n,t){t&&u.push(+t)});t.push([i][s](u))}),t.toString=i._path2string,t});et=function(n){var t=et.ps=et.ps||{};return t[n]?t[n].sleep=100:t[n]={sleep:100},setTimeout(function(){for(var i in t)t[a](i)&&i!=n&&(t[i].sleep--,t[i].sleep||delete t[i])}),t[n]};i.findDotsAtSegment=function(n,t,i,r,f,e,o,s,h){var c=1-h,w=nt(c,3),b=nt(c,2),l=h*h,d=l*h,tt=w*n+b*3*h*i+c*3*h*h*f+d*o,it=w*t+b*3*h*r+c*3*h*h*e+d*s,a=n+2*h*(i-n)+l*(f-2*i+n),v=t+2*h*(r-t)+l*(e-2*r+t),y=i+2*h*(f-i)+l*(o-2*f+i),p=r+2*h*(e-r)+l*(s-2*e+r),rt=c*n+h*i,ut=c*t+h*r,ft=c*f+h*o,et=c*e+h*s,g=90-u.atan2(a-y,v-p)*180/k;return(a>y||v<p)&&(g+=180),{x:tt,y:it,m:{x:a,y:v},n:{x:y,y:p},start:{x:rt,y:ut},end:{x:ft,y:et},alpha:g}};i.bezierBBox=function(n,t,r,u,f,e,o,s){i.is(n,"array")||(n=[n,t,r,u,f,e,o,s]);var h=ru.apply(null,n);return{x:h.min.x,y:h.min.y,x2:h.max.x,y2:h.max.y,width:h.max.x-h.min.x,height:h.max.y-h.min.y}};i.isPointInsideBBox=function(n,t,i){return t>=n.x&&t<=n.x2&&i>=n.y&&i<=n.y2};i.isBBoxIntersect=function(n,t){var r=i.isPointInsideBBox;return r(t,n.x,n.y)||r(t,n.x2,n.y)||r(t,n.x,n.y2)||r(t,n.x2,n.y2)||r(n,t.x,t.y)||r(n,t.x2,t.y)||r(n,t.x,t.y2)||r(n,t.x2,t.y2)||(n.x<t.x2&&n.x>t.x||t.x<n.x2&&t.x>n.x)&&(n.y<t.y2&&n.y>t.y||t.y<n.y2&&t.y>n.y)};i.pathIntersection=function(n,t){return vi(n,t)};i.pathIntersectionNumber=function(n,t){return vi(n,t,1)};i.isPointInsidePath=function(n,t,r){var u=i.pathBBox(n);return i.isPointInsideBBox(u,t,r)&&vi(n,[["M",t,r],["H",u.x2+10]],1)%2==1};i._removedFactory=function(n){return function(){t("raphael.log",null,"Raphaël: you are calling to method “"+n+"” of removed object",n)}};var nr=i.pathBBox=function(n){var c=et(n),h,p,u;if(c.bbox)return pt(c.bbox);if(!n)return{x:0,y:0,width:0,height:0,x2:0,y2:0};n=bt(n);var f=0,e=0,i=[],r=[],t;for(h=0,p=n.length;h<p;h++)t=n[h],t[0]=="M"?(f=t[1],e=t[2],i.push(f),r.push(e)):(u=ru(f,e,t[1],t[2],t[3],t[4],t[5],t[6]),i=i[s](u.min.x,u.max.x),r=r[s](u.min.y,u.max.y),f=t[5],e=t[6]);var a=l[v](0,i),y=l[v](0,r),w=o[v](0,i),b=o[v](0,r),k=w-a,d=b-y,g={x:a,y:y,x2:w,y2:b,width:k,height:d,cx:a+k/2,cy:y+d/2};return c.bbox=pt(g),g},rt=function(n){var t=pt(n);return t.toString=i._path2string,t},vf=i._pathToRelative=function(n){var v=et(n),u,p,f,t,s,w,h,b,c;if(v.rel)return rt(v.rel);i.is(n,tt)&&i.is(n&&n[0],tt)||(n=i.parsePathString(n));var r=[],o=0,e=0,l=0,a=0,y=0;for(n[0][0]=="M"&&(o=n[0][1],e=n[0][2],l=o,a=e,y++,r.push(["M",o,e])),u=y,p=n.length;u<p;u++){if(f=r[u]=[],t=n[u],t[0]!=ti.call(t[0])){f[0]=ti.call(t[0]);switch(f[0]){case"a":f[1]=t[1];f[2]=t[2];f[3]=t[3];f[4]=t[4];f[5]=t[5];f[6]=+(t[6]-o).toFixed(3);f[7]=+(t[7]-e).toFixed(3);break;case"v":f[1]=+(t[1]-e).toFixed(3);break;case"m":l=t[1];a=t[2];default:for(s=1,w=t.length;s<w;s++)f[s]=+(t[s]-(s%2?o:e)).toFixed(3)}}else for(f=r[u]=[],t[0]=="m"&&(l=t[1]+o,a=t[2]+e),h=0,b=t.length;h<b;h++)r[u][h]=t[h];c=r[u].length;switch(r[u][0]){case"z":o=l;e=a;break;case"h":o+=+r[u][c-1];break;case"v":e+=+r[u][c-1];break;default:o+=+r[u][c-2];e+=+r[u][c-1]}}return r.toString=i._path2string,v.rel=rt(r),r},nu=i._pathToAbsolute=function(n){var p=et(n),w,t,r,v,k,h,e,y,c,d;if(p.abs)return rt(p.abs);if(i.is(n,tt)&&i.is(n&&n[0],tt)||(n=i.parsePathString(n)),!n||!n.length)return[["M",0,0]];var o=[],u=0,f=0,l=0,a=0,b=0;for(n[0][0]=="M"&&(u=+n[0][1],f=+n[0][2],l=u,a=f,b++,o[0]=["M",u,f]),w=n.length==3&&n[0][0]=="M"&&n[1][0].toUpperCase()=="R"&&n[2][0].toUpperCase()=="Z",v=b,k=n.length;v<k;v++){if(o.push(t=[]),r=n[v],r[0]!=pr.call(r[0])){t[0]=pr.call(r[0]);switch(t[0]){case"A":t[1]=r[1];t[2]=r[2];t[3]=r[3];t[4]=r[4];t[5]=r[5];t[6]=+(r[6]+u);t[7]=+(r[7]+f);break;case"V":t[1]=+r[1]+f;break;case"H":t[1]=+r[1]+u;break;case"R":for(h=[u,f][s](r.slice(1)),e=2,y=h.length;e<y;e++)h[e]=+h[e]+u,h[++e]=+h[e]+f;o.pop();o=o[s](hr(h,w));break;case"M":l=+r[1]+u;a=+r[2]+f;default:for(e=1,y=r.length;e<y;e++)t[e]=+r[e]+(e%2?u:f)}}else if(r[0]=="R")h=[u,f][s](r.slice(1)),o.pop(),o=o[s](hr(h,w)),t=["R"][s](r.slice(-2));else for(c=0,d=r.length;c<d;c++)t[c]=r[c];switch(t[0]){case"Z":u=l;f=a;break;case"H":u=t[1];break;case"V":f=t[1];break;case"M":l=t[t.length-2];a=t[t.length-1];default:u=t[t.length-2];f=t[t.length-1]}}return o.toString=i._path2string,p.abs=rt(o),o},si=function(n,t,i,r){return[n,t,i,r,i,r]},tu=function(n,t,i,r,u,f){var e=1/3,o=2/3;return[e*n+o*i,e*t+o*r,e*u+o*i,e*f+o*r,u,f]},iu=function(n,t,i,r,f,e,o,h,c,l){var at=k*120/180,et=k/180*(+f||0),p=[],g,ot=it(function(n,t,i){var r=n*u.cos(i)-t*u.sin(i),f=n*u.sin(i)+t*u.cos(i);return{x:r,y:f}}),st,lt,w,gt;if(l)v=l[0],a=l[1],rt=l[2],ft=l[3];else{g=ot(n,t,-et);n=g.x;t=g.y;g=ot(h,c,-et);h=g.x;c=g.y;var oi=u.cos(k/180*f),si=u.sin(k/180*f),b=(n-h)/2,d=(t-c)/2,tt=b*b/(i*i)+d*d/(r*r);tt>1&&(tt=u.sqrt(tt),i=tt*i,r=tt*r);var ht=i*i,ct=r*r,vt=(e==o?-1:1)*u.sqrt(y((ht*ct-ht*d*d-ct*b*b)/(ht*d*d+ct*b*b))),rt=vt*i*d/r+(n+h)/2,ft=vt*-r*b/i+(t+c)/2,v=u.asin(((t-ft)/r).toFixed(9)),a=u.asin(((c-ft)/r).toFixed(9));v=n<rt?k-v:v;a=h<rt?k-a:a;v<0&&(v=k*2+v);a<0&&(a=k*2+a);o&&v>a&&(v=v-k*2);!o&&a>v&&(a=a-k*2)}if(st=a-v,y(st)>at){var ni=a,ti=h,ii=c;a=v+at*(o&&a>v?1:-1);h=rt+i*u.cos(a);c=ft+r*u.sin(a);p=iu(h,c,i,r,f,0,o,ti,ii,[a,ni,rt,ft])}st=a-v;var ri=u.cos(v),ui=u.sin(v),fi=u.cos(a),ei=u.sin(a),yt=u.tan(st/4),pt=4/3*i*yt,wt=4/3*r*yt,bt=[n,t],nt=[n+pt*ui,t-wt*ri],kt=[h+pt*ei,c-wt*fi],dt=[h,c];if(nt[0]=2*bt[0]-nt[0],nt[1]=2*bt[1]-nt[1],l)return[nt,kt,dt][s](p);for(p=[nt,kt,dt][s](p).join()[ut](","),lt=[],w=0,gt=p.length;w<gt;w++)lt[w]=w%2?ot(p[w-1],p[w],et).y:ot(p[w],p[w+1],et).x;return lt},hi=function(n,t,i,r,u,f,e,o,s){var h=1-s;return{x:nt(h,3)*n+nt(h,2)*3*s*i+h*3*s*s*u+nt(s,3)*e,y:nt(h,3)*t+nt(h,2)*3*s*r+h*3*s*s*f+nt(s,3)*o}},ru=it(function(n,t,i,r,f,e,s,h){var b=f-2*i+n-(s-2*f+i),c=2*(i-n)-2*(f-i),g=n-i,p=(-c+u.sqrt(c*c-4*b*g))/2/b,w=(-c-u.sqrt(c*c-4*b*g))/2/b,k=[t,h],d=[n,s],a;return y(p)>"1e12"&&(p=.5),y(w)>"1e12"&&(w=.5),p>0&&p<1&&(a=hi(n,t,i,r,f,e,s,h,p),d.push(a.x),k.push(a.y)),w>0&&w<1&&(a=hi(n,t,i,r,f,e,s,h,w),d.push(a.x),k.push(a.y)),b=e-2*r+t-(h-2*e+r),c=2*(r-t)-2*(e-r),g=t-r,p=(-c+u.sqrt(c*c-4*b*g))/2/b,w=(-c-u.sqrt(c*c-4*b*g))/2/b,y(p)>"1e12"&&(p=.5),y(w)>"1e12"&&(w=.5),p>0&&p<1&&(a=hi(n,t,i,r,f,e,s,h,p),d.push(a.x),k.push(a.y)),w>0&&w<1&&(a=hi(n,t,i,r,f,e,s,h,w),d.push(a.x),k.push(a.y)),{min:{x:l[v](0,d),y:l[v](0,k)},max:{x:o[v](0,d),y:o[v](0,k)}}}),bt=i._path2curve=it(function(n,t){var w=!t&&et(n),r,a;if(!t&&w.curve)return rt(w.curve);var u=nu(n),i=t&&nu(t),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},e={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},b=function(n,t,i){var r,u;if(!n)return["C",t.x,t.y,t.x,t.y,t.x,t.y];n[0]in{T:1,Q:1}||(t.qx=t.qy=null);switch(n[0]){case"M":t.X=n[1];t.Y=n[2];break;case"A":n=["C"][s](iu[v](0,[t.x,t.y][s](n.slice(1))));break;case"S":i=="C"||i=="S"?(r=t.x*2-t.bx,u=t.y*2-t.by):(r=t.x,u=t.y);n=["C",r,u][s](n.slice(1));break;case"T":i=="Q"||i=="T"?(t.qx=t.x*2-t.qx,t.qy=t.y*2-t.qy):(t.qx=t.x,t.qy=t.y);n=["C"][s](tu(t.x,t.y,t.qx,t.qy,n[1],n[2]));break;case"Q":t.qx=n[1];t.qy=n[2];n=["C"][s](tu(t.x,t.y,n[1],n[2],n[3],n[4]));break;case"L":n=["C"][s](si(t.x,t.y,n[1],n[2]));break;case"H":n=["C"][s](si(t.x,t.y,n[1],t.y));break;case"V":n=["C"][s](si(t.x,t.y,t.x,n[1]));break;case"Z":n=["C"][s](si(t.x,t.y,t.X,t.Y))}return n},k=function(n,t){if(n[t].length>7){n[t].shift();for(var r=n[t];r.length;)n.splice(t++,0,["C"][s](r.splice(0,6)));n.splice(t,1);a=o(u.length,i&&i.length||0)}},d=function(n,t,r,f,e){n&&t&&n[e][0]=="M"&&t[e][0]!="M"&&(t.splice(e,0,["M",f.x,f.y]),r.bx=0,r.by=0,r.x=n[e][1],r.y=n[e][2],a=o(u.length,i&&i.length||0))};for(r=0,a=o(u.length,i&&i.length||0);r<a;r++){u[r]=b(u[r],f);k(u,r);i&&(i[r]=b(i[r],e));i&&k(i,r);d(u,i,f,e,r);d(i,u,e,f,r);var c=u[r],l=i&&i[r],y=c.length,p=i&&l.length;f.x=c[y-2];f.y=c[y-1];f.bx=h(c[y-4])||f.x;f.by=h(c[y-3])||f.y;e.bx=i&&(h(l[p-4])||e.x);e.by=i&&(h(l[p-3])||e.y);e.x=i&&l[p-2];e.y=i&&l[p-1]}return i||(w.curve=rt(u)),i?[u,i]:u},null,rt),ee=i._parseDots=it(function(n){for(var f,s,c,e,u,l,r=[],t=0,o=n.length;t<o;t++){if(f={},s=n[t].match(/^([^:]*):?([\d\.]*)/),f.color=i.getRGB(s[1]),f.color.error)return null;f.color=f.color.hex;s[2]&&(f.offset=s[2]+"%");r.push(f)}for(t=1,o=r.length-1;t<o;t++)if(!r[t].offset){for(c=h(r[t-1].offset||0),e=0,u=t+1;u<o;u++)if(r[u].offset){e=r[u].offset;break}for(e||(e=100,u=o),e=h(e),l=(e-c)/(u-t+1);t<u;t++)c+=l,r[t].offset=c+"%"}return r}),ci=i._tear=function(n,t){n==t.top&&(t.top=n.prev);n==t.bottom&&(t.bottom=n.next);n.next&&(n.next.prev=n.prev);n.prev&&(n.prev.next=n.next)},oe=i._tofront=function(n,t){t.top!==n&&(ci(n,t),n.next=null,n.prev=t.top,t.top.next=n,t.top=n)},se=i._toback=function(n,t){t.bottom!==n&&(ci(n,t),n.next=t.bottom,n.prev=null,t.bottom.prev=n,t.bottom=n)},he=i._insertafter=function(n,t,i){ci(n,i);t==i.top&&(i.top=n);t.next&&(t.next.prev=n);n.next=t.next;n.prev=t;t.next=n},ce=i._insertbefore=function(n,t,i){ci(n,i);t==i.bottom&&(i.bottom=n);t.prev&&(t.prev.next=n);n.prev=t.prev;t.prev=n;n.next=t},yf=i.toMatrix=function(n,t){var r=nr(n),i={_:{transform:d},getBBox:function(){return r}};return uu(i,t),i.matrix},le=i.transformPath=function(n,t){return gi(n,yf(n,t))},uu=i._extractTransform=function(n,t){var w,tt;if(t==null)return n._.transform;t=b(t).replace(/\.{3}|\u2026/g,n._.transform||d);var a=i.parseTransformString(t),v=0,g=0,nt=0,y=1,p=1,e=n._,u=new st;if(e.transform=a||[],a)for(w=0,tt=a.length;w<tt;w++){var r=a[w],o=r.length,l=b(r[0]).toLowerCase(),k=r[0]!=l,s=k?u.invert():0,it,rt,h,c,f;l=="t"&&o==3?k?(it=s.x(0,0),rt=s.y(0,0),h=s.x(r[1],r[2]),c=s.y(r[1],r[2]),u.translate(h-it,c-rt)):u.translate(r[1],r[2]):l=="r"?o==2?(f=f||n.getBBox(1),u.rotate(r[1],f.x+f.width/2,f.y+f.height/2),v+=r[1]):o==4&&(k?(h=s.x(r[2],r[3]),c=s.y(r[2],r[3]),u.rotate(r[1],h,c)):u.rotate(r[1],r[2],r[3]),v+=r[1]):l=="s"?o==2||o==3?(f=f||n.getBBox(1),u.scale(r[1],r[o-1],f.x+f.width/2,f.y+f.height/2),y*=r[1],p*=r[o-1]):o==5&&(k?(h=s.x(r[3],r[4]),c=s.y(r[3],r[4]),u.scale(r[1],r[2],h,c)):u.scale(r[1],r[2],r[3],r[4]),y*=r[1],p*=r[2]):l=="m"&&o==7&&u.add(r[1],r[2],r[3],r[4],r[5],r[6]);e.dirtyT=1;n.matrix=u}n.matrix=u;e.sx=y;e.sy=p;e.deg=v;e.dx=g=u.e;e.dy=nt=u.f;y==1&&p==1&&!v&&e.bbox?(e.bbox.x+=+g,e.bbox.y+=+nt):e.dirtyT=1},fu=function(n){var t=n[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return n.length==4?[t,0,n[2],n[3]]:[t,0];case"s":return n.length==5?[t,1,1,n[3],n[4]]:n.length==3?[t,1,1]:[t,1]}},pf=i._equaliseTransform=function(n,t){t=b(t).replace(/\.{3}|\u2026/g,n);n=i.parseTransformString(n)||[];t=i.parseTransformString(t)||[];for(var l=o(n.length,t.length),s=[],h=[],u=0,f,c,r,e;u<l;u++){if(r=n[u]||fu(t[u]),e=t[u]||fu(r),r[0]!=e[0]||r[0].toLowerCase()=="r"&&(r[2]!=e[2]||r[3]!=e[3])||r[0].toLowerCase()=="s"&&(r[3]!=e[3]||r[4]!=e[4]))return;for(s[u]=[],h[u]=[],f=0,c=o(r.length,e.length);f<c;f++)f in r&&(s[u][f]=r[f]),f in e&&(h[u][f]=e[f])}return{from:s,to:h}};i._getContainer=function(n,t,u,f){var e;if(e=f==null&&!i.is(n,"object")?r.doc.getElementById(n):n,e!=null)return e.tagName?t==null?{container:e,width:e.style.pixelWidth||e.offsetWidth,height:e.style.pixelHeight||e.offsetHeight}:{container:e,width:t,height:u}:{container:1,x:n,y:t,width:u,height:f}};i.pathToRelative=vf;i._engine={};i.path2curve=bt;i.matrix=function(n,t,i,r,u,f){return new st(n,t,i,r,u,f)},function(n){function t(n){return n[0]*n[0]+n[1]*n[1]}function r(n){var i=u.sqrt(t(n));n[0]&&(n[0]/=i);n[1]&&(n[1]/=i)}n.add=function(n,t,i,r,u,f){var e=[[],[],[]],a=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],l=[[n,i,u],[t,r,f],[0,0,1]],o,s,h,c;for(n&&n instanceof st&&(l=[[n.a,n.c,n.e],[n.b,n.d,n.f],[0,0,1]]),o=0;o<3;o++)for(s=0;s<3;s++){for(c=0,h=0;h<3;h++)c+=a[o][h]*l[h][s];e[o][s]=c}this.a=e[0][0];this.b=e[1][0];this.c=e[0][1];this.d=e[1][1];this.e=e[0][2];this.f=e[1][2]};n.invert=function(){var n=this,t=n.a*n.d-n.b*n.c;return new st(n.d/t,-n.b/t,-n.c/t,n.a/t,(n.c*n.f-n.d*n.e)/t,(n.b*n.e-n.a*n.f)/t)};n.clone=function(){return new st(this.a,this.b,this.c,this.d,this.e,this.f)};n.translate=function(n,t){this.add(1,0,0,1,n,t)};n.scale=function(n,t,i,r){t==null&&(t=n);(i||r)&&this.add(1,0,0,1,i,r);this.add(n,0,0,t,0,0);(i||r)&&this.add(1,0,0,1,-i,-r)};n.rotate=function(n,t,r){n=i.rad(n);t=t||0;r=r||0;var f=+u.cos(n).toFixed(9),e=+u.sin(n).toFixed(9);this.add(f,e,-e,f,t,r);this.add(1,0,0,1,-t,-r)};n.x=function(n,t){return n*this.a+t*this.c+this.e};n.y=function(n,t){return n*this.b+t*this.d+this.f};n.get=function(n){return+this[b.fromCharCode(97+n)].toFixed(4)};n.toString=function(){return i.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};n.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};n.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};n.split=function(){var n={},f,e,o;return n.dx=this.e,n.dy=this.f,f=[[this.a,this.c],[this.b,this.d]],n.scalex=u.sqrt(t(f[0])),r(f[0]),n.shear=f[0][0]*f[1][0]+f[0][1]*f[1][1],f[1]=[f[1][0]-f[0][0]*n.shear,f[1][1]-f[0][1]*n.shear],n.scaley=u.sqrt(t(f[1])),r(f[1]),n.shear/=n.scaley,e=-f[0][1],o=f[1][1],o<0?(n.rotate=i.deg(u.acos(o)),e<0&&(n.rotate=360-n.rotate)):n.rotate=i.deg(u.asin(e)),n.isSimple=!+n.shear.toFixed(9)&&(n.scalex.toFixed(9)==n.scaley.toFixed(9)||!n.rotate),n.isSuperSimple=!+n.shear.toFixed(9)&&n.scalex.toFixed(9)==n.scaley.toFixed(9)&&!n.rotate,n.noRotation=!+n.shear.toFixed(9)&&!n.rotate,n};n.toTransformString=function(n){var t=n||this[ut]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:d)+(t.scalex!=1||t.scaley!=1?"s"+[t.scalex,t.scaley,0,0]:d)+(t.rotate?"r"+[t.rotate,0,0]:d)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(st.prototype);kt=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);c.safari=navigator.vendor=="Apple Computer, Inc."&&(kt&&kt[1]<4||navigator.platform.slice(0,2)=="iP")||navigator.vendor=="Google Inc."&&kt&&kt[1]<8?function(){var n=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){n.remove()})}:of;var wf=function(){this.returnValue=!1},bf=function(){return this.originalEvent.preventDefault()},kf=function(){this.cancelBubble=!0},df=function(){return this.originalEvent.stopPropagation()},eu=function(n){var t=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,i=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft;return{x:n.clientX+i,y:n.clientY+t}},gf=function(){return r.doc.addEventListener?function(n,t,i,r){var u=function(n){var t=eu(n);return i.call(r,n,t.x,t.y)},f;return n.addEventListener(t,u,!1),gt&&ni[t]&&(f=function(t){for(var f=eu(t),e=t,u=0,o=t.targetTouches&&t.targetTouches.length;u<o;u++)if(t.targetTouches[u].target==n){t=t.targetTouches[u];t.originalEvent=e;t.preventDefault=bf;t.stopPropagation=df;break}return i.call(r,t,f.x,f.y)},n.addEventListener(ni[t],f,!1)),function(){return n.removeEventListener(t,u,!1),gt&&ni[t]&&n.removeEventListener(ni[t],u,!1),!0}}:r.doc.attachEvent?function(n,t,i,u){var f=function(n){n=n||r.win.event;var t=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,f=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft,e=n.clientX+f,o=n.clientY+t;return n.preventDefault=n.preventDefault||wf,n.stopPropagation=n.stopPropagation||kf,i.call(u,n,e,o)};return n.attachEvent("on"+t,f),function(){return n.detachEvent("on"+t,f),!0}}:void 0}(),ot=[],tr=function(n){for(var f=n.clientX,e=n.clientY,v=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,y=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft,i,l=ot.length,s,o;l--;){if(i=ot[l],gt&&n.touches){for(s=n.touches.length;s--;)if(o=n.touches[s],o.identifier==i.el._drag.id){f=o.clientX;e=o.clientY;(n.originalEvent?n.originalEvent:n).preventDefault();break}}else n.preventDefault();var u=i.el.node,h,a=u.nextSibling,c=u.parentNode,p=u.style.display;r.win.opera&&c.removeChild(u);u.style.display="none";h=i.el.paper.getElementByPoint(f,e);u.style.display=p;r.win.opera&&(a?c.insertBefore(u,a):c.appendChild(u));h&&t("raphael.drag.over."+i.el.id,i.el,h);f+=y;e+=v;t("raphael.drag.move."+i.el.id,i.move_scope||i.el,f-i.el._drag.x,e-i.el._drag.y,f,e,n)}},ir=function(n){i.unmousemove(tr).unmouseup(ir);for(var u=ot.length,r;u--;)r=ot[u],r.el._drag={},t("raphael.drag.end."+r.el.id,r.end_scope||r.start_scope||r.move_scope||r.el,n);ot=[]},e=i.el={};for(rr=yr.length;rr--;)(function(n){i[n]=e[n]=function(t,u){return i.is(t,"function")&&(this.events=this.events||[],this.events.push({name:n,f:t,unbind:gf(this.shape||this.node||r.doc,n,t,u||this)})),this};i["un"+n]=e["un"+n]=function(t){for(var r=this.events||[],u=r.length;u--;)r[u].name==n&&(i.is(t,"undefined")||r[u].f==t)&&(r[u].unbind(),r.splice(u,1),r.length||delete this.events);return this}})(yr[rr]);e.data=function(n,r){var u=vt[this.id]=vt[this.id]||{},f;if(arguments.length==0)return u;if(arguments.length==1){if(i.is(n,"object")){for(f in n)n[a](f)&&this.data(f,n[f]);return this}return t("raphael.data.get."+this.id,this,u[n],n),u[n]}return u[n]=r,t("raphael.data.set."+this.id,this,r,n),this};e.removeData=function(n){return n==null?vt[this.id]={}:vt[this.id]&&delete vt[this.id][n],this};e.getData=function(){return pt(vt[this.id]||{})};e.hover=function(n,t,i,r){return this.mouseover(n,i).mouseout(t,r||i)};e.unhover=function(n,t){return this.unmouseover(n).unmouseout(t)};ct=[];e.drag=function(n,u,f,e,o,s){function h(h){var l,c;(h.originalEvent||h).preventDefault();var a=h.clientX,v=h.clientY,y=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,p=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft;if(this._drag.id=h.identifier,gt&&h.touches)for(l=h.touches.length;l--;)if(c=h.touches[l],this._drag.id=c.identifier,c.identifier==this._drag.id){a=c.clientX;v=c.clientY;break}this._drag.x=a+p;this._drag.y=v+y;ot.length||i.mousemove(tr).mouseup(ir);ot.push({el:this,move_scope:e,start_scope:o,end_scope:s});u&&t.on("raphael.drag.start."+this.id,u);n&&t.on("raphael.drag.move."+this.id,n);f&&t.on("raphael.drag.end."+this.id,f);t("raphael.drag.start."+this.id,o||e||this,h.clientX+p,h.clientY+y,h)}return this._drag={},ct.push({el:this,start:h}),this.mousedown(h),this};e.onDragOver=function(n){n?t.on("raphael.drag.over."+this.id,n):t.unbind("raphael.drag.over."+this.id)};e.undrag=function(){for(var n=ct.length;n--;)ct[n].el==this&&(this.unmousedown(ct[n].start),ct.splice(n,1),t.unbind("raphael.drag.*."+this.id));ct.length||i.unmousemove(tr).unmouseup(ir);ot=[]};c.circle=function(n,t,r){var u=i._engine.circle(this,n||0,t||0,r||0);return this.__set__&&this.__set__.push(u),u};c.rect=function(n,t,r,u,f){var e=i._engine.rect(this,n||0,t||0,r||0,u||0,f||0);return this.__set__&&this.__set__.push(e),e};c.ellipse=function(n,t,r,u){var f=i._engine.ellipse(this,n||0,t||0,r||0,u||0);return this.__set__&&this.__set__.push(f),f};c.path=function(n){!n||i.is(n,ii)||i.is(n[0],tt)||(n+=d);var t=i._engine.path(i.format[v](i,arguments),this);return this.__set__&&this.__set__.push(t),t};c.image=function(n,t,r,u,f){var e=i._engine.image(this,n||"about:blank",t||0,r||0,u||0,f||0);return this.__set__&&this.__set__.push(e),e};c.text=function(n,t,r){var u=i._engine.text(this,n||0,t||0,b(r));return this.__set__&&this.__set__.push(u),u};c.set=function(n){i.is(n,"array")||(n=Array.prototype.splice.call(arguments,0,arguments.length));var t=new yt(n);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t};c.setStart=function(n){this.__set__=n||this.set()};c.setFinish=function(){var n=this.__set__;return delete this.__set__,n};c.setSize=function(n,t){return i._engine.setSize.call(this,n,t)};c.setViewBox=function(n,t,r,u,f){return i._engine.setViewBox.call(this,n,t,r,u,f)};c.top=c.bottom=null;c.raphael=i;ou=function(n){var u=n.getBoundingClientRect(),f=n.ownerDocument,t=f.body,i=f.documentElement,e=i.clientTop||t.clientTop||0,o=i.clientLeft||t.clientLeft||0,s=u.top+(r.win.pageYOffset||i.scrollTop||t.scrollTop)-e,h=u.left+(r.win.pageXOffset||i.scrollLeft||t.scrollLeft)-o;return{y:s,x:h}};c.getElementByPoint=function(n,t){var o=this,f=o.canvas,i=r.doc.elementFromPoint(n,t),s,u,e;if(r.win.opera&&i.tagName=="svg"&&(s=ou(f),u=f.createSVGRect(),u.x=n-s.x,u.y=t-s.y,u.width=u.height=1,e=f.getIntersectionList(u,null),e.length&&(i=e[e.length-1])),!i)return null;while(i.parentNode&&i!=f.parentNode&&!i.raphael)i=i.parentNode;return i==o.canvas.parentNode&&(i=f),i&&i.raphael?o.getById(i.raphaelid):null};c.getElementsByBBox=function(n){var t=this.set();return this.forEach(function(r){i.isBBoxIntersect(r.getBBox(),n)&&t.push(r)}),t};c.getById=function(n){for(var t=this.bottom;t;){if(t.id==n)return t;t=t.next}return null};c.forEach=function(n,t){for(var i=this.bottom;i;){if(n.call(t,i)===!1)return this;i=i.next}return this};c.getElementsByPoint=function(n,t){var i=this.set();return this.forEach(function(r){r.isPointInside(n,t)&&i.push(r)}),i};e.isPointInside=function(n,t){var r=this.realPath=ui[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(r=i.transformPath(r,this.attr("transform"))),i.isPointInsidePath(r,n,t)};e.getBBox=function(n){if(this.removed)return{};var t=this._;return n?((t.dirty||!t.bboxwt)&&(this.realPath=ui[this.type](this),t.bboxwt=nr(this.realPath),t.bboxwt.toString=lr,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&((t.dirty||!this.realPath)&&(t.bboxwt=0,this.realPath=ui[this.type](this)),t.bbox=nr(gi(this.realPath,this.matrix)),t.bbox.toString=lr,t.dirty=t.dirtyT=0),t.bbox)};e.clone=function(){if(this.removed)return null;var n=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(n),n};e.glow=function(n){var r;if(this.type=="text")return null;n=n||{};var t={width:(n.width||10)+(+this.attr("stroke-width")||1),fill:n.fill||!1,opacity:n.opacity||.5,offsetx:n.offsetx||0,offsety:n.offsety||0,color:n.color||"#000"},u=t.width/2,f=this.paper,e=f.set(),i=this.realPath||ui[this.type](this);for(i=this.matrix?gi(i,this.matrix):i,r=1;r<u+1;r++)e.push(f.path(i).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/u*r).toFixed(3),opacity:+(t.opacity/u).toFixed(3)}));return e.insertBefore(this).translate(t.offsetx,t.offsety)};var ur=function(n,t,r,u,f,e,o,s,h){return h==null?lt(n,t,r,u,f,e,o,s):i.findDotsAtSegment(n,t,r,u,f,e,o,s,au(n,t,r,u,f,e,o,s,h))},fr=function(n,t){return function(r,u,f){var y,p;r=bt(r);var s,h,e,a,c="",v={},o,l=0;for(y=0,p=r.length;y<p;y++){if(e=r[y],e[0]=="M")s=+e[1],h=+e[2];else{if(a=ur(s,h,e[1],e[2],e[3],e[4],e[5],e[6]),l+a>u){if(t&&!v.start){if(o=ur(s,h,e[1],e[2],e[3],e[4],e[5],e[6],u-l),c+=["C"+o.start.x,o.start.y,o.m.x,o.m.y,o.x,o.y],f)return c;v.start=c;c=["M"+o.x,o.y+"C"+o.n.x,o.n.y,o.end.x,o.end.y,e[5],e[6]].join();l+=a;s=+e[5];h=+e[6];continue}if(!n&&!t)return o=ur(s,h,e[1],e[2],e[3],e[4],e[5],e[6],u-l),{x:o.x,y:o.y,alpha:o.alpha}}l+=a;s=+e[5];h=+e[6]}c+=e.shift()+e}return v.end=c,o=n?l:t?v:i.findDotsAtSegment(s,h,e[0],e[1],e[2],e[3],e[4],e[5],1),o.alpha&&(o={x:o.x,y:o.y,alpha:o.alpha}),o}},su=fr(1),hu=fr(),er=fr(0,1);i.getTotalLength=su;i.getPointAtLength=hu;i.getSubpath=function(n,t,i){if(this.getTotalLength(n)-i<1e-6)return er(n,t).end;var r=er(n,i,1);return t?er(r,t).end:r};e.getTotalLength=function(){var n=this.getPath();if(n)return this.node.getTotalLength?this.node.getTotalLength():su(n)};e.getPointAtLength=function(n){var t=this.getPath();if(t)return hu(t,n)};e.getPath=function(){var n,t=i._getPath[this.type];if(this.type!="text"&&this.type!="set")return t&&(n=t(this)),n};e.getSubpath=function(n,t){var r=this.getPath();if(r)return i.getSubpath(r,n,t)};g=i.easing_formulas={linear:function(n){return n},"<":function(n){return nt(n,1.7)},">":function(n){return nt(n,.48)},"<>":function(n){var i=.48-n/1.04,r=u.sqrt(.1734+i*i),f=r-i,o=nt(y(f),1/3)*(f<0?-1:1),e=-r-i,s=nt(y(e),1/3)*(e<0?-1:1),t=o+s+.5;return(1-t)*3*t*t+t*t*t},backIn:function(n){var t=1.70158;return n*n*((t+1)*n-t)},backOut:function(n){n=n-1;var t=1.70158;return n*n*((t+1)*n+t)+1},elastic:function(n){return n==!!n?n:nt(2,-10*n)*u.sin((n-.075)*2*k/.3)+1},bounce:function(n){var r=7.5625,t=2.75,i;return n<1/t?i=r*n*n:n<2/t?(n-=1.5/t,i=r*n*n+.75):n<2.5/t?(n-=2.25/t,i=r*n*n+.9375):(n-=2.625/t,i=r*n*n+.984375),i}};g.easeIn=g["ease-in"]=g["<"];g.easeOut=g["ease-out"]=g[">"];g.easeInOut=g["ease-in-out"]=g["<>"];g["back-in"]=g.backIn;g["back-out"]=g.backOut;var f=[],cu=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(n){setTimeout(n,16)},or=function(){for(var ft=+new Date,b=0,n,v,r,u,g,c,nt,w,ut;b<f.length;b++)if(n=f[b],!n.el.removed&&!n.paused){var k=ft-n.start,h=n.ms,et=n.easing,o=n.from,l=n.diff,tt=n.to,ot=n.t,y=n.el,it={},e,rt={},d;if(n.initstatus?(k=(n.initstatus*n.anim.top-n.prev)/(n.percent-n.prev)*h,n.status=n.initstatus,delete n.initstatus,n.stop&&f.splice(b--,1)):n.status=(n.prev+(n.percent-n.prev)*(k/h))/n.anim.top,!(k<0))if(k<h){v=et(k/h);for(r in o)if(o[a](r)){switch(ki[r]){case p:e=+o[r]+v*h*l[r];break;case"colour":e="rgb("+[sr(bi(o[r].r+v*h*l[r].r)),sr(bi(o[r].g+v*h*l[r].g)),sr(bi(o[r].b+v*h*l[r].b))].join(",")+")";break;case"path":for(e=[],u=0,g=o[r].length;u<g;u++){for(e[u]=[o[r][u][0]],c=1,nt=o[r][u].length;c<nt;c++)e[u][c]=+o[r][u][c]+v*h*l[r][u][c];e[u]=e[u].join(at)}e=e.join(at);break;case"transform":if(l[r].real)for(e=[],u=0,g=o[r].length;u<g;u++)for(e[u]=[o[r][u][0]],c=1,nt=o[r][u].length;c<nt;c++)e[u][c]=o[r][u][c]+v*h*l[r][u][c];else w=function(n){return+o[r][n]+v*h*l[r][n]},e=[["m",w(0),w(1),w(2),w(3),w(4),w(5)]];break;case"csv":if(r=="clip-rect")for(e=[],u=4;u--;)e[u]=+o[r][u]+v*h*l[r][u];break;default:for(ut=[][s](o[r]),e=[],u=y.paper.customAttributes[r].length;u--;)e[u]=+ut[u]+v*h*l[r][u]}it[r]=e}y.attr(it),function(n,i,r){setTimeout(function(){t("raphael.anim.frame."+n,i,r)})}(y.id,y,n.anim)}else{if(function(n,r,u){setTimeout(function(){t("raphael.anim.frame."+r.id,r,u);t("raphael.anim.finish."+r.id,r,u);i.is(n,"function")&&n.call(r)})}(n.callback,y,n.anim),y.attr(tt),f.splice(b--,1),n.repeat>1&&!n.next){for(d in tt)tt[a](d)&&(rt[d]=n.totalOrigin[d]);n.el.attr(rt);wt(n.anim,n.el,n.anim.percents[0],null,n.totalOrigin,n.repeat-1)}n.next&&!n.stop&&wt(n.anim,n.el,n.next,null,n.totalOrigin,n.repeat)}}i.svg&&y&&y.paper&&y.paper.safari();f.length&&cu(or)},sr=function(n){return n>255?255:n<0?0:n};e.animateWith=function(n,t,r,u,e,o){var s=this,c,h,l;if(s.removed)return o&&o.call(s),s;for(c=r instanceof ft?r:i.animation(r,u,e,o),wt(c,s,c.percents[0],null,s.attr()),h=0,l=f.length;h<l;h++)if(f[h].anim==t&&f[h].el==n){f[l-1].start=f[h].start;break}return s};e.onAnimation=function(n){return n?t.on("raphael.anim.frame."+this.id,n):t.unbind("raphael.anim.frame."+this.id),this};ft.prototype.delay=function(n){var t=new ft(this.anim,this.ms);return t.times=this.times,t.del=+n||0,t};ft.prototype.repeat=function(n){var t=new ft(this.anim,this.ms);return t.del=this.del,t.times=u.floor(o(n,0))||1,t};i.animation=function(n,t,r,u){if(n instanceof ft)return n;(i.is(r,"function")||!r)&&(u=u||r||null,r=null);n=Object(n);t=+t||0;var e={},o;for(var f in n)n[a](f)&&h(f)!=f&&h(f)+"%"!=f&&(o=!0,e[f]=n[f]);return o?(r&&(e.easing=r),u&&(e.callback=u),new ft({100:e},t)):new ft(n,t)};e.animate=function(n,t,r,u){var f=this,e;return f.removed?(u&&u.call(f),f):(e=n instanceof ft?n:i.animation(n,t,r,u),wt(e,f,e.percents[0],null,f.attr()),f)};e.setTime=function(n,t){return n&&t!=null&&this.status(n,l(t,n.ms)/n.ms),this};e.status=function(n,t){var u=[],r=0,e,i;if(t!=null)return wt(n,this,-1,l(t,1)),this;for(e=f.length;r<e;r++)if(i=f[r],i.el.id==this.id&&(!n||i.anim==n)){if(n)return i.status;u.push({anim:i.anim,status:i.status})}return n?0:u};e.pause=function(n){for(var i=0;i<f.length;i++)f[i].el.id!=this.id||n&&f[i].anim!=n||t("raphael.anim.pause."+this.id,this,f[i].anim)!==!1&&(f[i].paused=!0);return this};e.resume=function(n){for(var r,i=0;i<f.length;i++)f[i].el.id!=this.id||n&&f[i].anim!=n||(r=f[i],t("raphael.anim.resume."+this.id,this,r.anim)!==!1&&(delete r.paused,this.status(r.anim,r.status)));return this};e.stop=function(n){for(var i=0;i<f.length;i++)f[i].el.id!=this.id||n&&f[i].anim!=n||t("raphael.anim.stop."+this.id,this,f[i].anim)!==!1&&f.splice(i--,1);return this};t.on("raphael.remove",ar);t.on("raphael.clear",ar);e.toString=function(){return"Raphaël’s object"};yt=function(n){if(this.items=[],this.length=0,this.type="set",n)for(var t=0,i=n.length;t<i;t++)n[t]&&(n[t].constructor==e.constructor||n[t].constructor==yt)&&(this[this.items.length]=this.items[this.items.length]=n[t],this.length++)};w=yt.prototype;w.push=function(){for(var n,t,i=0,r=arguments.length;i<r;i++)n=arguments[i],n&&(n.constructor==e.constructor||n.constructor==yt)&&(t=this.items.length,this[t]=this.items[t]=n,this.length++);return this};w.pop=function(){return this.length&&delete this[this.length--],this.items.pop()};w.forEach=function(n,t){for(var i=0,r=this.items.length;i<r;i++)if(n.call(t,this.items[i],i)===!1)return this;return this};for(li in e)e[a](li)&&(w[li]=function(n){return function(){var t=arguments;return this.forEach(function(i){i[n][v](i,t)})}}(li));w.attr=function(n,t){var r,f,u,e;if(n&&i.is(n,tt)&&i.is(n[0],"object"))for(r=0,f=n.length;r<f;r++)this.items[r].attr(n[r]);else for(u=0,e=this.items.length;u<e;u++)this.items[u].attr(n,t);return this};w.clear=function(){while(this.length)this.pop()};w.splice=function(n,t){var r;n=n<0?o(this.length+n,0):n;t=o(0,l(this.length-n,t));for(var u=[],e=[],f=[],i=2;i<arguments.length;i++)f.push(arguments[i]);for(i=0;i<t;i++)e.push(this[n+i]);for(;i<this.length-n;i++)u.push(this[n+i]);for(r=f.length,i=0;i<r+u.length;i++)this.items[n+i]=this[n+i]=i<r?f[i]:u[i-r];for(i=this.items.length=this.length-=t-r;this[i];)delete this[i++];return new yt(e)};w.exclude=function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]==n)return this.splice(t,1),!0};w.animate=function(n,t,r,u){var o;(i.is(r,"function")||!r)&&(u=r||null);var e=this.items.length,f=e,h,c=this,s;if(!e)return this;for(u&&(s=function(){--e||u.call(c)}),r=i.is(r,ii)?r:s,o=i.animation(n,t,r,s),h=this.items[--f].animate(o);f--;)this.items[f]&&!this.items[f].removed&&this.items[f].animateWith(h,o,o),this.items[f]&&!this.items[f].removed||e--;return this};w.insertAfter=function(n){for(var t=this.items.length;t--;)this.items[t].insertAfter(n);return this};w.getBBox=function(){for(var n,t=[],i=[],r=[],u=[],f=this.items.length;f--;)this.items[f].removed||(n=this.items[f].getBBox(),t.push(n.x),i.push(n.y),r.push(n.x+n.width),u.push(n.y+n.height));return t=l[v](0,t),i=l[v](0,i),r=o[v](0,r),u=o[v](0,u),{x:t,y:i,x2:r,y2:u,width:r-t,height:u-i}};w.clone=function(n){n=this.paper.set();for(var t=0,i=this.items.length;t<i;t++)n.push(this.items[t].clone());return n};w.toString=function(){return"Raphaël‘s set"};w.glow=function(n){var t=this.paper.set();return this.forEach(function(i){var r=i.glow(n);r!=null&&r.forEach(function(n){t.push(n)})}),t};w.isPointInside=function(n,t){var i=!1;return this.forEach(function(r){if(r.isPointInside(n,t))return i=!0,!1}),i};i.registerFont=function(n){var i,u,f,r,t,e;if(!n.face)return n;this.fonts=this.fonts||{};i={w:n.w,face:{},glyphs:{}};u=n.face["font-family"];for(f in n.face)n.face[a](f)&&(i.face[f]=n.face[f]);if(this.fonts[u]?this.fonts[u].push(i):this.fonts[u]=[i],!n.svg){i.face["units-per-em"]=ht(n.face["units-per-em"],10);for(r in n.glyphs)if(n.glyphs[a](r)&&(t=n.glyphs[r],i.glyphs[r]={w:t.w,k:{},d:t.d&&"M"+t.d.replace(/[mlcxtrv]/g,function(n){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[n]||"M"})+"z"},t.k))for(e in t.k)t[a](e)&&(i.glyphs[r].k[e]=t.k[e])}return n};c.getFont=function(n,t,r,u){var f,h,o,e,s,c;if(u=u||"normal",r=r||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,i.fonts){if(f=i.fonts[n],!f){h=new RegExp("(^|\\s)"+n.replace(/[^\w\d\s+!~.:_-]/g,d)+"(\\s|$)","i");for(o in i.fonts)if(i.fonts[a](o)&&h.test(o)){f=i.fonts[o];break}}if(f)for(s=0,c=f.length;s<c;s++)if(e=f[s],e.face["font-weight"]==t&&(e.face["font-style"]==r||!e.face["font-style"])&&e.face["font-stretch"]==u)break;return e}};c.print=function(n,t,r,u,f,e,s,h){var a,et,k,y;e=e||"middle";s=o(l(s||0,1),-1);h=o(l(h||1,3),1);var v=b(r)[ut](d),g=0,p=0,tt=d,c;if(i.is(u,"string")&&(u=this.getFont(u)),u){c=(f||16)/u.face["units-per-em"];var w=u.face.bbox[ut](pi),it=+w[0],nt=w[3]-w[1],rt=0,ft=+w[1]+(e=="baseline"?nt+ +u.face.descent:nt/2);for(a=0,et=v.length;a<et;a++)v[a]=="\n"?(g=0,y=0,p=0,rt+=nt*h):(k=p&&u.glyphs[v[a-1]]||{},y=u.glyphs[v[a]],g+=p?(k.w||u.w)+(k.k&&k.k[v[a]]||0)+u.w*s:0,p=1),y&&y.d&&(tt+=i.transformPath(y.d,["t",g*c,rt*c,"s",c,c,it,ft,"t",(n-it)/c,(t-ft)/c]))}return this.path(tt).attr({fill:"#000",stroke:"none"})};c.add=function(n){if(i.is(n,"array"))for(var u=this.set(),r=0,f=n.length,t;r<f;r++)t=n[r]||{},pu[a](t.type)&&u.push(this[t.type]().attr(t));return u};i.format=function(n,t){var r=i.is(t,tt)?[0][s](t):arguments;return n&&i.is(n,ii)&&r.length-1&&(n=n.replace(wu,function(n,t){return r[++t]==null?d:r[t]})),n||d};i.fullfill=function(){var n=/\{([^\}]+)\}/g,t=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,i=function(n,i,r){var u=r;return i.replace(t,function(n,t,i,r,f){t=t||r;u&&(t in u&&(u=u[t]),typeof u=="function"&&f&&(u=u()))}),u=(u==null||u==r?n:u)+""};return function(t,r){return String(t).replace(n,function(n,t){return i(n,t,r)})}}();i.ninja=function(){return wi.was?r.win.Raphael=wi.is:delete Raphael,i};i.st=w,function(n,t,r){function u(){/in/.test(n.readyState)?setTimeout(u,9):i.eve("raphael.DOMload")}n.readyState==null&&n.addEventListener&&(n.addEventListener(t,r=function(){n.removeEventListener(t,r,!1);n.readyState="complete"},!1),n.readyState="loading");u()}(document,"DOMContentLoaded");t.on("raphael.DOMload",function(){yi=!0});return function(){var nt,v;if(i.svg){var t="hasOwnProperty",u=String,f=parseFloat,tt=parseInt,c=Math,k=c.max,y=c.abs,d=c.pow,l=/[, ]+/,p=i.eve,o="",w=" ",a="http://www.w3.org/1999/xlink",ft={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},e={};i.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var n=function(r,f){if(f){typeof r=="string"&&(r=n(r));for(var e in f)f[t](e)&&(e.substring(0,6)=="xlink:"?r.setAttributeNS(a,e.substring(6),u(f[e])):r.setAttribute(e,u(f[e])))}else r=i._g.doc.createElementNS("http://www.w3.org/2000/svg",r),r.style&&(r.style.webkitTapHighlightColor="rgba(0,0,0,0)");return r},it=function(t,r){var w="linear",l=t.id+r,b=.5,s=.5,tt=t.node,it=t.paper,g=tt.style,a=i._g.doc.getElementById(l),v,e,nt,p,h,rt;if(!a){if(r=u(r).replace(i._radial_gradient,function(n,t,i){if(w="radial",t&&i){b=f(t);s=f(i);var r=(s>.5)*2-1;d(b-.5,2)+d(s-.5,2)>.25&&(s=c.sqrt(.25-d(b-.5,2))*r+.5)&&s!=.5&&(s=s.toFixed(5)-1e-5*r)}return o}),r=r.split(/\s*\-\s*/),w=="linear"){if(v=r.shift(),v=-f(v),isNaN(v))return null;e=[0,0,c.cos(i.rad(v)),c.sin(i.rad(v))];nt=1/(k(y(e[2]),y(e[3]))||1);e[2]*=nt;e[3]*=nt;e[2]<0&&(e[0]=-e[2],e[2]=0);e[3]<0&&(e[1]=-e[3],e[3]=0)}if(p=i._parseDots(r),!p)return null;if(l=l.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&l!=t.gradient.id&&(it.defs.removeChild(t.gradient),delete t.gradient),!t.gradient)for(a=n(w+"Gradient",{id:l}),t.gradient=a,n(a,w=="radial"?{fx:b,fy:s}:{x1:e[0],y1:e[1],x2:e[2],y2:e[3],gradientTransform:t.matrix.invert()}),it.defs.appendChild(a),h=0,rt=p.length;h<rt;h++)a.appendChild(n("stop",{offset:p[h].offset?p[h].offset:h?"100%":"0%","stop-color":p[h].color||"#fff"}))}return n(tt,{fill:"url(#"+l+")",opacity:1,"fill-opacity":1}),g.fill=o,g.opacity=1,g.fillOpacity=1,1},b=function(t){var i=t.getBBox(1);n(t.pattern,{patternTransform:t.matrix.invert()+" translate("+i.x+","+i.y+")"})},s=function(r,f,s){var b,k,g,tt,it,rt;if(r.type=="path"){for(var ut=u(f).toLowerCase().split("-"),ht=r.paper,h=s?"end":"start",ct=r.node,l=r.attrs,d=l["stroke-width"],et=ut.length,a="classic",p,w,ot,st,c,v=3,y=3,nt=5;et--;)switch(ut[et]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":a=ut[et];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":v=5;break;case"short":v=2}a=="open"?(v+=2,y+=2,nt+=2,ot=1,st=s?4:1,c={fill:"none",stroke:l.stroke}):(st=ot=v/2,c={fill:l.stroke,stroke:"none"});r._.arrows?s?(r._.arrows.endPath&&e[r._.arrows.endPath]--,r._.arrows.endMarker&&e[r._.arrows.endMarker]--):(r._.arrows.startPath&&e[r._.arrows.startPath]--,r._.arrows.startMarker&&e[r._.arrows.startMarker]--):r._.arrows={};a!="none"?(b="raphael-marker-"+a,k="raphael-marker-"+h+a+v+y,i._g.doc.getElementById(b)?e[b]++:(ht.defs.appendChild(n(n("path"),{"stroke-linecap":"round",d:ft[a],id:b})),e[b]=1),g=i._g.doc.getElementById(k),g?(e[k]++,tt=g.getElementsByTagName("use")[0]):(g=n(n("marker"),{id:k,markerHeight:y,markerWidth:v,orient:"auto",refX:st,refY:y/2}),tt=n(n("use"),{"xlink:href":"#"+b,transform:(s?"rotate(180 "+v/2+" "+y/2+") ":o)+"scale("+v/nt+","+y/nt+")","stroke-width":(2/(v/nt+y/nt)).toFixed(4)}),g.appendChild(tt),ht.defs.appendChild(g),e[k]=1),n(tt,c),it=ot*(a!="diamond"&&a!="oval"),s?(p=r._.arrows.startdx*d||0,w=i.getTotalLength(l.path)-it*d):(p=it*d,w=i.getTotalLength(l.path)-(r._.arrows.enddx*d||0)),c={},c["marker-"+h]="url(#"+k+")",(w||p)&&(c.d=i.getSubpath(l.path,p,w)),n(ct,c),r._.arrows[h+"Path"]=b,r._.arrows[h+"Marker"]=k,r._.arrows[h+"dx"]=it,r._.arrows[h+"Type"]=a,r._.arrows[h+"String"]=f):(s?(p=r._.arrows.startdx*d||0,w=i.getTotalLength(l.path)-p):(p=0,w=i.getTotalLength(l.path)-(r._.arrows.enddx*d||0)),r._.arrows[h+"Path"]&&n(ct,{d:i.getSubpath(l.path,p,w)}),delete r._.arrows[h+"Path"],delete r._.arrows[h+"Marker"],delete r._.arrows[h+"dx"],delete r._.arrows[h+"Type"],delete r._.arrows[h+"String"]);for(c in e)e[t](c)&&!e[c]&&(rt=i._g.doc.getElementById(c),rt&&rt.parentNode.removeChild(rt))}},et={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},rt=function(t,i,r){if(i=et[u(i).toLowerCase()],i){for(var e=t.attrs["stroke-width"]||"1",s={round:e,square:e,butt:0}[t.attrs["stroke-linecap"]||r["stroke-linecap"]]||0,o=[],f=i.length;f--;)o[f]=i[f]*e+(f%2?1:-1)*s;n(t.node,{"stroke-dasharray":o.join(",")})}},g=function(r,f){var h=r.node,c=r.attrs,pt=h.style.visibility,v,e,d,vt,g,et,nt,p,st,at,ht,ct,lt,w,ut,ft,yt;h.style.visibility="hidden";for(v in f)if(f[t](v)){if(!i._availableAttrs[t](v))continue;e=f[v];c[v]=e;switch(v){case"blur":r.blur(e);break;case"title":d=h.getElementsByTagName("title");d.length&&(d=d[0])?d.firstChild.nodeValue=e:(d=n("title"),vt=i._g.doc.createTextNode(e),d.appendChild(vt),h.appendChild(d));break;case"href":case"target":g=h.parentNode;g.tagName.toLowerCase()!="a"&&(et=n("a"),g.insertBefore(et,h),et.appendChild(h),g=et);v=="target"?g.setAttributeNS(a,"show",e=="blank"?"new":e):g.setAttributeNS(a,v,e);break;case"cursor":h.style.cursor=e;break;case"transform":r.transform(e);break;case"arrow-start":s(r,e);break;case"arrow-end":s(r,e,1);break;case"clip-rect":nt=u(e).split(l);nt.length==4&&(r.clip&&r.clip.parentNode.parentNode.removeChild(r.clip.parentNode),p=n("clipPath"),st=n("rect"),p.id=i.createUUID(),n(st,{x:nt[0],y:nt[1],width:nt[2],height:nt[3]}),p.appendChild(st),r.paper.defs.appendChild(p),n(h,{"clip-path":"url(#"+p.id+")"}),r.clip=st);e||(at=h.getAttribute("clip-path"),at&&(ht=i._g.doc.getElementById(at.replace(/(^url\(#|\)$)/g,o)),ht&&ht.parentNode.removeChild(ht),n(h,{"clip-path":o}),delete r.clip));break;case"path":r.type=="path"&&(n(h,{d:e?c.path=i._pathToAbsolute(e):"M0,0"}),r._.dirty=1,r._.arrows&&("startString"in r._.arrows&&s(r,r._.arrows.startString),"endString"in r._.arrows&&s(r,r._.arrows.endString,1)));break;case"width":if(h.setAttribute(v,e),r._.dirty=1,c.fx)v="x",e=c.x;else break;case"x":c.fx&&(e=-c.x-(c.width||0));case"rx":if(v=="rx"&&r.type=="rect")break;case"cx":h.setAttribute(v,e);r.pattern&&b(r);r._.dirty=1;break;case"height":if(h.setAttribute(v,e),r._.dirty=1,c.fy)v="y",e=c.y;else break;case"y":c.fy&&(e=-c.y-(c.height||0));case"ry":if(v=="ry"&&r.type=="rect")break;case"cy":h.setAttribute(v,e);r.pattern&&b(r);r._.dirty=1;break;case"r":r.type=="rect"?n(h,{rx:e,ry:e}):h.setAttribute(v,e);r._.dirty=1;break;case"src":r.type=="image"&&h.setAttributeNS(a,"href",e);break;case"stroke-width":(r._.sx!=1||r._.sy!=1)&&(e/=k(y(r._.sx),y(r._.sy))||1);r.paper._vbSize&&(e*=r.paper._vbSize);h.setAttribute(v,e);c["stroke-dasharray"]&&rt(r,c["stroke-dasharray"],f);r._.arrows&&("startString"in r._.arrows&&s(r,r._.arrows.startString),"endString"in r._.arrows&&s(r,r._.arrows.endString,1));break;case"stroke-dasharray":rt(r,e,f);break;case"fill":if(ct=u(e).match(i._ISURL),ct){p=n("pattern");lt=n("image");p.id=i.createUUID();n(p,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});n(lt,{x:0,y:0,"xlink:href":ct[1]});p.appendChild(lt),function(t){i._preload(ct[1],function(){var i=this.offsetWidth,u=this.offsetHeight;n(t,{width:i,height:u});n(lt,{width:i,height:u});r.paper.safari()})}(p);r.paper.defs.appendChild(p);n(h,{fill:"url(#"+p.id+")"});r.pattern=p;r.pattern&&b(r);break}if(w=i.getRGB(e),w.error){if((r.type=="circle"||r.type=="ellipse"||u(e).charAt()!="r")&&it(r,e)){("opacity"in c||"fill-opacity"in c)&&(ut=i._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,o)),ut&&(ft=ut.getElementsByTagName("stop"),n(ft[ft.length-1],{"stop-opacity":("opacity"in c?c.opacity:1)*("fill-opacity"in c?c["fill-opacity"]:1)})));c.gradient=e;c.fill="none";break}}else delete f.gradient,delete c.gradient,!i.is(c.opacity,"undefined")&&i.is(f.opacity,"undefined")&&n(h,{opacity:c.opacity}),!i.is(c["fill-opacity"],"undefined")&&i.is(f["fill-opacity"],"undefined")&&n(h,{"fill-opacity":c["fill-opacity"]});w[t]("opacity")&&n(h,{"fill-opacity":w.opacity>1?w.opacity/100:w.opacity});case"stroke":w=i.getRGB(e);h.setAttribute(v,w.hex);v=="stroke"&&w[t]("opacity")&&n(h,{"stroke-opacity":w.opacity>1?w.opacity/100:w.opacity});v=="stroke"&&r._.arrows&&("startString"in r._.arrows&&s(r,r._.arrows.startString),"endString"in r._.arrows&&s(r,r._.arrows.endString,1));break;case"gradient":(r.type=="circle"||r.type=="ellipse"||u(e).charAt()!="r")&&it(r,e);break;case"opacity":c.gradient&&!c[t]("stroke-opacity")&&n(h,{"stroke-opacity":e>1?e/100:e});case"fill-opacity":if(c.gradient){ut=i._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,o));ut&&(ft=ut.getElementsByTagName("stop"),n(ft[ft.length-1],{"stop-opacity":e}));break}default:v=="font-size"&&(e=tt(e,10)+"px");yt=v.replace(/(\-.)/g,function(n){return n.substring(1).toUpperCase()});h.style[yt]=e;r._.dirty=1;h.setAttribute(v,e)}}ot(r,f);h.style.visibility=pt},ut=1.2,ot=function(r,f){var y,h,l,e,a,p,v;if(r.type=="text"&&(f[t]("text")||f[t]("font")||f[t]("font-size")||f[t]("x")||f[t]("y"))){var c=r.attrs,s=r.node,w=s.firstChild?tt(i._g.doc.defaultView.getComputedStyle(s.firstChild,o).getPropertyValue("font-size"),10):10;if(f[t]("text")){for(c.text=f.text;s.firstChild;)s.removeChild(s.firstChild);for(y=u(f.text).split("\n"),h=[],e=0,a=y.length;e<a;e++)l=n("tspan"),e&&n(l,{dy:w*ut,x:c.x}),l.appendChild(i._g.doc.createTextNode(y[e])),s.appendChild(l),h[e]=l}else for(h=s.getElementsByTagName("tspan"),e=0,a=h.length;e<a;e++)e?n(h[e],{dy:w*ut,x:c.x}):n(h[0],{dy:0});n(s,{x:c.x,y:c.y});r._.dirty=1;p=r._getBBox();v=c.y-(p.y+p.height/2);v&&i.is(v,"finite")&&n(h[0],{dy:v})}},h=function(n,t){this[0]=this.node=n;n.raphael=!0;this.id=i._oid++;n.raphaelid=this.id;this.matrix=i.matrix();this.realPath=null;this.paper=t;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};t.bottom||(t.bottom=this);this.prev=t.top;t.top&&(t.top.next=this);t.top=this;this.next=null},r=i.el;h.prototype=r;r.constructor=h;i._engine.path=function(t,i){var u=n("path"),r;return i.canvas&&i.canvas.appendChild(u),r=new h(u,i),r.type="path",g(r,{fill:"none",stroke:"#000",path:t}),r};r.rotate=function(n,t,i){if(this.removed)return this;if(n=u(n).split(l),n.length-1&&(t=f(n[1]),i=f(n[2])),n=f(n[0]),i==null&&(t=i),t==null||i==null){var r=this.getBBox(1);t=r.x+r.width/2;i=r.y+r.height/2}return this.transform(this._.transform.concat([["r",n,t,i]])),this};r.scale=function(n,t,i,r){if(this.removed)return this;if(n=u(n).split(l),n.length-1&&(t=f(n[1]),i=f(n[2]),r=f(n[3])),n=f(n[0]),t==null&&(t=n),r==null&&(i=r),i==null||r==null)var e=this.getBBox(1);return i=i==null?e.x+e.width/2:i,r=r==null?e.y+e.height/2:r,this.transform(this._.transform.concat([["s",n,t,i,r]])),this};r.translate=function(n,t){return this.removed?this:(n=u(n).split(l),n.length-1&&(t=f(n[1])),n=f(n[0])||0,t=+t||0,this.transform(this._.transform.concat([["t",n,t]])),this)};r.transform=function(r){var u=this._,f;return r==null?u.transform:(i._extractTransform(this,r),this.clip&&n(this.clip,{transform:this.matrix.invert()}),this.pattern&&b(this),this.node&&n(this.node,{transform:this.matrix}),(u.sx!=1||u.sy!=1)&&(f=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1,this.attr({"stroke-width":f})),this)};r.hide=function(){return this.removed||this.paper.safari(this.node.style.display="none"),this};r.show=function(){return this.removed||this.paper.safari(this.node.style.display=""),this};r.remove=function(){var n,t;if(!this.removed&&this.node.parentNode){n=this.paper;n.__set__&&n.__set__.exclude(this);p.unbind("raphael.*.*."+this.id);this.gradient&&n.defs.removeChild(this.gradient);i._tear(this,n);this.node.parentNode.tagName.toLowerCase()=="a"?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(t in this)this[t]=typeof this[t]=="function"?i._removedFactory(t):null;this.removed=!0}};r._getBBox=function(){var t,n;this.node.style.display=="none"&&(this.show(),t=!0);n={};try{n=this.node.getBBox()}catch(i){}finally{n=n||{}}return t&&this.hide(),n};r.attr=function(n,r){var e,c,a,s,o,h,f,u,v,y;if(this.removed)return this;if(n==null){e={};for(c in this.attrs)this.attrs[t](c)&&(e[c]=this.attrs[c]);return e.gradient&&e.fill=="none"&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(r==null&&i.is(n,"string")){if(n=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(n=="transform")return this._.transform;for(a=n.split(l),s={},o=0,h=a.length;o<h;o++)n=a[o],s[n]=n in this.attrs?this.attrs[n]:i.is(this.paper.customAttributes[n],"function")?this.paper.customAttributes[n].def:i._availableAttrs[n];return h-1?s:s[a[0]]}if(r==null&&i.is(n,"array")){for(s={},o=0,h=n.length;o<h;o++)s[n[o]]=this.attr(n[o]);return s}r!=null?(f={},f[n]=r):n!=null&&i.is(n,"object")&&(f=n);for(u in f)p("raphael.attr."+u+"."+this.id,this,f[u]);for(u in this.paper.customAttributes)if(this.paper.customAttributes[t](u)&&f[t](u)&&i.is(this.paper.customAttributes[u],"function")){v=this.paper.customAttributes[u].apply(this,[].concat(f[u]));this.attrs[u]=f[u];for(y in v)v[t](y)&&(f[y]=v[y])}return g(this,f),this};r.toFront=function(){if(this.removed)return this;this.node.parentNode.tagName.toLowerCase()=="a"?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var n=this.paper;return n.top!=this&&i._tofront(this,n),this};r.toBack=function(){var n,t;return this.removed?this:(n=this.node.parentNode,n.tagName.toLowerCase()=="a"?n.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):n.firstChild!=this.node&&n.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper),t=this.paper,this)};r.insertAfter=function(n){if(this.removed)return this;var t=n.node||n[n.length-1].node;return t.nextSibling?t.parentNode.insertBefore(this.node,t.nextSibling):t.parentNode.appendChild(this.node),i._insertafter(this,n,this.paper),this};r.insertBefore=function(n){if(this.removed)return this;var t=n.node||n[0].node;return t.parentNode.insertBefore(this.node,t),i._insertbefore(this,n,this.paper),this};r.blur=function(t){var r=this,u,f;return+t!=0?(u=n("filter"),f=n("feGaussianBlur"),r.attrs.blur=t,u.id=i.createUUID(),n(f,{stdDeviation:+t||1.5}),u.appendChild(f),r.paper.defs.appendChild(u),r._blur=u,n(r.node,{filter:"url(#"+u.id+")"})):(r._blur&&(r._blur.parentNode.removeChild(r._blur),delete r._blur,delete r.attrs.blur),r.node.removeAttribute("filter")),r};i._engine.circle=function(t,i,r,u){var e=n("circle"),f;return t.canvas&&t.canvas.appendChild(e),f=new h(e,t),f.attrs={cx:i,cy:r,r:u,fill:"none",stroke:"#000"},f.type="circle",n(e,f.attrs),f};i._engine.rect=function(t,i,r,u,f,e){var s=n("rect"),o;return t.canvas&&t.canvas.appendChild(s),o=new h(s,t),o.attrs={x:i,y:r,width:u,height:f,r:e||0,rx:e||0,ry:e||0,fill:"none",stroke:"#000"},o.type="rect",n(s,o.attrs),o};i._engine.ellipse=function(t,i,r,u,f){var o=n("ellipse"),e;return t.canvas&&t.canvas.appendChild(o),e=new h(o,t),e.attrs={cx:i,cy:r,rx:u,ry:f,fill:"none",stroke:"#000"},e.type="ellipse",n(o,e.attrs),e};i._engine.image=function(t,i,r,u,f,e){var o=n("image"),s;return n(o,{x:r,y:u,width:f,height:e,preserveAspectRatio:"none"}),o.setAttributeNS(a,"href",i),t.canvas&&t.canvas.appendChild(o),s=new h(o,t),s.attrs={x:r,y:u,width:f,height:e,src:i},s.type="image",s};i._engine.text=function(t,r,u,f){var o=n("text"),e;return t.canvas&&t.canvas.appendChild(o),e=new h(o,t),e.attrs={x:r,y:u,"text-anchor":"middle",text:f,font:i._availableAttrs.font,stroke:"none",fill:"#000"},e.type="text",g(e,e.attrs),e};i._engine.setSize=function(n,t){return this.width=n||this.width,this.height=t||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this};i._engine.create=function(){var u=i._getContainer.apply(0,arguments),t=u&&u.container,o=u.x,s=u.y,f=u.width,e=u.height,r,h,c;if(!t)throw new Error("SVG container not found.");return r=n("svg"),h="overflow:hidden;",o=o||0,s=s||0,f=f||512,e=e||342,n(r,{height:e,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),t==1?(r.style.cssText=h+"position:absolute;left:"+o+"px;top:"+s+"px",i._g.doc.body.appendChild(r),c=1):(r.style.cssText=h+"position:relative",t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r)),t=new i._Paper,t.width=f,t.height=e,t.canvas=r,t.clear(),t._left=t._top=0,c&&(t.renderfix=function(){}),t.renderfix(),t};i._engine.setViewBox=function(t,i,r,u,f){p("raphael.setViewBox",this,this._viewBox,[t,i,r,u,f]);var o=k(r/this.width,u/this.height),e=this.top,c=f?"xMidYMid meet":"xMinYMin",s,h;for(t==null?(this._vbSize&&(o=1),delete this._vbSize,s="0 0 "+this.width+w+this.height):(this._vbSize=o,s=t+w+i+w+r+w+u),n(this.canvas,{viewBox:s,preserveAspectRatio:c});o&&e;)h="stroke-width"in e.attrs?e.attrs["stroke-width"]:1,e.attr({"stroke-width":h}),e._.dirty=1,e._.dirtyT=1,e=e.prev;return this._viewBox=[t,i,r,u,!!f],this};i.prototype.renderfix=function(){var n=this.canvas,u=n.style,t,i,r;try{t=n.getScreenCTM()||n.createSVGMatrix()}catch(f){t=n.createSVGMatrix()}i=-t.e%1;r=-t.f%1;(i||r)&&(i&&(this._left=(this._left+i)%1,u.left=this._left+"px"),r&&(this._top=(this._top+r)%1,u.top=this._top+"px"))};i.prototype.clear=function(){i.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null;(this.desc=n("desc")).appendChild(i._g.doc.createTextNode("Created with Raphaël "+i.version));t.appendChild(this.desc);t.appendChild(this.defs=n("defs"))};i.prototype.remove=function(){p("raphael.remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var n in this)this[n]=typeof this[n]=="function"?i._removedFactory(n):null};nt=i.st;for(v in r)r[t](v)&&!nt[t](v)&&(nt[v]=function(n){return function(){var t=arguments;return this.forEach(function(i){i[n].apply(i,t)})}}(v))}}(),function(){var s,d,y;if(i.vml){var h="hasOwnProperty",t=String,f=parseFloat,c=Math,e=c.round,k=c.max,g=c.min,p=c.abs,l="fill",a=/[, ]+/,ut=i.eve,ft=" progid:DXImageTransform.Microsoft",o=" ",u="",nt={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},et=/([clmz]),?([^clmz]*)/gi,ot=/ progid:\S+Blur\([^\)]+\)/g,st=/-?[^,\s-]+/g,tt="position:absolute;left:0;top:0;width:1px;height:1px",n=21600,ht={path:1,rect:1,image:1},ct={circle:1,ellipse:1},lt=function(r){var l=/[ahqstv]/ig,a=i._pathToAbsolute,v,c,y,f,s,w,h,p;if(t(r).match(l)&&(a=i._path2curve),l=/[clmz]/g,a==i._pathToAbsolute&&!t(r).match(l))return t(r).replace(et,function(t,i,r){var u=[],o=i.toLowerCase()=="m",f=nt[i];return r.replace(st,function(t){o&&u.length==2&&(f+=u+nt[i=="m"?"l":"L"],u=[]);u.push(e(t*n))}),f+u});for(c=a(r),v=[],s=0,w=c.length;s<w;s++){for(y=c[s],f=c[s][0].toLowerCase(),f=="z"&&(f="x"),h=1,p=y.length;h<p;h++)f+=e(y[h]*n)+(h!=p-1?",":u);v.push(f)}return v.join(o)},it=function(n,t,r){var u=i.matrix();return u.rotate(-n,.5,.5),{dx:u.x(t,r),dy:u.y(t,r)}},w=function(t,i,r,u,f,e){var v=t._,k=t.matrix,h=v.fillpos,c=t.node,y=c.style,w=1,b="",d=n/i,g=n/r,a,s;(y.visibility="hidden",i&&r)&&(c.coordsize=p(d)+o+p(g),y.rotation=e*(i*r<0?-1:1),e&&(a=it(e,u,f),u=a.dx,f=a.dy),i<0&&(b+="x"),r<0&&(b+=" y")&&(w=-1),y.flip=b,c.coordorigin=u*-d+o+f*-g,(h||v.fillsize)&&(s=c.getElementsByTagName(l),s=s&&s[0],c.removeChild(s),h&&(a=it(e,k.x(h[0],h[1]),k.y(h[0],h[1])),s.position=a.dx*w+o+a.dy*w),v.fillsize&&(s.size=v.fillsize[0]*p(i)+o+v.fillsize[1]*p(r)),c.appendChild(s)),y.visibility="visible")};i.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var rt=function(n,i,r){for(var u=t(i).toLowerCase().split("-"),o=r?"end":"start",f=u.length,s="classic",h="medium",c="medium",e;f--;)switch(u[f]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":s=u[f];break;case"wide":case"narrow":c=u[f];break;case"long":case"short":h=u[f]}e=n.node.getElementsByTagName("stroke")[0];e[o+"arrow"]=s;e[o+"arrowlength"]=h;e[o+"arrowwidth"]=c},v=function(r,c){var yt,nt,ot,ut,ft,y,si,pt,st,tt,d,dt,gt,et,ni,vt,ri,bt,hi;r.attrs=r.attrs||{};var b=r.node,v=r.attrs,it=b.style,ui=ht[r.type]&&(c.x!=v.x||c.y!=v.y||c.width!=v.width||c.height!=v.height||c.cx!=v.cx||c.cy!=v.cy||c.rx!=v.rx||c.ry!=v.ry||c.r!=v.r),ci=ct[r.type]&&(v.cx!=c.cx||v.cy!=c.cy||v.r!=c.r||v.rx!=c.rx||v.ry!=c.ry),p=r;for(yt in c)c[h](yt)&&(v[yt]=c[yt]);if(ui&&(v.path=i._getPath[r.type](r),r._.dirty=1),c.href&&(b.href=c.href),c.title&&(b.title=c.title),c.target&&(b.target=c.target),c.cursor&&(it.cursor=c.cursor),"blur"in c&&r.blur(c.blur),(c.path&&r.type=="path"||ui)&&(b.path=lt(~t(v.path).toLowerCase().indexOf("r")?i._pathToAbsolute(v.path):v.path),r.type=="image"&&(r._.fillpos=[v.x,v.y],r._.fillsize=[v.width,v.height],w(r,1,1,0,0,0))),"transform"in c&&r.transform(c.transform),ci){var kt=+v.cx,fi=+v.cy,ei=+v.rx||+v.r||0,oi=+v.ry||+v.r||0;b.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",e((kt-ei)*n),e((fi-oi)*n),e((kt+ei)*n),e((fi+oi)*n),e(kt*n));r._.dirty=1}if("clip-rect"in c&&(nt=t(c["clip-rect"]).split(a),nt.length==4&&(nt[2]=+nt[2]+ +nt[0],nt[3]=+nt[3]+ +nt[1],ot=b.clipRect||i._g.doc.createElement("div"),ut=ot.style,ut.clip=i.format("rect({1}px {2}px {3}px {0}px)",nt),b.clipRect||(ut.position="absolute",ut.top=0,ut.left=0,ut.width=r.paper.width+"px",ut.height=r.paper.height+"px",b.parentNode.insertBefore(ot,b),ot.appendChild(b),b.clipRect=ot)),c["clip-rect"]||b.clipRect&&(b.clipRect.style.clip="auto")),r.textpath&&(ft=r.textpath.style,c.font&&(ft.font=c.font),c["font-family"]&&(ft.fontFamily='"'+c["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,u)+'"'),c["font-size"]&&(ft.fontSize=c["font-size"]),c["font-weight"]&&(ft.fontWeight=c["font-weight"]),c["font-style"]&&(ft.fontStyle=c["font-style"])),"arrow-start"in c&&rt(p,c["arrow-start"]),"arrow-end"in c&&rt(p,c["arrow-end"],1),(c.opacity!=null||c["stroke-width"]!=null||c.fill!=null||c.src!=null||c.stroke!=null||c["stroke-width"]!=null||c["stroke-opacity"]!=null||c["fill-opacity"]!=null||c["stroke-dasharray"]!=null||c["stroke-miterlimit"]!=null||c["stroke-linejoin"]!=null||c["stroke-linecap"]!=null)&&(y=b.getElementsByTagName(l),si=!1,y=y&&y[0],y||(si=y=s(l)),r.type=="image"&&c.src&&(y.src=c.src),c.fill&&(y.on=!0),(y.on==null||c.fill=="none"||c.fill===null)&&(y.on=!1),y.on&&c.fill&&(pt=t(c.fill).match(i._ISURL),pt?(y.parentNode==b&&b.removeChild(y),y.rotate=!0,y.src=pt[1],y.type="tile",st=r.getBBox(1),y.position=st.x+o+st.y,r._.fillpos=[st.x,st.y],i._preload(pt[1],function(){r._.fillsize=[this.offsetWidth,this.offsetHeight]})):(y.color=i.getRGB(c.fill).hex,y.src=u,y.type="solid",i.getRGB(c.fill).error&&(p.type in{circle:1,ellipse:1}||t(c.fill).charAt()!="r")&&at(p,c.fill,y)&&(v.fill="none",v.gradient=c.fill,y.rotate=!1))),("fill-opacity"in c||"opacity"in c)&&(tt=((+v["fill-opacity"]+1||2)-1)*((+v.opacity+1||2)-1)*((+i.getRGB(c.fill).o+1||2)-1),tt=g(k(tt,0),1),y.opacity=tt,y.src&&(y.color="none")),b.appendChild(y),d=b.getElementsByTagName("stroke")&&b.getElementsByTagName("stroke")[0],dt=!1,d||(dt=d=s("stroke")),(c.stroke&&c.stroke!="none"||c["stroke-width"]||c["stroke-opacity"]!=null||c["stroke-dasharray"]||c["stroke-miterlimit"]||c["stroke-linejoin"]||c["stroke-linecap"])&&(d.on=!0),(c.stroke=="none"||c.stroke===null||d.on==null||c.stroke==0||c["stroke-width"]==0)&&(d.on=!1),gt=i.getRGB(c.stroke),d.on&&c.stroke&&(d.color=gt.hex),tt=((+v["stroke-opacity"]+1||2)-1)*((+v.opacity+1||2)-1)*((+gt.o+1||2)-1),et=(f(c["stroke-width"])||1)*.75,tt=g(k(tt,0),1),c["stroke-width"]==null&&(et=v["stroke-width"]),c["stroke-width"]&&(d.weight=et),et&&et<1&&(tt*=et)&&(d.weight=1),d.opacity=tt,c["stroke-linejoin"]&&(d.joinstyle=c["stroke-linejoin"]||"miter"),d.miterlimit=c["stroke-miterlimit"]||8,c["stroke-linecap"]&&(d.endcap=c["stroke-linecap"]=="butt"?"flat":c["stroke-linecap"]=="square"?"square":"round"),"stroke-dasharray"in c&&(ni={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},d.dashstyle=ni[h](c["stroke-dasharray"])?ni[c["stroke-dasharray"]]:u),dt&&b.appendChild(d)),p.type=="text"){p.paper.canvas.style.display=u;var ti=p.paper.span,ii=100,wt=v.font&&v.font.match(/\d+(?:\.\d*)?(?=px)/);for(it=ti.style,v.font&&(it.font=v.font),v["font-family"]&&(it.fontFamily=v["font-family"]),v["font-weight"]&&(it.fontWeight=v["font-weight"]),v["font-style"]&&(it.fontStyle=v["font-style"]),wt=f(v["font-size"]||wt&&wt[0])||10,it.fontSize=wt*ii+"px",p.textpath.string&&(ti.innerHTML=t(p.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>")),vt=ti.getBoundingClientRect(),p.W=v.w=(vt.right-vt.left)/ii,p.H=v.h=(vt.bottom-vt.top)/ii,p.X=v.x,p.Y=v.y+p.H/2,(("x"in c)||("y"in c))&&(p.path.v=i.format("m{0},{1}l{2},{1}",e(v.x*n),e(v.y*n),e(v.x*n)+1)),ri=["x","y","text","font","font-family","font-weight","font-style","font-size"],bt=0,hi=ri.length;bt<hi;bt++)if(ri[bt]in c){p._.dirty=1;break}switch(v["text-anchor"]){case"start":p.textpath.style["v-text-align"]="left";p.bbx=p.W/2;break;case"end":p.textpath.style["v-text-align"]="right";p.bbx=-p.W/2;break;default:p.textpath.style["v-text-align"]="center";p.bbx=0}p.textpath.style["v-text-kern"]=!0}},at=function(n,r,e){var l,s,a,h,w;n.attrs=n.attrs||{};var b=n.attrs,v=Math.pow,y="linear",p=".5 .5";if((n.attrs.gradient=r,r=t(r).replace(i._radial_gradient,function(n,t,i){return y="radial",t&&i&&(t=f(t),i=f(i),v(t-.5,2)+v(i-.5,2)>.25&&(i=c.sqrt(.25-v(t-.5,2))*((i>.5)*2-1)+.5),p=t+o+i),u}),r=r.split(/\s*\-\s*/),y=="linear"&&(l=r.shift(),l=-f(l),isNaN(l)))||(s=i._parseDots(r),!s))return null;if(n=n.shape||n.node,s.length){for(n.removeChild(e),e.on=!0,e.method="none",e.color=s[0].color,e.color2=s[s.length-1].color,a=[],h=0,w=s.length;h<w;h++)s[h].offset&&a.push(s[h].offset+o+s[h].color);e.colors=a.length?a.join():"0% "+e.color;y=="radial"?(e.type="gradientTitle",e.focus="100%",e.focussize="0 0",e.focusposition=p,e.angle=0):(e.type="gradient",e.angle=(270-l)%360);n.appendChild(e)}return 1},b=function(n,t){this[0]=this.node=n;n.raphael=!0;this.id=i._oid++;n.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=t;this.matrix=i.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};t.bottom||(t.bottom=this);this.prev=t.top;t.top&&(t.top.next=this);t.top=this;this.next=null},r=i.el;b.prototype=r;r.constructor=b;r.transform=function(r){var e,a,l;if(r==null)return this._.transform;e=this.paper._viewBoxShift;a=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:u;e&&(l=r=t(r).replace(/\.{3}|\u2026/g,this._.transform||u));i._extractTransform(this,a+r);var s=this.matrix.clone(),h=this.skew,c=this.node,f,v=~t(this.attrs.fill).indexOf("-"),d=!t(this.attrs.fill).indexOf("url(");if(s.translate(1,1),d||v||this.type=="image")if(h.matrix="1 0 0 1",h.offset="0 0",f=s.split(),v&&f.noRotation||!f.isSimple){c.style.filter=s.toFilter();var y=this.getBBox(),p=this.getBBox(1),b=y.x-p.x,k=y.y-p.y;c.coordorigin=b*-n+o+k*-n;w(this,1,1,b,k,0)}else c.style.filter=u,w(this,f.scalex,f.scaley,f.dx,f.dy,f.rotate);else c.style.filter=u,h.matrix=t(s),h.offset=s.offset();return l&&(this._.transform=l),this};r.rotate=function(n,i,r){if(this.removed)return this;if(n!=null){if(n=t(n).split(a),n.length-1&&(i=f(n[1]),r=f(n[2])),n=f(n[0]),r==null&&(i=r),i==null||r==null){var u=this.getBBox(1);i=u.x+u.width/2;r=u.y+u.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",n,i,r]])),this}};r.translate=function(n,i){return this.removed?this:(n=t(n).split(a),n.length-1&&(i=f(n[1])),n=f(n[0])||0,i=+i||0,this._.bbox&&(this._.bbox.x+=n,this._.bbox.y+=i),this.transform(this._.transform.concat([["t",n,i]])),this)};r.scale=function(n,i,r,u){if(this.removed)return this;if(n=t(n).split(a),n.length-1&&(i=f(n[1]),r=f(n[2]),u=f(n[3]),isNaN(r)&&(r=null),isNaN(u)&&(u=null)),n=f(n[0]),i==null&&(i=n),u==null&&(r=u),r==null||u==null)var e=this.getBBox(1);return r=r==null?e.x+e.width/2:r,u=u==null?e.y+e.height/2:u,this.transform(this._.transform.concat([["s",n,i,r,u]])),this._.dirtyT=1,this};r.hide=function(){return this.removed||(this.node.style.display="none"),this};r.show=function(){return this.removed||(this.node.style.display=u),this};r._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}};r.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this);i.eve.unbind("raphael.*.*."+this.id);i._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var n in this)this[n]=typeof this[n]=="function"?i._removedFactory(n):null;this.removed=!0}};r.attr=function(n,t){var f,c,y,o,e,s,r,u,p,w;if(this.removed)return this;if(n==null){f={};for(c in this.attrs)this.attrs[h](c)&&(f[c]=this.attrs[c]);return f.gradient&&f.fill=="none"&&(f.fill=f.gradient)&&delete f.gradient,f.transform=this._.transform,f}if(t==null&&i.is(n,"string")){if(n==l&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;for(y=n.split(a),o={},e=0,s=y.length;e<s;e++)n=y[e],o[n]=n in this.attrs?this.attrs[n]:i.is(this.paper.customAttributes[n],"function")?this.paper.customAttributes[n].def:i._availableAttrs[n];return s-1?o:o[y[0]]}if(this.attrs&&t==null&&i.is(n,"array")){for(o={},e=0,s=n.length;e<s;e++)o[n[e]]=this.attr(n[e]);return o}t!=null&&(r={},r[n]=t);t==null&&i.is(n,"object")&&(r=n);for(u in r)ut("raphael.attr."+u+"."+this.id,this,r[u]);if(r){for(u in this.paper.customAttributes)if(this.paper.customAttributes[h](u)&&r[h](u)&&i.is(this.paper.customAttributes[u],"function")){p=this.paper.customAttributes[u].apply(this,[].concat(r[u]));this.attrs[u]=r[u];for(w in p)p[h](w)&&(r[w]=p[w])}r.text&&this.type=="text"&&(this.textpath.string=r.text);v(this,r)}return this};r.toFront=function(){return this.removed||this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&i._tofront(this,this.paper),this};r.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper)),this)};r.insertAfter=function(n){return this.removed?this:(n.constructor==i.st.constructor&&(n=n[n.length-1]),n.node.nextSibling?n.node.parentNode.insertBefore(this.node,n.node.nextSibling):n.node.parentNode.appendChild(this.node),i._insertafter(this,n,this.paper),this)};r.insertBefore=function(n){return this.removed?this:(n.constructor==i.st.constructor&&(n=n[0]),n.node.parentNode.insertBefore(this.node,n.node),i._insertbefore(this,n,this.paper),this)};r.blur=function(n){var t=this.node.runtimeStyle,r=t.filter;return r=r.replace(ot,u),+n!=0?(this.attrs.blur=n,t.filter=r+o+ft+".Blur(pixelradius="+(+n||1.5)+")",t.margin=i.format("-{0}px 0 0 -{0}px",e(+n||1.5))):(t.filter=r,t.margin=0,delete this.attrs.blur),this};i._engine.path=function(t,i){var f=s("shape"),r,h,e;return f.style.cssText=tt,f.coordsize=n+o+n,f.coordorigin=i.coordorigin,r=new b(f,i),h={fill:"none",stroke:"#000"},t&&(h.path=t),r.type="path",r.path=[],r.Path=u,v(r,h),i.canvas.appendChild(f),e=s("skew"),e.on=!0,f.appendChild(e),r.skew=e,r.transform(u),r};i._engine.rect=function(n,t,r,u,f,e){var h=i._rectPath(t,r,u,f,e),o=n.path(h),s=o.attrs;return o.X=s.x=t,o.Y=s.y=r,o.W=s.width=u,o.H=s.height=f,s.r=e,s.path=h,o.type="rect",o};i._engine.ellipse=function(n,t,i,r,u){var f=n.path(),e=f.attrs;return f.X=t-r,f.Y=i-u,f.W=r*2,f.H=u*2,f.type="ellipse",v(f,{cx:t,cy:i,rx:r,ry:u}),f};i._engine.circle=function(n,t,i,r){var u=n.path(),f=u.attrs;return u.X=t-r,u.Y=i-r,u.W=u.H=r*2,u.type="circle",v(u,{cx:t,cy:i,r:r}),u};i._engine.image=function(n,t,r,u,f,e){var a=i._rectPath(r,u,f,e),o=n.path(a).attr({stroke:"none"}),s=o.attrs,c=o.node,h=c.getElementsByTagName(l)[0];return s.src=t,o.X=s.x=r,o.Y=s.y=u,o.W=s.width=f,o.H=s.height=e,s.path=a,o.type="image",h.parentNode==c&&c.removeChild(h),h.rotate=!0,h.src=t,h.type="tile",o._.fillpos=[r,u],o._.fillsize=[f,e],c.appendChild(h),w(o,1,1,0,0,0),o};i._engine.text=function(r,f,h,c){var a=s("shape"),y=s("path"),p=s("textpath"),l,k,w;return f=f||0,h=h||0,c=c||"",y.v=i.format("m{0},{1}l{2},{1}",e(f*n),e(h*n),e(f*n)+1),y.textpathok=!0,p.string=t(c),p.on=!0,a.style.cssText=tt,a.coordsize=n+o+n,a.coordorigin="0 0",l=new b(a,r),k={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:c},l.shape=a,l.path=y,l.textpath=p,l.type="text",l.attrs.text=t(c),l.attrs.x=f,l.attrs.y=h,l.attrs.w=1,l.attrs.h=1,v(l,k),a.appendChild(p),a.appendChild(y),r.canvas.appendChild(a),w=s("skew"),w.on=!0,a.appendChild(w),l.skew=w,l.transform(u),l};i._engine.setSize=function(n,t){var r=this.canvas.style;return this.width=n,this.height=t,n==+n&&(n+="px"),t==+t&&(t+="px"),r.width=n,r.height=t,r.clip="rect(0 "+n+" "+t+" 0)",this._viewBox&&i._engine.setViewBox.apply(this,this._viewBox),this};i._engine.setViewBox=function(n,t,r,u,f){i.eve("raphael.setViewBox",this,this._viewBox,[n,t,r,u,f]);var e=this.width,o=this.height,c=1/k(r/e,u/o),s,h;return f&&(s=o/u,h=e/r,r*s<e&&(n-=(e-r*s)/2/s),u*h<o&&(t-=(o-u*h)/2/h)),this._viewBox=[n,t,r,u,!!f],this._viewBoxShift={dx:-n,dy:-t,scale:c},this.forEach(function(n){n.transform("...")}),this};i._engine.initWin=function(n){var t=n.document;t.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{t.namespaces.rvml||t.namespaces.add("rvml","urn:schemas-microsoft-com:vml");s=function(n){return t.createElement("<rvml:"+n+' class="rvml">')}}catch(i){s=function(n){return t.createElement("<"+n+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}};i._engine.initWin(i._g.win);i._engine.create=function(){var e=i._getContainer.apply(0,arguments),f=e.container,r=e.height,u=e.width,c=e.x,l=e.y;if(!f)throw new Error("VML container not found.");var t=new i._Paper,s=t.canvas=i._g.doc.createElement("div"),h=s.style;return c=c||0,l=l||0,u=u||512,r=r||342,t.width=u,t.height=r,u==+u&&(u+="px"),r==+r&&(r+="px"),t.coordsize=n*1e3+o+n*1e3,t.coordorigin="0 0",t.span=i._g.doc.createElement("span"),t.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",s.appendChild(t.span),h.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",u,r),f==1?(i._g.doc.body.appendChild(s),h.left=c+"px",h.top=l+"px",h.position="absolute"):f.firstChild?f.insertBefore(s,f.firstChild):f.appendChild(s),t.renderfix=function(){},t};i.prototype.clear=function(){i.eve("raphael.clear",this);this.canvas.innerHTML=u;this.span=i._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};i.prototype.remove=function(){i.eve("raphael.remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var n in this)this[n]=typeof this[n]=="function"?i._removedFactory(n):null;return!0};d=i.st;for(y in r)r[h](y)&&!d[h](y)&&(d[y]=function(n){return function(){var t=arguments;return this.forEach(function(i){i[n].apply(i,t)})}}(y))}}(),wi.was?r.win.Raphael=i:Raphael=i,i});
(function(n){Raphael.fn.nestedSVG=function(t,i,r){function o(f,e){var s,h=u.set(e),o=new Raphael(t,i,r);return o.canvas.setAttribute("x",0),o.canvas.setAttribute("y",0),u.canvas.appendChild(o.canvas),s={move:function(n,t){o.canvas.setAttribute("x",n);o.canvas.setAttribute("y",t)}},n.extend(o,s),o}var u=this,f=arguments[0]instanceof Array?{}:arguments[0],e=arguments[0]instanceof Array?arguments[0]:arguments[1];return o(f,e)}})(jQuery);
(function(){Raphael.fn.marker=function(){function r(t,i){var f=n.set(i),r=n.raphael.vml?document.createElement("marker"):document.createElementNS("http://www.w3.org/2000/svg","marker"),u=n.path("M2,2 L2,10 L10,6 L2,2");return u.node.setAttribute("fill","black"),n.defs.appendChild(r),r.appendChild(u.node),{scale:function(n,t){var i=r.getAttribute("transform");return r.attr("transform",updateScale(i,n,t)),this},move:function(n,t){r.setAttribute("x",n);r.setAttribute("y",t)},attr:function(n,t){r.setAttribute(n,t)},attrs:function(n){for(var t in n)r.setAttribute(t,n[t])},type:"marker",node:r}}var n=this,t=arguments[0]instanceof Array?{}:arguments[0],i=arguments[0]instanceof Array?arguments[0]:arguments[1];return r(t,i)}})(jQuery);
(function(n){Raphael.fn.group=function(){function u(i,r){var u,e=t.set(r),f=t.raphael.vml?document.createElement("group"):document.createElementNS("http://www.w3.org/2000/svg","g");return t.canvas.appendChild(f),f.canvas=f,u={setScale:function(n){return t.raphael.vml?this.forEach(function(t){var i=t.data("rotation")||0;t.transform("S"+n+","+n+", 0, 0, r"+i)}):f.setAttribute("transform","scale("+n+")"),this},getScale:function(){var n=f.getAttribute("transform");return n===null&&(n="scale(1)"),n.replace("scale(","").replace(")","")}},n.extend(u,t),u.scale=u.setScale,u.canvas=f,u[0]=f,u.type="group",u.node=f,u}var t=this,i=arguments[0]instanceof Array?{}:arguments[0],r=arguments[0]instanceof Array?arguments[0]:arguments[1];return u(i,r)}})(jQuery);
(function(n){n.widget("diagram.activityMap",{options:{width:100,height:100,format:{},spaceInterLine:110,verticalPadding:50,background:{lineColor:"#D8D8D8"},activities:{},legendProcess:{},showByTime:!1,timeWindowInterval:2e3,cssClass:"activity-map-tooltip activity-map-activity-default-status",cssClassHighlight:"activity-map-tooltip activity-map-activity-highlight",colorCurrentActivity:"rgba(255, 0, 0, 0.2)",colorList:"#FEC107,#FF5521,#795549,#0173BF,#7cb5ec,#434348,#90ed7d,#f7a35c,#8085e9,#f15c80,#e4d354,#2b908f,#F44236,#E91D62,#9C26B0,#6739B6,#3E50B4,#01BBD4,#019587,#4BAF4F,#8BC24A".split(","),data:{},currentActivity:""},_create:function(){var t=this,i=this.options,u=i.data||{},c=t.element.context.id||"body",l=n("<div id='legend-box'><\/div>"),r,e,o;n(t.element.parent()).prepend(l);t._stickPath=!1;t._stickActivity="";t.activitiesPositionReference={};t.nodePosition={};t.mouseEventHelper={hover:function(n,t,i){var r=!1;n.hover(function(n){r||(t(n),r=!0)},function(n){i(n);r=!1})}};this.diagram=Raphael(c,i.width,i.height);var f=t._mapProcessListWithColors(t._getProcessList(u.processes),i.colorList),a=t._getLegendProcess({paper:"#legend-box",processList:f});n(this.diagram.canvas).append();r=t.sortWorkItemsByDate(u.activities);e=t._getUniqueTimeReference(r);t.dateColumnsPosition=t._drawBackgroundDateColumns({paper:this.diagram,dateList:e,positionX:0,spaceInterLine:i.spaceInterLine,lineColor:i.background.lineColor});o=t._drawActivities({paper:this.diagram,activityList:t._getActivityTree(r),processList:f,positionX:i.spaceInterLine/2,positionY:80,spaceInterLine:i.spaceInterLine,verticalPadding:50,circleRadius:10,textPosition:"top",cssClass:i.cssClass,cssClassHighlight:i.cssClassHighlight,attributes:{"font-size":"11"}});t.lines=t._drawActivityLines({paper:this.diagram,activitiesPositionReference:o,attributes:{}});t._viewBoxWidth=t.element.outerWidth();t._viewBoxHeight=t.element.outerHeight();t.viewBox=this.diagram.setViewBox(-1,-1,t._viewBoxWidth,t._viewBoxHeight);t.viewBox.X=0;t.viewBox.Y=0;var s=t.diagram.canvas.getBBox&&t.diagram.canvas.getBBox()&&t.diagram.canvas.getBBox().width?t.diagram.canvas.getBBox().width:t.diagram.canvas.attributes.width,h=t.diagram.canvas.getBBox&&t.diagram.canvas.getBBox()&&t.diagram.canvas.getBBox().height?t.diagram.canvas.getBBox().height:t.diagram.canvas.attributes.height,v=t.element.outerWidth()>s?t.element.outerWidth():s+25,y=t.element.outerHeight()>h?t.element.outerHeight():h;t._configureHandlers()},_configureHandlers:function(){var n=this,u,f,t=!1,i=0,r=0;n.element.bind("zoom",function(t,i){n._zoom(i)});n.element.mousedown(function(i){n.diagram.getElementByPoint(i.pageX,i.pageY)==null&&(t=!0,u=i.pageX,f=i.pageY)});n.element.mousemove(function(e){if(t!=!1){i=u-e.pageX;r=f-e.pageY;var o=n._viewBoxWidth/n.element.outerWidth(),s=n._viewBoxHeight/n.element.outerHeight();i*=o;r*=s;n.diagram.setViewBox(n.viewBox.X+i,n.viewBox.Y+r,n._viewBoxWidth,n._viewBoxHeight)}});n.element.mouseup(function(){t!=!1&&(n.viewBox.X+=i,n.viewBox.Y+=r,t=!1)})},_zoom:function(n){var t=this.element.outerHeight(),i=this.element.outerWidth();n=parseFloat(n);this._viewBoxWidth=i*(2-n);this._viewBoxHeight=t*(2-n);this.diagram.setViewBox(this.viewBox.X,this.viewBox.Y,this._viewBoxWidth,this._viewBoxHeight)},_circleCollision:function(n,t,i,r,u,f){var e={radius:i,x:n,y:t},o={radius:f,x:r,y:u},s=e.x-o.x,h=e.y-o.y,c=Math.sqrt(s*s+h*h);return c<e.radius+o.radius},_hasNodeCollision:function(t,i,r,u){u=u||[];r=r||"";var f=!1,e=20,o=this;return n.each(u,function(n,u){u.rendered&&r!=u.guidWorkitem&&o._circleCollision(u.x,u.y,e,t,i,e)&&(f=!0)}),f},_getLegendProcess:function(t){var f=this,r=t.processList||{},i,u=n("<div><\/div>");n.each(r,function(t,r){i=n('<div class="activity-map-legend-row"><a class="activity-map-legend-row-process"><\/a><span class="activity-map-legend-row-label">'+r.name+"<\/span><\/div>");i.find(".activity-map-legend-row-process").css({"background-color":r.color,"border-color":r.color});i.data({guidProcess:t});u.append(i)});Object.keys(r).length>1&&n(t.paper).append('<h2 class="activity-map-legend-title">Processes<\/h2>');n(t.paper).append(u);f.element.bind("activity.mouseenter",function(t,i){n(".activity-map-legend-row").filter(function(){return n(this).data("guidProcess")==i.guidProcess}).each(function(){n(this).addClass("activity-map-highlight")})}).bind("activity.mouseleave",function(){n(".activity-map-highlight").removeClass("activity-map-highlight")})},_getProcessList:function(n){return n||{}},_mapProcessListWithColors:function(t,i){var u={},r;return t=t||[],i=i||[],n.each(t,function(n,t){r=r&&r.length>0?r:i.slice(0);u[n]={name:t,color:r.pop()}}),u},_getActivityList:function(n){return n||{}},_getActivityTree:function(t){var i=[],r;return t=t||{},r=function(i,r){var u=[];return i=i||"",n.each(t,function(n,t){typeof t[i]!="undefined"&&t[i]==r&&(t.referenced=!0,u.push(t))}),u},n.each(t,function(n,t){t.children=r("parentWorkItem",t.guidWorkitem);i.push(t)}),i},_addNodePosition:function(n,t){n=n||"";this.nodePosition[n]=t},_getNodePosition:function(n){return n?this.nodePosition[n]:this.nodePosition},_getActivityPositionEngine:function(n){var i=n.activity,r=n.previousActivity,t={x:n.positionX||10,y:n.positionY||10},e=n.verticalPadding||20,h=n.spaceInterLine||50,o=n.activityList||[],f,u,s;return r?(f=this._getColumnPositionByGuidWorkItem(i.guidWorkitem),u=function(n){t.y=n?n.y:t.y;t.y=t.y+e},r.guidProcess==i.guidProcess&&r.idCase==i.idCase&&i.parentWorkItem==r.guidWorkitem?this._hasNodeCollision(f,t.y,i.guidWorkitem,o)&&u():r.parentWorkItem==i.parentWorkItem?u():(s=this._getNodePosition(i.parentWorkItem),u()),t.x=f,t):t},_sortWorkItemsByParentGuidProcess:function(n,t){n=n||[];try{n.sort(function(n,i){return n.guidProcess==t?-1:i.guidProcess==t?1:0})}catch(i){i.toString()}return n},sortWorkItemsByDate:function(n){n=n||[];var r,u,t,i;try{n.sort(function(n,f){return r=new Date(n.creationDate),u=new Date(f.creationDate),t=r.getTime(),i=u.getTime(),t<i?-1:t>i?1:0})}catch(f){f.toString()}return n},_getUniqueTimeReference:function(t){t=t||{};var i={},f,r,u=0,e=this.options.timeWindowInterval;return n.each(t,function(n,t){var o;f=new Date(t.creationDate);r?f.getTime()<u+e?i[r].push(t):(i[t.creationDate]=[],i[t.creationDate].push(t),r=t.creationDate,o=new Date(t.creationDate),u=o.getTime()):(i[t.creationDate]=[],i[t.creationDate].push(t),r=t.creationDate,o=new Date(t.creationDate),u=o.getTime())}),i},_getColumnPositionByGuidWorkItem:function(t){var r=this,i=0;return t=t||"",n.each(r.dateColumnsPosition,function(n,r){n==t&&(i=r)}),i},_drawBackgroundDateColumns:function(t){var a=t.dateList||[],u=t.paper||Raphael("body",0,0),v={x:t.positionX||0},i,f,e,o,r,s={},y="M%d,%d L%d,%d",h=t.spaceInterLine||50,p=t.lineColor||"#000000",c=this.diagram.canvas.getBBox&&this.diagram.canvas.getBBox()&&this.diagram.canvas.getBBox().height?this.diagram.canvas.getBBox().height:this.diagram.canvas.attributes.height,w=this.element.outerHeight()>c?this.element.outerHeight()+150:c+150,l=0;return n.each(a,function(t,c){var a,b,k;i=i?i:n.extend(!0,{},v);f=new Date(t);e=n.datepicker.formatDate("M, dd",f);o=t.split(" ")[1];r=i.x+h/2;l>0&&(a=u.path(printf(y,i.x,0,i.x,w)).attr({stroke:p,"stroke-width":"1px","stroke-opacity":.4}),n(a.node).addClass("activity-map-background-line"));b=u.text(r,10,e).attr({"font-size":"20px"});b.node.setAttribute("class","activity-map-activity-date");k=u.text(r,30,o).attr({"font-size":"16px"});k.node.setAttribute("class","activity-map-activity-time");n.each(c,function(n,t){s[t.guidWorkitem]=r});i.x=i.x+h;l+=1}),s},_drawActivities:function(t){var i=this,f=t.paper||Raphael("body",0,0),l=t.activityList||[],y=t.textPosition||"top",p={x:t.positionX||0,y:t.positionY||10},w=t.processList||{},b=t.verticalPadding||20,k=t.spaceInterLine||50,e=t.circleRadius||10,o=e*2,u,r,s,a,d=t.attributes||{},g=t.cssClass||"",c=f.set(),v=function(t){t.rendered||(u=u?u:n.extend(!0,{},p),u=i._getActivityPositionEngine({previousActivity:a,activity:t,positionX:u.x,positionY:u.y,verticalPadding:b,spaceInterLine:k,activityList:l}),t.x=u.x,t.y=u.y,nt(u,t),t.children.length>0&&(t.children=i._sortWorkItemsByParentGuidProcess(t.children,t.guidProcess),n.each(t.children,function(n,t){v(t)})))},h=function(n,t){n.data({guidProcess:t.guidProcess,guidWorkitem:t.guidWorkitem,idCase:t.idCase,idWorkflow:t.idWorkFlow})},nt=function(t,u){var o,l;return s=w[u.guidProcess].color,o=f.circle(t.x,t.y,e).attr({fill:s,stroke:s}),h(n(o.node),u),h(o,u),o.toFront(),i.options.currentActivity==u.idCase&&(l=f.circle(t.x,t.y,e+5).attr({fill:i.options.colorCurrentActivity,stroke:i.options.colorCurrentActivity}),h(n(l.node),u),h(l,u),l.toBack(),c.push(l)),o.node.setAttribute("class",g),c.push(o),o.hover(function(){var t=this.data();i.element.trigger("activity.mouseenter",[t]);i._stickPath||(n(this.node).addClass("activity-map-activity-highlight"),i._highlight({guidWorkitem:t.guidWorkitem,highlight:!0}))},function(){var t=this.data();i.element.trigger("activity.mouseleave",[t]);i._stickPath||(n(this.node).removeClass("activity-map-activity-highlight"),i._highlight({guidWorkitem:t.guidWorkitem,highlight:!1}))}).click(function(){var n=this.data();i._stickAllPath(n.guidWorkitem)}),n("#bz-activity-map").mouseover(function(){n(".activity-map-tooltip").mouseout()}),r=tt(u.name,t,u.guidWorkitem,u.creationDate),i._addNodePosition(u.guidWorkitem,{positionReference:t,positionReferenceText:r,color:s,parentWorkItem:u.parentWorkItem,circleRadius:e}),a=u,u.rendered=!0,t},tt=function(t,i){switch(y){case"top":r={x:i.x,y:i.y-o};break;case"bottom":r={x:i.x,y:i.y+o};break;case"left":r={x:i.x-o,y:i.y,"text-anchor":"end"};break;case"right":r={x:i.x+o,y:i.y,"text-anchor":"start"}}return r=n.extend({fill:"#3E5664"},d,r),f.text(r.x,r.y,t+" ").attr(r),r};return n.each(l,function(n,t){v(t)}),i.activities=c,f.setFinish(),i._getNodePosition()},_stickAllPath:function(n){var t=this;t._stickPath=t._stickActivity!=""&&t._stickActivity!==n?!0:!t._stickPath;t._stickActivity=n;t.activities.items.forEach(function(i){i.data("guidWorkitem")!==n&&i.node.setAttribute("class",t.options.cssClass)});t.lines.items.forEach(function(n){n.data("visible")?(n.toBack(),n.node.setAttribute("class",t.options.cssClass)):n.toFront()});t._highlight({guidWorkitem:n,highlight:t._stickPath})},_highlight:function(n){var t=this,i;n.guidWorkitem&&(i=n.highlight||!1,t.activities&&t.activities.items.forEach(function(r){r.data("guidWorkitem")==n.guidWorkitem&&(i?r.node.setAttribute("class",t.options.cssClassHighlight):r.node.setAttribute("class",t.options.cssClass))}),t.lines&&t.lines.items.filter(function(t){return t.data("workItem")==n.guidWorkitem&&t.data("visible")}).forEach(function(n){i?(n.toFront(),n.node.setAttribute("class",t.options.cssClassHighlight)):(n.toBack(),n.node.setAttribute("class",t.options.cssClass));t._highlight({guidWorkitem:n.data("parentWorkItem"),highlight:i})}))},_getPath:function(t,i){var e,o=[],s,f,h=0;t=t||"";i=i||[];var r=[],u=5,c=u*2;return n.each(i,function(n,i){i.maxY<t.maxY&&i.maxY>t.minY&&i.minX<t.minX&&i.maxX>t.minX&&o.push(i.strPath)}),o.length>0?(e=Raphael.pathIntersection(t.strPath,o),n.each(e,function(n,i){s=n==0?t.minY:e[n-1].y+u;f=i.y-u;r.push(printf("M%d,%d L%d,%d",t.minX,s,t.minX,f));r.push(printf("M%d,%d A%d,%d 0 0,%d %d,%d",t.minX,f,u,u,h,t.minX,f+c))}),r.push(printf("L%d,%d L%d,%d",t.minX,t.maxY,t.maxX,t.maxY))):r.push(t.strPath),r},_drawActivityLines:function(t){var u=this,h=t.paper||Raphael("body",0,0),a=t.activitiesPositionReference||{},w="M%d,%d L%d,%d L%d,%d",v,i,f,r,c,e,o,y=3,s=t.circleRadius||10,p=t.attributes||{},b=[],l;return p=n.extend(p,{"arrow-end":"classic-wide-long","stroke-linejoin":"round"}),l=h.set(),n.each(a,function(n,t){var g,d,k;t.parentWorkItem!=""&&a[t.parentWorkItem]&&(v=a[t.parentWorkItem],i=v.positionReference,v.positionReference.y==t.positionReference.y?(r=i.x+s,c=t.positionReference.x-s-y,e=i.y,o=t.positionReference.y,f=printf(w,r,e,c,o)):i.x==t.positionReference.x?(r=i.x,e=i.y+s,o=t.positionReference.y-s-y,f=printf("M%d,%d L%d,%d",r,e,r,o)):(r=i.x,c=t.positionReference.x-s-y,e=i.y+s,o=t.positionReference.y,f=printf(w,r,e,i.x,t.positionReference.y,c,o)),g={strPath:f,minX:r,maxX:c,minY:e,maxY:o},f=u._getPath(g,b,h),b.push(g),d=h.path(f).attr(p).toBack(),d.data({workItem:n,parentWorkItem:t.parentWorkItem,visible:!0}),d.node.setAttribute("class","activity-map-connector"),d.node.setAttribute("stroke","#7cb5ec"),k=h.path(f).attr({"stroke-opacity":0,"stroke-width":15}),k.data({workItem:n,parentWorkItem:t.parentWorkItem,visible:!1}),u.mouseEventHelper.hover(k,function(){u._stickPath||(u._highlight({guidWorkitem:k.data("workItem"),highlight:!0}),k.toFront())},function(){u._stickPath||(u._highlight({guidWorkitem:k.data("workItem"),highlight:!1}),k.toFront())}),k.click(function(){var n=this.data();u._stickAllPath(n.workItem);this.toFront()}),l.push(d),l.push(k))}),n("#raphael-marker-endclassic55 use").attr("fill","#7cb5ec"),h.setFinish(),l},destroy:function(){n.Widget.prototype.destroy.call(this)}})})(jQuery);
(function(n){n.widget("diagram.processMap",{options:{data:{}},_create:function(){var n=this,t=this.options,i=t.data||{},r=n.indexingData(i);return n.element.addClass("tree"),n.drawEngine(r),n._configureHandlers(),this},_configureHandlers:function(){var n=this;n.element.bind("zoom",function(t,i){n._zoom(i)});n.element.draggable()},_zoom:function(t){var i=this;n(i.element).css({"font-size":t+"em"})},indexingData:function(t){var i=this,u,e,r,f;return i.indexedData={maxVerticalLevels:0,maxHorizontalNodes:0,parentNode:{},latestChild:{},data:t||{},nodesByLevel:{},nodesById:{}},f=function(t,r){var u=[];return t=t||"",n.each(i.indexedData.data,function(n,i){typeof i[t]!="undefined"&&i[t]==r&&u.push(i)}),u},n.each(i.indexedData.data,function(n,t){u=f("guidCase",t.guidParentCase);e=f("guidParentCase",t.guidCase);u.length==0?(r=0,i.indexedData.parentNode=t):r=u[0].relation?u[0].relation.depth+1:0;i.indexedData.data[n].relation={parent:u,children:e,depth:r,limitX:{min:0,max:0}};typeof i.indexedData.nodesByLevel[r]=="undefined"&&(i.indexedData.nodesByLevel[r]=[]);i.indexedData.nodesByLevel[r].push(i.indexedData.data[n]);i.indexedData.nodesByLevel[r].length>i.indexedData.maxHorizontalNodes&&(i.indexedData.maxHorizontalNodes=i.indexedData.nodesByLevel[r].length);r>i.indexedData.maxVerticalLevels&&(i.indexedData.maxVerticalLevels=r,i.indexedData.latestChild=i.indexedData.data[n]);i.indexedData.nodesById[t.guidCase]=i.indexedData.data[n]}),i.indexedData},drawEngine:function(t){function e(n,t){var i={idcase:t.idCase,idworkflow:t.idWorkFlow,enddate:t.finishDate,startdate:t.creationDate,process:t.name};return n.data(i),n.addClass("subprocess-tooltip"),n}function o(t){var f,s,r,h,u,i;if(t.relation.children.length){for(u=n("<ul>"),i=0;i<t.relation.children.length;i++)f=e(n("<a>"),t.relation.children[i]),h=n("<span class='arrow'>"),s=f.html(t.relation.children[i].name),r=n("<li>"),r.append(h),r.append(s),r.append(o(t.relation.children[i])),u.append(r);return u}return null}var u=this,i,f,r,s,h;i=n("<ul>");f=e(n("<a>"),t.parentNode).html(t.parentNode.name);r=n("<li class='center'>").append(f);i.append(r);r.append(o(t.parentNode));u.element.css({"min-width":"5000px",transform:"translateY(20%)","-ms-transform":"translateY(20%)","-moz-transform":"translateY(20%)","-webkit-transform":"translateY(20%)"});u.element.html(i);$element=n(".bz-subprocess-map");$parent=$element.parent();s=$parent.width();h=$element.width();$parent.scrollLeft((h-s)/2)}})})(jQuery);
(function(n){n.widget("diagram.zoom",{options:{min:50,max:150,step:10,value:100,onZoom:function(){}},_create:function(){var n=this,t=this.options;n._bindSlider();n._bindTooltip()},_bindSlider:function(){var t=this;options=t.options;t.element.slider({min:options.min,max:options.max,step:options.step,value:options.value,change:function(t,i){options.onZoom(i.value);var r=i.value.toString()+"%";n("#zoom-value").text(r)}})},_bindTooltip:function(){var i=this,t=n("<div class='zoom-tooltip'><label id='zoom-value'><\/label><\/div>");n(".bz-zoom-container").append(t);n(".bz-zoom-container").mouseenter(function(){t.addClass("is-visible-output");var r=i.element.slider("option","value")+"%";n("#zoom-value").text(r)}).mouseleave(function(){t.removeClass("is-visible-output")})},destroy:function(){n.Widget.prototype.destroy.call(this)}})})(jQuery);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.graphicquery",{},{init:function(n,t,i){var r=this;r.subprocesses=[];r.currentTasks=[];r.path=[];r.callStack=[];r.currentWorkflow={idCase:i.data.idCase,idWorkflow:i.data.idWorkflow};r._super(n,t,i);r.loadTemplates({"graphicquery-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-wrapper"),"graphicquery-tooltip-currenttask":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-tooltip-currenttask"),"graphicquery-tooltip-subcases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-tooltip-subcases"),"graphicquery-subcases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-subcases"),"graphicquery-parentsummary":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-parentsummary"),"graphicquery-summary":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-summary"),"graphicquery-tooltip-users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-tooltip-users"),"graphicquery-actionbar":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-workportal-widget-graphicquery-actionbar"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GRAPHIC_QUERY},renderContent:function(){var n=this,t=n.getTemplate("graphicquery-wrapper");return n.content=$.tmpl(t)}});
bizagi.workportal.widgets.graphicquery.extend("bizagi.workportal.widgets.graphicquery",{},{postRender:function(){var n=this;n.dateFormat=n.getResource("dateFormat")+" "+n.getResource("timeFormat");n.$header=$(".bz-gq-header",n.content);n.$actionBar=$("#bz-gq-actionbar-container",n.$header);n.$pvCanvas=$("#bz-gq-processviewer-canvas",n.content);n.$summary=$("#bz-gq-summary-container",n.$header);n.renderProcessViewer();n.eventsHandler()},refreshContent:function(n){var t=this;t.path=[];t.subprocesses=[];t.currentTasks=[];t.currentWorkflow={idCase:n.idCase,idWorkflow:n.idWorkflow,idParentWorkItem:n.idParentWorkItem};t.renderProcessViewer();t.$pvCanvas.processviewer("destroy");t.$actionBar.empty();t.$summary.empty()},setCallStack:function(){var n=this;n.callStack.push(n.currentWorkflow)},renderHeader:function(n){var t=this,i=t.callStack.length;i&&(n.parentCase=n.parentCase||{},$.extend(n.parentCase,t.callStack[i-1]));t.renderActionBar(n.parentCase);t.renderSummary(n)},renderActionBar:function(n){var t=this,i=t.getTemplate("graphicquery-actionbar");t.$actionBar.html($.tmpl(i,{parentCase:n}))},renderSummary:function(n){var t=this,u=t.getTemplate("graphicquery-summary"),i=$.tmpl(u,n),r;bizagi.util.formatInvariantDate(i,t.dateFormat);t.$summary.html(i);n.parentCase&&(r=t.getTemplate("graphicquery-parentsummary"),t.$summary.append($.tmpl(r,n.parentCase)))},renderProcessViewer:function(){var n=this,r=n.getContent(),t="processId="+n.currentWorkflow.idWorkflow,i="idCase="+n.currentWorkflow.idCase+"&idWorkFlow="+n.currentWorkflow.idWorkflow;i+=n.currentWorkflow.idParentWorkItem?"&idParentWorkItem="+n.currentWorkflow.idParentWorkItem:"";$.when(n.dataService.processDefinition(t),n.dataService.graphicInfo(t),n.dataService.getGraphicQueryInfo(i)).done(function(t,i,r){$.extend(n.currentWorkflow,{idProcess:r[0].idProcess,nameProcess:r[0].nameProcess,radicationNumber:r[0].currentCase.radicationNumber});n.renderHeader(r[0]);n.pathWorkItems=r[0].pathWorkItems;n.$pvCanvas.processviewer({height:n.getPVHeight(),jsonBizagi:{processDefinition:t[0],processGraphicsInfo:i[0]},zoomRange:5})}).fail(function(t){var i=JSON.parse(t.responseText);n.publish("closeCurrentDialog");bizagi.showMessageBox(i.message,"Bizagi","warning")})},toggleHighlight:function(){for(var n=this,t=[],i=0,r=n.currentTasks.length;i<r;i++)t.push(n.currentTasks[i].guidTask);n.highlighted?(n.highlighted=!1,n.$pvCanvas.processviewer("unSelectShape",t,n.currentTasks)):(n.highlighted=!0,n.$pvCanvas.processviewer("selectShape",t,n.currentTasks))},eventsHandler:function(){var n=this;n.applyViewerTooltip();n.$actionBar.on("click","#bz-gq-button-parent, #bz-gq-button-path, #bz-gq-button-status",function(){var t;if(this.id==="bz-gq-button-status")n.toggleHighlight();else if(this.id==="bz-gq-button-parent"){if(n.callStack.length)var i=n.callStack.pop(),r=i.idWorkflow,t=i.idCase;else t=$(this).data("idcase"),r=$(this).data("idworkflow");n.refreshContent({idWorkflow:r,idCase:t})}else this.id==="bz-gq-button-path"&&($("i",this).toggleClass("bz-gq-icon-path-stop"),n.drawCasePath())});n.$pvCanvas.on("animationComplete",function(){$("#bz-gq-button-path i",n.$actionBar).removeClass("bz-gq-icon-path-stop")});n.$pvCanvas.on("pvComplete",function(t){n.highlighted=!1;n.getRelevantData();n.toggleHighlight();n.showSubCases();t.stopPropagation()})},applyViewerTooltip:function(){var n=this;n.$pvCanvas.tooltip({items:"div.processviewer-shape-selected, div.has-subprocess, div.processviewer-highlighted",content:function(){return n.getTooltipContent($(this))},show:{duration:120,effect:"none"},tooltipClass:"bz-gq-tooltip-wrapper",hide:{delay:250,duration:120},close:function(n,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(120,1)},function(){$(this).fadeOut(120,function(){$(this).remove()})})}})},getTooltipContent:function(n){var t=this,i="",r=n.find(".processviewer-hotspot-label").text(),u=n.prop("id"),f=$.Deferred();return n.hasClass("has-subprocess")?(i=t.getSubCasesContent(r,u),t.bindTooltipEvent(i)):!n.hasClass("processviewer-shape-selected")||n.hasClass("end")||n.hasClass("start")||n.hasClass("scripttask")||n.hasClass("servicetask")||n.hasClass("sendtask")||n.hasClass("receivetask")?n.hasClass("processviewer-highlighted")&&n.hasClass("manualtask")&&(i=t.renderPreviousTaskTooltip(r,u,f)):i=t.renderCurrentTaskTooltip(r,u,f),f.promise().done(function(n){bizagi.util.formatInvariantDate(n,t.dateFormat)}),i},getSubCasesContent:function(n,t){for(var i,u=this,s=u.getTemplate("graphicquery-tooltip-subcases"),f="",e=[],r=0,o=u.subprocesses.length;r<o;r++)i=u.subprocesses[r],i.guidTask===t&&(taskType=i.subProcess.taskType,f=i.subProcess.taskName,e=i.subProcess.items,r=o);return $.tmpl(s,{taskName:n,taskType:taskType,subprocess:f,cases:e})},renderCurrentTaskTooltip:function(n,t,i){var u=this,r=$("<div><\/div>");return $.when(u.getCurrentTaskContent(t)).done(function(t){var f=u.getTemplate("graphicquery-tooltip-currenttask"),e={taskName:n,entryDate:t.wiEntryDate,expireDate:t.wiEstimatedSolutionDate,users:bizagi.override.showAssignees?t.usersAssignees:[]};r=$.tmpl(f,e);$(".bz-gq-tooltip-wrapper").html(r);i.resolve(r)}),r},getCurrentTaskContent:function(n){for(var t=this,f=t.getTemplate("graphicquery-tooltip-currenttask"),r=$.Deferred(),i=0,u=t.currentTasks.length;i<u;i++)if(n===t.currentTasks[i].guidTask){t.currentTasks[i].usersAssignees.length===0?t.dataService.getUserInfoByTask(t.currentWorkflow.idCase,n).done(function(n){t.currentTasks[i].usersAssignees=n;r.resolve(t.currentTasks[i])}).fail(function(){r.reject(t.currentTasks[i])}):r.resolve(t.currentTasks[i]);break}return r.promise()},showSubCases:function(){for(var n=this,r=n.getTemplate("graphicquery-subcases"),t=0,u=n.subprocesses.length;t<u;t++){var f=n.subprocesses[t].guidTask,i=n.$pvCanvas.find("#"+f),e=n.subprocesses[t].subProcess.items.length;i.addClass("has-subprocess");i.prepend($.tmpl(r,{ncases:e}))}},renderPreviousTaskTooltip:function(n,t,i){var u=this,r=$("<div><\/div>");return $.when(u.getUsersDataForPreviousTask(t)).done(function(t){var f=u.getTemplate("graphicquery-tooltip-users");r=$.tmpl(f,$.extend(t,{taskName:n}));$(".bz-gq-tooltip-wrapper").html(r);i.resolve(r)}),r},getUsersDataForPreviousTask:function(n){for(var t=this,r=$.Deferred(),i=0,u=t.pathWorkItems.length;i<u;i++)if(n===t.pathWorkItems[i].guidTask){t.pathWorkItems[i].usersAssignees.length===0?t.dataService.getUserInfoByTask(t.currentWorkflow.idCase,n).done(function(n){t.pathWorkItems[i].usersAssignees=n;r.resolve(t.pathWorkItems[i])}).fail(function(){r.reject(t.pathWorkItems[i])}):r.resolve(t.pathWorkItems[i]);break}return r.promise()},getPVHeight:function(){var n=this,t=n.$header.height()+45,i=n.content.parent().height();return i-t},bindTooltipEvent:function(n){var t=this;$(".bz-gq-tooltip-list li",n).on("click",function(){$(this).closest(".ui-tooltip").remove();var n={idWorkflow:$(this).data("idworkflow"),idCase:$(this).data("idcase"),idParentWorkItem:$(this).data("idparentworkitem")};t.currentWorkflow.task=$(this).parent().data("parenttaskname");t.currentWorkflow.idParentWorkItem=n.idParentWorkItem;t.setCallStack();t.refreshContent(n)})},getRelevantData:function(){for(var n=this,t=n.pathWorkItems.length-1;t>=0;t--)n.pathWorkItems[t].subProcess&&n.subprocesses.push(n.pathWorkItems[t]),n.pathWorkItems[t].wiClosed||n.currentTasks.push(n.pathWorkItems[t])},drawCasePath:function(){var n=this,t;n.path.length?n.$pvCanvas.processviewer("animateRoute"):(t="idCase="+n.currentWorkflow.idCase+"&idWorkFlow="+n.currentWorkflow.idWorkflow,$.when(n.dataService.getCasePath(t)).done(function(t){for(var i=0,r=t.length;i<r;i++)i===0&&t[0].guidTaskFrom===""&&(n.path.push(t[i+1]?t[i+1].guidTaskFrom:""),n.path.push(t[i].guidTransition),n.path.push(t[i].guidTaskTo)),n.path.push(t[i].guidTaskFrom),n.path.push(t[i].guidTransition),n.path.push(t[i].guidTaskTo);n.path=n.cleanPathArray(n.path);n.path=n.removeRepeatedItemsInPath(n.path);n.$pvCanvas.processviewer("animateRoute",n.path)}))},clearCasePath:function(){var n=this;n.$pvCanvas.processviewer("stopRouteAnimation")},cleanPathArray:function(n){for(var i=[],t=0,r=n.length;t<r;t++)n[t]&&i.push(n[t]);return i},removeRepeatedItemsInPath:function(n){var t={boolean:{},number:{},string:{}},i=[];return n.filter(function(n){var r=typeof n;return r in t?t[r].hasOwnProperty(n)?!1:t[r][n]=!0:i.indexOf(n)>=0?!1:i.push(n)})}});
bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.plan.activity.sidebar",{},{init:function(n,t,i,r){var u=this;u._super(n,t,r);u.serviceloadDataPlan=i;u.loadTemplates({"project-plan-activity-sidebar":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.sidebar").concat("#project-plan-activity-sidebar")})},renderContent:function(){var n=this,t=n.getTemplate("project-plan-activity-sidebar");return n.content=t.render({}),n.content},postRender:function(){var n=this;n.sub("LOAD_INFO_PLAN",$.proxy(n.onNotifyLoadInfoPlan,n))},onNotifyLoadInfoPlan:function(){var n=this,t;n.params.plan.idActivitySelected?(t={idPlan:n.params.plan.id},n.serviceloadDataPlan.loadData(t,n.getDateServer,n.params),n.serviceloadDataPlan.subscribe("loadedWithDataActivities",$.proxy(n.loadedWithDataActivities,n)),n.serviceloadDataPlan.subscribe("loadedWithDataFirstParent",$.proxy(n.loadedWithDataFirstParent,n))):(n.params.showContextByMenuDashboard==="ACTIVITYPLANPROCESSMAP"||n.params.showContextByMenuDashboard==="ACTIVITYPLANLOG")&&n.pub("notify",{type:"DISABLED_RIGHT_SIDEBAR"})},loadedWithDataActivities:function(){var n=this;n.pub("notify",{type:"LOADED_ACTIVITIES_PLAN",args:n.params});n.pub("notify",{type:"LOAD_INFO_SUMMARY_PROGRESS_PLAN",args:n.params});n.pub("notify",{type:"LOAD_INFO_ACTIVITY_SUMMARY",args:n.params});n.pub("notify",{type:"LOAD_INFO_ACTIVITIES_PLAN",args:n.params})},loadedWithDataFirstParent:function(){var n=this;n.pub("notify",{type:"LOAD_INFO_SUMMARY_PLAN",args:n.params})},clean:function(){var n=this;n.serviceloadDataPlan&&(n.serviceloadDataPlan.unsubscribe("loadedWithDataActivities",$.proxy(n.loadedWithDataActivities,n)),n.serviceloadDataPlan.unsubscribe("loadedWithDataFirstParent",$.proxy(n.loadedWithDataFirstParent,n)))}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.activity.sidebar",["workportalFacade","dataService","bizagi.workportal.services.behaviors.loadDataPlan",bizagi.workportal.widgets.project.plan.activity.sidebar],!0);
bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.plan.activity.action",{},{init:function(n,t,i,r){var u=this;u._super(n,t,r);u.dateFormat=bizagi.localization.getResource("dateFormat");u.timeFormat=bizagi.localization.getResource("timeFormat");u.estimatedFinishDateTime;u.beforeUserAssignedActivity="";u.notifier=i;u.loadTemplates({"activity-action-main":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.action").concat("#project-plan-activity-action"),"activity-action-editionpopup":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.action").concat("#project-plan-activity-action-editionpopup")});u.dialogBox={}},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.sub("LOAD_INFO_ACTIVITY_SUMMARY",$.proxy(n.onNotifyLoadInfoActivityExecution,n));n.sub("EXPANDED_RIGHT_SIDEBAR",$.proxy(n.onNotifyExpandedRightSidebar,n))},onNotifyLoadInfoActivityExecution:function(n,t){var i=this,f,u,r,e;if(i.params=$.extend(i.params,t.args),f=i.getContent().empty(),u={},i.params.plan.idActivitySelected&&(u=i.params.plan.activities.filter(function(n){return n.id.toUpperCase()===i.params.plan.idActivitySelected.toUpperCase()})[0]),(i.params.plan.idUserCreator===bizagi.currentUser.idUser||u.userAssigned==bizagi.currentUser.idUser)&&(r={},r.currentActivityName=u.name,r.showEditAction=!0,i.params.plan.idUserCreator!==bizagi.currentUser.idUser&&(r.showEditAction=!1),e=i.getTemplate("activity-action-main"),f.append(e.render(r)),r.showEditAction)){i.plugins={};i.initilizeActionMenu();i.plugins.activityEdition=i.initPluginPopupEdition();i.formEditActivity={assignee:$("#activity-form-assignee",i.plugins.activityEdition),date:$("#activity-form-date",i.plugins.activityEdition),duration:$("#activity-form-duration",i.plugins.activityEdition),buttonCancel:$("#ui-bizagi-wp-project-popupform-action-cancel",i.plugins.activityEdition),buttonUpdate:$("#ui-bizagi-wp-project-popupform-action-update",i.plugins.activityEdition)};i.beforeUserAssignedActivity=u.userAssigned;i.content.append(f);i.formEditActivity.buttonCancel.on("click",$.proxy(i.onClickPopupButtonCancel,i));i.formEditActivity.buttonUpdate.on("click",$.proxy(i.onClickPopupButtonUpdate,i));i.formEditActivity.date.on("keydown",$.proxy(i.onDeleteDate,i));i.formEditActivity.duration.on("keyup",$.proxy(i.onTypeDuration,i))}},onNotifyExpandedRightSidebar:function(){var n=this;n.initilizeActionMenu()},initilizeActionMenu:function(){var n=this;$("#ui-bizagi-wp-project-plan-activity-action .menu",n.content).menu({select:$.proxy(n.onSelectMenu,n)}).removeClass("ui-widget-content")},initPluginPopupEdition:function(){var n=this,t=n.getTemplate("activity-action-editionpopup");return n.dialogBox.formContent=t.render({}),n.dialogBox.formContent},initializeAutoComplete:function(n){var t=this,i=t.dataService.serviceLocator.getUrl("admin-getUsersList");n.autocomplete({minLength:2,source:function(n,t){$.ajax({url:i,data:{domain:"",userName:"",fullName:n.term,organization:"",pag:1,pagSize:100,orderField:"fullName"},success:function(n){t($.map(n.users,function(n){return{label:n.user,value:n.idUser}}))}})},select:function(i,r){var u=r.item.label;return n.val(u),t.formEditActivity.IdAssignee=r.item.value,!1},focus:function(){return!1},change:function(n,i){return i.item===null&&(t.formEditActivity.IdAssignee=null,t.formEditActivity.assignee.val("")),!1}})},initializeDatePicker:function(n){var t=this;n.datepicker({onSelect:function(){t.formEditActivity.duration.val("");t.estimatedFinishDateTime=t.formEditActivity.date.datepicker("getDate")?t.formEditActivity.date.datepicker("getDate").getTime():undefined}});n.datepicker("option","dateFormat",bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI())},initializeSpiner:function(n){function i(n,i){var r=i||$(n.target).val();bizagi.util.isNumeric(r)&&parseInt(r,10)>0?(t.formEditActivity.date.val(""),t.estimatedFinishDateTime=undefined):$(n.target).val("")}var t=this;n.spinner({min:1,max:1e3,placeHolder:bizagi.localization.getResource("workportal-hours"),change:function(n){i(n)},spin:function(n,t){i(n,t.value)}})},onDeleteDate:function(n){var t=this;n.keyCode===8&&($(n.target).val(""),t.fieldDurationActive(!0))},onTypeDuration:function(n){var t=this,i=$(n.target);i.val()!==""?t.estimatedFinishDateTime=undefined:t.activateElement(t.form.date)},onSelectMenu:function(n,t){var r=this,i;if($(n.currentTarget).find("i").length===0){i=$(t.item).data("item");switch(i){case"edit":r.onClickOpenPopupEdition()}}},onClickOpenPopupEdition:function(){var n=this;n.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-project-plan-title-activity-properties"),maximize:!0,open:$.proxy(n.onOpenPopupEdition,n),close:$.proxy(n.onClosePopupEdition,n)})},onOpenPopupEdition:function(){var n=this,t=n.params.plan.activities.filter(function(t){return t.id.toUpperCase()===n.params.plan.idActivitySelected.toUpperCase()})[0];n.initializeAutoComplete(n.formEditActivity.assignee);n.initializeDatePicker(n.formEditActivity.date);n.initializeSpiner(n.formEditActivity.duration);t.userAssigned&&n.setUserAssignedById(t.userAssigned);n.formEditActivity.date.datepicker("option","minDate",new Date(n.getDateServer()));t.estimatedFinishDate&&parseInt(t.estimatedFinishDate,10)<n.getDateServer()&&n.formEditActivity.date.datepicker("option","minDate",new Date(parseInt(t.estimatedFinishDate,10)));n.formEditActivity.date.datepicker("setDate",new Date(parseInt(t.estimatedFinishDate,10)));n.estimatedFinishDateTime=t.estimatedFinishDate;t.duration&&n.formEditActivity.duration.val(parseInt(t.duration,10))},onClosePopupEdition:function(){var n=this;n.removePopupWidgets()},setUserAssignedById:function(n){var t=this;t.callGetDataUsers(n).then(function(n){t.formEditActivity.assignee.val(n[0].name)});t.formEditActivity.IdAssignee=n},onClickPopupButtonCancel:function(n){var t=this;n.preventDefault();t.dialogBox.formContent.dialog("close")},removePopupWidgets:function(){var n=this;n.formEditActivity.assignee.next().find("span").html("")},onClickPopupButtonUpdate:function(){var n=this;if(n.validateParamsOfFormEditActivity()){var t=n.params.plan.activities.filter(function(t){return t.id.toUpperCase()===n.params.plan.idActivitySelected.toUpperCase()})[0],r=n.formEditActivity.IdAssignee||bizagi.currentUser.idUser,i={progress:t.progress,id:t.id,startDate:t.startDate,duration:n.formEditActivity.duration.val(),userAssigned:r,allowEdition:t.allowEdition,description:t.description,name:t.name,idPlan:t.idPlan,estimatedFinishDate:n.estimatedFinishDateTime,finishDate:t.finishDate,items:t.items};$.when(n.dataService.editActivityPlan(i)).done(function(){t=$.extend(t,i);n.removePopupWidgets();n.beforeUserAssignedActivity!==n.formEditActivity.IdAssignee?n.pub("notify",{type:"ACTIVITYPLANCOMMENTS",args:$.extend(n.params,{refreshAllWidgets:!0})}):n.pub("notify",{type:n.params.showContextByMenuDashboard,args:n.params});n.dialogBox.formContent.dialog("close");n.notifier.showSucessMessage(bizagi.localization.getResource("workportal-project-plan-activity-update-message"))})}},onClickFavorite:function(n){n.preventDefault();var t=this,i={};$(n.target).hasClass("bz-icon-star-outline")?(i={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(i)).done(function(i){t.params.guidFavorite=i.idFavorites;$(n.target).removeClass("bz-icon-star-outline");$(n.target).addClass("bz-icon-star")})):(i={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(i)).done(function(){$(n.target).addClass("bz-icon-star-outline");$(n.target).removeClass("bz-icon-star")}))},clean:function(){var n=this;n.unsub("LOAD_INFO_ACTIVITY_SUMMARY",$.proxy(n.onNotifyLoadInfoActivityExecution,n));n.unsub("EXPANDED_RIGHT_SIDEBAR",$.proxy(n.onNotifyExpandedRightSidebar,n))},validateParamsOfFormEditActivity:function(){var i=this,t=i.formEditActivity.assignee,n;return t.val()&&t.val()!==""&&i.formEditActivity.IdAssignee?!0:(n=bizagi.localization.getResource("workportal-general-error-field-required"),n=n.replace("{0}",bizagi.localization.getResource("workportal-project-plan-assignee").toLowerCase()),t.next().find("span").html(n),!1)},callGetDataUsers:function(n){var i=this,t=$.Deferred(),r={userIds:n,width:50,height:50};return i.dataService.getUsersData(r).always(function(n){t.resolve(n)}),t.promise()}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.activity.action",["workportalFacade","dataService","notifier",bizagi.workportal.widgets.project.plan.activity.action]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.activity.time",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.EXECUTING_ACTIVITY="EXECUTING";r.FINISHED_ACTIVITY="FINISHED";r.datePickerRegional=bizagi.localization.getResource("datePickerRegional");r.loadTemplates({"plan-time-main":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.time").concat("#project-plan-activity-time")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.sub("LOAD_INFO_ACTIVITY_SUMMARY",$.proxy(n.onNotifyLoadInfoActivitySummary,n))},onNotifyLoadInfoActivitySummary:function(n,t){var i=this,r,f,u;i.params=$.extend(i.params,t.args);i.getContent().empty();r=i.params.plan.activities.filter(function(n){return n.id===i.params.plan.idActivitySelected})[0];r.startDate&&(i.getStateActivity(r),f={time:{fromDate:i.getFormattedDate(new Date(i.getFirstDate(r)))}},u=i.getDataByScenarios(r,!0),$.when(u.unitTime).done(function(n){u=$.extend(u,{unitTime:n});i.updateWidget($.extend(f.time,u))}))},updateWidget:function(n){var i=this,t=i.getContent().empty(),e=i.getTemplate("plan-time-main"),o=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-n.unitTime.minutes*6e4),null,!1),s=bizagi.localization.getResource("workportal-project-activity-state-"+n.keywordResource),r,u,f;n.messageTime=s.replace("%s",o);e.render(n).appendTo(t);r=$(".remaining-days .time-remaining",t);u=$(".remaining-days .days",t).width();r.css("padding-left",(u+7).toString()+"px");f=$(".remaining-days .bar-completed",t);f.css("width",n.percentBar+"%")},getStateActivity:function(n){var t=this;return n.finishDate?(n.currentState=t.FINISHED_ACTIVITY,t.FINISHED_ACTIVITY):(n.currentState=t.EXECUTING_ACTIVITY,t.EXECUTING_ACTIVITY)},getFirstDate:function(n){var t=this;return n.currentState===t.EXECUTING_ACTIVITY?n.startDate:n.finishDate},getDataByScenarios:function(n){var i=this,t={colorBar:null,percentBar:100,keywordResource:null,unitTime:null},r={};switch(n.currentState){case i.EXECUTING_ACTIVITY:t.keywordResource="opened";t.colorBar=i.getColorByCreatedAndEstimatedDate(n);r={idUser:bizagi.currentUser.idUser,fromDate:n.startDate,toDate:Date.now()};t.unitTime=i.callGetEffectiveDuration(r);break;case i.FINISHED_ACTIVITY:t.colorBar="Gray";t.keywordResource="closed";r={idUser:bizagi.currentUser.idUser,fromDate:n.finishDate,toDate:Date.now()};t.unitTime=i.callGetEffectiveDuration(r)}return t},getColorBar:function(n){var t=this;return t.getDataByScenarios(n).colorBar},getPercentBar:function(n){var t=this;return t.getDataByScenarios(n).percentBar},getKeywordResourceDescriptionBar:function(n){var t=this;return t.getDataByScenarios(n).keywordResource},getUnitTime:function(n){var t=this;return t.getDataByScenarios(n).unitTime},getColorByCreatedAndEstimatedDate:function(n){var r=this,t="Red",i;return n.estimatedFinishDate&&Date.now()<n.estimatedFinishDate&&(i=(new Date).getUTCDate()===new Date(n.estimatedFinishDate).getUTCDate(),t=i?"Yellow":"Green"),t},getFormattedDate:function(n){var t=this,i=t.datePickerRegional.monthNames,r=n.getMonth();return i[r]+" "+bizagi.util.dateFormatter.formatDate(n,"dd hh:mm tt",bizagi.localization.getResource("datePickerRegional"))},callGetEffectiveDuration:function(n){var i=this,t=$.Deferred();return $.when(i.dataService.getEffectiveDuration(n)).done(function(n){t.resolve(n)}),t.promise()}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.activity.time",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.activity.time],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.activity.progress",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.plugins={};r.dialogBox={};r.loadTemplates({"plan-progress-main":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.progress").concat("#project-plan-activity-progress"),"plan-progress-popup-edit":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.progress").concat("#project-plan-activity-edit-progress")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.sub("LOAD_INFO_ACTIVITY_SUMMARY",$.proxy(n.onNotifyLoadInfoActivityExecution,n));n.sub("UPDATE_ITEMS_FROM_FORMRENDER",$.proxy(n.onNotifyUpdateItemFromRender,n))},onNotifyLoadInfoActivityExecution:function(n,t){var i=this,o,u;i.params=$.extend(i.params,t.args);var f=i.getContent().empty(),e=i.params.plan.activities.filter(function(n){return n.id.toUpperCase()==i.params.plan.idActivitySelected.toUpperCase()})[0],r={};r.valuePercentBarComplete=0;r.progress={progress:e.progress,canEdit:e.items.length===0};r.progress.progress&&(r.valuePercentBarComplete=r.progress.progress);o=i.getTemplate("plan-progress-main");o.render(r).appendTo(f);i.plugins.popupEditProgress=i.initPluginPopupEditProgress();u=i.plugins.popupEditProgress;i.formEditProgress={sliderProgress:$("#sliderProgress",u).slider({orientation:"horizontal",range:"min",max:100,width:100,from:5,to:50,step:1,value:r.valuePercentBarComplete,slide:$.proxy(i.onChangesliderProgress,i),change:$.proxy(i.onChangesliderProgress,i)}).each(function(){for(var i,t=$(this).slider("option","max")-$(this).slider("option","min"),n=0;n<=t;n+=10)i=$("<label class='step'>"+n+"<\/label>").css("left",n/t*100+"%"),$(this).append(i)}),numericTextBoxPlugin:$("#inputProgressNumericTextBox",u).spinner({format:"n0",min:0,max:100,spin:$.proxy(i.onChangeNumericTextBoxProgress,i),change:$.proxy(i.onChangeNumericTextBoxProgress,i),value:r.valuePercentBarComplete,decimals:0}),buttonChangeProgress:$("#button-accept-change-progress",u),buttonCancel:$("#button-cancel-change-progress",u)};$(".action-open-popup-edit-progress",f).on("click",$.proxy(i.onShowPopupEditProgress,i));i.formEditProgress.buttonCancel.on("click",$.proxy(i.onClickCancel,i));i.formEditProgress.buttonChangeProgress.on("click",$.proxy(i.onSubmitFormChangeProgress,i));i.updateProgressUI(r.valuePercentBarComplete);i.formEditProgress.numericTextBoxPlugin.spinner("value",r.valuePercentBarComplete)},onNotifyUpdateItemFromRender:function(n,t){var i=this,u=t.args.items,r=t.args.activityWork;u.length>0&&$(".action-open-popup-edit-progress",i.content).hide();$(".bz-wp-timestamp span",i.content).text(r);$(".bz-wp-progress-bar",i.content).css("width",r+"%")},updateProgressUI:function(n){var f=this,t=f.getContent(),i,r,u;$(".bz-wp-timestamp span",t).text(n);i=$(".remaining-days .time-remaining",t);r=$(".remaining-days .days",t).width();i.css("padding-left",(r+7).toString()+"px");u=$(".remaining-days .bar-completed",t);u.css("width",n.toString()+"%")},initPluginPopupEditProgress:function(){var n=this,t=n.getTemplate("plan-progress-popup-edit");return n.dialogBox.formContent=t.render(),n.dialogBox.formContent},onShowPopupEditProgress:function(){var n=this;n.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-project-plan-progress-title"),maximize:!0,open:$.proxy(n.onOpenPopupPlan,n),close:function(){n.dialogBox.formContent.dialog("destroy");n.dialogBox.formContent.detach()}});n.previusValueProgress=n.formEditProgress.sliderProgress.slider("value")},onChangeNumericTextBoxProgress:function(){var n=this,t=n.formEditProgress.numericTextBoxPlugin.spinner("value");n.formEditProgress.sliderProgress.slider("value",t)},onChangesliderProgress:function(){var n=this,t=n.formEditProgress.sliderProgress.slider("value");n.formEditProgress.numericTextBoxPlugin.spinner("value",t)},onClickCancel:function(n){n.preventDefault();var t=this;t.dialogBox.formContent.dialog("destroy");t.dialogBox.formContent.detach();t.formEditProgress.sliderProgress.slider("value",t.previusValueProgress);t.formEditProgress.numericTextBoxPlugin.spinner("value",t.previusValueProgress)},onSubmitFormChangeProgress:function(n){var t,i,r;n.preventDefault();t=this;t.formEditProgress.buttonChangeProgress.prop("disabled",!0);i=t.params.plan.activities.filter(function(n){return n.id==t.params.plan.idActivitySelected})[0];r=$.extend(i,{progress:t.formEditProgress.numericTextBoxPlugin.spinner("value"),idPlan:t.params.plan.id});$.when(t.dataService.editActivityPlan(r)).done(function(){t.formEditProgress.buttonChangeProgress.prop("disabled",!1);i.progress=t.formEditProgress.numericTextBoxPlugin.spinner("value");t.updateProgressUI(i.progress);t.dialogBox.formContent.dialog("destroy");t.dialogBox.formContent.detach()})}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.activity.progress",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.activity.progress],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.activity.subprocesses",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.subprocesses").concat("#project-plan-activity-plan-subprocesses-wrapper"),"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.subprocesses").concat("#project-activity-plan-subprocesses-tooltip-custom-properties-wrapper")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.activity.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.activity.subprocesses]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.activity.parent",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"plan-parent-main":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activity.parent").concat("#project-plan-activity-parent")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.sub("LOAD_INFO_ACTIVITY_SUMMARY",$.proxy(n.onNotifyLoadInfoActivityExecution,n))},onNotifyLoadInfoActivityExecution:function(n,t){var i=this,r;i.params=$.extend(i.params,t.args);r=i.getContent().empty();$.when(i.dataService.getPlanParent({idPlan:i.params.plan.id})).done(function(n){var t,u;if(i.params.plan.parent=n,i.params.plan.parent){t={};t.parent={idParent:i.params.plan.parent.radNumber,nameParent:i.params.plan.parent.displayName,idCase:i.params.plan.parent.idCase,idWorkflow:i.params.plan.parent.idWorkflow,idWorkItem:i.params.plan.parent.idWorkItem,idTask:i.params.plan.parent.idTask};u=i.getTemplate("plan-parent-main");u.render(t).appendTo(r);$("#go-to-parent-case",r).on("click",$.proxy(i.onClickGoToParentCase,i))}})},onClickGoToParentCase:function(n){n.preventDefault();var t=this;t.routingExecute($(n.target).closest("#go-to-parent-case"))}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.activity.parent",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.activity.parent],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.activity.users",{},{init:function(n,t,i){var r=this;r.usersMap={};r.plugins={};r._super(n,t,i);r.loadTemplates({"plan-users-main":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.users").concat("#project-plan-users"),"plan-users-tooltip":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.users").concat("#project-plan-users-tooltip")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.sub("LOAD_INFO_ACTIVITY_SUMMARY",$.proxy(n.onNotifyLoadInfoActivityExecution,n))},onNotifyLoadInfoActivityExecution:function(n,t){var i=this,f=[],r=[],o=i.getContent().empty(),u,e;i.params=$.extend(i.params,t.args);u=i.params.plan.idUserCreator;r.push({idUser:u,userType:["owner"]});i.usersMap["-"+u+"-"]={picture:"",id:u,name:"",userType:["owner"]};f.push(u);$.each(i.params.plan.activities,function(n,t){var e=parseInt(t.userAssigned,0);e===u?$.inArray("Assigned",r[0].userType)===-1&&(r[0].userType.push("Assigned"),i.usersMap["-"+u+"-"].userType.push("Assigned")):(i.usersMap["-"+e+"-"]={picture:"",id:e,name:"",userType:["Assigned"]},r.filter(function(n){return n.idUser==e}).length===0&&(r.push({idUser:e,userType:["Assigned"]}),f.push(e)))});e=i.getTemplate("plan-users-main");e.render({owner:r[0],assignee:r.slice(1),label:bizagi.localization.getResource("workportal-project-plan-assignee")}).appendTo(o);i.plugins.tooltip=i.initilizeTooltip();$.when(i.callGetDataUsers(f)).then(function(){i.renderUserProfilesAndImages()})},renderUserProfilesAndImages:function(){var n=this;$.each(n.usersMap,function(t,i){var r=$(".ui-bizagi-wp-userlist li[data-iduser="+i.id+"]",n.content);i.picture!==""?r.find("img").prop("src",i.picture):(r.find("img").hide(),i.name?r.find("span").html(i.name.getInitials()):console.log("obj.name is undefined"))})},callGetDataUsers:function(n){var t=this,i={},r=$.Deferred();return i={userIds:n.join(),width:50,height:50},$.when(t.dataService.getUsersData(i)).always(function(n){for(var i=0,u=n.length;i<u;i+=1)typeof n[i].name=="undefined"?bizagi.log(n[i]+" Id Not Found",n,"error"):t.usersMap["-"+n[i].id+"-"]?(t.usersMap["-"+n[i].id+"-"].picture+=n[i].picture?"data:image/png;base64,"+n[i].picture:"",t.usersMap["-"+n[i].id+"-"].name=n[i].name||""):console.log("The object is undefined");r.resolve()}),r.promise()},initilizeTooltip:function(){var n=this;return $(".ui-bizagi-wp-userlist",n.content).kendoTooltip({filter:"li[data-iduser]",content:$.proxy(n.renderUserTooltip,n),showOn:"mouseenter"}).data("kendoTooltip")},renderUserTooltip:function(n){var t=this,u=t.getTemplate("plan-users-tooltip"),i=n.target.data("iduser"),r=[];return r=i!==0?[t.usersMap["-"+i+"-"]]:$.map(t.usersMap,function(n){if(n.userType.join().indexOf("owner")===-1)return n}),u.render({users:r})}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.activity.users",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.activity.users],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity.plan",{},{init:function(n,t,i){var r=this;r.params=i||{};r._super(n,t,i);r.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan").concat("#project-dashboard-menu2")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.params.contextsLeftSidebarCaseDashboard.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,r;i.params=$.extend(i.params,t.args);i.clean();var u=i.getContent().empty(),f={showFormOverview:i.params.menuDashboard.showFormOverview,showFormActivity:i.params.menuDashboard.showFormActivity,showCommentsOptionMenu:i.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:i.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:i.params.menuDashboard.showTimeLineOptionMenu,showPlanOptionMenu:i.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:i.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:i.params.menuDashboard.contextFormActivityOptionMenu,contextualized:i.params.plan.contextualized},e=i.getTemplate("project-dashboard-menu");e.render(f).appendTo(u);i.params.showContextByMenuDashboard&&$("li[data-context='"+n.type.toUpperCase()+"']",i.content).addClass("active").siblings().removeClass("active");i.handlerEvents();r={idPlan:i.params.plan.id};$.when(i.callGetPlan(r)).then(function(n){$.extend(i.params.plan,n);i.pub("notify",{type:"LOAD_INFO_PLAN",args:i.params})})},loadContentById:function(n){var t=this,i;n.preventDefault();i=$(n.target).closest("li");i.hasClass("active")||$.when(bizagi.util.autoSave()).done(function(){var n;if($(document).data("auto-save",""),n=i.data("context"),n){var e=t.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),r=parseInt(e[0]),u="",f=r;n==="PLANACTIVITIES"&&(f=r+1,u=bizagi.localization.getResource("workportal-project-casedashboard-plan"),t.params.planParent={},t.params.planParent.id=bizagi.clone(t.params.plan.id),t.params.planParent.idActivitySelected=t.params.plan.idActivitySelected);t.params.refreshLastItemBreadcrumb=!1;t.pub("notify",{type:n.toUpperCase(),args:$.extend(t.params,{showContextByMenuDashboard:n,histName:u,level:f})});$("li[data-context='"+t.params.showContextByMenuDashboard.toUpperCase()+"']",t.content).addClass("active").siblings().removeClass("active")}})},callGetPlan:function(n){var i=this,t=$.Deferred();return i.dataService.getPlan(n).always(function(n){n.status===200||n.status===201||n.status===undefined?t.resolve(n):t.reject()}),t.promise()},subMenuHandler:function(){var t=this,n=t.getContent(),i=$("[data-context='ACTIVITYPLANCOMMENTS']",n),r=$("[data-context='ACTIVITYPLANFILES']",n),u=$("[data-context='ACTIVITYPLANTIMELINE']",n);$(".ui-bizagi-wp-project-tab-submenu a",n).on("click",function(){i.toggle();r.toggle();u.toggle()})},handlerEvents:function(){var n=this,t=n.getContent();n.subMenuHandler();$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(n.loadContentById,n))},clean:function(){var n=this,t=n.getContent();n.params&&n.params.contextsLeftSidebarCaseDashboard&&n.params.contextsLeftSidebarCaseDashboard.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))});$(".ui-bizagi-wp-project-tab-links a",t).off()}});bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity.plan",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity.plan],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var n=this,t=n.getTemplate("project-content-dashboard");return n.content=t.render({}),n.content},postRender:function(){var n=this;setTimeout(function(){$(window).trigger("resize")},1e3)}});bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processMap",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"project-processmap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-wrapper"),"project-process-diagram":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-process-diagram"),"project-activity-map":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-activity-map"),"project-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-subprocess")})},renderContent:function(){var n=this,i=n.getTemplate("project-processmap"),t=n.viewOptions={processDiagram:bizagi.util.parseBoolean(n.params.showProcessDiagram)!==null?bizagi.util.parseBoolean(n.params.showProcessDiagram):!0,activityMap:bizagi.util.parseBoolean(n.params.showActivityMap)!==null?bizagi.util.parseBoolean(n.params.showActivityMap):!0,processMap:bizagi.util.parseBoolean(n.params.showProcessMap)!==null?bizagi.util.parseBoolean(n.params.showProcessMap):!0};return n.viewOptions.showTabs=Number(t.processDiagram)+Number(t.activityMap)+Number(t.processMap)>1,n.content=i.render(n.viewOptions),n.content},postRender:function(){var n=this,t=$(".ui-bizagi-wp-project-processmap-content",n.getContent());$(t).is(":empty")&&(n.viewOptions.processDiagram?n.onProcessDiagram():n.viewOptions.activityMap?n.onActivityMap():n.viewOptions.processMap&&n.onSupprocess());n.configureHandlers();n.resize()},configureHandlers:function(){var n=this,t=n.getContent(),r=$(".ui-bizagi-wp-project-processmap-process-diagram",t),u=$(".ui-bizagi-wp-project-processmap-activity-map",t),f=$(".ui-bizagi-wp-project-processmap-subprocess",t),i=function(n){$(".selected",t).removeClass("selected");$(n).addClass("selected")};r.on("click",function(){i(this);n.onProcessDiagram()});u.on("click",function(){i(this);n.onActivityMap()});f.on("click",function(){i(this);n.onSupprocess()})},onProcessDiagram:function(){var n=this;n.navigationManager(n.getTemplate("project-process-diagram"));n.renderProcessDiagram()},onActivityMap:function(){var n=this;n.navigationManager(n.getTemplate("project-activity-map"));n.renderActivityMap()},onSupprocess:function(){var n=this,i=n.getContent(),t;n.navigationManager(n.getTemplate("project-subprocess"));t={diagram:"subprocess",$container:$(".ui-bizagi-wp-project-processmap-subprocess-content",i),tooltipClass:"bz-gq-subprocess-tooltip-wrapper",items:".subprocess-tooltip",radNumber:bizagi.context.radNumber};n.renderSubProcessMap();n.bindTooltip(t);n.appendSubprocessZoom();n.appendSubprocessDragScroll()},navigationManager:function(n){var t=this,i=$(".ui-bizagi-wp-project-processmap-content",t.getContent());$(i).empty();$(i).append(n.render(t.viewOptions))},renderProcessDiagram:function(){var n=this,e=$(".ui-bizagi-wp-project-processmap-content",n.getContent()),i,r=n.params.idCase||bizagi.context.idCase||0,u=n.params.idWorkflow||bizagi.context.idWorkflow||0,t,f;n.params.plan.idActivitySelected&&(r=n.params.plan.firstParent.idCase,u=n.params.plan.firstParent.idWorkflow||0);t={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_PROCESS_DIAGRAM_HELPER,data:{idCase:r,idWorkflow:u}};f=t.widgetInstance?t.widgetInstance:n.workportalFacade.getWidget(t.widgetName,t);$.when(f).pipe(function(n){return i=n,i.render(t)}).done(function(){var t=i.getContent(),r=$(".ui-bizagi-wp-project-processmap-process-diagram-content",e);$(r).append(t);n.resize()})},resize:function(){var n=this,t=$(".ui-bizagi-wp-project-processmap-content",n.getContent()),i=$(window).height()},renderActivityMap:function(){var t=this,n=t.getContent(),i=bizagi.context.radNumber||null,r=bizagi.context.idCase||null;$.when(t.dataService.getActivityMap({radNumber:i})).done(function(i){var u,f;$("#bz-activity-map",n).empty();typeof i.activities=="undefined"||i.activities.length===0?(u='<div class="admin-stakeholder-message"> <i class="bz-wp-empty__img"><\/i> <p class="bz-wp-empty__info bz-wp-empty__info--first"> '+bizagi.localization.getResource("workportal-general-first-line-no-records-found")+"<\/p><\/div>",$("#bz-activity-map",n).append(u),$(".bz-zoom-container",n).hide()):($("#bz-activity-map",n).activityMap({data:i,width:"100%",height:"100%",currentActivity:r}),f={diagram:"activityMap",$container:$(".ui-bizagi-wp-project-processmap-activity-map-content",n),tooltipClass:"bz-gq-activity-map-tooltip-wrapper",items:".activity-map-tooltip",radNumber:bizagi.context.radNumber},t.bindTooltip(f),$(".bz-zoom-container",n).show(),t.appendActivityMapZoom(),t.resize())})},renderSubProcessMap:function(){var n=this,t=n.getContent(),r=bizagi.context.radNumber||null,i=$("#bz-subprocess-map",t);$.when(n.dataService.getSubProcessMap({radNumber:r})).done(function(r){i.height($(window).height()-250);i.processMap({data:r});var u={diagram:"subprocess",$container:$(".ui-bizagi-wp-project-processmap-subprocess-content"),tooltipClass:"bz-gq-subprocess-tooltip-wrapper",items:".subprocess-tooltip",radNumber:bizagi.context.radNumber};n.bindTooltip(u);$(".bz-zoom-container",t).show();n.appendProcessMapZoom();n.resize()})},appendActivityMapZoom:function(){var n=this,t=$(".ui-bizagi-wp-project-processmap-content",n.getContent()),i=$(".bz-activity-map-zoom-wrapper",t);i.zoom({onZoom:function(n){$("#bz-activity-map").trigger("zoom",[n/100])}})},appendProcessMapZoom:function(){var n=this,t=$(".ui-bizagi-wp-project-processmap-content",n.getContent()),i=$(".bz-processmap-zoom-wrapper",t);i.zoom({onZoom:function(n){$("#bz-subprocess-map").trigger("zoom",[n/100])}})},appendSubprocessZoom:function(){var n=this,r=$(".ui-bizagi-wp-project-processmap-subprocess-content",n.getContent()),t=$("#bz-subprocess-map",n.getContent()),i=$(".bz-subprocess-zoom-wrapper");i.zoom({onZoom:function(n){t.processMap("scale",n/100)}})},appendSubprocessDragScroll:function(){var n=this,t=$(".ui-bizagi-wp-project-processmap-subprocess-content",n.getContent());$content=$("#bz-subprocess-map",n.getContent());$content.dragScroll({$scrollable:t})},bindTooltip:function(n){var r=this,i,t={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_ACTIVITY_MAP_TOOLTIP,radNumber:n.radNumber},u=t.widgetInstance?t.widgetInstance:r.workportalFacade.getWidget(t.widgetName,t);$.when(u).pipe(function(n){return i=n,i.render(t)}).done(function(){i.bindTooltip(n)})}});bizagi.injector.register("bizagi.workportal.widgets.project.processMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.processMap]);
bizagi.workportal.widgets.graphicquery.extend("bizagi.workportal.widgets.project.processDiagram.helper",{},{getPVHeight:function(){var t=this,i=$(window).height()-50,r=t.$header.height()+180,n=$(".ui-bizagi-wp-project-tab-content").height(),n=n||i;return n-r}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.sidebar",{},{init:function(n,t,i){var r=this;r._super(n,t,i);i=i||{};i.supportNav=!1;r.loadTemplates({"project-activity-sidebar":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.sidebar").concat("#project-activity-sidebar")})},renderContent:function(){var n=this,t=n.getTemplate("project-activity-sidebar");return n.content=t.render({}),n.content}});bizagi.injector.register("bizagi.workportal.widgets.project.activity.sidebar",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.sidebar]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap",{},{init:function(n,t,i){var r=this;r.radNumber=i.radNumber;r._super(n,t,i);r.loadTemplates({"project-activityMap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityMap").concat("#project-activityMap-wrapper")})},renderContent:function(){var n=this,t=n.getTemplate("project-activityMap");return n.content=t.render({}),n.content},postRender:function(){var n=this;n.sub("HOME",$.proxy(n.updateView,n));n.sub("OVERVIEW",$.proxy(n.updateView,n));n.sub("COMMENTS",$.proxy(n.updateView,n));n.sub("PROCESSMAP",$.proxy(n.updateView,n));n.sub("LOG",$.proxy(n.updateView,n));n.sub("PLANCREATE",$.proxy(n.updateView,n));n.sub("PLANCOMMENTS",$.proxy(n.updateView,n))},updateView:function(n,t){var r=this,i=t.args,e=r.getContent().empty(),u={},f;u.actualState="";i.currentState[0]&&(u.actualState=i.currentState[0].state);f=r.getTemplate("project-activityMap");f.render($.extend(i,u)).appendTo(e);r.params=i}});bizagi.injector.register("bizagi.workportal.widgets.project.activityMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityMap],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap.tooltip",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"project-tooltip":bizagi.getTemplate("bizagi.workportal.desktop.widget.activityMap.tooltip").concat("#project-processmap-tooltip")});r.cache={};r.radNumber=i.radNumber},renderContent:function(){},postRender:function(){var n=this;n.dateFormat=n.getResource("dateFormat")+" "+n.getResource("timeFormat")},configureHandlers:function(n,t){var i=this;n.find(".ui-bizagi-wp-project-processmap-process").on("click",$.proxy(i.onProcess,i,t));n.find(".ui-bizagi-wp-project-processmap-tooltip-title").on("click",$.proxy(i.onIdCase,i,t))},onProcess:function(n){var t=this;t.showGraphicQuery(n)},onIdCase:function(n,t){var i=this,r=$(t.currentTarget).data("idcase"),u=$(t.currentTarget).data("idworkitem"),f=$(t.currentTarget).data("idtask"),e=$(t.currentTarget).data("idworkflow");i.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:r,idWorkItem:u,idTask:f,idWorkflow:e})},bindTooltip:function(n){var t=this;t.tooltipClass=n.tooltipClass;n.$container.tooltip({items:n.items,content:function(i){var f=n.$container.data("clicked")||!1,r,u;if(!f){if(r=n.diagram,r=="activityMap"){if($(this).is("circle")){if(this.className.baseVal.indexOf("activity-map-activity-highlight")<0)return}else return;$.when(t.getActivityMapTooltipContent($(this))).done(function(n){i(n)})}else u=t.getSubprocessTooltipContent($(this)),i(u);return"loading.."}},open:function(){for(var n=0;n<$(".ui-tooltip").length-1;n++)$("#"+$(".ui-tooltip")[n].id).remove()},show:{duration:60,effect:"none"},tooltipClass:t.tooltipClass,hide:{delay:60,duration:60},position:{my:"left+20 top+20"},close:function(n,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(120,1)},function(){$(this).fadeOut(20,function(){$(this).remove()})})}})},getActivityMapTooltipContent:function(n){var t=this,r=new $.Deferred,u=n.data("guidWorkitem"),e=n.data("idCase"),o=n.data("idWorkflow"),i={guidWorkitem:u,gqData:{idCase:e,idWorkflow:o}},f;return t.guidWorkitem=u,t.isCached(i.guidWorkitem)?(f=t.cache[i.guidWorkitem],r.resolve(t.buildContent(f,i.gqData))):$.when(t.dataService.getActivitySummary(i)).done(function(n){r.resolve(t.buildContent(n,i.gqData));t.appendToCache(i.guidWorkitem,n)}),r.promise()},getSubprocessTooltipContent:function(n){var t=this,i=n.data("idcase"),r=n.data("idworkflow"),u={gqData:{idCase:i,idWorkflow:r}},f={endDate:n.data("enddate"),startDate:n.data("startdate"),process:n.data("process"),idCase:n.data("idcase")};return t.buildContent(f,u.gqData)},appendToCache:function(n,t){var i=this;i.cache[n]=t},isCached:function(n){var t=this;return typeof t.cache[n]!="undefined"},buildContent:function(n,t){var i=this,r=$("<div><\/div>"),u=i.getTemplate("project-tooltip"),f=typeof n.assigneeName!="undefined";return n.assignee=f,n.radNumber=i.radNumber,n.idWorkflow=t.idWorkflow,n.idTask=n.idTask||0,n.idWorkitem=n.idWorkItem||0,r=u.render(n),$("."+i.tooltipClass).html(r),bizagi.util.formatInvariantDate(r,i.dateFormat),i.configureHandlers(r,t),r}});
