bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.queries",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERIES},renderContent:function(){var n=this,t=n.getTemplate("queries"),i=n.content=$.tmpl(t);return n.loadtemplates(),i},loadtemplates:function(){}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.queryform",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM},renderContent:function(){var n=this;bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms)&&!n.params.notMigratedUrl?n.modifiedRender():n.frankensteinRenderContent()},modifiedRender:function(){var n=this,i=n.getTemplate("queryform-wrapper"),t;return t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){},frankensteinRenderContent:function(){var n=this,f=n.getTemplate("queryform"),t="",r=n.params.idQueryForm||"",i=n.params.idStoredQuery||"",u=n.params.idCube||"";switch(n.params.queryFormAction){case"edit":t=n.dataService.getUrl({endPoint:"query-form-edit"})+"?idStoredQuery="+i+"&idQueryForm="+r;break;case"loadPrevious":t="App/ListaDetalle/listaitems.aspx?"+n.dataService.lastQueryFullKey;break;default:t=n.dataService.getUrl({endPoint:"query-form"})+"?idQueryForm="+r;t=i!=""?t+"&idStoredQuery="+i:t;t=u!=""?t+"&idCube="+u:t}return n.params.notMigratedUrl&&(t="App/"+n.params.notMigratedUrl),n.content=$.tmpl(f,{queryFormURL:t})}});
bizagi.workportal.widgets.queries.extend("bizagi.workportal.widgets.queries",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),useNewEngine:!1})},postRender:function(){var n=this;n.configureTreeNavigation();n.configureBackButton();n.renderQueries();n.scrollVertical({autohide:!1})},renderQueries:function(n,t){var i=this,e=i.getContent(),o=i.getTemplate("queries-elements"),s=i.getTemplate("queries-empty-elements"),u=$("#queries",e),f,r;$.when(i.dataService.getQueries({idElement:n})).done(function(n){u.empty();n=n||{};n.length>=1?(r=t!=undefined?$.merge(t,n):n,f=$.tmpl(o,r,{checkChildNode:i.checkChildNode})):f=$.tmpl(s,r);f.appendTo(u);i.configureNavTree(u)})},configureNavTree:function(){var n=this,t=n.getTemplate("queries-query-confirm");$("li","#queries").click(function(){var s=$(this).children("#idCube").val(),i=$(this).children("#queryId").val(),h=$(this).children("#prefix").val(),c=$(this).children("#nodesLength").val(),r=$(this).children("#idStoredQuery").val(),t=$(this).children("#id").val(),u=$(this).children("#queryDisplayName").val(),f=n.getTemplate("queries-query-tree"),e=$("#categoryTree"),o;i=="-1"?($.tmpl(f,{idParentQuery:t,queryDisplayName:u}).appendTo(e),n.configureTreeNavigation(),n.renderQueries(t)):c>0?($.tmpl(f,{idParentQuery:t,queryDisplayName:u}).appendTo(e),n.configureTreeNavigation(),n.renderQueries(t,[{queryDisplayName:u,idStoredQuery:r,id:t,idParent:"",queryId:i,prefix:h,nodes:[],idCube:$(this).data("idcube"),categoryWithLink:"true"}])):(bizagi.workportal.desktop.popup.closePopupInstance(),o=this.data("queryDisplayName"),n.showQueryFormPopup({idQuery:i,idStoredQuery:r=="-1"?"":r,title:o,idCube:s}))});$(".editButton","#queries").click(function(t){t.stopPropagation();var i=$(this).parent().find("#idStoredQuery").val();n.showQueryFormPopup({queryFormAction:"edit",idQuery:"-1",idStoredQuery:i=="-1"?"":i,title:$("#queryDisplayName",$(this).parent()).val()});bizagi.workportal.desktop.popup.closePopupInstance()});$(".deleteButton","#queries").click(function(i){i.stopPropagation();var f=$(this).parent().find("#idStoredQuery").val(),r=$(this).parent().find("#prefix").val(),e=$(this).parent().find("#idCube").val(),o=$.tmpl(t),u;r=="prefix_MyStoredQuery"?u=n.dataService.getUrl({endPoint:"query-form-delete"})+"?idStoredQueryDel="+f+"&idQueryForm=-1":r=="prefix_Cube"&&(u=n.dataService.getUrl({endPoint:"query-form-delete-cube"}));$(o).dialog({resizable:!0,modal:!0,title:n.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:n.getResource("workportal-widget-queries-confirm-delete"),click:function(){r=="prefix_MyStoredQuery"?$.ajax({url:u}):r=="prefix_Cube"&&$.destroy(u,{idCube:e});$(this).dialog("close");bizagi.workportal.desktop.popup.closePopupInstance()}},{text:n.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})})},configureBackButton:function(){var n=this,t=n.getContent(),r=$("#bt-back",t),i=$("#categoryTree",t);r.click(function(){if($("li",i).length>1){$("li:last-child",i).remove();var t=$("li:last-child").children("#idParent").val();n.renderQueries(t)}})},configureTreeNavigation:function(){var n=this,t=n.getContent(),i=$("#categoryTree",t);$("li:last-child",i).click(function(){$(this).nextAll().remove();var t=$(this).children("#idParent").val();n.renderQueries(t)})},scrollVertical:function(){var n=this,t=n.getContent();$("#queries",t).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(n){var t=this,i=n.idQuery||"",r=n.idStoredQuery||"",u=n.queryFormAction||"",f=n.title||"",e=n.idCube||"";if(t.currentPopup=="queryform"){bizagi.workportal.desktop.popup.closePopupInstance();return}t.currentPopup="queryform";t.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,idQueryForm:i,idStoredQuery:r,queryFormAction:u,idCube:e,modalParameters:{title:f,id:"Queries"}})}});
bizagi.workportal.widgets.queries.extend("bizagi.workportal.widgets.queries.definition",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),"queries-definition-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-definition-elements"),"queries-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-flat-list"),"queries-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-message-error"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.mainTemplate=n.getTemplate("queries-definition-elements");n.emptyTemplate=n.getTemplate("queries-empty-elements");n.flatListTemplate=n.getTemplate("queries-flat-list");n.confirmTemplate=n.getTemplate("queries-query-confirm");n.messageErrorTemplate=n.getTemplate("queries-query-message-error")},postRender:function(){var n=this;n.configureTreeNavigation("#queries");n.renderQueries();n.scrollVertical({autohide:!1})},renderQueries:function(n,t){var i=this,o=i.getContent(),e=i.mainTemplate,s=i.emptyTemplate,r=$("#queries",o),u,f;$.when(i.dataService.getQueriesDefinitions({idNode:n})).done(function(o){r.empty();o=o||{};o.length>=1?(f=t!==undefined?$.merge(t,o):o,u=$.tmpl(e,f,{checkChildNode:i.checkChildNode})):u=$.tmpl(s,f);typeof n=="undefined"||n==="-1"?$.when(i.dataService.getStoredQueryFormList()).done(function(n){if(u.appendTo(r),n.storedQueryForms.length>0){var t=$.tmpl(e,{queryType:"-2",queryDisplayName:i.getResource("workportal-widget-queries-stored-query-forms"),nodes:[],guidForm:"stored"}),f=$.merge(u,t);f.appendTo(r);i.storedQueryForm=n.storedQueryForms}i.configureNavTree(r)}):u.appendTo(r);i.configureNavTree(r)})},renderStoredQueries:function(){var n=this,i=n.getContent(),r=n.flatListTemplate,u=$("#queries",i),t;t=$.tmpl(r,{storedQueryForm:n.storedQueryForm});t.appendTo(u)},configureNavTree:function(){var n=this,t=n.getTemplate("queries-query-confirm");$("li","#queries").click(function(){var t=$(this).children("#idNode").val(),l=$(this).children("#guidQueryForm").val(),o=$(this).children("#guidForm").val(),s=$(this).children("#guidContext").val(),i=$(this).children("#queryType").val(),h=$(this).children("#nodesLength").val(),r=$(this).children("#queryDisplayName").val(),u=n.getTemplate("queries-query-tree"),f=$("#categoryTree"),c=$(this).children("#notMigratedUrl").val(),e;i=="-2"?(n.renderStoredQueries(),$.tmpl(u,{idParentQuery:"-2",queryDisplayName:r}).appendTo(f),n.configureTreeNavigation("#queries")):h>0?($.tmpl(u,{idParentQuery:t,queryDisplayName:r}).appendTo(f),n.configureTreeNavigation("#queries"),n.renderQueries(t)):(bizagi.workportal.desktop.popup.closePopupInstance(),e=$("#queryDisplayName",this).val(),n.showQueryFormPopup({guidForm:o,guidEntity:s,title:e,queryFormAction:"renderQueryForm",queryType:i,notMigratedUrl:c}))});$(".deleteGAButton").click(function(t){t.stopPropagation();var u=$.tmpl(n.confirmTemplate),i={resizable:!0,modal:!0,title:n.getResource("workportal-widget-queries-confirm-title"),buttons:[]},r=$("#notMigratedUrlDelete",$(this).parent()).val();i.buttons=[{text:n.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close");r&&$.destroy(r);bizagi.workportal.desktop.popup.closePopupInstance()}},{text:n.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}];$(u).dialog(i)})},configureTreeNavigation:function(n){var t=this,i=t.getContent(),r=$("#categoryTree",i),u=$(n,i);$("li:last-child",r).click(function(){$(this).nextAll().remove();var n=$(this).children("#idParent").val();n=="-2"?t.renderStoredQueries():t.renderQueries(n)});$("li.storedQuery",u).click(function(){var r=$(this).data("guid"),f=$(this).data("id"),u=$(this).data("idnode"),n,i=$.grep(t.storedQueryForm,function(n){return n.idNode==u});i.length==1&&(n=i[0],t.showQueryFormPopup({idStoredQuery:r,idQuery:1,title:n.definition.name,paramsStoredQuery:n,queryFormAction:"execute",notMigratedUrl:n.notMigratedUrl?n.notMigratedUrl.execute:""}))});$(".editButton",n).click(function(n){n.stopPropagation();var e=$(this).parent().data("guid"),r=$(this).parent().data("id"),f=$(this).parent().data("idnode"),i,u=$.grep(t.storedQueryForm,function(n){return n.idNode==f});u.length==1&&(i=u[0],t.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:r=="-1"?"":r,paramsStoredQuery:i,title:i.definition.name,notMigratedUrl:i.notMigratedUrl?i.notMigratedUrl.edit:""}),bizagi.workportal.desktop.popup.closePopupInstance())});$(".deleteButton",n).click(function(n){var e,o;n.stopPropagation();var c=$(this).parent().data("guid"),s=$(this).parent().data("id"),h=$(this).parent().data("idnode"),r,i,u,f=t.getResource("workportal-widget-admin-entities-message-migrate");f=f.replace("{build}",bizagi.loader.productBuildToAbout);e=$.grep(t.storedQueryForm,function(n){return n.idNode==h});e.length==1&&(i=e[0],u={resizable:!0,modal:!0,title:t.getResource("workportal-widget-queries-confirm-title"),buttons:[]},o=bizagi.cookie("JSESSIONID"),o!==null&&i.notMigratedUrl?r=$.tmpl(t.messageErrorTemplate,{messageError:f}):(r=$.tmpl(t.confirmTemplate),u.buttons=[{text:t.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close");i.notMigratedUrl&&i.notMigratedUrl["delete"]?$.get("App/"+i.notMigratedUrl["delete"]):t.dataService.deleteStoredQueryForm({idStoredQueryForm:s});bizagi.workportal.desktop.popup.closePopupInstance();t.publish("refreshQueryFormShortCut")}},{text:t.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]),$(r).dialog(u))})},scrollVertical:function(){var n=this,t=n.getContent();$("#queries",t).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(n){var t=this,i=n.queryFormAction||"",r=n.title||"",u=n.queryType||"",f=n.guidForm||"",e=n.guidEntity||"",o=n.paramsStoredQuery||{};if(t.currentPopup=="queryform"){bizagi.workportal.desktop.popup.closePopupInstance();return}t.currentPopup="queryform";t.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,queryFormAction:i,queryType:u,paramsStoredQuery:o,modalParameters:{title:r,id:"Queries"},closeVisible:!1,guidForm:f,guidEntity:e,notMigratedUrl:n.notMigratedUrl||"",maximizeOnly:!0,editQueryForm:function(n){t.currentPopup=undefined;t.showPopUpEditQueryForm(n)},executeQueryForm:function(n){t.currentPopup=undefined;t.showPopUpResultsQueryForm(n)}})},showPopUpEditQueryForm:function(n){var t=this,i=t.getContent();$.when(t.dataService.getStoredQueryFormList()).done(function(i){if(t.storedQueryForm=i.storedQueryForms,t.publish("refreshQueryFormShortCut"),n&&n.response){var r=n.response;t.editQueryForm(r)}})},showPopUpResultsQueryForm:function(n){var t=this,i=t.getContent();$.when(t.dataService.getStoredQueryFormList()).done(function(i){if(t.storedQueryForm=i.storedQueryForms,t.publish("refreshQueryFormShortCut"),n&&n.response){var r=n.response;t.executeQueryForm(r)}})},editQueryForm:function(n){var i=this,t=i.getParamsStoredQuery(n);t.length==1&&(t=t[0],i.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:n=="-1"?"":n,paramsStoredQuery:t,title:t.definition.name,notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.edit:""}))},executeQueryForm:function(n){var i=this,t=i.getParamsStoredQuery(n);t.length==1&&(t=t[0],i.showQueryFormPopup({idStoredQuery:t.guid,idQuery:1,title:t.definition.name,paramsStoredQuery:t,queryFormAction:"execute",notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.execute:""}))},getParamsStoredQuery:function(n){var t=this;return $.grep(t.storedQueryForm,function(t){return t.id==n})}});
bizagi.workportal.widgets.queries.definition.extend("bizagi.workportal.widgets.queries.shortcut",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),"queries-definition-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-definition-elements"),"queries-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-flat-list"),"queries-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-message-error"),"queries-shortcut":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-shortcut"),"queries-shortcut-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-flat-list-shortcut"),"queries-shortcut-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-confirm-shortcut"),"queries-shortcut-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-message-error-shortcut"),useNewEngine:!1})},loadtemplates:function(){var n=this;n.flatListTemplate=n.getTemplate("queries-shortcut-flat-list");n.confirmTemplate=n.getTemplate("queries-shortcut-query-confirm");n.messageErrorTemplate=n.getTemplate("queries-shortcut-query-message-error")},postRender:function(){var n=this,t=n.getTemplate("queries-shortcut"),i=n.content=$.tmpl(t);n.handleEvents();bizagi.workportal.widgets.queries.shortcut.instance=this},handleEvents:function(){var n=this;$("#queryFormShortcutContainer").show();$("#queryFormShortcutContainer").click(function(){var i=$("#queryFormShortcut"),t=$(this).find("span"),r=i.is(":hidden")?!0:!1;r?(i.show(),t.removeClass("Right"),t.addClass("Down"),n.renderStoredQueries()):(i.hide(),t.removeClass("Down"),t.addClass("Right"))})},configureTreeNavigation:function(){var n=this,i=$("#categoryTree",n.content),t=$("#queries-shortcut",n.content);$("li.storedQuery",t).click(function(){var r=$(this).data("guid"),f=$(this).data("id"),u=$(this).data("idnode"),t,i=$.grep(n.storedQueryForm,function(n){return n.idNode==u});i.length==1&&(t=i[0],n.showQueryFormPopup({idStoredQuery:r,idQuery:1,title:t.definition.name,paramsStoredQuery:t,queryFormAction:"execute",notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.execute:""}));n.currentPopup=undefined});$(".bz-icon-pencil-outline","#queries-shortcut").click(function(){var f=$(this).closest(".storedQuery").data("guid"),i=$(this).closest(".storedQuery").data("id"),u=$(this).closest(".storedQuery").data("idnode"),t,r=$.grep(n.storedQueryForm,function(n){return n.idNode==u});r.length==1&&(t=r[0],n.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:i=="-1"?"":i,paramsStoredQuery:t,title:t.definition.name,notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.edit:""}),bizagi.workportal.desktop.popup.closePopupInstance())});$(".bz-icon-close","#queries-shortcut .bz-shorcut__icons").click(function(t){var e,o;t.stopPropagation();var c=$(this).closest(".storedQuery").data("guid"),s=$(this).closest(".storedQuery").data("id"),h=$(this).closest(".storedQuery").data("idnode"),r,i,u,f=n.getResource("workportal-widget-admin-entities-message-migrate");f=f.replace("{build}",bizagi.loader.productBuildToAbout);e=$.grep(n.storedQueryForm,function(n){return n.idNode==h});e.length==1&&(i=e[0],u={resizable:!0,modal:!0,title:n.getResource("workportal-widget-queries-confirm-title"),buttons:[]},o=bizagi.cookie("JSESSIONID"),o!==null&&i.notMigratedUrl?r=$.tmpl(n.messageErrorTemplate,{messageError:f}):(r=$.tmpl(n.confirmTemplate),u.buttons=[{text:n.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close");i.notMigratedUrl&&i.notMigratedUrl["delete"]?$.get("App/"+i.notMigratedUrl["delete"]):$.when(n.dataService.deleteStoredQueryForm({idStoredQueryForm:s})).done(function(){bizagi.workportal.desktop.popup.closePopupInstance();n.renderStoredQueries()});n.renderStoredQueries();bizagi.workportal.desktop.popup.closePopupInstance()}},{text:n.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]),$(r).dialog(u))})},renderStoredQueries:function(){var n=this,i=n.flatListTemplate,r=$("#queries-shortcut",n.content),t;$.when(n.dataService.getStoredQueryFormList()).done(function(u){n.storedQueryForm=u.storedQueryForms;t=$.tmpl(i,{storedQueryForm:n.storedQueryForm});t.appendTo(r);n.configureTreeNavigation();n.storedQueryForm.length<=0?$("#queryFormShortcutContainer").hide():$("#queryFormShortcutContainer").show()})}});
bizagi.workportal.widgets.queryform.extend("bizagi.workportal.widgets.queryform",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({queryform:bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-frankenstein-queryform-wrapper"),"queryform-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-wrapper"),"queryform-container":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-container"),"queryform-buttons":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-buttons"),"queryform-graphic-analysis":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-graphic-analysis"),"queryform-result-set":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-result-set"),"queryform-search-result":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-search-result"),"queryform-pagination":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-pagination"),"queryform-admin-result":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-admin-result"),"queryform-share-selection":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-share-selection"),"queryform-select-user":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-select-user"),"queryform-select-group":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-select-group"),"queryform-save-as":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-save-as"),"queryform-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform--message-error"),useNewEngine:!1})},postRender:function(){var n=this;n.params.notMigratedUrl=="true"&&(n.params.notMigratedUrl=Boolean(n.params.notMigratedUrl));n.params.notMigratedUrl==""||n.params.notMigratedUrl==!0?n.modifiedPostRender():n.frankensteinPostRender()},loadtemplates:function(){var n=this;n.container=n.getTemplate("queryform-container");n.buttons=n.getTemplate("queryform-buttons");n.graphicalAnalysisContainer=n.getTemplate("queryform-graphic-analysis");n.resultSet=n.getTemplate("queryform-result-set");n.searchResult=n.getTemplate("queryform-search-result");n.paginationTmpl=n.getTemplate("queryform-pagination");n.adminResult=n.getTemplate("queryform-admin-result");n.selectUser=n.getTemplate("queryform-select-user");n.selectGroup=n.getTemplate("queryform-select-group");n.shareSelection=n.getTemplate("queryform-share-selection");n.dialogSaveAs=n.getTemplate("queryform-save-as")},modifiedPostRender:function(){var n=this,t=n.getContent(),i,u,r,f;if(n.maxElemShow=10,n.maxPageToShow=5,n.atLeastOneChecked=!1,n.selectedItemsToShare={users:[],groups:[]},n.readyToSave=!1,n.includeAllUsers=!1,n.saveAs=!1,n.sortedField={},n.storedQueryFormParameters={},n.dialogSaveAs=$.tmpl(n.dialogSaveAs),n.orderType={ASC:"ASC",DESC:"DESC",NONE:"NONE"},n.queryFormContextTypes={CASES:"metadata",ENTITY:"entity"},n.queryFormTypes={CASES:"CASES",ENTITY:"ENTITIES"},n.params.notMigratedUrl==!0||n.params.paramsStoredQuery.notMigratedUrl==!0)return i=n.getResource("workportal-widget-admin-entities-message-migrate"),i=i.replace("{build}",bizagi.loader.productBuildToAbout),u=$.tmpl(n.getTemplate("queryform-message-error"),{messageError:i}),$(t).html(u),!1;n.params.queryFormAction=="edit"&&(n.guidEntity=n.params.paramsStoredQuery.definition.entityGuid,n.guidForm=n.params.paramsStoredQuery.guid,n.queryFormType=n.params.paramsStoredQuery.definition.type,n.idQueryForm=n.params.paramsStoredQuery.id,n.renderQueryForm(),n.showSaveResultsForm(),n.previousValues(n.params.paramsStoredQuery));n.params.queryFormAction=="renderQueryForm"&&(n.guidForm=n.params.guidForm,n.guidEntity=n.params.guidEntity,n.params.queryType==1?n.queryFormType=n.queryFormTypes.CASES:n.params.queryType==2&&(n.queryFormType=n.queryFormTypes.ENTITY),n.renderQueryForm());n.params.queryFormAction=="execute"&&(n.guidEntity=n.params.paramsStoredQuery.definition.entityGuid,n.guidForm=n.params.paramsStoredQuery.guid,n.queryFormType=n.params.paramsStoredQuery.definition.type,n.includeAllUsers=n.params.paramsStoredQuery.definition.includeAllUsers,n.idQueryForm=n.params.paramsStoredQuery.id,r={numberOfRows:10,pageNumber:1,queryFormGuid:n.params.paramsStoredQuery.guid,entityGuid:n.params.paramsStoredQuery.definition.entityGuid,type:n.params.paramsStoredQuery.definition.type,parameters:n.params.paramsStoredQuery.definition.parameters,ownerQuery:n.params.paramsStoredQuery.owner,includeAllUsers:n.params.paramsStoredQuery.definition.includeAllUsers},n.handleEvents(),n.initialSearchParams=JSON.parse(JSON.stringify(r)),n.queryFormType==n.queryFormTypes.CASES?n.contextType=n.queryFormContextTypes.CASES:n.queryFormType==n.queryFormTypes.ENTITY&&(n.contextType=n.queryFormContextTypes.ENTITY),f={h_action:"QUERYFORM",h_contexttype:n.contextType,h_idForm:n.guidForm},$("#query-form-buttons",t).hide(),n.dataService.getQueryForm(f).done(function(i){n.queryFormElements=i.form.elements;n.findResults(t,r)}),$("#copy-as-new-stored-queryform",t).hide(),$("#update-stored-queryform",t).hide(),$("#edit-stored-queryform",t).show())},renderQueryForm:function(){var n=this,t=n.getContent(),r,i;n.queryFormType==n.queryFormTypes.CASES?n.contextType=n.queryFormContextTypes.CASES:n.queryFormType==n.queryFormTypes.ENTITY&&(n.contextType=n.queryFormContextTypes.ENTITY);r={h_action:"QUERYFORM",h_contexttype:n.contextType,h_idForm:n.guidForm};n.idQueryForm&&n.idQueryForm!=""&&(r.h_idqueryform=n.idQueryForm);i=$.tmpl(n.container);n.dataService.getQueryForm(r).done(function(r){var u={canvas:i,data:r,type:"queryForm"};n.queryFormElements=r.form.elements;bizagi.loader.startAndThen("rendering").then(function(){var r=new bizagi.rendering.facade;r.execute(u).done(function(){if(n.queryForm=r.form,n.queryForm.properties&&typeof n.queryForm.properties.includeAllUsers!="undefined"&&(n.includeAllUsers=n.queryForm.properties.includeAllUsers),$("#query-form",t).html(i),n.handleEvents(),$("#query-form",t).show(),$("#query-form-result",t).hide(),$("#mainButtons",t).css("width","100%"),$("#exportExcel",t).hide(),$("#graphicalAnalysis",t).hide(),$("#back-to-queryform",t).hide(),$("#save-queryform",t).hide(),n.params.queryFormAction=="renderQueryForm")$("#query-form-admin-result",t).hide(),$("#copy-as-new-stored-queryform",t).hide(),$("#update-stored-queryform",t).hide(),$("#edit-stored-queryform",t).hide();else if(n.params.queryFormAction=="edit"){var u=n.params.paramsStoredQuery.definition.parentQueryForm||n.params.paramsStoredQuery.definition.name;$("#queryFormFieldsContainerName span",t).html(u);$("#queryFormFieldsContainer",t).html(i);$("#submit-for-search",t).hide();$("#clear-queryform",t).hide();$("#copy-as-new-stored-queryform",t).show();$("#update-stored-queryform",t).show();$("#edit-stored-queryform",t).hide()}})})})},handleEvents:function(){var n=this,t=n.getContent(),i={};i.I_PROCESSSTATE="ALL";i.h_idEnt=10001;i.h_idQueryForm=n.idQueryForm;$("#query-form-buttons",t).html($.tmpl(n.buttons,i));$("#back-to-queryform",t).click(function(){var i,r,u,f;n.params.queryFormAction=="execute"?n.renderQueryForm():($("#iframeGraphicalAnalysis",t).hide(),$("#query-form-admin-result",t).hide(),n.params.queryFormAction=="saveQueryForm"?(n.params.queryFormAction="renderQueryForm",$("#query-form-result",t).show(),$("#back-to-queryform",t).show(),$("#save-queryform",t).show(),$("#exportExcel",t).show(),$("#graphicalAnalysis",t).show()):($("#query-form-result",t).hide(),$("#query-form",t).show(),$("#submit-for-search",t).attr("disabled",!1).removeClass("ui-button-disabled"),i=$(this).closest(".ui-dialog"),r=i.length?i.find(".ui-dialog-content"):[],i.height()===r.height()&&r.height(440),n.originalHeight&&t.parent().height(n.originalHeight),$("#back-to-queryform",t).hide(),$("#submit-for-search",t).show(),$("#clear-queryform",t).show(),$("#save-queryform",t).hide(),$("#exportExcel",t).hide(),$("#graphicalAnalysis",t).hide(),n.params.queryFormAction=="graphicalAnalysis"&&(n.params.queryFormAction="submitQueryForm",u={queryFormGuid:n.guidForm,numberOfRows:10,pageNumber:1,entityGuid:n.guidEntity,type:n.queryFormType,includeAllUsers:n.includeAllUsers,parameters:[]},f=n.queryForm.getSearchParams(u),n.submitQueryForm(f))));n.readyToSave=!1});$("#clear-queryform",t).click(function(){n.params.queryFormAction="renderQueryForm";n.renderQueryForm()});$("#submit-for-search",t).click(function(){n.params.queryFormAction="submitQueryForm";var i={queryFormGuid:n.guidForm,numberOfRows:10,pageNumber:1,entityGuid:n.guidEntity,type:n.queryFormType,includeAllUsers:n.includeAllUsers,parameters:[]},t=n.queryForm.getSearchParams(i);t!==null&&(n.disableButton($(this)),n.submitQueryForm(t))});$(".ui-bizagi-render-control-included",t).tooltip({content:bizagi.localization.getResource("workportal-widget-query-form-included-tooltip")});$("#save-queryform",t).click(function(){n.readyToSave?n.createStoredQueryForm():n.showSaveResultsForm();n.params.queryFormAction="saveQueryForm";$("#exportExcel",t).hide();$("#graphicalAnalysis",t).hide();$("#mainButtons",t).css("width","100%")});$("#copy-as-new-stored-queryform",t).click(function(){n.saveAs=!0;$(n.dialogSaveAs).dialog({resizable:!0,modal:!0,title:n.getResource("workportal-widget-query-form-copy-as-new"),buttons:[{text:n.getResource("workportal-general-button-label-ok"),click:function(){n.createStoredQueryForm()&&($(this).dialog("destroy"),bizagi.workportal.desktop.popup.closePopupInstance())}},{text:n.getResource("workportal-widget-queries-confirm-cancel"),click:function(){n.saveAs=!1;$(this).dialog("destroy")}}]})});$("#update-stored-queryform",t).click(function(){var i=bizagi.cookie("JSESSIONID"),t;i!=null?n.updateStoredQueryForm():(t={resizable:!0,modal:!0,title:n.getResource("workportal-widget-query-form-update"),buttons:[]},t.buttons=[{text:n.getResource("confirmation-box-ok"),click:function(){n.updateStoredQueryForm();$(this).dialog("close");bizagi.workportal.desktop.popup.closePopupInstance()}},{text:n.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}],$("<div><span class='ui-icon ui-icon-alert'><\/span><span>"+n.getResource("workportal-widget-query-form-container-alert")+"<\/span><\/div>").dialog(t))});$("#edit-stored-queryform",t).click(function(){n.publish("closeCurrentDialog");n.params.editQueryForm({response:n.params.paramsStoredQuery.id,fromExec:!0})});$(".biz-wp-form-queryForm-graphicalAnalysisLink",t).click(function(){function s(){var t=$("#iframeGraphicalAnalysis"),n=$(this),i=n.length?n.height():0;i>550?t.height(i-100):(t.height(400),n.find(".ui-dialog-content").height("auto"))}var u,f,e;n.params.queryFormAction="graphicalAnalysis";u=n.params.paramsStoredQuery.definition?JSON.stringify(n.params.paramsStoredQuery.definition):JSON.stringify({name:"name",description:"desc",parameters:n.searchParams.parameters,type:n.queryFormType,entityGuid:n.guidEntity,includeAllUsers:n.includeAllUsers,parentQueryForm:n.queryForm.properties.displayName});f=n.params.paramsStoredQuery.id?n.params.paramsStoredQuery.guid:n.params.guidForm;e=$.tmpl(n.graphicalAnalysisContainer,{h_guidQueryForm:f,h_idStoredQuery:n.params.paramsStoredQuery.id,h_definition:u});$("#query-form-result",t).html(e);$("#exportExcel",t).hide();$("#graphicalAnalysis",t).hide();$("#mainButtons",t).show();$("#mainButtons",t).css("width","99%");$("#save-queryform",t).hide();n.originalHeight=t.parent().height();t.parent().height("auto");$("#formGraphicalAnalysis").delay(800).submit();var r=$("#iframeGraphicalAnalysis"),i=r.length?r.closest(".ui-dialog"):[],o=i.length?i.height():0;o>550&&r.height(o-100);i.on("dialogmaximize",s);i.on("dialogunmaximize",s)});$(".biz-wp-form-queryForm-exportExcelLink",t).click(function(){var r={entityGuid:n.guidEntity,type:n.queryFormType,includeAllUsers:n.includeAllUsers,parameters:[]},t,i;r.parameters=JSON.parse(JSON.stringify(n.initialSearchParams.parameters));t=n.refactorParameters(r);i=bizagi.cookie("JSESSIONID");i!=null&&(t.p_sessionId=i);n.dataService.getQueryFormExportExcel(t).done(function(){})})},disableButton:function(n){var t=this,i=t.getContent(),r=$(".ui-bizagi-render-control-included:checked",i).size(),u=r>0;(t.queryFormType==t.queryFormTypes.ENTITY&&t.atLeastOneChecked||t.queryFormType==t.queryFormTypes.CASES)&&n.attr("disabled",!0).addClass("ui-button-disabled")},enableButton:function(n){n.removeAttr("disabled").removeClass("ui-button-disabled")},submitQueryForm:function(n){var t=this,i=t.getContent(),r=$(".ui-bizagi-render-control-included:checked",i).size();t.atLeastOneChecked=r>0;n!==null&&(t.queryFormType==t.queryFormTypes.ENTITY&&t.atLeastOneChecked||t.queryFormType==t.queryFormTypes.CASES?(t.initialSearchParams=JSON.parse(JSON.stringify(n)),t.findResults(i,n)):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-query-form-at-least-one-checked"),"Bizagi","warning"))},findResults:function(n,t,i){var r=this;r.searchParams=JSON.parse(JSON.stringify(t));t=r.refactorParameters(t);t.pageNumber=i?i:1;bizagiConfig.groupByCaseNumber&&(t.group="T_RADNUMBER");r.dataService.getQueryFormResponse(t).done(function(i){r.validateSecurityGraphicQuery(i);$(".biz-wp-table").remove();$("#biz-wp-table-summary-wrapper").remove();r.totalRecords=i.records;r.totalPages=i.total;i.rows.length>0?(r.showSearchResultFrame(n,i,t),$("#query-form-buttons",n).show()):(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-query-form-no-records-found"),"Bizagi","warning"),r.enableButton($("#submit-for-search",r.getContent())),r.params.queryFormAction==="execute"&&(r.params.queryFormAction="edit",r.modifiedPostRender()))}).fail(function(n){bizagi.log(n)})},validateSecurityGraphicQuery:function(n){!bizagi.menuSecurity.GraphicQuery&&n.header&&n.header.length&&n.header[n.header.length-1].dataType===0&&(n.header.splice(-1,1),n.rows.forEach(function(n){n.splice(-1,1)}))},checkDisplayedNames:function(n){var t=this;return $.each(n.header,function(n,i){var r,n;if(i.xpath&&(r=t.getRenderElementDisplayByXpath(i.xpath,t.queryFormElements),r)){if(t.initialSearchParams&&t.initialSearchParams.parameters)for(n=0;n<t.initialSearchParams.parameters.length;n++){var u=t.initialSearchParams.parameters[n],e=t.searchParams.parameters[n],o=u.xpath+"."+u.displayXpath,f={};if(t.params.paramsStoredQuery.definition&&(f=t.params.paramsStoredQuery.definition.parameters[n]),u.xpath===i.xpath||o===i.xpath){e.displayHeader=r;u.displayHeader=r;f.displayHeader=r;break}}i.displayName=r}}),n},getRenderElementDisplayByXpath:function(n,t){var e=this,r,f,i,u;if(t&&t.length>0)for(r=0,f=t.length;r<f;r++)if(i=t[r],typeof i.render!="undefined"){var o=typeof i.render.properties.included=="undefined"||i.render.properties.included,s=i.render.properties.xpath,h=i.render.properties.xpath+"."+i.render.properties.displayXpath;if(o&&(s===n||h===n))return i.render.properties.displayName}else if(typeof i.container!="undefined"&&(u=e.getRenderElementDisplayByXpath(n,i.container.elements),u!=undefined))return u},refactorParameters:function(n){var t=[];return typeof n.parameters=="string"&&(n.parameters=JSON.parse(n.parameters)),$.each(n.parameters,function(n,i){i.value!=null&&typeof i.value=="object"&&typeof i.value[0].id!="undefined"&&(i.value=i.value[0].id);t.push(i)}),n.parameters=JSON.stringify(t),n},showSearchResultFrame:function(n,t,i){var r=this,f;t=r.checkDisplayedNames(t);var e=$.tmpl(r.searchResult,{headers:t.header,rows:t.rows,sortedField:r.sortedField.xpath?r.sortedField:null,records:t.records,groupByCaseNumber:bizagiConfig.groupByCaseNumber,securityGraphicQuery:bizagi.menuSecurity.GraphicQuery,resultList:t},{getRadNumberColumnIndex:function(){for(var t=this.data,i=-1,n=0,r=t.headers.length;n<r;n++)t.headers[n].fieldName=="radnumber"&&(i=n);return i},showColumn:function(n){var t=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&t==n?" hidden ":""},createGroupedHeader:function(n){var r=this.data.resultList,t=!1,i=this.getRadNumber(r.rows[n]),u;return this.data.groupByCaseNumber&&(n==0&&i!=""?t=!0:(u=this.getRadNumber(r.rows[n-1]),i!=u&&i!=""&&(t=!0))),t},getRadNumber:function(n){var t=this.getRadNumberColumnIndex();return t>=0?n[t].radNumber:""},formatValue:function(n,t){return bizagi.util.formatValueByDataType(n,t)}}),s=r.maxPageToShow>r.totalPages?r.totalPages:r.maxPageToShow,h=$("#biz-wp-table-pager-wrapper",e),u={},o;for(u.pagination=r.totalPages>1?!0:!1,u.page=t.page,u.pages={},f=1;f<=s;f++)u.pages[f]={pageNumber:f};o=$.tmpl(r.paginationTmpl,u).html();h.append(o);$("#submit-for-search",n).hide();$("#clear-queryform",n).hide();$("#save-queryform",n).show();t.permissions&&t.permissions.canExportData&&$("#exportExcel",n).show();$("#mainButtons",n).css("width","100%");$("#query-form",n).hide();$("#query-form-result",n).show();$("#query-form-result",n).html(e);$("#back-to-queryform",n).show();t.permissions&&t.permissions.canAnalizeData?$("#graphicalAnalysis",n).show():$("#graphicalAnalysis",n).hide();r.params.queryFormAction=="execute"&&($("#back-to-queryform",n).hide(),$("#save-queryform",n).hide());i.ownerQuery==!1&&$("#edit-stored-queryform",n).hide();$("ul").bizagiPagination({maxElemShow:r.maxElemShow,totalPages:r.totalPages,actualPage:t.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(t){var f=$(".sortColumnsDataUpIcon, .sortColumnsDataDownIcon").parent().parent().last(),i,u;f.length==0?r.findResults(n,r.initialSearchParams,t.page):(i=f.data("xpath"),u=null,typeof r.sortedField.xpath!=undefined&&r.sortedField.xpath==i&&(u=r.sortedField.orderType),u==null||u==r.orderType.DESC?r.findSortedResults(n,i,r.orderType.DESC,t.page):r.findSortedResults(n,i,r.orderType.ASC,t.page))}});$(".cases-column-header",n).click(function(t){var e=$(t.currentTarget),u=e.data("xpath"),f=null;typeof r.sortedField.xpath!=undefined&&r.sortedField.xpath==u&&(f=r.sortedField.orderType);f==null||f==r.orderType.DESC?r.findSortedResults(n,u,r.orderType.ASC,i.pageNumber):r.findSortedResults(n,u,r.orderType.DESC,i.pageNumber)});$(".caseClicked",n).click(function(){r.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idcase"),idWorkItem:$(this)[0].getAttribute("data-idworkitem"),idTask:$(this)[0].getAttribute("data-idtask"),idWorkflow:$(this)[0].getAttribute("data-idworkflow")});r.publish("closeCurrentDialog")});$(".ui-bizagi-wp-app-inbox-grouped",n).bind("click",function(){var n=$(this).find("#idCase").val();r.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:n});r.publish("closeCurrentDialog")});$(".biz-wp-diagram-view-icon",n).click(function(){var n=$(this).data("idcase"),t=$(this).data("idworkflow");r.showGraphicQuery({idCase:n,idWorkflow:t})})},applyFomatNumbers:function(n,t,i){var u=this,r=$("th[data-type='"+n+"']",t);$.each(r,function(n,i){var r=i.getAttribute("data-index");$(".biz-wp-table tr",t).find("td:eq("+r+")").find("span").addClass("formatMoney")});bizagi.util.formatInvariantNumber(t,i)},findSortedResults:function(n,t,i,r){var e=this,o=!1,f=JSON.parse(JSON.stringify(e.initialSearchParams)),u;f&&(u=f.parameters,u=$.type(u)==="array"?u:JSON.parse(u),u.length>0&&$.each(u,function(n,r){var u=r.xpath;u==t&&(r.orderType=i,o=!0)}),o||t==""||u.push({value:null,included:!0,xpath:t,searchType:"NONE",orderType:i}),e.sortedField={xpath:t,orderType:i},f.parameters=u,e.findResults(n,f,r))},previousValues:function(n){var t=this,i=t.getContent();$("#queryFormName",i).val(n.definition.name);$("#queryFormDescription",i).val(n.definition.description);t.selectedItemsToShare.users=n&&n.users?n.users:[];t.selectedItemsToShare.groups=n&&n.groups?n.groups:[]},createStoredQueryForm:function(){var n=this,i=n.getContent(),t=n.buildStoredQueryFormParams();return t!=null?($.when(n.dataService.saveStoredQueryForm(t)).done(function(t){n.publish("closeCurrentDialog");n.readyToSave=!1;n.params.queryFormAction="renderQueryForm";$("#queryFormShortcut").has("#modalMenuBtList").length==0?$.when(n.workportalFacade.getWidget("queriesShortcut",{})).pipe(function(n){return widget=n,widget.render()}).done(function(){var i=widget.getContent();$("#queryFormShortcut").html(i);n.params.executeQueryForm(t)}):n.params.executeQueryForm(t)}).fail(function(n){bizagi.log(n)}),!0):!1},closeQueryForm:function(){},updateStoredQueryForm:function(){var n=this,i=n.getContent(),t=n.buildStoredQueryFormParams();return t!=null?(t.id=n.idQueryForm,$.when(n.dataService.updateStoredQueryForm(t)).done(function(){n.readyToSave=!1;n.params.queryFormAction="renderQueryForm";n.renderQueryForm();n.publish("refreshQueryFormShortCut")}).fail(function(n){bizagi.log(n)}),!0):!1},buildStoredQueryFormParams:function(){var n=this,f=n.getContent(),i={},e,r,u,t;return(i.users=JSON.stringify($.unique(n.selectedItemsToShare.users)),i.groups=JSON.stringify($.unique(n.selectedItemsToShare.groups)),n.params.queryFormAction=="edit"&&(e={parameters:[]},n.searchParams=n.queryForm.getSearchParams(e)),i.guid=n.guidForm,r=$("#queryFormNameSaveAs",n.dialogSaveAs).val(),u=$("#queryFormName",f).val(),n.saveAs&&(r==null||r==""))?(t=$("#queryFormNameSaveAs").next(".ui-bizagi-input-icon-error"),t.show(),t.tooltip({content:bizagi.localization.getResource("workportal-general-error-required")}),null):!n.saveAs&&(u==null||u=="")?(t=$("#queryFormName",f).next(".ui-bizagi-input-icon-error"),t.show(),t.tooltip({content:bizagi.localization.getResource("workportal-general-error-required")}),null):n.queryForm.validateForm()?(i.definition=JSON.stringify({name:r?r:u,description:$("#queryFormDescriptionSaveAs",n.dialogSaveAs).val()?$("#queryFormDescriptionSaveAs",n.dialogSaveAs).val():$("#queryFormDescription",f).val(),parameters:n.searchParams.parameters,type:n.queryFormType,entityGuid:n.guidEntity,includeAllUsers:n.includeAllUsers,parentQueryForm:n.queryForm.properties.displayName}),i):void 0},showSaveResultsForm:function(){var n=this,t=n.getContent(),i;n.readyToSave=!0;i=$.tmpl(n.adminResult,{});$("#tab_share",i).click(function(){n.initShareSelection();$("#query-form").hide()});$("#tab_definition",i).click(function(){n.params.queryFormAction==="edit"&&$("#query-form").show()});$("input[type=radio][name=shareType]",i).change(function(){this.value=="users"?n.initShareSelection():this.value=="groups"&&$.when(n.searchGroupToShare()).done(function(){$("#userShare",n.shareSlection).hide()})});$("#query-form",t).hide();$("#query-form-result",t).hide();$("#query-form-admin-result",t).show();$("#query-form-admin-result",t).html(i);$("#admin-stored-query-form-wrapper",t).tabs()},initShareSelection:function(){var n=this,t=n.getContent(),i=$.tmpl(n.shareSelection,{}),r=n.selectedItemsToShare.users;$("#shareUsers",t).prop("checked",!0);$("#search_user",i).click(function(){n.searchUserToShare()});$("#shareSelectionPanel",t).html(i);$("#move_left",t).click(function(){n.removeItem()});$("#move_right",t).click(function(){n.addItem()});r.length>0&&n.searchSavedUser()},searchUserToShare:function(){var n=this,t=n.getContent(),i={userName:$("#userName",t).val(),domain:$("#domain",t).val(),fullName:$("#fullName",t).val()};$.when(n.dataService.searchUsers(i)).done(function(t){var i=[];$.each(t.users,function(t,r){var u;r&&(u=$.inArray(r.idUser,n.selectedItemsToShare.users),u<0&&i.push(r))});n.showDataToShare(i,[])}).fail(function(n){bizagi.log(n)})},searchSavedUser:function(){var n=this,t=n.getContent(),i=$("input[type=radio][name=shareType]:checked",t).val();$.when(n.dataService.searchUsersByID(n.selectedItemsToShare.users)).done(function(r){$("#ListBoxResult",t).empty();n.addPrevious(r,i)}).fail(function(n){bizagi.log(n)})},searchGroupToShare:function(){var n=this,t=n.getContent();return n.dataService.searchProfiles({profileType:11}).pipe(function(t){var i=[],r=[];$.each(t.response,function(t,u){var f;u&&(f=$.inArray(u.id,n.selectedItemsToShare.groups),f<0?i.push(u):r.push(u))});n.showDataToShare(i,r)})},showDataToShare:function(n,t){var i=this,r=i.getContent(),f=$("input[type=radio][name=shareType]:checked",r).val(),u;f=="users"?u=$.tmpl(i.selectUser,{elementList:n}):(u=$.tmpl(i.selectGroup,{elementList:n}),$("#ListBoxResult",r).empty(),t.length>0&&i.addPrevious(t,f));$("#ListBoxSource",r).replaceWith(u)},addPrevious:function(n,t){var r=this,i=r.getContent();t=="users"?$.each(n.users,function(n,t){$("#ListBoxResult",i).append(new Option(t.userName,t.idUser))}):$.each(n,function(n,t){$("#ListBoxResult",i).append(new Option(t.displayName,t.id))})},addItem:function(){var t=this,n=t.getContent(),i=$("input[type=radio][name=shareType]:checked",n).val(),r=$("#ListBoxSource option:selected",n);$.each(r,function(r,u){$.inArray(u.value,t.selectedItemsToShare)==-1?(t.selectedItemsToShare[i].push(u.value),$("#ListBoxSource option[value='"+u.value+"']",n).appendTo("#ListBoxResult")):$("#ListBoxSource option[value='"+u.value+"']",n).remove()});$("#ListBoxResult option:selected").prop("selected",!1)},removeItem:function(){var t=this,n=t.getContent(),i=$("input[type=radio][name=shareType]:checked",n).val(),u=$("#ListBoxResult option:selected",n),f=$("#ListBoxSource option").toArray(),r=[];$.each(f,function(n,t){r.push(t.value)});$.each(u,function(u,f){var e=f.value;$.inArray(e,r)==-1?$("#ListBoxResult option[value='"+e+"']",n).appendTo("#ListBoxSource"):$("#ListBoxResult option[value='"+e+"']",n).remove();t.selectedItemsToShare[i].splice($.inArray(e,t.selectedItemsToShare[i]),1)});$("#ListBoxSource option:selected").prop("selected",!1)},HTMLEncodeText:function(n){return strNew=n,strNew=strNew.replace("á","&aacute;"),strNew=strNew.replace("é","&eacute;"),strNew=strNew.replace("í","&iacute;"),strNew=strNew.replace("ó","&oacute;"),strNew=strNew.replace("ú","&uacute;"),strNew=strNew.replace("ñ","&ntilde;"),strNew=strNew.replace("Á","&Aacute;"),strNew=strNew.replace("É","&Eacute;"),strNew=strNew.replace("Í","&Iacute;"),strNew=strNew.replace("Ó","&Oacute;"),strNew=strNew.replace("Ú","&Uacute;"),strNew=strNew.replace("Ñ","&Ntilde;")},frankensteinPostRender:function(){var u=this,f=u.getContent(),t=$("#queryFormIFrame",f),i="",r="",n=[".ui-bizagi-old-render*","@font-face"];t.attr("frameborder",0);typeof n=="object"?$.each(n,function(n,t){i+=bizagi.getStyle(t);r+=t.replace(".","")+" "}):(i+=bizagi.getStyle(n),r+=n.replace(".",""));t.load(function(){var n=$(this).contents(),f;n.find('input[name="btnReturn"]').css("display","none");$("head",n).append("<style type='text/css'>"+i+"body, .ui-bizagi-old-render { overflow-y: visible;};<\/style>");$("body",n).addClass(r.replace("*",""));$("body a.WPButton",n).parent().siblings().remove();f=function(n){this.openBACase=function(t,i){var r=null,f=null,e,o,u;i.indexOf("idWorkitem=")>-1&&(r=i.substring(i.indexOf("idWorkitem=")+11),r=r.substring(0,r.indexOf("&")));i.indexOf("idWorkflow=")>-1&&(f=i.substring(i.indexOf("idWorkflow=")+11));n.controller.publish("executeAction",{action:n.routingAction,idCase:t,idWorkItem:r,idWorkflow:f,referrer:"queryform"});e=document.getElementById("h_lastFullKey");o=document.getElementById("h_lstCases");try{n.controller.dataService.lastQueryFullKey=e.value;n.bizagireference.referrerParams.referrer="queryform";n.bizagireference.lstIdCases=o.value.split(",")}catch(s){}for(u=0;u<n.bizagireference.workportal.desktop.dialogStack.length;u++)n.controller.publish("closeCurrentDialog")};this.ShowCaseSumary=function(t){var i=n.$;i.when(n.controller.dataService.getCaseFormsRenderVersion({idCase:t})).done(function(i){i.formsRenderVersion==1&&n.controller.publish("showDialogWidget",{widgetName:n.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:n.controller.dataService.serviceLocator.getUrl("old-render")+"?idCase="+t+"&isSummary=1",modalParameters:{title:n.controller.resources.getResource("workportal-widget-navigation-summary-case")},afterLoad:n.callBack,afterLoadParams:{routingAction:n.bizagireference.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,genericIframe:n.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,bizagi:n.bizagireference}})})}};t.callInside(f,{controller:u,routingAction:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,bizagireference:bizagi,callBack:f,$:jQuery})})}});
