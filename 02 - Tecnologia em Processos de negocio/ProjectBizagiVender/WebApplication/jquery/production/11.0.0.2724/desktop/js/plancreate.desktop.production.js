bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(n,t,i){var r=this;r.params=i||{};r._super(n,t,i);r.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.params.contextsLeftSidebarCaseDashboard.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,r,u,f;i.params=$.extend(i.params,t.args);i.params.plan.idActivitySelected=undefined;i.clean();r=i.getContent().empty();typeof n.type!="undefined"&&(i.params.showContextByMenuDashboard=n.type);u={showFormOverview:i.params.menuDashboard.showFormOverview,showFormActivity:i.params.menuDashboard.showFormActivity,showCommentsOptionMenu:i.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:i.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:i.params.menuDashboard.showTimeLineOptionMenu,showPlanOptionMenu:i.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:i.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:i.params.menuDashboard.contextFormActivityOptionMenu};f=i.getTemplate("project-dashboard-menu");f.render(u).appendTo(r);i.params.showContextByMenuDashboard&&$("li[data-context='"+i.params.showContextByMenuDashboard.toUpperCase()+"']",i.content).addClass("active").siblings().removeClass("active");i.handlerEvents()},loadContentById:function(n){var t=this,r,i;n.preventDefault();r=$(n.target).closest("li");r.hasClass("active")||(i=r.data("context"),i&&$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var f=t.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),n=parseInt(f[0]),r="",u=n;i=="PLANACTIVITIES"&&(u=n+1,r=bizagi.localization.getResource("workportal-project-casedashboard-plan"));t.params.refreshLastItemBreadcrumb=!1;t.pub("notify",{type:i.toUpperCase(),args:$.extend(t.params,{showContextByMenuDashboard:i,histName:r,level:u})});$("li[data-context='"+t.params.showContextByMenuDashboard.toUpperCase()+"']",t.content).addClass("active").siblings().removeClass("active")}))},subMenuHandler:function(){var t=this,n=t.getContent(),i=$("[data-context='COMMENTS']",n),r=$("[data-context='FILES']",n),u=$("[data-context='TIMELINE']",n);$(".ui-bizagi-wp-project-tab-submenu a",n).on("click",function(){i.toggle();r.toggle();u.toggle()})},handlerEvents:function(){var n=this,t=n.getContent();n.subMenuHandler();$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(n.loadContentById,n));$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:n.params.idCase,idTask:n.params.idTask,idWorkflow:n.params.idWorkflow,idWorkItem:n.params.idWorkitem,referrer:n.params.referrer||"inboxGrid"};n.publish("executeAction",t)})},clean:function(){var n=this,t=n.getContent();n.params&&n.params.contextsLeftSidebarCaseDashboard&&n.params.contextsLeftSidebarCaseDashboard.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))});$(".ui-bizagi-wp-project-tab-links a",t).off();$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}});bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var n=this,t=n.getTemplate("project-content-dashboard");return n.content=t.render({}),n.content},postRender:function(){var n=this;setTimeout(function(){$(window).trigger("resize")},1e3)}});bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0);
bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.plan",{},{init:function(n,t,i,r){var u=this;u._super(n,t,r);u.params=$.extend(u.params,r);u.planCreate=i;u.loadTemplates({"project-plan":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.plan").concat("#project-plan-wrapper"),"project-plan-popup":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.plan").concat("#project-plan-popup-template")})},renderContent:function(){var n=this,t=n.getTemplate("project-plan");return n.content=t.render({}),n.content},postRender:function(){var n=this,t=n.getContent();n.form={buttonShowPopupPlanToAdd:$("#buttonShowPopupCreatePlan",t)};n.form.buttonShowPopupPlanToAdd.on("click",$.proxy(n.onShowPopupPlan,n))},onShowPopupPlan:function(){var n=this,t=typeof n.params.plan.contextualized=="undefined"?!0:n.params.plan.contextualized;n.planCreate.showPopupAddPlan(n.params,n.dataService,t);n.planCreate.unsub("planCreated");n.planCreate.sub("planCreated",function(t,i){var r=i.paramsNewPlan;n.params.planChild={};n.params.showContextByMenuDashboard.indexOf("ACTIVITYPLAN")!=-1&&(n.params.planParent={},n.params.planParent.id=bizagi.clone(n.params.plan.id),n.params.planParent.idActivitySelected=n.params.plan.idActivitySelected);n.params.planChild=bizagi.clone(r);n.pub("notify",{type:"UPDATE_LASTCRUMBPARAMS_INFO",args:{planChild:n.params.planChild}});n.params.menuDashboard.contextPlanOptionMenu="PLANACTIVITIES";var u=n.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),f=parseInt(u[0],10),e=f+1,o=bizagi.localization.getResource("workportal-project-casedashboard-plan");n.pub("notify",{type:"PLANACTIVITIES",args:$.extend(n.params,{showContextByMenuDashboard:"PLANACTIVITIES",histName:o,level:e})})})}});bizagi.injector.register("bizagi.workportal.widgets.project.plan",["workportalFacade","dataService","bizagi.workportal.widgets.project.plan.create",bizagi.workportal.widgets.project.plan],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.overview",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"project-overview":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview"),"project-overview-no-summary-form-found":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview-no-summary-form-found")})},renderContent:function(){var n=this,t=n.getTemplate("project-overview");return n.content=t.render({}),n.content},postRender:function(){var n=this,i=n.getContent(),t=$("#ui-bizagi-wp-project-overview-wrapper",i),r;t.bind("oldrenderintegration",function(i){var u,r;if(!i.isPropagationStopped()){i.stopPropagation();u=n.workportalFacade.getTemplate("inbox-common-case-summary-oldrender");r={};bizagi.oldrenderevent=!0;var f=window.addEventListener?"addEventListener":"attachEvent",e=window[f],o=f=="attachEvent"?"onmessage":"message";e(o,function(t){t.stopPropagation();n.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.data})},!1);$.when(n.dataService.getWorkitems({idCase:n.params.idCase,onlyUserWorkItems:!0})).done(function(i){if(typeof i.workItems=="object"&&i.workItems.length>=1){var f=i.workItems[0].idWorkItem,e=i.workItems[0].idTask;r.url=n.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+n.idCase+"&idWorkitem="+f+"&idTask="+e+"&isSummary=1"}else r.url=n.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+n.idCase+"&isSummary=1";t.empty();$.tmpl(u,r).appendTo(t);n.iframeOldRender($("iframe",t))})}});r={idCase:n.params.idCase};$.when(n.dataService.getCaseFormsRenderVersion(r)).done(function(r){r.formsRenderVersion==1?t.trigger("oldrenderintegration"):n.renderSummaryForm(n.params.idCase,$("#ui-bizagi-wp-project-overview-wrapper",i))})},renderSummaryForm:function(n,t){var i=this,u=typeof i.dataService.serviceLocator.proxyPrefix!=undefined?i.dataService.serviceLocator.proxyPrefix:"",r=new bizagi.rendering.facade({proxyPrefix:u});r.execute({canvas:t,summaryForm:!0,idCase:n});r.subscribe("no-data-found",function(){var n=i.getTemplate("project-overview-no-summary-form-found");t.append(n.render())});i.renderingFacade=r;setTimeout(function(){i.resizeLayout()},1e3)},iframeOldRender:function(n){var i=this,t,f=i.getContent(),r="bizagiDefault",u=bizagi.readQueryString();$.each(n,function(){$(this).is("iframe")&&(t=$(this))});t.load(function(){var t=$(this).contents(),n=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";n=n.replace("%theme%",u.theme||r);$("body",t).append("<link type='text/css' rel='stylesheet' href='"+n+"'>")})}});bizagi.injector.register("bizagi.workportal.widgets.project.overview",["workportalFacade","dataService",bizagi.workportal.widgets.project.overview],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.datePickerRegional=bizagi.localization.getResource("datePickerRegional");r.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-popup-release":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-popup-release"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")});r.releaseDialogBox={}},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.releaseDialogBox.formContent=n.getTemplate("project-caseState-popup-release").render({}),n.content},postRender:function(){var n=this,t=n.contextsSidebarActivity||[];t.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))});n.plugins={};n.plugins.popupRelease={form:{buttonAccept:$("#button-accept-release",n.releaseDialogBox.formContent),buttonCancel:$("#button-cancel-release",n.releaseDialogBox.formContent)}};n.plugins.popupRelease.form.buttonAccept.on("click",$.proxy(n.onClickAcceptRelease,n));n.plugins.popupRelease.form.buttonCancel.on("click",$.proxy(n.onClickCancelRelease,n))},updateView:function(n,t){var i=this,r,u,f,s;if($.extend(i.params,t.args),r=t.args,i.getContent().empty(),u={},u.isFavoriteCase="off",u.isFavoriteCase=r.isFavorite&&JSON.parse(r.isFavorite)?"bz-icon-star":"bz-icon-star-outline",i.showCaseNumber(r,u),r.creationDate){var e="MM/dd/yyyy H:mm",h=r.creationDate,o=bizagi.util.dateFormatter.getDateFromFormat(h,e);u.creationDateFormat=i.getFormattedDate(o);f=bizagi.util.dateFormatter.getDateFromFormat(r.solutionDate,e);u.solutionDateFormat=i.getFormattedDate(f);s=new Date;i.calculateDataForTemplate(u,o,s,f,r)}$(i.getContent()).on("click",".show-diagram-case",function(){i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkflow})})},calculateDataForTemplate:function(n,t,i,r,u){var e=this,o=e.getContent(),f={};f.idUser=bizagi.currentUser.idUser;bizagi.util.parseBoolean(u.isOpen)?(f.fromDate=t.getTime(),f.toDate=i.getTime()):(f.fromDate=r.getTime(),f.toDate=i.getTime());$.when(e.callGetEffectiveDuration(f)).done(function(t){var i=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-t.minutes*6e4),null,!1),r;bizagi.util.parseBoolean(u.isOpen)?(n.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",i),n.colorStateCase="Opened"):(n.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",i),n.colorStateCase="Closed");n.percentCompleteBar=100;n.isOpen=bizagi.util.parseBoolean(u.isOpen);r=e.getTemplate("project-caseState-remaining");r.render($.extend(u,n)).appendTo($("#ui-bizagi-remaining",o));u.currentState.length>0&&e.initilizeActionMenu(u.currentState)})},showCaseNumber:function(n,t){var i=this,r=i.getContent(),u=i.getTemplate("project-caseState");u.render($.extend(n,t,{security:bizagi.menuSecurity})).appendTo(r);$(".case-summary-favorite",r).on("click",$.proxy(i.onClickFavorite,i));$(".case-summary-back",i.content).on("click",$.proxy(i.goToCase,i,"back"));$(".case-summary-next",i.content).on("click",$.proxy(i.goToCase,i,"next"));i.showBackNextNavigation()},getFormattedDate:function(n){var t=this,i=t.datePickerRegional.monthNames,r=n.getMonth();return i[r]+" "+$.datepicker.formatDate("dd",n)},onClickFavorite:function(n){n.preventDefault();var t=this,i={};$(n.target).hasClass("bz-icon-star-outline")?(i={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(i)).done(function(i){t.params.guidFavorite=i.idFavorites;$(n.target).removeClass("bz-icon-star-outline");$(n.target).addClass("bz-icon-star")})):(i={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(i)).done(function(){$(n.target).addClass("bz-icon-star-outline");$(n.target).removeClass("bz-icon-star")}))},initilizeActionMenu:function(n){var t=this,i=bizagi.util.parseBoolean(n[0].allowsReassign)||!1,r=bizagi.util.parseBoolean(n[0].allowReleaseActivity)||!1,u=$("#bt-case-action-reassing",t.content),f=$("#bt-case-action-release",t.content);i&&u.show();r&&f.show();(i||r)&&($(".ui-bizagi-wp-project-plan-action-menu",t.content).show(),$(".ui-bizagi-wp-project-plan-action-menu",t.content).menu({select:$.proxy(t.onSelectMenu,t)}).removeClass("ui-widget-content"))},onSelectMenu:function(n,t){var i=this,r;if($(n.currentTarget).find("i").length===0){r=$(t.item).data("item");switch(r){case"reassing":i.onClickMenuReasign();break;case"release":i.onClickMenuRelease()}}},onClickMenuReasign:function(){var n=this,t=n.params.idCase,i=n.params.idWorkitem;$.when(n.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:t,idWorkItem:i},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))},onClickMenuRelease:function(){var n=this;n.releaseDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"660px",modal:!0,title:bizagi.localization.getResource("workportal-widget-dialog-box-release-ok"),maximize:!0,close:function(){n.releaseDialogBox.formContent.dialog("destroy");n.releaseDialogBox.formContent.detach()}})},onClickAcceptRelease:function(){var n=this,t={idCase:n.params.idCase,idWorkItem:n.params.idWorkitem};$.when(n.dataService.releaseActivity(t)).done(function(i){var u=i.status?i.status:"",r;switch(u){case"Success":n.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView});break;case"ConfigurationError":r=n.getResource("workportal-widget-dialog-box-release-configuration-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(r,n.getResource("workportal-widget-dialog-box-release-error"),"error",!1);break;default:r=n.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(r,n.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}}).fail(function(){var i=n.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(i,n.getResource("workportal-widget-dialog-box-release-error"),"error",!1)});n.releaseDialogBox.formContent.dialog("destroy");n.releaseDialogBox.formContent.detach()},onClickCancelRelease:function(){var n=this;n.releaseDialogBox.formContent.dialog("destroy");n.releaseDialogBox.formContent.detach()},callGetEffectiveDuration:function(n){var i=this,t=$.Deferred();return n.fromDate?$.when(i.dataService.getEffectiveDuration(n)).done(function(n){t.resolve(n)}):t.resolve(null),t.promise()},clean:function(){var n=this,t;$(".show-diagram-case",n.getContent()).off();t=n.contextsSidebarActivity||[];this.params={};t.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})},goToCase:function(n){var t=this,i=n=="back"?t.getBackCase():t.getNextCase();i>0&&t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i})},getListKey:function(){var t=this,n;if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(n=0;n<bizagi.lstIdCases.length;n++)if(t.params.idCase==bizagi.lstIdCases[n])return n;return-1},getNextCase:function(){var t=this,n=t.getListKey();return bizagi.lstIdCases.length==n+1||bizagi.lstIdCases.length==1?-1:bizagi.lstIdCases[n+1]},getBackCase:function(){var t=this,n=t.getListKey();return n==0?-1:bizagi.lstIdCases[n-1]||-1},showBackNextNavigation:function(){var n=this,t=n.getNextCase(),i=n.getBackCase();t<=0?$(".case-summary-next").hide():$(".case-summary-next").show();i<=0?$(".case-summary-back").hide():$(".case-summary-back").show();t<=0&&i<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}});bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.datePickerRegional=bizagi.localization.getResource("datePickerRegional");r.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var u=this,e=t.args,o,f,h,s;u.params=e;u.getContent();var r={},c=e.currentState||[],i=c.filter(function(n){return n.idWorkItem===e.idWorkitem})[0];i&&(r.activityName=i.state,r.activityIsEvent=bizagi.util.parseBoolean(i.isEvent),o="MM/dd/yyyy H:mm",f=bizagi.util.dateFormatter.getDateFromFormat(i.entryDateWorkItem,o),f.getTime&&(r.initDateFormat=u.getFormattedDate(f)),h=new Date,s=bizagi.util.dateFormatter.getDateFromFormat(i.estimatedSolutionDate,o),r.estimatedSolutionDateFormat="",f.getTime&&s.getTime&&i?u.calculateDataForTemplate(i,r,f,h,s):u.updateTemplateWidget(r))},calculateDataForTemplate:function(n,t,i,r,u){var f=this,a=new Date(Date.now()-i.getTime()),h=r.getTime()-u.getTime(),c=i.getTime()-u.getTime(),l={idUser:bizagi.currentUser.idUser,fromDate:i.getTime(),toDate:Date.now()},s=!1,o={idUser:bizagi.currentUser.idUser,fromDate:r.getTime(),toDate:u.getTime()},e={};h>0?(o.fromDate=u.getTime(),o.toDate=r.getTime(),s=!0):(e.idUser=bizagi.currentUser.idUser,e.fromDate=i.getTime(),e.toDate=u.getTime());$.when(f.callGetEffectiveDuration(l),f.callGetEffectiveDuration(o),f.callGetEffectiveDuration(e)).done(function(i,r,e){var h=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-i.minutes*6e4),null,!1),o;t.colorState=n.colorState;t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",h);t.percentCompleteBar=100;c===0?t.showEstimatedSolutionDate=!1:(t.showEstimatedSolutionDate=!0,s===!1&&(o=f.getPercentBar(e.minutes,r.minutes),t.percentCompleteBar=o.percent));n&&(t.isEvent=bizagi.util.parseBoolean(n.isEvent));t.estimatedSolutionDateFormat=f.getFormattedDate(u);f.updateTemplateWidget(t)})},getPercentBar:function(n,t){var i={};return i.percent=Math.round((1-t/n)*100),i},updateTemplateWidget:function(n){var t=this,i=t.getContent().empty(),r=t.getTemplate("project-activityState-wrapper");r.render(n).appendTo(i)},getFormattedDate:function(n){var t=this,i=t.datePickerRegional.monthNames,r=n.getMonth();return i[r]+" "+$.datepicker.formatDate("dd",n)},clean:function(){var n=this,t=n.contextsSidebarActivity||[];this.params={};t.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})},callGetEffectiveDuration:function(n){var i=this,t=$.Deferred();return setTimeout(function(){n.fromDate?$.when(i.dataService.getEffectiveDuration(n)).done(function(n){t.resolve(n)}):t.resolve(null)},200),t.promise()}});bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var n=this,t=n.getTemplate("project-process-state");return n.content=t.render({}),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var r=this,i=t.args,f=r.getContent().empty(),u,e;r.params=i;u={};u.showParentProcess=i.idParentCase>=1?!0:!1;u.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase,idWorkItem:i.idWorkItem,idTask:i.idTask=="0"?"":i.idTask,idWorkflow:i.idWorkflowParentCase};e=r.getTemplate("project-process-state");e.render($.extend(i,u)).appendTo(f);$("#go-to-parent-case",f).on("click",$.proxy(r.onClickGoToParentCase,r))},onClickGoToParentCase:function(n){n.preventDefault();var t=this;t.routingExecute($(n.target).closest("#go-to-parent-case"))},clean:function(){var n=this;n.params={};n.contextsSidebarActivity.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})}});bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(n,t,i,r){var u=this;u.relatedusers=i;u._super(n,t,r);u.contextsSidebarActivity=r.contextsSidebarActivity;u.plugins={};u.users=[];u.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,r=t.args,f=i.getContent().empty(),e=i.getTemplate("project-users"),u;e.render().appendTo(f);u=[{id:r.createdBy.userId,typeName:"owner"}];i.relatedusers.render(i.content,".relatedusers-wrapper",r.idCase,u)},clean:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})}});bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.events",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var n=this,t=n.getTemplate("project-events");return n.content=t.render({}),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,r=t.args,u=i.getContent().empty();i.params=r;$.when(i.getArgsTemplate(r)).done(function(n){var t=i.getTemplate("project-events");t.render($.extend(r,n)).appendTo(u);$(".list-events li.event a",u).on("click",$.proxy(i.onClickGoEvent,i))})},getArgsTemplate:function(n){var r=$.Deferred(),t={},u=this,i;if(n.countEvents>=1)for(i=0;i<n.currentState.length;i++)n.currentState[i].isEvent=="true"&&n.currentState[i].idWorkItem==n.idWorkitem&&(n.countEvents=n.countEvents-1);return t.showEvents=n.countEvents>=1?!0:!1,t.showEvents?$.when(u.callSummaryCaseEvents(n.idCase)).done(function(i){n.showEvents=i.events.length>=1?!0:!1;n.showEvents&&(t.events=[],i.events.forEach(function(n){t.events.push($.extend(n[Object.keys(n)[0]],{idWorkFlow:i.idWorkFlow}))}));r.resolve(t)}):r.resolve(t),r.promise()},onClickGoEvent:function(n){n.preventDefault();var t=this;$("[data-bizagi-component='workarea']").empty();t.routingExecute($(n.target).closest("li"))},callSummaryCaseEvents:function(n){var i=this,t=$.Deferred();return $.when(i.dataService.summaryCaseEvents({idCase:n})).done(function(n){t.resolve(n)}),t.promise()},clean:function(){var n=this;this.params={};n.contextsSidebarActivity.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})}});bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper"),"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,u=t.args,r=i.getContent().empty();i.params=u;$.when(i.dataService.summarySubProcess({idCase:i.params.idCase})).done(function(n){var o,e,f,t,s,h;if(n.showSubProcess){for($.each(n.subProcesses,function(t){var i=n.subProcesses[t].custData,r;if(i&&i.length)for(r=0;r<i.length;r+=1)i[r]===null&&(i[r]="")}),o=n.subProcesses||n.subProcPersonalized,e=[],f=0;f<Object.keys(o).length;f+=1)t=o[f],e.push({isOpen:t.isOpen,radNumber:t.radNumber,displayName:t.displayName,idCase:t.idCase,indexSubprocess:f,idCustData:t.idCustData}),t.subProcesses&&Object.keys(t).forEach(function(n){e.push({isOpen:t[n].isOpen,radNumber:t[n].radNumber,displayName:t[n].displayName,idCase:t[n].idCase,indexSubprocess:f,idCustData:t[n].idCustData})});s=i.getTemplate("project-subprocesses");s.render($.extend(u,{auxArrayListSubprocesses:e})).appendTo(r);$(".list-subprocesses a",r).on("click",$.proxy(i.onClickGoSubprocess,i));h=".list-subprocesses li";$(h,r).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){return i.getContentTooltip($(this),n,i.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(n,t){if(typeof n.originalEvent=="undefined")return!1;var i=$(t.tooltip).attr("id");$("div.ui-tooltip").not("#"+i).remove()},close:function(n,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})}})},getContentTooltip:function(n,t,i){var y=this,p=$(n).closest("li").find("#indexSubprocess").val(),s=$(n).closest("li").find("#idCustData").val(),u,o,v,l;s=="-1"&&(s="0");var a=function(n,t){return{nameProperty:n,valueProperty:t}},h=[],r="",e=y.getSubprocessData(t,p,s),c=e.custData,f=e.custDataTypes,w=e.custFields,b=e.displayName;if(h.push(new a("subproceso",b)),c.length)for(u=0;u<c.length;u+=1)r=c[u],f&&(f[u]=="Money"?r=bizagi.util.formatMonetaryCell(r):f[u]=="Boolean"?r=bizagi.util.formatBoolean(r):f[u]=="Float"||f[u]=="Real"?r=bizagi.util.formatDecimalCell(r):typeof r=="function"&&(r="")),h.push(new a(w[u],r));return o={},o.arrayCustomsProperties=h,o.nameSubprocess=$(n).text(),v=i,l=$('<div class="bizagi-custom-tooltip-subprocesses"><\/div>'),v.render(o).appendTo(l),l.html()},getSubprocessData:function(n,t,i){var r={},f=n.subProcesses,u=n.subProcPersonalized,e;return f&&f.length>0?(r.custData=f[t].custData,r.custDataTypes=f[t].custDataTypes,e=n.CustFields[i],r.custFields=e[Object.keys(e)[0]],r.displayName=f[t].displayName):u&&Object.keys(u).length>0&&(r.custData=u[0].subProcesses[t].custData,r.custDataTypes=u[0].subProcesses[t].custDataTypes,r.custFields=u[0].CustFields[0],r.displayName=u[0].subProcesses[t].displayName),r},onClickGoSubprocess:function(n){n.preventDefault();var t=this;t.routingExecute($(n.target).closest("li"))},clean:function(){var n=this;n.params={};n.pluginTooltip=null;n.contextsSidebarActivity.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})}});bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]);
