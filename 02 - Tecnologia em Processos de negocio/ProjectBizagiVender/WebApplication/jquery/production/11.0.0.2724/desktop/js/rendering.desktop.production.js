bizagi.render=typeof bizagi.render!="undefined"?bizagi.render:{};bizagi.render.services=typeof bizagi.render.services!="undefined"?bizagi.render.services:{};bizagi.render.services.endPoints=[];bizagi.render.services.getEndPoints=function(n){var t="Rest/Handlers/Render",i="Rest/Handlers/Render/Upload",u="Rest/Handlers/RenderFile",r="Rest/Handlers/Letter",f="Rest/Handlers/MultiAction",e="Rest/Handlers/Metadata";return n.context=="workflow"?{"form-get-data":n.proxyPrefix+t,"form-submit-data":n.proxyPrefix+t,"form-submit-data-upload":n.proxyPrefix+i,"render-property-refresh":n.proxyPrefix+t,"render-multiaction":n.proxyPrefix+f,"render-upload-cancel-image":n.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":n.proxyPrefix+u,"render-upload-add-url":n.proxyPrefix+i,"render-upload-delete-url":n.proxyPrefix+t,"render-ecm-upload-url":n.proxyPrefix+e,"render-grid-edit-url":n.proxyPrefix+t,"render-grid-save-url":n.proxyPrefix+t,"render-grid-add-url":n.proxyPrefix+t,"render-grid-rollback-url":n.proxyPrefix+t,"render-grid-commit-url":n.proxyPrefix+t,"render-grid-checkpoint-url":n.proxyPrefix+t,"render-save-entity":n.proxyPrefix+t,"render-stakeholder-associated":n.proxyPrefix+t,"render-search-default-image":n.proxyPrefix+"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":n.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":n.proxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":n.proxyPrefix+r,"render-letter-content-url":n.proxyPrefix+r,"render-letter-save-url":n.proxyPrefix+t,"render-letter-content-icons":n.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":n.proxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":n.proxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":n.proxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":n.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":n.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":n.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":n.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&h_={hash}","render-entity-layout-upload-files":n.proxyPrefix+"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}","case-handler-getCaseSummary":n.proxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":n.proxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getCaseAssignees":n.proxyPrefix+"Rest/Cases/{idCase}/Assignees","case-handler-getWorkItems":n.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":n.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid","admin-getUsersList":n.proxyPrefix+"Rest/Users/SearchUsers","admin-getUsersForAssignation":n.proxyPrefix+"Rest/Users/UsersForAssignation","admin-users-config":n.proxyPrefix+"Api/Authentication/BizagiConfig","admin-usersform":n.proxyPrefix+"Rest/Handlers/Render","admin-GenerateDataToSendByEmail":n.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendUserEmail":n.proxyPrefix+"Rest/Users/SendUserEmail"}:n.context=="sharepoint"||n.context=="portal"?(typeof n.sharepointProxyPrefix=="undefined"&&alert("sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'"),{"form-get-data":n.sharepointProxyPrefix+t,"form-submit-data":n.sharepointProxyPrefix+t,"form-submit-data-upload":n.sharepointProxyPrefix+i,"render-property-refresh":n.sharepointProxyPrefix+t,"render-multiaction":n.sharepointProxyPrefix+f,"render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":n.sharepointProxyPrefix+u,"render-upload-add-url":n.sharepointProxyPrefix+i,"render-upload-delete-url":n.sharepointProxyPrefix+t,"render-ecm-upload-url":n.sharepointProxyPrefix+e,"render-grid-edit-url":n.sharepointProxyPrefix+t,"render-grid-save-url":n.sharepointProxyPrefix+t,"render-grid-add-url":n.sharepointProxyPrefix+t,"render-grid-rollback-url":n.sharepointProxyPrefix+t,"render-grid-commit-url":n.sharepointProxyPrefix+t,"render-grid-checkpoint-url":n.sharepointProxyPrefix+t,"render-save-entity":n.sharepointProxyPrefix+t,"render-stakeholder-associated":n.proxyPrefix+t,"render-search-default-image":"jquery/css/bizagi/desktop/images/bizagi_xpress.png","render-search-form-get-data":n.sharepointProxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":n.sharepointProxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":n.sharepointProxyPrefix+r,"render-letter-content-url":n.sharepointProxyPrefix+r,"render-letter-save-url":n.sharepointProxyPrefix+t,"render-letter-content-icons":"jquery/css/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":n.sharepointProxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":n.sharepointProxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":n.sharepointProxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","case-handler-getCaseSummary":n.sharepointProxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":n.sharepointProxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getWorkItems":n.sharepointProxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":n.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid"}):n.context=="entitymanagement"?{"form-get-data":n.proxyPrefix+t+"?h_contexttype=entity","form-submit-data":n.proxyPrefix+t+"?h_contexttype=entity","form-submit-data-upload":n.proxyPrefix+i+"?h_contexttype=entity","render-property-refresh":n.proxyPrefix+t+"?h_contexttype=entity","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":n.proxyPrefix+u+"?h_contexttype=entity","render-upload-add-url":n.proxyPrefix+i+"?h_contexttype=entity","render-upload-delete-url":n.proxyPrefix+t+"?h_contexttype=entity","render-grid-edit-url":n.proxyPrefix+t+"?h_contexttype=entity","render-grid-save-url":n.proxyPrefix+t+"?h_contexttype=entity","render-grid-add-url":n.proxyPrefix+t+"?h_contexttype=entity","render-grid-rollback-url":n.proxyPrefix+t+"?h_contexttype=entity","render-grid-commit-url":n.proxyPrefix+t+"?h_contexttype=entity","render-grid-checkpoint-url":n.proxyPrefix+t+"?h_contexttype=entity","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":n.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":n.proxyPrefix+"Rest/Handlers/Query?h_contexttype=entity","render-letter-notEditable-url":n.proxyPrefix+r+"?h_contexttype=entity","render-letter-content-url":n.proxyPrefix+r+"?h_contexttype=entity","render-letter-save-url":n.proxyPrefix+t+"?h_contexttype=entity","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:n.context=="search"?{"form-get-data":n.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data":n.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data-upload":n.proxyPrefix+i+"?h_contexttype=metadata","render-property-refresh":n.proxyPrefix+t+"?h_contexttype=metadata","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":n.proxyPrefix+u+"?h_contexttype=metadata","render-upload-add-url":n.proxyPrefix+i+"?h_contexttype=metadata","render-upload-delete-url":n.proxyPrefix+t+"?h_contexttype=metadata","render-grid-edit-url":n.proxyPrefix+t+"?h_contexttype=metadata","render-grid-save-url":n.proxyPrefix+t+"?h_contexttype=metadata","render-grid-add-url":n.proxyPrefix+t+"?h_contexttype=metadata","render-grid-rollback-url":n.proxyPrefix+t+"?h_contexttype=metadata","render-grid-commit-url":n.proxyPrefix+t+"?h_contexttype=metadata","render-grid-checkpoint-url":n.proxyPrefix+t+"?h_contexttype=metadata","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":n.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":n.proxyPrefix+"Rest/Handlers/Query?h_contexttype=metadata","render-letter-notEditable-url":n.proxyPrefix+r+"?h_contexttype=metadata","render-letter-content-url":n.proxyPrefix+r+"?h_contexttype=metadata","render-letter-save-url":n.proxyPrefix+t+"?h_contexttype=metadata","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:{}};
$.Class.extend("bizagi.render.services.context",{},{init:function(n){this.context=n.context;this.endPoints=bizagi.render.services.getEndPoints(n);this.proxyPrefix=bizagi.util.isEmpty(n.proxyPrefix)?"":n.proxyPrefix},getUrl:function(n){return this.endPoints[n]==null&&alert("No endpoint defined for: "+n),this.endPoints[n]},setProxyPrefix:function(n){this.proxyPrefix=bizagi.util.isEmpty(n.proxyPrefix)?"":n.proxyPrefix;this.endPoints=bizagi.render.services.getEndPoints(n)}});
$.Class.extend("bizagi.render.services.service",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(n){n=n||{};n.context=n.context||"workflow";n.proxyPrefix=bizagi.util.isEmpty(n.proxyPrefix)?"":n.proxyPrefix;this.serviceLocator=new bizagi.render.services.context(n);this.multiactionService=new bizagi.render.services.multiactionservice(this);this.userfieldRequests={}},multiaction:function(){return this.multiactionService},getFormData:function(n){var i=this,t,r;return n&&n.data?n.data:(n=n||{},t={},t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=n.action||"LOADFORM",n.idProcess&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idProcess"]=n.idProcess),n.idForm&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=n.idForm),n.idEntity&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEntity"]=n.idEntity),n.surrogateKey&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=n.surrogateKey),n.idRender&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender),n.xpathContext&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext),n.requestedForm&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"requestedForm"]=n.requestedForm),n.recordXPath&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordXPath"]=n.recordXPath),n.summaryForm&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"summaryForm"]=n.summaryForm),n.idCase&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=n.idCase),n.idWorkitem&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=n.idWorkitem),n.idTask&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idTask"]=n.idTask),n.idPageCache&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache),n.contextType&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contextType),n.guidEntity&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=n.guidEntity),bizagi.util.isEmpty(n.isRefresh)||(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"isRefresh"]=n.isRefresh),n.isActionStartForm&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=n.isActionStartForm),n.additionalXpaths&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=n.additionalXpaths),n.idStartScope&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=n.idStartScope),typeof n.readOnlyForm!="undefined"&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"readonlyform"]=n.readOnlyForm),typeof n.recordXpath!="undefined"&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=n.recordXpath),n.guid&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"guid"]=n.guid),n.printversion&&(r="all_",n[i.Class.BA_ACTION_PARAMETER_PREFIX+r+"rows"]&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+r+"rows"]=n[i.Class.BA_ACTION_PARAMETER_PREFIX+r+"rows"])),n.prepare)?t:(bizagi.chrono.initAndStart("data"),$.ajax({url:n.url||i.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:n.action||"LOAD"}).pipe(function(i){if(bizagi.chrono.stopAndLog("data"),n.printversion)try{i.form.properties.editable="False";var r=function(n){return n==null?n:(n.hasOwnProperty("type")&&n.type=="grid"?(n.id=t.id+"-print",n.allowAdd="False",n.allowDelete="False",n.allowEdit="False",n.allowGrouping="False",n.allowMore="False",n.allowSearch="False"):$.each(t,function(t,i){typeof i=="object"&&(n[t]=r(n[t]))}),n)};i=r(i)}catch(u){}return i}))},getSearchFormData:function(n){var i=this,t;return(n=n||{},t={},t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHFORM",n.xpath&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath),n.idRender&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender),n.xpathContext&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext),n.idSearchForm&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=n.idSearchForm),n.idPageCache&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-search-form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"SEARCHFORM"})},processDataValues:function(n){var t;n=$.extend(!0,{},n);for(t in n)n.hasOwnProperty(t)&&$.type(n[t])=="object"&&n[t].hasOwnProperty("id")&&(n[t]=n[t].id);return n},submitData:function(n){var t=this,i;return(data=t.resolveData(n.data||{},n.xpathContext),data=t.processDataValues(data),data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=n.action,n=n||{},n.xpath&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath),n.idRender&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender),n.xpathContext&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext),n.idPageCache&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache),n.guidEntity&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=n.guidEntity),n.contexttype&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),n.transitions&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"transitions"]=n.transitions),n.surrogatekey&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=n.surrogatekey),n.forcePlanCompletion&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"forcePlanCompletion"]=n.forcePlanCompletion),i=n.action.toString().toUpperCase(),bizagi.debug("Data sent",data),n.prepare)?data:$.ajax({url:n.url||t.serviceLocator.getUrl("form-submit-data"),data:data,type:"POST",dataType:"json",serviceType:i})},resolveData:function(n,t){var i,r,u;if(!$.isEmptyObject(n)&&t&&t.search(/\[id=\d+\]/)!==-1)for(i in n)i.search(/\[id=\d+\]/)!==-1&&t==i.substr(0,i.search(/\]/)+1)&&(r=i.substr(i.search(/\]/)+2),u=n[i],n[r]=u,delete n[i]);return n},getPropertyData:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=n.property,n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),n.guidentity&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=n.guidentity),n.surrogatekey&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=n.surrogatekey),n.pxpath&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"xpath"]=n.pxpath),n.prows&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=n.prows),n.ppage&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=n.ppage),n.pfilter!=undefined&&n.pfilter!=null&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"filter"]=n.pfilter),n.psort!=undefined&&n.psort!=null&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=n.psort),n.porder&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=n.porder),n.pcaseId&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"caseId"]=n.pcaseId),n.pguidEntity&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"guidEntity"]=n.pguidEntity),n.psurrogatedKey&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=n.psurrogatedKey),n.pactionXpath&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"actionXpath"]=n.pactionXpath),n.ptemplateGuid&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"templateGuid"]=n.ptemplateGuid),n.pparameters&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"parameters"]=n.pparameters),bizagi.debug("Property refresh for '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:n.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(n){bizagi.multiactionConnection=bizagi.multiactionConnection||[];bizagi.multiactionConnection.push(n)}})},getData:function(n){return this.getPropertyData($.extend(n,{property:"data"}))},getSearchData:function(n){var t=this;return n.extra=n.extra||{},n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"term"]=n.term,this.getPropertyData($.extend(n,{property:"data"}))},getCollapseData:function(n){var t=this;return n.extra=n.extra||{},n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"collapseState"]=n.collapseState,this.getPropertyData($.extend(n,{property:"collapseState"}))},getGridData:function(n){var t=this;return n.extra=n.extra||{},n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=n.sort,n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=n.order,n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=n.page,n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=n.rows,n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=n.searchFilter,n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=n.value,this.getPropertyData($.extend(n,{property:"data"}))},getGridDataExclusivesSelected:function(n){var t=this;return n.extra=n.extra||{},n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=n.rows,n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=n.value,n.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"xpathfilter"]=n.xpathfilter,this.getPropertyData($.extend(n,{property:"exclusivesSelected"}))},getUploadCancelImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-upload-cancel-image")},getUploadFileUrl:function(n){var t=this,r=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=n.fileId,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=n.sessionId,n.contexttype?i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype:"",t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(i)},getUploadFileEntityUrl:function(n){var t=this,r=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=n.fileId,n.isContextContainerWidgetRender?(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=n.sessionId,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=n.xpathActions):(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=n.surrogatekey,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=n.guidentity),t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(i)},getUploadAddUrl:function(){var n=this,i=this.serviceLocator.getUrl("render-upload-add-url"),t={};return t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDFILE",n.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(t)},getUploadAddFileUrl:function(n){var t=this,r=this.serviceLocator.getUrl("form-submit-data-upload"),i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=n===!0?"SAVEUSERIMAGE":"savefile",t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(i)},deleteImage:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="DELETEUSERIMAGE",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype?t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype:"",bizagi.debug("Removing image '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},deleteUploadFile:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype?t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype:"",bizagi.debug("Removing file in upload '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},getECMMetadata:function(n){var i=this,t=n.extra||{};return(t.action="getECMMetadata",t.idFileUpload=n.idFileUpload,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,t.xPath=n.xPath,t.idAttrib=n.idAttrib,n.sessionId&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=n.sessionId),bizagi.debug("Get file metadata '"+n.xPath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},checkOutFile:function(n){var i=this,t=n.extra||{};return(t.action="checkOutFile",t.idFileUpload=n.idFileUpload,t.xPath=n.xPath,t.idAttrib=n.idAttrib,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,bizagi.debug("file checkout '"+n.xPath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},cancelCheckOut:function(n){var i=this,t=n.extra||{};return(t.action="cancelCheckOut",t.idFileUpload=n.idFileUpload,t.xPath=n.xPath,t.idAttrib=n.idAttrib,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,bizagi.debug("file checkout '"+n.xPath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},deleteECMFile:function(n){var i=this,t=n.extra||{};return(t.action="delete",t.idFileUpload=n.idFileUpload,t.xPath=n.xPath,t.idAttrib=n.idAttrib,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,bizagi.debug("delete file'"+n.xPath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMFileContent:function(n){var i=this,t=n.extra||{};return(t.action="updateECMFileContent",t.idFileUpload=n.idFileUpload,t.xPath=n.xPath,t.idAttrib=n.idAttrib,t.metaValues=n.metaValues,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,bizagi.debug("Update file content '"+n.xPath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMMetadata:function(n){var i=this,t=n.extra||{};return(t.action="updateECMMetadata",t.idFileUpload=n.idFileUpload,t.xPath=n.xPath,t.idAttrib=n.idAttrib,t.metaValues=n.metaValues,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,bizagi.debug("Update file meta data '"+n.xPath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getFileProperties:function(n){var i=this,t=n.extra||{};return(t.action="getFileProperties",t.idFileUpload=n.idFileUpload,t.xPath=n.xPath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,bizagi.debug("Get file properties '"+n.xPath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},uploadECMFile:function(n){var i=this,t=n.extra||{};return(t.action="uploadECMFile",t.fileUpload=n.fileUpload,t.xPath=n.xPath,t.idAttrib=n.idAttrib,t.fileName=n.fileName,t.metaValues=n.metaValues,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,bizagi.debug("Upload ECM file '"+n.xPath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getECMFileUrl:function(n){var i=this,r=n.url||i.serviceLocator.getUrl("render-ecm-upload-url")+"File",t=n.extra||{};return t.action="viewECMFile",t.idFileUpload=n.idFileUpload,t.xPath=n.xPath,t.idAttrib=n.idAttrib,t.fileName=n.fileName,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t.xpathContext=n.xpathContext,n.sessionId&&(t[i.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=n.sessionId),n.p_sessionId&&(t.p_sessionId=n.p_sessionId),bizagi.debug("View uploaded file '"+n.xPath+"'",t),i.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(t)},isFileOnECM:function(n){var i=this,t={};return t.action="isFileOnECM",t.idUpload=n.idUpload,$.read(i.serviceLocator.getUrl("render-ecm-upload-url"),t)},editGridRecord:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EDITRELATION",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),bizagi.debug("Sending edit request for relation '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-edit-url"),data:t,type:"POST",dataType:"json",serviceType:"EDITRELATION"})},addGridRecord:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATION",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,bizagi.debug("Sending add request for grid '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATION"})},addGridRecordData:function(n){var i=this,t=n.extra||{},r;t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATIONWITHDATA";t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath;t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender;t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext;t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache;n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype);r=n.submitData||{};for(key in r)t[key]=r[key];return(bizagi.debug("Sending add request for grid '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATIONWITHDATA"})},saveGridRecord:function(n){var i=this,t=n.extra||{},r;t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVERELATION";t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender;t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext;n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype);t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"disableServerGridValidations"]=n.disableServerGridValidations||!1;n.submitData.idPageCache&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.submitData.idPageCache,delete n.submitData.idPageCache);r=n.submitData||{};r=i.processDataValues(r);for(key in r)t[key]=r[key];return(bizagi.debug("Sending save request for grid '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVERELATION"})},deleteGridRecord:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),bizagi.debug("Sending delete request for grid '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"REMOVERELATION"})},getFlipAssociation:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.id,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="flipped",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t[i.Class.BA_ACTION_PARAMETER_PREFIX+"flipstate"]=n.flipstate,n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),bizagi.debug("Sending request for flip association control '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:"text"}).pipe(function(n){try{return bizagi.services.ajax.parseJSON(n)}catch(t){return n}})},rollbackGridAction:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ROLLBACK",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),bizagi.debug("Sending rollback request for grid '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-rollback-url"),data:t,type:"POST",dataType:"json",serviceType:"ROLLBACK"})},getSearchDefaultImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-search-default-image")},processDataCriteria:function(n){var t;n=$.extend(!0,[],n);for(t in n)n.hasOwnProperty(t)&&n[t].hasOwnProperty("value")&&$.type(n[t].value)=="object"&&n[t].value.hasOwnProperty("id")&&n[t].value.hasOwnProperty("label")&&(n[t].value=n[t].value.id);return n},submitSearch:function(n){var t=this,r,i=n.extra||{};return(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHENTITYFORRENDER",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=n.idSearchForm,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=n.sort,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=n.page,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"pageSize"]=n.rows,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=n.searchFilter,r=t.processDataCriteria(n.criteria),i[t.Class.BA_ACTION_PARAMETER_PREFIX+"searchCriteria"]=JSON.encode(r),n.allowFullSearch&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"allowFullSearch"]=n.allowFullSearch),n.maxRecords&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"maxRowsAllowed"]=n.maxRecords),bizagi.debug("Performing advanced search",i),n.prepare)?i:$.ajax({url:n.url||t.serviceLocator.getUrl("render-search-advanced-url"),data:i,type:"POST",dataType:"json",serviceType:"SEARCHENTITYFORRENDER"})},associateStakeholder:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVE",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=n.surrogateKey,t.associatedUser=n.associatedUser,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=n.guidentity,bizagi.debug("Property refresh for '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:n.dataType||"json"})},refreshAssociateStakeholder:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=n.property,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,bizagi.debug("Property refresh for '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:n.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getLetterNotEditableUrl:function(n){var t=this,i=n.extra||{},r;return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,r=n.url||t.serviceLocator.getUrl("render-letter-notEditable-url"),t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(i)},getLetterContent:function(n){var t=this,i=n.extra||{};return(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,n.prepare)?i:$.ajax({url:n.url||t.serviceLocator.getUrl("render-letter-content-url"),data:i,type:"POST",dataType:"html"}).pipe(function(n){try{return bizagi.services.ajax.parseJSON(n)}catch(t){return n}})},getCanGenerateLetter:function(n){var t=this,i=n.extra||{};return(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CANGENERATELETTER",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,n.prepare)?i:$.ajax({url:t.serviceLocator.getUrl("render-letter-content-url"),data:i,type:"POST",dataType:"json"})},saveLetterContent:function(n){var t=this,i=n.extra||{};i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="UPDATELETTER";i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender;i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath;i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext;i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache;var r=n.content||"",f=n.url||t.serviceLocator.getUrl("render-letter-save-url"),u=f+"?"+jQuery.param(i);return(bizagi.debug("Save request for letter sent to: "+u,r),n.prepare)?i:$.ajax({url:u,data:r,type:"POST",dataType:"html"})},getLetterEditorIconsPath:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-letter-content-icons")},executeButton:function(n){return this.getPropertyData($.extend(n,{property:"buttonRule"}))},getFilePrintUrl:function(n){var t=this,r=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="data",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=n.disposition,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=n.sessionId,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype?i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype:"",t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(i)},editLinkForm:function(n){return this.editGridRecord(n)},saveLinkForm:function(n){var i=this,t=n.extra||{},r;t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVEFORMLINKRELATION";t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender;t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext;n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype);n.submitData.idPageCache&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.submitData.idPageCache,delete n.submitData.idPageCache);r=n.submitData||{};r=i.processDataValues(r);for(key in r)t[key]=r[key];return(bizagi.debug("Sending save request for grid '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVEFORMLINKRELATION"})},rollbackLinkForm:function(n){return this.rollbackGridAction(n)},commitLinkForm:function(n){return this.commitGridAction(n)},sendCheckpoint:function(n){return this.sendCheckpointAction(n)},getUserfieldDefinition:function(n){var t=this;return(n=n||{},t.userfieldRequests[n.userfield])?t.userfieldRequests[n.userfield]:(t.userfieldRequests[n.userfield]=$.read(t.serviceLocator.getUrl("render-userfield-definition"),{guidUserfield:n.userfield,device:n.device||"desktop"}),t.userfieldRequests[n.userfield])},refreshControl:function(n){var i=this,t;return(n=n||{},t={},t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESH",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,n.xpathContext?t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext:"",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype?t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype:"",n.idForm?t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=n.idForm:"",n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"PARTIALREFRESH"})},refreshGridCell:function(n){var t=this,i;return(n=n||{},i={},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESHGRIDCELL",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidcolumn"]=n.column,n.xpathContext?i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext:"",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,n.idForm?i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=n.idForm:"",n.prepare)?i:$.ajax({url:n.url||t.serviceLocator.getUrl("form-get-data"),data:i,type:"POST",dataType:"json"})},executeRule:function(n){var t=this,i={};return(n=n||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTERULE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidrule"]=n.rule||"",n.xpathContext?i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext:"",n.contexttype?i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype:"",n.prepare)?i:$.create(t.serviceLocator.getUrl("form-submit-data"),i)},executeInterface:function(n){var t=this,i={};return(n=n||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEINTERFACE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidinterface"]=n.interface||"",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext||"",n.prepare)?i:$.create(t.serviceLocator.getUrl("form-submit-data"),i)},executeSAPConnector:function(n){var t=this,i={};return(n=n||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTESAP",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidsap"]=n.guidsap||"",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext||"",n.prepare)?i:$.create(t.serviceLocator.getUrl("form-submit-data"),i)},executeConnector:function(n){var t=this,i={};return(n=n||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTECONNECTOR",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidConnector"]=n.guidConnector||"",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext||"",n.prepare)?i:$.create(t.serviceLocator.getUrl("form-submit-data"),i)},generateDocumentTemplate:function(n){var t=this;return n=n||{},n.append=n.append?n.append:!1,$.create(t.serviceLocator.getUrl("render-document-generate"),{h_pageCacheId:n.idPageCache,contextXpath:n.xpathcontext,groupMappingId:n.groupMapping,xpathAttribute:n.xpath,append:n.append,controlId:n.id})},getAllDocumentsDownloadUrl:function(n){var i=this,r=this.serviceLocator.getUrl("render-document-generateAllDocuments"),t={};return t.h_pageCacheId=n.idPageCache,t.contextXpath=n.xpathContext,t.xpathAttribute=n.xpath,t.idCase=n.idCase,t.idWorkItem=n.idWorkItem,t.p_sessionId=n.sessionId,i.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(t)},getCaseNumber:function(n){var t=this;return $.ajax({url:t.serviceLocator.getUrl("case-handler-getCaseSummary").replace("{idCase}",n.idCase)+"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice="+bizagi.isMobile(),type:"GET",dataType:"json"})},getCaseAssignees:function(n){var t=this;return n=n||{},$.read(t.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:n.idCase}).pipe(function(n){return n})},getWorkitems:function(n){var t=this;return n=n||{},$.read(t.serviceLocator.getUrl("case-handler-getWorkItems"),{idCase:n.idCase,onlyUserWorkItems:n.onlyUserWorkItems||""})},getGridExportUrl:function(n){var t=this,r=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=n.exportType,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=n.disposition,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=n.sort,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=n.sessionId,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"idForm"]=n.idForm,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype?i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype:"",t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(i)},sendEmail:function(n){var i=this,t,r;return(n=n||{},t={},t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=n.property||"sendEmail",n.xpathContext?t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext:"",t[i.Class.BA_ACTION_PARAMETER_PREFIX+"to"]=n.to,t[i.Class.BA_ACTION_PARAMETER_PREFIX+"subject"]=n.subject,t[i.Class.BA_ACTION_PARAMETER_PREFIX+"message"]=n.message,t[i.Class.BA_ACTION_PARAMETER_PREFIX+"selected"]=JSON.encode(n.selected),n.prepare)?t:(r=n.url||i.serviceLocator.getUrl("form-get-data"),$.create(r,t))},getUsersList:function(n){var t=this;return $.read(t.serviceLocator.getUrl("admin-getUsersList"),n)},getUsersForAssignation:function(n){var t=this;return $.read(t.serviceLocator.getUrl("admin-getUsersForAssignation"),n)},getUsersForm:function(n){var t=this;return $.create(t.serviceLocator.getUrl("admin-usersform"),n)},generateDataToSendByEmail:function(n){var t=this,i;return n=n||{},i={action:"GenerateDataToSendByEmail",idUser:n.idUser,password:n.password},$.ajax({url:t.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:n,type:"POST",dataType:"json"})},sendUserEmail:function(n){var t=this,i;return n=n||{},i={action:"SendUserEmail",emailTo:n.eMailTo,subject:n.subject,body:n.body},$.ajax({url:t.serviceLocator.getUrl("admin-sendUserEmail"),data:n,type:"POST",dataType:"json"})},getConfiguration:function(){var n=this,t=n.serviceLocator.getUrl("admin-users-config");return $.read(t)},verifyPathToBase:function(n,t){return t.indexOf("http")!=-1&&n!=""?t:n+t},getTemplate:function(n){var i=this,t={},r;return(n=n||{},t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADTEMPLATE",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]="entity",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=n.guid,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"isProcessData"]=n.forcePersonalizedColumns,n.templateType&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"templatetype"]=n.templateType),n.templateGuid&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"templateguid"]=n.templateGuid),n.isDefaultTemplate!=undefined&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"isDefaultTemplate"]=n.isDefaultTemplate),r=bizagi.util.detectDevice(),bizagi.util.isTabletDevice()?r="tablet":bizagi.util.isSmartphoneDevice()&&(r="mobile"),t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=r,n.prepare)?t:$.create(i.serviceLocator.getUrl("form-get-data"),t)},hasStartForm:function(n){var i=this,t={};return n.guidWFClass&&(t.guidWFClass=n.guidWFClass),$.read(i.serviceLocator.getUrl("render-processes-startform"),t)},getStartForm:function(n){var t=this,i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADSTARTFORM",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidprocess"]=n.guidprocess,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=!0,n.idStartScope&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=n.idStartScope),n.idCase&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=n.idCase),n.idStartScope&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=n.idStartScope),n.idWorkitem&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=n.idWorkitem),n.additionalXpaths&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=n.additionalXpaths),n.surrogatedKey&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=n.surrogatedKey),n.recordXpath&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=n.recordXpath),n.mappingstakeholders&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"mappingstakeholders"]=n.mappingstakeholders),$.ajax({url:t.serviceLocator.getUrl("form-get-data"),data:i,type:"POST",dataType:"json",cache:!0})},editActionForm:function(n){return this.editGridRecord(n)},getActions:function(n){var t=this,r=$.extend(n,{prepare:!0}),i=t.getPropertyData(r)||[];return(n.ptags&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=n.ptags),n.pmaxitems&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"maxitems"]=n.pmaxitems),n.prepare)?i:$.ajax({url:n.url||t.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:n.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(n){bizagi.multiactionConnection=bizagi.multiactionConnection||[];bizagi.multiactionConnection.push(n)}})},executeActions:function(n){var t=this,r=$.extend({},n,{prepare:!0}),i=t.getPropertyData(r)||[];return(n.pguidConstructor&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"guidConstructor"]=n.pguidConstructor),n.pguidAction&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"guidAction"]=n.pguidAction),n.prepare)?i:$.ajax({url:n.url||t.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:n.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getPolymorphicActions:function(n){var t=this,r=$.extend(n,{prepare:!0}),i=t.getPropertyData(r)||[];return(n.ptags&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=n.ptags),n.additionalXpaths&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"additionalXpaths"]=n.additionalXpaths),n.prepare)?i:$.ajax({url:n.url||t.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:n.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},serializePolymorphicActions:function(n){var i=[],t=0,r=1,s=2,h=3,c=4,u=5,f=6,l=function(t){var i=[];return t=t||"",$.each(n,function(n,r){r[f]==t&&i.push(r)}),i},e=function(i){i=i||{};var u="";return $.each(n,function(n,o){o[t]==i[f]&&(u+=e(o)+o[r]+" > ")}),u},o=function(n,i){var f,a=l(i);return $.each(a,function(i,l){var a=o([],l[t]);f={guidEntity:l[t],displayName:l[r],hasConstructor:l[u]?!0:!1,type:l[h],guidObject:l[c],guidConstructor:l[u],xpathContext:l[s],children:a,parents:e(l)};(f.guidConstructor!==""||f.children.length>0)&&n.push(f)}),n};return o(i,""),i},getEntityImage64:function(n){var t=this,i={width:n.data,height:n.height,xpath:n.xpath},r=t.serviceLocator.getUrl("render-entity-layout-image64").replace("{entity}",n.entity).replace("{surrogateKey}",n.surrogateKey);return $.ajax({url:r,data:i})},getFilesDataForLayoutUploadControl:function(n){var t=this;return $.read(t.serviceLocator.getUrl("render-entity-layout-upload-files"),n)},processUploadFile:function(n){return $.ajax({url:n.url,data:n.formData,type:"POST",contentType:!1,processData:!1})},commitGridAction:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="COMMIT",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),bizagi.debug("Sending rollback request for grid '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-commit-url"),data:t,type:"POST",dataType:"json",serviceType:"COMMIT"})},sendCheckpointAction:function(n){var i=this,t=n.extra||{};return(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CHECKPOINT",t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.xpath,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=n.idRender,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=n.xpathContext,t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=n.idPageCache,n.contexttype&&(t[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=n.contexttype),bizagi.debug("Sending checkpoint request for grid '"+n.xpath+"'",t),n.prepare)?t:$.ajax({url:n.url||i.serviceLocator.getUrl("render-grid-checkpoint-url"),data:t,type:"POST",dataType:"json",serviceType:"CHECKPOINT"})}});
$.Class.extend("bizagi.render.services.multiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(n){this.service=n;this.serviceLocator=n.serviceLocator;this.batch={};this.batchTimer=50;this.circularDependencies=new bizagi.circularDependencies;this.replicateServiceMethods()},getService:function(){return this.service},replicateServiceMethods:function(){var t=this;for(var n in this.service.Class.prototype)n!="init"&&n!="constructor"&&n!="Class"&&n!="multiaction"&&(t[n]=eval("var tmp = function(){ return this.proxyMethod(this.getService()."+n+", arguments);};tmp"))},proxyMethod:function(n,t){var i=this.service,r,u;return!t||t.length!=1?n.apply(i,t):typeof t[0]!="object"?n.apply(i,t):(r=t[0],r.prepare==!0)?n.apply(i,t):(r.prepare=!0,u=n.apply(i,t),this.add(u))},makeCircularDependenciesError:function(n){var t=bizagi.localization.getResource("render-actions-loop-validation");return printf(t,n.dependencyFrom,n.dependencyTo)},add:function(n){var t=this,i=new $.Deferred,r=n.h_action||"unnamed",u,f;return["PROCESSPROPERTYVALUE","LOADTEMPLATE","ADDRELATIONWITHDATA"].indexOf(r)<0&&bizagi.override.detectCircularDependencies&&t.circularDependencies.addNode(r,n),clearTimeout(t.batchTimeout),u=n.tag=Math.guid(),f={action:n,deferred:i},t.batch[u]=f,t.batchTimeout=setTimeout(function(){var n=t.circularDependencies.resolve(),i,r;if(n.error){for(i in t.batch)r=n.error.multiactionError,t.batch[i].deferred.reject(r);t.batch={}}else t.fire()},t.batchTimer),i.promise()},fire:function(){var t=this,n={},i=[];$.each(t.batch,function(t,r){i.push(r.action);n[t]=r});t.batch={};$.when(t.execute({actions:i,rejectDeferreds:!1})).done(function(t){$.each(t,function(t,i){var r=i.tag;i.error?n[r].deferred.reject(i.error,i,i.error.message):n[r].deferred.resolve(i.result);delete n[r]});$.each(n,function(n,t){t.deferred.reject({type:"not-processed",message:"Operation didn't executed"},"","Operation didn't executed")})}).fail(function(t,i,r){var u=typeof r!="undefined"?r.message:r||"Operation didn't executed";$.each(n,function(n,t){t.deferred.reject({type:"not-processed",message:u},"","Operation didn't executed")})})},execute:function(n){var r=this,u={},f=n.rejectDeferreds!==undefined?n.rejectDeferreds:!0,t;return u[r.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(n.actions,function(n,t){t[r.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=t.tag||n;delete t.tag}),n=n||{},n.actions&&(u[r.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(n.actions)),bizagi.debug("Performing multi-action",u),t=new $.Deferred,$.ajax({url:r.serviceLocator.getUrl("render-multiaction"),data:u,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(n){bizagi.multiactionConnection=bizagi.multiactionConnection||[];bizagi.multiactionConnection.push(n)}}).done(function(n){for(i in n)if(typeof n[i]!="function"){var r=n[i];if(r.error&&f){t.reject(this,"servererror",r);return}}t.resolve(n)}).fail(function(n){var r=n.responseText||n,i;try{i=JSON.parse(r)}catch(u){}t.reject(n,"servererror",i)}),t.promise()}});
$.Class.extend("bizagi.command.controllers.controller",{THROW_ERROR:!0},{init:function(n){this.form=n;this.dateFormat=n.getResource("dateFormat")},buildConditions:function(n,t,i){var e=this,o=n.expressions&&n.expressions.length>1?e.buildConditionOperator(n.operator):n.operator,r,u,f;if(t=t||!1,i=i||!1,o=="true")return"true";if(o=="false")return"false";for(r="",u=0;u<n.expressions.length;u++)f=n.expressions[u],f.simple?r+=e.buildSimpleCondition(f.simple,t,i):f.complex&&(r+="("+e.buildConditions(f.complex,t,i)+") "),r+=u<n.expressions.length-1?o:"";return r},buildConditionOperator:function(n){return n=="and"?" && ":n=="or"?" || ":n},buildSimpleCondition:function(n,t,i){var l=this,r,s,e="",u=n.operator,o="",f="",a;t=t||!1;i=i||!1;var h=n.xpath||n.renderId,c=l.detectConditionArgumentType(h,n.argumentType);if(r=l.buildXpath(h,c,t),c!="boolean"&&(o+="!bizagi.util.isEmpty("+r+") && "),i&&h&&h.length>0&&!{boolean:""}.hasOwnProperty(c)&&(f="self.isVisible('"+h+"') && self.isEditable('"+h+"') && "),bizagi.util.isEmpty(n.argument)?n.argument===""&&(e='""'):(e=l.buildArgument(n.argument,c,t),c=="xpath"&&(o+="!bizagi.util.isEmpty("+e+") && ")),u=="includes")return f+o+"self.includes("+r+","+e+") ";if(u=="changes")return"self.isChanged("+r+", params.changed)";if(u=="equals")return f+o+r+" == "+e;if(u=="not-equals")return f+r+" != "+e;if(u=="less-than")return f+o+r+" < "+e;if(u=="less-equals-than")return f+o+r+" <= "+e;if(u=="greater-than")return f+o+r+" > "+e;if(u=="greater-equals-than")return f+o+r+" >= "+e;if(u=="like")return f+o+r+".toString().indexOf("+e+") >= 0 ";if(u=="is-empty")return c!="entity"?f+"bizagi.util.isEmpty("+r+")":f+"("+r+" == 0 || bizagi.util.isEmpty("+r+"))";if(u=="is-not-empty")return c!="entity"?f+"!bizagi.util.isEmpty("+r+")":f+"("+r+" != 0 && !bizagi.util.isEmpty("+r+"))";if(u=="is-true")return f+"( "+r+" == true || "+r+" == 'true' )";if(u=="is-false")return f+"( "+r+" == false || "+r+" == 'false' || "+r+" == 'False' )";if(u=="does-not-contain")return f+o+r+".toString().indexOf("+e+") < 0 ";if(u=="contains")return f+o+r+".toString().indexOf("+e+") >= 0 ";if(u=="begins-with")return f+o+r+".toString().startsWith("+e+") == true ";if(u=="does-not-begins-with")return f+o+r+".toString().startsWith("+e+") == false ";if(u=="file-uploaded")return s=h,t&&s&&(s=s.replaceAll("[]","[' + i + ']")),f+"self.isFileUploaded('"+s+"') ";if(u=="file-not-uploaded")return s=h,t&&s&&(s=s.replaceAll("[]","[' + i + ']")),f+"!self.isFileUploaded('"+s+"') ";if(u=="is-invalid-email")return f+"!self.isValidEmail("+r+") ";if(u=="letter-edited"||u=="letter-not-edited")return"false";if(u=="cell-change")return"column == "+e;if(u=="on-press")return t?(a=l.buildXpath(h,"id",t),"self.isGridButtonPressed("+a+", params.pressed)"):"self.isButtonPressed('"+h+"', params.pressed)";if(u=="on-deleted-row")return s=h||"","self.onDeletedGridRow('"+s+"', params.rowDeleted)";throw new"There is no implementation for operator code "+u;},detectConditionArgumentType:function(n,t){var u=this,f,r,e,i,o;if(t===undefined||t=="const"){if(f=u.form,r=f.getRender(n)||f.getRenderById(n),r==null)throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller");if(r.properties.type=="grid"){if(e=u.processGridXpath(n),e.remainingXpath==="")return"xpath";if(r=r.getColumn(e.remainingXpath),r==null)throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller");}return(i=r.properties.dataType,o=r.properties.type,u.isRelatedEntityRender(o))?"entity":i==1||i==2||i==3||i==4||i==6||i==7||i==10||i==11?"number":i==8?"money":i==12||i==13?r.properties.showTime==!0?"datetime":"date":i==5?"boolean":o=="button"?"button":"text"}return t=="xpath"||t=="function"||t=="entity"?t:"text"},isRelatedEntityRender:function(n){return n=="combo"||n=="cascadingCombo"||n=="list"||n=="radio"||n=="search"||n=="searchCombo"||n=="columnCombo"?!0:!1},buildXpath:function(n,t,i){var r=this,u;if(i=i||!1,i&&(n=n.replaceAll("[]","[' + i + ']")),t!="xpath"||i){if(t=="id")return"'"+n+"'";if(t=="function")return u=r.detectConditionArgumentType(n,"const"),"self.evalXpath('"+n+"', '"+u+"')"}else return"self.evalXpath('"+n+"', '"+r.detectConditionArgumentType(n,"const")+"')";return"self.evalXpath('"+n+"', '"+t+"')"},buildArgument:function(n,t,i,r){var s=this,f,u,o,e;if(i=i||!1,t=="text")return n=n==null?"":n,n=typeof n!="string"?n.toString():n,n.indexOf("'")!=-1&&(n=n.replaceAll("'","\\'")),n.indexOf("\n")!=-1&&(n=n.replaceAll("\n","")),"'"+n.toString()+"'";if(t=="boolean")return typeof n=="string"?eval(n.toLowerCase())==!0?"true":"false":eval(n)==!0?"true":"false";if(t=="number")return(f=new Number(n),f==NaN)?"-99999999":f.toString();if(t=="money")return(f=new Number(n),f==NaN)?"-99999999":f.toString();if(t=="date")return u=bizagi.util.dateFormatter.getDateFromInvariant(n),u&&u!=0||(u=new Date(0)),u.setHours(0,0,0,0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(u)+"').getTime()";if(t=="datetime")return u=bizagi.util.dateFormatter.getDateFromInvariant(n),u&&u!=0||(u=new Date(0)),u.setHours(0,0,0,0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(u,!0)+"').getTime()";if(t=="color")return"'"+n.toString()+"'";if(t=="entity"){if(bizagi.util.isEmpty(n))return null;try{n=typeof n!="object"?JSON.parse(n):n}catch(h){n=n||{}}return o=n.id||n,JSON.stringify(o)}if(t=="xpath")return e=n.toString(),i&&(e=e.replaceAll("[]","[' + i + ']")),r&&(e=r+"."+e),s.buildXpath(e,t,i);if(t=="json")return JSON.encode(n);if(t=="function"){if(n=="BANow")return"self.getCurrentDate()";throw"There is no implementation for function "+n;}if(t==undefined)return null;throw"There is no implementation for argument type "+t;},isEditable:function(n){var t=this,i=t.getRender(n);if(i==null){t.Class.THROW_ERROR&&t.showRenderNotFoundError(n);return}return i.properties.editable},isVisible:function(n){var t=this,i=t.getRender(n);if(i==null){t.Class.THROW_ERROR&&t.showRenderNotFoundError(n);return}return i.properties.visible?t.isParentVisible(i.parent):!1},isParentVisible:function(n){var t=this;return n.parent?n.properties.visible?t.isParentVisible(n.parent):!1:n.properties.visible},evalXpath:function(n,t){var f=this,h,r,c=f.getRenders(n),e,l,u,s,o,i;if(c==null)return f.Class.THROW_ERROR&&f.showRenderNotFoundError(n),null;for(e=[],$.each(c,function(n,t){t.properties.editable&&e.push(t)}),e.length===0&&$.each(c,function(n,t){e.push(t)}),h=0;h<e.length;){if(r=e[h++],l=r.properties.type=="grid",l){if(s=f.processGridXpath(n),o=r.getColumn(s.remainingXpath),!o)continue;return(i=r.getCellCurrentValue(s.index,s.remainingXpath),o.properties.type=="columnRadio"&&(i=i?i.length>0&&i[0].length>0?i[0][0]:i.id:0),o.properties.type=="columnCombo"&&(i=i&&i.id?i.id:0),o.properties.type=="columnSearch"&&(i=i&&i.id?i.id:0),bizagi.util.isEmpty(i)&&t=="boolean")?o.properties.display=="check"?!1:null:t=="boolean"||t=="date"&&!bizagi.util.isEmpty(f.getRender(n,t).value)?eval(f.buildArgument(i,t)):i}return(u=r.getValue(),t===undefined||t==="undefined")?u:((r.properties.type=="combo"||r.properties.type=="list"||r.properties.type=="cascadingCombo"||r.properties.type=="search"||r.properties.type=="radio")&&(bizagi.util.isEmpty(u)||u.id=="")&&(u=0),r.properties.type=="comboSelected")?typeof u=="string"?JSON.parse(u).value:u:bizagi.util.isEmpty(u)?r.properties.type=="boolean"&&r.properties.display=="check"?!1:bizagi.util.isEmpty(u)&&r.properties.type=="boolean"&&r.properties.display=="check"?!1:u:eval(f.buildArgument(u,t))}},isFileUploaded:function(n){var i=this,t=i.evalXpath(n);return t&&t.length&&t.length>0?!0:!1},isValidEmail:function(n){return n&&n.match(new RegExp(/^([a-zA-Z0-9\u0430-\u044F'&#*:._-]|&#39;)+@[a-zA-Z0-9\u0430-\u044F.-]+\.[a-zA-Z\u0430-\u044F]+$/gi))?!0:!1},isButtonPressed:function(n,t){var i=this.getRenderById(n);return i===null||i.properties.type!="button"?!1:t},isGridButtonPressed:function(n,t){var r=this.processGridXpath(n),f=r.gridXpath,i=this.getRender(f),u=r.remainingXpath||"";return t&&i&&i.columns&&$.each(i.columns,function(n,i){(i.properties.xpath===u||i.properties.id===u)&&i.properties.type==="columnButton"&&(t=!0)}),t},isChanged:function(n,t){return n===undefined||n===null?!1:t},includes:function(n,t){if(typeof n=="undefined"||n===null||typeof t=="undefined"||t===null)return!1;var i=$.grep(n,function(n){return n.id==t});return i.length>0?!0:!1},onDeletedGridRow:function(n,t){var i=this,r=i.getRender(n)||{};return r&&t?!0:!1},getRenders:function(n){var u=this,f=u.form,t=null,r=/id=([\w-]+)/gi.exec(n),i;return r&&r.length>1?(i=u.getRenderById(r[1]),i?i.length==0?null:(t=[],t.push(i),t):null):(t=f.getRenders(n),t.length==0)?null:t},getRender:function(n){var t=this,i=t.form;return i.getRender(n)},getRenderById:function(n){var t=this,i=t.form;return i.getRenderById(n)},showRenderNotFoundError:function(n){bizagi.debug("Cannot find render in DOM: "+n)},showContainerNotFoundError:function(n){bizagi.debug("Cannot find container in DOM: "+n)},getCurrentDate:function(){var n=new Date;return n.setHours(0,0,0,0),n},processGridXpath:function(n){var f=new RegExp(/([\w\.]*)\[(\d*)\]\.([\w\.|\w-\.]*)/g),t=f.exec(n),i,r,u;return t?(u=t[1],i=t[2],r=t[3]):(i="",r=""),{xpath:n,index:i,remainingXpath:r,gridXpath:u}},searchForGridReference:function(n,t){var i=this,r,u;if(n)return i.searchGridReferenceInCondition(n);if(t)for(r in t)return u=t[r],i.searchForGridReferenceInCommand(u);return null},searchForGridReferenceInCommand:function(n){return n.xpath&&n.xpath.indexOf("[]")>0?n.xpath.substring(0,n.xpath.indexOf("[]")):n.argumentType=="xpath"&&n.argument.indexOf("[]")>0?n.argument.substring(0,n.argument.indexOf("[]")):void 0},searchGridReferenceInCondition:function(n){var r=this,t;if(typeof n=="string"||typeof n=="boolean")return null;if(n.expressions){for(i in n.expressions)if(t=r.searchGridReferenceInCondition(n.expressions[i]),t)return t}else{if(n.simple)return r.searchGridReferenceInCondition(n.simple);if(n.complex)return r.searchGridReferenceInCondition(n.complex);if((n.xpath||n.renderId)&&((t=r.searchGridReferenceInXpath(n.xpath)||r.searchGridReferenceInXpath(n.renderId),t)||n.argumentType=="xpath"&&(t=r.searchGridReferenceInXpath(n.argument),t)))return t}return null},searchGridReferenceInXpath:function(n){return n&&n.indexOf("[]")>0?n.substring(0,n.indexOf("[]")):null},getGridControl:function(n,t){var i=this,r=i.processGridXpath(n).remainingXpath,u=i.getRender(n);return u.getControlCell(t,r)}});
bizagi.command.controllers.controller.extend("bizagi.command.controllers.validation",{},{init:function(n,t,i){var r=this,f,u;r.enableDebug=!1;this._super(n);f=i!=undefined?i.container:n.container;u=$("<div />").appendTo(f);u.bizagi_notifications({itemIcon:"ui-icon-circle-close",minimized:!1,clearEnabled:!1,title:n.getResource("render-form-validations-header-text"),device:bizagi.util.detectDevice(),orientation:n.properties.orientation});u.bind("itemClick",function(n,t){r.onNotificationClick(t.data)});t&&r.buildValidations(t);r.validationBox=u;r.validations=t||[]},buildValidations:function(n){var t=this,i=t.buildAllValidations(n);t.form.bind("rendervalidate",function(){return i(t)})},showErrorMessage:function(n){bizagi.showErrorAlertDialog=!1;this.showValidationMessage(n,null,"ui-icon-circle-close","ui-state-error")},showAlertMessage:function(n){this.showValidationMessage(n,null,"ui-icon-alert","ui-state-highlight")},showInfoMessage:function(n){this.showValidationMessage(n,null,"ui-icon-info","ui-state-highlight")},showValidationMessage:function(n,t,i,r){var u=this,o=u.form,f=t?o.getRender(t):null,e;if(bizagi.showErrorAlertDialog=!1,e=function(){u.clearValidationMessages();u.validating=!0;u.performValidations();u.validating=!1;u.countValidationMessages()==0&&u.hideValidationMessages()},u.validationBox.bizagi_notifications("addNotification",n,t,i,r,e),f&&(f.setValidationMessage(n),!bizagi.util.isIE8()&&!u.validating))f.one("rendervalidate",e)},countValidationMessages:function(){var n=this;return n.validationBox.bizagi_notifications("count")},clearValidationMessages:function(){var t=this,n=$(".ui-bizagi-notifications-container","body").not(".ui-bizagi-log-container");return n.bizagi_notifications("clearAll")},hideValidationMessages:function(){var n=this;return n.validationBox.bizagi_notifications("hide")},showValidationMessages:function(){var n=this;return n.validationBox.bizagi_notifications("show")},expandNotificationBox:function(n){var t=this;return n!==!1&&t.validationBox.bizagi_notifications("autoFocusFirstError"),t.validationBox.bizagi_notifications("expand")},performValidations:function(){var n=this,t,i;return(n.clearValidationMessages(),n.validationBox.bizagi_notifications("initBatch"),t=n.validateRenders(),i=n.validations.length>0?n.form.triggerHandler("rendervalidate"):!0,n.validationBox.bizagi_notifications("endBatch"),!i||!t)?(n.validationBox.bizagi_notifications("show"),!1):!0},buildAllValidations:function(n){for(var u,e,i=this,r="",t=0;t<n.length;t++)if(u=n[t].enabled!=undefined?n[t].enabled:!0,u)try{r+=i.buildValidation(n[t].conditions,n[t].validationCommand)}catch(f){f.message!="RenderNotFoundException"&&bizagi.logError("Validation cannot be parsed: "+f.message,n[t])}return e="var baTmpFn = function(self){\r\n var bValid = true;\r\n "+r+"\r\n return bValid;}; baTmpFn",i.evalValidation(e)},buildValidation:function(n,t){var s=this,u="",f="",e=s.searchForGridReference(n),o=e!=null,r,i;return u+="( "+s.buildConditions(n,o,!0)+" )",t.message=t.message.replace(/'/g,"\\'"),t.message=t.message.replace(/\n/g," "),r=t.focus||"",o&&(r=e),f+=t.tokens?"self.showValidationMessage(' "+t.message+"', '"+r+"', JSON.parse('"+JSON.encode(t.tokens)+"')); bValid = false;\r\n":"self.showValidationMessage(' "+t.message+"', '"+r+"'); bValid = false;\r\n",o?(i="var grid = self.form.getRender('"+e+"');\r\n",i+="if(grid === null) return true;\r\n",i+="var data = grid.getIndexes();\r\n",i+="var bGridValid = true;\r\n",i+="$.each(data, function(_, i) {\r\n",i+="if ("+u+"){\r\n bGridValid = false; \r\n}",i+="});\r\n",i+("if (bGridValid == false){\r\n "+f+"\r\n}")):"if ("+u+"){\r\n "+f+" \r\n}"},onNotificationClick:function(n){var i=this,r=i.form,t;n&&(t=r.getRender(n),t&&t.focus())},validateRenders:function(){var i=this,t=[],r=i.form.isValid(t),n;if(!r)for(n=0;n<t.length;n++)i.showValidationMessage(t[n].message,t[n].xpath);return r},evalValidation:function(n){var t=this;return t.enableDebug&&console!=undefined&&console.log(n),eval(n)}});
bizagi.command.controllers.controller.extend("bizagi.command.controllers.action",{},{init:function(n,t){var i=this;this._super(n);i.globalDependencies={};i.initialCallFunctions={};i.initialCallFunctionsDeferred=new $.Deferred;t&&i.buildActions(t);i.actions=t;i.internalSubmitActions={};i.initialCallTimeout=25;i.initialCallIncrements=25;i.actionsHistory={};i.period=50},processInternalSubmitAction:function(n,t){var i=this;i.internalSubmitActions[n]||(i.internalSubmitActions[n]=t,i.buildAction(t,!0))},buildActions:function(n,t){for(var o=this,r={},i=0,s=n.length;i<s;i++)try{var u=n[i],f=bizagi.util.md5(JSON.stringify(u.conditions)),e=bizagi.util.md5(JSON.stringify(u.commands));r[f]?r[f].indexOf(e)===-1&&(o.buildAction(u,t),r[f].push(e)):(o.buildAction(u,t),r[f]=[e])}catch(h){h.message!="RenderNotFoundException"&&bizagi.logError("Action cannot be parsed: "+h.message,n[i])}},unbindActions:function(){var n=this;$.each(n.globalDependencies,function(n,t){t.unbind("renderchange.action")});n.globalDependencies={};$.each(n.initialCallFunctions,function(n,t){clearTimeout(t)});n.initialCallFunctions={}},refreshActions:function(n){var t=this;t.initialCallTimeout=25;t.initialCallFunctions={};n=n||[];t.actions=t.actions.concat(n);t.buildActions(t.actions,!0);$.each(t.internalSubmitActions,function(n,i){try{t.buildAction(i,!1)}catch(r){r.message!="RenderNotFoundException"&&bizagi.logError("Action cannot be parsed: "+r.message,i)}})},buildAction:function(n,t){function a(n){return["groupedgrid","collectionnavigator"].indexOf(n)===-1?!0:!1}var i=this,o=i.form,s=[],h=[],l=n.enabled!=undefined?n.enabled:!0,r,u,e,f,c;if(l){if(n.conditions&&n.conditions.operator=="true"&&(n.dependencies||(n.dependencies=[]),$.each(n.commands,function(t,r){var f=i.searchGridReferenceInXpath(r.xpath),e,u,o;if(f){for(e=!1,u=0,o=n.dependencies;u<o;u++)n.dependencies[u]==f&&(e=!0);e||n.dependencies.push(f)}})),n.dependencies)for(r=0;r<n.dependencies.length;r++)typeof n.dependencies[r]!="undefined"&&(u=o.getRenders(n.dependencies[r]),u.length==0&&(e=o.getRenderById(n.dependencies[r]),u=e?[e]:null),u&&$.each(u,function(n,t){$.inArray(t.properties.id,h)<0&&a(t.properties.type)&&(h.push(t.properties.id),s.push(t))}));(f=i.buildFunction(n.conditions,n.commands,n.elseCommands),$.each(s,function(r,u){u.bind("renderchange.action",function(t,r){if(r=r||{},r.changed=r.changed!==undefined?r.changed:!0,r.column){for(var u=0;u<n.gridColumns.length;u++)if(r.column==n.gridColumns[u]){f(i,r);return}}else f(i,r)});i.globalDependencies[u.properties.id]=u;u.properties.type=="grid"&&(t=!0,n.gridColumns=[],i.searchGridColumns(n.conditions,n.gridColumns))}),t)||(c=function(n){var t=Math.guid(),i=setTimeout(function(){try{f(n);delete n.initialCallFunctions[t]}catch(i){}},n.initialCallTimeout);n.initialCallFunctions[t]=i;n.initialCallTimeout+=n.initialCallIncrements},c(i))}},buildFunction:function(n,t,i){var e=this,c=e.searchForGridReference(n,t),o=c!=null?c:!1,a="",v="",r,h="",y=i?!1:!0,l=n?!0:!1,f,p,s,u;for(l&&(a+=e.buildConditions(n,o)),f=0;f<t.length;f++)p=e.isServerCommand(t[f])?"addParallel":"add",s=e.buildCommand(t[f],o),s=s.indexOf(";")>=1?s.replace(";",""):s,v+="actionQueue."+p+"(function(){return "+s+" ;}); \r\n",y&&(h+=e.buildRestoreCommand(t[f],o));if(!y)for(f=0;f<i.length;f++)h+=e.buildCommand(i[f],o);return r="var baTmpFn = function(self, params){ \r\n",r+="params = params || {};\r\n",o&&(r+="var i = params.key;\r\n",r+="var column = params.column;\r\n"),l&&(r+="if ("+a+"){ \r\n"),r+="var actionQueue = new bizagiQueue(); \r\n",r+="if (params.render){params.render.startActionExecution();} \r\n",r+=v,r+="actionQueue.execute().always(function(){ \r\n",r+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",l&&(r+="\r\n } ",h.length>0&&(r+="else { \r\n"+h+" }\r\n")),r+="};\r\n",o?(u="var baGridTmpFn = function(self, args){ \r\n",u+="args = args || {};\r\n",u+="if(args.surrogateKey === undefined){\r\n",u+="\t var grid = self.form.getRender('"+c+"');\r\n",u+="\t var data = grid.getIndexes();\r\n",u+="\t $.each(data, function(i, index) {\r\n",u+="\t\t args.key = index; \r\n",u+="\t\t baTmpFn(self, args);\r\n",u+="\t });\r\n",u+="} else {\r\n",u+="\t args.key = args.surrogateKey; \r\n",u+="\t baTmpFn(self, args );\r\n",u+="}\r\n",u+="};\r\n",r+=u,r+="baGridTmpFn"):r+="baTmpFn",eval(r)},isServerCommand:function(n){var t=n.command;return t=="refresh"||t=="submit-data"||t=="execute-rule"||t=="execute-interface"||t=="execute-sap"||t=="execute-connector"?!0:!1},isRecentAction:function(n,t){var i=this,r=n+"@"+t;return i.actionsHistory[r]!=null?!0:($.when(i.runAction(n,t)).done(function(){delete i.actionsHistory[r];bizagi.log("resolve "+r)}),!1)},runAction:function(n,t){var i=this,r=n+"@"+t;return i.actionsHistory[r]=new $.Deferred,setTimeout(i.actionsHistory[r].resolve,i.period),i.actionsHistory[r].promise()},buildCommand:function(n,t){var o=this,p,w,h,f,e,b,c,a,l,v;t=t||!1;var s=t,u=n.command,y=o.detectCommandArgumentType(n.argumentType,u),r=o.buildArgument(n.argument,y,t,n.xpathContext),i=n.xpath;if(n.renderId&&(i="id="+n.renderId+""),t&&i&&(i=i.replaceAll("[]","[' + i + ']")),n.xpath&&n.xpath.length>0||n.renderId&&n.renderId.length>0)switch(u){case"background-color":return n.controlType==="activityFlowButton"?"self.changeButtonBackground('"+i+"', "+r+");":"self.changeRenderBackground('"+i+"', "+r+");";case"forecolor":return n.controlType==="activityFlowButton"?"self.changeButtonForeground('"+i+"', "+r+");":"self.changeRenderForeground('"+i+"', "+r+");";case"visible":return n.controlType==="activityFlowButton"?"self.changeButtonVisibility('"+i+"', "+r+");":"self.changeRenderVisibility('"+i+"', "+r+");";case"readonly":return n.controlType==="activityFlowButton"?"self.changeButtonEditability('"+i+"', "+r+");":"self.changeRenderEditability('"+i+"', "+r+");";case"required":return"self.changeRenderRequired('"+i+"', "+r+");";case"set-value":return t&&n.argumentType=="xpath"&&n.xpathContext!=""&&(n.argument=n.xpathContext+"."+n.argument,r=o.buildArgument(n.argument,y,t)),"self.changeRenderValue('"+i+"', "+r+");";case"set-min":return"self.changeRenderMinValue('"+i+"', "+r+");";case"set-max":return"self.changeRenderMaxValue('"+i+"', "+r+");";case"calculate":return"self.executeCalculatedField('"+i+"');";case"submit-value":return"self.submitRender('"+i+"', '"+r+"');";case"clean-data":return"self.cleanRenderData('"+i+"');";case"refresh":return p=o.searchForGridReferenceInCommand(n),n.xpathContext=n.xpathContext||"",p?"self.refreshGridCell('"+i+"', '"+n.xpathContext+"');":"self.refreshControl('"+i+"', '"+n.xpathContext+"','"+u+"');";case"trigger-click":return"self.triggerClick('"+i+"');"}else switch(u){case"background-color":return"self.changeContainerBackground('"+n.container+"', "+r+");";case"visible":return"self.changeContainerVisibility('"+n.container+"', "+r+");";case"collapse":return"self.toogleContainer('"+n.container+"', "+!bizagi.util.parseBoolean(r)+");";case"set-active":return"self.changeActiveItem('"+n.container+"');";case"readonly":return"self.changeContainerEditability('"+n.container+"', "+bizagi.util.parseBoolean(r)+");";case"refresh":return n.xpathContext=n.xpathContext||"","self.refreshContainer('"+n.container+"', '"+n.xpathContext+"');"}if(u=="submit-data")return"self.submitFormData();";if(u=="execute-rule"){w=n.argument||{};h="";try{h=JSON.parse(w).guid}catch(k){}return f=n.xpathContext||"",t?(e=s+"[id=%s]","self.executeRule('"+h+"', printf('"+e+"',i) ,'"+u+"');"):"self.executeRule('"+h+"','"+f+"','"+u+"');"}if(u=="execute-interface"){b=n.argument||{};c="";try{c=JSON.parse(b).guid}catch(k){}return f=n.xpathContext||"",t?(e=s+"[id=%s]","self.executeInterface('"+c+"', printf('"+e+"',i));"):"self.executeInterface('"+c+"','"+f+"');"}if(u=="execute-sap"){l=n.argument||{};a="";try{a=JSON.parse(l).guid}catch(k){}return f=n.xpathContext||"",t?(e=s+"[id=%s]","self.executeSAPConnector('"+a+"', printf('"+e+"',i));"):"self.executeSAPConnector('"+a+"','"+f+"');"}if(u=="execute-connector"){l=n.argument||{};v="";try{v=JSON.parse(l).guid}catch(k){}return f=n.xpathContext||"",t?(e=s+"[id=%s]","self.executeConnector('"+v+"', printf('"+e+"',i));"):"self.executeConnector('"+v+"','"+f+"');"}return bizagi.log("There is no definition for commandType: "+u),""},buildRestoreCommand:function(n,t){var i=n.xpath,r=n.command;return t=t||!1,n.renderId&&(i="id="+n.renderId+""),t&&(i=i.replaceAll("[]","[' + i + ']")),i&&i.length>0?"self.restoreRender('"+i+"', '"+r+"');":"self.restoreContainer('"+n.container+"', '"+r+"');"},detectCommandArgumentType:function(n,t){if(n===undefined)return n;if(n=="const"){if(t=="background-color"||t=="forecolor")return"color";if(t=="visible"||t=="readonly"||t=="required")return"boolean";if(t=="set-value")return"text";if(t=="collapse")return"boolean";if(t=="set-active")return"number";if(t=="set-min"||t=="set-max")return"text";if(t=="calculate"||t=="refresh")return undefined;if(t=="submit-value")return"json"}else if(n=="xpath"||n=="entity")return n;return bizagi.log("There is no definition for commandType: "+t),null},restoreRender:function(n,t){var i=this,r=i.getRenders(n);if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}$.each(r,function(r,u){var f=u.originalProperties,e=f.textFormat||{};t=="background-color"&&i.changeRenderBackground(n,e.background||"");t=="forecolor"&&i.changeRenderForeground(n,e.color||"none");t=="visible"&&i.changeRenderVisibility(n,f.visible!=undefined?f.visible:!0);t=="readonly"&&i.changeRenderEditability(n,f.editable!=undefined?f.editable:!0);t=="required"&&i.changeRenderRequired(n,f.required!=undefined?f.required:!1)})},restoreContainer:function(n,t){var i=this,f=i.form,u=f.getContainer(n),r;if(u==null){i.Class.THROW_ERROR&&i.showContainerNotFoundError(xpath);return}r=u.originalProperties;t=="background-color"&&i.changeContainerBackground(n,r.backgroundColor||"none");t=="visible"&&i.changeContainerVisibility(n,r.visible!=undefined?r.visible:!0);t=="collapse"&&i.toogleContainer(n,!0);t=="readonly"&&i.changeContainerEditability(n,r.editable!=undefined?r.editable:!0)},changeRenderBackground:function(n,t){var i=this,r=i.getRenders(n);if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}$.each(r,function(r,u){if(i.isGridComponent(u,n)){var f=i.processGridXpath(n);$.when(u.ready()).done(function(){if(bizagi.util.isEmpty(f.index))for(var i=u.getIndexes(),n=0,r=i.length;n<r;n++)u.changeCellBackgroundColor(i[n],f.remainingXpath,t);else u.changeCellBackgroundColor(f.index,f.remainingXpath,t)})}else $.when(u.ready()).done(function(){u.changeBackgroundColor(t)})})},changeButtonBackground:function(n,t){var r=this,u=n.substring(3),i=r.form.getButton(u);i.css("background-image","none");i.addClass("ui-fast-transition");i[0].style.setProperty("background-color",t,"important")},changeRenderForeground:function(n,t){var i=this,r=i.getRenders(n);if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}$.each(r,function(r,u){if(i.isGridComponent(u,n)){var f=i.processGridXpath(n);$.when(u.ready()).done(function(){if(bizagi.util.isEmpty(f.index))for(var i=u.getIndexes(),n=0,r=i.length;n<r;n++)u.changeCellColor(i[n],f.remainingXpath,t);else u.changeCellColor(f.index,f.remainingXpath,t)})}else $.when(u.ready()).done(function(){u.changeColor(t)})})},changeButtonForeground:function(n,t){var i=this,r=n.substring(3),u=i.form.getButton(r);u.css("color",t,"!important")},changeRenderVisibility:function(n,t){var i=this,r=i.getRenders(n);if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}$.each(r,function(r,u){if(i.isGridComponent(u,n)){var f=i.processGridXpath(n);$.when(u.ready()).done(function(){if(bizagi.util.isEmpty(f.index))for(var i=u.getIndexes(),n=0,r=i.length;n<r;n++)u.changeCellVisibility(i[n],f.remainingXpath,t);else u.changeCellVisibility(f.index,f.remainingXpath,t)})}else $.when(u.ready()).done(function(){u.changeVisibility(t)})})},changeButtonVisibility:function(n,t){var r=this,u=n.substring(3),i=r.form.getButton(u);bizagi.util.parseBoolean(t)==!0?(i.show(),i.css("display","")):i.hide()},changeRenderEditability:function(n,t){var i=this,r=i.getRenders(n);if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}$.each(r,function(r,u){if(i.isValidRender(u))if(i.isGridComponent(u,n)){var f=i.processGridXpath(n);$.when(u.ready()).done(function(){if(bizagi.util.isEmpty(f.index))for(var i=u.getIndexes(),n=0,r=i.length;n<r;n++)u.changeCellEditability(i[n],f.remainingXpath,t);else u.changeCellEditability(f.index,f.remainingXpath,t)})}else $.when(u.ready()).done(function(){u.changeEditability(t)})})},changeButtonEditability:function(n,t){var r=this,u=n.substring(3),i=r.form.getButton(u);bizagi.util.parseBoolean(t)==!0?i.removeAttr("disabled"):i.attr("disabled","disabled")},triggerClick:function(n){var t=this,i=n.substring(3),r=t.form.getButton(i);r.trigger("click")},changeRenderRequired:function(n,t){var i=this,u=i.getRenders(n),r=[];if(u==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}$.each(u,function(n,t){bizagi.util.parseBoolean(t.properties.editable)&&r.push(t)});r.length===0&&(r=u);$.each(r,function(r,u){if(i.isValidRender(u))if(i.isGridComponent(u,n)){var f=i.processGridXpath(n);$.when(u.ready()).done(function(){if(bizagi.util.isEmpty(f.index))for(var i=u.getIndexes(),n=0,r=i.length;n<r;n++)u.changeCellRequired(i[n],f.remainingXpath,t);else u.changeCellRequired(f.index,f.remainingXpath,t)})}else $.when(u.ready()).done(function(){u.changeRequired(t)})})},changeRenderValue:function(n,t){var i=this,u=i.getRenders(n),r;if(u==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}r=[];$.each(u,function(n,t){t.properties.editable&&r.push(t)});r.length==0&&$.each(u,function(n,t){r.push(t)});$.each(r,function(r,u){if(i.isGridComponent(u,n)){var f=i.processGridXpath(n);$.when(u.ready()).done(function(){if(bizagi.util.isEmpty(f.index))for(var i=u.getIndexes(),n=0,r=i.length;n<r;n++)u.changeCellValue(i[n],f.remainingXpath,t);else u.changeCellValue(f.index,f.remainingXpath,t)})}else $.when(u.ready()).done(function(){u.asyncRenderDeferred?$.when(u.asyncRenderDeferred).done(function(){u.setDisplayValue(t)}):u.setDisplayValue(t)})})},changeRenderMinValue:function(n,t){var i=this,r=i.getRenders(n);if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}$.each(r,function(r,u){if(i.isGridComponent(u,n)){var f=i.processGridXpath(n);$.when(u.ready()).done(function(){if(bizagi.util.isEmpty(f.index))for(var i=u.getIndexes(),n=0,r=i.length;n<r;n++)u.changeCellMinValue(i[n],f.remainingXpath,t);else u.changeCellMinValue(f.index,f.remainingXpath,t)})}else $.when(u.ready()).done(function(){var n=u.properties.type;(n=="number"||n=="date"||n=="money")&&u.changeMinValue(t)})})},changeRenderMaxValue:function(n,t){var i=this,r=i.getRenders(n);if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}$.each(r,function(r,u){if(i.isGridComponent(u,n)){var f=i.processGridXpath(n);$.when(u.ready()).done(function(){if(bizagi.util.isEmpty(f.index))for(var i=u.getIndexes(),n=0,r=i.length;n<r;n++)u.changeCellMaxValue(i[n],f.remainingXpath,t);else u.changeCellMaxValue(f.index,f.remainingXpath,t)})}else $.when(u.ready()).done(function(){u.changeMaxValue(t)})})},executeCalculatedField:function(n){var t=this,i=t.getRenders(n);if(i==null){t.Class.THROW_ERROR&&t.showRenderNotFoundError(n);return}$.each(i,function(n,t){$.when(t.ready()).done(function(){t.runFormula()})})},refreshControl:function(n,t){var i=this,r=i.getRenders(n)||i.form.getContainer(n),u=new bizagiQueue;if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}return $.each(r,function(i,r){u.add(r.ready().pipe(function(){return r.refreshControl({xpath:n,xpathContext:t})}))}),u.execute()},refreshContainer:function(n,t){var i=this,r=i.form.getContainer(n);if(r==null){i.Class.THROW_ERROR&&i.showRenderNotFoundError(n);return}return $.when(r.ready()).pipe(function(){return r.refreshContainer({xpathContext:t})})},refreshGridCell:function(n,t){var i=this,f=new bizagiQueue,e=new $.Deferred,u=i.getRenders(n)||i.form.getContainer(n),r;return u==null?(i.Class.THROW_ERROR&&i.showRenderNotFoundError(n),null):(r=[],$.each(u,function(n,t){if(t.properties.editable)return r.push(t),!1}),r.length==0&&$.each(u,function(n,t){return r.push(t),!1}),r.length===0)?void 0:(i.form&&i.form.properties.xpathContext!==""&&(t=t!==""?i.form.properties.xpathContext+"."+t:i.form.properties.xpathContext),f.add(e.promise()),$.when.apply($,$.map(r,function(n){n.ready()})).done(function(){for(var f,u,c,l,o,a=r.length,s=new bizagiQueue,h=0;h<a;h++)if(f=r[h],u=i.processGridXpath(n),bizagi.util.isEmpty(u.index))for(c=f.getIndexes(),l=c.length,o=0;o<l;o++)s.addParallel(f.refreshCell({key:c[o],column:u.remainingXpath,xpathContext:t}));else s.add(f.refreshCell({key:u.index,column:u.remainingXpath,xpathContext:t}));$.when(s.execute()).done(function(){e.resolve()})}),f.execute())},submitFormData:function(n){var i=this,t=i.form;return $.when(t.ready()).pipe(function(){return t.submitData(n)})},executeRule:function(n,t,i){var r=this,u=r.form,f=n+"."+t;if(!r.isRecentAction(f,i))return $.when(u.ready()).pipe(function(){return u.executeRule({rule:n,xpathContext:t})})},executeInterface:function(n,t){var r=this,i=r.form;return $.when(i.ready()).pipe(function(){return i.executeInterface({interface:n,xpathContext:t})})},executeSAPConnector:function(n,t){var r=this,i=r.form;return $.when(i.ready).pipe(function(){return i.executeSAPConnector({guidsap:n,xpathContext:t})})},executeConnector:function(n,t){var r=this,i=r.form;return $.when(i.ready).pipe(function(){return i.executeConnector({guidConnector:n,xpathContext:t})})},submitRender:function(n){var t=this,i=t.getRender(n);if(i==null){t.Class.THROW_ERROR&&t.showRenderNotFoundError(n);return}return $.when(i.ready()).pipe(function(){return i.submitOnChange()})},cleanRenderData:function(n){var t=this,i=t.getRenders(n);if(i==null){t.Class.THROW_ERROR&&t.showRenderNotFoundError(n);return}$.each(i,function(i,r){if(t.isGridComponent(r,n)){var u=t.processGridXpath(n);$.when(r.ready()).done(function(){if(bizagi.util.isEmpty(u.index))for(var t=r.getIndexes(),n=0,i=t.length;n<i;n++)r.cleanCellData(t[n],u.remainingXpath);else r.cleanCellData(u.index,u.remainingXpath)})}else $.when(r.ready()).done(function(){r.cleanData();t.changeRenderRequired(n,r.properties.required!=undefined?r.properties.required:!1)})})},changeContainerBackground:function(n,t){var i=this,u=i.form,r=u.getContainer(n);if(r==null){i.Class.THROW_ERROR&&i.showContainerNotFoundError(n);return}$.when(r.ready()).done(function(){r.changeBackgroundColor(t)})},changeContainerVisibility:function(n,t){var i=this,u=i.form,r=u.getContainer(n);if(r==null){i.Class.THROW_ERROR&&i.showContainerNotFoundError(n);return}$.when(r.ready(!0)).done(function(){r.changeVisibility(t)})},toogleContainer:function(n,t){var r=this,u=r.form,i=u.getContainer(n);if(i==null){r.Class.THROW_ERROR&&r.showContainerNotFoundError(n);return}i.properties.type=="group"&&$.when(i.ready()).done(function(){i.toogleContainer(t)})},changeActiveItem:function(n){var i=this,r=i.form,t=r.getContainer(n);if(t==null){i.Class.THROW_ERROR&&i.showContainerNotFoundError(n);return}t.properties.type=="tabItem"&&t.loadingDeferred.resolve();$.when(t.ready()).done(function(){t.setAsActiveContainer()})},changeContainerEditability:function(n,t){var i=this,u=i.form,r=u.getContainer(n);if(r==null){i.Class.THROW_ERROR&&i.showContainerNotFoundError(n);return}$.when(r.ready()).done(function(){r.changeEditability(t)})},searchGridColumns:function(n,t){var f=this,r,u,e,i;if(typeof n=="string"||typeof n=="boolean")return null;if(n.expressions)for(u=0,e=n.expressions.length;u<e;u++)f.searchGridColumns(n.expressions[u],t);else{if(n.simple)return f.searchGridColumns(n.simple,t);if(n.complex)return f.searchGridColumns(n.complex,t);i=n.xpath||n.renderId;i&&(i&&i.indexOf("[]")>0&&(r=i.substring(i.indexOf("[]")+3),t.push(r)),n.argumentType=="xpath"&&n.argument.indexOf("[]")>0&&(r=n.argument.substring(n.argument.indexOf("[]")+3),t.push(r)))}return null},isGridComponent:function(n,t){return n.properties.type=="grid"&&t.indexOf("[")>=0},isValidRender:function(n){return["collectionnavigator"].indexOf(n.properties.type)===-1?!0:!1}});
$.Class.extend("bizagi.rendering.element",{ELEMENT_TYPE_CONTAINER:1,ELEMENT_TYPE_RENDER:2,ELEMENT_TYPE_COLUMN:3},{init:function(n){this.renderFactory=n.renderFactory;this.dataService=n.dataService;this.parent=n.parent;this.resources=bizagi.localization;this.observableElement=$("<div />");this.disposed=!1;this.initializeData(n.data);this.subscribers=[]},initializeData:function(n){var t=this;this.properties={};n&&n.properties&&(this.properties=n.properties);this.properties.xpathContext=this.getXpathContext();this.properties.idPageCache=this.getPageCache()},getXpathContext:function(){return this.parent!=undefined&&typeof this.parent.getXpathContext=="function"?this.parent.getXpathContext():""},getPageCache:function(){return this.parent!=undefined&&typeof this.parent.getPageCache=="function"?this.parent.getPageCache():""},getFormContainer:function(){if(typeof this.parent!="undefined")return this.parent.getFormContainer()},getResource:function(n){return this.resources.getResource(n)},getElementType:function(){},resize:function(){},focus:function(){if(this.properties.required){var n=$("#ui-bizagi-wp-app-render-form-content");bizagi.util.isScrolledIntoView(this.element,n)||$(this.element).attr("tabindex",-1).focus();this.element&&this.element.effect("highlight",2e3)}this.parent&&typeof this.parent.focus=="function"&&this.parent.focus()},triggerGlobalHandler:function(n,t){return this.disposed?null:this.parent?this.parent.triggerGlobalHandler(n,t):null},trigger:function(n,t){return this.disposed?null:this.observableElement?this.observableElement.trigger(n,t):null},triggerHandler:function(n,t){return this.disposed?null:this.observableElement?this.observableElement.triggerHandler(n,t):null},bind:function(n,t){return this.disposed?null:this.observableElement?this.observableElement.bind(n,t):(this.subscribers.push({event:n}),null)},unbind:function(n,t){return this.disposed?null:this.observableElement?this.observableElement.unbind(n,t):null},one:function(n,t){return this.disposed?null:this.observableElement?this.observableElement.one(n,t):(this.subscribers.push({event:n}),null)},getRenderedElement:function(){},getMode:function(){if(this.parent)return this.parent.getMode()},getParams:function(){if(this.parent)return this.parent.getParams()},getFormType:function(){var n=this,t=n.getFormContainer();return t.properties.type||"form"},ready:function(){},isReadyToSave:function(){},getCustomHandlers:function(){return null},dispose:function(){var n=this;n.disposed=!0;setTimeout(function(){n.subscribers!=null&&$.each(n.subscribers,function(t,i){n.unbind(i.event)});delete n.subscribers;n.observableElement&&n.observableElement.off();bizagi.util.dispose(n)},bizagi.override.disposeTime||50)},isDisposed:function(){return this.disposed},processFailMessage:function(n){var r=this,t=r.getFormContainer(),e=bizagi.util.isOfflineForm({context:r}),u,n,i,f;if(n.errorType==="CustomMessageException")t.validationController.clearValidationMessages(),u=bizagi.localization.getResource(n.message),t.validationController.showErrorMessage(u);else{if(n=n||{},n=typeof n=="string"?JSON.parse(n):n,i=n.type||"error",f=n.code||"code",n=n.responseText||n.message||n,i==="not-processed")return;if(i==="not-shown")return;if(e&&f==="AUTH_ERROR")return;t.validationController.clearValidationMessages();i=="alert"?t.validationController.showAlertMessage(n):t.validationController.showErrorMessage(n)}return n},startLoading:function(){},endLoading:function(){},beforeToRefresh:function(){},afterToRefresh:function(){}});
bizagi.rendering.element.extend("bizagi.rendering.container",{TYPE_QUERY_FORM:"queryForm"},{initializeData:function(n){var i=this,t;i._super(n);t=i.properties;t.uniqueId=Math.ceil(Math.random()*1e6);t.editable=typeof t.editable!="undefined"?bizagi.util.parseBoolean(t.editable):!0;t.visible=typeof t.visible!="undefined"?bizagi.util.parseBoolean(t.visible):!0;t.orientation=t.orientation||(i.parent?i.parent.properties.orientation:"ltr");this.originalProperties=JSON.parse(JSON.encode(t));this.children=[];this.childrenHash={};n.elements&&$.each(n.elements,function(n,t){t.render?i.createRenderElement(t):t.container?i.createContainerElement(t):t.form&&i.createFormElement(t)})},createRenderElement:function(n){var t=this,i=t.properties,u,r;i.editable==!1&&n.render.properties.editable!=!0&&(n.render.properties.editable=i.editable,n.render.properties.type=="grid"&&(n.render.properties.inlineEdit=!1));i.required===!1&&(n.render.properties.required=i.required);n.render.properties.retype=="duplicate"&&(u=bizagi.clone(n));r=t.renderFactory.getRender({type:n.render.properties.type,data:n.render,dataService:t.dataService,parent:t,mode:t.getMode()});t.children.push(r);n.render.properties.retype=="duplicate"&&t.processDuplicateRender(r,u);t.getFormContainer().registerRender(r)},createContainerElement:function(n){var t=this,i=t.properties,r;i.editable==!1&&(n.container.properties.editable=i.editable);i.required===!1&&(n.container.properties.required=i.required);r=t.renderFactory.getContainer({type:n.container.properties.type,data:n.container,parent:t,dataService:t.dataService,mode:t.getMode()});t.children.push(r);t.getFormContainer().registerRender(r)},createFormElement:function(n){var t=this,i=t.properties,r;i.editable==!1&&(n.container.properties.editable=i.editable);r=t.renderFactory.getContainer({type:n.form.properties.type||"form",data:n.form,parent:t,dataService:t.dataService,mode:t.getMode()});t.children.push(r)},getElement:function(){var n=this;return n.container},getElementsByType:function(n,t){t=t||[];var i=this;return $.each(i.children,function(i,r){r.properties.type==n&&t.push(r);r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.getElementsByType(n,t)}),t},processDuplicateRender:function(n,t){var r=this,i=JSON.parse(JSON.encode(t.render)),u;i.properties.displayName=i.properties.displayName+" "+r.getResource("render-text-duplicate-label-sufix");i.properties.xpath=i.properties.xpath+".clone";i.properties.isClone=!0;u=r.renderFactory.getRender({type:i.properties.type,data:i,parent:r,mode:r.getMode()});n.cloneRender=u;r.children.push(u)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_CONTAINER},render:function(){var n=this,i=n.getMode(),t;return t=n.internalRender(),n.applyContainerDefaults(),t.attr("data-container-id",n.properties.id),n.properties.tag&&t.attr("data-tag",n.properties.tag),n.params&&n.params.requestedForm&&t.addClass(n.params.requestedForm),t},internalRender:function(){var n=this,t=n.renderContainerHtml(),i=n.container=$(t);return n.postRenderContainer(i),n.container},renderContainerHtml:function(){var n=this;return n.renderingDeferred=n.renderingDeferred||new $.Deferred,this.renderContainer()},isRendered:function(){var n=this;return n.renderingDeferred?n.renderingDeferred.promise():!1},getRenderedElement:function(){return bizagi.util.isEmpty(this.container)&&alert("container hasn't been rendered!"),this.container},applyContainerDefaults:function(){var t=this,n=t.properties;n.backgroundColor&&t.changeBackgroundColor(n.backgroundColor);n.visible||t.changeVisibility(n.visible)},changeBackgroundColor:function(n){var t=this,i=t.properties;i.backgroundColor=n;$.each(t.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeBackgroundColor(n):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeBackgroundColor(n)})},changeVisibility:function(n){var t=this,i=t.properties;i.visible=bizagi.util.parseBoolean(n);i.visible?t.container.show():t.container.hide()},changeEditability:function(n){var t=this,i=t.properties;i.editable=bizagi.util.parseBoolean(n);$.each(t.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeEditability(n):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeEditability(n)})},replaceTag:function(n,t,i){bizagi.util.replaceSelector(n,t,i)},replaceChildrenTag:function(n,t){this.replaceTag(n,".children",t)},replaceChildrenHtml:function(n,t){return n.replace("{{children}}",t)},renderContainer:function(){},postRenderContainer:function(n){var t=this,r=t.properties,i=t.getMode();t.renderingDeferred&&t.renderingDeferred.resolve();t.container=n;t.executeChildrenPostRender(n);i=="execution"&&(t.configureHandlers(),t.applyPlaceHolderPolyfill());i=="design"&&t.configureDesignView();i=="layout"&&(t.configureDesignView(),t.configureLayoutView())},applyPlaceHolderPolyfill:function(){var t=this,n=window.placeHolderConfig||{};("placeholder"in $("<input>")[0]||"placeHolder"in $("<input>")[0])&&!n.forceApply||Placeholders.enable()},executeChildrenPostRender:function(n){var t=this,i=n.children();$.each(i,function(n,i){var u,r,f;i=$(i);u=Number(i.data("unique-id"));u?(r=t.childrenHash[u],r&&(f=r.getElementType(),f==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.postRenderElement(i),f==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.postRenderContainer(i))):t.executeChildrenPostRender(i)})},configureHandlers:function(){},configureDesignView:function(){},configureLayoutView:function(){},renderChildrenHtml:function(){var t=this,n="";return $.each(t.children,function(i,r){var u=r.getElementType();u==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(n+=r.renderElement());u==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(n+=r.renderContainerHtml());t.childrenHash[r.properties.uniqueId]=r}),n},collectRenderValues:function(n){var t=this;t.children&&$.each(t.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValues(n):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSent()&&i.collectData(n)})},hasChanged:function(n){var t=this;if(n=n||[],n.length)return n;t.children&&$.each(t.children,function(t,i){if(n.length||i.hasChanged(n))return!1})},collectRenderValuesQueryForm:function(n){var t=this;$.each(t.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValuesQueryForm(n):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSentQueryForm()&&i.collectDataQueryForm(n)})},firstChild:function(){return this.children[0]},getRenders:function(n,t){var i=this;return t=t||[],n.indexOf("[")>0&&(n=n.substring(0,n.indexOf("["))),$.each(i.children,function(i,r){r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.getRenders(n,t):r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&n==r.properties.xpath&&t.push(r)}),t},getRender:function(n){var r=this,i=r.getRenders(n),t=null;return $.each(i,function(n,i){i.properties.editable&&t==null&&(t=i)}),t==null&&$.each(i,function(n,i){t=i}),t},getRendersByXpath:function(n){var t=this;return t.getRenders(n)},getContainer:function(n){var t=this,i;return t.properties.id==n?this:($.each(t.children,function(t,r){if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var u=r.getContainer(n);if(u!=null)return i=u,!1}}),i)},isValid:function(n){var t=this;return $.each(t.children,function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.isValid(n):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.isValid(n))}),n.length==0},ready:function(){var n=this;return $.when(n.parent.ready(),n.isRendered())},isReadyToSave:function(){var n=this,t=$.map(n.children,function(n){return n.isReadyToSave()});return $.when.apply($,t)},getFocus:function(){var t=this,n;return $.each(t.children,function(t,i){if(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var r=i.getFocus();bizagi.util.isEmpty(r)||(n=r)}}),n},getCustomHandlers:function(){var t=this,n=t.getFormContainer();if(n)return n.getCustomHandlers()},getCustomHandler:function(n){var i=this,t=i.getCustomHandlers();if(t)return t[n]},dispose:function(){var n=this;setTimeout(function(){n.children&&$.each(n.children,function(n,t){t.dispose()})},bizagi.override.disposeTime||50);n._super()},refreshContainer:function(n){var t=this,i=t.properties;return t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||n.xpathContext,contexttype:t.properties.contexttype||""})).done(function(n){var r,i,u;t.isDisposed()||(t.unregisterChildren(),delete t.children,delete t.childrenHash,t.getFormContainer().removeActions(),t.properties.editable===!1&&(n.container&&n.container.properties?n.container.properties.editable=!1:""),t.initializeData(n.container),r=t.container,i=t.render(),t.properties.type=="tabItem"&&$(i).addClass("childrenActive"),r.replaceWith(i),u=n.container&&n.container.actions?n.container.actions:[],t.getFormContainer().refreshActions(u),t.triggerChildrenActions(),t.afterToRefresh())}).fail(function(n){n=t.processFailMessage(n)}).always(function(){t.endLoading()})},refreshDesignContainer:function(n){var t=this,i=t.properties,r,u;t.beforeToRefresh(n);$.extend(n.properties,{editable:i.editable,contexttype:i.contexttype||"",idPageCache:i.idPageCache,idRender:i.id,messageValidation:i.messageValidation,uniqueId:i.uniqueId,visible:i.visible,xpath:i.xpath,mode:"design",xpathContext:i.xpathContext||""});t.isDisposed()||(t.unregisterChildren(),delete t.children,delete t.childrenHash,t.properties.editable===!1&&(n.container&&n.container.properties?n.container.properties.editable=!1:""),t.initializeData(n.container),r=t.container,u=t.render(),t.properties.type=="tabItem"&&$(u).addClass("childrenActive"),r&&r.replaceWith(u),t.afterToRefresh())},beforeToRefresh:function(){for(var t=this,n=0;n<t.children.length;n++)t.children[n].beforeToRefresh()},afterToRefresh:function(){for(var t=this,n=0;n<t.children.length;n++)t.children[n].afterToRefresh()},triggerChildrenActions:function(){for(var n,i,r=this,e=r.getFormContainer(),u=r.children,t=0,f=u.length;t<f;t++)n=u[t],i=n.getElementType(),i===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?n.triggerChildrenActions():i===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&n.triggerRenderChange({changed:!1})},registerActions:function(n){var t=this,i=t.getFormContainer();n&&i.actionController.buildActions(n)},unregisterChildren:function(){for(var n,i,r=this,f=r.getFormContainer(),u=r.children,t=0,e=u.length;t<e;t++)n=u[t],i=n.getElementType(),i===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?n.unregisterChildren():i===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&f.unregisterRender(n)},replaceChild:function(n){for(var r,u=this,i=u.children,t=0,f=i.length;t<f;t++)if(r=i[t],r.properties.uniqueId==n.properties.uniqueId){i.splice(t,1);i.splice(t,0,n);break}},getChildById:function(n){for(var i,u=this,r=u.children,t=0,f=r.length;t<f;t++)if(i=r[t],i.properties.id==n)return i;return null}});
bizagi.rendering.container.extend("bizagi.rendering.container",{},{initializeData:function(n){this._super(n);this.containsGrid=this.countByRenderType("grid")!=0},resize:function(){var n=this,i=n.container,t=i.width();t<300||this.containsGrid!=!1&&$.each(n.children,function(n,i){$.when(i.isRendered()).done(function(){i.resize({width:t})})})},startLoading:function(){var t=this,n=t.container;n&&n.startLoading({delay:250,overlay:!0})},endLoading:function(){var t=this,n=t.container;n&&n.endLoading()},countByRenderType:function(n){for(var t,u=this,i=0,r=0;r<u.children.length;r++)t=u.children[r],t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(i+=t.countByRenderType(n)),t.properties.type==n&&i++;return i},countByRenderTypeWithParams:function(n,t){for(var i,f=this,r=0,u=0;u<f.children.length;u++)i=f.children[u],i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(r+=i.countByRenderType(n)),i.properties.type==n&&t==i.properties.height&&r++;return r},configureLayoutView:function(){var n=this,t=n.container},getChildrenSumHeight:function(n){for(var t,u,f,e=this,i=0,r=0;r<e.children.length;r++)t=e.children[r],n&&n==t.properties.type&&t.properties.height==-1||(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?(u=$(t.container).height(),i+=u!=null?u:0):t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(f=$(t.element).height(),i+=f!=null?f:0));return i},getChildreCount:function(){var n=this;return n.children.length}});
bizagi.rendering.container.extend("bizagi.rendering.form",{},{init:function(n){var i=this,r=n.data,f=bizagi.util.detectDevice(),u,t;i.rendersById={};i.rendersByXpath={};i.rendersByType={};i.idPageCache=r.pageCacheId;i.mode=n.mode||"execution";i.focus=n.focus;i.params=n;this._super(n);u="";u=f!=="desktop"?this.getResource("render-form-user-confirmation-message").replace(/<br(\/| \/)>/g,"\n"):this.getResource("render-form-user-confirmation-message");t=i.properties;t.sessionId=r.sessionId;t.displayAsReadOnly=bizagi.util.parseBoolean(r.displayAsReadOnly)||!1;t.userConfirmationMessage=t.userConfirmationMessage||u;t.orientation=t.orientation||"ltr";t.hasRule=bizagi.util.parseBoolean(t.hasRule)||!1;t.contexttype=n.contexttype||"";t.paramsRender=n.paramsRender||{};t.processPath=n.data.processPath?n.data.processPath.replaceAll("/","  &rsaquo;  "):"";t.breadCrumb=n.data.processPath?n.data.processPath.split("/"):[];this.validations=r.validations;this.actions=r.actions;i.initializeButtons(r);r.transitions&&(i.transitions=r.transitions)},initializeButtons:function(n){var t=this;t.buttons=[];n.buttons&&$.each(n.buttons,function(n,i){var r=i.button.properties;r.caption=!bizagi.util.isEmpty(r.caption)&&t.getResource(r.caption)!=r.caption?t.getResource(r.caption):r.caption;r.actions&&$.each(r.actions,function(n,t){r[t]=!0});r.ordinal=n;r.action=r.next?"next":r.submitData?"save":r.cancel?"cancel":r.back?"back":r.createnewcase?"createnewcase":r.validate?"validate":"";r.save=r.action=="save";(r.next||r.back)&&(r.routing=!0);r.hasRule&&(r.executeRule=!0);r.style=t.buildButtonStyle(r);t.properties.orientation!=="rtl"||t.properties.useCustomButtons?t.buttons.push(r):t.buttons.unshift(r)})},getParams:function(){return this.params},setParam:function(n,t){this.params&&(this.params[n]=t)},getMode:function(){return this.mode},getCustomHandlers:function(){var n=this;if(n.params)return n.params.customHandlers},registerRender:function(n){var t=this;t.rendersById[n.properties.id]=n;n.properties.xpath&&(t.rendersByXpath[n.properties.xpath]||(t.rendersByXpath[n.properties.xpath]=[]),t.rendersByXpath[n.properties.xpath].push(n));t.rendersByType[n.properties.type]||(t.rendersByType[n.properties.type]=[]);t.rendersByType[n.properties.type].push(n)},unregisterRender:function(n){var t=this,u,f,i,r;if(t.rendersById[n.properties.id]&&delete t.rendersById[n.properties.id],n.properties.xpath)if($.isArray(t.rendersByXpath[n.properties.xpath])&&t.rendersByXpath[n.properties.xpath].length>1){for(i=0,u=t.rendersByXpath[n.properties.xpath].length;i<u;i++)if(f=t.rendersByXpath[n.properties.xpath][i],f.properties.id===n.properties.id){t.rendersByXpath[n.properties.xpath].splice(i,1);break}}else delete t.rendersByXpath[n.properties.xpath];if(n.properties.type){var e=t.getRenderByType(n.properties.type),s=e.length,o=n.properties.id||n.properties.xpath;for(i=0;i<s;i++)if(r=e[i],typeof r.properties.id!="undefined"&&r.properties.id==o||typeof r.properties.xpath!="undefined"&&r.properties.xpath==o){t.rendersByType[n.properties.type].splice(i,1);break}}},getRenderById:function(n){var t=this;return t.rendersById[n]},getRenders:function(n){var t=this;return n&&n.indexOf&&n.indexOf("[")>0&&(n=n.substring(0,n.indexOf("["))),t.rendersByXpath[n]?t.rendersByXpath[n]:[]},getRenderByType:function(n){var t=this;return typeof n=="string"&&n.length>0?t.rendersByType[n]?t.rendersByType[n]:[]:[]},renderContainer:function(){var n=this,t=this.properties,r=n.renderFactory.getTemplate("form"),i="",u=$.fasttmpl(r,{buttons:n.buttons,transitions:n.transitions,uniqueId:t.uniqueId,helptext:t.helpText,mode:n.getMode(),queryForm:n.getFormType()=="queryForm",summaryForm:n.params.summaryForm||!1,globalForm:n.properties.displayAsReadOnly||!1,idCase:i,displayName:n.params.displayName||i,processPath:t.processPath,breadCrumb:t.breadCrumb,orientation:t.orientation});return n.replaceChildrenHtml(u,n.renderChildrenHtml())},postRenderContainer:function(n){var t=this,i=t.getMode();n.addClass("ui-bizagi-rendering-mode-"+i);this._super(n)},configureHandlers:function(){var n=this,i,t=n.container;t.length>1?$(t).each(function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(i=this)}):i=$(".ui-bizagi-container-complexgateway",t);n.activeTransitions={};n.processButtons(t);n.bind("ondomincluded",function(t,i){n.validationController=new bizagi.command.controllers.validation(n,n.validations,i);n.actionController=new bizagi.command.controllers.action(n,n.actions);n.readyDeferred.resolve()});$(i).find(".ui-checkbox").bind("click",function(){var t=$("label",this),i=t.data("value")||"";typeof n.activeTransitions[i]=="undefined"&&(n.activeTransitions[i]=!1);bizagi.util.parseBoolean(t.data("checked"))?(t.removeClass("ui-checkbox-state-checked"),t.removeClass("bz-check").addClass("bz-full-ball"),t.data("checked",!1),n.activeTransitions[i]=!1):(t.addClass("ui-checkbox-state-checked"),t.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),t.data("checked",!0),n.activeTransitions[i]=!0)})},configureDesignView:function(){var n=this,t=n.container;n.bind("ondomincluded",function(){n.readyDeferred.resolve()})},buildButtonStyle:function(n){var e=this,t={},r,u,f,i;n.format&&(n.format.size&&n.format.size!="0"&&(r=100+Number(n.format.size)*10+"%",t["font-size"]=r+" !important"),n.format.bold&&(t["font-weight"]="bold !important",bizagi.util.isIE()&&(t["font-family"]="'Open Sans', 'Helvetica Neue', Arial, Helvetica, sans-serif !important")),n.format.italic&&(t["font-style"]="italic !important"),(n.format.underline||n.format.strikethru)&&(u=bizagi.util.parseBoolean(n.format.strikethru)?"line-through ":"",f=bizagi.util.parseBoolean(n.format.underline)?"underline ":"",t["text-decoration"]=u+f+" !important"),n.format.background&&(t["background-color"]=n.format.background+" !important",t["background-image"]="none !important"),n.format.color&&(t.color=n.format.color+" !important"));i="";for(key in t)i+=key+":"+t[key]+";";return i},render:function(){var n=this;return n.readyDeferred||(n.readyDeferred=new $.Deferred),this._super()},ready:function(){var n=this;return n.readyDeferred.promise()},getXpathContext:function(){return this.properties.xpathContext||""},getContextType:function(){return this.properties.contexttype||""},getEndPointAction:function(){var n=this,t=n.properties;return t.formtype=="startform"?"LOADSTARTFORM":undefined},getPageCache:function(){return this.idPageCache},getFormContainer:function(){return this},processButtons:function(){var n=this,t=n.getButtons();if(t&&t.length!=0)t.on("click",function(t){t.preventDefault();t.stopImmediatePropagation();n.startLoading();var r=$(this),u=r.attr("ordinal"),i=n.buttons[u];n.lastActionButton=i;setTimeout(function(){$.when(n.processButton(i)).always(function(){n.processDefer=undefined;n.endLoading()})},100)})},preProcessButton:function(){return!0},postProcessButton:function(){return!0},processButton:function(n){var t=this,i=$.Deferred(),s=t.properties,r,u;n.routing||bizagi.chrono.initAndStart("submitForm");bizagi.chrono.init("waiting");t.validationController.clearValidationMessages();var f=t.getFormContainer(),e=$.Deferred(),o=f.getRenderByType("tabItem"),h=o.length;for(f.innerTabsLoading=!0,r=0;r<h;r++)u=o[r],u.loadingDeferred&&u.parent.container&&u.loadingDeferred.resolve();return delete f.innerTabsLoading,e.resolve(),$.when(t.ready(),e.promise()).done(function(){var u=bizagi.util.parseBoolean(n.validate)?t.validationController.performValidations():!0,r;u?((n.action==="save"||n.action=="next"||n.action=="back"||n.action=="createnewcase")&&$(document).data("auto-save",""),bizagi.util.parseBoolean(t.properties.needsUserConfirmation)&&bizagi.util.parseBoolean(n.routing)?(t.endLoading(),$.when(bizagi.showConfirmationBox(s.userConfirmationMessage,null,!1)).done(function(){t.preProcessButton(n)&&(t.triggerGlobalHandler("renderActionButton",n),$.when(t.submitForm(n)).done(function(){i.resolve()}))})):t.preProcessButton(n)&&(t.triggerGlobalHandler("renderActionButton",n),$.when(t.submitForm(n)).done(function(){$(document).trigger("FORMACTION",n);i.resolve()}).fail(function(){i.reject(arguments)}))):(t.endLoading(),n.submitData&&$.when(t.submitData()).done(function(){i.reject()}),t.validationController.expandNotificationBox());r=t.getCustomHandler("afterFormButtonClick");r&&r(n)}),i.promise()},validateForm:function(){var n=this;return n.validationController.clearValidationMessages(),n.validationController.performValidations()},saveForm:function(){var n=this,r=bizagi.util.isOfflineForm({context:n}),t=n.collectRenderValuesForSubmit(),i=null;return t.deferreds&&(i=$.when.apply($,t.deferreds),delete t.deferreds),$.when(i).pipe(function(){return n.startLoading(),n.dataService.submitData({action:"SAVE",data:t,idCase:n.params.idCase,xpathContext:n.properties.xpathContext,idPageCache:n.properties.idPageCache,isOfflineForm:r||!1}).pipe(function(){n.endLoading()})})},submitForm:function(n){var t=this,i=$.Deferred(),r=bizagi.util.isOfflineForm({context:t});return $.when(t.isReadyToSave()).done(function(){if(r){t.internalSubmitFormOffline(n);return}$.when(t.internalSubmitForm(n)).done(function(){i.resolve()}).fail(function(){i.reject(arguments)})}).fail(function(){t.endLoading();bizagi.log("The form is not saved, no changes were found");i.reject()}),i.promise()},checkWidgetsData:function(){},isComplexGatewayPainted:function(){return!1},getLastActionButton:function(){var n=this;return n.lastActionButton},internalSubmitFormOffline:function(n){var t=this,i="",u,f=bizagi.util.isOfflineForm({context:t}),r;if(f&&t.properties&&!t.properties.idPageCache&&(t.properties.idPageCache=""),(n.submitData||n.executeRule)&&(u=t.collectRenderValuesForSubmit()),t.transitions&&(r=[],$.each(this.activeTransitions,function(n,t){t?r.push(n):""}),bizagi.util.countProps(r)==0))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),t.endLoading(),"";$.when(t.dataService.submitData({action:n.action,data:u,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0,transitions:r||"",idCase:t.params.idCase,idWorkitem:t.params.idWorkitem,isOfflineForm:f||!1})).done(function(r){t.postProcessButton(r,n)&&(n.routing?(t.triggerHandler("routing",{offlineAction:n.action,idCase:t.params.idCase,idWorkitem:t.params.idWorkitem}),$(document).trigger("tryPushData.offline")):(i=bizagi.util.isValidResource("workportal-mobile-offline-form-successful")?bizagi.localization.getResource("workportal-mobile-offline-form-successful"):"Saved",bizagi.util.showNotification({text:i,type:"success"})))}).fail(function(){i=bizagi.util.isValidResource("workportal-mobile-offline-successful-fail")?bizagi.localization.getResource("workportal-mobile-offline-successful-fail"):"Not saved";bizagi.util.showNotification({text:i,type:"error"})})},internalSubmitForm:function(n){var t=this,i=$.Deferred(),u,o,r;(n.submitData||n.executeRule||n.createnewcase)&&(u=t.collectRenderValuesForSubmit());$.when(t.startLoading()).done(function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")});var s=null,f=null,e=null;if(n.executeRule&&(s=t.dataService.submitData({action:"SUBMITDATA",data:u,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0}),s.tag="submitData",u={},f=t.dataService.executeButton({idRender:n.id,xpathContext:t.properties.xpathContext||"",idPageCache:t.properties.idPageCache,prepare:!0}),f.tag="executeRule"),n.next||n.back||n.save||n.createnewcase){if(t.transitions&&(o=[],$.each(this.activeTransitions,function(n,t){t?o.push(n):""}),bizagi.util.countProps(o)==0))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),t.endLoading(),"";e=t.dataService.submitData({action:n.action,forcePlanCompletion:n.forcePlanCompletion,data:u,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0,transitions:o||"",contexttype:t.properties.contextType,surrogatekey:t.properties.surrogateKey});e.tag="performAction"}return r=[],f&&(r.push(s),r.push(f)),e&&r.push(e),bizagi.chrono.initAndStart("submitForm-ajax"),$.when(t.dataService.multiaction().execute({actions:r})).done(function(r){bizagi.chrono.stop("submitForm-ajax");t.endLoading();var u;if($.each(r,function(n,i){i.result.type=="validationMessages"&&(t.addValidationMessage(i.result.messages),u=!0)}),!u){if(!t.postProcessButton(r,n))return;n.refresh&&t.refreshForm();n.routing&&t.triggerHandler("routing",{idCase:t.params.idCase});n.createnewcase&&r.length>0&&t.triggerHandler("routing",{idCase:r[0].result.IdCase,caseNumber:r[0].result.CaseNumber})}i.resolve()}).fail(function(r,r,u){u&&u.error&&(u.error.errorType==="WaitForCompletionPlanException"||u.error.errorType==="InvalidPlanStateException"||u.error.errorType==="CustomMessageException")?(t.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(u.error.message),null,!1)).then(function(){return $.when(t.internalSubmitForm($.extend({},n,{forcePlanCompletion:!0})))}).done(function(){i.resolve()}).fail(function(){i.reject()})):(t.failHandler(u),i.reject(u))}),i.promise()},addValidationMessage:function(n,t,i,r,u){var f=this;f.validationController||(f.validationController=new bizagi.command.controllers.validation(f));typeof n=="string"?f.validationController.showValidationMessage(n,t,i,r):$.each(n,function(n,t){f.validationController.showValidationMessage(t)});f.validationController.expandNotificationBox(u)},clearValidationMessages:function(){var n=this;n.validationController&&n.validationController.clearValidationMessages()},addErrorMessage:function(n){var t=this;t.validationController.showErrorMessage(n);t.validationController.expandNotificationBox()},refreshForm:function(n){var t=this,r=t.properties,i=$.Deferred(),u;return n=n||t.getFocus(),n&&!n.id&&(n={id:n}),u={idCase:t.params.idCase||"",idWorkitem:t.params.idWorkitem||"",idTask:t.params.idTask||"",focus:n,selectedTabs:t.getSelectedTabs(),xpathContext:r.xpathContext,idPageCache:r.idPageCache,isRefresh:!0,contextType:t.getContextType()||"",action:t.getEndPointAction(),idStartScope:t.properties.idStartScope||""},t.startLoading(),$.when(t.triggerHandler("refresh",u)).done(function(){t.endLoading();i.resolve()}).fail(function(){t.endLoading();i.reject()}),i.promise()},getSelectedTabs:function(){for(var r=this,u=r.getElementsByType("tab"),t=$.map(u,function(n){return{tab:n.properties.id,selected:n.activeTab}}),i={},n=0,f=t.length;n<f;n++)i[t[n].tab]=t[n].selected;return i},getButtons:function(){},addSubmitAction:function(n,t){var i=this;i.actionController.processInternalSubmitAction(n,t)},startLoading:function(){var n=this,u=n.renderFactory.getTemplate("form-waiting"),f,t,i,r;n.waitingOverlay&&n.waitingMessage||(bizagi.util.isTabletDevice()?(n.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo("body",$(document)),n.waitingMessage=$.tmpl(u).appendTo("body",$(document))):(f=n.params.context=="sharepoint"&&typeof Windows=="undefined",t=n.params.canvas,f?(t=bizagi.util.scrollTop(t),!!t.context||(t=$("body",$(document)))):t=$("body",$(document)),i=this.getSize(),r=this.getOffset(),i.height==$(window).height()&&(r.top=0),n.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(t),n.waitingMessage=$.tmpl(u).appendTo(t),n.waitingOverlay.css({height:"100%",width:"100%","min-height":i.height,"min-width":i.width}),n.waitingMessage.css({top:r.top+Math.ceil((i.height-n.waitingMessage.outerHeight())/2)+"px",left:Math.ceil((i.width-n.waitingMessage.outerWidth())/2)+"px"}),t.css("position","relative")))},endLoading:function(){var n=this,t;n.waitingOverlay&&n.waitingMessage&&(n.waitingOverlay.remove(),n.waitingMessage.remove(),n.waitingOverlay=null,n.waitingMessage=null,t=n.params.canvas,t!=undefined&&t.css("position",""))},getFocusedElement:function(){var n=this;return n.focus},setFocusedElement:function(n){var t=this;t.focus=n},triggerGlobalHandler:function(n,t){return this.triggerHandler("globalHandler",{eventType:n,data:t})},failHandler:function(n){var i=this,t;try{n=JSON.parse(n)}catch(r){}if(n.length&&n.length>1&&(n=n[0]),n.error&&(n=n.error),typeof n=="object"&&n.message)n=n.errorType==="WaitForCompletionPlanException"||n.errorType==="InvalidPlanStateException"||n.errorType==="CustomMessageException"?bizagi.localization.getResource(n.message):n.message;else if(typeof n=="string")try{t=JSON.parse(n);(t.errorType==="WaitForCompletionPlanException"||t.errorType==="InvalidPlanStateException"||n.errorType==="CustomMessageException")&&(t.message=bizagi.localization.getResource(t.message));n=t.message}catch(r){}i.addErrorMessage(n);i.endLoading()},resize:function(n){this.setSize(n)},setSize:function(n){this.size=n},getSize:function(){if(this.size)return this.size;var n=this.params.canvas?this.params.canvas:this.getFormContainer().container,t=n.width(),i=n.height();return{width:t,height:i}},getOffset:function(){var n=this.getFormContainer().container;return n.offset()},submitData:function(){var n=this,t=n.collectRenderValuesForSubmit(),i=bizagi.util.isOfflineForm({context:n});if(i&&n.properties&&!n.properties.idPageCache&&(n.properties.idPageCache=""),$.each(t,function(t){var i=n.getRenders(t);$.each(i,function(n,t){t.updateOriginalValue()})}),!$.isEmptyObject(t))return $.when(n.dataService.multiaction().submitData({action:"SUBMITDATA",data:t,idPageCache:n.properties.idPageCache,xpathContext:n.properties.xpathContext,contexttype:n.properties.contexttype||""})).fail(function(t){t=n.processFailMessage(t)})},executeRule:function(n){var t=this,i=t.properties,r=n.xpathContext;return i.xpathContext!=""&&(r=r!=""?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeRule({idPageCache:i.idPageCache,rule:n.rule,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(n){t.getFormContainer().clearValidationMessages();n&&n.type=="validationMessages"&&t.getFormContainer().addValidationMessage.apply(t,[n.messages,undefined,undefined,undefined,!1])}).fail(function(n){n=t.processFailMessage(n)})},executeInterface:function(n){var t=this,i=t.properties,r=n.xpathContext;return i.xpathContext!=""&&(r=r!=""?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeInterface({idPageCache:i.idPageCache,interface:n.interface,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(n){t.getFormContainer().clearValidationMessages();n&&n.type=="validationMessages"&&t.getFormContainer().addValidationMessage(n.messages)}).fail(function(n){n=t.processFailMessage(n)})},executeSAPConnector:function(n){var t=this,i=t.properties,r=n.xpathContext;return i.xpathContext!=""&&(r=r!=""?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeSAPConnector({idPageCache:i.idPageCache,guidsap:n.guidsap,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(n){t.getFormContainer().clearValidationMessages();n&&n.type=="validationMessages"&&t.getFormContainer().addValidationMessage(n.messages)}).fail(function(n){n=t.processFailMessage(n)})},executeConnector:function(n){var t=this,i=t.properties,r=n.xpathContext;return i.xpathContext!=""&&(r=r!=""?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeConnector({idPageCache:i.idPageCache,guidConnector:n.guidConnector,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(n){t.getFormContainer().clearValidationMessages();n&&n.type=="validationMessages"&&t.getFormContainer().addValidationMessage(n.messages)}).fail(function(n){n=t.processFailMessage(n)})},refreshActions:function(n){var t=this;t.actionController.refreshActions(n)},removeActions:function(){var n=this;n.actionController.unbindActions()},collectRenderValuesForSubmit:function(n){var t=this;return n=n||{},t.collectRenderValues(n),$.each(n,function(n){var i=t.getRenders(n);$.each(i,function(n,t){t.updateOriginalValue()})}),n},internalSubmitOnChange:function(n){var f;n=n||{};var t=this,i=n.properties,r=new $.Deferred,u=n.data||{},e=typeof n.bRefreshForm!="undefined"?n.bRefreshForm:!0,o=n.notCollect?n.notCollect:undefined;return o&&!$.isEmptyObject(u)||t.collectRenderValuesForSubmit(u),t.startLoading(),f=null,u.deferreds&&(f=$.when.apply($,u.deferreds),delete u.deferreds),$.when(f).then(function(){t.dataService.submitData({action:"SUBMITONCHANGE",data:u,idRender:i.id,xpath:i.xpath,xpathContext:t.properties.xpathContext,idPageCache:i.idPageCache,contexttype:i.contexttype}).done(function(n){if(t.cancelPreviousRequest(),t.endLoading(),n&&n.type=="validationMessages")typeof t.clearValidationMessages=="function"&&t.clearValidationMessages(),t.addValidationMessage(n.messages),r.resolve();else if(e){var u={id:i.id,xpath:i.xpath};i.idCase!==undefined&&$.extend(u,{idCaseObject:bizagi.cache.idCaseObject});n.IdScope&&(t.properties.idStartScope=n.IdScope);$.when(t.refreshForm(u)).done(function(){r.resolve()}).fail(function(){r.resolve()})}else r.resolve()}).fail(function(n){t.endLoading();var i=JSON.parse(typeof n=="object"&&n.responseText?n.responseText:{})||{},u=i.message||n;t.validationController.clearValidationMessages();i.type=="alert"?t.validationController.showAlertMessage(u):t.validationController.showErrorMessage(u);r.resolve()})}),r.promise()},cancelPreviousRequest:function(){if(bizagi.multiactionConnection&&bizagi.multiactionConnection.length)for(var i=bizagi.multiactionConnection.length,t=0,n;t<i;t++)n=bizagi.multiactionConnection.pop(),n&&n.abort&&(bizagi.showErrorAlertDialog=!1,n.abort())},dispose:function(){var n=this;n.endLoading();setTimeout(function(){n.params&&delete n.params.canvas;delete n.params;delete n.control;n.validationController&&(n.unbind("rendervalidate"),delete n.validationController);n.actionController&&(n.actionController.unbindActions(),delete n.actionController)},bizagi.override.disposeTime||50);n._super()},getButton:function(n){var t=this;return $(".ui-bizagi-button[data-id='"+n+"']",t.container)}});
bizagi.rendering.form.extend("bizagi.rendering.formTemplate",{init:function(n){this._super(n);n.paramsRender&&n.paramsRender.contextEvent&&(self.contextEvent=n.paramsRender.contextEvent)},processTemplate:function(n,t){var i=n.replace(/\{\{(((repeater)\s*(\{["':,-\[\]\w\s]*\}))|([\/repeater]+:item)|(\/repeater)|(repeater)|(separator))\}\}/g,"");return i=i.replace(/\{\{([\w:]*)\s*(\{["':,-\[\]\w\s]*\})\}\}/g,function(n,i,r){var u=JSON.parse(r);return t[u.id]||""}),i.replace(/{{([\w:]*)\s*}}/g,function(){return""})},renderContainer:function(){var t=this,r=t.getRenderByType("layout"),n=r.length>0?r[0]:{},u=typeof n.getTemplate=="function"?n.getTemplate():"",f=typeof n.getCss=="function"?n.getCss():"",e=t.getMode(),o=t.properties.layoutguid||Math.guid(),i={};return n.children&&$.each(n.children,function(n,r){if(!(e=="execution"&&r.properties.type=="layoutPlaceholder")){var u=r.getElementType();u==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(i[r.properties.id]=r.renderElement());u==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(i[r.properties.id]=r.renderContainerHtml());t.childrenHash[r.properties.uniqueId]=r}}),bizagi.util.loadStyle(f,o),t.processTemplate(u,i)},getContextEvent:function(){return self.contextEvent}});
bizagi.rendering.container.extend("bizagi.rendering.layout",{},{getTemplate:function(){var t=this,i=t.getMode(),n=t.properties.html||"";return i=="design"&&n&&(n="<div class='bz-design-template'>"+n+"<\/div>"),bizagi.util.stripslashes(n)},getCss:function(){var t=this,n=t.properties.css||"",i=t.getMode();return i=="design"&&(n=n&&n.desktop),bizagi.util.stripslashes(n)},postRenderContainer:function(n){var t=this,r=t.properties,i=t.getMode();t.renderingDeferred&&t.renderingDeferred.resolve();t.container=n;t.executeChildrenPostRender(n);i=="execution"&&t.configureHandlers();i=="design"&&t.configureDesignView();i=="layout"&&(t.configureDesignView(),t.configureLayoutView())}});
bizagi.rendering.container.extend("bizagi.rendering.accordion",{},{initializeData:function(n){var t=this;this._super(n);$.each(t.children,function(n,t){t.properties.ordinal=n})},renderContainer:function(){var n=this,t=n.properties,i=n.renderFactory.getTemplate("accordion"),r=$.fasttmpl(i,{uniqueId:t.uniqueId});return n.replaceChildrenHtml(r,n.renderChildrenHtml())}});
bizagi.rendering.container.extend("bizagi.rendering.accordionItem",{},{renderContainer:function(){var t=this,n=this.properties,i=t.renderFactory.getTemplate("accordionItem"),r=$.fasttmpl(i,{id:n.id,ordinal:n.ordinal,displayName:n.displayName,orientation:n.orientation,uniqueId:n.uniqueId});return t.replaceChildrenHtml(r,t.renderChildrenHtml())},activate:function(){var n=this;n.active=!0},getFocus:function(){var n=this,t=n._super();return bizagi.util.isEmpty(t)&&n.active&&(t=n.properties.id),t}});
bizagi.rendering.container.extend("bizagi.rendering.group",{},{initializeData:function(n){var i=this,t;this._super(n);t=i.properties;t.helpText=t.helpText||t.displayName;t.cssclass=t.cssclass||"cssClassContainer"},renderContainer:function(){var n=this,t=this.properties,r=n.renderFactory.getTemplate("group"),i;return n.expandedIcon=n.getExpandedIcon(),n.collapsedIcon=n.getCollapsedIcon(),i=$.fasttmpl(r,{expandedClassIcon:n.expandedIcon,displayName:t.displayName,editable:t.editable,orientation:t.orientation,uniqueId:t.uniqueId,collapse:t.collapse,isDesign:n.getMode()==="design",messageValidation:t.messageValidation,cssclass:t.cssclass,guid:t.guid}),n.replaceChildrenHtml(i,n.renderChildrenHtml())},getExpandedIcon:function(){},getCollapsedIcon:function(){},toogleContainer:function(){}});
bizagi.rendering.container.extend("bizagi.rendering.horizontal",{},{renderContainer:function(){var n=this,t=this.properties,i=n.renderFactory.getTemplate("horizontal"),r=$.fasttmpl(i,{uniqueId:t.uniqueId});return n.replaceChildrenHtml(r,n.renderChildrenHtml())}});
bizagi.rendering.container.extend("bizagi.rendering.panel",{},{initializeData:function(n){var i=this,t;this._super(n);t=i.properties;t.displayName=t.displayName||""},renderContainer:function(){var t=this,n=this.properties,i=t.renderFactory.getTemplate("panel"),r=$.fasttmpl(i,{displayName:n.displayName,loading:n.loading,message:n.message,orientation:n.orientation,uniqueId:n.uniqueId,cssClass:n.cssclass});return t.replaceChildrenHtml(r,t.renderChildrenHtml())},postRenderContainer:function(n){var i=this,t=this.properties;t.height&&n.height(t.height);this._super(n)}});
bizagi.rendering.container.extend("bizagi.rendering.contentPanel",{},{initializeData:function(n){var i=this,t;this._super(n);t=i.properties;t.displayName=t.displayName||""},renderContainer:function(){var n=this,t=this.properties,i=n.renderFactory.getTemplate("contentPanel"),r=$.fasttmpl(i,{displayName:t.displayName,mode:n.getMode(),uniqueId:t.uniqueId,isDesign:n.getMode()==="design",messageValidation:t.messageValidation,cssClass:t.cssclass,guid:t.guid});return n.replaceChildrenHtml(r,n.renderChildrenHtml())},postRenderContainer:function(n){var t=this;t._super(n)}});
bizagi.rendering.form.extend("bizagi.rendering.searchForm",{},{renderContainer:function(){var n=this,t=this.properties,r=n.renderFactory.getTemplate("searchForm"),i;return t.contexttype!="entity"&&n.parent&&(t.contexttype=typeof n.parent.getContextType=="function"?n.parent.getContextType():""),i=$.fasttmpl(r,{displayName:t.displayName,uniqueId:t.uniqueId}),i=n.replaceChildrenHtml(i,n.renderChildrenHtml()),i.replace("{{result}}",n.renderResult())},performSearch:function(n){var t=this,i=t.properties;i.searchParams=n;t.submitSearch()},submitSearch:function(){var n=this;n.refreshResults()},ready:function(){var n=this;return n.parent.ready()},getRemoteData:function(n){var i=this,t=i.properties,r=new $.Deferred,u=i.collectSearchValues();return bizagi.util.isMapEmpty(u)?(bizagi.showMessageBox(this.getResource("render-search-advanced-no-filters"),this.getResource("render-form-dialog-box-search"),"error"),null):(n.rows=t.searchParams&&t.searchParams.maxRecords&&t.searchParams.maxRecords>0?t.searchParams.maxRecords:n.rows,t.searchParams&&typeof t.searchParams.maxRows!="undefined"&&(n.rows=t.searchParams.maxRows||n.rows),i.dataService.submitSearch($.extend(n,{url:t.dataUrl,idRender:t.idRender,idPageCache:t.idPageCache,idSearchForm:t.id,allowFullSearch:t.searchParams.allowFullSearch?t.searchParams.allowFullSearch:null,maxRecords:t.searchParams.maxRecords>0?t.searchParams.maxRecords:null,criteria:u})).done(function(n){t.page=n.page;t.records=n.records;t.totalPages=n.totalPages||0;n.records>1e4?(t.deviceMaxRecordsExceeded=!0,n.deviceMaxRecordsExceeded=!0):delete t.deviceMaxRecordsExceeded;r.resolve(n);i.onSearchFinished()}).fail(function(n){if(bizagi.showErrorAlertDialog=!1,n.responseText)try{var t=JSON.parse(n.responseText).message;bizagi.showMessageBox(t,"","error")}catch(i){}r.reject()}),r.promise())},collectSearchValues:function(){var r=this,t={},i;this.collectRenderValues(t);i=[];for(key in t){var u=key,f=t[key],e=r.getCriteriaOperation(r.getRender(u)),n={};bizagi.util.isEmpty(f)||(n.xpath=u,n.value=f,n.operation=e,i.push(n))}return i},getCriteriaOperation:function(n){var i=this,r=i.properties,u=n.properties.dataType,t="EQUALS";return u=="15"&&(t=r.allowFullSearch?"FULLLIKE":"LIKE"),t},renderResult:function(){},refreshResults:function(){},parseAdditionalProperties:function(n){return n==1||n==2||n==3||n==4||n==6||n==7||n==10||n==11?{type:"columnNumber"}:n==29?{type:"columnNumberScientificNotation"}:n==8?{type:"columnMoney"}:n==12||n==13?{type:"columnDate"}:n==5?{type:"columnBoolean"}:{type:"columnText"}},onSearchFinished:function(){}});
bizagi.rendering.container.extend("bizagi.rendering.tab",{},{initializeData:function(n){var i=this,t;this._super(n);t=i.properties;t.helpText=t.helpText||t.displayName;t.cssclass=t.cssclass||""},renderContainer:function(){for(var n=this,t=this.properties,r=$.map(n.children,function(n,t){return n.properties.counter=t,n.properties}),u=n.renderFactory.getTemplate("tab"),f=n.getMode(),e=$.fasttmpl(u,{id:t.id,tabs:r,mode:f,editable:t.editable,tabOrientation:t.orientation,uniqueId:t.uniqueId,cssclass:t.cssclass}),o=n.activeTab=n.getActiveTab(),i=0,s=n.children.length;i<s;i++)n.children[i].properties.loadOnDemand=i!=o;return n.replaceChildrenHtml(e,n.renderChildrenHtml())},getActiveTab:function(){var n=this,u=n.properties,i=this.getFormContainer().getParams(),e=n.getMode(),r,t,f;if(e==="execution"&&!i.isRefresh&&u.activeTab&&n.getFormContainer().setFocusedElement(u.activeTab),r=i&&i.selectedTabs?i.selectedTabs:{},r[n.properties.id]>=0)return r[n.properties.id];for(t=0,f=n.children.length;t<f;t++)if(n.children[t].containsFocusedElement())return t;return 0}});
bizagi.rendering.container.extend("bizagi.rendering.tabItem",{},{renderContainer:function(){var t=this,n=this.properties,i=t.renderFactory.getTemplate("tabItem"),r=$.fasttmpl(i,{id:n.id,uniqueId:n.uniqueId,counter:n.counter});return t.renderTabContent(r)},renderTabContent:function(n){var t=this;return t.replaceChildrenHtml(n,t.renderChildrenHtml())},activate:function(){var n=this;n.active=!0},getFocus:function(){var n=this,t=n._super();return bizagi.util.isEmpty(t)&&n.active&&(t=n.properties.id),t},containsFocusedElement:function(){var t=this,i=t.getFormContainer().getFocusedElement(),r,n;if(i&&(i.xpath?(r=t.getFormContainer().getRenders(i.xpath),$.each(r,function(t,r){r.properties.id==i.id&&r.properties.editable&&(n=r)})):n=t.getFormContainer().getContainer(i)||t.getFormContainer().getRenderById(i),n))while(n.parent){if(n.properties.id==t.properties.id||n.parent.properties.id==t.properties.id)return!0;n=n.parent}return!1}});
bizagi.rendering.element.extend("bizagi.rendering.render",{postRenderTimeout:0,maxRendersPerScreen:50,rendersExecuted:0,renderOptimization:!1,TYPE_QUERY_FORM:"queryForm",startOptimization:function(){bizagi.rendering.render.postRenderTimeout=500;bizagi.rendering.render.rendersExecuted=0;bizagi.rendering.render.renderOptimization=!1},stopOptimization:function(){bizagi.rendering.render.postRenderTimeout=0;bizagi.rendering.render.rendersExecuted=0;bizagi.rendering.render.renderOptimization=!1}},{initializeData:function(n){var i=this,r,t;i._super(n);r=i.getFormContainer();t=i.properties;t.included=typeof t.included!="undefined"?bizagi.util.parseBoolean(t.included):!1;t.uniqueId=Math.ceil(Math.random()*1e6);t.displayName=t.displayName||"";t.editable=typeof t.editable!="undefined"?bizagi.util.parseBoolean(t.editable):!0;t.visible=typeof t.visible!="undefined"?bizagi.util.parseBoolean(t.visible):!0;t.includedInResult=typeof t.includedInResult!="undefined"?bizagi.util.parseBoolean(t.includedInResult):!1;t.type=="hidden"&&(t.visible=!1);t.required=typeof t.required!="undefined"?bizagi.util.parseBoolean(t.required):!1;t.submitOnChange=typeof t.submitOnChange!="undefined"?bizagi.util.parseBoolean(t.submitOnChange):!1;t.maxLength=t.maxLength||0;t.helpText=bizagi.util.trim(t.helpText)||"";t.textFormat=t.textFormat||{};t.valueFormat=t.valueFormat||{};t.isHidden=typeof t.isHidden!="undefined"?bizagi.util.parseBoolean(t.isHidden):!1;t.visible=t.isHidden?!1:t.visible;t.color&&(t.textFormat.color=t.color);t.backgroundColor&&(t.textFormat.backgroundColor=t.backgroundColor);t.required=t.editable?t.required:!1;t.orientation=t.orientation||i.parent.properties.orientation;t.contexttype=r.params&&r.params.data&&r.params.data.contextType?r.params.data.contextType:"";i.originalProperties={textFormat:{color:t.textFormat.color,backgroundColor:t.textFormat.backgroundColor},valueFormat:{color:t.textFormat.color,backgroundColor:t.textFormat.backgroundColor},visible:t.visible,editable:t.editable,required:t.required,labelAlign:t.labelAlign};i.value=typeof t.value!="undefined"?t.value:null;i.properties.originalValue=i.value;i.properties.previousValue=i.value;i.calculateInitialLayoutProperties()},calculateInitialLayoutProperties:function(){var t=this,n=t.properties,i;n.displayType=n.displayType||"normal";n.labelAlign=n.labelAlign||t.getDefaultLabelAlign(n.displayType);n.valueAlign=n.valueAlign||t.getDefaultValueAlign(n.displayType);n.orientation=="rtl"&&(n.displayType=t.getRTLDisplayType(n.displayType),n.labelAlign=t.getRTLAlign(n.labelAlign),n.valueAlign=t.getRTLAlign(n.valueAlign));i=t.calculateRenderWidth(n.labelWidth,n.valueWidth,n.displayType);n.labelWidth=i.label;n.layoutType=="percentage"&&(n.valueWidth=i.control);n.labelWidth==0&&(n.displayType="value",n.valueWidth=i.control);n.valueWidth==0&&(n.displayType="label");n.type==="userfield"&&(n.displayType==="both"?(n.valueWidth=n.valueWidth||50,n.labelWidth=n.labelWidth||50):n.displayType==="vertical"?(n.valueWidth=100,n.labelWidth=100):(n.valueWidth=100,n.labelWidth=0))},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_RENDER},render:function(n){return this.renderElement(n)},renderElement:function(n){var i=this,t=i.properties,s=i.getFormContainer(),e,r,o;i.renderingDeferred=new $.Deferred;n=n||"render";e=i.renderFactory.getTemplate(n);r=t.displayName;typeof r=="string"&&(r=r.replaceAll("&","&amp;"),r=r.replaceAll("$","&#36;"),r=r.replaceAll("<","&lt;").replaceAll(">","&gt;"),r=r.replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;"),r=r.replaceAll("\\n","<br/>"),r=r.replaceAll("\n","<br/>"));var h=parseFloat(t.labelWidth),f=$.fasttmpl(e,{label:r,helpText:t.helpText,editable:t.editable,isExtendedText:t.type=="text"&&t.isExtended,orientation:t.orientation,uniqueId:t.uniqueId,id:t.id,xpath:t.xpath,tag:t.tag,displayOptionClass:i.getDisplayOptionClass(t.displayType),labelAlignClass:i.getAlignClass(t.labelAlign),valueAlignClass:i.getAlignClass(t.valueAlign),labelWidth:h,valueWidth:parseFloat(t.valueWidth),layoutType:t.layoutType,isDesign:i.getMode()==="design",messageValidation:t.messageValidation,printVersion:s.params.printversion,cssClass:t.cssclass||"",includedInResult:t.includedInResult,included:t.included,type:t.type,showFullRender:bizagi.util.detectDevice()!=="desktop"&&(t.type==="association"||t.type==="uploadecm"||t.type==="actionLauncher"&&bizagi.util.isTabletDevice()||t.type==="polymorphicLauncher"&&bizagi.util.isTabletDevice()||t.type==="grid"&&!bizagi.util.isTabletDevice())}),u=i.internalRenderControl();return u||(u=""),o=typeof u=="object"&&u.done,o?u.state()==="resolved"?(f=i.replaceControlHtml(f,i.resolveResult(u)),i.asyncRenderDeferred=null):(i.asyncRenderDeferred=u,f=i.replaceControlHtml(f,"")):f=i.replaceControlHtml(f,u),f},resolveResult:function(n){return bizagi.resolveResult(n)},isRendered:function(){var n=this;return n.renderingDeferred?n.renderingDeferred.promise():!1},internalRenderControl:function(){var n=this,t=n.properties;return(n.control=null,n.renderFactory.printVersion)?(t.editable=!1,n.renderControl()):t.editable?n.renderControl():n.renderReadOnly()},postRenderElement:function(n){var t=this,r=t.properties,i;t.element=n;r.submitOnChange&&t.configureSubmitOnChange();isLabelFormat=!0;i=function(n){bizagi.rendering.render.renderOptimization&&bizagi.rendering.render.rendersExecuted>bizagi.rendering.render.maxRendersPerScreen?setTimeout(function(){t.internalPostRender(n);bizagi.rendering.render.postRenderTimeout+=50},bizagi.rendering.render.postRenderTimeout):t.internalPostRender(n);bizagi.rendering.render.rendersExecuted++};t.asyncRenderDeferred?$.when(t.asyncRenderDeferred).done(function(r){var u=t.getControl();typeof t.emptyControlByAsyncRenderDeferred=="function"&&t.emptyControlByAsyncRenderDeferred();u.append(r);i(n);t.processLayout(!isLabelFormat,t.properties.valueFormat||{})}):i(n)},internalPostRender:function(n){var t=this,i=t.properties,r=t.getMode(),u=t.control=t.getControl();t.renderingDeferred&&t.renderingDeferred.resolve();i.editable?t.renderFactory.printVersion&&t.postRenderPrintVersion?t.postRenderPrintVersion():t.postRender():t.postRenderReadOnly(n);r=="execution"?t.performExecutionModeMethods():t.performDesignModeMethods();t.processLayout(isLabelFormat,t.properties.textFormat||{});t.processLayout(!isLabelFormat,t.properties.valueFormat||{})},performExecutionModeMethods:function(){var n=this,t=n.properties;n.getFormType()==n.Class.TYPE_QUERY_FORM&&n.configureHandlersQueryForm();t.editable?n.configureHandlers():n.configureHandlersReadOnly();n.internalSetInitialValue()},performDesignModeMethods:function(){var n=this,i=n.properties,t=n.getControl();t!==null&&$("input, select, button, textarea",t).attr("readonly",!0);n.configureDesignView();n.internalSetInitialValue()},replaceControlHtml:function(n,t){return n=n||"",t=t||"",n.replace("{{control}}",t)},getRenderedElement:function(){return bizagi.util.isEmpty(this.element)&&alert("render hasn't been rendered!"),this.element},internalSetInitialValue:function(){var n=this,t=n.properties;n.internalSetInitialValueFlag=!0;t.editable?bizagi.util.isEmpty(n.value)||n.setDisplayValue(n.value):bizagi.util.isEmpty(n.value)||n.setDisplayValue(n.value);n.internalSetInitialValueFlag=!1},isValid:function(n){var t=this,i=t.properties,r,s=t.grid&&t.grid.properties&&t.grid.properties.inlineAdd,u,f,e,o;if(bizagi.util.parseBoolean(i.visible)==!1||bizagi.util.parseBoolean(i.editable)==!1&&!s)return!0;if(t.setValidationMessage(""),bizagi.util.parseBoolean(i.required)){var c=t.getFormContainer(),l=t.grid?[t]:c.getRenders(i.xpath),h=!1;if($.each(l,function(n,t){if(t.hasValue()&&(t.properties.editable||s))return h=!0,!1}),!h&&!t.properties.isClone)return r=t.getResource("render-required-text").replaceAll("#label#",i.displayName),n.push({xpath:i.xpath,message:r}),!1}if(i.retype=="duplicate"){if(t.cloneRender&&t.cloneRender.getValue()!=t.getValue())return r=t.getResource("render-text-retype-error"),n.push({xpath:i.xpath,message:r}),!1}else if(i.retype=="double"&&(u=$("input",t.element),u&&u.data("oldValue"))){if(u.val()=="")return r=t.getResource("render-text-retype-error"),n.push({xpath:i.xpath,message:r}),!1;if(u.val()!=u.data("oldValue"))return r=t.getResource("render-text-retype-error"),n.push({xpath:i.xpath,message:r}),!1}return(f=t.grid&&t.grid.getColumn?t.grid.getColumn(t.properties.xpath).properties.editable:!0,i.type!="userPassword"&&i.maxLength!==undefined&&i.maxLength>0&&bizagi.util.isNumeric(i.maxLength)&&(f||!f&&t.controlValueIsChanged())&&(e=new Number(i.maxLength),o=t.getValue(),o&&o.toString().length>e))?(r=t.getResource("render-text-maxLength-error").replaceAll("#maxLength#",e),n.push({xpath:i.xpath,message:r}),!1):!0},hasValue:function(){var t=this,n=t.getValue();return n=n&&t.properties.type=="text"?n.trim():n,!bizagi.util.isEmpty(n)},postRender:function(){},postRenderReadOnly:function(){},configureHandlers:function(){},configureHandlersReadOnly:function(){},configureDesignView:function(){},processLayout:function(n,t){var i=this,r=i.properties,u;i.getControl()!=null&&(t=t||{},t.color&&i.changeColor(t.color,n),t.background&&i.changeBackgroundColor(t.background),!t.bold&&t.bold&&n||i.changeFontBold(t.bold,n),t.italic&&i.changeFontItalic(t.italic,n),t.underline&&i.changeFontUnderline(t.underline,n),t.strikethru&&i.changeFontStrikethru(t.strikethru,n),t.size&&i.changeFontSize(t.size,n),r.required=r.required!=undefined?bizagi.util.parseBoolean(r.required):!1,u=r.visible!=undefined?bizagi.util.parseBoolean(r.visible):!0,r.required&&i.changeRequired(r.required),u||i.changeVisibility(u))},setValue:function(n,t){var i=this;t=t!==undefined?t:!0;bizagi.util.identicalObjects(n,i.value)||(i.properties.previousValue=i.properties.originalValue=i.value,i.value=i.properties.value=n,i.properties.required&&i.getMode()=="execution"&&(i.checkRequired([])?i.changeRequiredLabel(!1):i.changeRequiredLabel(!0)),t&&!i.internalSetInitialValueFlag&&(i.triggerRenderChange(),i.triggerRenderValidate()))},checkRequired:function(n){var t=this,i=t.properties;return bizagi.util.parseBoolean(i.required)&&!t.hasValue()?(message=t.getResource("render-required-text").replaceAll("#label#",i.displayName),n.push({xpath:i.xpath,message:message}),!1):!0},triggerRenderChange:function(n){var t=this;n=n||{};n.changed=n.changed!==undefined?n.changed:!0;t.triggerHandler("renderchange",{render:t,changed:n.changed})},triggerRenderValidate:function(){var n=this;n.triggerHandler("rendervalidate",{render:n})},setDisplayValue:function(n){var t=this,r=t.getControl(),i;t.setValue(n,!1);t.properties.editable==!1&&t.properties.display!="check"&&(i=t.getDisplayValue(n),(typeof i=="string"||typeof i=="number")&&$(r).html("<label class='readonly-control'>"+i+"<\/label>"))},getValue:function(){return this.value},getDisplayValue:function(){return this.getValue()},getLabel:function(){bizagi.util.mustImplement("getLabel")},getControl:function(){bizagi.util.mustImplement("getControl")},getControlFiller:function(){bizagi.util.mustImplement("getControlFiller")},renderControl:function(){},setValidationMessage:function(n){var t=this;t.validationMessage=n},renderReadOnly:function(){var n=this.getValue();return typeof n=="object"?"":n},postRenderPrintVersion:function(){},changeDisplayOption:function(n){this.properties.displayType=n},getDisplayOptionClass:function(){return""},changeLabelAlign:function(n){this.properties.labelAlign=n},changeValueAlign:function(n){this.properties.valueAlign=n},getAlignClass:function(){return""},customizeRenderWidth:function(){},changeColor:function(n,t){var i=this,r=i.getControl(),u=i.getLabel(),t=typeof t!="undefined"||t!=null?t:!0;r&&u&&(n!="none"?i.properties.displayType!="value"&&t?(i.element.each(function(){this.style.setProperty("color",n,"important")}),i.getLabel().find("label").css("color",n,"!important")):(i.getElementsToStylize(i.getControl()).css("color",n,"!important"),i.getControl().find("*").each(function(t,r){i.getElementsToStylize(r).css("color",n,"!important")})):(i.element.css("color",""),i.getLabel().find("label").css("color",""),i.getControl().css("color",""),i.getControl().find("input, textarea").each(function(n,t){var r=$(t).data("originalColor")||"";i.getElementsToStylize(t).css("color",r)})))},changeBackgroundColor:function(n){var t=this,u=t.getControl(),r=t.getLabel(),i;u&&r&&(n!="none"?(t.element.each(function(){this.style.setProperty("background-color",n,"important")}),typeof r.find("label").style!="undefined"?t.getLabel().find("label").style("background-color",n,"important"):t.getLabel().find("label").css("background-color",n,"!important"),i=t.getLabel().attr("style"),i+="; background-color:"+n+"!important",t.getLabel().attr("style",i)):(t.element.css("background-color",""),t.getLabel().find("label").css("background-color",""),t.getControl().css("background-color",""),t.getControl().find("input, textarea").each(function(n,t){var i=$(t).data("originalColor")||"";$(t).css("background-color",i)})))},getFormattingLabel:function(){var n=this;return n.getLabel().find("label")},changeFontBold:function(n,t){var i=this,t=typeof t!="undefined"||t!=null?t:!0;bizagi.util.parseBoolean(n)!=!1&&t?(i.getFormattingLabel().css("font-weight","bold","!important"),i.getControl().each(function(n,t){$(t).css("font-weight","bold","!important")})):t&&i.getFormattingLabel().css("font-weight","normal","!important");t||(bizagi.util.parseBoolean(n)==!0?i.getControl().find("*").each(function(n,t){$(t).css("font-weight","bold","!important")}):(i.getControl().find("*").each(function(n,t){$(t).css("font-weight","normal","!important")}),i.getControl().css("font-weight","normal","!important")))},controlValueIsChanged:function(){var e=this,i=e.properties,t=e.getValue(),n=i.originalValue,r=i.defaultValue,u=!0,f,h,o,c,s;if($.forceCollectData)return!0;if(e.properties.type=="grid"&&e.ready().state()=="pending")return!1;if(i.type=="combo"||i.type=="queryCombo"||i.type=="list"||i.type=="queryList"||i.type=="radio"||i.type=="queryRadio"||i.type=="cascadingCombo")t&&t.length!==undefined&&(t=t[0]),n&&n.length!==undefined&&(n=n[0]),r&&r.length!==undefined&&(r=r[0]),t=t&&t.id?t.id:t,n=n&&n.id?n.id:n,r=r&&r.id?r.id:r,u=typeof r!="undefined"&&r!=null?n==t&&n!=r?!1:!0:n==t?!1:!0;else if(i.type=="boolean"||i.type=="queryBoolean"||i.type=="queryCheck")u=bizagi.util.parseBoolean(n)==bizagi.util.parseBoolean(t)?!1:!0;else if(i.type=="searchNumber")u=t?!0:!1;else if(i.type=="actionLauncher"){u=!1;f=[];try{f=typeof n=="string"?JSON.parse(n):n}catch(l){}if(h=function(n,t){var r,i,u;for(n=n||"",t=t||[],r=!1,i=0,u=t.length;i<u;i++)if(t[i].guidAction==n){r=!0;break}return r},f.length==t.length)for(o=0,c=f.length;o<c;o++)h(f[o].guidAction,t)||(u=!0);else u=!0}else if(i.type=="polymorphicLauncher"||i.type=="entityTemplate")u=n.length!=t.length?!0:JSON.encode(t)==JSON.encode(n)?!1:!0;else if(i.type=="image")u=n==null&&t.indexOf(!0)<0?!1:!0;else if(i.type=="searchList"){s={};try{s=JSON.parse(t)}catch(l){console.log("Error when detect change value on searchList control")}u=JSON.encode(n)==JSON.encode(s.value)?!1:!0}else u=n==t?!1:!0;return u},changeFontItalic:function(n,t){var i=this,t=typeof t!="undefined"||t!=null?t:!0;i.properties.displayType!="value"&&t?bizagi.util.parseBoolean(n)==!0?i.getFormattingLabel().css("font-style","italic","!important"):i.getFormattingLabel().css("font-style","normal","!important"):bizagi.util.parseBoolean(n)==!0?(t&&i.getFormattingLabel().css("font-style","italic","!important"),i.properties.editable?i.getControl().find("*").each(function(n,t){i.getElementsToStylize(t).css("font-style","italic","!important")}):i.getElementsToStylize(i.getControl()).css("font-style","italic","!important")):(t&&i.getFormattingLabel().css("font-style","normal","!important"),i.properties.editable?i.getControl().find("*").each(function(n,t){i.getElementsToStylize(t).css("font-style","normal","!important")}):i.getElementsToStylize(i.getControl()).css("font-style","normal","!important"))},changeFontUnderline:function(n,t){var i=this,f=i.properties.textFormat||{},e=i.properties.valueFormat||{},r=bizagi.util.parseBoolean(f.strikethru)?"line-through ":"",u=bizagi.util.parseBoolean(e.strikethru)?"line-through ":"",t=typeof t!="undefined"||t!=null?t:!0;bizagi.util.parseBoolean(n)==!0&&t?(i.getFormattingLabel().css("text-decoration",r+"underline","!important"),i.getControl().each(function(n,t){i.getElementsToStylize(t).css("text-decoration",r+"underline")})):t&&i.getFormattingLabel().css("text-decoration",r,"!important");i.properties.displayType!="value"&&t||(bizagi.util.parseBoolean(n)==!0?i.properties.editable?i.getControl().find("*").each(function(n,t){i.getElementsToStylize(t).css("text-decoration",u+"underline","!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",u+"underline","!important"):i.getControl().find("*").each(function(n,t){i.getElementsToStylize(t).css("text-decoration",u,"!important")}))},changeFontStrikethru:function(n,t){var i=this,f=i.properties.textFormat||{},e=i.properties.valueFormat||{},u=bizagi.util.parseBoolean(f.underline)?"underline ":"",r=bizagi.util.parseBoolean(e.underline)?"underline ":"",t=typeof t!="undefined"||t!=null?t:!0;bizagi.util.parseBoolean(n)==!0&&t?i.getFormattingLabel().css("text-decoration",u+"line-through","!important"):t&&i.getFormattingLabel().css("text-decoration",u,"!important");i.properties.displayType!="value"&&t||(bizagi.util.parseBoolean(n)==!0?i.properties.editable?i.getControl().find("*").each(function(n,t){i.getElementsToStylize(t).css("text-decoration",r+"line-through","!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",r+"line-through","!important"):i.properties.editable?i.getControl().find("*").each(function(n,t){i.getElementsToStylize(t).css("text-decoration",r,"!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",r,"!important"))},changeFontSize:function(n,t){var i=this,t=typeof t!="undefined"||t!=null?t:!0,f,u,r;n!="0"&&(f=i.getFormattingLabel(),u=100+Number(n)*10+"%",t&&f.css("font-size",u,"!important"),i.properties.displayType!="value"&&t||(r=i.getControl(),typeof r.children()=="object"&&r.children().length>0?i.getElementsToStylize(r.children()).css("font-size",u,"!important"):(i.getElementsToStylize(r).css("font-size",u,"!important"),i.properties.type.indexOf("ombo")!=-1&&n>4&&r.children(0).height(2*n+20)),i.getElementsToStylize(r.find(".ui-bizagi-render-date")).css("line-height","normal")))},getElementsToStylize:function(n){return $(n)},changeVisibility:function(n){var t=this,i=t.properties;bizagi.util.parseBoolean(n)==!0?i.type!=="hidden"&&(t.element.show(),t.element.css("display","")):t.element&&t.element.hide();i.visible=n},changeEditability:function(n){var t=this,r=t.properties,i=t.getControl();r.editable=bizagi.util.parseBoolean(n);i.empty();typeof t.internalRenderControl=="function"&&$.when(t.internalRenderControl()).done(function(n){typeof t.emptyControlByChangeEditability=="function"&&t.emptyControlByChangeEditability();i.append(n);t.postRenderElement(t.element)})},changeEditabilityCellControl:function(n,t,i){var r=this,f=r.properties,e=r.getControl(),u=r.grid.getColumn(i),o=u.getDecorated(t);f.editable=bizagi.util.parseBoolean(n);e.empty();typeof r.internalRenderControl=="function"&&$.when(r.internalRenderControl()).done(function(n){e.append(n);r.postRenderElement(r.element);f.editable&&(u.bind("rendered",function(){u.readyDeferred.resolve()}),o.bind("renderchange",function(n,i){u.changed=!0;r.grid.onCellChange(u,null,t,i)}))})},changeRequired:function(n){var t=this,r=t.properties,u=r.displayName||"",f=$("label",t.getLabel()),i=t.getControl();r.required=n;t.getMode()=="execution"&&t.checkRequired([])?t.changeRequiredLabel(!1):bizagi.util.parseBoolean(n)==!0&&r.editable?t.properties.orientation=="rtl"?i.prepend('<div class="ui-bizagi-render-control-required-rtl"><\/div>'):i.prepend('<div class="ui-bizagi-render-control-required"><\/div>'):t.properties.orientation=="rtl"?$(".ui-bizagi-render-control-required-rtl",i).remove():$(".ui-bizagi-render-control-required",i).remove();f.html(u);t.triggerRenderValidate()},changeRequiredLabel:function(n){var t=this,r=t.properties,u=r.displayName||"",f=$("label",t.getLabel()),i=t.getControl();bizagi.util.parseBoolean(n)==!0&&r.editable?t.properties.orientation=="rtl"?i.prepend('<div class="ui-bizagi-render-control-required-rtl"><\/div>'):i.prepend('<div class="ui-bizagi-render-control-required"><\/div>'):t.properties.orientation=="rtl"?$(".ui-bizagi-render-control-required-rtl",i).remove():$(".ui-bizagi-render-control-required",i).remove();f.html(u);t.triggerRenderValidate()},refreshControl:function(n){var t=this,i=t.properties,f=t.value,r=t.getFormContainer(),u=r.properties.id||"";return n=n||{},t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||n.xpathContext,idForm:u})).pipe(function(n){t.control=t.controlFiller=t.label=null;var i=t.element;return t.initializeData(n.render),$.when(t.render()).pipe(function(n){var i=$(n),r=t.postRenderElement(i);return t.properties.originalValue=t.value,i}).pipe(function(n){i.replaceWith(n);t.triggerRenderChange({changed:!1});t.afterToRefresh()})}).fail(function(n){var n=t.processFailMessage(n)}).always(function(){t.endLoading()})},refreshDesignControl:function(n){var t=this,i=t.properties,r;return t.beforeToRefresh(),t.control=t.controlFiller=t.label=null,$.extend(n.render.properties,{xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext||"form",idPageCache:i.idPageCache}),r=t.element,t.initializeData(n.render),$.when(t.render()).pipe(function(n){var i=$(n),r=t.postRenderElement(i);return t.properties.originalValue=t.value,i}).pipe(function(n){r.replaceWith(n);t.triggerRenderChange();t.beforeToRefresh()})},cleanData:function(){var n=this;n.setValue("");n.clearDisplayValue()},clearDisplayValue:function(){var n=this,t=n.getControl(),i=t.find("input");i.length>0?i.val(n.getValue()):n.properties.editable===!1&&$(t).html("<label class='readonly-control'><\/label>")},updateOriginalValue:function(){var n=this;n.properties.originalValue=n.value},collectData:function(n){var t=this,i=t.properties,u=i.xpath,r=t.getValue();t.controlValueIsChanged()&&(bizagi.util.isEmpty(u)||(bizagi.util.isEmpty(r)?r===""&&(n[i.xpath]=""):n[i.xpath]=r))},hasChanged:function(n){var t=this;return t.controlValueIsChanged()?(n.push(!0),!0):!1},configureHandlersQueryForm:function(){var n=this,t=n.element.find(".ui-bizagi-render-control-included");t.change(function(){n.properties.included=$(this).is(":checked")})},collectDataQueryForm:function(n){var r=this,i=r.properties,s=i.xpath,t=r.getValue(),f=null,o,u,e;bizagi.util.isEmpty(s)||(t!==null&&typeof t!="undefined"&&(o=typeof t.id!="undefined",f=o?bizagi.util.isEmpty(t.id)?null:[t]:t!==""?t:null),(f!==null||i.included)&&(u=r.properties.typeSearch||r.properties.rangeQuery||"NONE",u=u.toUpperCase(),e={value:f,included:r.properties.included,xpath:i.xpath,searchType:u,orderType:"NONE"},typeof i.displayXpath!="undefined"&&i.displayXpath!==""&&(e.displayXpath=i.displayXpath),n.push(e)))},canBeSent:function(){var i=this,n,t=i.properties,u=bizagi.util.parseBoolean(t.displayOnly)||!1,f=t.editable,r;if(!u&&f)return!0;if(t.isClone)return!1;if(t.xpath&&(r=i.getFormContainer(),r.getRenders(t.xpath).length==1)){if(n=$.forceCollectData?$.forceCollectData.toString():!1,$.forceCollectData=n?undefined:$.forceCollectData,i.controlValueIsChanged())return $.forceCollectData=n?bizagi.util.parseBoolean(n):$.forceCollectData,!0;$.forceCollectData=n?bizagi.util.parseBoolean(n):$.forceCollectData}return!1},canBeSentQueryForm:function(){var n=this,t=n.properties;return t.isClone?!1:!0},focus:function(n){var t=this,r,i;t.properties.visible&&(this._super(),r=$("#ui-bizagi-wp-app-render-form-content"),i=function(){var i=t.getControl(),n=t.properties.type!="grid"?$("input, select, option, textarea",i):$("input, select, option, textarea",i).first();n.length>0&&$.each(n,function(t){var i=n[t];if($(i).attr("type")!="hidden"&&$(i).css("display")!="none"&&$(i).css("visibility")!="hidden")try{bizagi.util.isIE()||bizagi.util.autoScrollBottom(r);i.focus()}catch(u){}})},$.when(t.ready()).done(function(){n>0?setTimeout(i,n):i()}))},getDefaultLabelAlign:function(n){return(n=n||"normal",n=="normal"||n=="both")?"left":n=="vertical"||n=="reversed"||n=="verticalReversed"||n=="label"||n=="value"?"left":""},getDefaultValueAlign:function(n){return(n=n||"normal",n=="normal"||n=="both")?"left":n=="vertical"?"left":n=="reversed"?"right":n=="verticalReversed"||n=="label"||n=="value"?"left":""},configureSubmitOnChange:function(){var i=this,n=i.properties,t="",r;n.editable&&(n.dependencies=n.dependencies||"all",t=n.xpath?n.submitOnChangexpathContext?n.submitOnChangexpathContext+"."+n.xpath:n.xpath:n.submitOnChangexpathContext?n.submitOnChangexpathContext+"."+n.id:n.id,r={conditions:{expressions:[{simple:{xpath:t,operator:"changes",argumentType:"const"}}]},commands:[{xpath:t,command:"submit-value",argument:n.dependencies}],dependencies:[t],elseCommands:[]},$.when(i.ready()).done(function(){var n=i.getFormContainer();n.addSubmitAction(t,r)}))},submitOnChange:function(n,t,i){var r=this,u=$.Deferred();return r.properties.contexttype!=""&&n&&(n[r.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=r.properties.contexttype),$.when(r.isReadyToSave()).done(function(){r.internalSubmitOnChange(n,t,i).done(function(){u.resolve()}).fail(function(){u.reject()})}),u.promise()},getCacheIdCase:function(){var t=this,n=t.getParams().idCase;return bizagi.cache===undefined?(bizagi.cache={},bizagi.cache.idCaseObject={idCase:n!==undefined?n:bizagi.cache.idCase!==undefined?bizagi.cache.idCase:undefined}):n!==undefined&&bizagi.cache.idCaseObject!==undefined?bizagi.cache.idCaseObject.idCase=n:n!==undefined&&bizagi.cache.idCaseObject===undefined&&(bizagi.cache.idCaseObject={},bizagi.cache.idCaseObject.idCase=n),n===undefined?bizagi.cache.idCaseObject===undefined?undefined:bizagi.cache.idCaseObject.idCase:n},internalSubmitOnChange:function(n,t,i){var u=this,f=u.getFormContainer(),r=u.properties,e={data:n,bRefreshForm:t,notCollect:i,properties:{idCase:u.getCacheIdCase(),id:r.id,xpath:r.xpath,idPageCache:r.idPageCache,contexttype:r.contexttype}};return f.internalSubmitOnChange(e)},ready:function(){var n=this;return $.when(n.parent.ready(),n.isRendered())},getCustomHandlers:function(){var t=this,n=t.getFormContainer();return n?n.getCustomHandlers():null},getCustomHandler:function(n){var i=this,t=i.getCustomHandlers();return t?t[n]:null},getRTLDisplayType:function(n){return n=="normal"||n=="both"?"reversed":n=="reversed"?"normal":n},getRTLAlign:function(n){return n=="default"||n=="left"?"right":n=="right"?"left":n},calculateRenderWidth:function(n,t,i){var r=this;if(n=t=="100"&&typeof n=="undefined"?"0":n?n!="0"?n:"50":"50%",t=t?t!="0"?t:"50":"50%",i=="normal"||i=="both"||i=="reversed"){if(n&&bizagi.util.percent2Number(n)<5&&t&&bizagi.util.percent2Number(t)<5)return{label:0,control:100};n&&!t?(n=bizagi.util.percent2Number(n),t=100-n):!n&&t?(t=bizagi.util.percent2Number(t),n=100-t):(n=bizagi.util.percent2Number(n),t=bizagi.util.percent2Number(t),n+t!=100&&(t=100-n))}else n=100,t=100;return{label:n,control:t}},getIdCase:function(){var n=this;return n.getFormContainer().params.idCase||bizagi.context.idCase},getIdWorkitem:function(){var n=this;return n.getFormContainer().params.idWorkitem||bizagi.context.idWorkitem},getidTask:function(){var n=this;return n.getFormContainer().params.idTask||bizagi.context.idTask},getSessionId:function(){var n=this;return n.getFormContainer().properties.sessionId},changeCellColor:function(n){var i=this,t=i.getControl();t&&(n!="none"?(t.css("color",n),t.find("input, textarea, label").each(function(t,i){$(i).css("color",n)})):(t.css("color",""),t.find("input, textarea, label").each(function(n,t){$(t).css("color","")})))},changeCellBackgroundColor:function(n){var f=this,t=f.getControl(),i="",r="",u;t&&(n!="none"&&(i=n,r="none"),f.properties.editable?(u=!1,t.find("input, textarea, .ui-selectmenu").each(function(n,t){t.type!="text"&&t.type!="textarea"||$(t).hasClass("ui-select-data")||(u=!0);$(t).css({"background-color":i,"background-image":r})}),u||t.closest("td").each(function(n,t){$(t).css({"background-color":i,"background-image":r})})):t.each(function(n,u){var f=$(u).hasClass("ui-bizagi-cell-readonly")?t.closest("td"):$(u);f.css({"background-color":i,"background-image":r})}))},changeCellVisibility:function(n){var i=this,r=i.properties,t=i.getControl();t&&(bizagi.util.parseBoolean(n)==!0?(t.css("visibility","visible"),t.css("display","")):t.css("visibility","hidden"));r.visible=n},changeCellRequired:function(n){var t=this,r=t.properties,i=t.getControl();i&&(bizagi.util.parseBoolean(n)==!0&&bizagi.util.isEmpty(t.value)?i.prepend('<div class="ui-bizagi-render-control-required"><\/div>'):$(".ui-bizagi-render-control-required",i).remove(),r.required=n)},startActionExecution:function(){var n=this;n.startLoading();n.actionExecutionDeferred=new $.Deferred},endActionExecution:function(){var n=this;n.endLoading();n.actionExecutionDeferred&&n.actionExecutionDeferred.resolve();delete n.actionExecutionDeferred},readyActionExecution:function(){var n=this;return n.actionExecutionDeferred?n.actionExecutionDeferred.promise():$.when(!0)},isFromCreatedRow:function(){var n=this,t;if(n.grid)for(t=n.grid.columns.length;t-->0;)if(n.grid.columns[t].properties.xpath==n.properties.xpath&&n.grid.columns[t].isNewRow==!0)return!0;return!1}});
bizagi.rendering.render.extend("bizagi.rendering.render",{},{postRender:function(){var n=this,t=n.properties;this._super();t.retype=="double"&&n.processClassicRetype();t.hint&&n.processRenderHint();t.helpText&&t.helpText.length>0&&n.showIcon("help")},postRenderReadOnly:function(){var n=this,t=n.properties;t.helpText&&t.helpText.length>0&&n.showIcon("help")},startLoading:function(){var t=this,n=t.element;n&&n.startLoading({delay:250,overlay:!0})},endLoading:function(){var t=this,n=t.element;n&&n.endLoading()},getLabel:function(){var n=this;return n.label||(n.label=$(".ui-bizagi-label",n.element||n.observableElement)),n.processLabelLineBreak(n.label),n.label},processLabelLineBreak:function(n){for(var t=n.find("label"),r=t.text(),u=/\\n/g,f,i=0;(f=u.exec(r))!==null;)i===0&&t.text(""),t.append(r.substring(i,u.lastIndex-2)),t.append($("<br/>")),i=u.lastIndex;i!==0&&t.append(r.substring(i))},getControl:function(){var n=this;return((!n.control||n.control instanceof jQuery&&n.control.length===0)&&(n.control=$(".ui-bizagi-render-control",n.element||n.observableElement)),!n.control||n.control.length==0)?null:n.control},getControlFiller:function(){var n=this;return n.controlFiller||(n.controlFiller=$(".ui-bizagi-control",n.element||n.observableElement)),n.controlFiller},setValidationMessage:function(n){var t=this;t._super(n);bizagi.util.isIE8()||$.when(t.ready()).done(function(){var r=t.element,i=$(".ui-bizagi-render-icon-error",r),u=$(".ui-bizagi-render-icon-help",r);n&&n.length>0?(t.showIcon("error"),bizagi.util.isIE9()?i.attr("data-title",n):i.attr("title",n),i.tooltip(),$(i).parent().removeClass("ui-hidden")):(t.hideIcon("error"),$(u).text()==""&&$(i).parent().addClass("ui-hidden"))})},processClassicRetype:function(){},processRenderHint:function(){var r=this,u=r.element,f=r.properties,n=$("input[type!=hidden], select",u),i,t;n&&(i=n.parent(),i)&&(i.prepend('<label class="ui-bizagi-render-hint">'+f.hint+"<\/label>"),t=$(".ui-bizagi-render-hint",u),n.focus(function(){t.addClass("focus")}),n.keypress(function(){t.addClass("has-text").removeClass("focus")}),n.blur(function(){$(this).val()==""&&t.removeClass("has-text").removeClass("focus")}),t.click(function(){n.focus()}))},getDisplayOptionClass:function(n){return n=="normal"||n=="both"?"ui-bizagi-render-display-normal":n=="vertical"?"ui-bizagi-render-display-vertical":n=="reversed"?"ui-bizagi-render-display-reversed":n=="verticalReversed"?"ui-bizagi-render-display-vertical-reversed":n=="label"?"ui-bizagi-render-display-label":n=="value"?"ui-bizagi-render-display-value":""},changeDisplayOption:function(n){var t=this,i=t.element;t._super(n);i.removeClass("ui-bizagi-render-display-normal ui-bizagi-render-display-vertical ui-bizagi-render-display-reversed").removeClass("ui-bizagi-render-display-vertical-reversed ui-bizagi-render-display-label ui-bizagi-render-display-value");i.addClass(t.getDisplayOptionClass(n))},getAlignClass:function(n){return n=="left"?"ui-bizagi-render-align-left":n=="center"?"ui-bizagi-render-align-center":n=="right"?"ui-bizagi-render-align-right":n=="justify"?"ui-bizagi-render-align-justify":""},changeLabelAlign:function(n){var t=this,i=t.getLabel();i.removeClass("ui-bizagi-render-align-left ui-bizagi-render-align-center ui-bizagi-render-align-right");i.addClass(t.getAlignClass(n));this._super(n)},changeValueAlign:function(n){var t=this,i=t.getControlFiller();i.removeClass("ui-bizagi-render-align-left ui-bizagi-render-align-center ui-bizagi-render-align-right");i.addClass(t.getAlignClass(n));this._super(n)},showIcon:function(n){var i=this,r=$(".ui-bizagi-render-icons",i.element),u=$(".ui-bizagi-render-icon-error",i.element),f=$(".ui-bizagi-render-icon-help",i.element),e=i.properties.orientation,t;r.removeClass("ui-hidden");n=="error"&&(t=u.css("display","inline-block"));n=="help"&&(t=f.css("display","inline-block"));f.is(":visible")&&u.is(":visible")?r.css("width","48px"):(f.is(":visible")||u.is(":visible"))&&r.css("width","28px");i.getControlFiller().addClass("ui-bizagi-state-show-icons");t.mouseover(function(n){if(n.preventDefault(),n.stopPropagation(),t.data("tooltip")===undefined){var i=(e=="rtl"?"left":"right")+" bottom ",u=(e=="rtl"?"right":"left")+" bottom ";t.tooltip({tooltipClass:"ui-widget-content ui-help-tooltip",position:{my:i,at:u,of:r,collision:"fit"},items:t.attr("title")?".ui-icon[title]":".ui-icon[data-title]",content:function(){var n=$(this),i=!n.hasClass("ui-bizagi-render-icon-error"),t;return n[0]&&n[0].attributes["data-title"]?n[0].attributes["data-title"].value:n[0]&&n[0].title?(t=n[0].title,n[0].title="",t):void 0}});t.tooltip("open");$(".ui-help-tooltip").css("z-index",$.ui.dialog.prototype._getMaxZindex())}})},hideIcon:function(n){var t=this,r=$(".ui-bizagi-render-icons",t.element),u=$(".ui-bizagi-render-icon-error",t.element),f=$(".ui-bizagi-render-icon-help",t.element),i;f.is(":visible")&&u.is(":visible")&&r.css("width","24px");n=="error"&&$(".ui-bizagi-render-icon-error",t.element).css("display","none");n=="help"&&$(".ui-bizagi-render-icon-help",t.element).css("display","none");i=$(".ui-bizagi-render-icons span",t.element);i.length>0&&i[0].style.display!="none"&&t.getControlFiller().removeClass("ui-bizagi-state-show-icons")}});
bizagi.rendering.render.extend("bizagi.rendering.combo",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.hasLocalData=t.data||!1;t.value=t.value&&t.value.length>0?t.value[0]:t.defaultValue&&t.defaultValue.length>0?t.defaultValue[0]:null;t.value&&t.value.id===undefined&&(t.value=null);this.value=t.value;t.hasLocalData&&(t.data=this.complementData(t.data));t.loadOnDemand=!1},renderControl:function(){var n=this,i={},t;return n.isDependant&&n.properties&&n.properties.type=="cascadingCombo"&&n.getParentCombo&&(t=n.getParentCombo().getValue(),t&&t.id&&(i[n.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t.id)),n.renderCombo(i)},renderCombo:function(n){var t=this,u=t.properties,f=t.renderFactory.getTemplate(t.getTemplateName()),i,r;return u.loadOnDemand?t.renderComboTemplate():(i=new $.Deferred,r=t.getData(n),$.when(r).done(function(n){var r=t.renderComboTemplate(n);t.properties.data=n;i.resolve(r)}).fail(function(){var n=t.renderComboTemplate({});i.resolve(n)}),i.promise())},renderComboTemplate:function(n){var t=this,i=t.properties,r=t.renderFactory.getTemplate(t.getTemplateName()),u=i.value?"":t.getResource("render-combo-empty-selection");return n=n||t.properties.data||{},$.fasttmpl(r,$.extend(t.getTemplateParams(),{id:i.id,xpath:i.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:i.idPageCache,items:n,align:i.valueAlign,value:u}))},postRenderReadOnly:function(){var t=this,n,i;t._super();n=t.getValue();i=t.getControl();t.control&&t.control.parent()&&t.control.parent().addClass("ui-bizagi-noneditable-"+t.properties.displayType);n?(n.value!=null&&typeof n.value=="boolean"&&(bizagi.util.parseBoolean(n.value)==!0?n.value=this.getResource("render-boolean-yes"):bizagi.util.parseBoolean(n.value)==!1&&(n.value=this.getResource("render-boolean-no"))),t.getResource("render-combo-empty-value")==n.value||t.getResource("render-combo-empty-selection")==n.value?i.text(""):i.text(t.formatItem(n.value))):i.text("")},getTemplateName:function(){return"combo"},showEmpty:function(){return!0},showCurrentData:function(){return!0},getData:function(n){var i=this,t=i.properties,r=new $.Deferred,u=i.getMode();return u!="execution"?i.getDummyData():(t.hasLocalData?r.resolve(t.data):t.remoteDataLoaded&&t.type!="cascadingCombo"?r.resolve(t.data):i.dataService.multiaction().getData({url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,extra:n,contexttype:i.properties.contexttype||null}).done(function(n){t.recalculate||(t.remoteDataLoaded=!0);t.data=i.complementData(n);r.resolve(t.data)}).fail(function(n){var u,t,f;n.type!="not-processed"&&(u=i.getFormContainer(),t=i.properties.displayName+": ",f=typeof n=="string"?JSON&&JSON.parse(n)||$.parseJSON(n):n,t+=f.message,u.addValidationMessage(t),r.reject(n))}),r.promise())},getDummyData:function(){var t=this,n=t.properties;return n.data?n.data:(n.data=[],n.data=t.complementData(n.data),n.data.push({id:"",value:"Item 1"}),n.data.push({id:"",value:"Item 2"}),n.data)},resetData:function(){var t=this,n=t.properties;n.hasLocalData=!1;n.data=null;n.remoteDataLoaded=!1},getDisplayValue:function(){var n=this,r=this.properties,t,i;return n.combo&&n.combo.length>0?n.getSelectedValue():(t="",i=n.getValue(),i&&(t=n.formatItem(i.value)),t)},getSelectedValue:function(){},getTemplateParams:function(){return{}},formatItem:function(n){if(n!==undefined&&n!==null){if($.isArray(n)){for(var t=0;t<n.length;t++)n[t]!=null&&typeof n[t]=="boolean"&&(bizagi.util.parseBoolean(n[t])==!0?n[t]=this.getResource("render-boolean-yes"):bizagi.util.parseBoolean(n[t])==!1&&(n[t]=this.getResource("render-boolean-no")));return n.join(" - ")}return n}return""},collectData:function(n){var i=this,r=i.properties,u=r.xpath,t=i.getValue();i.controlValueIsChanged()&&(bizagi.util.isEmpty(u)||t===null||typeof t=="undefined"||(n[r.xpath]=typeof t=="object"&&(t.id===undefined||t.id==="")?"":typeof t.id!="undefined"?t.id:""))},parseAdditionalValues:function(n){var t=this;return $.map(n,function(n){var i=n.value?t.formatItem(n.value):n,r={id:n.id,value:i};return n.hidden&&(r.hidden=!0),n})},complementData:function(n){var t=this,i=t.properties,f=!1,u,r;if($.each(n,function(n,r){r.value!==undefined&&r.value!==null?(r.value=t.formatItem(r.value),i.value&&r.id==i.value.id&&(f=!0)):r.value=""}),t.showEmpty()){for(u=!1,r=0;r<n.length;r++)if(n[r].id==""){u=!0;break}u||n.unshift({id:"",value:bizagi.localization.getResource("render-combo-empty-value")})}return i.value&&!f&&t.showCurrentData()&&n.unshift({id:i.value.id,value:i.value.value,hidden:!0}),t.parseAdditionalValues(n)},hasValue:function(){var t=this,n=t.getValue();return bizagi.util.isEmpty(n)?!1:Object.prototype.toString.apply(n)==="[object Object]"&&(bizagi.util.isEmpty(n.id)||n.id==0)?!1:!0},cleanData:function(){var n=this,t={id:"",label:""};n.setDisplayValue(t);n.setValue(t,!1)},beforeToRefresh:function(){this.column&&!this.column.comboData&&this.getData()}});
bizagi.rendering.render.extend("bizagi.rendering.collectionnavigator",{},{initializeData:function(n){var i=this,t;i._super(n);t=i.properties;t.allowAdd=typeof t.allowAdd!="undefined"?bizagi.util.parseBoolean(t.allowAdd):!0;t.withAddForm=t.withAddForm&&t.allowAdd;t.allowEdit=typeof t.allowEdit!="undefined"?bizagi.util.parseBoolean(t.allowEdit):!0;t.withEditForm=t.withEditForm&&t.allowEdit;t.allowDetail=typeof t.allowDetail!="undefined"?bizagi.util.parseBoolean(t.allowDetail):!1;t.inlineAdd=typeof t.inlineAdd!="undefined"?bizagi.util.parseBoolean(t.inlineAdd):!0;t.inlineAdd=t.inlineAdd&&t.allowAdd;t.inlineEdit=typeof t.inlineEdit!="undefined"?bizagi.util.parseBoolean(t.inlineEdit):!0;t.inlineEdit=t.inlineEdit&&t.allowEdit;t.allowDelete=typeof t.allowDelete!="undefined"?bizagi.util.parseBoolean(t.allowDelete):!0;i.orientation=i.properties.orientation||"ltr";i.data=i.properties.data;i.keys=i.data?i.getKeys(i.data.rows):[];i.pointer=0;i.totalRows=0;i.inlineAddRecords=[];i.data&&(i.totalRows=i.data.rows.length)},getKeys:function(n){var i,t,r,u;for(n=n||[],i=[],t=0,r=n.length;t<r;t++)u=n[t],i.push(u[0]);return i},renderControl:function(){var n=this,t=this.properties,i=n.renderFactory.getTemplate("collectionnavigator"),r=n.getMode(),u=$.fasttmpl(i,{uniqueId:t.uniqueId,displayName:t.displayName?t.displayName:"",id:t.id,guid:t.guid,showPreview:n.showPreview(),mode:r,orientation:n.getFormContainer().properties.orientation});return n.drawControls(u)},renderReadOnly:function(){var n=this;return n.renderControl()},drawControls:function(){},drawActions:function(){},drawControl:function(){},drawForms:function(){},drawPreview:function(){var n=this,t=n.getMode(),i=t==="execution"?"collectionnavigator-execution":"collectionnavigator-preview",r=n.renderFactory.getTemplate(i),u=$.tmpl(r);n.canvas.append(u)},hasData:function(){var n=this;return n.getTotalRows()>0},getRow:function(){var n=this;return n.keys[n.pointer]},getNextRow:function(){var n=this;return n.getTotalRows()>n.pointer+1&&(n.pointer+=1),n.getRow()},getPreviousRow:function(){var n=this;return n.pointer>0&&(n.pointer-=1),n.getRow()},getFirstRow:function(){var n=this;return n.pointer=0,n.getRow()},getLastRow:function(){var n=this;return n.pointer=n.keys.length-1,n.getRow()},getTotalRows:function(){var n=this;return n.keys.length},getIndexes:function(){var n=this;return n.properties.data.rows},setPointer:function(n){var t=this;t.pointer=n-1},isTherePendingInlineRow:function(){var n=this;return n.inlineAddRecords.length>0},addKey:function(n){var t=this;t.keys.push(n)},removeKey:function(){var n=this,i=n.pointer,t;i>=0&&(n.keys.splice(i,1),t=n.getTotalRows(),t>0&&i>=t&&n.setPointer(t))},showPreview:function(){var n=this,t=n.getMode(),i=n.properties;return t=="execution"?!n.hasData():!bizagi.util.parseBoolean(i.navigationform)},getParameters:function(n){var r=this,t={},i=r.properties,u=i.xpath+"[id="+n.id+"]";return t.idRender=i.id,t.recordXPath=u,t.xpathContext=i.xpathContext,t.idPageCache=i.idPageCache,t.requestedForm=n.requestedForm,t.contextType=i.contextType||i.contexttype,t.url=n.url,t.editable=n.editable,i.orientation||"ltr",t},submitAddRequest:function(){var t=this,n=t.properties,i=t.dataService.addGridRecord({url:n.addUrl,idRender:n.id,xpath:n.xpath,xpathContext:n.xpathContext,contexttype:n.contextType||n.contexttype,idPageCache:n.idPageCache,orientation:n.orientation||"ltr"}),r=i.pipe(function(n){return n.idEntity});return r.promise()},submitEditRequest:function(n){var i=this,t=i.properties,r=t.xpath+"[id="+n+"]";return i.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:r,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType||t.contexttype||"",orientation:t.orientation||"ltr"})},submitDeleteRequest:function(n){var i=this,t=i.properties,r=t.xpath+"[id="+n+"]";return i.dataService.deleteGridRecord({url:t.deleteUrl,idRender:t.id,xpath:r,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType||t.contexttype}).pipe(function(n){if(n.type=="validationMessages"){var t=i.getFormContainer(),r=n.messages.join(" ");t.failHandler({message:r})}return n})},submitSaveRequest:function(n,t){var r=this,i=r.properties,u=i.xpathContext.length>0?i.xpathContext+"."+i.xpath+"[id="+n+"]":i.xpath+"[id="+n+"]";return r.dataService.saveGridRecord({url:i.saveUrl,idRender:i.id,xpath:i.xpath,xpathContext:u,contexttype:i.contextType||i.contexttype||"",submitData:t}).fail(function(n){var i=r.getFormContainer(),t=n.responseText?n.responseText:typeof n=="string"?n:n.toString();if(typeof t=="string")try{t=JSON.parse(t).message}catch(u){t=t.match(/"message":(.*)",/)[0];t=t.substr(11,t.length-13)}else t.message||(t=n);i.validateForm();i.clearValidationMessages();i.addValidationMessage(t)})},submitRollbackRequest:function(){var t=this,n=t.properties;return t.dataService.rollbackGridAction({url:n.rollbackUrl,idRender:n.id,xpath:n.xpath,xpathContext:n.xpathContext,idPageCache:n.idPageCache,contexttype:t.properties.contexttype||""})},getRemoteData:function(n){var i=this,t=i.properties;return n=n||{},$.extend(n,{url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache}),i.dataService.getData(n)}});
bizagi.rendering.render.extend("bizagi.rendering.check",{},{initializeData:function(n){this._super(n);var t=this.properties;t.value=typeof t.value!="undefined"?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("check"),i=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(t,{id:i})},renderReadOnly:function(){var n=this;return n.renderControl()},postRender:function(){var n=this,t=n.getControl();n._super();n.input=t.find("label")},getDisplayValue:function(){var t=this,n=t.getValue();return bizagi.util.parseBoolean(n)==!0?this.getResource("render-boolean-yes"):bizagi.util.parseBoolean(n)==!1?this.getResource("render-boolean-no"):""},hasValue:function(){var n=this,t=n.getValue(),i;return bizagi.util.isEmpty(t)?!1:(i=bizagi.util.parseBoolean(t),i===!1&&n.properties.required?!1:!0)}});
bizagi.rendering.render.extend("bizagi.rendering.number",{},{initializeData:function(n){var r=this,t,i;this._super(n);t=this.properties;i=this.getResource("numericFormat");t.allowDecimals=typeof t.allowDecimals!="undefined"?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType);t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0;t.symbol="";t.positiveFormat=i.positiveFormat;t.negativeFormat=i.negativeFormat;t.decimalSymbol=typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol;t.digitGroupSymbol=typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol;t.groupDigits=this.setGroupDigits();t.colorize=t.colorizeOnNegative||!1;t.dataTypeMinValue=this.calculateMinValue(t.dataType);t.dataTypeMaxValue=this.calculateMaxValue(t.dataType)},renderControl:function(){var i=this,r=i.renderFactory.getTemplate("number"),n=bizagi.util.detectDevice(),t={};return n!=="desktop"&&(t={type:n.indexOf("android")!==-1?"tel":"text"}),$.fasttmpl(r,t)},postRender:function(){var n=this,t,i;n._super();t=n.getControl();i=n.properties;n.numericInput=t.find("input");n.numericInput.numeric(n.properties.decimalSymbol);n.attachFormatCurrency();i.retype=="double"&&n.attachRetypeDouble()},removeValidations:function(){var n=this,t=n.getFormContainer().parent||n.getFormContainer();n.setValue("");n.numericInput.val("");t.clearValidationMessages()},attachRetypeDouble:function(){},attachFormatCurrency:function(){var t=this,n=t.properties,i=bizagi.localization.getResource("render-number-retype-fail"),r=t.getControl();$.formatCurrency.regions[bizagi.language]==null&&($.formatCurrency.regions[bizagi.language]=this.getResource("numericFormat"));t.numericInput.blur(function(){var r,e;typeof t.getFormContainer().validationController=="undefined"&&(t.getFormContainer().validationController=new bizagi.command.controllers.validation(t.getFormContainer(),t.validations));var s=t.getFormContainer().validationController||t.getFormContainer().parent.validationController,f=".",h=",";typeof BIZAGI_DEFAULT_CURRENCY_INFO=="undefined"?(f=t.getResource("numericFormat").decimalSymbol||".",h=t.getResource("numericFormat").digitGroupSymbol||","):(f=BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,h=BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator);n.percentage&&t.numericInput.val(t.numericInput.val().replace("%",""));r=t.numericInput.val();r=f==","?r.replace(/\,0+$/,""):r.replace(/\.0+$/,"");r=r.replace(n.symbol,"");r=bizagi.util.replaceAll(r,h,"");r.toString().indexOf(f)!=-1&&(f==","&&(r=r.replace(/([0-9]+(\,[0-9]+[1-9])?)(\,?0+$)/,"$1")),f=="."&&(r=r.replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1")));r!=undefined&&r.length>0&&t.numericInput.val(r);var o=r.replace(/[^0-9]+/g,"").length,c=t.properties.xpath,u=t.numericInput.val();if(t.isInvalidFormat!=null&&t.isInvalidFormat==!0||["$","","","",n.symbol].indexOf(r)!=-1){t.setValue("");t.getControl().find("input").val("");t.numericInput.val("");return}if(bizagi.util.trim(r)==""){t.setValue("");return}if(i=n.dataTypeMinValue!==undefined&&n.dataTypeMinValue!==null&&parseFloat(r)<n.dataTypeMinValue?bizagi.localization.getResource("render-numeric-minimum-validation").replaceAll("#label#",n.displayName+" ("+u+")").replaceAll("#minValue#",n.dataTypeMinValue.toString()):n.dataTypeMaxValue!==undefined&&n.dataTypeMaxValue!==null&&parseFloat(r)>n.dataTypeMaxValue?bizagi.localization.getResource("render-numeric-maximum-validation").replaceAll("#label#",n.displayName+" ("+u+")").replaceAll("#maxValue#",n.dataTypeMaxValue.toString()):i+" "+u+"",n.dataTypeMinValue!==undefined&&n.dataTypeMinValue!==null&&parseFloat(r)<n.dataTypeMinValue||n.dataTypeMaxValue!==undefined&&n.dataTypeMaxValue!==null&&parseFloat(r)>n.dataTypeMaxValue||t.properties.dataType==10&&o>15||t.properties.dataType==1&&o>19||t.properties.dataType==11&&o>7||t.properties.dataType==11&&o>7||u.match(/[^$,-.()\d]/)){typeof s!="undefined"&&s!=null&&(t.removeValidations(),e=i,e.indexOf(u)===-1&&(e=i+" "+u+""),s.showValidationMessage(e,c),t.isValidRender=!1,t.isValidRenderMessage=e);i=i.replace(u,"");return}t.isValidRender=!0;this.value.toString().length>0&&!n.allowDecimals&&!n.groupDigits?(this.value=this.value.toString().replace(/^0+/,""),n.symbol.length>0&&(this.value=this.value.toString().replace(n.symbol+"0",n.symbol)),this.value=this.value.toString().replace(/^0+/,""),this.value.replaceAll("0","").length==0?this.value=n.symbol+"0":this.value.toString()==parseInt(this.value)&&(this.value=n.symbol+this.value)):(t.properties.type==="money"||t.properties.type==="number"||t.properties.type==="columnMoney"||t.properties.type==="columnNumber")&&(this.value=this.value.toString().replace(/^0+/,""),this.value===""&&(this.value=0));t.executeFormatCurrencyPlugin();t.setValue(t.numericInput.asNumber({symbol:n.symbol,positiveFormat:n.positiveFormat,negativeFormat:n.negativeFormat,decimalSymbol:n.decimalSymbol,digitGroupSymbol:n.digitGroupSymbol,groupDigits:n.groupDigits}));n.percentage&&t.numericInput&&t.numericInput.val().indexOf("%")==-1&&t.numericInput.val(t.numericInput.val()+"%");i=i.replace(u,"")}).bind("paste",function(i){try{var u=bizagi.util.isIE()||bizagi.util.isIE11()?window.clipboardData.getData("text"):i.originalEvent.clipboardData.getData("Text"),r="/[^0-9";n.decimalSymbol.length>0&&(r+=n.decimalSymbol);n.dataType==8&&(n.symbol.length>0&&(r+=n.symbol),n.digitGroupSymbol.length>0&&(r+=n.digitGroupSymbol));r+="\\-\\s]/gi";try{u.replace(eval(r),"").length!=u.length&&i.preventDefault()}catch(i){}}catch(i){bizagi.log("Error to pasting content");t.isInvalidFormat=!0}}).keydown(function(i){var u,r;t.previousValue=this.value;i=window.event&&window.event.preventDefault?window.event:i;u=i.charCode||i.keyCode;typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"&&BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits==0&&(n.allowDecimals=!1);(n.dataType<5||n.dataType==8&&n.allowDecimals==!1)&&(u==188||u==190||u==110)&&i.preventDefault();this.value&&i!==undefined&&this.value.length>0&&n.dataType==8&&(u>47&&u<58?(t.formatTimeout&&clearTimeout(t.formatTimeout),r=this.value+"",n.digitGroupSymbol&&n.digitGroupSymbol.length>0&&(r=r.replaceAll(n.digitGroupSymbol,"")),n.symbol.length>0&&(r=r.replaceAll(n.symbol,"")),r=$.trim(r),n.decimalSymbol&&n.decimalSymbol.length>0&&(r=r.replaceAll(n.decimalSymbol,".")),r*10>n.dataTypeMaxValue&&i.preventDefault()):(u==109||u==189)&&(this.value=n.symbol+"-"+this.value.replace(n.symbol,"")))}).keyup(function(n){n=window.event||n;var t=n.charCode||n.keyCode;if(n!==undefined)switch(t){case 27:this.value=""}}).keypress(function(t){var i,r;t=window.event&&window.event.preventDefault?window.event:t;i=t.charCode||t.keyCode;typeof t!="undefined"&&(i==35||i==37||i==39?t.preventDefault():n.dataType!=8&&i==36&&t.preventDefault(),r=String.fromCharCode(i),n.allowDecimals===!1&&n.numDecimals===0&&r===n.decimalSymbol&&t.preventDefault())})},executeFormatCurrencyPlugin:function(){var i=this,n=i.properties,t,u,r;i.numericInput&&i.numericInput.formatCurrency({symbol:n.symbol,positiveFormat:n.positiveFormat,negativeFormat:n.negativeFormat,decimalSymbol:n.decimalSymbol,digitGroupSymbol:n.digitGroupSymbol,groupDigits:n.groupDigits,roundToDecimalPlace:n.numDecimals,colorize:n.colorize});n.dataType!=8&&bizagi.override.removeTrailingZeros===!0&&(t=i.numericInput.val(),u=!0,t.indexOf(")")!=-1&&(u=!1,t=t.replace("(","").replace(")","")),r=new RegExp("("+n.decimalSymbol+"\\d*?[1-9])0+$","g"),t=t.replace(r,"$1"),r=new RegExp("\\"+n.decimalSymbol+"0+$","g"),t=t.replace(r,""),i.numericInput.val(t),u||i.numericInput.val("("+t+")"));n.percentage&&i.numericInput.val(i.numericInput.val()+"%")},getDisplayValue:function(){var r=this,n=r.properties,e=r.getControl(),t=r.getValue()!==undefined?r.getValue():$("input",e).val()||"",i=$("<label/>").html(t),f,u;return(i.formatCurrency({symbol:n.symbol,positiveFormat:n.positiveFormat,negativeFormat:n.negativeFormat,decimalSymbol:n.decimalSymbol,digitGroupSymbol:n.digitGroupSymbol,groupDigits:n.groupDigits,roundToDecimalPlace:n.numDecimals,colorize:n.colorize}),n.percentage&&(i=$("<label/>").html(i.text()+"%")),n.editable==!1&&n.dataType!=8&&bizagi.override.removeTrailingZeros===!0)?(t=i.text(),f=!0,t.toString().indexOf(")")!=-1&&(f=!1,t=t.replace("(","").replace(")","")),u=new RegExp("("+n.decimalSymbol+"\\d*?[1-9])0+$","g"),t=t.replace(u,"$1"),u=new RegExp("\\"+n.decimalSymbol+"0+$","g"),t=t.replace(u,""),f||(t="("+t+")"),t):i.text()},isValid:function(n){var i=this,t=i.properties,u=this._super(n),r=i.getValue(),o=i.getDisplayValue(),f,e;return typeof r=="string"&&r!=""&&(r=Number(r)),i.hasValue()&&(bizagi.util.isEmpty(t.minValue)||r<t.minValue&&(f=this.getResource("render-numeric-minimum-validation").replaceAll("#label#",t.displayName.toString()).replaceAll("#minValue#",t.minValue.toString()),n.push({xpath:t.xpath,message:f}),u=!1),bizagi.util.isEmpty(t.maxValue)||r>t.maxValue&&(f=this.getResource("render-numeric-maximum-validation").replaceAll("#label#",t.displayName.toString()).replaceAll("#maxValue#",t.maxValue.toString()),n.push({xpath:t.xpath,message:f}),u=!1)),i.isValidRender===!1&&(u=!1,e=i.isValidRenderMessage?i.isValidRenderMessage:"error",n.push({xpath:t.xpath,message:e})),u},getDefaultAllowDecimals:function(n){if(n){if(n==1||n==2||n==3||n==4||n==7)return!1;if(n==6||n==8||n==10||n==11)return!0}return!1},getDefaultGroupDigits:function(n){if(n){if(n==1||n==2||n==3||n==4||n==7)return!1;if(n==6||n==8||n==10||n==11)return!0}return!1},setGroupDigits:function(){var n=this;return typeof n.properties.thousands!="undefined"?n.properties.digitGroupSymbol?bizagi.util.parseBoolean(n.properties.thousands):!1:n.properties.digitGroupSymbol?this.getDefaultGroupDigits(n.properties.dataType):!1},calculateMinValue:function(n){return n==8?-922337203685477:n==4?0:n==3?-32768:n==2?-2147483648:n==1?-999999999999999:null},calculateMaxValue:function(n){return n==8?922337203685477:n==4?255:n==3?32767:n==2?2147483647:n==1?999999999999999:null},changeMinValue:function(n){var t=this;t.properties.minValue=t.properties.dataTypeMinValue=Number(n)||t.calculateMinValue(t.properties.dataType)},changeMaxValue:function(n){var t=this;t.properties.maxValue=t.properties.dataTypeMaxValue=Number(n)||t.calculateMaxValue(t.properties.dataType)}});
bizagi.rendering.render.extend("bizagi.rendering.numberScientificNotation",{initializeData:function(n){var i=this,t;this._super(n);t=i.properties;t.decimalSymbol=typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:format.decimalSymbol},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("numberScientificNotation");return $.fasttmpl(t,{})},postRender:function(){var n=this,t=n.getControl();n.numericInput=t.find("input");n.numericInput.numericSN(n.properties.decimalSymbol)},getDisplayValue:function(){var n=this;return n.getValue().replace(".",n.properties.decimalSymbol)},setValue:function(n){var t=this;n=(n||"").toString().replace(t.properties.decimalSymbol,".");t._super(n)},controlValueIsChanged:function(){var n=this,t=n.properties,i=n.getValue()||"",r=t.originalValue||"";return $.forceCollectData?!0:r.toLowerCase()==i.toLowerCase()?!1:!0}});
bizagi.rendering.render.extend("bizagi.rendering.date",{},{initializeData:function(n){var r=this,i,u;this._super(n);var t=this.properties,f=this.getResource("dateFormat"),e=this.getResource("timeFormat");t.displayValue="";t.showTime=t.showTime!==undefined?bizagi.util.parseBoolean(t.showTime):!1;t.dateFormat=t.dateFormat||f;t.timeFormat=t.timeFormat||e;t.fullFormat=t.dateFormat;t.showTime&&t.fullFormat.search(/[h|H]+/ig)===-1&&(t.fullFormat=t.fullFormat+" "+t.timeFormat);t.value&&(i=bizagi.util.dateFormatter.getDateFromInvariant(t.value,t.showTime),i!=0?(r.value=t.value,u=bizagi.localization.getResource("datePickerRegional"),t.displayValue=bizagi.util.dateFormatter.formatDate(i,t.fullFormat,u)):r.value=null)},renderControl:function(){var i=this,n=i.properties,r=i.renderFactory.getTemplate("date"),t=n.dateFormat.substring(0,n.dateFormat.indexOf(":")).lastIndexOf(" ");return $.fasttmpl(r,{showTime:n.showTime,value:n.value,dateFormat:t>0?n.dateFormat.substring(0,t):n.dateFormat,timeFormat:n.showTime&&t>0?n.dateFormat.substring(t):"",rtl:n.orientation=="rtl"})},configureHandlers:function(){var n=this,t=n.properties,i=n.getDateControl(),r=n.getTimeControl();t.mask&&i.mask({mask:t.mask});i.bind("change",function(){n.onChangeHandler()});t.showTime&&r.bind("change",function(){n.onChangeHandler()})},onChangeHandler:function(){},getDisplayValue:function(n){var f=this,t=f.properties,i,r,u;return!t.displayValue&&n?(r=bizagi.util.dateFormatter.getDateFromInvariant(n,t.showTime),u=bizagi.localization.getResource("datePickerRegional"),i=bizagi.util.dateFormatter.formatDate(r,t.fullFormat,u)):i="",t.displayValue||i||""},collectData:function(n){var r=this,t=r.properties,f=t.xpath,u=r.getValue(),i;r.controlValueIsChanged()&&(bizagi.util.isEmpty(f)||(bizagi.util.isEmpty(u)?u===""&&(n[t.xpath]=""):(i=bizagi.util.dateFormatter.getDateFromInvariant(u,t.showTime),typeof i!="undefined"&&i!==0&&(t.showTime||i.setHours(0,0,0,0),n[t.xpath]=bizagi.util.dateFormatter.formatInvariant(i,!0)))))},getDateControl:function(){},getTimeControl:function(){},isValid:function(n){var r=this,t=r.properties,o=this._super(n),i=r.getValue(),u,f,e,s,h;return(i&&bizagi.util.parseBoolean(t.editable)==!0&&(i=bizagi.util.dateFormatter.getDateFromInvariant(i),i!=0&&(i.setHours(0,0,0,0),t.minValue&&typeof t.minValue=="string"&&(f=bizagi.util.dateFormatter.getDateFromInvariant(t.minValue),f.setHours(0,0,0,0),i<f&&(u=this.getResource("render-date-minimum-validation").replaceAll("#label#",t.displayName).replaceAll("#minValue#",bizagi.util.dateFormatter.formatDate(f,t.fullFormat)),n.push({xpath:t.xpath,message:u}),o=!1)),t.maxValue&&typeof t.maxValue=="string"&&(e=bizagi.util.dateFormatter.getDateFromInvariant(t.maxValue),e.setHours(0,0,0,0),i>e&&(u=this.getResource("render-date-maximum-validation").replaceAll("#label#",t.displayName).replaceAll("#maxValue#",bizagi.util.dateFormatter.formatDate(e,t.fullFormat)),n.push({xpath:t.xpath,message:u}),o=!1)))),t.showTime&&bizagi.util.parseBoolean(t.editable)==!0&&t.required&&r.hasValue()&&(s=r.getDateControl(),h=r.getTimeControl(),s.length>0&&h.length>0&&s.val().length>0&&h.val().length==0))?(u=r.getResource("render-required-text").replaceAll("#label#",t.displayName),n.push({xpath:t.xpath,message:u}),!1):o}});
bizagi.rendering.render.extend("bizagi.rendering.extendedText",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.regularExpressionExpression&&(t.regularExpression={expression:t.regularExpressionExpression,message:t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message")})},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("extendedText");return $.fasttmpl(t,{isEmptyField:typeof n.properties.value=="undefined"})},postRender:function(){var n=this,t,i;n._super();t=n.getControl();i=n.properties;n.textarea=t.find("textarea");n.textarea?n.textarea.css({resize:"both"}):n.textarea.css({resize:"none"});i.retype=="double"&&n.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var n=this,t=n.properties;t.maxLength&&n.textarea.prop("maxlength",t.maxLength);t.maxLines?n.textarea.prop("rows",t.maxLines):n.textarea.prop("rows",6);n.textarea.bind("change",function(){var u=n.getValue(),i,r;n.setValue(n.textarea.val());i=[];t.retype!="duplicate"&&(n.isValid(i)||typeof t.regularExpression=="undefined"?n.setValue(n.textarea.val(),!0):(r=i[0].message,bizagi.showMessageBox(r,"Bizagi","error")))});n.textarea.bind("blur",function(){n.setValue(n.textarea.val())})},isValid:function(n){var u=this,i=u.properties,r,f=this._super(n),t=u.getValue(),e=bizagi.util.isOfflineForm({context:u});return i.regularExpression?(e&&bizagi.util.isTabletDevice()&&(t=typeof t=="object"&&t.value?t.value:t),t&&(t.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!t.match(new RegExp(i.regularExpression.expression))&&u.properties&&u.properties.xpath==="userName")?(r=i.regularExpression.message,n.push({xpath:i.xpath,message:r}),f=!1):t&&(t.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!t.match(new RegExp(i.regularExpression.expression)))&&(r=i.regularExpression.message,n.push({xpath:i.xpath,message:r}),f=!1)):t&&t.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))&&i.editable&&(r=this.getResource("render-text-regular-expression-default-message"),n.push({xpath:i.xpath,message:r}),f=!1),f},setDisplayValue:function(n){var i=this,r=i.getControl(),u=i.getDisplayValue(),f=bizagi.util.decodeURI(n),e=bizagi.util.decodeURI(u),t;i.properties.editable==!1&&typeof n=="string"&&(t=e.replaceAll("&","&amp;"),t=t.replaceAll("<","&lt;").replaceAll(">","&gt;"),t=t.replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;"),t=t.replaceAll("\\n","<br/>"),t=t.replaceAll("\n","<br/>"),r.html(t));i.setValue(f,!1)},collectData:function(n){var t=this,i=t.properties;t._super(n)},setValue:function(n){var t=this,i=bizagi.util.decodeURI(n);t._super(i)}});
bizagi.rendering.render.extend("bizagi.rendering.grid",{},{initializeData:function(n){var i=this,r,t,u,f;this._super(n);r=i.getFormContainer();t=this.properties;t.editable=bizagi.util.parseBoolean(t.editable)||!1;t.allowEdit=bizagi.util.parseBoolean(t.allowEdit)!=null?bizagi.util.parseBoolean(t.allowEdit):!0;t.inlineEdit=bizagi.util.parseBoolean(t.inlineEdit)!=null?bizagi.util.parseBoolean(t.inlineEdit):!0;t.withEditForm=bizagi.util.parseBoolean(t.withEditForm)!=null?bizagi.util.parseBoolean(t.withEditForm):!1;t.allowAdd=bizagi.util.parseBoolean(t.allowAdd)!=null?bizagi.util.parseBoolean(t.allowAdd):!0;t.inlineAdd=t.allowAdd?bizagi.util.parseBoolean(t.inlineAdd)!=null?bizagi.util.parseBoolean(t.inlineAdd):!0:!1;t.allowDelete=bizagi.util.parseBoolean(t.allowDelete)!=null?bizagi.util.parseBoolean(t.allowDelete):!0;t.allowDetail=bizagi.util.parseBoolean(t.allowDetail)!=null?bizagi.util.parseBoolean(t.allowDetail):!1;t.keyColumn="id";t.data=t.data||null;t.displayType="value";t.skipInitialLoad=t.skipInitialLoad||!1;t.allowMore=bizagi.util.parseBoolean(t.allowMore)||!1;t.allowFilter=bizagi.util.parseBoolean(t.allowFilter)||!1;t.allowGrouping=!1;t.groupBy="";t.groupSummary=t.groupSummary||null;t.groupText=this.getResource("render-grid-group-text");t.groupCollapsed=bizagi.util.parseBoolean(t.groupCollapsed)||!1;t.groupOrder=t.groupOrder||"asc";t.formShowMode=bizagi.util.parseBoolean(t.formShowMode)||"popup";t.sortBy=t.sortBy?t.sortBy:t.data&&t.data.sort?t.data.sort:t.keyColumn;t.sortOrder=t.sortOrder!==undefined&&t.sortOrder!==null?t.sortOrder==="True"?"asc":"desc":t.data&&t.data.order?t.data.order:"asc";t.sort=t.sortBy+" "+t.sortOrder;t.rowsPerPage=t.allowGrouping?1e3:t.rowsPerPage||20;t.page=1;t.records=0;t.totalPages=0;t.addLabel=t.addLabel||this.getResource("render-grid-add-label")+t.displayName;t.editLabel=t.editLabel||$.trim(this.getResource("render-grid-edit-label"))+" "+t.displayName;t.deleteLabel=t.deleteLabel||this.getResource("render-ecm-confirm-bt-delete")+" "+t.displayName;t.exportOptionsLabel=t.exportOptionsLabel||this.getResource("render-grid-export-options-label")+t.displayName;t.detailLabel=t.detailLabel||this.getResource("render-collection-navigator-details-form");t.tableCssClass=t.cssClass||"";t.alreadySaved=!1;t.contexttype!="entity"&&(t.contexttype=typeof i.parent.getContextType=="function"?i.parent.getContextType():"");try{(!i.parent||typeof i.parent.properties.editable!="boolean"||i.parent.properties.editable)&&t.editable||(t.allowAdd=!1,t.allowEdit=!1,t.allowDelete=!1,t.inlineEdit=!1,t.inlineAdd=!1,t.editable=!1)}catch(e){}t.allowEdit&&(t.inlineEdit||t.withEditForm)||(t.editable=!1);t.labelWidth=0;t.valueWidth="100%";t.overrideGetRemoteData=t.overrideGetRemoteData||undefined;t.singleInstance=bizagi.util.isEmpty(t.singleInstance)?!0:t.singleInstance;i.columns=[];i.enabledChecks={};i.exclusiveChanges={};i.originalEnabledChecks=[];$.each(n.elements,function(r,e){var o=e.render.properties,a,s,h,c,l;if(o.groupBy&&(t.groupBy=o.xpath||"",t.allowGrouping=bizagi.util.isEmpty(t.groupBy)?!1:!0),o.type==="columnLabel"&&i.spliceRowData(n.properties.data,r+1),o.type==="columnBoolean"&&o.isExclusive&&(a={xpath:o.xpath},n.properties.data))for(i.enabledChecks[o.xpath]=[],s=0;s<n.properties.data.rows.length;s++)h=n.properties.data.rows[s],c=h[r+1],c&&(i.originalEnabledChecks.push(h[0]),i.enabledChecks[o.xpath].push([h[0],c]));i.properties.inlineEdit||(e.render.properties.editable=!1);l=i.renderFactory.getColumn({type:o.type,data:e.render,parent:i,singleInstance:t.singleInstance});i.columns.push(l);o.editable&&(u=!0);o.totalize&&o.totalize.operation&&(f=!0,o.totalize.format=o.totalize.format||{},o.totalize.format.bold=o.totalize.format.bold!==undefined?o.totalize.format.bold:!0)});t.orientation=="rtl"&&(i.columns=i.columns.reverse());t.inlineEdit&&!u&&(t.inlineEdit=!1,t.allowEdit=!1);f&&(t.showSummary=!0,t.rowsPerPage=0);t.contextType=r.params&&r.params.data&&r.params.data.contextType?r.params.data.contextType:null;i.changes={};i.cellOverrides={};i.isRTL()&&t.data!=null&&(t.data.rows=i.changeOrderData(t.data.rows))},isRTL:function(){var n=this.properties;return n?typeof n.orientation=="string"&&n.orientation.toUpperCase()=="RTL"?!0:!1:!0},changeOrderData:function(n){var t=[],i=n||[],r;return $.each(i,function(n,u){r=u.shift();t=u.reverse();t.unshift(r);i[n]=t}),i},removeRemainingColumns:function(n,t){var i=n||[],r=0;return i.length>0&&(r=i[0].length-t-1),r>0&&$.each(i,function(n,t){for(var i=0;i<r;i++)t.pop()}),i},getColumn:function(n){var i=this,t=null;return $.each(i.columns,function(i,r){(r.properties.xpath==n||r.properties.id==n)&&(t=r)}),t},renderControl:function(){var n=this,r=this.properties,t=new $.Deferred,u=n.getMode();u!="execution"&&(r.data=n.getDummyData());var f=n.getGridTemplate(),e=n.applyTemplate(f),i=[];return $.each(n.columns,function(n,t){var r=t.initialize();r&&i.push(r)}),jQuery.when.apply($,i).done(function(){t.resolve(e)}),t.promise()},postRender:function(){var n=this,t=n.getControl();this._super();t.addClass("ui-bizagi-render-grid-container").addClass("ui-bizagi-render-display-block")},getGridTemplate:function(){return this.renderFactory.getTemplate("grid")},applyTemplate:function(n){var i=this,t=i.properties;return orientation=i.properties.orientation,$.fasttmpl(n,{id:bizagi.util.encodeXpath(t.xpath),displayName:bizagi.util.encodeXpath(t.displayName),allowAdd:t.allowAdd,addLabel:t.addLabel})},renderReadOnly:function(){var n=this,t=n.properties;return n.renderControl()},getRemoteData:function(n){var u=this,t=u.properties,i,r;return(n=n||{},$.extend(n,{url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,contexttype:t.contextType,idPageCache:t.idPageCache,sort:t.sortBy,order:t.sortType,page:t.page,rows:t.rowsPerPage,searchFilter:t.searchFilter,orientation:t.orientation||"ltr"}),t.overrideGetRemoteData)?(i=t.overrideGetRemoteData(n),i!=null?i.promise():null):(r=new $.Deferred,u.dataService.multiaction().getGridData(n).done(function(n){t.page=n.page;t.records=n.records;t.totalPages=n.totalPages;r.resolve(n)}),r.promise())},spliceRowData:function(n,t){var i=this,r=i.getMode();r=="execution"&&$.each(n.rows,function(i){var r=t||n.rows[i].length;n.rows[i].splice(r,0,"")})},getDummyData:function(){var i=this,r=i.properties,n,t;if(r.data)return r.data;for(n=["1"],t=0;t<i.columns.length;t++)n.push("");return{page:1,total:1,records:1,rows:[n]}},submitEditRequest:function(n){var i=this,t=i.properties,r=t.xpath+i.buildCellXpathFilter(n);return i.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:r,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType})},submitSaveRequest:function(n,t){var r=this,i=r.properties,u=null,f;return t.deferreds&&(u=$.when.apply($,t.deferreds),delete t.deferreds),f=i.xpathContext.length>0?i.xpathContext+"."+i.xpath+r.buildCellXpathFilter(n):i.xpath+r.buildCellXpathFilter(n),$.when(u).pipe(function(){return r.startLoading(),r.dataService.saveGridRecord({url:i.saveUrl,idRender:i.id,xpath:i.xpath,xpathContext:f,submitData:t,contexttype:i.contextType,disableServerGridValidations:t.disableServerGridValidations||!1}).pipe(function(n){return r.endLoading(),n}).fail(function(n){var i=r.getFormContainer(),t=n.responseText?n.responseText:typeof n=="string"?n:n.toString();if(typeof t=="string")try{t=JSON.parse(t).message}catch(u){t=t.match(/"message":(.*)",/)[0];t=t.substr(11,t.length-13)}else t.message||(t=n);i.validateForm();i.clearValidationMessages();i.addValidationMessage(t)})})},submitDeleteRequest:function(n){var i=this,t=i.properties,r=t.xpath+i.buildCellXpathFilter(n);return i.dataService.deleteGridRecord({url:t.deleteUrl,idRender:t.id,xpath:r,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType}).pipe(function(n){if(n.type=="validationMessages"){var t=i.getFormContainer(),r=n.messages.join(" ");t.failHandler({message:r})}return n})},submitAddRequest:function(){var t=this,n=t.properties,i=t.dataService.addGridRecord({url:n.addUrl,idRender:n.id,xpath:n.xpath,xpathContext:n.xpathContext,contexttype:n.contextType,idPageCache:n.idPageCache}),r=i.pipe(function(n){return n.idEntity});return r.promise()},submitRollbackRequest:function(){var t=this,n=t.properties;return t.dataService.rollbackGridAction({url:n.rollbackUrl,idRender:n.id,xpath:n.xpath,xpathContext:n.xpathContext,idPageCache:n.idPageCache,contexttype:t.properties.contexttype||""})},collectGridChange:function(n){var t=this;n=n||{};var i=n.id,r=n.xpath,u=n.value,f=typeof n.trigger!="undefined"?n.trigger:!0,e=n.pressed||!1;t.changes[i]=t.changes[i]||{};t.changes[i][r]=u;f&&t.triggerRenderChange({key:i,column:r,pressed:e})},configureColumnSubmitOnChange:function(n){var t=this,i=t.properties,r={commands:[{xpath:i.xpath,command:"submit-value",argument:"all"}],conditions:{operator:"and",expressions:[{simple:{operator:"cell-change",xpath:i.xpath+"[]."+n,argumentType:"text",argument:n}}]},dependencies:[i.xpath]};$.when(t.ready()).done(function(){var i=t.getFormContainer();i.addSubmitAction(n,r)})},collectData:function(n){var t=this,f=t.properties,s=[],r,i,u,e,o,c,h;for(i in t.changes){if(i!="summary")for(r in t.changes[i])if(t.canColumnBeSent(i,r)){var l=f.xpath+t.buildCellXpathFilter(i)+"."+r,h=f.xpath+t.buildCellXpathFilter(i)+"."+(r.substr(r.lastIndexOf(".")+1,r.length)||r),a=t.changes[i][r];n[l]=a}s.push(i)}if(t.exclusiveChanges)for(i in t.exclusiveChanges)if(u=t.exclusiveChanges[i],e=t.enabledChecks[i],u&&e){for(o=0;o<e.length;o++)c=f.xpath+t.buildCellXpathFilter(e[o][0])+"."+i,n[c]=!1;h=f.xpath+t.buildCellXpathFilter(u.key)+"."+u.xpath;n[h]=u.value}$.each(s,function(n,i){delete t.changes[i]})},hasChanged:function(n){var t=this;return $.isEmptyObject(t.changes)?!1:(n.push(!0),!0)},canColumnBeSent:function(n,t){var u=this,f,r,e,i,o;for(f in u.columns)if(u.columns.hasOwnProperty(f))if(i=u.columns[f],i.properties.type!=="columnUserfield"){if(i.properties.xpath==t)return o=u.getCellOverride(n,i.columnIndex-1),i.canBeSent(n,o)}else for(r in i.properties)if(i.properties.hasOwnProperty(r)&&Object.prototype.toString.apply(i.properties[r])==="[object String]"&&(e=i.properties[r].substr(i.properties[r].lastIndexOf(".")+1),e===t))return!0;return!1},canBeSent:function(){var t=this,n=t.properties,i=bizagi.util.parseBoolean(n.displayOnly)||!1;return!i&&(n.inlineEdit||n.inlineAdd||!$.isEmptyObject(t.changes))?!0:!1},getCellValue:function(n,t){for(var i,u=this,f=u.properties.data.rows,r=0;r<f.length;r++)if(f[r][0]==n)for(i=0;i<u.columns.length;i++)if(u.columns[i].properties.xpath==t)return f[r][i+1];return null},getCellCurrentValue:function(n,t){var r=this,i=r.getControlCell(n,t);return i&&typeof i.getValue=="function"?i.getValue():null},getControlCell:function(n,t){var r=this,u=null,i;if(typeof r.columns!="undefined")for(i=0;i<r.columns.length;i++)if(r.columns[i].properties.xpath==t||r.columns[i].properties.id==t){u=r.columns[i].getDecorated(n);break}return u},refresh:function(){},setError:function(){},changeCellBackgroundColor:function(){},changeCellColor:function(){},changeCellVisibility:function(){},changeCellEditability:function(){},changeCellRequired:function(){},changeCellProperties:function(){},changeCellMaxValue:function(){},changeCellMinValue:function(){},cleanCellData:function(){},refreshCell:function(n){var i=this,u=i.properties,r=n.key,f=n.column,e=n.xpathContext!==""?n.xpathContext+"."+i.properties.xpath+i.buildCellXpathFilter(r):i.properties.xpath+i.buildCellXpathFilter(r),t=i.getControlCell(r,n.column),o=i.getFormContainer(),s=o.properties.id;if(t)return t.beforeToRefresh(),$.when(i.dataService.multiaction().refreshGridCell({idRender:u.id,column:t.properties.id,idPageCache:u.idPageCache,xpathContext:e,idForm:s})).done(function(n){var u=function(n){return n&&typeof n=="object"&&n.length>=1?n[0].length>=1?n[0][0]:n[0]:""},e=u(n.rows),o=u(n.editable)||!0,s;o=o&&typeof t.column!="undefined"&&typeof t.column.properties!="undefined"&&t.column.properties.editable?!0:!1;s=u(n.visible)||!0;i.changeCellVisibility(r,f,s);t.changeEditability(o);t.setValue(e);t.setDisplayValue(e);i.triggerRenderChange({key:r,column:f,changed:!1});t.column!=undefined&&bizagi.util.detectDevice()=="desktop"&&i.updateAffectedCellManually(r,e,t.column.columnIndex);t.afterToRefresh()})},triggerRenderChange:function(n){var t=this;n=n||{};bizagi.util.isEmpty(n)||n.changed==!1||(t.properties.canBeExported=!1);t.triggerHandler("renderchange",{render:t,surrogateKey:n.key,column:n.column,changed:n.changed,rowDeleted:n.rowDeleted,pressed:n.pressed})},validate:function(){this.isValid([])},isValid:function(n){var t=this,h=!0,o,i,u,s,e,l,f,a,v;if(t.hasErrors=!1,t.setValidationMessage(""),t.properties.data&&t.properties.data.rows)for(o=$.merge($.merge([],t.properties.data.rows),t.getDataNewRows()),i=0;i<t.columns.length;i++){for(u=[],s={},e=0;e<o.length;e++){var c=o[e][i+1],r=o[e][0],y=t.columns[i].properties.xpath;t.changes[r]!==undefined&&t.changes[r][t.columns[i].properties.xpath]!==undefined&&(c=t.changes[r][t.columns[i].properties.xpath]);l=t.columns[i].isValueValid(r,c,u,t.getCellOverride(r,i));l||(h=!1,t.hasErrors=!0,t.setError(r,t.columns[i].properties.xpath))}for(f=0,a=u.length;f<a;f++)s[u[f]]==null&&(s[u[f]]=u[f]);if(u.length>0){v=t.getResource("render-grid-validation").replaceAll("#grid#",t.properties.displayName);for(r in s)n.push({xpath:t.properties.xpath,message:v+" "+r})}}return h},configureSubmitOnChange:function(){},getCellOverride:function(n,t){var i=this,r;return n=Number(n),t=Number(t),r=i.columns[t].properties,i.cellOverrides[n]||(i.cellOverrides[n]={}),i.cellOverrides[n][t]||(i.cellOverrides[n][t]={visible:r.visible,editable:r.editable,required:r.required}),i.cellOverrides[n][t]},setCellOverrides:function(n,t){var f=this,u,i,r,e;if(n.visible)for(i in n.visible){u=n.visible[i][0];for(r in n.visible[i])r>0&&(f.getCellOverride(u,r-1).visible=bizagi.util.parseBoolean(n.visible[i][r]))}if(n.editable)for(i in n.editable)if(n.editable.hasOwnProperty(i)){u=n.editable[i][0];for(r in n.editable[i])n.editable[i].hasOwnProperty(r)&&r>0&&(e=t?bizagi.util.parseBoolean(t[r-1].properties.editable):!0,f.getCellOverride(u,r-1).editable=e?bizagi.util.parseBoolean(n.editable[i][r]):!1)}if(n.required)for(i in n.required){u=n.required[i][0];for(r in n.required[i])r>0&&(f.getCellOverride(u,r-1).required=bizagi.util.parseBoolean(n.required[i][r]))}},getIndexes:function(){var n=this,t=$.merge(n.properties.data.rows,n.getDataNewRows());return $.map(t,function(n){return n[0]})},getDataNewRows:function(){var n=this,t=[];return typeof n.newRecords!="object"||$.isEmptyObject(n.newRecords)||$.each(n.newRecords,function(i){var u=[],r,f;for(u.push(Number(i)),r=0,f=n.columns.length;r<f;r++)u.push(n.getCellCurrentValue(i,n.columns[r].properties.xpath));t.push(u)}),t},getGridExportUrl:function(n){var t=this,i=t.properties;return t.dataService.getGridExportUrl({idRender:i.id,xpathContext:i.xpathContext||"",idPageCache:i.idPageCache,disposition:n.disposition,exportType:n.exportType,sort:i.sort,sessionId:t.getSessionId(),idForm:t.getFormContainer().properties.id})},submitForGridChange:function(){var n=this;return n.submitOnChange(null,!1)},dispose:function(){var n=this;setTimeout(function(){n.columns&&$.each(n.columns,function(n,t){t.dispose()})},bizagi.override.disposeTime||50);n._super()},getEnabledChecks:function(n){var i=this,t=i.properties,r;return n=n||{},$.extend(n,{url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,contexttype:t.contextType,idPageCache:t.idPageCache,rows:t.rowsPerPage,xpathfilter:n.xpath}),r=new $.Deferred,i.dataService.multiaction().getGridDataExclusivesSelected(n).done(function(n){t.page=n.page;t.records=n.records;t.totalPages=n.totalPages;i.isRTL()&&(n.rows=i.changeOrderData(n.rows));r.resolve(n)}),r.promise()},buildCellXpathFilter:function(n){return bizagi.util.isNumeric(n)?"[id="+n+"]":"[id='"+n+"']"}});
bizagi.rendering.render.extend("bizagi.rendering.hidden",{},{renderControl:function(){var n=this;return n.getMode()==="design"?"<div>"+bizagi.localization.getResource("render-hidden-displayName")+"<\/div>":"<div />"},postRender:function(){var n=this,t=n.properties;n._super();t.value!==undefined&&n.setDisplayValue(t.value)}});
bizagi.rendering.render.extend("bizagi.rendering.label",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.required=!1;this.properties.displayType="label";this.properties.labelAlign=this.originalProperties.labelAlign||"left";this.properties.displayName=n.properties.displayName||"";bizagi.util.parseBoolean(this.properties.allowDinamiclabel)&&(this.properties.displayName=n.properties.displayName||bizagi.localization.getResource("render-label-default-display-name"));this.bindingValue();this.calculateInitialLayoutProperties()},postRender:function(){var n=this,t=n.properties;n._super();n.changeDisplayOption("label");n.changeLabelAlign(t.labelAlign||"left");typeof n.configureHelpText=="function"&&n.configureHelpText()},postRenderReadOnly:function(){var n=this,t=n.properties;n._super();n.changeDisplayOption("label");n.changeLabelAlign(t.labelAlign||"left")},isValid:function(){},getDefaultLabelAlign:function(){return"left"},canBeSent:function(){return!1},bindingValue:function(){var n=this;n.properties.allowDinamiclabel&&n.properties.value&&(typeof n.properties.value=="object"&&n.properties.value[0]?n.properties.displayName=n.properties.value[0].value:typeof n.properties.value=="string"&&n.properties.value!==""&&(n.properties.displayName=n.properties.value))}});
bizagi.rendering.render.extend("bizagi.rendering.search",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.searchForms=t.searchForms||[];t.maxRecords=Number(t.maxRecords)||20;t.advancedSearch=bizagi.util.parseBoolean(t.advancedSearch)===null?!1:bizagi.util.parseBoolean(t.advancedSearch);t.allowSuggest=bizagi.util.parseBoolean(t.allowSuggest)!==null?bizagi.util.parseBoolean(t.allowSuggest):!1;t.allowFullSearch=t.allowFullSearch||!1;t.allowAdd=bizagi.util.parseBoolean(t.allowAdd)||!1;t.allowTyping=bizagi.util.parseBoolean(t.allowTyping)!==null?bizagi.util.parseBoolean(t.allowTyping):!1;t.allowTyping=bizagi.util.parseBoolean(t.allowSuggest)?!0:t.allowTyping;t.allowClear=bizagi.util.parseBoolean(t.allowClear)!==null?bizagi.util.parseBoolean(t.allowClear):!1;t.editable=bizagi.util.parseBoolean(t.editable)!==null?bizagi.util.parseBoolean(t.editable):!0;t.searchLength=t.searchLength||2;t.enableLocalStorage=!1;t.expireCache=9e5},renderControl:function(){var t=this,n=t.properties,i=t.renderFactory.getTemplate("search");return $.fasttmpl(i,{id:n.id,xpath:n.xpath,allowTyping:n.allowTyping,advancedSearch:n.advancedSearch,hasMozillaHelpText:$.browser?$.browser.mozilla&&n.helpText!=null&&n.helpText!=""?!0:!1:!1})},getData:function(n){var i=this,t=i.properties,r=new $.Deferred,u=i.getFormContainer(),f=u.getContextType()||u.params.contexttype||!1;return n=n||{},i.properties.contexttype?n.h_contexttype=i.properties.contexttype:f&&(n.h_contexttype=f),n&&n.h_contexttype&&n.h_contexttype==="metadata"&&(t.xpathContext=""),i.dataService.multiaction().getSearchData({url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,term:t.allowFullSearch?"%"+t.term:t.term,extra:n}).done(function(n){t.data=n;r.resolve(t.data)}).fail(function(n){var t=n.hideStatus||!1;r.resolve({});t||i.trigger("onSearchError",n)}),r.promise(r)},setValue:function(n,t){var i=this;t=t!==undefined?t:!0;i._super(n,t);n!=undefined?(this.value=n,this.selectedValue=n.label):(this.value=null,this.selectedValue=null)},collectData:function(n){var i=this,r=i.properties,u=r.xpath,t=i.getValue();if(i.controlValueIsChanged()&&!bizagi.util.isEmpty(u)&&t!==null&&typeof t!="undefined"){if(typeof t=="object"&&t.id===undefined)return;n[r.xpath]=t}},submitData:function(){var n=this,i=n.properties,t={};n.grid||(t[i.xpath]=n.getValue());n.submitOnChange(t,undefined,!1)},isValid:function(n){return this._super(n)}});
bizagi.rendering.render.extend("bizagi.rendering.text",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.regularExpressionExpression&&(t.regularExpression={expression:t.regularExpressionExpression,message:t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message")})},renderControl:function(){var n=this,t=n.properties,i=n.renderFactory.getTemplate("text");return $.fasttmpl(i,{value:"",isEmptyField:typeof t.value=="undefined"})},renderReadOnly:function(){var n=this,i=n.properties,t=n.renderFactory.getTemplate("text-read-only");return $.fasttmpl(t,{value:n.getValue()})},postRender:function(){var n=this,t=n.getControl(),i=n.properties;n._super();n.input=t.find("input");i.retype=="double"&&n.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var n=this,t=n.properties,i=n.getControl(),r=n.input;t.mask&&n.input.mask({mask:t.mask});n.input.bind("change",function(){var r=n.getValue(),i;n.setValue(n.input.val(),!1);i=[];t.retype!="duplicate"&&(n.isValid(i)||typeof t.regularExpression=="undefined"?n.setValue(n.input.val(),!0):message=i[0].message)}).keypress(function(n){n=window.event||n;var t=n.charCode||n.keyCode;n!==undefined&&t==13&&$(this).trigger("change")})},isValid:function(n){var u=this,i=u.properties,f=this._super(n),t=u.getValue(),r;return typeof t=="string"&&(i.regularExpression?t&&(t.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!t.match(new RegExp(i.regularExpression.expression))&&u.properties&&u.properties.xpath==="userName")?(r=i.regularExpression.message,n.push({xpath:i.xpath,message:r}),f=!1):t&&(t.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!t.match(new RegExp(i.regularExpression.expression)))&&(r=i.regularExpression.message,n.push({xpath:i.xpath,message:r}),f=!1):t&&t.match(new RegExp(".*?eval\\(","g"))&&t.match(new RegExp(".*?eval\\u0028","g"))&&i.editable&&(r=this.getResource("render-text-regular-expression-default-message"),n.push({xpath:i.xpath,message:r}),f=!1)),f},setDisplayValue:function(n){var i=this,r=i.getControl(),u=i.getDisplayValue(),f=bizagi.util.decodeURI(n),e=bizagi.util.decodeURI(u),t;i.properties.editable==!1&&(typeof n=="string"?(t=e.replaceAll("&","&amp;"),t=t.replaceAll("<","&lt;").replaceAll(">","&gt;"),t=t.replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;"),t=t.replaceAll("\\n","<br/>"),t=t.replaceAll("\n","<br/>"),r.html(t)):bizagi.util.isNull(n)&&r.html(""));i.setValue(f,!1)},setValue:function(n){var t=this;t._super(n)}});
bizagi.rendering.render.extend("bizagi.rendering.button",{},{initializeData:function(n){this._super(n);var t=this.properties;t.caption=t.caption||"";t.displayType="value";t.required=!1;t.preventDefault=t.preventDefault||!1},renderControl:function(){var n=this,t=n.properties,i=n.renderFactory.getTemplate("button");return $.fasttmpl(i,{caption:t.caption,cssClass:t.cssclass||""})},renderReadOnly:function(){var n=this;return n.renderControl()},saveForm:function(){var n=this,t=n.getFormContainer();return t.saveForm()},executeButton:function(){var t=this,n=t.properties,i=n.xpathContext||"";return n.submitOnChangexpathContextRow&&(i=i?i+"."+n.submitOnChangexpathContextRow:n.submitOnChangexpathContextRow),t.getFormContainer().startLoading(),t.dataService.multiaction().executeButton({idRender:n.id,xpath:n.xpath||"",xpathContext:i||"",idPageCache:n.idPageCache}).always(function(){return t.getFormContainer().endLoading(),arguments?arguments[0]:undefined})},refreshForm:function(){var n=this,t=n.properties,i=n.getFormContainer();i.refreshForm(t.id)},processButton:function(){var n=this,t=n.properties;t.editable&&(n.getFormContainer().clearValidationMessages(),n.saveForm().pipe(function(){return n.executeButton()}).done(function(t){if(t==null||t==!0||t.result=="success"||t.type=="success")return n.refreshForm();t.type=="validationMessages"&&n.getFormContainer().addValidationMessage(t.messages)}).fail(function(t,i,r){n.getFormContainer().addErrorMessage(r)}))},triggerRenderChange:function(n){var t=this,i;n=n||{};i=n.pressed||!1;t.triggerHandler("renderchange",{render:t,pressed:i})},canBeSent:function(){return!1}});
bizagi.rendering.render.extend("bizagi.rendering.fileprint",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.caption=t.caption&&t.caption!=" "?t.caption:"render-fileprint-property-caption";t.displayType="value";this.calculateInitialLayoutProperties();t.required=!1},renderControl:function(){var n=this,t=n.properties,i=n.renderFactory.getTemplate("fileprint");return $.fasttmpl(i,{caption:t.caption})},renderReadOnly:function(){var n=this;return n.renderControl()},getFilePrintUrl:function(n){var t=this,i=t.properties;return t.dataService.getFilePrintUrl({idRender:i.id,xpathContext:i.xpathContext||"",idPageCache:i.idPageCache,disposition:n,sessionId:t.getSessionId()})},refreshForm:function(){var n=this,t=n.properties,i=n.getFormContainer();i.refreshForm(t.id)},saveForm:function(){var n=this,t=n.getFormContainer();return t.saveForm()}});
bizagi.rendering.render.extend("bizagi.rendering.link",{},{initializeData:function(n){var t=this;this._super(n);this.properties.displayType="value";this.calculateInitialLayoutProperties()},renderControl:function(){var n=this,t=n.properties,i=n.renderFactory.getTemplate("link");return $.fasttmpl(i,{displayName:t.displayName,align:t.valueAlign})},renderReadOnly:function(){var n=this;return n.renderControl()},isValid:function(){},setDisplayValue:function(){},canBeSent:function(){return!1}});
bizagi.rendering.render.extend("bizagi.rendering.checkList",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1;i.setValue(t.items);i.updateOriginalValue()},postRender:function(){var n=this,t=n.getControl();n._super();n.checkListGroup=$(".ui-bizagi-render-checkList .ui-bizagi-render-checkList-item",t)},renderControl:function(){var n=this;return n.renderCheckList()},renderCheckList:function(){var n=this,t=n.properties,i=n.renderFactory.getTemplate(n.getTemplateName()),r=n.properties.items||[];return $.fasttmpl(i,$.extend(n.getTemplateParams(),{id:t.id,xpath:t.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:t.idPageCache,items:r}))},getTemplateName:function(){return"checkList"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){var n=this,t=n.properties;return{vertical:!t.horizontal}},cleanData:function(){},setValue:function(n){var t=this;t.value=bizagi.clone(n)},getValue:function(){var n=this;return n.value||[]}});
bizagi.rendering.render.extend("bizagi.rendering.layoutRender",{},{renderElement:function(n){var i=this,r=i.properties,s=i.getFormContainer(),e,t,o;i.renderingDeferred=new $.Deferred;n=n||"render-layout";e=i.renderFactory.getTemplate(n);t=r.displayName;typeof t=="string"&&(t=t.replaceAll("&","&amp;"),t=t.replaceAll("$","&#36;"),t=t.replaceAll("<","&lt;").replaceAll(">","&gt;"),t=t.replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;"),t=t.replaceAll("\\n","<br/>"),t=t.replaceAll("\n","<br/>"));var h=parseFloat(r.labelWidth),f=$.fasttmpl(e,{label:t,isExtendedText:r.type=="text"&&r.isExtended,orientation:r.orientation,uniqueId:r.uniqueId,id:r.id,isDesign:i.getMode()==="design",messageValidation:r.messageValidation,printVersion:s.params.printversion,cssClass:r.cssclass||"",hide:r.hide}),u=i.internalRenderControl();return u||(u=""),o=typeof u=="object"&&u.done,o?u.state()==="resolved"?(f=i.replaceControlHtml(f,i.resolveResult(u)),i.asyncRenderDeferred=null):(i.asyncRenderDeferred=u,f=i.replaceControlHtml(f,"")):f=i.replaceControlHtml(f,u),f},getControl:function(){var n=this;return((!n.control||n.control instanceof jQuery&&n.control.length===0)&&(n.control=n.element),!n.control||n.control.length==0)?null:n.control},changeFontItalic:function(n){var t=this;bizagi.util.parseBoolean(n)?t.getControl().css("font-style","italic","!important"):t.getControl().css("font-style","normal","!important")},changeFontUnderline:function(n){var t=this,r=t.properties.valueFormat||{},i=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"";bizagi.util.parseBoolean(n)?t.getControl().css("text-decoration",i+"underline","!important"):t.getControl().find("*").each(function(n,t){$(t).css("text-decoration",i,"!important")})}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutImage",{},{init:function(n){this._super(n)},renderControl:function(){var n=this,u=n.getMode(),t=!1,i=n.properties.value||{},r="",f=n.renderFactory.getTemplate("layout-image");return u==="execution"&&i.value&&i.value.length>0?r=n.getImageUri():t=!0,$.fasttmpl(f,{url:r,useDefaultImage:t})},getImage64:function(){var n=this,t={xpath:n.properties.xpath,entity:n.value.guid,surrogateKey:n.value.surrogateKey,width:96,height:96};return n.dataService.getEntityImage64(t)},getImageUri:function(){var n=this,t={entity:n.value.guid,surrogateKey:n.value.surrogateKey,xpath:n.properties.xpath,width:96,height:96,hash:n.value.value};return n.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(t)}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutLink",{},{init:function(n){this._super(n)},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("layout-link");return $.fasttmpl(t,{displayName:n.properties.displayName})}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutLabel",{},{init:function(n){this._super(n);this.properties.required=!1;this.properties.displayType="label";this.properties.labelAlign=this.originalProperties.labelAlign||"left";this.calculateInitialLayoutProperties()},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("layout-label"),i=n.properties.displayName||n.properties.value||"";return $.fasttmpl(t,{value:i})}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutText",{},{init:function(n){this._super(n)},initializeData:function(n){var i=this,t;this._super(n);t=this.properties},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("layout-text");return $.fasttmpl(t,{value:n.properties.value,editable:n.properties.editable})},renderReadOnly:function(){var n=this;return n.renderControl()}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutUpload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{init:function(n){this._super(n)},initializeData:function(n){var r=this,i,t;this._super(n);i=r.getFormContainer();t=this.properties;t.editable=!0;t.allowDelete=!0;t.contexttype=i.params&&i.params.data&&i.params.data.contextType?i.params.data.contextType:"";t.allowSendInMail=t.allowSendInMail||!1},getValueFilesByData:function(n){var r=this,i=$.Deferred(),u,t;u=n.value.value?n.value.value:n.value;try{r.isContextContainerWidgetRender()?(t=JSON.parse('{ "files": '+u+"}"),i.resolve(n,t)):$.when(r.getDataFilesWithoutScope()).done(function(r){t=JSON.parse('{ "files": '+r+"}");i.resolve(n,t)})}catch(f){t=JSON.parse('{ "files": []}');i.resolve(n,t);console.warn("Exception converting data files. Error: ",f)}return i.promise()},isContextContainerWidgetRender:function(){var t=this,n=t.getFormContainer();return n.params.paramsRender&&n.params.paramsRender.idRender},getDataFilesWithoutScope:function(){var n=this,t={xpath:n.properties.xpath,entity:n.value.guid,surrogateKey:n.value.surrogateKey};return n.dataService.getFilesDataForLayoutUploadControl(t)},getValue:function(){return this.files},getUploadXpath:function(){return this.properties.xpath}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutBoolean",{},{init:function(n){this._super(n)},initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.editable=!1},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("layout-boolean");return $.fasttmpl(t,{value:this.properties.value})},renderReadOnly:function(){var n=this;return n.renderControl()},setValue:function(n,t){n===null||n===""?this.properties.value="":(n.toString().toLowerCase()==="true"||n.toString().toLowerCase()==="false")&&(this.properties.value=bizagi.util.parseBoolean(n)?this.getResource("render-boolean-yes"):this.getResource("render-boolean-no"));this._super(this.properties.value,t)}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutDateTime",{},{init:function(n){this._super(n)},initializeData:function(n){var i=this,r,u,f;i._super(n);var t=i.properties,e=i.getResource("dateFormat"),o=i.getResource("timeFormat");t.displayValue="";t.showTime=t.showTime!==undefined?bizagi.util.parseBoolean(t.showTime):!1;t.dateFormat=t.dateFormat||e;t.timeFormat=t.timeFormat||o;t.fullFormat=t.dateFormat;t.showTime?t.fullFormat.search(/[h|H]+/ig)===-1&&(t.fullFormat=t.fullFormat+" "+t.timeFormat):(r=t.fullFormat.search(/[h|H]+/ig),r!==-1&&(t.fullFormat=t.fullFormat.substring(0,r-1)));t.value?(u=bizagi.util.dateFormatter.getDateFromInvariant(t.value,t.showTime),u!=0?(f=bizagi.localization.getResource("datePickerRegional"),i.value=t.value,t.displayValue=bizagi.util.dateFormatter.formatDate(u,t.fullFormat,f)):i.value=null):(i.value=null,t.value="",t.displayValue="")},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("layout-date-time"),i=n.properties.value===null||n.properties.value===""?"":n.properties.value;return $.fasttmpl(t,{value:i})},setDisplayValue:function(n){var i=this,t,f=i.properties,e=i.getDateControl(),r="MM/dd/yyyy H:mm:ss",u;i.i18n=bizagi.localization.getResource("datePickerRegional");n.length==r.length||n.length==r.length+1?t=bizagi.util.dateFormatter.getDateFromInvariant(n,!0):(t=bizagi.util.dateFormatter.getDateFromInvariant(n),!t||isNaN(Date.parse(t))||$.isNumeric(t)||t.setHours(0,0,0,0));n&&!isNaN(Date.parse(n))&&(u=bizagi.util.dateFormatter.formatDate(t,f.fullFormat,i.i18n),e.text(u))},getDateControl:function(){var n=this;return n.dateControl=$(".ui-bizagi-render-date-time",n.getControl()),n.dateControl}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutNumber",{},{init:function(n){this._super(n)},initializeData:function(n){var r=this,t,i;this._super(n);t=this.properties;i=this.getResource("numericFormat");t.allowDecimals=typeof t.allowDecimals!="undefined"?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType);t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0;t.symbol="";t.positiveFormat=i.positiveFormat;t.negativeFormat=i.negativeFormat;t.decimalSymbol=typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol;t.digitGroupSymbol=typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol;t.groupDigits=this.getDefaultGroupDigits(t.dataType);t.colorize=t.colorizeOnNegative||!1},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("layout-number");return $.fasttmpl(t,{value:n.properties.value})},renderReadOnly:function(){var n=this;return n.renderControl()},getDisplayValue:function(n){var i=this,t=i.properties,u=i.getControl(),r=$("<label/>").html(n);return r.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),r.text()},getDefaultAllowDecimals:function(n){if(n){if(n==1||n==2||n==3||n==4||n==7)return!1;if(n==6||n==8||n==10||n==11)return!0}return!1},getDefaultGroupDigits:function(n){if(n){if(n==1||n==2||n==3||n==4||n==7)return!1;if(n==6||n==8||n==10||n==11)return!0}return!1}});
bizagi.rendering.layoutNumber.extend("bizagi.rendering.layoutMoney",{},{init:function(n){this._super(n)},initializeData:function(n){var r=this,t,i;this._super(n);t=this.properties;i=this.getResource("numericFormat");t.showsymbol=typeof t.showsymbol!="undefined"?t.showsymbol:!0;t.symbol=t.showsymbol?t.currencySymbol?t.currencySymbol:typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol:"";t.groupDigits=!0}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutPlaceholder",{},{init:function(n){this._super(n)},initializeData:function(n){var i=this,t;this._super(n);t=this.properties},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("layout-placeholder"),i=n.properties.value||n.properties.displayName||"";return $.fasttmpl(t,{value:i})}});
bizagi.rendering.render.extend("bizagi.rendering.geolocation",{},{init:function(n){var t=this,i;t._super(n);i=t.properties;i.allowUpdate=bizagi.util.parseBoolean(i.allowUpdate);t.geoloc=window.navigator.geolocation},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("geolocation");return $.fasttmpl(t,n.properties)},isValid:function(n){var t=this,r=t.properties,i=this._super(n),u=t.getValue();return i},setDisplayValue:function(n){var t=this,i=t.getControl();t.setValue(n,!1)},configureHandlers:function(){},getCurrentPosition:function(n,t){var i=this;if(typeof i.geoloc=="undefined"){t&&t(bizagi.localization.getResource("render-control-unsuported-by-browser").replace("{0}",i.properties.type));return}return i.geoloc.getCurrentPosition(function(t){n&&n(t)},function(n){var i="";switch(n.code){case n.PERMISSION_DENIED:case 1:i=bizagi.localization.getResource("render-geolocation-permission-denied");break;case n.POSITION_UNAVAILABLE:case 2:i=bizagi.localization.getResource("render-geolocation-position-unavailable");break;case n.TIMEOUT:case 3:i=bizagi.localization.getResource("render-geolocation-timeout");break;default:i="WD: "+bizagi.localization.getResource("render-geolocation-permission-denied")}t&&t(i)})}});
bizagi.rendering.render.extend("bizagi.rendering.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{initializeData:function(n){var u=this,f,t,i,e,r,o;if(this._super(n),f=u.getFormContainer(),t=this.properties,t.maxSize=Number(t.maxSize)||(typeof BIZAGI_SETTINGS!="undefined"&&typeof BIZAGI_SETTINGS.UploadMaxFileSize!="undefined"?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.maxfiles=Number(t.maxfiles)||999,t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(i=t.validExtensions.replace(/\ /gi,"").split(";"),e=[],r=0;r<i.length;r++)i[r].length>0?e.push("*."+i[r]):(o=i.indexOf(i[r]),i.splice(r,1));t.validExtensions=e.join(";")}t.addUrl=t.addUrl||u.dataService.getUploadAddUrl();t.deleteUrl=t.deleteUrl||undefined;t.editable=bizagi.util.parseBoolean(t.editable)||!1;t.allowDelete=bizagi.util.parseBoolean(t.allowDelete)!==null&&t.editable?bizagi.util.parseBoolean(t.allowDelete):!1;t.contexttype=f.params&&f.params.data&&f.params.data.contextType?f.params.data.contextType:"";t.allowSendInMail=t.allowSendInMail||!1;u.files=t.value||[];u.filesCount=u.files.length},renderControl:function(){for(var u,f,n=this,i=n.properties,e=n.renderFactory.getTemplate("upload"),o=$.fasttmpl(e,{xpath:bizagi.util.encodeXpath(n.getUploadXpath()),editable:i.editable,noFiles:n.filesCount==0,allowSendInMail:i.allowSendInMail}),r="",t=0;t<n.filesCount;t++)u={id:n.files[t][0],fileName:n.files[t][1]},f=n.renderUploadItem(u),r+=f;return n.replaceFilesHtml(o,r)},renderReadOnly:function(){return this.renderControl()},renderUploadItem:function(n){var t=this,i=t.properties,r=t.getMode(),f=bizagi.util.isIE()?"_self":"_blank",e=t.renderFactory.getTemplate("uploadItem"),u=t.buildItemUrl(n);return r!="execution"&&(u="javascript:void(0);"),$.fasttmpl(e,{url:u,allowDelete:i.allowDelete,targetdefinition:f,filename:n.fileName,id:n.id,mode:r,editable:i.editable})},buildItemUrl:function(n){var t=this,i=t.properties,r=t.getFormContainer();return t.dataService.getUploadFileUrl({idRender:i.id,xpath:t.getUploadXpath(),xpathContext:i.xpathContext,idPageCache:i.idPageCache,fileId:n.id,sessionId:r.properties.sessionId,contexttype:i.contexttype})},replaceFilesHtml:function(n,t){return n.replace("{{files}}",t)},deleteUploadItem:function(n,t){var i=this,r=i.properties,u=i.getUploadXpath()+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']");return i.dataService.deleteUploadFile({url:r.deleteUrl,idRender:r.id,xpath:u,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype}).pipe(function(){i.filesCount=i.filesCount-1;i.files=$.grep(i.files,function(n){return n[0]!=t})})},canBeSent:function(){return!1},setValue:function(n,t){var i=this;i.files=n||[];i.filesCount=i.files.length;i._super(n,t)},getValue:function(){return this.files},isValid:function(n){var t=this,i=t.properties,r,u=!0,f,e;return i.required&&i.editable&&(f=t.grid&&t.grid.isFromCreatedRow.apply(t),t.filesCount<=0&&!f&&(e=t.grid?t.grid.properties.inlineEdit:!0,e&&(r=t.getResource("render-required-upload").replaceAll("#label#",i.displayName),n.push({xpath:i.xpath,message:r}),u=!1))),u},buildAddParams:function(){var n=this,i=n.properties,r=n.getFormContainer(),t={};t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.getUploadXpath();t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=i.id;t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=i.xpathContext;t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+n.Class.BA_PAGE_CACHE]=i.idPageCache;t[n.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=r.properties.sessionId;t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=i.contexttype;try{BIZAGI_SESSION_NAME!=undefined?t[BIZAGI_SESSION_NAME]=r.properties.sessionId:t.JSESSIONID=r.properties.sessionId}catch(u){t.JSESSIONID=r.properties.sessionId}return t},getUploadXpath:function(){return this.properties.xpath},checkRequired:function(n){var t=this,i=t.properties;if(bizagi.util.parseBoolean(i.required))if(t.grid&&t.grid.properties.inlineAdd==!0){if(!t.hasValue()&&!t.getControl().parents("tr").data("new-row"))return t.setRenderRequired(n,i),!1}else if(!t.hasValue())return t.setRenderRequired(n,i),!1;return!0},setRenderRequired:function(n,t){var i=this;message=i.getResource("render-required-text").replaceAll("#label#",t.displayName);n.push({xpath:t.xpath,message:message})}});
bizagi.rendering.upload.extend("bizagi.rendering.upload.offline",{},{renderControl:function(){var t,u;this.errorDiv=document.createElement("div");this.errorDiv.id="alert-file-upload";var n=this,i=n.properties,f=n.renderFactory.getTemplate("upload.noFlash"),e=$.fasttmpl(f,{xpath:bizagi.util.encodeXpath(n.getUploadXpath()),editable:n.filesCount<i.maxfiles&&i.editable,haveFiles:n.filesCount!=0}),r="";for(t=0;t<n.filesCount;t++)u=n.renderUploadItem(n.files[t]),r+=u;return n.replaceFilesHtml(e,r)},postRender:function(){var t=this,n=t.getControl();n.addClass("ui-bizagi-render-display-block");n.addClass("ui-bizagi-render-upload")},configureHandlers:function(){bizagi.rendering.uploadHtml5.prototype.configureHandlers.call(this)},openUploadDialog:function(){bizagi.rendering.uploadHtml5.prototype.openUploadDialog.call(this)},renderUploadItem:function(n){var t=this,i=t.properties,r=t.getMode(),u=t.renderFactory.getTemplate("uploadItem");return $.fasttmpl(u,{url:"javascript:void(0);",allowDelete:i.allowDelete,filename:n[0].value,id:bizagi.util.randomNumber(),mode:r})},collectData:function(n){this.filesCount>0&&(n[this.properties.xpath]=this.files)},processUploadFile:function(){var n=this,r=n.getControl(),u=n.dialogBox,f=$("form",u),t=$("input:file",f),i=new FileReader;i.onload=function(i){var o=i.target.result,u=$(".ui-bizagi-render-upload-wrapper",r),s=t.get(0).files[0],h=o.replace(/^data:.*;base64,/,""),f=[{xpath:"fileName",DataType:"15",value:s.name},{xpath:"data",DataType:"19",value:h}],e;n.files.push(f);n.filesCount=n.filesCount+1;n.setValue(n.files);e=n.renderUploadItem(f);u.after($(e));n.filesCount>=n.properties.maxfiles&&u.remove();n.triggerRenderChange();n.closeUploadDialog();$("#no-files",n.getControl()).hide()};i.readAsDataURL(t.get(0).files[0])},checkMaxSize:function(){return bizagi.rendering.uploadHtml5.prototype.checkFileTypes.call(this)},checkFileTypes:function(){return bizagi.rendering.uploadHtml5.prototype.checkFileTypes.call(this)},stringEndsWithValidExtension:function(){return bizagi.rendering.uploadHtml5.prototype.stringEndsWithValidExtension.apply(this,arguments)},closeUploadDialog:function(){var n=this;n.dialogBox.dialog("destroy");n.dialogBox.remove()},canBeSent:function(){return!0}});
bizagi.rendering.upload.extend("bizagi.rendering.uploadNoFlash",{},{renderControl:function(){for(var u,f,n=this,i=n.properties,e=n.renderFactory.getTemplate("upload.noFlash"),o=$.fasttmpl(e,{xpath:bizagi.util.encodeXpath(n.getUploadXpath()),editable:i.editable,haveFiles:n.filesCount!=0,allowSendInMail:i.allowSendInMail}),r="",t=0;t<n.filesCount;t++)u={id:n.files[t][0],fileName:n.files[t][1]},f=n.renderUploadItem(u),r+=f;return n.replaceFilesHtml(o,r)},postRender:function(){var n=this,t=n.getControl();n.isClicked=!1;n.properties.allowSendInMail&&n.bindEmailDialog();n.checkMaxFiles();t.addClass("ui-bizagi-render-display-block");t.addClass("ui-bizagi-render-upload")},postRenderReadOnly:function(){var n=this,t=n.getControl();n.properties.allowSendInMail&&n.bindEmailDialog();t.addClass("ui-bizagi-render-display-block");t.addClass("ui-bizagi-render-upload")},bindEmailDialog:function(){var n=this,t=n.getControl(),i=n.getXpathContext()||"",r=n.properties.xpath,u=n.properties.orientation=="rtl"?"dialog-send-email-rtl":"dialog-send-email";$(".ui-bizagi-render-upload-sendmail",t).bizagiSendEmail({tmpl:n.renderFactory.getTemplate(u),value:n.value,self:n,dataService:n.dataService,properties:n.properties,xpath:r,xpathContext:i})},bindExternalPopup:function(){var n=this,u=n.getControl(),f=n.getParams(),i=n.properties,e=n.grid?!0:!1,t={idCase:f.idCase||bizagi.context.idCase,idWorkitem:f.idWorkitem||bizagi.context.idWorkitem,field:i.xpath.split(".")[i.xpath.split(".").length-1]},r=n.getXpathContext();e||r!=""?typeof r=="string"?$.extend(t,{xPath:r.split("[")[0]+"."+i.xpath}):$.extend(t,{xPath:n.grid.properties.xpath+"."+i.xpath}):$.extend(t,{xPath:i.xpath});$(".ui-bizagi-render-upload-sendmail",u).tooltip();$(".ui-bizagi-render-upload-sendmail",u).click(function(){var i="App/Upload/SendAttachedDocs.aspx?";i+="idCase="+t.idCase;i+="&idWorkitem="+t.idWorkitem;i+="&xPath="+t.xPath;i+="&field="+t.field;n.dataService.getCaseNumber({idCase:t.idCase}).done(function(r){var u=r.caseNumber,e,f;if(u=u?u:t.idCase,i+="&radNumber="+u,e=[],n.value)for(f=0;f<n.value.length;f++)e.push(n.value[f][1]);n.currentPopup="genericiframe";$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:i,injectCss:[".ui-bizagi-old-render*",".ui-bizagi-old-render-upload"],modalParameters:{title:"Send attached documents",id:"sendEmail"},afterLoad:function(n){var i=document.getElementById("btnClose"),f,r,u,t;if(i&&(i.style.display="none"),i=document.getElementById("btnCloseConfirm"),i&&(i.style.display="none"),n&&n.values&&(f=n.values,r=document.getElementsByTagName("label"),r))for(u=0;u<r.length;u++)t=r[u],t.innerText!==undefined&&f.indexOf(t.innerText)===-1&&(t.control?(t.control.checked=!1,t.parentElement.style.display="none"):(t.previousSibling.checked=!1,t.parentElement.style.display="none")),t.textContent!==undefined&&f.indexOf(t.textContent)===-1&&(t.control?(t.control.checked=!1,t.parentElement.style.display="none"):(t.previousSibling.checked=!1,t.parentElement.style.display="none"))},afterLoadParams:{values:e}})})})},configureHandlers:function(){var n=this,i=n.getControl(),t=n.properties;n._super();n.pluginUpload=$(".ui-bizagi-render-upload-wrapper",i).bizagiUpload({renderReference:this,dialogTemplate:n.renderFactory.getTemplate("upload.dialog"),properties:{url:t.addUrl,xpath:t.xpath,idRender:t.id,xpathContext:n.getXpathContext()||t.xpathContext,idPageCache:t.idPageCache,idSession:t.sessionId,validExtensions:t.validExtensions,maxSize:t.maxSize,contexttype:t.contexttype,networkSpeed:networkSpeed()},onUploadFileCompletedCallback:n.onUploadFileCompleted,onChangeFile:n.onChangeFile,onCheckMaxSize:n.checkMaxSize,maxAllowedFiles:t.maxfiles,uploadedFiles:n.filesCount,dialogTitle:n.getResource("render-upload-link-label")});i.delegate(".ui-bizagi-render-upload-item-delete","click",function(){var t=$(this).parent(".ui-bizagi-render-upload-item"),i=t.data();$.when(n.deleteUploadItem(t,i.id)).done(function(){t.hide();t.remove();n.checkMaxFiles();n.setValue(n.files,!1);n.triggerRenderChange()})})},openUploadDialog:function(){var n=this,t=n.properties,f=window.document,i,r,u;n.isClicked=!1;i=n.dialogBox=$("<div class='ui-bizagi-component-loading'/>");i.empty();i.appendTo("body",f);r={};r[n.getResource("render-upload-dialog-select")]=function(t){t.stopPropagation();n.isClicked||(n.isClicked=!0,n.checkMaxSize()&&n.checkFileTypes()&&!n.maxFilesLimit()?$.when(n.processUploadFile()).done(function(t){n.onUploadFileCompleted(t);n.closeUploadDialog()}):n.isClicked=!1)};r[n.getResource("text-cancel")]=function(){n.closeUploadDialog()};i.dialog({width:500,height:350,title:n.getResource("render-upload-link-label"),modal:!0,buttons:r,close:function(){n.closeUploadDialog()},resizeStop:function(t,i){n.form&&n.form.resize(i.size)}});u=n.renderFactory.getTemplate("upload.dialog");$.tmpl(u,{url:t.addUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,idSession:t.sessionId,validExtensions:t.validExtensions.replace(";",","),maxSize:t.maxSize,contexttype:t.contexttype}).appendTo(i);$(".ui-bizagi-loading-message").remove()},processUploadFile:function(){var t=this,i=new $.Deferred,f=t.dialogBox,r=$("form",f),n=$("iframe",r),u=function(){var r,f;try{r="";n[0].contentWindow&&(f=bizagi.util.isIE8()?$(n[0].contentWindow.document.body):$(n[0].contentWindow.eval("document.body")),r=f.text());r.length>0?i.resolve(r):setTimeout(u,50)}catch(e){t.closeUploadDialog();window.alert("Error:"+e.toString())}};return u(),r.submit(),i.promise()},closeUploadDialog:function(){var n=this;n.isClicked=!1;n.dialogBox.dialog("destroy");n.dialogBox.remove()},maxFilesLimit:function(){var n=this,t=n.properties;return n.filesCount>=t.maxfiles?!0:!1},checkMaxFiles:function(){var n=this,r=n.properties,t=n.getControl(),i=$(".ui-bizagi-render-upload-wrapper",t);n.maxFilesLimit()?(bizagi.util.cssExtended(i.find("a"),"display:none!important"),n.enabled=!1):(bizagi.util.cssExtended(i.find("a"),"display:block!important"),n.enabled=!0);n.filesCount==0?$("#no-files",t).show():$("#no-files",t).hide()},onChangeFile:function(n){var t=this,i=0,r,u,f=t.properties.maxSize;if(n)for(r=n.length;i<r;)if(u=n[i++],u.size>f){t.previousCheck=!1;return}t.previousCheck=!0},onUploadFileCompleted:function(n,t){var i=n,s=i.getControl(),h=$(".ui-bizagi-render-upload-wrapper",s),r,f,e,o,u;t=t.replace(/<.+>({.*})\r?\n?.*<.+>/gm,"$1");try{r=JSON.parse(t)}catch(c){f=[{toFind:"Maximum request length",message:i.getResource("render-upload-alert-maxsize").replace("{0}",i.properties.maxSize)}];$.each(f,function(n,i){t.indexOf(i.toFind)>=0&&!r&&(r={type:"error",message:i.message})});r||(r={type:"error",message:"Error:"+r})}r.type!="error"?(e=i.renderUploadItem({id:r.id,fileName:r.fileName}),o=$(e),$(o).insertBefore(h),i.filesCount=i.filesCount+1,u=i.files.slice(),u.push([r.id,r.fileName]),i.checkMaxFiles(),i.setValue(u,!1),i.triggerRenderChange(),typeof i.grid!="undefined"&&typeof i.grid.properties!="undefined"&&(i.grid.properties.canBeExported=!0)):(r.message=="Error:undefined"&&t.indexOf("HTTP Error 404.13")>-1&&(r.message=i.getResource("render-upload-iis-maxsize")),bizagi.showMessageBox(r.message))},checkMaxSize:function(n){var t=n,r=t.properties,u=t.dialogBox,i=$("input[type=file]",u).get(0);return i.files!=undefined?i.files.length>0?i.files[0].size==0?(t.showError(t.getResource("render-upload-error-file-empty").replace("%s",i.files[0].name)),!1):i.files[0].size>r.maxSize?(t.showError(t.getResource("render-upload-alert-maxsize").replace("{0}",r.maxSize)),!1):!0:(t.showError(t.getResource("render-required-upload").replace("#label#","")),!1):bizagi.util.isIE()?i.value!==""&&i.value?t.previousCheck?!0:document.documentMode>9?(t.showError(t.getResource("render-upload-alert-maxsize").replace("{0}",r.maxSize)),!1):!0:(t.showError(t.getResource("render-required-upload").replace("#label#","")),!1):!0},checkFileTypes:function(){var n=this,t=n.properties,r=n.dialogBox,u=$("input[type=file]",r).val(),i;return t.validExtensions&&t.validExtensions.length>0&&(i=t.validExtensions.replaceAll("*.","").split(";"),!n.stringEndsWithValidExtension(u,i,!0))?(n.showError(n.getResource("render-upload-allowed-extensions")+t.validExtensions),!1):!0},stringEndsWithValidExtension:function(n,t,i){if(i==!1&&n.length==0)return!0;for(var r=0;r<t.length;r++)if(t[r].toLowerCase()=="*"||n.toLowerCase().endsWith(t[r].toLowerCase()))return!0;return!1},showError:function(n){var i=this,t=$("#alert-file-upload",i.dialogBox);t.empty();t.show();t.html(n)},cleanData:function(){var n=this;n.setValue(null);n.clearDisplayValue()},clearDisplayValue:function(){var n=this,i=n.getControl(),t=i.find(".ui-bizagi-render-upload-item"),r=t.length-1;$.each(t,function(t,i){var r=$(i),u=r.data();u&&$.when(n.deleteUploadItem(r,u.id)).done(function(){r.remove();n.triggerRenderChange()})});t.hide();n.filesCount=0;n.checkMaxFiles()},setDisplayValue:function(n){var t=this,u=t.properties,r,i;u.editable&&n&&n.length===0&&(r=t.getControl(),i=r.find(".ui-bizagi-render-upload-item"),i.hide(),i.remove(),t.checkMaxFiles());t._super(n)}});
bizagi.rendering.upload.extend("bizagi.rendering.uploadHtml5",{},{renderControl:function(){var t,u,f;this.errorDiv=document.createElement("div");this.errorDiv.id="alert-file-upload";var n=this,i=n.properties,e=n.renderFactory.getTemplate("upload.noFlash"),o=$.fasttmpl(e,{xpath:bizagi.util.encodeXpath(n.getUploadXpath()),editable:n.filesCount<i.maxfiles&&i.editable,haveFiles:n.filesCount!=0}),r="";for(t=0;t<n.filesCount;t++)u={id:n.files[t][0],fileName:n.files[t][1]},f=n.renderUploadItem(u),r+=f;return n.replaceFilesHtml(o,r)},postRender:function(){var t=this,n=t.getControl();n.addClass("ui-bizagi-render-display-block");n.addClass("ui-bizagi-render-upload");n.find("li").css("min-width","50px;")},configureHandlers:function(){var n=this,t=n.getControl(),i;n._super();i=$(".ui-bizagi-render-upload-wrapper",t);i.click(function(){n.openUploadDialog()});t.delegate(".ui-bizagi-render-upload-item-delete","click",function(){var i=$(this).parent(".ui-bizagi-render-upload-item"),r=i.data();$.when(n.deleteUploadItem(i,r.id)).done(function(){i.hide();i.remove();n.files.length==0&&$("#no-files",t).css("display","block");n.setValue(n.files,!1);n.triggerRenderChange()})})},openUploadDialog:function(){var n=this,u=n.properties,e=window.document,t=n.dialogBox=$("<div class='ui-bizagi-component-loading-upload'/>"),r,f,i;t.appendTo("body",e);r={};r[n.getResource("render-upload-dialog-select")]=function(){$("label",t).text()!=""&&n.processUploadFile()};r[n.getResource("text-cancel")]=function(){n.closeUploadDialog()};t.dialog({width:500,height:250,resizable:!1,maximize:!1,title:n.getResource("render-upload-link-label"),modal:!0,buttons:r,close:function(){n.closeUploadDialog()},resizeStop:function(t,i){n.form&&n.form.resize(i.size)}});f=n.renderFactory.getTemplate("uploadHtml5");$.tmpl(f,{url:u.addUrl,xpath:u.xpath}).appendTo(t);i=n.progress=document.createElement("progress");i.max="100";i.value="0";i.id="determinateProgress";i.style.display="none";$(i).appendTo(t);$("button",t).button();$("button",t).click(function(){$("form",t)[0].reset();n.errorDiv.innerHTML="";$("label",t).text("");$("input[type=file]",t).trigger("click")});$("input[type=file]",t)[0].onchange=function(){if(n.checkFileTypes()&&n.checkMaxSize()){var i=$("input[type=file]",t).val(),r=i.lastIndexOf("\\")>0?i.lastIndexOf("\\")+1:0;i=i.substring(r,i.length);$("label",t).text(i)}}},processUploadFile:function(){var n=this,e=n.dialogBox,o=$("form",e),u=$("input:file",o),r=n.getFormContainer(),t=new FormData,i,f;t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",n.getUploadXpath());t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",n.properties.id);t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",n.properties.xpathContext);t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+n.Class.BA_PAGE_CACHE,n.properties.idPageCache);t.append(n.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId);t.append(n.properties.xpath,u.get(0).files[0]);n.properties.contexttype?t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",n.properties.contexttype):"";try{BIZAGI_SESSION_NAME!=undefined?t.append(BIZAGI_SESSION_NAME,r.properties.sessionId):t.append("JSESSIONID",r.properties.sessionId)}catch(s){t.append("JSESSIONID",r.properties.sessionId)}typeof bizagi.context.isOfflineForm=="undefined"||bizagi.context.isOfflineForm==!1?(i=new XMLHttpRequest,i.onload=function(){var i,t,u,r;control=n.getControl();i=$(".ui-bizagi-render-upload-wrapper",control);try{t=JSON.parse(this.response);t.type!="error"?(u=n.renderUploadItem({id:t.id,fileName:t.fileName}),n.files.push([t.id,t.fileName]),i.after($(u)),n.filesCount=n.filesCount+1,n.filesCount>=n.properties.maxfiles&&i.remove(),r=n.files.slice(),r.push([t.id,t.fileName]),n.setValue(r,!1),$("#no-files",control).css("display","none"),n.triggerRenderChange(),n.closeUploadDialog()):bizagi.showMessageBox(t.message)}catch(e){bizagi.showMessageBox("Error")}n.progress.style.display="none"},i.onprogress=function(t){t.lengthComputable&&(n.progress.value=t.loaded/t.total*100,n.progress.textContent=n.progress.value)},i.onerror=function(n){bizagi.logError("Error: "+n.message,n)},i.onabort=function(n){bizagi.log("Aborted succeded: ",n,"success")},i.open("POST",n.properties.addUrl,!0),i.send(t),n.progress.style.display="block"):(f=new FileReader,f.onload=function(t){var o=t.target.result,i=$(".ui-bizagi-render-upload-wrapper",n.getControl()),r=u.get(0).files[0],f=(new Date).toISOString(),e=n.renderUploadItem({id:f,fileName:r.name});n.files.push([f,r.name]);i.after($(e));n.filesCount=n.filesCount+1;n.filesCount>=n.properties.maxfiles&&i.remove();n.triggerRenderChange();n.closeUploadDialog();$("#no-files",n.getControl()).hide()},f.readAsDataURL(u.get(0).files[0]))},checkMaxSize:function(){var n=this,i=n.properties,t=n.dialogBox,r=$("input[type=file]",t).get(0);return r.files.length>0?r.files[0].size>i.maxSize?(n.errorDiv.innerHTML=n.getResource("render-upload-alert-maxsize").replace("{0}",i.maxSize),$(n.errorDiv).appendTo(t),!1):!0:(n.errorDiv.innerHTML=n.getResource("render-required-upload").replace("#label#",""),$(n.errorDiv).appendTo(t),!1)},checkFileTypes:function(){var n=this,t=n.properties,i=n.dialogBox,u=$("input[type=file]",i).val(),r;return t.validExtensions&&t.validExtensions.length>0&&(r=t.validExtensions.replaceAll("*.","").split(";"),!n.stringEndsWithValidExtension(u,r,!0))?(n.errorDiv.innerHTML=n.getResource("render-upload-allowed-extensions")+t.validExtensions,$(n.errorDiv).appendTo(i),!1):!0},stringEndsWithValidExtension:function(n,t,i){if(i==!1&&n.length==0)return!0;for(var r=0;r<t.length;r++)if(t[r].toLowerCase()=="*"||n.toLowerCase().endsWith(t[r].toLowerCase()))return!0;return!1},closeUploadDialog:function(){var n=this;n.dialogBox.dialog("destroy");n.dialogBox.remove()}});
bizagi.rendering.upload.extend("bizagi.rendering.upload.offline",{},{renderControl:function(){var t,u;this.errorDiv=document.createElement("div");this.errorDiv.id="alert-file-upload";var n=this,i=n.properties,f=n.renderFactory.getTemplate("upload.noFlash"),e=$.fasttmpl(f,{xpath:bizagi.util.encodeXpath(n.getUploadXpath()),editable:n.filesCount<i.maxfiles&&i.editable,haveFiles:n.filesCount!=0}),r="";for(t=0;t<n.filesCount;t++)u=n.renderUploadItem(n.files[t]),r+=u;return n.replaceFilesHtml(e,r)},postRender:function(){var t=this,n=t.getControl();n.addClass("ui-bizagi-render-display-block");n.addClass("ui-bizagi-render-upload")},configureHandlers:function(){bizagi.rendering.uploadHtml5.prototype.configureHandlers.call(this)},openUploadDialog:function(){bizagi.rendering.uploadHtml5.prototype.openUploadDialog.call(this)},renderUploadItem:function(n){var t=this,i=t.properties,r=t.getMode(),u=t.renderFactory.getTemplate("uploadItem");return $.fasttmpl(u,{url:"javascript:void(0);",allowDelete:i.allowDelete,filename:n[0].value,id:bizagi.util.randomNumber(),mode:r})},collectData:function(n){this.filesCount>0&&(n[this.properties.xpath]=this.files)},processUploadFile:function(){var n=this,r=n.getControl(),u=n.dialogBox,f=$("form",u),t=$("input:file",f),i=new FileReader;i.onload=function(i){var o=i.target.result,u=$(".ui-bizagi-render-upload-wrapper",r),s=t.get(0).files[0],h=o.replace(/^data:.*;base64,/,""),f=[{xpath:"fileName",DataType:"15",value:s.name},{xpath:"data",DataType:"19",value:h}],e;n.files.push(f);n.filesCount=n.filesCount+1;n.setValue(n.files);e=n.renderUploadItem(f);u.after($(e));n.filesCount>=n.properties.maxfiles&&u.remove();n.triggerRenderChange();n.closeUploadDialog();$("#no-files",n.getControl()).hide()};i.readAsDataURL(t.get(0).files[0])},checkMaxSize:function(){return bizagi.rendering.uploadHtml5.prototype.checkFileTypes.call(this)},checkFileTypes:function(){return bizagi.rendering.uploadHtml5.prototype.checkFileTypes.call(this)},stringEndsWithValidExtension:function(){return bizagi.rendering.uploadHtml5.prototype.stringEndsWithValidExtension.apply(this,arguments)},closeUploadDialog:function(){var n=this;n.dialogBox.dialog("destroy");n.dialogBox.remove()},canBeSent:function(){return!0}});
bizagi.rendering.render.extend("bizagi.rendering.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{initializeData:function(n){var i=this,t,r,u,f,e;if(this._super(n),i=this,t=i.properties,t.maxSize=Number(t.maxSize)||(typeof BIZAGI_SETTINGS!="undefined"&&typeof BIZAGI_SETTINGS.UploadMaxFileSize!="undefined"?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.maxFiles=Number(t.maxfiles)||999,t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(r=t.validExtensions.split(";"),u=0;u<r.length;u++)r[u]="*."+r[u];t.validExtensions=r.join(";")}t.addUrl=i.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=uploadECMFile";t.editUrl=i.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=updateECMFileContent";t.deleteUrl=t.deleteUrl||undefined;t.allowDelete=bizagi.util.parseBoolean(t.allowDelete)!==null?bizagi.util.parseBoolean(t.allowDelete):!0;t.q_xpath=bizagi.util.encodeXpath(t.xpath);t.showMetadata=t.showMetadata===undefined||t.showMetadata===null?!0:bizagi.util.parseBoolean(t.showMetadata);f=this.getResource("dateFormat");e=this.getResource("timeFormat");t.displayValue="";t.showTime=t.showTime!==undefined?bizagi.util.parseBoolean(t.showTime):!1;t.dateFormat=t.dateFormat||f;t.timeFormat=t.timeFormat||e;t.fullFormat=t.dateFormat;i.files=t.value||[];i.filesCount=i.files.length;t.xpathContext=this.parent.properties.xpathContext||t.xpathContext||""},renderControl:function(n,t){var i=this,e=i.properties,o=i.renderFactory.getTemplate("ecm"),s=i.getMode(),u=new $.Deferred,r,f;return e.value=t?[[t.idFileUpload,t.fileName]]:i.value,r=$.fasttmpl(o,e,{getFileExtension:i.getFileExtension,isImage:i.isImage}),i.properties.value!=undefined?(f=i.properties.value.length,f==0&&u.resolve(r),$.each(i.properties.value,function(n,e){var o={},h;o.idFileUpload=e[0];o.fileName=e[1];o.idPageCache=i.properties.idPageCache;o.xpathContext=i.getXpathContext();o.xPath=i.properties.xpath;o.editable=i.properties.editable;o.idAttrib=i.properties.idAttrib;h=i.getFormContainer();h&&h.properties&&h.properties.sessionId&&(o.sessionId=h.properties.sessionId);s=="execution"&&$.when(i.renderFileLayout(o,t)).done(function(n){f--;bizagi.loader.productBuildToAbout&&bizagi.loader.productBuildToAbout.indexOf("10.4")==0&&(n=n.replaceAll("Handlers/MetadataFile","Handlers/Metadata"));r=i.replaceItemHtml(r,i.properties.id+"-"+o.idFileUpload,n);f==0&&u.resolve(r)})})):u.resolve(r),u.promise()},replaceItemHtml:function(n,t,i){return n.replace("{{"+t+"}}",i)},renderFileLayout:function(n,t){var i=this,u=i.getFormContainer(),f=i.renderFactory.getTemplate("ecm-metadata"),e=i.getControl(),r=$.Deferred();return $.when(i.dataService.getECMMetadata(n),t?[t]:i.dataService.getFileProperties(n)).done(function(t,e){e[0].data=n;e[0].xpathContext=e[0].xpathContext||u.properties.xpathContext||"";e[0].xpath=i.properties.xpath;t[0].filename=n.fileName;t[0].url=i.buildItemUrl(e[0]);t[0].ecm_ecmStatus=e[0].ecmStatus;t[0].ecm_isVisible=e[0].isVisible;t[0].ecm_allowUpdateMetadata=e[0].allowUpdateMetadata;t[0].ecm_allowDelete=e[0].allowDelete;t[0].ecm_allowUpdateContent=e[0].allowUpdateContent;t[0].ecm_allowView=e[0].allowView;t[0].ecm_allowCheckOut=e[0].allowCheckOut;t[0].ecm_allowCancelCheckOut=e[0].allowCancelCheckOut;t[0].ecm_allowEdit=n.editable&&e[0].allowEdit;t[0].ecm_ecmStatus=e[0].ecmStatus;t[0].idFileUploads=e[0].idFileUpload;t[0].xpath=e[0].xpath;t[0].value=bizagi.util.parseBoolean(e[0].value);t[0].deviceType=bizagi.detectDevice();var o=$.fasttmpl(f,t[0]);r.resolve(o)}),r.promise()},isImage:function(n){var t=this,i=t.getFileExtension(n);return["JPG","JPEG","GIF","PNG","BMP"].indexOf(i.toUpperCase())>-1?!0:!1},replaceFilesHtml:function(n,t){return n.replace("{{files}}",t)},renderReadOnly:function(){return this.renderControl()},canBeSent:function(){return!1},buildItemUrl:function(n){var t=this,i=bizagi.cookie("JSESSIONID");return t.dataService.getECMFileUrl({idFileUpload:n.idFileUpload,xPath:n.xpath,xpathContext:n.xpathContext,idAttrib:n.data.idAttrib,idPageCache:t.properties.idPageCache,fileName:n.data.fileName.replace(/ /g,"_"),p_sessionId:i,sessionId:n.data.sessionId||""})},buildAddParams:function(){var i=this,t=i.properties,n={};return n.fileExt=t.validExtensions,n.fileDesc=t.validExtensions?i.getResource("render-upload-allowed-extensions")+t.validExtensions:"",n.xPath=t.xpath,n.idAttrib=t.idAttrib,n.xpathContext=t.xpathContext,n.metaValues=[],n[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=t.idPageCache,n},getFileExtension:function(n){return n=n||"",n.split(".").pop()},setValue:function(n,t){var i=this,r=i.properties;i._super(n,t);i.files=r.value||[];i.filesCount=i.files.length?i.files.length:r.value},getXpathContext:function(){var n=this;return n.properties.xpathContext||""},getUploadXpath:function(){var n=this;return this.properties.xpath},deleteUploadItem:function(n,t){var i=this,r=i.properties,u={idFileUpload:t,xPath:r.xpath,idAttrib:r.idAttrib,idPageCache:r.idPageCache,xpathContext:i.getXpathContext()};return i.dataService.deleteECMFile(u).pipe(function(){i.filesCount=i.filesCount-1;i.files=$.grep(i.files,function(n){return n[0]!=t})})}});
bizagi.rendering.render.extend("bizagi.rendering.yesno",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.value=typeof t.value!="undefined"?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("yesno"),i=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(t,{id:i})},getDisplayValue:function(){var t=this,n=t.getValue();return bizagi.util.parseBoolean(n)==!0?this.getResource("render-boolean-yes"):bizagi.util.parseBoolean(n)==!1?this.getResource("render-boolean-no"):""}});
bizagi.rendering.render.extend("bizagi.rendering.letter",{},{initializeData:function(n){var t=this;this._super(n);this.letterOpened=!1},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("letter");return $.fasttmpl(t)},renderReadOnly:function(){var n=this,t=n.renderFactory.getTemplate("letter.readonly");return $.fasttmpl(t)},getLetterContent:function(){var n=this,t=n.properties;return n.letterOpened=!0,n.dataService.getLetterContent({url:t.getUrl,idRender:t.id,xpath:n.getXpath(),xpathContext:n.getContextXpath(),idPageCache:t.idPageCache})},saveLetterContent:function(n){var t=this,i=t.properties;return t.dataService.saveLetterContent({url:i.saveUrl,idRender:i.id,xpath:t.getXpath(),xpathContext:t.getContextXpath(),idPageCache:i.idPageCache,content:n})},getCanGenerateLetter:function(){var n=this,t=n.properties;return n.dataService.getCanGenerateLetter({idRender:t.id,xpath:n.getXpath(),xpathContext:n.getContextXpath(),idPageCache:t.idPageCache})},saveForm:function(){var n=this,t=n.getFormContainer();return t.saveForm()},isValid:function(n){var i=this,t=i.properties,r;return bizagi.util.parseBoolean(t.visible)==!1?!0:bizagi.util.parseBoolean(t.editable)==!1?!0:(i.setValidationMessage(""),t.required&&i.letterOpened==!1)?(r=i.getResource("render-letter-required-text").replaceAll("#label#",t.displayName),n.push({xpath:t.xpath,message:r}),!1):!0},getXpath:function(){return this.properties.xpath},getContextXpath:function(){return this.properties.xpathContext}});
bizagi.rendering.render.extend("bizagi.rendering.formLink",{},{initializeData:function(n){var t=this;this._super(n);this.properties.displayType="value";this.properties.maximized=bizagi.util.parseBoolean(this.properties.maximized)!=null?bizagi.util.parseBoolean(this.properties.maximized):!1;this.calculateInitialLayoutProperties()},renderControl:function(){var t=this,n=t.properties,i=t.renderFactory.getTemplate("link");return $.fasttmpl(i,{id:n.id,align:n.valueAlign,displayName:n.displayName,value:n.value,likeButton:bizagi.util.parseBoolean(n.likeButton)||!1})},renderReadOnly:function(){var n=this;return n.renderControl()},postRenderReadOnly:function(){var n=this;n.configureHandlers()},submitEditRequest:function(){var t=this,n=t.properties;return n.editable==!1&&!n.value?null:t.dataService.editLinkForm({url:n.editUrl,idRender:n.id,xpath:t.getFormLinkXpath(),xpathContext:n.xpathContext,idPageCache:n.idPageCache})},submitSaveRequest:function(n){var i=this,t=i.properties,r;return t.editable==!1&&!t.value?null:(r=i.getFormLinkXpath(),i.dataService.saveLinkForm({url:t.saveUrl,idRender:t.id,xpathContext:t.xpathContext==undefined||t.xpathContext==""?r:r?t.xpathContext+"."+r:t.xpathContext,submitData:n}).done(function(n){var t=!0;n&&n.type=="validationMessages"&&(t=!1);t&&i.submitOnChange({})}))},submitRollbackRequest:function(){var t=this,n=t.properties;return n.editable==!1&&!n.value?null:t.dataService.rollbackLinkForm({url:n.rollbackUrl,idRender:n.id,xpath:t.getFormLinkXpath(),xpathContext:n.xpathContext,idPageCache:n.idPageCache})},submitCommitRequest:function(){var t=this,n=t.properties;return n.editable==!1&&!n.value?null:t.dataService.commitLinkForm({url:n.commitUrl,idRender:n.id,xpath:t.getFormLinkXpath(),xpathContext:n.xpathContext,idPageCache:n.idPageCache})},submitCheckpointRequest:function(){var t=this,n=t.properties;return n.editable==!1&&!n.value?null:t.dataService.sendCheckpoint({url:n.checkpointUrl,idRender:n.id,xpath:t.getFormLinkXpath(),xpathContext:n.xpathContext,idPageCache:n.idPageCache})},isValid:function(){},getFormLinkXpath:function(){return this.properties.xpath},canBeSent:function(){return!1},setDisplayValue:function(){},changeColor:function(n){var t=this,i=t.getControl(),r=t.getLabel();i&&r&&(n!="none"?(t.getControl().find("a").css("color",n,"!important"),typeof t.getControl().find("a").style=="function"&&t.getControl().find("a").style("color",n,"!important")):(t.getControl().find("a").css("color",""),typeof t.getControl().find("a").style=="function"&&t.getControl().find("a").style("color","")));t._super(n)}});
bizagi.rendering.render.extend("bizagi.rendering.document",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.validate=bizagi.util.parseBoolean(t.validate)!=null?bizagi.util.parseBoolean(t.validate):!1;t.caption?(t.caption=bizagi.util.trim(t.caption),t.caption.length==0&&(t.caption=this.getResource("render-documentgenerator-button-label"))):t.caption=this.getResource("render-documentgenerator-button-label")},renderControl:function(){var t=this,i,o,s,r;t.preRenderControl();var n=t.properties,h=t.getMode(),f=n.value?n.value.length==0:!0,e=n.downloadalldocuments=n.downloadalldocuments?n.downloadalldocuments:!1,c=n.allowGenerate!==undefined?n.allowGenerate:!0,l=t.renderFactory.getTemplate(t.getTemplate()),u="",a=n.value?n.value.length:0,v=t.getControlHtml(l,h,e,c,n,f);for(i=0;i<a;i++)o={id:n.value[i][0],fileName:n.value[i][1]},r=t.renderDocumentItem(o),u+=r;return!f&&e&&(s={fileName:t.getResource("render-document-downloadalldocuments")},r=t.renderAllDocumentDownload(s),u+=r),t.replaceFilesHtml(v,u)},getControlHtml:function(n,t,i,r,u,f){var e=this;return $.fasttmpl(n,{noActivateButton:!1,editable:t!="execution",downloadalldocuments:i,required:u.required,allowgenerate:r,xpath:e.getXpath(u.xpath),append:u.append?u.append:!1,caption:u.caption,noFiles:f,allowSendInMail:u.allowSendInMail})},getXpath:function(n){return n},preRenderControl:function(){},activateButton:function(){return!0},getDocumentXpath:function(n){return n},getContextXpath:function(){return this.properties.xpathContext},renderDocumentItem:function(n){var t=this,f=t.properties,i=t.getMode(),u=t.renderFactory.getTemplate(t.getTemplateItem()),r=t.buildItemUrl(n);return i!="execution"&&(r="javascript:void(0);"),$.fasttmpl(u,{url:r,allowDelete:t.properties.allowDelete,filename:n.fileName,mode:i,joined:!1})},buildItemUrl:function(n){var t=this,i=t.properties,r=t.getFormContainer();return t.dataService.getUploadFileUrl({idRender:i.id,xpath:t.getDocumentXpath(i.xpath),xpathContext:t.getContextXpath(),idPageCache:i.idPageCache,fileId:n.id,sessionId:t.getSessionId()})},buildAllDocumentsUrl:function(){var n=this,t=n.properties;return n.dataService.getAllDocumentsDownloadUrl({xpath:n.getDocumentXpath(t.xpath),xpathContext:n.getContextXpath(),idPageCache:t.idPageCache,idCase:t.caseId,idWorkItem:t.workitemId,sessionId:n.getSessionId()})},postRender:function(){return self._super(),"<div><\/div>"},postRenderReadOnly:function(){var n=this,r=n.getMode(),t,i;r!="design"&&(t=n.getControl(),i=n.renderControl(),t.append(i),n.updateControlForPrintMode(t),n.postRender())},validateContainer:function(){var n=this,t=n.getFormContainer();return t.validateForm()},save:function(){var n=this,t=n.getFormContainer();return t.saveForm()},replaceFilesHtml:function(n,t){return n.replace("{{files}}",t)},canBeSent:function(){return!1},isValid:function(n){var t=this,i=t.properties,r;return bizagi.util.parseBoolean(i.visible)==!1?!0:bizagi.util.parseBoolean(i.editable)==!1?!0:(t.setValidationMessage(""),i.required&&!i.buttonExecuted&&t.value)?t.value.length>0?!0:(r=t.getResource("render-document-required-text"),n.push({xpath:i.xpath,message:r}),!1):!0},configureHandlers:function(){var n=this,t=n.getControl(),r=n.getMode(),i;n._super();i=$(".ui-bizagi-button-documentgenerator",t);r=="execution"&&i.click(function(t){if(!t.isPropagationStopped()){if(t.stopPropagation(),n.properties.buttonExecuted=!0,n.properties.validate){var i=n.validateContainer();i&&n.documentTemplateGenerate()}else n.documentTemplateGenerate();n.properties.buttonExecuted=!1}});$(".ui-bizagi-document-preview",t).click(function(t){t.isPropagationStopped()||(t.stopPropagation(),n.showDocumentPreview($(this).data("url"),$(this).data("filename")))});$(".ui-bizagi-container-documents-item-delete",t).click(function(t){t.isPropagationStopped()||(t.stopPropagation(),n.deleteDocumentTemplate($(this).data("filename")))})},deleteDocumentTemplate:function(n){var t=this,i={};i.xpath=t.properties.xpath+"[fileName='"+n+"']";i.idRender=t.properties.id;i.xpathContext=t.getContextXpath();i.idPageCache=t.properties.idPageCache;$.when(t.dataService.deleteUploadFile(i)).done(function(){$.when(t.dataService.multiaction().getPropertyData({xpath:t.properties.xpath,idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache,property:"value"})).done(function(n){t.redrawDocuments(n,!1,t.properties.downloadalldocuments);t.value=n;t.configureHandlers()})})},documentTemplateGenerate:function(){var n=this,t=n.properties;n.startLoading();t.xpathcontext=n.getContextXpath();t.xpath=n.getDocumentXpath(t.xpath);n.save().done(function(){$.when(n.dataService.generateDocumentTemplate(t)).done(function(){$.when(n.dataService.multiaction().getPropertyData({xpath:t.xpath,idRender:t.id,xpathContext:n.getContextXpath(),idPageCache:t.idPageCache,property:"value"})).done(function(i){n.redrawDocuments(i,!1,t.downloadalldocuments);n.value=i;n.autoOpenDocuments();n.configureHandlers();n.endLoading()})}).fail(function(){n.showErrorMessage()})}).fail(function(t){var i=n.getFormContainer(),r=t.responseText!=undefined?JSON.parse(t.responseText).message:t;i.addErrorMessage(r);i.endLoading();n.endLoading()})},showErrorMessage:function(){var n=this,t=n.getControl(),i=$(".ui-bizagi-div-error-container",t),r=n.resources.getResource("render-upload-alert-maxsize").replace("{0}",BIZAGI_SETTINGS.UploadMaxFileSize),u=n.renderFactory.getCommonTemplate(n.getErrorTemplate());$.tmpl(u,{message:r}).appendTo(i).show();n.endLoading()},autoOpenDocuments:function(){},showDocumentPreview:function(){},returnCssTypeFile:function(n){if(n==undefined||n.lenght==0)return"ui-bizagi-document-upload-item-generic-file";var t=n.substr(n.lastIndexOf(".")+1);switch(t){case"docx":return"ui-bizagi-document-upload-item-doc";case"pdf":return"ui-bizagi-document-upload-item-pdf";case"xlsx":return"ui-bizagi-document-upload-item-xls";default:return"ui-bizagi-document-upload-item-generic-file"}},redrawDocuments:function(n,t,i){var r=this,c=r.getControl(),o=$(".ui-bizagi-container-documents",c),f,u,s,h,e;for(o.empty(),f="",u=0;u<n.length;u++)s={id:n[u][0],fileName:n[u][1]},e=r.renderDocumentItem(s),f+=e;i&&!t&&n.length>0&&(h={fileName:r.getResource("render-document-downloadalldocuments")},e=r.renderAllDocumentDownload(h),f+=e);o.append(f);r.setValue(n)},renderAllDocumentDownload:function(n){var t=this,f=t.properties,i=t.getMode(),e=t.renderFactory.getTemplate(t.getTemplateItem()),r=t.buildAllDocumentsUrl(n),u;return i!="execution"&&(r="javascript:void(0);"),u=$.fasttmpl(e,{url:r,allowDelete:f.allowDelete,filename:n.fileName,mode:i,joined:!0}),t.removeDeleteButton(u)},removeDeleteButton:function(n){var t=n.indexOf('<span class="ui-bizagi-container-documents-item-delete'),i,r;return t>0?(i=n.substring(t),r=i.indexOf("<\/span>")+7,n.substring(0,t)+i.substring(r)):n},getTemplate:function(){return"document"},getTemplateItem:function(){return"document-item"},getErrorTemplate:function(){return"form-error"}});
bizagi.rendering.combo.extend("bizagi.rendering.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{init:function(n){var t=this;this._super(n);t.dependants=[];t.isDependant=!1},initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.hasLocalData=bizagi.util.isEmpty(t.parentCombo)?t.hasLocalData:!1;t.value&&t.value.id===undefined&&(t.value=null);this.value=t.value;t.hasLocalData&&(t.data=this.complementData(t.data))},renderControl:function(){var n=this,r=n.getMode(),t=n.parentCombo=n.getParentCombo(),i;return t!=null&&t.properties.type=="cascadingCombo"&&(n.isDependant=!0),n.initializingCascadingCombo=!0,i=this._super(),r!="execution"&&(n.initializingCascadingCombo=!1),i},configureHandlers:function(){var n=this,t=n.properties;n.initializingCascadingCombo=!1;n.isDependant&&n.parentCombo.bindDependantCombo(n)},refresh:function(n){var t=this;$.when(t.isRendered()).done(function(){t.parentCombo.unbindDependantCombo(t);var i=t.getControl(),r=t.getMode();i.empty();$.when(t.renderCombo(n)).then(function(n){i.html(n);t.postRender();r=="execution"&&t.configureHandlers();t.getValue()!==undefined&&t.setDisplayValue(t.getValue());t.deferredVisible&&t.deferredVisible.resolve();t.internalSetInitialValueFlag&&(t.trigger("select",[t.value,t.initialValue]),t.internalSetInitialValueFlag=!1)})})},getData:function(n){var t=this,r=t.getMode(),i;return r!="execution"?t.getDummyData():t.isDependant?(t.parentCombo&&n&&(t.properties.remoteDataLoaded=!1),i=t.parentCombo.selectedValue?t.parentCombo.selectedValue.id:"",i!=""?this._super(n):[]):this._super(n)},bindDependantCombo:function(n){var t=this,i=t.properties;n.properties.type=="cascadingCombo"&&(t.dependants.push(n),n.onChangeFunction=function(i,r,u){t.refreshDependantCombo(n,r.id,t.focusDependant);u||n.cleanInput()},t.bind("select",n.onChangeFunction),bizagi.util.isEmpty(t.getValue())||i.hasLocalData&&t.refreshDependantCombo(n,t.getValue().id))},unbindDependantCombo:function(n){var t=this,i=t.properties;t.unbind("select",n.onChangeFunction)},refreshDependantCombo:function(n,t,i){var r=this,u={};u[r.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t;n.deferredVisible=$.Deferred();r.internalSetInitialValueFlag==!1&&n.setValue("",!1);r.internalSetInitialValueFlag&&(n.initialValue=!0,n.internalSetInitialValueFlag=!0);n.refresh(u);i&&$.when(n.deferredVisible.promise()).done(function(){n.inputCombo.trigger("click")})},emptyControlByChangeEditability:function(){var n=this,t=n.getControl();t.empty()},cleanInput:function(){var n=this;n.triggerHandler("select",{id:0})},getParentCombo:function(){var s=this,i=s.properties,c,l,f,o;if(i.parentCombo===undefined)return null;for(var h=s.getFormContainer(),r=h.getRenderByType("cascadingCombo"),n=0,u=0,t=[],e=null;n<r.length;n++)i.parentCombo===r[n].properties.id&&t.push({control:r[n],index:n});if(t.length>1){for(;u<t.length;u++)if(l=t[u].control,f=l.properties.xpath,o=f.split("."),c=o.length,f=o.slice(0,c-1).join("."),f===i.xpath){e=r[t[u].index];break}}else e=h.getRenderById(i.parentCombo);return e},canBeSent:function(){var n=this;return this._super()&&bizagi.util.isMapEmpty(n.dependants)},showCurrentData:function(){var n=this,t=n.getMode();return t!="execution"?!0:!1},configureSubmitOnChange:function(){var n=this;n.configured||(this._super(),n.configured=!0)},internalSubmitOnChange:function(n,t){var i=this,r=new $.Deferred;return i.isDependant&&i.canBeSent()&&i.itemSelected!==undefined?i._super(n,t):r.resolve()},internalSetInitialValue:function(){var n=this,t=n.properties;n._super();n.value&&n.isDependant==!1&&(n.initialValue=!0,n.internalSetInitialValueFlag=!0,n.trigger("select",[n.value,n.initialValue]));n.internalSetInitialValueFlag=!1}});
bizagi.rendering.combo.extend("bizagi.rendering.list",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.listSize=t.listSize||0},getTemplateName:function(){return"list"},showCurrentData:function(){return!1}});
bizagi.rendering.number.extend("bizagi.rendering.money",{},{initializeData:function(n){var r=this,t,i;this._super(n);t=this.properties;i=this.getResource("numericFormat");t.showsymbol=typeof t.showsymbol!="undefined"?t.showsymbol:!0;t.symbol=t.showsymbol?t.currencySymbol?t.currencySymbol:typeof BIZAGI_DEFAULT_CURRENCY_INFO!="undefined"?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol:"";t.groupDigits=!0}});
bizagi.rendering.combo.extend("bizagi.rendering.radio",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1;t.unique=bizagi.util.randomNumber(1e3,1e6)},getTemplateName:function(){return"radio"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){var n=this,t=n.properties;return{vertical:!t.horizontal}},cleanData:function(){var n=this,t={id:"",label:""},i=n.element.find(".ui-radio-state-checked");i.removeClass("ui-radio-state-checked");n.setDisplayValue(t);n.setValue(t,!1);n.clearDisplayValue()}});
bizagi.rendering.render.extend("bizagi.rendering.searchList",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.searchForms=t.searchForms||[];t.maxRecords=Number(t.maxRecords)||20;t.advancedSearch=bizagi.util.parseBoolean(t.advancedSearch)||!1;t.allowSuggest=bizagi.util.parseBoolean(t.allowSuggest)!==null?bizagi.util.parseBoolean(t.allowSuggest):!1;t.allowFullSearch=t.allowFullSearch||!1;t.allowAdd=bizagi.util.parseBoolean(t.allowAdd)||!1;t.allowTyping=bizagi.util.parseBoolean(t.allowTyping)!==null?bizagi.util.parseBoolean(t.allowTyping):!0;t.allowClear=bizagi.util.parseBoolean(t.allowClear)!==null?bizagi.util.parseBoolean(t.allowClear):!1;i.setValue(t.value)},renderControl:function(){var t=this,n=t.properties,i=t.renderFactory.getTemplate("searchList");return $.fasttmpl(i,{id:n.id,xpath:n.xpath,allowTyping:n.allowTyping,value:n.value,hasSearchForm:n.searchForms?!0:!1,editable:!0})},setValue:function(n){var t=this;this.value=JSON.encode({value:n});t.triggerRenderChange()},addElement:function(n){var t=JSON.parse(this.value);t.value.push(n);this.setValue(t.value)},removeElement:function(n){var i=JSON.parse(this.value),t=[];$.each(i.value,function(i,r){r.id!=n.id&&t.push({id:r.id,value:r.value})});this.setValue(t)},removeLastElement:function(){var n=JSON.parse(this.value);n.value.length>0&&(n.value.pop(),this.setValue(n.value))},getData:function(n){var i=this,t=i.properties,r=new $.Deferred;return i.dataService.getSearchData({url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,term:t.term,extra:n}).done(function(n){t.data=n;r.resolve(t.data)}).fail(function(n){var t=n.hideStatus||!1;r.resolve({});t||i.trigger("onSearchError",n)}),r.promise()},submitData:function(){var n=this,i=n.properties,t={};t[i.xpath]=n.getValue();n.submitOnChange(t)},canBeSent:function(){return!0}});
bizagi.rendering.render.extend("bizagi.rendering.userfieldDefinition",{},{getFileDependencies:function(){return null},postRender:function(){var n=this,t,i;return n._super(),t=$.Deferred(),i=n.getFileDependencies(),i&&i.length>0?bizagi.loader.loadFile(i).then(function(){n.internalRenderControl();t.resolve()}):$.when(n.renderUserfieldControl()).done(function(){t.resolve()}),t.promise()},renderUserfieldControl:function(){var n=this,u=n.getControl(),t=n.properties,i=new $.Deferred,r;return n.extendedData=t.extendedData&&t.extendedData.length>0?bizagi.services.ajax.parseJSON(t.extendedData):{},r=function(){var t=n.getEditableControl();t&&(n.input=t.appendTo(u));n.renderComplex();i.resolve()},r(),i.promise()},postRenderReadOnly:function(){var n=this,r=n.getControl(),t=n.properties,i;n.extendedData=t.extendedData&&t.extendedData.length>0?bizagi.services.ajax.parseJSON(t.extendedData):{};i=function(){var t=n.getReadonlyControl();t&&(n.input=t.appendTo(r));n.renderComplex()};n.ready?n.ready().done(function(){i()}):i()},getDisplayValue:function(){var n=this;return n.getReadonlyValue()},setDisplayValue:function(n){var t=this;t.setValue(n);t.setEditableValue(n)},getValue:function(){var n=this;return n.getEditableValue()},getPropertyValue:function(n,t){var u=this,i=u.properties,r=new $.Deferred;return u.dataService.multiaction().getPropertyData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,property:n,extra:t,dataType:t?t.dataType:null}).done(function(n){n.type=="error"?(u.getFormContainer().addErrorMessage(n.message),r.reject(n)):r.resolve(n)}).fail(function(n,t,i){r.reject(n,t,i)}),r.promise()},saveForm:function(){var n=this,t=n.getFormContainer();return t.saveForm()},getRenderElements:function(n){var i=this,t=$(),r=i.getFormContainer().getRenders(n);return $.each(r,function(n,i){t=t.add($(i.element))}),t},getServerResourceURL:function(n){var r=this,t="Rest/Userfields/{0}/resource/{1}/{2}",i;return t=t.replace("{0}",r.properties.userfieldGuid),n=n.replace("\\","__").replace("/","__"),i=bizagi.util.detectDevice(),t=t.replace("{1}",i),t.replace("{2}",n)},getRenderValue:function(n){var i=this,r=i.getFormContainer().getRenders(n),t;return $.each(r,function(n,i){(!t||i.properties.editable)&&(t=i)}),t?t.getValue():null},refreshForm:function(){var n=this,t=n.properties,i=n.getFormContainer();i.refreshForm(t.id)},showDialog:function(){bizagi.util.mustImplement("Must implement the showDialog method")},showPopup:function(){bizagi.util.mustImplement("Must implement the showPopup method")}});bizagi.rendering.userfieldDefinition.extend("bizagi.rendering.basicUserField",{},{getEditableControl:function(){},renderComplex:function(){},getEditableValue:function(){return bizagi.rendering.render.prototype.getValue.apply(this,arguments)},setEditableValue:function(){return bizagi.rendering.render.prototype.setValue.apply(this,arguments)},getReadonlyControl:function(){},getReadonlyValue:function(){return bizagi.rendering.render.prototype.getDisplayValue.apply(this,arguments)},dispose:function(){var n=this;n._super()}});bizagi.rendering.render.extend("bizagi.rendering.userfieldWrapper",{},{init:function(n){var t=this;t._super(n);t.initialParams=n;t.userfieldGuid=this.properties.userfieldGuid;t.userfieldName=this.properties.control},internalPostRender:function(){var n=this;$.when(n.getUserfieldControl()).done(function(t){return t.element=n.element,n.column&&(t.isColumn=!0,t.grid=n.grid,t.surrogateKey=n.surrogateKey,t.properties.xpathContext=n.getControlXpathContext(t),t.getControl=n.column.getControl),t.internalPostRender()})},getControlXpathContext:function(n){var i=this,t=n.properties;return n.isColumn?t.xpathContext.length>0?t.xpathContext+"."+n.grid.properties.xpath+"[id="+n.surrogateKey+"]":n.grid.properties.xpath+"[id="+n.surrogateKey+"]":t.xpathContext},getUserfieldControl:function(){var n=this,i=n.userfieldName,u=eval("bizagi.rendering."+i+" !== undefined"),r=new $.Deferred,t;return u?$.when(n.parent.ready()).done(function(){r.resolve(n.createUserfieldInstance(i))}):(t=bizagi.util.detectDevice(),t.indexOf("smartphone")>=0?t="smartphone":t.indexOf("tablet")>=0&&(t="tablet"),$.when(n.dataService.getUserfieldDefinition({userfield:n.userfieldGuid,device:t})).pipe(function(t){n.loadUserfield(t);r.resolve(n.createUserfieldInstance(i))})),r.promise()},createUserfieldInstance:function(n){var i=this,r,t;try{t="var baDynamicFn = function(renderParams){ \r\n";t+="return new bizagi.rendering."+n+"(renderParams);\r\n";t+="}\r\n";t+="baDynamicFn";t=eval(t);r=t(i.initialParams)}catch(u){r=new bizagi.rendering.defaultUserField(i.initialParams)}return r.properties.isUserField=!0,i.userfieldInstance=r,i.replicateUserfieldMethods(r),i.userfieldInstance.bind("renderchange",function(){i.triggerHandler("renderchange",arguments)}),r},replicateUserfieldMethods:function(n){var i=this;for(var t in n.Class.prototype)t!="init"&&t!="constructor"&&t!="Class"&&t!="subscribe"&&t!="unsubscribe"&&t!="publish"&&t!="render"&&t!="triggerHandler"&&t!="dispose"&&(i[t]=eval("var tmp = function(){ if (this.userfieldInstance) return this.userfieldInstance."+t+".apply(this.userfieldInstance, arguments); return null;};tmp"));n.properties=i.properties;n.value=i.value},loadUserfield:function(n){var t=this,r;t.properties.styleGuid=t.properties.styleGuid||Math.guid();try{try{n=eval(n)}catch(i){bizagi.log("Could not parse result userfield "+t.userfieldName,i.message)}$.each(n,function(n,i){if(i.type=="js")try{eval(i.content)}catch(r){bizagi.log("Could not parse result userfield3 "+t.userfieldName,r.message)}i.type=="css"&&bizagi.util.loadStyle(i.content,t.properties.styleGuid)});r=eval("bizagi.rendering."+t.userfieldName)}catch(i){bizagi.log("Could not parse result userfield "+t.userfieldName,i.message)}},dispose:function(){var n=this;setTimeout(function(){n.userfieldInstance&&(n.userfieldInstance.unbind("renderchange"),n.userfieldInstance.dispose())},bizagi.override.disposeTime||50);n._super()}});
bizagi.rendering.render.extend("bizagi.rendering.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{initializeData:function(n){var u=this,t,i,r,f;if(this._super(n),t=this.properties,t.editable=bizagi.util.parseBoolean(t.editable)?!0:!1,t.maxSize=Number(t.maxSize)||(typeof BIZAGI_SETTINGS!="undefined"&&typeof BIZAGI_SETTINGS.UploadMaxFileSize!="undefined"?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(i=t.validExtensions.replace(/\ /gi,"").split(";"),r=0;r<i.length;r++)i[r].length!=0?i[r]="*."+i[r].replaceAll(" ",""):(f=i.indexOf(i[r]),i.splice(r,1));t.validExtensions=i.join(";")}t.addUrl=t.addUrl||u.dataService.getUploadAddFileUrl(t.isUserPreference);t.allowDelete=bizagi.util.parseBoolean(t.allowDelete)!==null?bizagi.util.parseBoolean(t.allowDelete):!1;t.isAutoWidth=!1;t.isAutoHeight=!1;t.width==-1?(t.width="99%",t.isAutoWidth=!0):t.width=t.width+"px";t.height==-1?(t.height="auto",t.isAutoHeight=!0):t.height=t.height+"px"},renderControl:function(){var n=this,t=new $.Deferred,i=n.renderFactory.getTemplate("image"),r=bizagi.util.isOfflineForm({context:n});return $.when(n.buildItemUrl()).done(function(u){if(!n.isDisposed()){n.properties.url=u!==""?u:"";n.properties.value=n.value=n.properties.url.length>0?[n.properties.url]:null;n.setValue(n.properties.value);r&&u.indexOf("Invalid case id")!==-1&&(n.properties.url="");var f=$.fasttmpl(i,{url:n.properties.url});t.resolve(f)}}),t.promise()},renderReadOnly:function(){var n=this,t=n.renderFactory.getTemplate("image-readonly");return $.fasttmpl(t)},getTemplateItem:function(){var n=this;return n.renderFactory.getTemplate("image-item")},renderUploadItem:function(){var n=this,r=n.properties,u=n.getMode(),t="",i=new $.Deferred,f=n.getTemplateItem();return $.when(n.buildItemUrl()).done(function(e){t=e||t;var o=$.fasttmpl(f,{url:t,allowDelete:r.allowDelete,mode:u});n.properties.value=t.length>0?[t]:null;i.resolve(o)}),i.promise()},buildItemUrl:function(n){var i=this,t=i.properties,o=i.getMode(),f=new $.Deferred,r="",s=bizagi.util.isOfflineForm({context:i}),u,e;return o!=="execution"?(r="javascript:void(0);",f.resolve(r)):(u={url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,property:n&&n.property?n.property:"fileContent",dataType:"text"},t.contexttype?u.contexttype=t.contexttype:"",t.isUserPreference&&(i.currentUser=bizagi.currentUser.idUser,u.xpathContext="@Context.Users[id == "+i.currentUser+"]",u.contexttype="entity",u.surrogatekey=i.currentUser),s?(typeof t.value=="undefined"||bizagi.util.isEmpty(t.value)?r="":(e=t.value,r="data:image/png;base64,"+e.value),f.resolve(r)):i.dataService.multiaction().getPropertyData(u,"text").done(function(n){n.charAt(0)==='"'&&(n=n.slice(1,-1));n!=""&&(r="data:image/png;base64,"+n);f.resolve(r)})),f.promise()},buildFullItemUrl:function(){var t=this,n=new $.Deferred;return $.when(t.buildItemUrl({property:"fileFullContent"})).done(function(t){n.resolve(t)}),n.promise()},canBeSent:function(){return!1},setValue:function(n,t){var i=this,r=i.properties;i._super(n,t)},getValue:function(){return this.properties.value||[]},isValid:function(n){var t=this,i=t.properties,u,f,r;return bizagi.util.parseBoolean(i.visible)==!1?!0:bizagi.util.parseBoolean(i.editable)==!1?!0:(t.setValidationMessage(""),i.required&&(u=t.grid&&t.grid.isFromCreatedRow.apply(t),!u&&(f=t.getValue(),f.length===0)))?(r=t.getResource("render-required-text").replaceAll("#label#",t.properties.displayName),n.push({xpath:t.properties.xpath,message:r}),!1):!0},buildAddParams:function(){var n=this,i=n.properties,r=n.getFormContainer(),t={};t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=n.getUploadXpath();t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=i.id;t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=i.xpathContext;t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+n.Class.BA_PAGE_CACHE]=i.idPageCache;t[n.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=r.properties.sessionId;t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="savefile";i.contexttype?t[n.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=i.contexttype:"";try{BIZAGI_SESSION_NAME!=undefined?t[BIZAGI_SESSION_NAME]=r.properties.sessionId:t.JSESSIONID=r.properties.sessionId}catch(u){t.JSESSIONID=r.properties.sessionId}return t},getUploadXpath:function(){return this.properties.xpath},emptyControlByAsyncRenderDeferred:function(){var n=this,t=n.getControl();t.empty()}});
bizagi.rendering.element.extend("bizagi.rendering.columns.column",{},{init:function(n){this._super(n);this.decoratedClass=n.decorated;this.data=n.data;n.singleInstance?(this.decorated=new this.decoratedClass({data:this.data,parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService}),this.decorated.getControl=this.getControl,n.decorated=this.decorated,this.decorated.properties.isColumn=!0):this.decorateRenders=[];this.grid=n.parent;var t=this.properties;t.columnVisible=bizagi.util.parseBoolean(t.columnVisible)!=null?bizagi.util.parseBoolean(t.columnVisible):!0;t.align=t.align||"center";t.textFormat=t.textFormat||{};t.submitOnChange=typeof t.submitOnChange!="undefined"?bizagi.util.parseBoolean(t.submitOnChange):!1;t.singleInstance=n.singleInstance;t.editable=typeof t.editable!="undefined"?bizagi.util.parseBoolean(t.editable):!0;t.visible=typeof t.visible!="undefined"?bizagi.util.parseBoolean(t.visible):!0;t.required=typeof t.required!="undefined"?bizagi.util.parseBoolean(t.required):!1;t.showColumn=typeof t.showColumn!="undefined"?bizagi.util.parseBoolean(t.showColumn):!0;try{n.parent&&typeof n.parent.properties.editable=="boolean"&&!n.parent.properties.editable&&(t.editable=!1)}catch(i){}this.readonly=t.readonly!==undefined?t.readonly:!1;this.readonly&&(t.editable=required=!1);this.originalProperties=JSON.parse(JSON.encode(t))},isReadonly:function(){return!1},getControl:function(){var n=this;return $(".ui-bizagi-render-control",n.element||n.observableElement)},getDecorated:function(n){var i=this,u=i.properties,t,r;return u.singleInstance?i.decorated:(t=i.decorateRenders[n],t==undefined&&(typeof i.decorateRenders!="object"&&(i.decorateRenders=[]),r=new this.decoratedClass({data:bizagi.clone(this.data),parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService}),t=r,i.decorateRenders[n]=r,t.surrogateKey=n,i.applyOverrides(t),n=="summary"&&t.properties.type!="columnMoney"&&t.properties.type!="columnNumber"&&(t.setDisplayValue=function(n){var t=this.getControl();t.html(n)})),t)},ready:function(){return this.readyDeferred.promise()},initialize:function(){},canBeSent:function(n,t){var i=this,r=i.getDecorated(n);return t&&(r.properties.visible=t.visible,r.properties.editable=t.editable),r.canBeSent()||!i.properties.editable&&i.hasChanged()},isValueValid:function(n,t,i,r){var f=this,u=f.getDecorated(n),e=[];return(r.visible&&(f.setValue(n,t),u.properties=$.extend(u.properties,r),f.grid&&typeof u.grid=="undefined"&&(u.grid=f.grid),u.isValid(e)),e.length>0)?($.each(e,function(n,t){i.push(t.message)}),!1):!0},applyOverrides:function(){},render:function(n,t){var i=this,f=i.properties,r=i.getDecorated(n),u;return(r.grid=i.grid,r.column=this,r.surrogateKey=n,i.setValue(n,t),i.overrideDecoratedRenderProperties(n),i.changed=!1,!f.editable&&arguments[3]!=="CALLER_RENDER_READ_ONLY_COLUMNSLINK")?i.renderReadOnly.apply(i,arguments):(i.readyDeferred=new $.Deferred,u=r.render("cell"),r.bind("renderchange",function(){i.changed=!0}),i.bind("rendered",function(){i.readyDeferred.resolve()}),u)},postRender:function(n,t){var i=this,r=i.getDecorated(n);r.postRenderElement(t)},renderReadOnly:function(n,t){var i=this,r=i.getDecorated(n),u;return r.grid=i.grid,r.column=this,r.surrogateKey=n,i.setValue(n,t),i.overrideDecoratedRenderProperties(n),r.properties.editable=!1,i.readyDeferred=new $.Deferred,u=r.render("cell.readonly"),i.bind("rendered",function(){i.readyDeferred.resolve()}),u},renderSummary:function(){var n=this,t=n.renderFactory.getTemplate("cell.summary");return $.tmpl(t).html()},postRenderReadOnly:function(n,t){var r=this,i=r.getDecorated(n),u=r.properties.editable;i.properties.editable=!1;r.properties.singleInstance&&(i.element=t);i.postRenderElement(t);i.properties.editable=u},postRenderSummary:function(){return!1},getCell:function(){return this.decorated.getDisplayValue()},setSurrogateKey:function(n){this.surrogateKey=n},setValue:function(n,t){var r=this,i=r.getDecorated(n);i!="undefined"&&i!=null&&(i.properties.originalValue=t,i.properties.previousValue=t,(t===null||t===undefined)&&r.properties.defaultvalue!==undefined&&i.grid!=undefined&&(t=r.setDefaultValue(n,i)),i.properties.value=t,i.setValue(t,!1))},setDefaultValue:function(n,t){var i=this,r=i.properties.defaultvalue;return t.grid.changes[n]=t.grid.changes[n]||{},t.grid.changes[n][i.properties.xpath]=r,r},getValue:function(n){var t=this,i=t.getDecorated(n);return i.getValue()},getCompositeValue:function(n){return this.getValue(n)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_COLUMN},hasChanged:function(){return this.changed},trigger:function(n,t){this.decorated&&this.decorated.trigger(n,t)},triggerHandler:function(n,t){this.decorated&&this.decorated.triggerHandler(n,t)},bind:function(n,t){this.decorated&&this.decorated.bind(n,t)},unbind:function(n,t){this.decorated&&this.decorated.unbind(n,t)},overrideDecoratedRenderProperties:function(n){var i=this,t=i.getDecorated(n);t.properties.editable=this.properties.editable;t.properties.visible=this.properties.visible;t.properties.required=this.properties.required},overrideProperties:function(n){var t=this;t.properties.editable=n.editable||t.properties.editable;t.properties.visible=n.visible||t.properties.visible;t.properties.required=n.required||t.properties.required},getSortName:function(){var t=this,n=t.getAnyDecoratedInstance();return n&&n.getSortColumn?n.getSortColumn():t.properties.xpath},getAnyDecoratedInstance:function(){var t=this;for(var n in this.decorateRenders)break;return n?this.decorateRenders[n]:null},dispose:function(){var n=this;setTimeout(function(){n.decorated&&(n.decorated.unbind("renderchange"),n.decorated.dispose());n.decorateRenders&&bizagi.util.arrayEach(n.decorateRenders,function(n,t){t&&(t.unbind("renderchange"),t.dispose())})},bizagi.override.disposeTime||50);n._super()}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.readonly",{},{init:function(n){this._super(n);var t=this.properties;t.editable=required=!1},isReadonly:function(){return!0},render:function(n,t){if(typeof t=="string"){var i=t.replaceAll("\\n","<br/>");return i.replaceAll("\n","<br/>")}return t},postRender:function(){},renderReadOnly:function(n,t){return this.render(n,t)},postRenderReadOnly:function(){},isValueValid:function(){return!0}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.document",{},{});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.letter",{},{});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.column",{},{applyOverrides:function(n){n&&(n.getControl&&(this.originalGetControl=n.getControl,n.getControl=this.getControl),n.getFormattingLabel=function(){var n=this;return n.getControl()})},getControl:function(){var t=this,n=this._super();return n&&n.length!=0||(n=$(".ui-bizagi-cell-readonly",t.element||t.observableElement)),n},postRenderReadOnly:function(n,t){var r=this,u=r.properties,i;this._super(n,t);t&&t.length>0&&(i=$(".ui-bizagi-cell-icon",t),u.editable||i.remove(),r.applyColumnStyles(t),u.align=="left"&&i.addClass("ui-bizagi-cell-icon-right"))},applyColumnStyles:function(n){var i=this,t=i.properties;t.textFormat.background&&(n.css("background-color",t.textFormat.background),n.css("background-image","none"))}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.combo",{},{init:function(n){this._super(n);var t=this.properties;t.recalculate=bizagi.util.parseBoolean(t.recalculate)||!1},applyOverrides:function(n){var t=this.properties;this._super(n);t.recalculate||(n.originalGetData=n.getData,n.getData=this.getDataForAllCells,n.findDataById=this.findDataById)},findDataById:function(n){var i=this,t={};return this.column&&this.column.comboData&&$.each(this.column.comboData,function(i,r){r.id==n&&(t=r)}),t},getDataForAllCells:function(n){var t=this.column;return t.comboData?t.comboData:t.fetchingData?t.dataPromise:(t.fetchingData=!0,t.dataPromise=$.when(this.originalGetData(n)).pipe(function(n){return t.comboData=n,t.fetchingData=!1,n}),t.dataPromise)},setValue:function(n,t){var i=this,r=i.getDecorated(n),u;if(r!==null){if(n=="summary")return i._super(n,t);t&&t.length>0?(u={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(n,t){return t!=0}):t[0][1]},i._super(n,u),r.selectedValue=u.value):t&&t.id&&t.value?(i._super(n,t),r.selectedValue=t.value):i.properties.type=="columnRadio"?(i._super(n,null),r.selectedValue=t):t&&typeof t=="number"?i._super(n,t):(i._super(n,null),r.selectedValue="")}},getCompositeValue:function(n){var u=this,r=u.getDecorated(n),i=r.getValue(),f=r.getSelectedValue(),t=[];return i&&i.id>0?(t.push([]),t[0].push(i.id),t[0].push(f)):t.push([]),t},getValue:function(n){var i=this,r=i.getDecorated(n),t=r.getValue();return t?t.id:t},render:function(n,t,i){var r=this,f=r.getDecorated(n),u=r.properties,e;return u.recalculate&&f.resetData(),e=u.xpathContext.length>0?u.xpathContext+"."+r.grid.properties.xpath+"[id="+n+"]":r.grid.properties.xpath+"[id="+n+"]",f.properties.xpathContext=e,this._super(n,t,i)},renderReadOnly:function(n,t){var i=this,u=i.getDecorated(n),r=i.properties,f=r.xpathContext.length>0?r.xpathContext+"."+i.grid.properties.xpath+"[id="+n+"]":i.grid.properties.xpath+"[id="+n+"]";return u.properties.xpathContext=f,this._super(n,t)}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.search",{},{init:function(n){this._super(n);var t=this.properties},render:function(n,t,i){var r=this,f=r.getDecorated(n),u=r.properties,e;return u.recalculate&&f.resetData(),e=u.xpathContext.length>0?u.xpathContext+"."+r.grid.properties.xpath+"[id="+n+"]":r.grid.properties.xpath+"[id="+n+"]",f.properties.xpathContext=e,this._super(n,t,i)},getValue:function(n){var i=this,r=i.getDecorated(n),t=r.getValue();return t&&typeof t=="object"?t.id:t},setValue:function(n,t){var i=this,r=i.getDecorated(n),u;if(r!==null){if(n=="summary")return i._super(n,t);t&&t.length>0?(u={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(n,t){return t!=0}):t[0][1]},i._super(n,u),r.selectedValue=u.value):t&&t.id&&t.value?(i._super(n,t),r.selectedValue=t.value):t&&t.id&&t.label?(i._super(n,t),r.selectedValue=t.label):(i._super(n,t),r.selectedValue="")}}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.date",{},{setValue:function(n,t){var r=this,i=r.getDecorated(n),u,f,e;if(i!==null){if(r._super(n,t),(t===null||t===undefined)&&r.properties.defaultvalue!==undefined&&(t=r.setDefaultValue(n,i)),n=="summary")return r._super(n,t);t==null&&(i.setValue(t,!1),i.properties.displayValue="");u=bizagi.util.dateFormatter.getDateFromInvariant(t,i.properties.showTime);u==0&&(u=bizagi.util.dateFormatter.getDateFromInvariant(t,!i.properties.showTime));u!=0&&(f=bizagi.localization.getResource("datePickerRegional"),e=bizagi.util.dateFormatter.formatDate(u,i.properties.fullFormat,f),i.properties.displayValue=e,i.setValue(t,!1))}},setDefaultValue:function(n,t){var r=this,i=r.properties.defaultvalue;return t.grid.changes[n]=t.grid.changes[n]||{},i=bizagi.util.dateFormatter.getDateFromInvariant(i,!1),i=bizagi.util.dateFormatter.formatInvariant(i,!0),t.grid.changes[n][r.properties.xpath]=i,i}});
$.Class.extend("bizagi.rendering.dialog.form",{POPUP_WIDTH:768,POPUP_HEIGHT:550},{init:function(n,t,i){var r=this,f=window.document,u;r.buttons={};for(u in i.extraButtons)r.buttons[bizagi.localization.getResource(u)]=i.extraButtons[u];this.dataService=n;this.renderFactory=t;this.dialogDeferred=new $.Deferred;i=r.dialogParams=i||{};r.dialogBox=$("<div class='ui-bizagi-component-loading'/>");r.dialogBox.empty();r.dialogBox.appendTo("body",f);r.showDialogBox(r.dialogBox,i).done(function(n){r.dialogDeferred.resolve(n)}).fail(function(){r.dialogDeferred.reject()})},render:function(n){var t=this;return t.renderDialogBox(t.dialogBox,n),t.dialogDeferred.promise()},showDialogBox:function(n,t,i){var r=this,i=r.dialogParams.orientation=="rtl"?!0:!1,u={},f=new $.Deferred,s=bizagi.util.parseBoolean(t.showSaveButton)!==null?bizagi.util.parseBoolean(t.showSaveButton):!0,h=bizagi.util.parseBoolean(t.showCancelButton)!==null?bizagi.util.parseBoolean(t.showCancelButton):!0,a=t.saveButtonLabel?t.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),v=t.cancelButtonLabel?t.cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-cancel"),c=bizagi.util.parseBoolean(t.maximized)!==null?bizagi.util.parseBoolean(t.maximized):!1,l,e,o;if(bizagi.util.isIE())u=[],s&&(u[0]={text:bizagi.localization.getResource("render-form-dialog-box-save"),click:function(n){var i,u;if(r.form){var e=r.form,o=$.Deferred(),s=e.getRenderByType("tabItem"),h=s.length;for(e.innerTabsLoading=!0,i=0;i<h;i++)u=s[i],u.loadingDeferred&&u.parent.container&&u.loadingDeferred.resolve();delete e.innerTabsLoading;o.resolve({event:n});$.when(o.promise()).done(function(n){var n=n,i;r.form.validateForm()&&(i={},t.forceCollectData?($.forceCollectData=!0,r.form.collectRenderValues(i),$.forceCollectData=!1):r.form.collectRenderValues(i),t.allowGetOriginalFormValues&&(i.formValues=r.form.children),i.idPageCache=r.form.getPageCache(),t.onSave&&!$(n.currentTarget).prop("disabled")?($(n.currentTarget).prop("disabled",!0),$.when(t.onSave(i)).done(function(t){$(n.currentTarget).prop("disabled",!1);t==null||t==!0||t.type=="success"?(f.resolve(),r.closeDialogBox()):t.type=="validationMessages"?(r.form.addValidationMessage(t.messages),$.each(i,function(n){var t=r.form.getRenders(n);$.each(t,function(n,t){t.updateOriginalValue()})})):t.type=="error"&&r.form.addErrorMessage(t.message)}).fail(function(){$(n.currentTarget).prop("disabled",!1)})):(f.resolve(),r.closeDialogBox()))})}}}),h&&(u[u.length]={text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){t.onCancel&&t.onCancel();f.reject();r.closeDialogBox()}}),r.buttons=$.extend(u,r.buttons),i&&u.reverse();else if(s&&(u[a]=function(n){var i,u;if(r.form){var e=r.form,o=$.Deferred(),s=e.getRenderByType("tabItem"),h=s.length;for(e.innerTabsLoading=!0,i=0;i<h;i++)u=s[i],u.loadingDeferred&&u.parent.container&&u.loadingDeferred.resolve();delete e.innerTabsLoading;o.resolve({event:n});$.when(o.promise()).done(function(n){var u=n.event,i;r.form.validateForm()&&(i={},t.forceCollectData?($.forceCollectData=!0,r.form.collectRenderValues(i),$.forceCollectData=!1):r.form.collectRenderValues(i),t.allowGetOriginalFormValues&&(i.formValues=r.form.children),i.idPageCache=r.form.getPageCache(),t.onSave&&!$(u.currentTarget).prop("disabled")?($(u.currentTarget).prop("disabled",!0),$.when(t.onSave(i)).done(function(n){$(u.currentTarget).prop("disabled",!1);n==null||n==!0||n.type=="success"?(f.resolve(),r.closeDialogBox()):n.type=="validationMessages"?(r.form.addValidationMessage(n.messages),$.each(i,function(n){var t=r.form.getRenders(n);$.each(t,function(n,t){t.updateOriginalValue()})})):n.type=="error"&&r.form.addErrorMessage(n.message)}).fail(function(){$(u.currentTarget).prop("disabled",!1)})):(f.resolve(),r.closeDialogBox()))})}}),h&&(u[v]=function(){t.onCancel&&t.onCancel();f.reject();r.closeDialogBox()}),r.buttons=$.extend(u,r.buttons),r.dialogParams.orientation=="rtl"){for(o in u){l=u[o];e=o;break}delete u[e];u[e]=l}return n.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:t.title,modal:!0,buttons:r.buttons,resizable:!1,maximized:c,open:function(){typeof Windows!="undefined"&&($(window).bind("resize.dialog",r._appresize.bind(r)),$(r.dialogBox).dialog("widget").show());c&&$("body",window.document).css("position","fixed")},close:function(){typeof Windows!="undefined"&&$(window).unbind("resize.dialog");$("body",window.document).css("position","static");f.reject();r.closeDialogBox()},resizeStop:function(n,t){r.form&&r.form.resize(t.size)}}),r.adjustOverlay(),f.promise()},_appresize:function(){var n=this;$(n.dialogBox).dialog("widget").css({left:window.screen.width/2-n.Class.POPUP_WIDTH/2+"px",top:window.screen.height/2-n.Class.POPUP_HEIGHT/2+"px",width:n.Class.POPUP_WIDTH+"px",height:n.Class.POPUP_HEIGHT+"px"}).show()},closeDialogBox:function(){var n=this,t=n.dialogBox;$("body",window.document).css("position","static");t.dialog("destroy");t.remove();n.dispose()},focusFirstControl:function(n,t){var i=function(){var i=$("input:visible, select:visible, option:visible, textarea:visible",n.container).not(".ui-bizagi-render-date,.ui-bizagi-render-search"),f;if(i.length>0){var r=$(i[0]).closest(".ui-bizagi-render"),u=r.length>0?r.data("render-xpath"):"",t=u?n.getRender(u):"";if(t&&t.properties&&t.properties.retype&&t.properties.retype==="double")return;f=i[0];try{f.focus()}catch(e){}}};t>0?setTimeout(i,t):i()},renderDialogBox:function(n,t){var i=this,r=new $.Deferred;n.empty();try{i.form&&i.form.params.data.contextType&&(t.contextType=i.form.params.data.contextType)}catch(u){}return t.rewriteContextType===!0,$.when(i.dataService.getFormData(t)).pipe(function(n){return t.recordXPath&&(n.form.properties.recordXpath=t.recordXPath),n.form.contextType=t.contextType,t.rewriteContextType&&(n.form.contextType=undefined),t.editable===!1&&(n.form.properties.editable=!1,i.removeActions(n.form)),t.required===!1&&(n.form.properties.required=!1),i.removeTransitions(n.form),i.form=i.renderFactory.getContainer({type:"form",data:n.form,focus:t.focus||!1,selectedTabs:t.selectedTabs,isRefresh:t.isRefresh||!1,requestedForm:t.requestedForm}),r.resolve(i.form),i.form.render()},function(t){var u=i.renderFactory.getCommonTemplate("form-error"),r;typeof t=="object"&&t.responseText&&(r=JSON.parse(t.responseText),t="Error:"+r.errorType+"<br>"+r.message||" Error in form ");$("*",n).remove();$.tmpl(u,{message:t}).appendTo(n)}).done(function(r){$(".ui-bizagi-button-container",r).remove();$(".ui-bizagi-loading-message",n).remove();n.data("loading",!1);n.removeClass("ui-bizagi-component-loading");n.html(r);n=i.customizeDialogBox(n);i.form.triggerHandler("ondomincluded");t.scrollTop?i.form.container.parent().scrollTop(t.scrollTop):i.focusFirstControl(i.form,150);i.form.bind("refresh",function(t,r){return r.scrollTop=i.form.container.parent().scrollTop(),r=$.extend({focus:focus,selectedTabs:i.form.getSelectedTabs(),isRefresh:!0},r),i.renderDialogBox(n,r)})})},customizeDialogBox:function(n){return n},removeTransitions:function(n){n=n||{};n.transitions&&delete n.transitions},removeActions:function(n){n=n||{};n.actions&&delete n.actions},dispose:function(){var n=this;n.form&&n.form.dispose();bizagi.util.dispose(n.buttons);bizagi.util.dispose(n)},adjustOverlay:function(){var n=$(".ui-widget-overlay.ui-front"),u=$("body"),f=$("#render-canvas"),t=parseInt(n.height()),i=parseInt(u.height()),r=parseInt(f.height());t<i&&(n.height(i),t=i);t<r&&n.height(r)}});
$.Class.extend("bizagi.rendering.dialog.startForm",{POPUP_WIDTH:900,POPUP_HEIGHT:650},{init:function(n,t,i){var r=this,f=window.document,u;r.buttons={};for(u in i.extraButtons)r.buttons[bizagi.localization.getResource(u)]=i.extraButtons[u];this.dataService=n;this.renderFactory=t;this.dialogDeferred=new $.Deferred;i=r.dialogParams=i||{};r.dialogBox=$("<div class='ui-bizagi-component-loading'/>");r.dialogBox.empty();r.dialogBox.appendTo("body",f);r.showDialogBox(r.dialogBox,i).done(function(n){r.dialogDeferred.resolve(n)}).fail(function(){r.dialogDeferred.reject()})},render:function(n){var t=this;return t.renderDialogBox(t.dialogBox,n),t.dialogDeferred.promise()},showDialogBox:function(n,t){var i=this,u={},r=new $.Deferred,e=bizagi.util.parseBoolean(t.showSaveButton)!==null?bizagi.util.parseBoolean(t.showSaveButton):!0,o=bizagi.util.parseBoolean(t.showCancelButton)!==null?bizagi.util.parseBoolean(t.showCancelButton):!0,s=t.saveButtonLabel?t.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),h=t.cancelButtonLabel?t.cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-cancel"),f=bizagi.util.parseBoolean(t.maximized)!==null?bizagi.util.parseBoolean(t.maximized):!1;return e&&(u[s]=function(){if(i.form&&i.form.validateForm()){var n={};t.forceCollectData?($.forceCollectData=!0,i.form.collectRenderValues(n),$.forceCollectData=!1):i.form.collectRenderValues(n);t.allowGetOriginalFormValues&&(n.formValues=i.form.children);n.idPageCache=i.form.getPageCache();t.onSave?$.when(t.onSave(n)).done(function(t){t==null||t==!0||t.type=="success"?(r.resolve(),i.closeDialogBox()):t.type=="validationMessages"?(i.form.addValidationMessage(t.messages),$.each(n,function(n){var t=i.form.getRenders(n);$.each(t,function(n,t){t.updateOriginalValue()})})):t.type=="error"&&i.form.addErrorMessage(t.message)}):(r.resolve(),i.closeDialogBox())}}),o&&(u[h]=function(){t.onCancel&&t.onCancel();i.closeDialogBox()}),i.buttons=$.extend(u,i.buttons),n.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:t.title,modal:!0,buttons:i.buttons,resizable:!1,maximized:f,open:function(){typeof Windows!="undefined"&&($(window).bind("resize.dialog",i._appresize.bind(i)),$(i.dialogBox).dialog("widget").show());f&&$("body",window.document).css("position","fixed")},close:function(){typeof Windows!="undefined"&&$(window).unbind("resize.dialog");$("body",window.document).css("position","static");r.reject();i.closeDialogBox()},resizeStop:function(n,t){i.form&&i.form.resize(t.size)}}),i.adjustOverlay(),r.promise()},_appresize:function(){var n=this;$(n.dialogBox).dialog("widget").css({left:window.screen.width/2-n.Class.POPUP_WIDTH/2+"px",top:window.screen.height/2-n.Class.POPUP_HEIGHT/2+"px",width:n.Class.POPUP_WIDTH+"px",height:n.Class.POPUP_HEIGHT+"px"}).show()},closeDialogBox:function(){var n=this,t=n.dialogBox;$("body",window.document).css("position","static");t.dialog("destroy");t.remove();n.dispose()},renderDialogBox:function(n,t){var i=this,r=new $.Deferred;n.empty();try{i.form&&i.form.params.data.contextType&&(t.contextType=i.form.params.data.contextType)}catch(u){}return $.when(i.dataService.getStartForm(t)).pipe(function(n){return n.form.contextType=t.contextType,t.editable==!1&&(n.form.properties.editable=!1,i.removeActions(n.form)),i.removeTransitions(n.form),i.form=i.renderFactory.getContainer({type:"form",data:n.form,focus:t.focus||!1,selectedTabs:t.selectedTabs,isRefresh:t.isRefresh||!1}),r.resolve(i.form),i.form.render()},function(t){var u=i.renderFactory.getCommonTemplate("form-error"),r;typeof t=="object"&&t.responseText&&(r=JSON.parse(t.responseText),t="Error:"+r.errorType+"<br>"+r.message||" Error in form ");$("*",n).remove();$.tmpl(u,{message:t}).appendTo(n)}).done(function(r){$(".ui-bizagi-button-container",r).remove();$(".ui-bizagi-loading-message",n).remove();n.data("loading",!1);n.removeClass("ui-bizagi-component-loading");n.html(r);n=i.customizeDialogBox(n);i.form.triggerHandler("ondomincluded");setTimeout(function(){if(i.dialogParams.maximized){var n=i.dialogBox.data("ui-dialog");n.recalculate&&n.recalculate()}},650);i.form.bind("refresh",function(r,u){return u=$.extend({focus:focus,selectedTabs:i.form.getSelectedTabs(),isRefresh:!0},t,u),i.renderDialogBox(n,u)})})},customizeDialogBox:function(n){return n},removeTransitions:function(n){n=n||{};n.transitions&&delete n.transitions},removeActions:function(n){n=n||{};n.actions&&delete n.actions},dispose:function(){var n=this;n.form&&n.form.dispose();bizagi.util.dispose(n.buttons);bizagi.util.dispose(n)},adjustOverlay:function(){var n=$(".ui-widget-overlay"),i=$("body"),r=parseInt(n.height()),t=parseInt(i.height());r<t&&n.height(t)}});
$.Class.extend("bizagi.rendering.dialog.search",{POPUP_WIDTH:800,POPUP_HEIGHT:600},{init:function(n,t,i,r,u){var f=this,e=window.document;u=u||{};this.dataService=n;this.renderFactory=t;this.searchForms=i;this.searchParams=r;this.dialogDeferred=new $.Deferred;this.extraButtons=u.hasOwnProperty("buttons")?u.buttons:!1;f.dialogBox=$("<div class='ui-bizagi-component-loading'/>");f.dialogBox.empty();f.dialogBox.appendTo("body",e);f.showDialogBox(f.dialogBox).done(function(n){f.dialogDeferred.resolve(n);f.form.unbindAutoSaveForm()}).fail(function(){f.dialogDeferred.reject();f.form.unbindAutoSaveForm()})},render:function(n){var t=this;return t.renderSearchDialog(n),t.dialogDeferred.promise()},renderSearchDialog:function(n){var t=this;t.form=null;$.when(t.getSearchContainerData(n)).pipe(function(i){typeof i.form.properties!="undefined"&&(i.form.properties.orientation=n.orientation||"ltr");var r=t.renderFactory.getContainer({type:"form",data:i.form});return n.contexttype&&(r.properties.contexttype=n.contexttype),t.form=r,t.form.render()}).done(function(i){$(".ui-bizagi-button-container",i).remove();$(".ui-bizagi-loading-message",t.dialogBox).remove();i.appendTo(t.dialogBox);t.form.triggerHandler("ondomincluded");var r=t.form.firstChild().properties.type=="tab"?t.form.firstChild():null;r?(r.bind("selected",function(i,r){var u=t.searchForms[r.index];$.when(t.loadSearchTab(n,r.tab,u)).done(function(){t.currentSearchForm=r.tab.firstChild();t.currentSearchForm.triggerHandler("ondomincluded")})}),r.container.tabs("option","active",0),t.currentSearchForm=r.firstChild().firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")):(t.currentSearchForm=t.form.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded"));t.focusFirstControl(t.currentSearchForm,100);t.currentSearchForm.bind("instanceSelected",function(n,i){t.closeDialogBox();t.dialogBoxDeferred.resolve({id:i.id,label:""})});t.currentSearchForm.bind("multiSelect",function(n,i){t.closeDialogBox();t.dialogBoxDeferred.resolve({id:i.id,label:i.data})})})},focusFirstControl:function(n,t){var i=function(){var t=$("input:visible, select:visible, option:visible, textarea:visible",n.container),i;if(t.length>0){i=t[0];try{i.focus()}catch(r){}}};t>0?setTimeout(i,t):i()},loadSearchTab:function(n,t,i){var r=this,u=new $.Deferred;return t.children.length>0?null:($.when(r.getSearchFormData(n,i)).pipe(function(n){var i=r.renderFactory.getContainer({type:"searchForm",data:n.form});return t.children.push(i),i.render()}).done(function(n){$(".ui-bizagi-button-container",n).remove();t.container.append(n);u.resolve()}),u.promise())},showDialogBox:function(n,t){var i=this,t=i.searchParams.orientation=="rtl"?!0:!1,r=[],f,u,e;return i.dialogBoxDeferred=new $.Deferred,f=[{text:bizagi.localization.getResource("render-form-dialog-box-search"),click:function(){i.searchParams&&(i.searchParams.searchTriggeredBy="button");i.currentSearchForm.performSearch(i.searchParams)}},{text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){i.dialogBoxDeferred.reject();i.closeDialogBox()}}],this.extraButtons&&r.push(this.extraButtons),r=r.concat(f),t&&r.reverse(),u=this.Class.POPUP_WIDTH,e=this.Class.POPUP_HEIGHT,u>$(window).width()&&(u=$(window).width()*.9),n.addClass("ui-bizagi-dialog-search").dialog({title:bizagi.localization.getResource("render-search-dialog-title"),width:u,height:e,resizable:!1,modal:!0,buttons:r,close:function(){i.dialogBoxDeferred.reject();i.closeDialogBox()},resizeStop:function(n,t){i.form.resize(t.size)}}),i.dialogBoxDeferred.promise()},closeDialogBox:function(){var t=this,n=t.dialogBox;n.dialog("destroy");n.detach()},addButtons:function(){},getSearchContainerData:function(n){var i=this,f=new $.Deferred,r={form:{properties:{},elements:[]}},e=r.form,o=i.searchForms[0],t,u;return i.searchForms.length>1&&(t={},t.properties={type:"tab"},t.elements=[],u=[],$.each(i.searchForms,function(n,r){var s=r["default"]||!1,f={};f.properties={id:n,type:"tabItem",displayName:r.caption};f.elements=[];s?(t.elements.push({container:f}),e=f,o=i.searchForms[0]):u.push({container:f})}),$.each(u,function(n,i){t.elements.push(i)}),r.form.elements.push({container:t})),$.when(i.getSearchFormData(n,o)).done(function(n){n&&(e.elements.push(n),f.resolve(r))}).fail(function(){console.log("Error")}),f.promise()},getSearchFormData:function(n,t){var i=this,r,u;return t==undefined||t.id==undefined?(r=bizagi.localization.getResource("render-search-without-form"),u=$("<div>").append(r),i.dialogBox.dialog("close"),$(u).dialog({modal:!0,buttons:[{text:bizagi.localization.getResource("render-form-dialog-box-close"),click:function(){$(this).dialog("close")}}]}),!1):i.dataService.getSearchFormData($.extend(n,{idSearchForm:t.id,url:t.url})).pipe(function(t){return t.form.properties.idRender=n.idRender,t})},dispose:function(){var n=this;n.form.dispose();bizagi.util.dispose(n.buttons);bizagi.util.dispose(n)}});
bizagi.rendering.dialog.search.extend("bizagi.rendering.dialog.searchUser",{},{init:function(n,t,i,r,u){this._super(n,t,i,r,u)},getSearchFormData:function(){return{form:{properties:{id:"3ad923cf-f21e-439e-90b5-f2df8ffe4559",type:"searchForm",displayName:"SearchWFuser",xpathContext:"",columns:[{caption:"idUser",dataType:7,xpath:"idUser"},{caption:"userName",dataType:15,xpath:"userName"},{caption:"domain",dataType:15,xpath:"domain"},{caption:"fullName",dataType:15,xpath:"fullName"},{caption:"enabledForAssignation",dataType:5,xpath:"enabledForAssignation"},{caption:"enabled",dataType:5,xpath:"enabled"}]},elements:[{render:{properties:{id:"e0babe1d-7924-4d2a-8fb3-b915b746dbe6",type:"searchText",xpath:"domain",displayName:"domain",dataType:15}}},{render:{properties:{id:"87b14b2e-992d-4e40-a17b-eecbcbc2466a",type:"searchText",xpath:"userName",displayName:"userName",dataType:15}}},{render:{properties:{id:"c5d137d9-a392-4d8e-9088-d5eba64b4c2a",type:"searchText",xpath:"fullName",displayName:"fullName",dataType:15}}}],buttons:[],sessionId:"bcy5gtv11xxao4oy4xrlk3o3",pageCacheId:1876964702},type:"form"}}});
$.Class.extend("bizagi.rendering.dialog.letter",{POPUP_WIDTH:800,POPUP_HEIGHT:550},{init:function(n,t){this.dataService=n;this.renderFactory=t},render:function(n){var t=this,u=window.document,f=t.renderFactory.getTemplate("letter.dialog"),i=$.tmpl(f),r;return i.appendTo("body",u),r=$("#ui-bizagi-rtfeditor",i),r.width(this.Class.POPUP_WIDTH-30),r.height(this.Class.POPUP_HEIGHT-150),new nicEditor({iconsPath:t.dataService.getLetterEditorIconsPath(),fullPanel:!0}).panelInstance("ui-bizagi-rtfeditor"),t.templateParts=n.split(/(<body>|<\/body>)/ig),nicEditors.findEditor("ui-bizagi-rtfeditor").setContent(n),t.showDialogBox(i)},showDialogBox:function(n){var t=this,r={},i=new $.Deferred;return r[bizagi.localization.getResource("render-letter-dialog-box-save")]=function(){var r=nicEditors.findEditor("ui-bizagi-rtfeditor").getContent();n.dialog("destroy");n.remove();t.templateParts[1]=="<body>"?(t.templateParts[2]=r.replaceAll("<header><\/header>",""),i.resolve(t.templateParts.join(""))):i.resolve(t.templateParts[0]+"<body>"+r+"<\/body>"+(t.templateParts.length>2?t.templateParts[2]:""))},r[bizagi.localization.getResource("render-letter-dialog-box-cancel")]=function(){n.dialog("close")},n.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:bizagi.localization.getResource("render-letter-dialog-title"),modal:!0,buttons:r,close:function(){n.dialog("destroy");n.remove();i.reject()}}),i.promise()}});
bizagi.rendering.form.extend("bizagi.rendering.form",{postRenderContainer:function(n){var t=this,i=t.getButtons(),r,u;t._super(n);i.button();r=i?i.length:0;r&&t.params.type==="form"&&t.params.isEntityForm!==!0?(t.properties.orientation=="rtl"&&i.length>0&&!t.properties.useCustomButtons&&t.buttons.reverse(),$(document).data("auto-save",t.properties.id),t.configureBindAutoSave(function(n){t.autoSaveEvents(n)}),t.beforeUnloadFunction=function(){var n={};if(t.collectRenderValues(n),!$.isEmptyObject(n)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")},$(window).unbind("beforeunload").bind("beforeunload",t.beforeUnloadFunction)):t.configureBindAutoSave(function(n){n.resolve()});t.buildProcessPath();u=typeof isWebpart!="undefined"?$(document):$("#ui-bizagi-wp-app-render-form-content");u.scroll(function(){$(".modal-ecm",this).hide()})},configureBindAutoSave:function(n){var t=this;t.autoSaveFunction=function(t,i){n(i)};t.haveAutosaveAssociated()?$(document).unbind("save-form",t.saveFormDelegate):t.saveFormDelegate=$.proxy(t.autoSaveFunction,t);$(document).bind("save-form",{idAutoSave:t.getIdentifierFormForAutosave(),functionSaveFormDelegate:t.saveFormDelegate},t.saveFormDelegate)},unbindAutoSaveForm:function(){var n=this;n.saveFormDelegate&&$(document).unbind("save-form",n.saveFormDelegate)},getIdentifierFormForAutosave:function(){var n=this;return n.properties.id||n.properties.uniqueId},haveAutosaveAssociated:function(){for(var i=!1,r=this,u=r.getIdentifierFormForAutosave(),t=$._data($(document)[0],"events")["save-form"]||[],n=0,f=t.length;n<f;n+=1)if(t[n].data.idAutoSave===u){r.saveFormDelegate=t[n].data.functionSaveFormDelegate;i=!0;break}return i},autoSaveEvents:function(n){var t=this,i={},r=[],u=t.getFormContainer();u.hasChanged(r);r.length>0?$.when(bizagi.showSaveBox(bizagi.localization.getResource("confirmation-savebox-message1"),"Bizagi","warning",t.properties.orientation)).done(function(){t.collectRenderValues(i);$.when(t.saveForm(i)).done(function(){t.saveFormDelegate&&$(document).unbind("save-form",t.saveFormDelegate);n.resolve()})}).fail(function(i){i=="cancel"?n.reject():(n.resolve(),t.saveFormDelegate&&$(document).unbind("save-form",t.saveFormDelegate))}):(t.saveFormDelegate&&$(document).unbind("save-form",t.saveFormDelegate),n.resolve())},getButtons:function(){var n=this,t=n.container;return $(".ui-bizagi-button-container .ui-bizagi-button",t)},configureLayoutView:function(){},dispose:function(){var n=this;$(window).unbind("beforeunload",n.beforeUnloadFunction);$(document).unbind("save-form",n.saveFormDelegate);n._super()},saveForm:function(n){var t=this,r=bizagi.util.isOfflineForm({context:t}),i;return n=t.collectRenderValuesForSubmit(n),i=null,n.deferreds&&(i=$.when.apply($,n.deferreds),delete n.deferreds),$.when(i).pipe(function(){return t.startLoading(),t.dataService.submitData({action:"SAVE",data:n,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,isOfflineForm:r||!1}).pipe(function(){t.endLoading()})})},getChanges:function(){var n=this,t={};return typeof n.collectRenderValues!="undefined"&&n.collectRenderValues(t),t},buildProcessPath:function(){var n=this,r=n.properties,u=n.getMode(),f=n.getFormType()=="queryForm",e=n.params.summaryForm||!1,o=n.properties.displayAsReadOnly||!1,t,i;u=="execution"&&!f&&!e&&!o&&n.properties.processPath&&n.properties.processPath.length>0?(t=n.renderFactory.getTemplate("form-process-path"),i=$.fasttmpl(t,{processPath:r.processPath}),n.pathProcess=i):n.pathProcess=""}});
bizagi.rendering.panel.extend("bizagi.rendering.panel",{},{});
bizagi.rendering.contentPanel.extend("bizagi.rendering.contentPanel",{},{});
bizagi.rendering.panel.extend("bizagi.rendering.nestedForm",{},{configureDesignView:function(){var i=this,r=i.properties,n=i.container,t;n.removeClass("ui-bizagi-container-panel");n.addClass("ui-bizagi-container-nestedform");t=$("<span class= 'ui-bizagi-container-nestedform-title'/>");t.text("Nested Form: "+r.formDisplayName);n.prepend(t)}});
bizagi.rendering.tab.extend("bizagi.rendering.tab",{},{postRenderContainer:function(n){var t=this;t._super(n);n.tabs({active:t.activeTab,activate:function(){t.children[t.activeTab].visibleTab();setTimeout(function(){t.resize({width:t.container.width(),height:t.container.height()});typeof t.getParams()!="undefined"&&(t.getParams().context=="sharepoint"||window.self!==window.top)&&t.resizeInPopUpHTML()},50)},beforeActivate:function(n,i){var r=i.newTab.index(),f,u;t.triggerHandler("selected",{index:r,tab:t.children[r]});t.children[r]&&(f=t.getFormContainer(),t.children[r].activate(),t.activeTab=r,u={},u[t.children[r].parent.properties.id]=r,f.setParam("selectedTabs",u))}})},resizeInPopUpHTML:function(){var u=this,r;if($(".activitiFormContainer").length>0){var n=$(".activitiFormContainer").height()||0,t=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),i=$(".ui-bizagi-button-container",".activitiFormContainer"),f=u.getParams();f.idWorkitem||i.length>0?(r=i.height()||0,t.height(n-110-r)):t.height(n-110)}},configureLayoutView:function(){}});
bizagi.rendering.tabItem.extend("bizagi.rendering.tabItem",{},{init:function(n){var t=this;this._super(n);t.tabReadyDeferred=new $.Deferred;t.loadingDeferred=new $.Deferred;t.tabActiveDeferred=new $.Deferred},resize:function(){var n=this,t=n.container,u=t.width(),i=0,r=function(){i>10||(t.is(":visible")?$.each(n.children,function(n,t){t.resize({width:u})}):(i++,setTimeout(r,200)))};$.when(n.ready()).done(function(){r()})},setAsActiveContainer:function(){var n=this;$.when(n.ready()).done(function(){var t=n.parent;t.container.data("ui-tabs")&&t.container.tabs("option","active",n.container.data("tab-counter"))})},activate:function(){var n=this;n._super();n.loadingDeferred&&n.loadingDeferred.resolve()},visibleTab:function(){var n=this;n.tabActiveDeferred&&n.tabActiveDeferred.resolve()},focus:function(){var n=this;n.activate();n.setAsActiveContainer();this._super()},renderTabContent:function(n){var t=this,i=this.properties,r=t.getFormContainer();return i.loadOnDemand===undefined||i.loadOnDemand==!1||r.innerTabsLoading?(n=t.replaceChildrenHtml(n,t.renderChildrenHtml()),t.tabReadyDeferred.resolve(),t.tabActiveDeferred.resolve(),n):(t.startLoading(),t.getMode()=="execution"&&setTimeout(function(){t.loadingDeferred&&t.loadingDeferred.resolve()},10500),$.when(t.loadingDeferred.promise()).done(function(){t.isDisposed()?(t.tabReadyDeferred.reject(),t.tabActiveDeferred.reject()):(t.replaceChildrenTag(t.container,t.renderChildrenHtml()),t.postRenderContainer(t.container),t.endLoading(),t.tabReadyDeferred.resolve(),t.tabActiveDeferred.resolve())}),t.replaceChildrenHtml(n,'<div class="children"/>'))},ready:function(n){var t=this,i;return bizagi.util.parseBoolean(n)&&t.container&&t.container.length&&(t.loadingDeferred&&t.loadingDeferred.resolve(),$.when(t.tabReadyDeferred.promise()).done(function(){t.activate()})),bizagi.util.parseBoolean(n)&&(t.container&&t.container.length||(i=setInterval(function(){t.container&&t.container.length&&(clearInterval(i),t.loadingDeferred&&t.loadingDeferred.resolve())},50))),$.when(t.tabReadyDeferred.promise(),t.parent.ready(),t.tabActiveDeferred.promise())},changeVisibility:function(n){var t=this,u=t.properties;t._super(n);var r=t.parent.container,f="ui-bizagi-tab-"+u.id,i=$("ul li[aria-controls = '"+f+"']",r),e=t.parent.getActiveTab();$.when(t.ready()).done(function(){u.visible?(i&&i.show(),t.setAsActiveContainer()):t.getMode()==="execution"&&i&&i.hide()}).always(function(){r.data("ui-tabs")&&r.tabs("option","active",e)})},afterToRefresh:function(){var n=this;n._super();$(n.parent.container).tabs("refresh")}});
bizagi.rendering.horizontal.extend("bizagi.rendering.horizontal",{},{postRenderContainer:function(n){var i=this,r=i.children,t=r.length;i._super(n);$.each(r,function(n,i){var r=i.properties.width;r=r==null||r.length==0?100/t:bizagi.util.percent2Number(r);n!=t-1?i.getRenderedElement().css({width:r+"%"}):i.getRenderedElement().css({width:r+"%"});i.getRenderedElement().addClass("ui-panel-area");n==t-1&&i.getRenderedElement().addClass("ui-bizagi-render-last")})}});
bizagi.rendering.accordion.extend("bizagi.rendering.accordion",{},{postRenderContainer:function(n){var t=this;t._super(n);n.accordion({autoHeight:!1})},configureLayoutView:function(){}});
bizagi.rendering.accordionItem.extend("bizagi.rendering.accordionItem",{},{setAsActiveContainer:function(){var n=this;$.when(n.ready()).done(function(){var t=n.parent;t.container.accordion("option","active",n.properties.ordinal)})},focus:function(){var n=this;n.activate();n.setAsActiveContainer();this._super()}});
bizagi.rendering.group.extend("bizagi.rendering.group",{},{postRenderContainer:function(n){var r=this,t=r.properties,i=t.orientation=="rtl"?"-rtl":"",u;r._super(n);u=$(".ui-icon",$(".ui-bizagi-container-group-header:first",r.container));bizagi.util.parseBoolean(t.collapse)?(t.expanded=!1,u.addClass("ui-state-collapse"+i).removeClass("ui-state-expand"+i)):(t.expanded=!0,u.addClass("ui-state-expand"+i).removeClass("ui-state-collapse"+i))},configureHandlers:function(){var u=this,n=u.properties,t=n.orientation=="rtl"?"-rtl":"",r=u.container,i,f=$(".ui-bizagi-container-group-header:first",r);$(f).click(function(u){u.preventDefault&&u.preventDefault();i=$(".ui-icon",r);i.toggleClass("ui-icon-triangle-1-s ui-icon-triangle-1-n");$(".ui-bizagi-container-group-wrapper:first",r).toggle();n.expanded?(n.expanded=!1,i.addClass("ui-state-collapse"+t).removeClass("ui-state-expand"+t)):(n.expanded=!0,i.addClass("ui-state-expand"+t).removeClass("ui-state-collapse"+t))})},isOpen:function(){var n=this,t=n.properties;return t.expanded?!0:!1},focus:function(){var n=this;n.expand();this._super()},expand:function(){var n=this,t=n.container,i=$(".ui-bizagi-container-group-header:first",t);n.isOpen()||$(i).trigger("click")},collapse:function(){var n=this,t=n.container,i=$(".ui-bizagi-container-group-header:first",t);n.isOpen()&&$(i).trigger("click")},toogleContainer:function(n){var t=this;n?t.expand():t.collapse()}});
bizagi.rendering.searchForm.extend("bizagi.rendering.searchForm",{},{renderResult:function(){var t=this,i=t.properties,r={},n,u;return r.properties={displayName:t.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+i.id,id:i.id,skipInitialLoad:!0,rowsPerPage:10,inlineAdd:!1,allowDelete:!1,allowAdd:!1,sortBy:i.sortBy,sortOrder:i.sortOrder,overrideGetRemoteData:function(n){return t.getRemoteData(n)}},r.elements=[],n=i.columns,$.each(n,function(i){var u={render:{}};u.render.properties={displayName:n[i].caption,xpath:n[i].xpath,editable:!1};$.extend(u.render.properties,t.parseAdditionalProperties(n[i].dataType));n[i].dataType==0&&(u.render.properties.columnVisible=!1);(n[i].dataType==7||n[i].dataType==8)&&(u.render.properties.allowDecimals=n[i].allowDecimals);(n[i].dataType==10||n[i].dataType==11)&&(u.render.properties.allowDecimals=!0);n[i].dataType==12&&(u.render.properties.showTime=n[i].showTime);r.elements.push(u)}),u=t.renderFactory.getRender({type:"grid",data:r,parent:t,mode:t.getMode(),jqgrid:!1}),t.resultsGrid=u,u.render()},postRenderContainer:function(n){var t=this,o=t.properties,u=n.find(".ui-bizagi-container-search-criteria"),f=n.find(".ui-bizagi-container-search-results"),e=u.children(),i=t.getMode(),r;t.container=n;$.each(e,function(n,i){var u,r,f;i=$(i);u=Number(i.data("unique-id"));u&&(r=t.childrenHash[u],r&&(f=r.getElementType(),f==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.postRenderElement(i),f==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.postRenderContainer(i)))});r=$(f.children()[0]);t.resultsGrid.postRenderElement(r);i=="execution"&&t.configureHandlers();i=="design"&&t.configureDesignView();i=="layout"&&(t.configureDesignView(),t.configureLayoutView())},configureHandlers:function(){var n=this;return n.criteriaContainer=$(".ui-bizagi-container-search-criteria",n.container),n.resultsContainer=$(".ui-bizagi-container-search-results",n.container),n.resultsGrid.bind("rowSelected",function(t,i){n.properties.searchParams.hasOwnProperty("multiSelect")?n.trigger("multiSelect",i):n.trigger("instanceSelected",i)}),n},refreshResults:function(){var n=this,t=n.resultsGrid;t.refresh();$.when(t.dataReady()).done(function(){n.resultsContainer.show();n.resizeResults()})},resize:function(){var n=this;n.resizeResults()},resizeResults:function(){var n=this,t=n.resultsGrid;n.resultsContainer.is(":visible")?n.criteriaContainer.height("auto"):n.criteriaContainer.height("100%");t.resize({width:n.criteriaContainer.width(),onSearchFinished:function(){var n=this;n.properties&&(n.properties.records==0?($(".ui-bizagi-container-search-results",n.container).show(),$(".ui-bizagi-container-search-results .ui-jqgrid-title",n.container).hide()):$(".ui-bizagi-container-search-results .ui-jqgrid-title",n.container).show())}})}});
bizagi.rendering.text.extend("bizagi.rendering.text",{},{postRender:function(){var n=this,t=n.properties;this._super();t.maxLength>0&&n.input.attr("maxlength",t.maxLength)},setDisplayValue:function(n){var i=this,r=i.properties,t;this._super(n);!bizagi.util.isEmpty(n)&&r.editable?(t=n.toString().replaceAll("\\n"," "),t=t.replaceAll("\n"," "),i.input.val(t)):n===null&&r.editable&&i.input.val("")},attachRetypeDouble:function(){var t=this,i=t.element,n=$("input",i);n&&n.length!=0&&n.blur(function(){var n=$(this);t.retypeDouble(n)})},retypeDouble:function(n){var t=this,r=t.element,i;if($(n).attr("type")!="hidden"&&$(n).css("display")!="none"&&$(n).css("visibility")!="hidden"&&$(this).data("newValue")==undefined)if(n.data("oldValue")&&$(this).data("oldValue")!=""){if(n.val()=="")return;if(n.val()!=n.data("oldValue")){t.setValue("");n.val("");n.data("oldValue","");n.tooltip("destroy");n.attr("title",t.getResource("render-text-retype-fail"));n.tooltip();i=$.getMaxZindex();n.tooltip().on("tooltipopen",function(n,t){t.tooltip.zIndex(i)});n.tooltip("open");setTimeout(function(){n.focus()},100)}else n.data("newValue",n.val()),n.data("oldValue",""),n.tooltip("destroy")}else{if(n.val()=="")return;if(n.val()==n.data("newValue"))return;n.data("oldValue",n.val());n.val("");try{n.tooltip("destroy")}catch(u){}n.attr("title",t.getResource("render-text-retype"));n.tooltip();i=$.getMaxZindex();n.tooltip().on("tooltipopen",function(n,t){t.tooltip.zIndex(i)});n.tooltip("open");setTimeout(function(){n.focus()},100)}},collectData:function(n){var t=this,r=t.properties,u=r.xpath,i=t.getValue();t.getValue()!=null&&typeof t.getValue()!="undefined"&&(i=t.getValue().replaceAll(String.fromCharCode("030"),""),i=t.getValue().replaceAll(String.fromCharCode("018"),""),i=t.getValue().replaceAll(String.fromCharCode("016"),""));$.controlValueIsChanged(t)&&(bizagi.util.isEmpty(u)||(bizagi.util.isEmpty(i)?i===""&&(n[r.xpath]=""):n[r.xpath]=i))}});
bizagi.rendering.extendedText.extend("bizagi.rendering.extendedText",{},{postRender:function(){var n=this;n._super();bizagi.util.isIE8()&&n.textarea.attr("cols","5000")},configureHandlers:function(){var n=this,t=n.properties;n._super();t.maxLength>0&&(n.textarea.attr("maxlength",t.maxLength),n.actualMaxLength=t.maxLength,$(n.textarea).bind("keydown",function(t){(t.which===8||t.which===13||t.which===32||t.which>46)&&n.setMaxLengthContext()}),$(n.textarea).bind("paste",function(){setTimeout(function(){n.setMaxLengthContext()},100)}));n.ready().done(function(){if(t.autoExtend){var u="",i=n.textarea.css("height"),f,r=$("<div />").css({whiteSpace:"pre-wrap",display:"none"});typeof i=="string"&&i.search("px")!==-1?(f=Number(i.split("px")[0]),f<=150&&(i="150px")):i="150px";n.textarea.css({overflow:"hidden",resize:"none",minHeight:i});r.insertAfter(n.textarea);setTimeout(function(){n.proccessStyles(u,r)},100);n.textarea.bind("keyup",function(){n.proccessStyles(u,r)})}})},proccessStyles:function(n,t){var i=this;n!==(n=i.textarea.val())&&(t.text(n),i.textarea.css("height",t.height()))},setMaxLengthContext:function(){var n=this,t=n.textarea.val(),i=t.match(/\n/gm),r=i?i.length:0;n.setMaxLength(n.textarea,r,t)},setMaxLength:function(n,t,i){var u=this,f=u.properties,r=f.maxLength-3*t;r=r>0?r:0;i.length>r&&n.val(i.substr(0,r));u.actualMaxLength!==r&&(n.attr("maxlength",r),u.actualMaxLength=r)},setDisplayValue:function(n){var t=this,u=t.properties,i=bizagi.util.decodeURI(n),r;n=typeof i=="string"?i:"";this._super(n);n&&u.editable&&(r=$.br2nl(n),t.textarea.val(r))},collectData:function(n){var t=this,r=t.properties,u=r.xpath,i=t.getValue();t.getValue()!=null&&typeof t.getValue()!="undefined"&&(i=t.getValue().replaceAll(String.fromCharCode("030"),""),i=t.getValue().replaceAll(String.fromCharCode("018"),""),i=t.getValue().replaceAll(String.fromCharCode("016"),""));$.controlValueIsChanged(t)&&(bizagi.util.isEmpty(u)||(bizagi.util.isEmpty(i)?i===""&&(n[r.xpath]=""):n[r.xpath]=i))},cleanData:function(){var n=this;n.setValue("");n.clearDisplayValue()},clearDisplayValue:function(){var n=this,t=n.getControl(),i=t.find("textarea");i.length>0?i.val(n.getValue()):n.properties.editable||$(t).html("<div class='ui-bizagi-render-control    ui-bizagi-text-extended-readonly'><\/div>")},attachRetypeDouble:function(){var n=this,i=n.element,t=$("input, textarea",i);t&&t.length!=0&&t.blur(function(){var t=$(this),i=n.previousValue,r=n.value;i!=null&&r!=i&&$(this).data("newValue")!=undefined&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=undefined);n.retypeDouble(t)})},retypeDouble:function(n){var t=this,r=t.element,i;if($(n).attr("type")!="hidden"&&$(n).css("display")!="none"&&$(n).css("visibility")!="hidden"&&$(this).data("newValue")==undefined)if(n.data("oldValue")&&$(this).data("oldValue")!=""){if(n.val()=="")return;if(n.val()!=n.data("oldValue")){t.setValue("");n.val("");n.data("oldValue","");n.tooltip("destroy");n.attr("title",t.getResource("render-text-retype-fail"));n.tooltip();i=$.getMaxZindex();n.tooltip().on("tooltipopen",function(n,t){t.tooltip.zIndex(i)});n.tooltip("open");setTimeout(function(){n.focus()},100)}else n.data("newValue",n.val()),n.data("oldValue",""),n.tooltip("destroy")}else{if(n.val()=="")return;if(n.val()==n.data("newValue"))return;n.data("oldValue",n.val());n.val("");try{n.tooltip("destroy")}catch(u){}n.attr("title",t.getResource("render-text-retype"));n.tooltip();i=$.getMaxZindex();n.tooltip().on("tooltipopen",function(n,t){t.tooltip.zIndex(i)});n.tooltip("open");setTimeout(function(){n.focus()},100)}}});
bizagi.rendering.label.extend("bizagi.rendering.label",{},{postRender:function(){var n=this;n.getLabel().addClass("ui-bizagi-render-label")},postRenderReadOnly:function(){var n=this;n.getLabel().addClass("ui-bizagi-render-label")}});
bizagi.rendering.label.extend("bizagi.rendering.queryLabel",{},{});
bizagi.rendering.number.extend("bizagi.rendering.number",{},{setDisplayValue:function(n){var t=this,i=t.properties;this._super(n);n!=null&&i.editable&&(t.numericInput.val(n),t.value=t.properties.value=n,t.executeFormatCurrencyPlugin())},attachRetypeDouble:function(){var n=this,i=n.element,t=$("input",i);t&&t.length!=0&&t.blur(function(){var t=$(this),i=n.previousValue,r=n.value,u=n.parent.properties.type;u=="grid"?(i!=null&&r!=i&&$(this).data("newValue")!=undefined&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=undefined),n.retypeDouble(t)):n.retypeDouble(t)})},retypeDouble:function(n){var t=this,u=t.element,i;if($(n).attr("type")!="hidden"&&$(n).css("display")!="none"&&$(n).css("visibility")!="hidden"&&$(this).data("newValue")==undefined)if(n.data("oldValue")&&$(this).data("oldValue")!=""){if(n.val()=="")return;if(n.val()!=n.data("oldValue")){t.setValue("");n.val("");n.data("oldValue","");try{n.tooltip("destroy")}catch(r){console.log("Error: "+r)}n.attr("title",t.getResource("render-number-retype-fail"));n.tooltip();i=$.getMaxZindex();n.tooltip().on("tooltipopen",function(n,t){t.tooltip.zIndex(i)});n.tooltip("open");setTimeout(function(){n.focus()},100)}else{n.data("newValue",n.val());n.data("oldValue","");try{n.tooltip("destroy")}catch(r){console.log("Error: "+r)}}}else{if(n.val()=="")return;if(n.val()==n.data("newValue"))return;n.data("oldValue",n.val());n.val("");try{n.tooltip("destroy")}catch(r){console.log("Error: "+r)}n.attr("title",t.getResource("render-number-retype"));n.tooltip();i=$.getMaxZindex();n.tooltip().on("tooltipopen",function(n,t){t.tooltip.zIndex(i)});n.tooltip("open");setTimeout(function(){n.focus()},100)}}});
bizagi.rendering.number.extend("bizagi.rendering.queryNumber",{},{setDisplayValue:function(n){var i=this,t=i.properties;this._super(n);n!==null&&t.editable&&i.setValue(i.numericInput.asNumber({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits}))}});
bizagi.rendering.date.extend("bizagi.rendering.date",{},{initializeData:function(n){var r=this,t,i;r.i18n=bizagi.localization.getResource("datePickerRegional");this._super(n);t=this.properties;i=r.getDateFormat(t.dateFormat);t.datePickerFormat=i.datePickerFormat;t.timePickerFormat=i.timePickerFormat},getDateFormat:function(n){var t=n,r=undefined,i,u=this.properties;return(n.search("h")!=-1||n.search("H")!=-1)&&(i=n.search("h")!=-1?n.search("h"):n.search("H"),t=n.substring(0,i-1),r=n.substr(i)),t.indexOf("MMMM")>=0?t=t.replaceAll("MMMM","MM"):t.indexOf("MMM")>=0?t=t.replaceAll("MMM","M"):t.indexOf("MM")>=0?t=t.replaceAll("MM","mm"):t.indexOf("M")>=0&&(t=t.replaceAll("M","m")),t.search("yyyy")!=-1?t=t.replaceAll("yyyy","yy"):t.search("yy")!=-1&&(t=t.replaceAll("yy","y")),t=t.replaceAll("dddd","DD"),{datePickerFormat:t,timePickerFormat:r}},getElementsToStylize:function(n){return $(n).children()},getTimePickerFormat:function(n){for(var u=0,f,r={show24Hours:!1,showSeconds:!1,showZeroInHour:!0,separator:":"},t,i="";u<n.length;){for(f=n.charAt(u),t="";n.charAt(u)==f&&u<n.length;)t+=n.charAt(u++);t=="hh"||t=="h"?(i=t,r.show24Hours=!1,r.showZeroInHour=t=="h"?!1:!0):t=="HH"||t=="H"?(i=t,r.show24Hours=!0,r.showZeroInHour=t=="H"?!1:!0):t=="mm"||t=="m"?i=t:t=="ss"||t=="s"?(i=t,r.showSeconds=!0):t=="a"?i=t:i.toUpperCase()=="H"||i.toUpperCase()=="HH"?r.separator=t:(i.toUpperCase()=="S"||i.toUpperCase()=="SS")&&(i=t,r.ampmPrefix=t)}return r},postRender:function(){var t=this,n=t.properties,r=t.getTimeControl(),u=t.getDateControl(),o=u.parent(),f,e,i;this._super();f=parseInt((new Date).getFullYear()+200).toString();e=parseInt((new Date).getFullYear()-200).toString();typeof n.maxValue=="undefined"&&(n.maxValue="12/31/"+f+" 00:00:00");typeof n.minValue=="undefined"&&(n.minValue="01/01/"+e+" 00:00:00");n.showTime&&(t.getMode()=="execution"&&window.setTimeout(function(){if(u.parent()&&r.parent()){var i=n.helpText.length>0?"47%":"54%";t.grid&&(i="63%");u.parent().width(i);n.orientation=="rtl"&&(t.getTimeControl().css("paddingLeft","0px"),t.getTimeControl().css("paddingRight","4px"));r.width("65px")}},0),i=n.timePickerFormat!==undefined?t.getTimePickerFormat(n.timePickerFormat):bizagi.util.dateFormatter.analyzeTimeFormat(n.timeFormat),r.timeEntry({spinnerTexts:[this.getResource("render-timeentry-now"),this.getResource("render-timeentry-previous-field"),this.getResource("render-timeentry-next-field"),this.getResource("render-timeentry-increment"),this.getResource("render-timeentry-decrement")],showSeconds:i.showSeconds,show24Hours:i.show24Hours,separator:i.separator,ampmPrefix:i.ampmPrefix||"",useMouseWheel:t.getMode()=="execution",showZeroInHour:i.showZeroInHour}),$(".timeEntry_control",r).css("height","").css("width","").css("display","").css("background-color","").css("background-image","").css("background-position","").css("background-repeat",""))},configureHandlers:function(){var n=this,t=n.properties,i=n.getDateControl(),e=n.getDateIcon(),u=100,f=30,r;isNaN(Date.parse(t.minValue))||(u=(new Date).getFullYear()-$.datepicker.parseDate("mm/dd/yy",t.minValue).getFullYear()||100);isNaN(Date.parse(t.maxValue))||(f=$.datepicker.parseDate("mm/dd/yy",t.maxValue).getFullYear()-(new Date).getFullYear()||100);n._super();$.datepicker.setDefaults(n.i18n);r={firstDay:bizagi.override.firstDay||0,yearRange:"c-"+u+":c+"+f,dateFormat:t.datePickerFormat,changeYear:!0,changeMonth:!0,shortYearCutoff:typeof BIZAGI_DEFAULT_DATETIME_INFO!="undefined"&&typeof BIZAGI_DEFAULT_DATETIME_INFO.twoDigitYearMaxDelta!="undefined"?"+"+BIZAGI_DEFAULT_DATETIME_INFO.twoDigitYearMaxDelta:"+50",beforeShow:function(){n.properties.editable=!0;n.changeMinValue(n.properties.minValue);n.changeMaxValue(n.properties.maxValue);n.setDisplayValue(n.getValue())}};bizagi.util.isIE()&&(r=$.extend(r,{onSelect:function(){n.getLabel().focus();$(this).change()}}));i.datepicker(r);i.bind("change",function(){var t=i.val();bizagi.util.isEmpty(t)?n.setValue(""):t.match(/\d{5,}/)?n.setDisplayValue(n.getDisplayValue()):bizagi.util.dateFormatter.getDateFromFormat(t,n.properties.dateFormat.substring(0,n.properties.dateFormat.search("h|H")!=-1?n.properties.dateFormat.search("h|H")-1:n.properties.dateFormat.length),n.i18n)==0&&(n.setValue(""),i.val(""))});e.bind("click",function(){i.focus()});t.orientation=="rtl"&&($(".ui-bizagi-wp-app-icon-date").css("right","auto"),$(".ui-bizagi-wp-app-icon-date").css("left","7px"))},configureDesignView:function(){var t=this,i=t.properties,n=t.getControl();i.showTime&&(n.find(".timeEntry_control").unbind("mousedown"),n.find(".timeEntry_control").unbind("mouseup"),n.find(".timeEntry_control").unbind("mouseover"),n.find(".timeEntry_control").unbind("mousemove"))},getDateControl:function(){var n=this;return n.dateControl=$(".ui-bizagi-render-date",n.getControl()),n.dateControl},getDateIcon:function(){var n=this;return n.dateIcon=$(".ui-bizagi-wp-app-icon-date",n.getControl()),n.dateIcon},getTimeControl:function(){var n=this;return n.timeControl=$(".ui-bizagi-render-time",n.getControl()),n.timeControl},changeMinValue:function(n){var t=this,i=t.properties,r=t.getDateControl();n&&i.editable&&(i.minValue=n,r.datepicker("option","minDate",new Date(n)))},changeMaxValue:function(n){var t=this,i=t.properties,r=t.getDateControl();n&&i.editable&&(i.maxValue=n,r.datepicker("option","maxDate",bizagi.util.dateFormatter.getDateFromInvariant(n)))},setDisplayValue:function(n){var i=this,r=i.properties,e=i.getDateControl(),u=i.getTimeControl(),t,f;if(bizagi.util.isNumeric(n)&&n!==0&&(n=bizagi.util.dateFormatter.formatInvariant(new Date(n))),this._super(n),n&&r.editable){if(r.timePickerFormat!==undefined?t=i.getMode()!="execution"?bizagi.util.dateFormatter.getDateFromInvariant(n):bizagi.util.dateFormatter.getDateFromInvariant(n,!0):r.showTime?(f="MM/dd/yyyy H:mm:ss",typeof n=="string"?n.length==f.length||n.length==f.length+1?t=bizagi.util.dateFormatter.getDateFromInvariant(n,!0):(t=bizagi.util.dateFormatter.getDateFromInvariant(n),t.setHours(0,0,0,0)):t=bizagi.util.dateFormatter.getDateFromInvariant(n,!0)):t=bizagi.util.dateFormatter.getDateFromInvariant(n),bizagi.assert(t!=0,"The date could not be parsed",n),i.internalSetInitialValueFlag){i.getMode()==="execution"&&(e.datepicker("setDate",t),u.timeEntry("setTime",t));window.setTimeout(function(){i.checkIcon()},0);return}e.datepicker("setDate",t);r.showTime&&u.timeEntry("setTime",t);r.displayValue=bizagi.util.dateFormatter.formatDate(t,r.fullFormat,i.i18n);i.checkIcon()}i.autoWidthTimeControlByValue(u,75)},checkIcon:function(){var n=this,t=n.getDateControl(),r,i;n.getFormContainer()&&n.getFormContainer().mode=="execution"&&(r=n.getDateControl().val(),t.width()>0&&t.width()<190&&(r.length>15?(n.dateIcon.hide(),t.css("padding","1px 5px 1px 4px")):(n.dateIcon.show(),i=$("input",n.getControl()).css("paddingRight").replace("px",""),(i>20||i==5)&&t.css("paddingRight","22px"))))},removeValidations:function(){var n=this,t=n.getFormContainer().parent||n.getFormContainer();t.clearValidationMessages()},focus:function(n){var t=this,i=t.getDateControl();this._super(n)},onChangeHandler:function(){var n=this,r=n.properties,o=n.getDateControl(),i=n.getTimeControl(),t=o.datepicker("getDate"),u,e,s,h,c,l,f,a;if(r.showTime&&i.length>0&&(u=i.timeEntry("getTime"),u?t==null&&(t=new Date):t!=null&&(u=new Date(0,0,0,0,0,0,0),i.timeEntry("setTime","12:00:00 AM")),t.setHours(u.getHours()),t.setMinutes(u.getMinutes()),t.setSeconds(u.getSeconds())),!t||t==0){n.checkIcon();return}if(e=n.value,n.setValue(bizagi.util.dateFormatter.formatInvariant(t,r.showTime)),s=n.getValue(),h=bizagi.util.dateFormatter.getDateFromInvariant(s,!0),typeof i.val()!="undefined"&&i.val().length==0&&i.timeEntry("setTime",h),o.val().length>0)if(!r.showTime||r.showTime&&i.val().length>0){if(!n.isValid([])){c=n.dateControl.val();n.setValue("");n.setDisplayValue("");n.dateControl.val("");l=n.properties.xpath;f=bizagi.localization.getResource("workportal-general-invalid-date");f=f.replace("{0}",l);typeof n.getFormContainer().validationController=="undefined"&&(n.getFormContainer().validationController=new bizagi.command.controllers.validation(n.getFormContainer(),n.validations));a=n.getFormContainer().validationController||n.getFormContainer().parent.validationController;n.removeValidations();a.showValidationMessage(f+" "+c+"");return}}else n.setValue(e),n.setDisplayValue(e);r.displayValue=bizagi.util.dateFormatter.formatDate(t,r.fullFormat,n.i18n);n.checkIcon();n.autoWidthTimeControlByValue(i,75)},afterToRefresh:function(){var n=this,i=n.getDateControl(),t=[];n.isValid(t);t.length>0&&n.setValue("")},autoWidthTimeControlByValue:function(n,t){setTimeout(function(){try{var i=parseInt(n.css("font-size").replace("px",""))*.8*n.val().length+25;i>t&&n.style("width",i.toString()+"px","important")}catch(r){}},100)}});
bizagi.rendering.date.extend("bizagi.rendering.queryDate",{},{collectDataQueryForm:function(n){var t=this,u=t.properties,e=u.xpath,i=t.getValue(),f=null,o=t.controlValueIsChanged(),r;bizagi.util.isEmpty(e)||(i!==null&&typeof i!="undefined"&&i!==""&&(f=i),(f!==null||u.included)&&(r=t.properties.typeSearch||t.properties.rangeQuery||"NONE",r=r.toUpperCase(),n.push({value:f,included:t.properties.included,xpath:u.xpath,searchType:r,orderType:"NONE"})))}});
bizagi.rendering.yesno.extend("bizagi.rendering.yesno",{},{postRender:function(){var t=this,n=t.getControl();this._super();n.addClass("ui-bizagi-render-display-block");n.addClass("ui-bizagi-render-boolean-yesno");n[0]&&$.removeData(n[0]);n.optiongroup({orientation:t.properties.orientation})},configureHandlers:function(){var n=this,t=n.getControl();n._super();t.bind("optiongroupchange",function(t,i){bizagi.util.parseBoolean(n.value)!=bizagi.util.parseBoolean(i.value)&&n.setValue(i.value)})},configureDesignView:function(){var n=this,t=n.getControl();t.find("input").unbind("click")},setDisplayValue:function(n){var i=this,r=i.properties,u=i.getControl(),t;this._super(n);n!=null&&r.editable&&(t=bizagi.util.parseBoolean(n),t!=null&&u.optiongroup("setValue",t.toString()))},cleanData:function(){var n=this,t={id:"",label:""};n.setDisplayValue(t);n.setValue(t,!1);n.clearDisplayValue()},clearDisplayValue:function(){var n=this,t=n.element.find(".ui-radio-state-checked");t.removeClass("ui-radio-state-checked")}});
bizagi.rendering.check.extend("bizagi.rendering.check",{},{postRender:function(){var t=this,n=t.getControl();this._super();n.addClass("ui-bizagi-render-display-block");n.addClass("ui-bizagi-render-boolean-yesno");t.properties.required&&$(".ui-bizagi-render-control-required",n).css({height:"22px"});bizagi.util.isIE()?n.find("label").addClass("checkbox-ie"):t.input.check()},postRenderReadOnly:function(){var t=this,i=t.getControl(),n;t.postRender();n=$("input",i);n.attr("readonly","readonly");n.attr("disabled","disabled")},configureHandlers:function(){var n=this;n._super();bizagi.util.isIE()?n.input.bind("change",function(){var t=$("input",n.input).is(":checked");n.setValue(t)}):n.input.bind("checkchange",function(t,i){n.setValue(i.value)})},configureDesignView:function(){var n=this,t=n.getControl();t.find("input").unbind("click")},setDisplayValue:function(n){var t=this,r=t.properties,i;n=bizagi.util.parseBoolean(n);this._super(n);i=bizagi.util.parseBoolean(n);bizagi.util.isIE()?i==!0?$("input",t.input).attr("checked","checked"):$("input",t.input).removeAttr("checked"):i==!0?t.input.check("checkItem"):t.input.check("uncheckItem")},cleanData:function(){var n=this;n.setDisplayValue(!1);n.setValue(!1,!1)}});
bizagi.rendering.combo.extend("bizagi.rendering.combo",{},{initializeData:function(n){var i=this,t;this._super(n);t=this.properties;t.loadOnDemand=!0},postRender:function(){var n=this,t=n.inputCombo=$(".ui-selectmenu-value",n.getControl());n.selectedValue=n.properties.value;this._super()},configureHandlers:function(){var n=this,t=n.getControl();n.inputCombo.focus(function(){$(this).select()});n.inputCombo.click(function(){var t="dd-"+n.inputCombo.attr("id");$("#"+t,n.getControl().parent()).length===0?n.comboDropDown():n.dropDownDestroy($("#"+t));n.inputCombo.focus()});$(".ui-selectmenu-btn",n.control).length>1&&typeof addEventListener!="undefined"?$(".ui-selectmenu-btn",n.control)[0].addEventListener("click",function(){n.inputCombo[0].click()}):$(".ui-selectmenu-btn",n.control).bind("click.combo",function(){n.inputCombo.trigger("click")});n.inputCombo.keyup(function(t){n.keyUpFunction(t)});n.inputCombo.keydown(function(t){n.keyDownFunction(t)});n.inputCombo.blur(function(){n.setDisplayValue(n.value)});n._super()},comboDropDown:function(){var n=this;n.showLoadingData();$.when(n.getData()).done(function(t){n.hideLoadingData();try{n.internalComboDropDown(t);typeof Windows!="undefined"&&n.grid&&$(n.grid.element).find(".bz-rn-grid-data-wraper").css("overflow","hidden")}catch(i){bizagi.log(i.message)}})},showLoadingData:function(){var t=this,i=$("body",document),n=t.loading=$("<div class='ui-select-dropdown open loading'><ul><li class='ui-bizagi-render-loading ui-bizagi-loading'><\/li><\/ul><\/div>");n.css("width",t.inputCombo.outerWidth()+"px");$("li",n).css({padding:0,margin:0});n.css("overflow","hidden");n.appendTo(i);n.position({my:"left top",at:"left bottom",of:t.inputCombo,collision:"none flip"})},hideLoadingData:function(){var n=this;n.loading.remove()},internalComboDropDown:function(n){var f,v,r,t,h;$(".ui-select-dropdown.open").remove();var i=this,c={},u={},l=$("<div class='ui-select-dropdown open'><\/div>"),e=i.inputCombo.closest(".ui-bizagi-control"),o=e.closest(".ui-bizagi-render"),y="dd-"+i.inputCombo.attr("id"),s=i.findDataByValue(i.inputCombo.val()),a=0,p=i.properties.orientation==="rtl"?"ui-bizagi-rtl":"";for((navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0)&&(f=o.closest(".ui-dialog-content"),f.length>0&&f.css("overflow-y","hidden")),n=n||i.properties.data,i.properties.data=n,i.repositionInterval,v=o.css("height"),o.addClass("ac-is-visible"),o.css("height",v),e.addClass("ac-is-visible ac-clear-floats"),l.attr("id",y),r=0;r<n.length;r++)n[r].value!==null&&typeof n[r].value=="boolean"&&(bizagi.util.parseBoolean(n[r].value)==!0?n[r].value=this.getResource("render-boolean-yes"):bizagi.util.parseBoolean(n[r].value)==!1&&(n[r].value=this.getResource("render-boolean-no")));c=n.length>1e3?i.getResource("render-combo-too-many-elements"):$.tmpl("<ul>{{each datasource}}{{if typeof hidden == 'undefined'}}<li data-value='${id}'>${value}<\/li>{{/if}}{{/each}}<\/ul>",{datasource:n});t=l.append(c);e.append(t);h=$(".ui-selectmenu",i.control);$(t).find("li:last-child").css("padding-bottom","13px");t.width(h.width());t.position({my:"left top",at:"left bottom",of:$(".ui-selectmenu",i.control),collision:"fit"}).hide();t.show();(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0)&&f.length>0&&f.css("overflow-y","auto");i.recalculateComboOffset(t,h);t.data("formWidth",e.width());t.data("parentCombo",i.control);t.addClass(p);s!==-1&&$("li",t).length>0&&(u=s&&s.id==""?$("li[data-value='']",t):$("li[data-value='"+s.id+"']",t),u.length!=0&&(u.addClass("ui-selected"),u.addClass("active"),a=parseInt(u.position().top),t.scrollTop(a)));t.delegate("li","click",function(){var u=$(this).data("value")?$(this).data("value"):"",r={id:u,value:$(this).text()},n=i.getValue();if(n=n&&n.id?n.id:0,r.id!==n)i.onComboItemSelected(r);else r.value!==i.inputCombo.val()&&i.setDisplayValue({value:r.value});i.inputCombo.select();t.hide();i.dropDownDestroy(t);$(document).unbind("click.closecombo")});$.makeArray(t,i.getControl()).bind("click",function(n){return n.preventDefault(),!1});t.bind("mousedown.closecombo",function(){t.attr("md",!0)});$(document).one("click.closecombo",function(n){var r=$(n.target);t.attr("md")?t.removeAttr("md"):i.dropDownValidClose(r,t)})},dropDownValidClose:function(n,t){var i=this;t.hide();i.dropDownDestroy(t);$(document).unbind("click.closecombo")},dropDownReposition:function(n,t){var r=this,i,u;t.width()!=n.data("formWidth")&&(i=$(".ui-selectmenu",r.control),n.width(r.control.width()<100?100:i.width()),u=n.data("parentCombo")||i,n.position({my:"left top",at:"left bottom",of:$(".ui-selectmenu-value",u),collision:"none"}),n.data("formWidth",t.width()))},dropDownDestroy:function(n){var t=this,i=t.inputCombo.closest(".ui-bizagi-control"),r=i.closest(".ui-bizagi-render");i.hasClass("ac-is-visible")&&i.removeClass("ac-is-visible");i.hasClass("ac-clear-floats")&&i.removeClass("ac-clear-floats");r.css("height","auto");r.hasClass("ac-is-visible")&&r.removeClass("ac-is-visible");n.remove();$(document).unbind("mousedown.closecombo");$(document).unbind("mouseup.resizecombo");$(window).unbind("resize.resizecombo");$(window).unbind("mouseup.closecombo");t.repositionInterval&&clearInterval(t.repositionInterval);typeof Windows!="undefined"&&t.grid&&$(t.grid.element).find(".bz-rn-grid-data-wraper").css("overflow","auto")},validateValueInDatasource:function(n,t){var i=this,u=i.inputCombo.val(),r=i.findDataByValue(u,t);i.value||(i.value={id:""});r.id>0?n?(i.setValue({id:r.id}),i.setDisplayValue(r)):(i.setValue({id:r.id},!1),i.setDisplayValue(r)):r.id==""?(i.value.id!=r.id&&i.setValue(r,!1),i.setDisplayValue(r)):i.setDisplayValue(i.selectedValue)},keyDownFunction:function(n){var t=this,u="dd-"+t.inputCombo.attr("id"),i=$("#"+u),r=$("li.active",i);return(n=n?n:window.event,n.altKey||n.ctrlKey||n.metaKey)?1:(i.length!==0||t.properties.data||(t.comboDropDown(t.combo),i=$("#"+u)),n.shiftKey&&n.keyCode==9||n.keyCode==9)?(r.length>0&&t.inputCombo.val(r.text()),t.focusDependant=!0,t.validateValueInDatasource(!0,!0),i.remove(),1):(27==n.keyCode&&(t.setDisplayValue(t.selectedValue),i.remove()),9==n.keyCode||13==n.keyCode)?(r.length>0&&t.inputCombo.val(r.text()),t.validateValueInDatasource(!0,!0),i.remove(),1):n.keyCode=="38"||n.keyCode=="37"?(t.selectPreviousElement(i),0):n.keyCode=="40"||n.keyCode=="39"?(t.selectNextElement(i),0):n.keyCode==36?(t.selectFirstElement(i),0):n.keyCode==35?(t.selectLastElement(i),0):1},keyUpFunction:function(n){var t=this,i="dd-"+t.inputCombo.attr("id"),r=$("#"+i);return(n=n?n:window.event,n.altKey||n.ctrlKey||n.metaKey||50==n.keyCode||13==n.keyCode||9==n.keyCode||27==n.keyCode||n.shiftKey||n.keyCode==16||n.keyCode==36||n.keyCode==35||n.keyCode==33||n.keyCode==34)?0:(r.length===0&&(t.comboDropDown(t.combo),r=$("#"+i)),t.selectItemByKeyUp(),1)},selectItemByKeyUp:function(){var i=this,n,u="dd-"+i.inputCombo.attr("id"),t=$("#"+u),r;$(".active",t).removeClass("active");r=i.findDataByValue(i.inputCombo.val(),!0);r!==-1?(n=$("li[data-value='"+r.id+"']",t),n.addClass("active")):n=$("li.ui-selected",t);t.length>0&&n.length>0&&(scrollPosition=parseInt(n.position().top),t.scrollTop(scrollPosition))},selectFirstElement:function(n){var i=this,t=$("li:first",n);$("li",n).removeClass("active");t.addClass("active");scrollPosition=t.position().top;n.scrollTop(scrollPosition);i.inputCombo.val($(t).text())},selectLastElement:function(n){var i=this,t=$("li:last",n);$("li",n).removeClass("active");t.addClass("active");scrollPosition=t.position().top;n.scrollTop(scrollPosition);i.inputCombo.val($(t).text())},selectPreviousElement:function(n){var u=this,r=0,i=$("li.active",n),t;i.length===0&&(i=$("li:first",n));t=i.prev();t.length!=0&&(i.removeClass("active"),$(t).addClass("active"),r=$(t).position().top,n.scrollTop(r),u.inputCombo.val($(t).text()))},selectNextElement:function(n){var u=this,r=0,i=$("li.active",n),t;i.length===0&&(i=$("li:first",n));t=i.next();t.length!=0&&(i.removeClass("active"),$(t).addClass("active"),r=$(t).position().top,n.scrollTop(r),u.inputCombo.val($(t).text()))},onComboItemSelected:function(n){var t=this,i=n.id||"",r=n.value||"";t.properties.originalValue=t.getValue();i===""?t.inputCombo.val(""):t.inputCombo.val(r);t.setValue({id:i});t.setDisplayValue({value:r})},setDisplayValue:function(n){var t=this,u=t.properties,i="",o=!0,f,e,r,s;if(u.editable&&n!==null){if(typeof n=="object"&&n.label!==undefined)i=t.findDataById(n.value).value||n.label,t.setValue({id:n.value,value:n.label});else{if(typeof n=="number"||typeof n=="string"||n.id)if(n.id){if(e=!1,n.value!=null&&typeof n.value=="boolean")e=!0,bizagi.util.parseBoolean(n.value)==!0?n.value=this.getResource("render-boolean-yes"):bizagi.util.parseBoolean(n.value)==!1&&(n.value=this.getResource("render-boolean-no"));else if(n.value!=null&&typeof n.value=="object")for(r=0;r<n.value.length;r++)n.value[r]!=null&&typeof n.value[r]=="boolean"&&(bizagi.util.parseBoolean(n.value[r])==!0?n.value[r]=this.getResource("render-boolean-yes"):bizagi.util.parseBoolean(n.value[r])==!1&&(n.value[r]=this.getResource("render-boolean-no")));i=e?n.value:t.findDataById(n.id).value||n.value}else i=t.findDataById(Number(n)).value||n.label;else i=typeof n.value=="object"?n.value.join(" - "):n.value;(u.hasLocalData||u.remoteDataLoaded)&&(o=t.findDataByValue(i),o===-1&&(i=""));n&&n.id&&(n.id!=undefined&&(typeof n.id=="number"&&n.id>0||typeof n.id=="string"&&n.id.length>0)?t.value.id!=n.id&&t.setValue({id:n.id}):t.value.id!=n&&t.setValue({id:n}))}$.isArray(i)&&(i=i.join(" - "));t.inputCombo?t.inputCombo.val(i):(f=$(".ui-selectmenu-value",t.getControl()),f&&f.val(i))}else u.editable||n===null?n===null&&u.editable?(s=t.getResource("render-combo-empty-selection"),t.inputCombo.val(s)):n!==null||u.editable||t.getControl().text(""):typeof n=="number"||typeof n=="string"?(i=t.findDataById(Number(n)).value,f=t.getControl(),f.text(t.formatItem(i))):typeof n=="object"&&(bizagi.util.isNumeric(n.id)?(t.setValue({id:n.id,value:n.value}),t.control.text(n.value)):(t.setValue({id:n.value,value:n.label}),t.control.text(n.label)))},clearDisplayValue:function(){var n=this,i=n.getControl(),t;n.inputCombo?(t=n.getResource("render-combo-empty-selection"),n.inputCombo.val(t)):n.properties.editable||$(i).html("<label class='readonly-control'><\/label>");n.value=n.properties.value=n.selectedValue},cleanData:function(){var n=this;n.value=n.properties.value=n.selectedValue={id:"",value:""};n.clearDisplayValue()},getSelectedValue:function(){var n=this;return n.selectedValue},findDataById:function(n){var t=this,i={};return t.properties.data&&$.each(t.properties.data,function(t,r){r.id==n&&(i=r)}),i},findDataByValue:function(n,t){var r=this,u=-1,f,e,i,s,h,o,c;if(n!==undefined&&n!==null&&r.properties.data!=undefined)if(t)for(f=-1,e=r.properties.data.length-1;f++<e;)i=r.properties.data[f],o=typeof n=="object"?n.join(" - "):typeof n=="boolean"?n.toString():n,c=$.trim(o).substring(0,o.length).toLowerCase(),s=typeof i=="object"&&typeof i.value=="object"?typeof i.value=="object"?i.value.join(" - "):i.value:$.trim(i.value),h=String(s).toLowerCase(),h.indexOf(c)!=-1&&(u={id:i.id,value:i.value},f=e);else r.getValue()&&(u=r.getValue(),u.value||(u.value=r.inputCombo.val()));return u},setValue:function(n,t){var i=this,r,u;n===null&&(n={id:""});!n||(r=typeof n=="object"?n.id||"":typeof n=="number"||typeof n=="string"?i.getValueFromData(n):"",u=n.value||i.findDataById(r).value||"",i.selectedValue={id:r,value:u},this._super(i.selectedValue,t))},getValueFromData:function(n){var i=this,t=Number(n);return isNaN(t)&&(t=n),t},recalculateComboOffset:function(n,t){if(bizagi.util.isIE()&&bizagi.util.getInternetExplorerVersion()==9&&n.width()!==t.width()){var i=t.width()-n.width();n.width(t.width()+i)}}});var originalRefreshPositionMethod=$.ui.selectmenu.prototype._refreshPosition;$.ui.selectmenu.prototype._refreshPosition=function(){this.list.height(0);var n=originalRefreshPositionMethod.apply(this,arguments);return this.list.css("width",this.newelement.width()+"px"),n};
bizagi.rendering.cascadingCombo.extend("bizagi.rendering.cascadingCombo",{},{postRender:function(){var n=this;bizagi.rendering.combo.prototype.postRender.apply(n,arguments);n.processLayout(!1,n.properties.valueFormat||{})},configureHandlers:function(){this._super();bizagi.rendering.combo.prototype.configureHandlers.apply(this,arguments)},comboDropDown:function(){bizagi.rendering.combo.prototype.comboDropDown.apply(this,arguments)},showLoadingData:function(){bizagi.rendering.combo.prototype.showLoadingData.apply(this,arguments)},hideLoadingData:function(){bizagi.rendering.combo.prototype.hideLoadingData.apply(this,arguments)},internalComboDropDown:function(){bizagi.rendering.combo.prototype.internalComboDropDown.apply(this,arguments)},validateValueInDatasource:function(){bizagi.rendering.combo.prototype.validateValueInDatasource.apply(this,arguments)},keyDownFunction:function(){bizagi.rendering.combo.prototype.keyDownFunction.apply(this,arguments)},keyUpFunction:function(){bizagi.rendering.combo.prototype.keyUpFunction.apply(this,arguments)},selectItemByKeyUp:function(){bizagi.rendering.combo.prototype.selectItemByKeyUp.apply(this,arguments)},selectFirstElement:function(){bizagi.rendering.combo.prototype.selectFirstElement.apply(this,arguments)},selectLastElement:function(){bizagi.rendering.combo.prototype.selectLastElement.apply(this,arguments)},selectPreviousElement:function(){bizagi.rendering.combo.prototype.selectPreviousElement.apply(this,arguments)},selectNextElement:function(){bizagi.rendering.combo.prototype.selectNextElement.apply(this,arguments)},setDisplayValue:function(){bizagi.rendering.combo.prototype.setDisplayValue.apply(this,arguments)},clearDisplayValue:function(){bizagi.rendering.combo.prototype.clearDisplayValue.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.combo.prototype.getSelectedValue.apply(this,arguments)},onComboItemSelected:function(){var n=this;return n.itemSelected=!0,bizagi.rendering.combo.prototype.onComboItemSelected.apply(this,arguments)},postRenderPrintVersion:function(){var n=this,t=n.getControl();t.empty();t.append(n.value.value)},dropDownValidClose:function(){return bizagi.rendering.combo.prototype.dropDownValidClose.apply(this,arguments)},dropDownReposition:function(){return bizagi.rendering.combo.prototype.dropDownReposition.apply(this,arguments)},dropDownDestroy:function(){return bizagi.rendering.combo.prototype.dropDownDestroy.apply(this,arguments)},findDataById:function(){return bizagi.rendering.combo.prototype.findDataById.apply(this,arguments)},findDataByValue:function(){return bizagi.rendering.combo.prototype.findDataByValue.apply(this,arguments)},recalculateComboOffset:function(){return bizagi.rendering.combo.prototype.recalculateComboOffset.apply(this,arguments)},setValue:function(n,t){var i=this,r,u;t=t!==undefined?t:!0;n===""&&(n={id:"",value:""});!n||(r=n.id||"",u=n.value||i.findDataById(r).value,i.selectedValue={id:r,value:u},t&&i.triggerHandler("select",{id:r,value:u}),this._super(i.selectedValue,t))},cleanData:function(){var n=this;n.value=n.properties.value=n.selectedValue={id:"",value:""};n.setValue(n.value,!1);n.setDisplayValue(n.value);n.clearDisplayValue()}});var originalRefreshPositionMethod=$.ui.selectmenu.prototype._refreshPosition;$.ui.selectmenu.prototype._refreshPosition=function(){this.list.height(0);var n=originalRefreshPositionMethod.apply(this,arguments);return this.list.css("width",this.newelement.width()+"px"),n};
bizagi.rendering.combo.extend("bizagi.rendering.queryCombo",{},{});
bizagi.rendering.cascadingCombo.extend("bizagi.rendering.queryCascadingCombo",{},{initializeData:function(n){var t=this;this._super(n);t.properties.contexttype=t.properties.contexttype||"metadata"},postRender:function(){var n=this,t=n.properties;n.parentCombo!==null&&n.isDependant&&n.parentCombo.isRendered().done(function(){$(".ui-bizagi-render-control-included",n.parentCombo.getRenderedElement()).hide()});this._super()},renderControl:function(){var n=this,r=n.getMode(),t=n.parentCombo=n.getParentCombo(),i;return t!==null&&t.properties.type=="queryCascadingCombo"&&(n.isDependant=!0),n.initializingCascadingCombo=!0,i=this._super(),r!="execution"&&(n.initializingCascadingCombo=!1),i},bindDependantCombo:function(n){var t=this,i=t.properties;n.properties.type=="queryCascadingCombo"&&(t.dependants.push(n),n.onChangeFunction=function(i,r,u){t.refreshDependantCombo(n,r.id);u||n.cleanInput()},t.bind("select",n.onChangeFunction),bizagi.util.isEmpty(t.getValue())||i.hasLocalData&&t.refreshDependantCombo(n,t.getValue().id))},canBeSentQueryForm:function(){return!0}});
bizagi.rendering.collectionnavigator.extend("bizagi.rendering.collectionnavigator",{},{initializeData:function(n){var t=this;n.properties.displayType="value";t._super(n)},postRender:function(){var n=this,t;this._super();t=n.getControl();n.navigationControls=t.find(".bz-collectionnavigator-controls");n.canvas=n.getCanvas();$("[title]",t).tooltip()},configureHandlers:function(){var n=this,t,i,r,u,f,e,o;n._super();$.when(n.isRendered()).done(function(){n.hasData()&&n.showRow(n.getFirstRow());n.refreshControls()});t=n.navigationControls.find(".bz-navigation-controls");t.on("click",function(t){var i=t.target;if(!$(i).hasClass("ui-state-disabled"))if($(i).hasClass("bz-navigation-next")&&n.isValidRow())$.when(n.saveChanges()).done(function(){n.showRow(n.getNextRow())});else if($(i).hasClass("bz-navigation-previous")&&n.isValidRow())$.when(n.saveChanges()).done(function(){n.showRow(n.getPreviousRow())});else if($(i).hasClass("bz-navigation-first")&&n.isValidRow())$.when(n.saveChanges()).done(function(){n.showRow(n.getFirstRow())});else if($(i).hasClass("bz-navigation-last")&&n.isValidRow())$.when(n.saveChanges()).done(function(){n.showRow(n.getLastRow())});else if($(i).hasClass("bz-navigation-remove"))n.hasData()&&n.removeRow();else if($(i).hasClass("bz-navigation-add"))n.hasData()&&n.isValidRow()?$.when(n.saveChanges()).done(function(){n.addInlineRow()}):n.hasData()||n.addInlineRow();else return});i=n.navigationControls.find(".bz-navigation-current-row");i.on("change",function(){if(n.isValidRow()){var t=$(this).val();$.when(n.saveChanges()).done(function(){n.updateRow(t)})}});r=n.navigationControls.find(".bz-collectionnavigator-addform");r.on("click",function(){n.hasData()&&n.isValidRow()?$.when(n.saveChanges()).done(function(){n.addRow()}):n.hasData()||n.addRow()});u=n.navigationControls.find(".bz-collectionnavigator-editform");u.on("click",function(){n.isValidRow()&&$.when(n.saveChanges()).done(function(){n.editRow()})});f=n.navigationControls.find(".bz-collectionnavigator-detailform");f.on("click",function(){n.isValidRow()&&$.when(n.saveChanges()).done(function(){n.showDetailForm()})});e=n.navigationControls.find(".bz-collectionnavigator-save");e.on("click",function(){if(n.isValidRow()){var t=n.properties,i=!t.inlineEdit&&n.isTherePendingInlineRow();$.when(n.saveChanges()).done(function(){n.showRow(n.getRow())})}});o=n.navigationControls.find(".bz-collectionnavigator-cancel");o.on("click",function(){n.cancelChanges()});n.configureButtonsForm()},postRenderReadOnly:function(){var n=this;n.postRender();n.configureHandlers()},refreshControls:function(){var n=this;n.refreshForwardButtons();n.refreshBackButtons();n.refreshPagination();n.refreshTotal();n.refreshRemoveAction()},refreshForwardButtons:function(){var n=this,t=n.getInnerControl("navigation","next"),i=n.getInnerControl("navigation","last"),r=n.keys.length;n.hasData()&&n.pointer<r-1?(t.removeClass("ui-state-disabled"),i.removeClass("ui-state-disabled")):(t.addClass("ui-state-disabled"),i.addClass("ui-state-disabled"))},refreshBackButtons:function(){var n=this,t=n.getInnerControl("navigation","previous"),i=n.getInnerControl("navigation","first");n.hasData()&&n.pointer>0?(t.removeClass("ui-state-disabled"),i.removeClass("ui-state-disabled")):(t.addClass("ui-state-disabled"),i.addClass("ui-state-disabled"))},refreshRemoveAction:function(){var n=this,i=n.properties,t;i.editable&&(t=n.getInnerControl("navigation","remove"),n.hasData()&&!n.isTherePendingInlineRow()?t.removeClass("ui-state-disabled"):t.addClass("ui-state-disabled"))},refreshPagination:function(){var n=this,t=n.getInnerControl("navigation","current"),i=n.keys.length;i>0?(t.val(n.pointer+1),t.removeClass("ui-state-disabled")):(t.val(n.pointer),t.addClass("ui-state-disabled"))},refreshTotal:function(){var n=this,t=n.getTotalRows(),i=n.getInnerControl("navigation","total");i.text(t)},refreshActions:function(n,t){var i=this,r=i.navigationControls.find(".bz-collectionnavigator-save"),u=i.navigationControls.find(".bz-collectionnavigator-cancel");n?r.removeClass("ui-state-disabled"):r.addClass("ui-state-disabled");t?u.removeClass("ui-state-disabled"):u.addClass("ui-state-disabled")},getInnerControl:function(n,t){var r=this,u=r.properties,f=r.getControl(),i=null;if(i=$("div[data-navigation-id='"+u.id+"']"),n){if(t=="next")return i.find(".bz-navigation-next");if(t=="last")return i.find(".bz-navigation-last");if(t=="previous")return i.find(".bz-navigation-previous");if(t=="first")return i.find(".bz-navigation-first");if(t=="current")return i.find(".bz-navigation-current-row");if(t=="total")return i.find(".bz-navigation-total-rows");if(t=="add")return i.find(".bz-navigation-add");if(t=="remove")return i.find(".bz-navigation-remove");if(t=="save")return i.find(".bz-collectionnavigator-save");if(t=="cancel")return i.find(".bz-collectionnavigator-cancel")}return undefined},showRow:function(n,t){var i=this,r=i.properties;n&&$.when(i.renderForm(i.getParameters({id:n,requestedForm:"navigationForm",url:i.properties.navigationPage,editable:r.editable?r.inlineEdit:!1}))).done(function(n){i.loadForm(n,t);i.refreshControls()})},showDetailForm:function(){var n=this,t=n.properties,i=new bizagi.rendering.dialog.form(n.dataService,n.renderFactory,{title:t.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!1,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close")});i.render(n.getParameters({id:n.getRow(),requestedForm:"detailForm",url:t.editPage,editable:!1}))},showInlineRow:function(n,t){var i=this;i.startLoading();$.when(i.renderForm(i.getParameters({id:n,requestedForm:"navigationForm",url:i.properties.navigationPage,editable:!0}))).done(function(n){i.loadForm(n,t);i.refreshControls()}).always(function(){i.endLoading()})},updateRow:function(n){var t=this;$.isNumeric(n)&&t.isValidKey(n)?(n=parseInt(n),t.setPointer(n),t.showRow(t.getRow()),t.refreshControls()):t.refreshPagination()},isValidKey:function(n){var t=this;return n<=0?!1:n>t.keys.length?!1:!0},renderForm:function(n){var t=this,i=new $.Deferred;return $.when(t.dataService.getFormData(n)).pipe(function(r){r.form.contextType=n.contextType;delete r.form.buttons;n.editable==!1&&(r.form.properties.editable=!1);t.removeTransitions(r.form);t.form=t.renderFactory.getContainer({type:"form",data:r.form,focus:n.focus||!1,selectedTabs:n.selectedTabs,isRefresh:n.isRefresh||!1});t.form.render();t.form.triggerHandler("ondomincluded",t.getFormContainer());t.form.bind("refresh",function(){t.showRow(t.getRow())});t.bindRenderChangeEvent(t.form.children);i.resolve(t.form)}),i.promise()},bindRenderChangeEvent:function(n){var t=this,i,f,r,u;for(n=n||[],i=0,f=n.length;i<f;i++)r=n[i],u=r.getElementType(),u==bizagi.rendering.element.ELEMENT_TYPE_RENDER?r.bind("renderchange",function(n,i){var r,u,f;i=i||{};r=i.render;r&&(r.properties.type=="collectionnavigator"||r.properties.type=="grid")?u=!1:(f=[],t.form.hasChanged(f),u=f.length===0?!0:!1);t.refreshActions(!u,!u);t.triggerRenderChange()}):u==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&t.bindRenderChangeEvent(r.children)},getCanvas:function(){var n=this,t=n.getControl();return t.find(".bz-collectionnavigator-navigationform")},isValidRow:function(){var n=this;return n.form?n.form.validationController.performValidations():!1},saveChanges:function(){var n=this,t=n.getChanges(),r=[],i=!1,u;return(n.form&&(u=n.getChildCollectionNavigator(n.form.children,r),i=u.length>0?!0:!1),!$.isEmptyObject(t)||i)?(i&&n.saveChangesChildren(r),t.idPageCache=n.form.getPageCache(),n.submitSaveRequest(n.getRow(),t).pipe(function(t){if(t=t||{},t.type=="success")return n.form.collectRenderValuesForSubmit(),n.removeInlineAddRecord(),n.refreshControls(),n.refreshActions(!1,!1),n.fetchData();if(t.type=="validationMessages"){var i=n.getFormContainer(),r=t.messages.join(" ");i.failHandler({message:r})}return!1})):(n.removeInlineAddRecord(),n.refreshControls(),n.refreshActions(!1,!1),!0)},cancelChanges:function(){var n=this,t;n.refreshActions(!1,!1);n.inlineAddRecords.length>0?(n.removeKey(),n.inlineAddRecords.pop(),n.submitRollbackRequest(),n.refreshTotal(),n.refreshControls(),n.getTotalRows()==0?(n.removeNavigationForm(),n.drawPreview()):n.showRow(n.getRow())):(t=n.getChanges(),$.isEmptyObject(t)||n.showRow(n.getRow()))},getChanges:function(){var n=this,t={};return n.form&&n.form.collectRenderValues(t),t},addInlineRow:function(){var n=this,t=!0;$.when(n.submitAddRequest()).done(function(i){n.refreshActions(!0,!0);n.inlineAddRecords.push(i);n.addKey(i);n.showInlineRow(n.getLastRow(),t);n.refreshTotal();n.refreshControls()})},addRow:function(){var n=this,t=n.properties;$.when(n.submitAddRequest()).done(function(i){var r=new bizagi.rendering.dialog.form(n.dataService,n.renderFactory,{title:t.addLabel,orientation:t.orientation||"ltr",onSave:function(r){return t.contextType&&(r[n.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=t.contextType),n.submitSaveRequest(i,r)}});r.render(n.getParameters({id:i,requestedForm:"addForm",url:t.addPage,editable:!0})).done(function(){n.startLoading();$.when(n.fetchData()).done(function(){n.showRow(n.getLastRow())});n.endLoading()}).fail(function(){n.submitRollbackRequest()})})},editRow:function(){var n=this,i=n.properties,t=n.getRow();$.when(n.submitEditRequest(t)).done(function(){var r=new bizagi.rendering.dialog.form(n.dataService,n.renderFactory,{title:i.editLabel,orientation:i.orientation||"ltr",onSave:function(i){return n.submitSaveRequest(t,i)}});r.render(n.getParameters({id:t,requestedForm:"editForm",url:n.properties.editPage,editable:!0})).done(function(){$.when(n.fetchData()).done(function(){n.showRow(n.getRow())})}).fail(function(){n.submitRollbackRequest()})})},removeRow:function(){var n=this,t=n.getRow();bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(n.submitDeleteRequest(t)).done(function(t){t=t||{};t.type=="success"&&(n.startLoading(),n.removeKey(),n.refreshTotal(),n.refreshControls(),n.getTotalRows()==0?(n.removeNavigationForm(),n.drawPreview()):n.showRow(n.getRow()),n.endLoading())})})},removeInlineAddRecord:function(){var n=this;n.isTherePendingInlineRow()&&n.inlineAddRecords.pop()},loadForm:function(n,t){var i=this,r;i.removeNavigationForm();r=n.container.find(".ui-bizagi-button-container");r.remove();i.addNavigationForm(n.container);t&&i.focusFirstControl(n)},configureButtonsForm:function(){var n=this,t=n.getFormContainer(),i=t.processButton;t.processButton=function(r){var u=$.Deferred(),f=!0;return n.form?r.action=="save"?$.when(n.saveChanges()).done(function(){i.apply(t,[r]);u.resolve()}).fail(function(t){n.processFailMessage(t);u.resolve()}):r.action=="next"&&(r.validate&&(f=n.isValidRow())?$.when(n.saveChanges()).done(function(){i.apply(t,[r]);u.resolve()}).fail(function(t){n.processFailMessage(t);u.resolve()}):f?$.when(n.saveChanges()).done(function(){i.apply(t,[r]);u.resolve()}).fail(function(t){n.processFailMessage(t);u.resolve()}):u.resolve()):i.apply(t,[r]).done(function(){u.resolve()}),u.promise()}},removeNavigationForm:function(){var n=this;n.canvas.children().remove()},addNavigationForm:function(n){var t=this;t.canvas.append(n)},fetchData:function(){var n=this,t=new $.Deferred;return n.startLoading(),$.when(n.getRemoteData()).done(function(i){(n.endLoading(),n.disposed)||(i?(n.refresh(i),t.resolve()):t.reject())}),t.promise()},refresh:function(n){var t=this,i=t.getKeys(n.rows);t.keys=i;i.indexOf(t.getRow())==-1&&(t.totalRows=i.length,t.pointer=t.pointer>0?t.pointer-1:t.pointer,t.totalRows==0&&(t.removeNavigationForm(),t.drawPreview(),t.refreshControls()))},focusFirstControl:function(n,t){var i=function(){var t=$("input:visible, select:visible, option:visible, textarea:visible",n.container).not(".ui-bizagi-render-date,.ui-bizagi-render-search"),i;if(t.length>0){i=t[0];try{i.focus()}catch(r){}}};t>0?setTimeout(i,t):i()},getChildCollectionNavigator:function(n,t){var e=this,r,f,i,u;for(n=n||[],r=0,f=n.length;r<f;r++)i=n[r],u=i.getElementType(),u==bizagi.rendering.element.ELEMENT_TYPE_RENDER?(i.properties.type=="collectionnavigator"||i.properties.type=="grid")&&t.push(i):u==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&e.getChildCollectionNavigator(i.children,t);return t},saveChangesChildren:function(n){for(var t=0,i=n.length;t<i;t++)n[t].properties.type=="collectionnavigator"&&n[t].saveChanges()},drawControls:function(n){var t=this,r=t.properties,i;return n=$(n),i=t.collectionControls=$(".bz-collectionnavigator-controls",n),t.drawForms(i),t.drawControl(i),r.editable&&t.drawActions(i),n[0].outerHTML},drawActions:function(n){var r=this,u=$(".actions-group",n),t,i;return r.orientation=="rtl"?(t=r.renderFactory.getTemplate("collectionnavigator-actions-rtl"),i=$.tmpl(t),i.appendTo(u)):(t=r.renderFactory.getTemplate("collectionnavigator-actions"),i=$.tmpl(t),i.appendTo(u)),n},drawControl:function(n){var t=this,i=t.properties,r=i.editable,e=$(".control-group",n),u,f;return t.orientation=="rtl"?(u=t.renderFactory.getTemplate("collectionnavigator-control-rtl"),f=$.tmpl(u,{inlineAdd:r&&i.inlineAdd,allowDelete:r&&i.allowDelete,total:t.totalRows}),f.appendTo(e)):(u=t.renderFactory.getTemplate("collectionnavigator-control"),f=$.tmpl(u,{inlineAdd:r&&i.inlineAdd,allowDelete:r&&i.allowDelete,total:t.totalRows}),f.appendTo(e)),n},drawForms:function(n){var u=this,f=u.properties,e=f.withAddForm,o=f.withEditForm,s=f.allowDetail,t=null,i=null,r=$(".bz-navigation-group",n);return u.properties.orientation=="rtl"?f.editable&&(e||o||s)?(r.addClass("group-visible"),s&&(t=u.renderFactory.getTemplate("collectionnavigator-form-button"),i=$.tmpl(t,{buttonClass:"ui-icon ui-icon-document bz-collectionnavigator-detailform",title:bizagi.localization.getResource("render-collection-navigator-details-form")}),i.appendTo(r)),o&&(t=u.renderFactory.getTemplate("collectionnavigator-form-button"),i=$.tmpl(t,{buttonClass:"ui-icon ui-icon-pencil bz-collectionnavigator-editform",title:bizagi.localization.getResource("render-collection-navigator-edit-form")}),i.appendTo(r)),e&&(t=u.renderFactory.getTemplate("collectionnavigator-form-button"),i=$.tmpl(t,{buttonClass:"ui-icon ui-icon-plus bz-collectionnavigator-addform",title:bizagi.localization.getResource("render-collection-navigator-add-form")}),i.appendTo(r))):r.addClass("group-no-visible"):f.editable&&(e||o||s)?(r.addClass("group-visible"),e&&(t=u.renderFactory.getTemplate("collectionnavigator-form-button"),i=$.tmpl(t,{buttonClass:"ui-icon ui-icon-plus bz-collectionnavigator-addform",title:bizagi.localization.getResource("render-collection-navigator-add-form")}),i.appendTo(r)),o&&(t=u.renderFactory.getTemplate("collectionnavigator-form-button"),i=$.tmpl(t,{buttonClass:"ui-icon ui-icon-pencil bz-collectionnavigator-editform",title:bizagi.localization.getResource("render-collection-navigator-edit-form")}),i.appendTo(r)),s&&(t=u.renderFactory.getTemplate("collectionnavigator-form-button"),i=$.tmpl(t,{buttonClass:"ui-icon ui-icon-document bz-collectionnavigator-detailform",title:bizagi.localization.getResource("render-collection-navigator-details-form")}),i.appendTo(r))):r.addClass("group-no-visible"),n},removeTransitions:function(n){n=n||{};n.transitions&&delete n.transitions}});
bizagi.rendering.ecm.extend("bizagi.rendering.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{renderControl:function(){},postRender:function(){var t=this,i=t.getControl(),n=t.properties,f=this.getResource("dateFormat"),e=this.getResource("timeFormat"),o=t.getMode(),r,u;if(this._super(),n.maxSize=Number(n.maxSize)||(typeof BIZAGI_SETTINGS!="undefined"&&typeof BIZAGI_SETTINGS.UploadMaxFileSize!="undefined"?Number(BIZAGI_SETTINGS.UploadMaxFileSize):n.maxSize=Number(n.maxSize)||4091904),n.maxFiles=Number(n.maxfiles)||999,n.validExtensions=n.validExtensions||"",n.validExtensions.length>0&&n.validExtensions.indexOf(".")<0){for(r=n.validExtensions.split(";"),u=0;u<r.length;u++)r[u]="*."+r[u];n.validExtensions=r.join(";")}n.addUrl=n.addUrl||t.dataService.getUploadAddUrl();n.deleteUrl=n.deleteUrl||undefined;n.allowDelete=bizagi.util.parseBoolean(n.allowDelete)!==null?bizagi.util.parseBoolean(n.allowDelete):!0;n.q_xpath=bizagi.util.encodeXpath(t.getUploadXpath());n.displayValue="";n.showTime=n.showTime!==undefined?bizagi.util.parseBoolean(n.showTime):!1;n.dateFormat=n.dateFormat||f;n.timeFormat=n.timeFormat||e;n.fullFormat=n.dateFormat;n.datePickerFormat=n.dateFormat.replaceAll("M","m");n.datePickerFormat=n.datePickerFormat.replaceAll("yyyy","yy");n.datePickerFormat=n.datePickerFormat.replaceAll("dddd","DD");n.datePickerFormat=n.datePickerFormat.replaceAll("mmmm","MM");t.files=n.value||[];t.filesCount=t.files.length;n.xpathContext=this.parent.properties.xpathContext||n.xpathContext||"";i.addClass("ui-bizagi-render-display-block");i.addClass("ui-bizagi-render-upload");i.addClass("ui-bizagi-render-ecm");$(i).closest(".ui-bizagi-control-wrapper").addClass("ui-bizagi-control-wrapper-ecm");t.properties.showRenderOptions=!0;o=="execution"?t.renderUploadItem():i.append("<div class='ui-icon ecm-file'><\/div>");t.checkMaxFiles()},configureHandlers:function(){var n=this,t=n.getControl(),i=n.properties;n._super();data=n.buildAddParams();data.networkSpeed=networkSpeed();$(".biz-render-ecm-upload-wrapper",t).bizagiUpload({renderReference:this,dialogTemplate:n.renderFactory.getTemplate("upload.ecm.dialog"),properties:data,uploadedFiles:n.filesCount,isECM:!0,onUploadFileCompletedCallback:n.onUploadFileCompleted,dialogTitle:n.getResource("render-upload-link-label")})},configureUploadHandlers:function(n,t,i){var r=n,f=r.properties,u=r.buildUpgradeParams(i);$(i).bizagiUpload({renderReference:r,dialogTemplate:r.renderFactory.getTemplate("upload.ecm.dialog"),properties:u,uploadedFiles:r.filesCount,isECM:!0,isUpdatingECM:!0,onUploadFileCompletedCallback:r.onUpdateUploadFileCompleted,dialogTitle:r.getResource("render-upload-link-label")})},onUpdateUploadFileCompleted:function(n,t,i,r){var u=n;i.empty();u.waiting(i,!0);u.filesCount++;u.renderFileLayout(u,t,i,r)},renderUploadItem:function(n,t){var i=this,f=i.getMode(),r=i.getControl(),e=i.renderFactory.getTemplate("upload-ecm-view-default"),u=i.properties;if(u.value=t?[[t.idFileUpload,t.fileName]]:i.value,typeof t!="undefined"&&typeof t.status!="undefined"&&t.status=="error"){bizagi.showMessageBox(t.message);return}$.when($.tmpl(e,u,{getFileExtension:i.getFileExtension,isImage:i.isImage,allowSendInMail:u.allowSendInMail})).done(function(u){n&&n.length>0?u.insertAfter(n.last()):r.append(u);r.find(".uploadifyQueueItem").remove();i.properties.value!=undefined&&$.each(i.properties.value,function(n,u){var e={};e.idFileUpload=u[0]||u.uploadId;e.fileName=u[1]||u.fileName;e.idPageCache=i.properties.idPageCache;e.xpathContext=i.getXpathContext();e.xPath=i.properties.xpath;e.idAttrib=i.properties.idAttrib;f=="execution"&&i.renderFileLayout(i,e,$("."+i.properties.id+"-"+e.idFileUpload,r),t)});i.properties.allowSendInMail&&i.bindEmailDialog()})},bindEmailDialog:function(){var n=this,t=n.getControl(),i=n.getXpathContext()||"",r=n.properties.xpath;$(".ui-bizagi-render-ecm-sendmail",t).bizagiSendEmail({tmpl:n.renderFactory.getTemplate("dialog-send-email"),value:n.value,self:n,dataService:n.dataService,properties:n.properties,xpath:r,xpathContext:i})},renderFileLayout:function(n,t,i,r){n=n||this;var u=n.getFormContainer(),f=n.renderFactory.getTemplate("upload-ecm-view-default-metadata");$.when(n.dataService.getECMMetadata(t),r?[r]:n.dataService.getFileProperties(t)).done(function(r,e){var o,s;typeof Windows!=undefined&&n.properties.displayType==="normal"&&$("ul",n.getControl()).closest(".ui-bizagi-control").css("width","100%");n.waiting(i,!0);e[0].data=t;e[0].xpathContext=e[0].xpathContext||u.properties.xpathContext||"";e[0].xpath=n.properties.xpath;r[0].filename=t.fileName;r[0].url=n.buildItemUrl(e[0]);r[0].ecm_ecmStatus=e[0].ecmStatus;r[0].ecm_isVisible=e[0].isVisible;r[0].ecm_allowUpdateMetadata=e[0].allowUpdateMetadata;r[0].ecm_allowDelete=e[0].allowDelete;r[0].ecm_allowUpdateContent=e[0].allowUpdateContent;r[0].ecm_allowView=e[0].allowView;r[0].ecm_allowCheckOut=e[0].allowCheckOut;r[0].ecm_allowCancelCheckOut=e[0].allowCancelCheckOut;r[0].ecm_allowEdit=e[0].allowEdit;r[0].ecm_ecmStatus=e[0].ecmStatus;r[0].idFileUploads=e[0].idFileUpload;r[0].xpath=e[0].xpath;r[0].value=bizagi.util.parseBoolean(e[0].value);o=i.parent().find(".extension:last");n.isImage(r[0].filename)?(o.empty(),o.append("<img>"),s=o.find("img"),o.addClass("thumb-image"),s.attr({src:r[0].url,width:32,height:32}),s.imageZoom(),$(".checkuot , .readonly",i.parent()).bind("click",function(){s.click()})):(i.parent().find("li:first").unbind("click"),i.parent().find("li:first").bind("click",function(n){n.stopPropagation();window.open(r[0].url)}));e[0].isVisible&&(i.empty(),$.when($.tmpl(f,$.extend(r[0],{showMetadata:n.properties.showMetadata,orientation:u.properties.orientation||"ltr"})).appendTo(i)).done(function(){$(".ecm-options-slide li",i).hover(function(){$(this).toggleClass("ecm-options-slide-hover")});n.isImage(r[0].filename)&&$(".filename a",i).imageZoom();n.setControlEvents(i,t);r[0].ecm_allowUpdateContent&&n.configureUploadHandlers(n,t,i,e);switch(e[0].ecmStatus){case 1:break;case 2:i.parent().find(".checkuot").css("visibility","hidden");i.parent().find(".checkuot").hide();break;case 3:break;case 4:$(".emc-options",i).hide();$(".emc-options",i).hide();i.parent().find(".readonly").css("visibility","visible");i.parent().find(".readonly").show();break;case 5:i.parent().find(".checkuot").css("visibility","visible");i.parent().find(".checkuot").show();break;case 6:bizagi.debug("ECM control return undefined status",e);break;default:i.parent().find(".checkuot").css("visibility","hidden").hide();i.parent().find(".readonly").css("visibility","hidden").hide()}if(bizagi.util.parseBoolean(n.properties.editable)){var u=!0;i.data("pluginAvailable",!1);$(".emc-options",i).bind("click",function(){if(u){u=!1;var f=function(i){var e=new $.Deferred,u=$(".modal-ecm",i),o=n.control,f;return u.is(":visible")?($(".modal-ecm",o).hide(),$(".ecm-options-slide",u).hide(),u.hide(),e.resolve(!0)):(f=function(){$(".modal-ecm",o).hide();$(".ecm-options-slide",u).show();u.show().position({my:"center top",at:"center bottom",of:$(".emc-options",i),collision:"none"})},$(document.body).click(function(n){$(n.target).hasClass("emc-options")||$(n.target).hasClass("ui-icon-gear")||($(".modal-ecm",this).hide(),$(document.body).unbind("click"))}),e.resolve(!0),n.properties.isAsync!==undefined?(r[0].ecm_allowUpdateContent||$(".ecm-options-upgrade",u).hide(),n.asynCheckEnabled===undefined&&(n.asynCheckEnabled=!0,n.asyncCheckTimeout=setTimeout(function(){n.asynCheckEnabled=undefined;n.asyncCheckTimeout=undefined},2e3),t.IsFileOnECM?f():($(".ecm-options-checkout",u).hide(),$(".ecm-options-cancelcheckout",u).hide(),$(".ecm-options-upgrade",u).hide(),$.when(n.dataService.isFileOnECM({idUpload:t.idFileUpload})).done(function(n){n.IsFileOnECM&&(r[0].ecm_allowUpdateContent&&$(".ecm-options-upgrade",u).show(),r[0].ecm_allowCheckOut&&$(".ecm-options-checkout",u).show(),r[0].ecm_allowCancelCheckOut&&$(".ecm-options-cancelcheckout",u).show());t.IsFileOnECM=n.IsFileOnECM;f()}).fail(function(){bizagi.log("isFileOnECM error")})))):f()),e.promise()};$.when(f(i)).done(function(){u=!0})}})}else $(".emc-options",i).hide(),$(n.getControl()).trigger("ecmLoaded",{container:o})}))})},setControlEvents:function(n,t){var i=this,u=i.properties,r=i.getControl();$(".ecm-options-delete",n).bind("click",function(){$(".emc-options",n).click();var u=$(".biz-render-ecm-delete-confirmation",r).first().clone();u.dialog({resizable:!1,modal:!0,title:i.getResource("render-ecm-confirm-title"),buttons:[{text:i.getResource("render-ecm-confirm-bt-delete"),click:function(){var r,u;for(i.dataService.deleteECMFile(t),$(this).dialog("close"),n.parent("ul").hide("highlight",{},100),r=[].concat(i.files),u=0;u<r.length;u++)r[u][0]==t.idFileUpload&&r.splice(u,1);i.setValue(r);i.checkMaxFiles()}},{text:i.getResource("render-ecm-confirm-bt-cancel"),click:function(){$(this).dialog("close")}}]})});$(".ecm-options-upgrade",n).bind("click",function(){});$(".ecm-options-cancelcheckout",n).bind("click",function(){$(".emc-options",n).click();i.waiting(n,!1);n.find(".filename").empty();$.when(i.dataService.cancelCheckOut(t)).done(function(r){i.renderFileLayout(i,t,n,r)})});$(".ecm-options-checkout",n).bind("click",function(){$(".meta-data-wrapper",n).click();i.waiting(n,!1);n.find(".filename").empty();$.when(i.dataService.checkOutFile(t)).done(function(r){i.renderFileLayout(i,t,n,r)})});$(".ecm-metadata-value",n).data("ecmstatus")!=4&&$(".ecm-metadata-value",n).data("allowupdatemetadata")&&$(".ecm-metadata-value",n).bind("activeeditmode",function(t){if(t.stopPropagation(),!$(this).data("readonly")&&($(this).data("edit-mode")=="false"||$(this).data("edit-mode")=="")){$(this).data("edit-mode","true");switch($(this).data("metadatatype")){case"STRING":i.makeStringMetaDataControler($(this),n);break;case"INTEGER":i.makeStringMetaDataControler($(this),n,function(n){var t=n.match(/\d+/);return t!=null&&t[0]==t.input});break;case"DATETIME":i.makeDatetimeMetaDataControler($(this),n);break;case"DECIMAL":i.makeStringMetaDataControler($(this),n,function(n){var r=i.getResource("numericFormat"),f=new RegExp("\\d+(\\"+r.decimalSymbol+"\\d)*"),t=n.match(f),u;try{u=n.substr(n.length-1,1)}catch(e){return!1}return t!=null&&(t[0]==t.input||u==r.decimalSymbol)});break;case"BOOL":i.makeBooleanMetaDataControler($(this),n);break;default:i.makeStringMetaDataControler($(this),n)}}});$(".ecm-metadata-done",n).bind("click",function(n){var f,e;n.stopPropagation();var t=$(this).parent("td"),o=$(".ecm-metadata-field-edit",t),r="",u="";switch(t.data("metadatatype")){case"STRING":case"DECIMAL":case"INTEGER":r=$(".ecm-metadata-input",t).val();u=$(".ecm-metadata-input",t).val();break;case"BOOL":r=$(".biz-render-ecm-upload-boolean input:checked",t).val();u=bizagi.util.parseBoolean($(".biz-render-ecm-upload-boolean input:checked",t).val())?"True":"False";r=r=="False"?i.getResource("render-boolean-no"):i.getResource("render-boolean-yes");break;case"DATETIME":r=$(".ecm-metadata-input",t).val();r&&(f=bizagi.util.dateFormatter.getDateFromFormat(r,i.properties.datePickerFormat),u=bizagi.util.dateFormatter.formatInvariant(f,!0))}t.data("value",u);e=$("<span><\/span>").addClass("ecm-metadata-text").text(r);o.replaceWith(e);$(".ecm-metadata-edit",t).css("display","block");$(".ecm-metadata-done",t).hide();$(".ecm-metadata-cancel",t).hide();t.data("edit-mode","false")});$(".ecm-options-edit",n).bind("click",function(r){var u;if(r.stopPropagation(),u=n,$(".emc-options",n).click(),$(".ecm-options-edit",u).data("editmode")!="true"){$(".ecm-options-edit",u).data("editmode","true");var e=i.renderFactory.getTemplate("upload-ecm-view-default-edit-buttons"),f=[],o=$.tmpl(e);$(".ecm-metadata-value[data-allowUpdateMetadata=true]",n).trigger("activeeditmode");o.insertAfter($("table",n));$(".biz-render-ecm-metadata-edit",n).show(500);$(".biz-render-ecm-metadata-edit button:first",n).bind("click",function(r){r.stopPropagation();var u=!1,e=n;($.each($(".ecm-metadata-value[data-mandatory='true']",n),function(n,t){$(t).find(".ecm-metadata-field-edit").val()==""?($(t).find("input").attr("placeholder",i.getResource("render-ecm-tooltip-mandatory")),$(t).parent().find(".ecm-metadata-key").addClass("mandatory-error"),$(t).parent().effect("highlight",500),u=!0):$(t).parent().find(".ecm-metadata-key").removeClass("mandatory-error")}),u)||($(".ecm-metadata-done",n).click(),$(".biz-render-ecm-metadata-edit",n).hide(300,function(){$(".biz-render-ecm-metadata-edit",n).remove()}),$.each($(".ecm-metadata-value",n),function(t,i){f.push({idMetadata:$($(".ecm-metadata-key",n)[t]).data("idmetadata"),value:$(i).find(".ecm-metadata-text").html()})}),t.metaValues=JSON.encode({metadataValues:f}),$.when(i.dataService.updateECMMetadata(t)).done(function(){$(".ecm-options-edit",e).data("editmode","false")}))});$(".biz-render-ecm-metadata-edit button:last",n).bind("click",function(t){t.stopPropagation();var i=n;$(".ecm-metadata-cancel",n).click();$(".biz-render-ecm-metadata-edit button:first",n).unbind("click");$(".ecm-options-slide",i).is(":visible")&&$(".emc-options",n).click();$(".biz-render-ecm-metadata-edit",n).hide(500,function(){$(".biz-render-ecm-metadata-edit",n).remove()});$(".ecm-options-edit",i).data("editmode","false")})}});$(".ecm-metadata-cancel",n).bind("click",function(n){n.stopPropagation();var t=$(this).parent("td"),i=$(".ecm-metadata-field-edit",t),r=$("<span><\/span>").addClass("ecm-metadata-text").text(i.data("original-value"));i.replaceWith(r);$(".ecm-metadata-edit",t).css("display","block");$(".ecm-metadata-done",t).hide();$(".ecm-metadata-cancel",t).hide();t.data("edit-mode","false")})},makeStringMetaDataControler:function(n,t,i){var u=$(".ecm-metadata-text",n),r=$("<input><\/input>").addClass("ecm-metadata-field-edit ecm-metadata-input").val(u.text());r.data("original-value",u.text());u.replaceWith(r);r.focus();$(".ecm-metadata-edit",n).hide();$(".ecm-metadata-done",n).css("visibility","visible").show();$(".ecm-metadata-cancel",n).css("visibility","visible").show();$(".ecm-metadata-input",n).bind("keyup",function(){var n=r.val();i&&(i(n)||n==""?r.data("latestdonevalue",n):r.val(r.data("latestdonevalue")||""))})},makeDatetimeMetaDataControler:function(n,t){var u=this,r=$(".ecm-metadata-text",n),i=$("<input><\/input>").addClass("ecm-metadata-field-edit ecm-metadata-input").val(r.text());i.data("original-value",r.text());r.replaceWith(i);i.datepicker({dateFormat:u.properties.datePickerFormat,changeYear:!0,onSelect:function(n){i.val(n+" 00:00 AM")}});$(".ecm-metadata-edit",n).hide();$(".ecm-metadata-done",n).css("visibility","visible").show();$(".ecm-metadata-cancel",n).css("visibility","visible").show();$(".ecm-metadata-input",n).bind("keypress",function(n){n.keyCode==13&&$(".ecm-metadata-done",t).trigger("click")})},makeDecimalMetaDataControler:function(n,t){var i=this,r=i.getResource("decimalSymbol");i.makeStringMetaDataControler($(this),t,function(n,t){var r=new RegExp("\\d+(\\"+t+"\\d)*"),i=n.match(r);return i!=null&&(i[0]==i.input||i[1]==undefined)})},makeBooleanMetaDataControler:function(n){var t=this,u=t.renderFactory.getTemplate("upload-ecm-view-default-yesno"),i=$(".ecm-metadata-text",n),f=i.text()==t.getResource("render-boolean-yes")?"1":"0",e=Math.ceil(Math.random()*100),r=$.tmpl(u,{id:t.properties.id,checked:f,rnd:e});r.data("original-value",i.text());i.replaceWith(r);$(".ecm-metadata-edit",n).hide();$(".ecm-metadata-done",n).css("visibility","visible").show();$(".ecm-metadata-cancel",n).css("visibility","visible").show()},isImage:function(n){var t=this,i=t.getFileExtension(n);return $.inArray(i.toUpperCase(),["JPG","JPEG","GIF","PNG","BMP"])>-1?!0:!1},postRenderReadOnly:function(){var t=this,n=t.getControl(),i=t.getMode();if(i!="execution"){n.append("<div class='ui-icon upload-file'><\/div>");return}n.addClass("ui-bizagi-render-display-block");n.addClass("ui-bizagi-render-upload");$(".biz-render-ecm-upload-wrapper",n).remove();t.properties.showRenderOptions=!1;t.renderUploadItem();$(".emc-options",n).remove()},buildAddParams:function(){var r=this,n=r.properties,u=r.getFormContainer(),t={},i;return t={url:n.addUrl,xPath:n.xpath,idAttrib:n.idAttrib,xpathContext:n.xpathContext,metaValues:[],idPageCache:n.idPageCache,idSession:u.properties.sessionId,folder:BIZAGI_PATH_TO_BASE,contexttype:n.contexttype,validExtensions:n.validExtensions,maxSize:n.maxSize},i={},$.extend(i,i,t),t.scriptData=i,t},buildUpgradeParams:function(n){var u=this,t=u.properties,f=u.getFormContainer(),i={},r;return i={url:t.editUrl,xPath:t.xpath,idFileUpload:$(".ecm-options-upgrade > input",n).data("idfileupload"),idPageCache:t.idPageCache,idAttrib:t.idAttrib,xpathContext:u.getXpathContext(),idSession:f.properties.sessionId,folder:BIZAGI_PATH_TO_BASE,validExtensions:t.validExtensions,maxSize:t.maxSize},r={},$.extend(r,r,i),i.scriptData=r,i},checkMaxFiles:function(){var n=this,t=n.properties,r=n.getControl(),i=$(".biz-render-ecm-upload-wrapper",r),u=$("a",i);t.maxFiles>0&&n.filesCount>=t.maxFiles?i.hide():n.filesCount<t.maxFiles&&i.show()},onUploadFileCompleted:function(n,t){var i=n,f=i.getControl(),r,u;t.type!="error"?(i.properties.showRenderOptions=!1,r=$(".biz-render-ecm-view-default",f),r=r.length>0?r:$(".biz-render-ecm-delete-confirmation",f),i.filesCount=i.filesCount+1,i.checkMaxFiles(),u=[].concat(i.files),u.push([t.idFileUpload,t.fileName]),i.setValue(u,!1),i.triggerRenderChange(),i.renderUploadItem(r,t)):t.cause=="iframeW8"?i.getFormContainer().refreshForm():bizagi.showMessageBox(t.message)},isValid:function(n){var t=this,u=t.getControl(),f=[],e=!1,i=t.properties,r=!0,o,s,h;return i.required&&(o=t.grid&&t.grid.isFromCreatedRow.apply(t),r=o?!0:this._super(n),t.filesCount==0&&r&&(n.push({xPath:i.xpath,message:t.getResource("render-required-text").replaceAll("#label#",i.displayName)}),r=!1)),i.editable&&(s=$("ul:visible",u).find(".ecm-metadata-value[data-mandatory='true']"),$.each(s,function(n,t){$(".ecm-metadata-text",t).text()==""&&(f.push($(t).data("mandatoryfield")),e=!0)})),e&&(h=t.getResource("render-required-text").replaceAll("#label#",f.join(", ")),n.push({xPath:i.xpath,message:h}),$(".ecm-options-edit",u).click()),r},cleanData:function(){var n=this;n.setValue(null);n.clearDisplayValue()},clearDisplayValue:function(){var n=this,i=n.getControl(),t=i.find(".biz-render-ecm-view-default"),r=t.length-1;$.each(t,function(t,i){var r=$(i),u=r.data();u&&$.when(n.deleteUploadItem(r,u.id)).done(function(){r.remove();n.triggerRenderChange()})});t.hide();n.filesCount=0;n.checkMaxFiles()},waiting:function(n,t){n.find(".ecm-file-name").css("visibility",t?"visible":"hidden");n.find("table").css("visibility",t?"visible":"hidden");n.css("background",t?"":"transparent");t?n.removeClass("waiting"):n.addClass("waiting")}});
bizagi.rendering.grid.extend("bizagi.rendering.grid.bizagi",{},{initializeData:function(n){var i=this,t,r;i.showActionColumn(n);n.properties.singleInstance=!1;this._super(n);this.cellMetadata={};this.pendingActions=[];t=this.properties;r=i.getFormContainer();this.collapseState=t.collapseState;t.displayType="vertical";t.labelAlign="left"},showActionColumn:function(n){var t=this,u=t.getMode(),i=bizagi.util.parseBoolean(n.properties.editable)!=null?bizagi.util.parseBoolean(n.properties.editable):!0,r;t.columnActionParams={columnActions:typeof n.properties.columnActions=="undefined"?!1:!0,allowDelete:typeof n.properties.allowDelete=="undefined"&&i?!0:!1,allowEdit:typeof n.properties.allowEdit=="undefined"&&i?!0:!1,allowDetail:typeof n.properties.allowDetail=="undefined"?!1:!0,withEditForm:typeof n.properties.withEditForm=="undefined"?!1:!0};t.hasActions()&&u=="execution"&&(r={render:{properties:{id:"e51580f3-fd6c-49c0-8c69-73dff93723e5",type:"columnActions","xpath-column":'constant("")',displayName:"",submitOnChange:!1,totalize:{format:{}},hasTotalizer:!1,preventDefault:!0,columnwidth:"90px"}}},n.elements.push(r),t.spliceRowData(n.properties.data))},hasActions:function(n){var t=this;return typeof n===undefined?!1:t.columnActionParams.columnActions&&(t.columnActionParams.allowDelete||t.columnActionParams.allowEdit&&t.columnActionParams.withEditForm||t.columnActionParams.allowDetail)},getGridTemplate:function(){return this.renderFactory.getTemplate("grid.bizagi")},postRender:function(){var n=this,t=n.properties,e=n.getControl(),o=n.getMode(),u,f,i,r;this._super();u=n.grid=$(">div",e);f=n.buildColumnModel();n.getLabel().hide();n.applyGridPlugin();t.data&&(t.data==""||t.data.rows.length==0&&t.data.page>1?n.fetchData(undefined,n.sortBy,n.sortType):(n.updateData(t.data),$.when(n.ready()).done(function(){n.triggerRenderChange({changed:!1})})));n.initialLoadDone=!0;for(i in n.pendingActions)typeof n.pendingActions[i].method=="function"&&n.pendingActions[i].method.apply(n,n.pendingActions[i].arguments);r=$("[data-bizagi-component='buttons'] li[title!='']",n.getControl());r.tooltip();r=$("[data-bizagi-component='cellContent'] button[title!='']",n.getControl());r.tooltip();n.applyColumnsWidth(u,f)},applyGridPlugin:function(){var n=this,r=n.grid,t=n.properties,i=n.getMode(),u=n.renderFactory.getTemplate("bizagi.grid.pagination");r.bizagi_grid_desktop({columns:n.buildColumnModel(),showSummary:t.showSummary,title:t.displayName,mode:n.getMode(),tableCssClass:"",sortBy:t.sortBy||"",collapse:i!=="execution"?!1:!0,collapseState:i!=="execution"?!1:n.collapseState,buttonsPst:i!=="execution"?!1:t.buttonsPst,sortOrder:t.sortOrder||"",smartPagination:!0,sortType:bizagi.override.gridDefaultSortBy||"asc",headerStyles:n.getHeaderStyles(),orientation:t.orientation||"ltr",template:{grid:n.renderFactory.getTemplate("bizagi.grid.grid"),gridRtl:n.renderFactory.getTemplate("bizagi.grid.grid.rtl"),waiting:n.renderFactory.getTemplate("bizagi.grid.waiting"),table:n.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:n.renderFactory.getTemplate("bizagi.grid.table.empty"),column:n.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:n.renderFactory.getTemplate("bizagi.grid.column.special"),row:n.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:n.renderFactory.getTemplate("bizagi.grid.row.buttons"),rowButtonsRtl:n.renderFactory.getTemplate("bizagi.grid.row.buttons.rtl"),cell:n.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:n.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:u,buttons:n.renderFactory.getTemplate("bizagi.grid.buttons"),buttonsRtl:n.renderFactory.getTemplate("bizagi.grid.buttons.rtl"),dynamicPager:n.renderFactory.getTemplate("bizagi.grid.dynamicpager"),summary:n.renderFactory.getTemplate("bizagi.grid.summary"),summaryCell:n.renderFactory.getTemplate("bizagi.grid.summaryCell"),exportOptions:n.renderFactory.getTemplate("bizagi.grid.exportOptions")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&t.data!=null,remove:t.allowDelete,details:t.allowDetail,inlineAdd:t.inlineAdd,allowMore:t.allowMore,enableXlsExport:t.enableXlsExport,enablePdfExport:t.enablePdfExport},tooltips:{addLabel:t.addLabel,editLabel:t.editLabel,deleteLabel:t.deleteLabel,detailLabel:t.detailLabel,exportOptionsLabel:t.exportOptionsLabel},isValid:function(){var t=[],r=n.getFormContainer(),i;if(r.validationController!==undefined&&r.validationController.clearValidationMessages(),n.isValid(t),t.length>0){for(i=0;i<t.length;i++)r.validationController.showValidationMessage(t[i].message,t[i].xpath);return!1}return!0},pageRequested:function(t){i=="execution"&&(n.changes&&Object.keys(n.changes).length>=1?$.when(n.getFormContainer().saveForm()).done(function(){n.sortRequestedPage(t)}):n.sortRequestedPage(t))},sortRequested:function(t){if(i=="execution"&&typeof t.sortBy!="undefined"){var r,u=n.getColumn(t.sortBy);u?r=u.getSortName():(u=n.getColumn(t.sortBy.split(".")[0]),u&&(r=u.getSortName()));t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==r&&(r=t.sortBy);n.fetchData(t.page,r,t.sortType)}},drawCell:function(t){return n.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return n.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){i=="execution"&&n.triggerHandler("rowSelected",{id:t.key})},addRow:function(){i=="execution"&&n.addRow.apply(n,arguments)},editRow:function(t){i=="execution"&&n.properties.withEditForm&&n.editRow(t.key)},deleteRow:function(t){i=="execution"&&n.deleteRow(t.key)},moreRows:function(t){i=="execution"&&n.moreRows(t)},saveAddedRows:function(t){n.saveInlineAddedRows(t.keys)},beforeInlineAdd:function(){n.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){n.inlineAddDeferred&&(n.inlineAddDeferred.resolve(),n.properties.canBeExported=$("li[data-action='save']",n.grid).is(":visible")?!1:!0)},showFormDetails:function(t){n.showFormDetails(t.key)},cancelEdition:function(t){n.removeNewRecords(t)},removeNewRecords:function(t){n.removeNewRecords(t)},showGridExportOptions:function(){n.showGridExportOptions()},performExportGrid:function(t){n.performExportGrid(t)},performCollapseGrid:function(){n.performCollapseGrid()}})},triggerGridPluginHandler:function(){var n=this,t=Array.prototype.slice.call(arguments,0);return n.grid.bizagi_grid_desktop.apply(n.grid,t)},postRenderReadOnly:function(){var n=this;n.postRender()},buildColumnModel:function(){var t=this,r=t.properties,i=t.columns,n=[];return n.push({name:"id",index:0,label:"id",hidden:!0,key:!0}),$.each(i,function(t,i){i.columnIndex=t+1;var r=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,u={name:i.properties.xpath,index:t+1,label:r,key:!1,hidden:!i.properties.visible||i.properties.type=="columnHidden"||i.properties.columnVisible==!1,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:undefined,bizAgiProperties:i.properties};n.push(u)}),n},refresh:function(){var n=this;n.parent&&n.parent.properties&&n.parent.properties.searchParams&&n.parent.properties.searchParams.searchTriggeredBy?n.fetchData(1):n.fetchData()},dataReady:function(){var n=this;return n.dataReadyDeferred!=null?n.dataReadyDeferred.promise():null},loadChanges:function(n){for(var f=this,r=[],i,e,u,o,t=0;t<n.length;t++)r.push([n[t][0],t]);for(t=0;t<r.length;t++)if(i=f.changes[r[t][0]],i!==undefined){e=r[t][1];for(u in i)i.hasOwnProperty(u)&&(o=f.getColumn(u).columnIndex,n[e][o]=i[u])}},updateData:function(n){var t=this,r=t.grid,i=t.columns;n&&(t.properties.data=n,t.setCellOverrides(n,i),t.triggerGridPluginHandler("setData",n),t.applyColumnsWidthUpdate(r,i))},fetchData:function(n,t,i){var r=this,u=r.properties;r.dataReadyDeferred=new $.Deferred;r.sortBy=t;r.sortType=i;n=n||u.page||1;t=t||u.sortBy||"id";i=i||u.sortOrder||"asc";u.page=n;u.sortBy=t;u.sortType=i;u.sort=t+" "+i;r.startLoading();$.when(r.getRemoteData()).then(function(n){(r.endLoading(),r.disposed)||n&&(r.hasActions()&&r.spliceRowData(n),$.each(r.columns,function(t,i){var u=i.properties;u.type==="columnLabel"&&r.spliceRowData(n,t+1)}),r.isRTL()&&(n.rows=r.removeRemainingColumns(n.rows,r.columns.length),n.rows=r.changeOrderData(n.rows)),r.loadChanges(n.rows),r.updateData(n),(r.properties.changed!==!1||r.properties.method==="delete")&&(r.triggerRenderChange(),delete r.properties.changed,delete r.properties.method),r.dataReadyDeferred.resolve())})},isReadyToSave:function(){var n=this,r,i;if(n.grid&&n.properties.inlineAdd&&n.properties.allowEdit){var u=n.triggerGridPluginHandler("getNewRowKeys"),t=[],f=n.getFormContainer();if(u.length>0&&n.isValid(t))return n.properties.alreadySaved=!0,n.saveInlineAddedRows(u,!0);if(t.length>0){for(r=$.Deferred(),i=0;i<t.length;i++)f.validationController.showValidationMessage(t[i].message,t[i].xpath);return r.reject("error"),r.promise()}}return null},collectData:function(n){var t=this,f=t.grid,i,u,r;if(t.grid&&(t.properties.inlineAdd||t.properties.inlineEdit)){try{i=t.triggerGridPluginHandler("getNewRowKeys")}catch(e){i=[]}for(i.length>0&&!t.properties.alreadySaved&&t.isValid([])&&(u=t.saveInlineAddedRows(i,!0),n.deferreds=n.deferreds||[],n.deferreds.push(u)),r=0;r<i.length;r++)t.changes[i[r]]&&delete t.changes[i[r]]}t._super(n)},sortRequestedPage:function(n){var r=this,t,i=r.getColumn(n.sortBy);i?t=i.getSortName():(i=r.getColumn(n.sortBy.split(".")[0]),i&&(t=i.getSortName()));n.sortBy.split(".").length>1&&n.sortBy.split(".")[0]==t&&(t=n.sortBy);r.fetchData(n.page,t,n.sortType)},drawCell:function(n,t,i,r){var u=this;if(n.key)return i;var h=u.getCellOverride(t,n.index-1),o=n.index-1,s=u.columns[o];u.newRecords=u.newRecords||{};u.cellMetadata[t]||(u.cellMetadata[t]={});u.cellMetadata[t][o]||(u.cellMetadata[t][o]={});var f=u.cellMetadata[t][o].properties||s.originalProperties,c=f.visible!==undefined?f.visible:!0,e=f.editable!==undefined?f.editable:!0;return c=h.visible,e=f.editable?h.editable:!1,r&&n.bizAgiProperties.type!=="columnFormLink"&&(e=!0),s.properties.displayType="value",n.bizAgiProperties.type==="columnActions"&&(e=!0),t=="summary"&&(e=!1),c?e?u.drawEditableCell(s,f,t,i,r):u.drawReadonlyCell(s,f,t,i):"<label><\/label>"},drawEditableCell:function(n,t,i,r,u){var f=this,e=new $.Deferred,o=n.properties.editable;return n.properties.editable=!0,n.overrideProperties({required:t.required}),$.when(n.render(i,r)).done(function(t){u&&!f.newRecords[i]&&(f.newRecords[i]={});for(var r=0;r<f.columns.length;r++)f.cellOverrides[i]=f.cellOverrides[i]||{},f.getCellOverride(i,r).visible=f.getCellOverride(i,r).visible!=undefined?f.getCellOverride(i,r).visible:!0;n.getDecorated(i).bind("renderchange",function(r,u){f.onCellChange(n,t,i,u)});e.resolve(t)}),n.properties.editable=o,e.promise()},drawReadonlyCell:function(n,t,i,r){var e=this,u="",f;return i=="summary"?(f=n.properties.textFormat,n.properties.totalize&&(n.properties.textFormat=n.properties.totalize.format),u=n.renderSummary(i,r),n.properties.textFormat=f):u=n.renderReadOnly(i,r),u},onCellChange:function(n,t,i,r){var f=this,u=n.getValue(i),c=n.getCompositeValue(i),h=f.triggerGridPluginHandler("isNewRecord",i),e,l=h?!1:!0,o,a,s,v;try{if(n.properties.type=="columnDate"&&n.data.properties.showTime==!0)bizagi.util.isEmpty(u)?u===""&&(u=""):(o=bizagi.util.dateFormatter.getDateFromInvariant(u,!0),u=bizagi.util.dateFormatter.formatInvariant(o,!0));else if(n.properties.type=="columnDate")bizagi.util.isEmpty(u)?u===""&&(u=""):(o=bizagi.util.dateFormatter.getDateFromInvariant(u,!1),o.setHours(0,0,0,0),u=bizagi.util.dateFormatter.formatInvariant(o,!0));else if(n.properties.type==="columnSearch"&&h&&f.properties.inlineAdd&&f.properties.submitOnChange){f.collectGridChange($.extend(r,{id:i,xpath:n.properties.xpath||n.properties.id,value:u,compositeValue:c,columnIndex:n.columnIndex,trigger:l}));try{e=f.triggerGridPluginHandler("getNewRowKeys")}catch(p){e=[]}for(r.render.startActionExecution(),a=f.saveInlineAddedRows(e,!0),s=0;s<e.length;s++)f.changes[e[s]]&&delete f.changes[e[s]];$.when(a).done(function(){r.render.endActionExecution()});return}v=n.properties.type=="columnBoolean"&&n.properties.isExclusive;!v&&(f.properties.allowEdit||h)&&f.collectGridChange($.extend(r,{id:i,xpath:n.properties.xpath||n.properties.id,value:u,compositeValue:c,columnIndex:n.columnIndex,trigger:l}));f.triggerGridPluginHandler("changeCellValue",i,n.columnIndex,u);n.properties.totalize&&n.properties.totalize.operation&&f.triggerGridPluginHandler("refreshSummary",n.columnIndex)}catch(y){bizagi.log(y.message)}},onCellReady:function(n,t,i,r){var e=this,h=n.index-1,y=e.getCellOverride(t,h),u=e.columns[h],f=e.cellMetadata[t][h].properties||u.originalProperties,c=f.visible!==undefined?f.visible:!0,o=f.editable!==undefined?f.editable:!0,l,a,v,s;c=y.visible;t=="summary"&&(o=!1);r&&(o=!0);n.bizAgiProperties.type==="columnActions"&&(o=!0);c&&(l=f.columnAlign?f.columnAlign:"center",a=f.columntitlealign?f.columntitlealign:"center",e.changeTitleAligningClass(n.index,a),e.changeAligningClass(i,l),o?(v=u.properties.editable,u.properties.editable=o,u.properties.submitOnChange&&(s=u.getDecorated(t),s&&(s.properties.submitOnChangexpathContext=e.properties.xpath+"[]",s.properties.submitOnChangexpathContextRow=e.properties.xpath+"[id="+t+"]")),u.postRender(t,i),u.properties.editable=v):t=="summary"?u.postRenderSummary(t,i)||e.applySummaryColumnStyles(i,f):u.postRenderReadOnly(t,i))},changeTitleAligningClass:function(n,t){var i=this,r=i.getControl();$.when(i.ready()).done(function(){var u=$("[data-bizagi-component=columns]",r).find('[data-column-index="'+n+'"]');u.addClass(i.getTitleAlignClass(t))})},changeAligningClass:function(n,t){var i=this;n.addClass(i.getAlignClass(t))},getTitleAlignClass:function(n){switch(n){case"right":return"ui-bizagi-grid-title-align-right";case"left":return"ui-bizagi-grid-title-align-left";case"center":return"ui-bizagi-grid-title-align-center";case"justify":return"ui-bizagi-grid-title-align-justify"}},getAlignClass:function(n){switch(n){case"right":return"ui-bizagi-grid-align-right";case"left":return"ui-bizagi-grid-align-left";case"center":return"ui-bizagi-grid-align-center";case"justify":return"ui-bizagi-grid-align-justify"}},addRow:function(n){var t=this,i=t.properties,u=i.orientation=="rtl"?!0:!1,r=[];if(n){if(n.open)return;n.open=!0}$.when(t.submitAddRequest()).done(function(f){var o=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:i.addLabel,orientation:i.orientation||"ltr",onSave:function(n){return i.contextType&&(n[t.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=i.contextType),t.submitSaveRequest(f,n)},onCancel:function(){}}),e;r[0]={text:bizagi.localization.getResource("render-form-dialog-box-save"),click:function(n){return i.contextType&&(n[t.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=i.contextType),t.submitSaveRequest(f,n)}};r[1]={text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){t.submitRollbackRequest()}};u&&r.reverse();e=i.xpath+"[id="+f+"]";o.render({idRender:i.id,recordXPath:e,xpathContext:i.xpathContext,idPageCache:i.idPageCache,requestedForm:"addForm",contextType:i.contextType,url:i.addPage}).done(function(){t.startLoading();i.submitOnChange?t.submitOnChange().always(function(){t.endLoading()}):t.fetchData()}).fail(function(){n.open=!1;t.submitRollbackRequest()})})},editRow:function(n){var t,r,i;if(n==0||n==undefined){bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"));return}t=this;r=t.properties;t.changes[n]!==undefined?(i=$.extend(t.changes[n],{}),i.idPageCache=r.idPageCache,i.disableServerGridValidations=!0,$(".ui-tooltip").remove(),$.when(t.submitSaveRequest(n,i)).done(function(){t.startLoading();r.submitOnChange?t.submitForGridChange().always(function(){t.endLoading();t.executeSubmitEditRequest(n)}):t.fetchData()})):t.executeSubmitEditRequest(n)},getHeaderStyles:function(){var o=this,t="",i="",r=o.properties,n,u,f,e;return r.headerFormat&&(n=r.headerFormat,n.color&&(t+="color: "+n.color+";"),n.background&&(i+="background-color: "+n.background+";"),n.bold&&(t+="font-weight: bold; "),n.italic&&(t+="font-style: italic; "),(n.underline||n.strikethru)&&(u=bizagi.util.parseBoolean(n.strikethru)?"line-through ":"",f=bizagi.util.parseBoolean(n.underline)?"underline ":"",t+="text-decoration: "+u+f+";"),n.size&&n.size!="0"&&(e=100+Number(n.size)*10+"%",t+="font-size: "+e+";")),{label:t,header:i}},editInlineRow:function(n){var i=this,r=i.getControl(),t;if(n==0||n==undefined){bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"));return}t=$("[data-bizagi-component=buttons]",r);t.find("[data-action=save]").css("display","inline-block");t.find("[data-action=cancel]").css("display","inline-block");i.changeRowEditable(n,!0)},changeRowEditable:function(){},changeCellBackgroundColor:function(n,t,i){var r=this,u;r.initialLoadDone?(u=r.getControlCell(n,t),u&&u.changeCellBackgroundColor(i)):r.pendingActions.push({method:r.changeCellBackgroundColor,arguments:arguments})},changeCellColor:function(n,t,i){var r=this,u;r.initialLoadDone?(u=r.getControlCell(n,t),u&&u.changeCellColor(i)):r.pendingActions.push({method:r.changeCellColor,arguments:arguments})},changeCellVisibility:function(n,t,i){var r=this,f,u;if(r.initialLoadDone){if(f=r.getControlCell(n,t),f){for(f.changeCellVisibility(i),u=0;u<r.columns.length;u++)if(r.columns[u].properties.xpath==t)break;r.cellOverrides[n]=r.cellOverrides[n]||{};r.getCellOverride(n,u).visible=i}}else r.pendingActions.push({method:r.changeCellVisibility,arguments:arguments})},changeCellEditability:function(n,t,i){var r=this,f,u;if(r.initialLoadDone){if(f=r.getControlCell(n,t),f&&f.control){for(f.changeEditabilityCellControl(i,n,t),u=0;u<r.columns.length;u++)if(r.columns[u].properties.xpath==t)break;r.cellOverrides[n]=r.cellOverrides[n]||{};r.getCellOverride(n,u).editable=i}}else r.pendingActions.push({method:r.changeEditability,arguments:arguments})},cleanCellData:function(n,t){var i=this,f,r;if(i.initialLoadDone){if(f=i.getControlCell(n,t),f){for(f.cleanData(),r=0;r<i.columns.length;r++)if(i.columns[r].properties.xpath==t)break;for(var e=i.properties.data.rows,u=0,o=e.length;u<o;u++)if(Number(n)===e[u][0]){e[u][r+1]=[["",""]];break}i.cellOverrides[n]=i.cellOverrides[n]||{};i.getCellOverride(n,r).value=null}}else i.pendingActions.push({method:i.cleanData,arguments:""})},changeCellRequired:function(n,t,i){var r=this,f,u;if(r.initialLoadDone){if(f=r.getControlCell(n,t),f){for(f.changeCellRequired(i),u=0;u<r.columns.length;u++)if(r.columns[u].properties.xpath==t)break;r.cellOverrides[n]=r.cellOverrides[n]||{};r.getCellOverride(n,u).required=i}}else r.pendingActions.push({method:r.changeCellRequired,arguments:arguments})},changeCellValue:function(n,t,i){var u=this,r,f,e,o;u.initialLoadDone?(r=u.getControlCell(n,t),r&&(r.setDisplayValue(i),f=r.column.getValue(n),e=r.column.getCompositeValue(n),r.setDisplayValue(i),o=!1,r.triggerHandler("renderchange",{render:u,changed:!0}),u.collectGridChange({id:n,xpath:t,value:f,compositeValue:e,columnIndex:r.column,trigger:o}))):u.pendingActions.push({method:u.setDisplayValue,arguments:arguments})},changeCellMaxValue:function(n,t,i){var r=this,u;r.initialLoadDone?(u=r.getControlCell(n,t),u&&u.changeMaxValue(i)):r.pendingActions.push({method:r.changeMaxValue,arguments:arguments})},changeCellMinValue:function(n,t,i){var r=this,u;r.initialLoadDone?(u=r.getControlCell(n,t),u&&u.changeMinValue(i)):r.pendingActions.push({method:r.changeMinValue,arguments:arguments})},deleteRow:function(n){if(!n||n==0){bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"));return}var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(t.submitDeleteRequest(n)).done(function(i){t.removeNewRecords({keys:[n]});i.type=="success"&&t.triggerRenderChange({rowDeleted:!0,changed:!1,key:n});t.properties.changed=!1;t.properties.method="delete";t.calculateFetchData(i,n)})})},calculateFetchData:function(n,t){var r=this,u,i=r.properties;return n.type==="success"&&(u=i.data&&i.data.rows,u.length===1&&u[0][0]===Number(t)&&i.page>1)?r.fetchData(i.page-1):r.fetchData()},moreRows:function(n){var i=this,t=i.properties,r;if(typeof t.originalrowsPerPage=="undefined"&&(t.originalrowsPerPage=t.rowsPerPage),t.rowsPerPage+=t.originalrowsPerPage,r={},i.collectData(r),jQuery.isEmptyObject(r)){i.moreRowsCommon(n);return}i.dataService.submitData({action:"SUBMITDATA",data:r,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache}).done(function(){i.moreRowsCommon(n)})},moreRowsCommon:function(n){var t=this,i=t.properties;t.fetchData(n.page,n.sortBy,n.sortType);$.when(t.dataReadyDeferred).done(function(){i.records!=0&&i.records+1<=i.rowsPerPage&&$(".ui-bizagi-grid-dynamic-pager",t.getControl()).hide()})},executeSubmitEditRequest:function(n){var t=this,i=t.properties,u=i.orientation=="rtl"?!0:!1,r=[],f=t.getFormContainer().properties.displayAsReadOnly==!0?!1:!0;$.when(t.submitEditRequest(n)).done(function(){var e=i.xpath+"[id="+n+"]",o=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:i.editLabel,showSaveButton:f,orientation:i.orientation||"ltr",onSave:function(i){return t.submitSaveRequest(n,i)},extraButtons:bizagi.override.enablePrintFromEditForm?{"workportal-widget-dialog-box-print":function(){t.printFormCommand=new bizagi.workportal.command.printform(t.renderFactory);var n={idRender:i.id,recordXPath:e,xpathContext:i.xpathContext,idPageCache:i.idPageCache,requestedForm:"editForm",contextType:i.contextType};t.printFormCommand.print(n)}}:{}});r[0]={text:bizagi.localization.getResource("render-form-dialog-box-save"),click:function(i){return t.submitSaveRequest(n,i)}};u&&r.reverse();o.render({idRender:i.id,recordXPath:e,xpathContext:i.xpathContext,idPageCache:i.idPageCache,requestedForm:"editForm",url:i.editPage,contextType:i.contextType}).done(function(){t.startLoading();i.submitOnChange?t.submitOnChange().always(function(){t.endLoading()}):t.fetchData()}).fail(function(){t.submitRollbackRequest()})})},showFormDetails:function(n){var i=this,t=i.properties,r,u;if(n==0||n==undefined){bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"));return}r=new bizagi.rendering.dialog.form(i.dataService,i.renderFactory,{title:t.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!1,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close")});u=t.xpath+"[id="+n+"]";r.render({idRender:t.id,recordXPath:u,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"detailForm",url:t.editPage,editable:!1})},saveInlineAddedRows:function(n,t){var i=this,u=[],r;for(t=t!==undefined?t:!0,i.dataReadyDeferred=new $.Deferred,r=0;r<n.length;r++)u.push(i.prepareAddAction(n[r]));return i.properties.alreadySaved=!0,$.when.apply($,u).done(function(){t&&(i.properties.changed=!1,i.refresh());$.when(i.dataReady()).done(function(){i.triggerRenderChange({changed:!1})})})},prepareAddAction:function(n){var i=this,t=i.properties,r=i.changes[n];return i.dataService.multiaction().addGridRecordData({url:t.addUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,contexttype:t.contexttype,idPageCache:t.idPageCache,submitData:r})},removeNewRecords:function(n){var t=this;n&&n.keys&&$.each(n.keys,function(n,i){t.newRecords[i]&&delete t.newRecords[i]})},showGridExportOptions:function(){var n=this,t,r,u,f,i=n.getFormContainer(),e=n.properties.buttonsPst===!0?"top":"bottom";n.properties.orientation=="rtl"?(t=n.getControl(),r=n.properties.buttonsPst===!0?$(".ui-bizagi-grid-export-options-wrapper-rtl",t).outerHeight():-1*$(".ui-bizagi-grid-export-options-content-rtl",t).outerHeight(),u=[],$(".ui-bizagi-grid-export-options-content-rtl",t).css(e,r),$(".ui-bizagi-grid-export-options-content-rtl",t).hasClass("hidden")?(typeof Windows!="undefined"&&n.grid.find(".bz-rn-grid-data-wraper").addClass("bz-rn-grid-data-wraper-fix-w8-scroll"),$(".ui-bizagi-grid-export-options-content-rtl",t).removeClass("hidden"),$(".ui-bizagi-grid-export-options-content-rtl",t).show()):($(".ui-bizagi-grid-export-options-content-rtl",t).addClass("hidden"),n.grid.find(".bz-rn-grid-data-wraper").removeClass("bz-rn-grid-data-wraper-fix-w8-scroll")),i&&(f=$(i.container),n.hasChanged(u)&&n.properties.alreadySaved===!1&&i.properties.editable||n.properties.canBeExported===!1&&i.properties.editable?n.properties.alreadySaved!==!1||$("li[data-action='save']",n.grid).is(":visible")?Object.keys(n.changes).length==1&&n.changes.summary||($("#print-grid-save-first",t).show(),$("#print-grid-pdf",t).hide(),$("#print-grid-xls",t).hide()):n.properties.canBeExported=!0:n.properties.canBeExported=!0)):(t=n.getControl(),r=n.properties.buttonsPst===!0?$(".ui-bizagi-grid-export-options-wrapper",t).outerHeight():-1*$(".ui-bizagi-grid-export-options-content",t).outerHeight(),u=[],$(".ui-bizagi-grid-export-options-content",t).css(e,r),$(".ui-bizagi-grid-export-options-content",t).hasClass("hidden")?(typeof Windows!="undefined"&&n.grid.find(".bz-rn-grid-data-wraper").addClass("bz-rn-grid-data-wraper-fix-w8-scroll"),$(".ui-bizagi-grid-export-options-content",t).removeClass("hidden"),$(".ui-bizagi-grid-export-options-content",t).show()):($(".ui-bizagi-grid-export-options-content",t).addClass("hidden"),n.grid.find(".bz-rn-grid-data-wraper").removeClass("bz-rn-grid-data-wraper-fix-w8-scroll")),i&&(f=$(i.container),n.hasChanged(u)&&n.properties.alreadySaved===!1&&i.properties.editable||n.properties.canBeExported===!1&&i.properties.editable?n.properties.alreadySaved!==!1||$("li[data-action='save']",n.grid).is(":visible")?Object.keys(n.changes).length==1&&n.changes.summary||($("#print-grid-save-first",t).show(),$("#print-grid-pdf",t).hide(),$("#print-grid-xls",t).hide()):n.properties.canBeExported=!0:n.properties.canBeExported=!0))},performCollapseGrid:function(){var n=this;n.properties.orientation=="rtl"?(content=n.getControl(),$gridWrapper=$(".bz-rn-grid-wrapper",content),$collapseIcon=$(".bz-rn-grid-cn-header-rtl .ui-icon",content),$collapseIcon.toggleClass("ui-state-collapse").toggleClass("ui-state-expand"),$gridWrapper.toggleClass("bz-rn-grid-body-collapse"),n.collapseState=$gridWrapper.hasClass("bz-rn-grid-body-collapse"),n.triggerGridPluginHandler("updateCollapseState",n.collapseState),n.updateCollapseState()):(content=n.getControl(),$gridWrapper=$(".bz-rn-grid-wrapper",content),$collapseIcon=$(".bz-rn-grid-cn-header .ui-icon",content),$collapseIcon.toggleClass("ui-state-collapse").toggleClass("ui-state-expand"),$gridWrapper.toggleClass("bz-rn-grid-body-collapse"),n.collapseState=$gridWrapper.hasClass("bz-rn-grid-body-collapse"),n.triggerGridPluginHandler("updateCollapseState",n.collapseState),n.updateCollapseState())},updateCollapseState:function(){var t=this,n=t.properties;return params={},$.extend(params,{url:n.dataUrl,xpath:n.xpath,idRender:n.id,xpathContext:n.xpathContext,contexttype:n.contextType,idPageCache:n.idPageCache,collapseState:t.collapseState}),t.dataService.multiaction().getCollapseData(params)},performExportGrid:function(n){var t=this,i=!0,r=t.getGridExportUrl(n),u;n.exportType=="pdfExport"&&(u=t.checkAdobePlugin(),$.browser.msie&&!u&&(i=!1,$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-acrobat-message"))).done(function(){t.downloadExportedGrid(r)})));i&&t.downloadExportedGrid(r)},updateAffectedCellManually:function(n,t,i){var r=this,e=r.columns.length,f=r.getRowIndexByKey(n),u;r.properties.data.rows[f][i]!==t&&(r.properties.data.rows[f][i]=t,u=$(".ui-bizagi-grid-summary",r.grid),u.empty(),u.html(r.grid.bizagi_grid_desktop("drawSummary")),r.grid.bizagi_grid_desktop("postRenderSummary",u))},getRowIndexByKey:function(n){for(var i=this,t=i.properties.data.rows.length;t-->0;)if(n==i.properties.data.rows[t][0])return t},checkAdobePlugin:function(){var n;try{n=new ActiveXObject("AcroPDF.PDF")}catch(t){bizagi.log(t)}if(!n)try{n=new ActiveXObject("PDF.PdfCtrl")}catch(t){bizagi.log(t)}return n},downloadExportedGrid:function(n){window.open(n)},formatGrid:function(n){var t=$(".ui-bizagi-grid-table",n),r=$(".ui-pg-table",n),i=$(".ui-jqgrid-titlebar-close",n);$("th.ui-bizagi-column-hidden, td.ui-bizagi-grid-key, .bz-rn-grid-container-foother",n).remove();$("[data-action], ul li, .ui-bizagi-grid-column, tr, th",t).unbind("click");$(i).remove()},ready:function(){var n=this,t=n._super(),i=n.inlineAddDeferred?n.inlineAddDeferred.promise():null;return $.when(t,i)},applyColumnsWidth:function(n,t){for(var i,r=0;r<t.length;r++)if(i=n.find(".resizableColumn")[r],i){var o=$(i).find(">.ui-bizagi-grid-column"),f=o.length==1?Number($(i).find(">.ui-bizagi-grid-column").data("column-index")):r,u=t[f].bizAgiProperties.columnwidth,e="auto";t[f].bizAgiProperties&&u&&u!="auto"&&(e=u);$(i).css("width",e);$(i).find(".ui-bizagi-grid-column").css("width","auto")}},applyColumnsWidthUpdate:function(n,t){for(var c=this,f=null,i=null,o=null,r=null,e=null,s=n.find(".resizableColumn"),h=s.length,u=0;u<h;u++)i=s[u],o=$(i).find(">.ui-bizagi-grid-column"),f=o.length==1?Number($(i).find(">.ui-bizagi-grid-column").data("column-index"))-1:u,r=t[f].properties.columnwidth,e="auto",t[f].properties&&r&&r!="auto"&&(e=r),$(i).css("width",e),$(i).find(".ui-bizagi-grid-column").css("width","auto")},applySummaryColumnStyles:function(n,t){var s=this,r=n.find(".ui-bizagi-grid-summary-readonly"),i,u;if(t.totalize!=null&&t.totalize.format!=null){if(i=t.totalize.format,u="",i.background&&(n.css("background-color",i.background),n.css("background-image","none")),i.size&&i.size!="0"){var e=i.size.toString(),o=e.substring(0,1),f=e.substring(1,e.length);f=o=="+"?100+10*Number(f):100-10*Number(f);r.css("font-size",f+"%")}i.italic&&r.css("font-style","italic");i.color&&r.css("color",i.color);i.underline&&(u+="underline ");i.strikethru&&(u+="line-through");(i.bold==!0||i.bold==undefined)&&r.css("font-weight","bold");r.css("text-decoration",u)}}});
bizagi.rendering.grid.extend("bizagi.rendering.grid.offline",{MAX_ROWS_SUPPORTED:4},{initializeData:function(n){var i=this,t,r;n.properties.singleInstance=!1;this._super(n);this.cellMetadata={};this.pendingActions=[];t=this.properties;r=i.getFormContainer();t.displayType="vertical";t.labelAlign="left"},getGridTemplate:function(){return this.renderFactory.getTemplate("grid.bizagi")},postRender:function(){var n=this,t=n.properties,u=n.getControl(),e=n.getMode(),f,i,r;this._super();f=n.grid=$(">div",u);n.getLabel().hide();n.applyGridPlugin();t.data&&(t.data==""||t.data.rows.length==0&&t.data.page>1?n.fetchData():(n.updateData(t.data),$.when(n.ready()).done(function(){n.triggerRenderChange({changed:!1})})));n.initialLoadDone=!0;for(i in n.pendingActions)typeof n.pendingActions[i].method=="function"&&n.pendingActions[i].method.apply(n,n.pendingActions[i].arguments);r=$("[data-bizagi-component='buttons'] li[title!='']",n.getControl());r.tooltip()},applyGridPlugin:function(){var n=this,r=n.grid,t=n.properties,i=n.getMode(),u=n.buildColumnModel(),f=n.renderFactory.getTemplate("bizagi.grid.pagination");r.bizagi_grid_desktop({columns:u,maxColumns:n.Class.MAX_ROWS_SUPPORTED,showSummary:t.showSummary,title:t.displayName,mode:n.getMode(),tableCssClass:"",template:{grid:n.renderFactory.getTemplate("bizagi.grid.grid"),waiting:n.renderFactory.getTemplate("bizagi.grid.waiting"),table:n.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:n.renderFactory.getTemplate("bizagi.grid.table.empty"),column:n.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:n.renderFactory.getTemplate("bizagi.grid.column.special"),row:n.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:n.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:n.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:n.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:f,buttons:n.renderFactory.getTemplate("bizagi.grid.buttons"),dynamicPager:n.renderFactory.getTemplate("bizagi.grid.dynamicpager"),summary:n.renderFactory.getTemplate("bizagi.grid.summary"),summaryCell:n.renderFactory.getTemplate("bizagi.grid.summaryCell"),exportOptions:n.renderFactory.getTemplate("bizagi.grid.exportOptions")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&t.data!=null,remove:t.allowDelete,details:!1,inlineAdd:!0,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1},tooltips:{addLabel:t.addLabel,editLabel:t.editLabel,deleteLabel:t.deleteLabel,detailLabel:t.detailLabel},isValid:function(){var t=[],r=n.getFormContainer(),i;if(r.validationController!==undefined&&r.validationController.clearValidationMessages(),n.isValid(t),t.length>0){for(i=0;i<t.length;i++)r.validationController.showValidationMessage(t[i].message,t[i].xpath);return!1}return!0},pageRequested:function(){i!="execution"},drawCell:function(t){return n.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return n.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){i=="execution"&&n.triggerHandler("rowSelected",{id:t.key})},addRow:function(){i=="execution"&&n.addRow()},editRow:function(t){i=="execution"&&n.properties.withEditForm&&n.editRow(t.key)},deleteRow:function(t){i=="execution"&&n.deleteRow(t.key)},saveAddedRows:function(t){n.saveInlineAddedRows(t.keys)},beforeInlineAdd:function(){n.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){n.inlineAddDeferred&&n.inlineAddDeferred.resolve()},cancelEdition:function(t){n.removeNewRecords(t)},removeNewRecords:function(t){n.removeNewRecords(t)}})},triggerGridPluginHandler:function(){var n=this,t=Array.prototype.slice.call(arguments,0);return n.grid.bizagi_grid_desktop.apply(n.grid,t)},postRenderReadOnly:function(){var n=this;n.postRender()},buildColumnModel:function(){return bizagi.rendering.grid.bizagi.prototype.buildColumnModel.call(this)},refresh:function(){var n=this;n.fetchData()},dataReady:function(){var n=this;return n.dataReadyDeferred!=null?n.dataReadyDeferred.promise():null},loadChanges:function(n){for(var f=this,r=[],i,e,u,o,t=0;t<n.length;t++)r.push([n[t][0],t]);for(t=0;t<r.length;t++)if(i=f.changes[r[t][0]],i!==undefined){e=r[t][1];for(u in i)i.hasOwnProperty(u)&&(o=f.getColumn(u).columnIndex,n[e][o]=i[u])}},updateData:function(n){var t=this,i=t.grid,r=t.columns;n&&(t.properties.data=n,t.setCellOverrides(n),t.triggerGridPluginHandler("setData",n),t.applyColumnsWidthUpdate(i,r))},fetchData:function(){var n=this;n.dataReadyDeferred=new $.Deferred;n.startLoading();$.when(n.getRemoteData()).then(function(t){(n.endLoading(),n.disposed)||t&&(n.updateData(t),n.triggerRenderChange(),n.dataReadyDeferred.resolve())})},getRemoteData:function(n){var r=this,i=r.properties,u,f,t;return(n=n||{},i.overrideGetRemoteData)?(u=i.overrideGetRemoteData(n),u!=null?u.promise():null):(f=new $.Deferred,t=i.data,i.page=t.page,i.records=t.records,i.totalPages=t.totalPages,r.isRTL()&&(t.rows=r.changeOrderData(t.rows)),f.resolve(t),f.promise())},isReadyToSave:function(){var n=this,t;return n.grid&&n.properties.inlineAdd&&n.properties.allowEdit&&(t=n.triggerGridPluginHandler("getNewRowKeys"),t.length>0&&n.isValid())?(n.properties.alreadySaved=!0,n.saveInlineAddedRows(t,!1)):null},collectData:function(n){var t=this,l=t.properties,i=t.properties.data,r=[],o,s,f,c,e,h,u;if(t.isValid([]))for(o in t.changes){s=[];for(f in t.changes[o])t.canColumnBeSent(o,f)&&(c=t.getColumn(f).columnIndex-1,e=t.changes[o][f],typeof e=="string"&&e.match(/\n/gm)!==null&&(e=e.replaceAll("\n","\\n")),s[c]={value:e,xpath:f,DataType:t.getColumn(f).properties.dataType});if(typeof t.properties.data.rows!="undefined"&&t.properties.data.rows.length>0)for(h=[],u=0;u<i.rows.length;u++)if(i.rows[u][0]==o){h=i.rows[u];i.rows.splice(u,1);u--;h=t.processRow(h);s=$.extend(!0,h,s);break}r[r.length]=s}n[l.xpath]=typeof i.rows!="undefined"&&r.length>0?$.merge($.merge([],t.processOldRows(i.rows)),r):typeof i.rows!="undefined"&&i.rows.length>0?t.processOldRows(i.rows):r.length>0?r:r},processOldRows:function(n){for(var u,i=[],r=n,t=0;t<r.length;t++)u=r[t],i[t]=$.grep(u,function(n,t){return t>0});return i},processRow:function(n){return $.grep(n,function(n,t){return t>0})},drawCell:function(n,t,i,r){var e=this,f,c;if(n.key)return i;typeof i!="object"||r||(i=i.hasOwnProperty("value")?i.value:i);var l=e.getCellOverride(t,n.index-1),s=n.index-1,u=e.columns[s];e.newRecords=e.newRecords||{};e.cellMetadata[t]||(e.cellMetadata[t]={});e.cellMetadata[t][s]||(e.cellMetadata[t][s]={});var o=e.cellMetadata[t][s].properties||u.originalProperties,a=o.visible!==undefined?o.visible:!0,h=o.editable!==undefined?o.editable:!0;if(a=l.visible,h=o.editable?l.editable:!1,r&&(h=!0),u.properties.displayType="value",u.properties.type=="columnSearch"&&i!=null)for(f=0,c=u.properties.data.length;f<c;f++)u.properties.data[f].id==i&&(i={id:u.properties.data[f].id,label:u.properties.data[f].value});if((u.properties.type=="columnList"||u.properties.type=="columnCombo")&&i!=null)for(f=0,c=u.properties.data.length;f<c;f++)u.properties.data[f].id==i&&(i=[[u.properties.data[f].id,u.properties.data[f].value]]);return t=="summary"&&(h=!1),a?h?e.drawEditableCell(u,o,t,i,r):e.drawReadonlyCell(u,o,t,i):"<label><\/label>"},drawEditableCell:function(){return bizagi.rendering.grid.bizagi.prototype.drawEditableCell.apply(this,arguments)},drawReadonlyCell:function(){return bizagi.rendering.grid.bizagi.prototype.drawReadonlyCell.apply(this,arguments)},onCellChange:function(){bizagi.rendering.grid.bizagi.prototype.onCellChange.apply(this,arguments)},onCellReady:function(){bizagi.rendering.grid.bizagi.prototype.onCellReady.apply(this,arguments)},changeTitleAligningClass:function(){bizagi.rendering.grid.bizagi.prototype.changeTitleAligningClass.apply(this,arguments)},changeAligningClass:function(){bizagi.rendering.grid.bizagi.prototype.changeAligningClass.apply(this,arguments)},getTitleAlignClass:function(){bizagi.rendering.grid.bizagi.prototype.getTitleAlignClass.apply(this,arguments)},getAlignClass:function(){return bizagi.rendering.grid.bizagi.prototype.getAlignClass.call(this,arguments)},addRow:function(){},editRow:function(){},editInlineRow:function(n){var i=this,r=i.getControl(),t;if(n==0||n==undefined){bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"));return}t=$("[data-bizagi-component=buttons]",r);t.find("[data-action=save]").css("display","inline-block");t.find("[data-action=cancel]").css("display","inline-block");i.changeRowEditable(n,!0)},changeRowEditable:function(){},changeCellBackgroundColor:function(){bizagi.rendering.grid.bizagi.prototype.changeCellBackgroundColor.apply(this,arguments)},changeCellColor:function(){bizagi.rendering.grid.bizagi.prototype.changeCellColor.apply(this,arguments)},changeCellVisibility:function(){bizagi.rendering.grid.bizagi.prototype.changeCellVisibility.apply(this,arguments)},changeCellEditability:function(){bizagi.rendering.grid.bizagi.prototype.changeCellEditability.apply(this,arguments)},cleanCellData:function(){bizagi.rendering.grid.bizagi.prototype.cleanCellData.apply(this,arguments)},changeCellRequired:function(){bizagi.rendering.grid.bizagi.prototype.changeCellRequired.apply(this,arguments)},changeCellValue:function(){bizagi.rendering.grid.bizagi.prototype.changeCellValue.apply(this,arguments)},deleteRow:function(n){if(!n||n==0){bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"));return}var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(t.submitDeleteRequest(n)).done(function(){t.removeNewRecords({keys:[n]});t.properties.recordHasBeenDeleted=!0;t.fetchData()})})},executeSubmitEditRequest:function(){},saveInlineAddedRows:function(){},prepareAddAction:function(){},processChanges:function(){return bizagi.rendering.grid.bizagi.prototype.processChanges.call(this,arguments)},removeNewRecords:function(){bizagi.rendering.grid.bizagi.prototype.removeNewRecords.call(this,arguments)},formatGrid:function(){bizagi.rendering.grid.bizagi.prototype.formatGrid.call(this,arguments)},ready:function(){var n=this,t=n._super(),i=n.inlineAddDeferred?n.inlineAddDeferred.promise():null;return $.when(t,i)},applyColumnsWidth:function(){bizagi.rendering.grid.bizagi.prototype.applyColumnsWidth.apply(this,arguments)},applyColumnsWidthUpdate:function(){bizagi.rendering.grid.bizagi.prototype.applyColumnsWidthUpdate.apply(this,arguments)},applySummaryColumnStyles:function(){bizagi.rendering.grid.bizagi.prototype.applySummaryColumnStyles.apply(this,arguments)},submitDeleteRequest:function(n){for(var u=this,t=u.properties.data,r=!1,f=[],i=0;i<t.rows.length;i++)if(t.rows[i][0]==n){f=t.rows[i];delete t.rows[i];t.rows.splice(i,1);t.records--;r=!0;break}return r||bizagi.showMessageBox(this.getResource("workportal-general-no-records-found")),t.rows}});
bizagi.rendering.grid.bizagi.extend("bizagi.rendering.grid.grouped",{},{initializeData:function(n){var i=this,t,r;n.properties=i.convertProperties(n.properties);n.properties.singleInstance=!1;this._super(n);this.cellMetadata={};this.pendingActions=[];t=this.properties;r=i.getFormContainer();t.withEditForm=t.allowEdit;this.collapseState=t.collapseState;t.displayType="vertical";t.labelAlign="left"},drawCell:function(n,t,i,r){var u=this;if(n.key)return i;var h=u.getCellOverride(t,n.index-1),e=n.index-1,o=u.columns[e];u.newRecords=u.newRecords||{};u.cellMetadata[t]||(u.cellMetadata[t]={});u.cellMetadata[t][e]||(u.cellMetadata[t][e]={});var f=u.cellMetadata[t][e].properties||o.originalProperties,c=f.visible!==undefined?f.visible:!0,s=f.editable!==undefined?f.editable:!0;return c=h.visible,s=f.editable?h.editable:!1,r&&(s=!0),o.properties.displayType="value",typeof t=="string"&&t.indexOf("summary")>=0&&(s=!1),c?s?u.drawEditableCell(o,f,t,i,r):u.drawReadonlyCell(o,f,t,i):"<label><\/label>"},drawReadonlyCell:function(n,t,i,r){var e=this,u="",f;return typeof i=="string"&&i.indexOf("summary")>=0?(f=n.properties.textFormat,n.properties.totalize&&(n.properties.textFormat=n.properties.totalize.format),u=n.renderSummary(i,r),n.properties.textFormat=f):u=n.renderReadOnly(i,r),u},onCellReady:function(n,t,i,r){var e=this,h=n.index-1,u=e.columns[h],f=e.cellMetadata[t][h].properties||u.originalProperties,v=f.visible!==undefined?f.visible:!0,o=f.editable!==undefined?f.editable:!0,c,l,a,s;typeof t=="string"&&t.indexOf("summary")>=0&&(o=!1);r&&(o=!0);v&&(c=f.columnAlign?f.columnAlign:"center",l=f.columntitlealign?f.columntitlealign:"center",e.changeTitleAligningClass(n.index,l),e.changeAligningClass(i,c),o?(a=u.properties.editable,u.properties.editable=o,u.properties.submitOnChange&&(s=u.getDecorated(t),s&&(s.properties.submitOnChangexpathContext=e.properties.xpath+"[]")),u.postRender(t,i),u.properties.editable=a):typeof t=="string"&&t.indexOf("summary")>=0?u.postRenderSummary(t,i)||e.applySummaryColumnStyles(i,f):u.postRenderReadOnly(t,i))},convertProperties:function(n){return n.inlineAdd=!1,n.inlineEdit=!1,n},applyGridPlugin:function(){var n=this,r=n.grid,t=n.properties,i=n.getMode(),u=n.renderFactory.getTemplate("bizagi.grid.pagination");r.bizagi_grid_grouped_desktop({columns:n.buildColumnModel(),showSummary:t.showSummary,title:t.displayName,mode:n.getMode(),tableCssClass:"",sortBy:t.sortBy||"",sortOrder:t.sortOrder||"",smartPagination:!0,collapse:i!=="execution"?!1:!0,collapseState:i!=="execution"?!1:n.collapseState,buttonsPst:i!=="execution"?!1:t.buttonsPst,sortType:bizagi.override.gridDefaultSortBy||"asc",headerStyles:n.getHeaderStyles(),groupByColumns:n.groupByColumns()||[],template:{grid:n.renderFactory.getTemplate("bizagi.grid.grid"),waiting:n.renderFactory.getTemplate("bizagi.grid.waiting"),table:n.renderFactory.getTemplate("bizagi.grid.grouped.table"),emptyTable:n.renderFactory.getTemplate("bizagi.grid.table.empty"),column:n.renderFactory.getTemplate("bizagi.grid.grouped.column"),specialColumn:n.renderFactory.getTemplate("bizagi.grid.column.special"),row:n.renderFactory.getTemplate("bizagi.grid.grouped.row"),headerRow:n.renderFactory.getTemplate("bizagi.grid.grouped.header.row"),rowButtons:n.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:n.renderFactory.getTemplate("bizagi.grid.cell"),emptyCell:n.renderFactory.getTemplate("bizagi.grid.grouped.emptyCell"),specialCell:n.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:u,buttons:n.renderFactory.getTemplate("bizagi.grid.buttons"),dynamicPager:n.renderFactory.getTemplate("bizagi.grid.dynamicpager"),summary:n.renderFactory.getTemplate("bizagi.grid.grouped.summary"),summaryCell:n.renderFactory.getTemplate("bizagi.grid.grouped.summaryCell"),exportOptions:n.renderFactory.getTemplate("bizagi.grid.exportOptions")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&t.data!=null,remove:t.allowDelete,details:t.allowDetail,inlineAdd:t.inlineAdd,allowMore:t.allowMore,enableXlsExport:t.enableXlsExport,enablePdfExport:t.enablePdfExport},tooltips:{addLabel:t.addLabel,editLabel:t.editLabel,deleteLabel:t.deleteLabel,detailLabel:t.detailLabel,exportOptionsLabel:t.exportOptionsLabel},isValid:function(){var t=[],r=n.getFormContainer(),i;if(r.validationController!==undefined&&r.validationController.clearValidationMessages(),n.isValid(t),t.length>0){for(i=0;i<t.length;i++)r.validationController.showValidationMessage(t[i].message,t[i].xpath);return!1}return!0},pageRequested:function(t){if(i=="execution"){var r,u=n.getColumn(t.sortBy);u?r=u.getSortName():(u=n.getColumn(t.sortBy.split(".")[0]),u&&(r=u.getSortName()));t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==r&&(r=t.sortBy);n.fetchData(t.page,r,t.sortType)}},sortRequested:function(t){if(i=="execution"){var r,u=n.getColumn(t.sortBy);u?r=u.getSortName():(u=n.getColumn(t.sortBy.split(".")[0]),u&&(r=u.getSortName()));t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==r&&(r=t.sortBy);n.fetchData(t.page,r,t.sortType)}},drawCell:function(t){return n.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return n.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){i=="execution"&&n.triggerHandler("rowSelected",{id:t.key})},addRow:function(){i=="execution"&&n.addRow()},editRow:function(t){i=="execution"&&n.properties.withEditForm&&n.editRow(t.key)},deleteRow:function(t){i=="execution"&&n.deleteRow(t.key)},moreRows:function(t){i=="execution"&&n.moreRows(t)},saveAddedRows:function(t){n.saveInlineAddedRows(t.keys)},beforeInlineAdd:function(){n.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){n.inlineAddDeferred&&n.inlineAddDeferred.resolve()},showFormDetails:function(t){n.showFormDetails(t.key)},cancelEdition:function(t){n.removeNewRecords(t)},removeNewRecords:function(t){n.removeNewRecords(t)},showGridExportOptions:function(){n.showGridExportOptions()},performExportGrid:function(t){n.performExportGrid(t)},performCollapseGrid:function(){n.performCollapseGrid()}})},groupByColumns:function(){for(var r,t=this,i=[],n=0,u=t.columns.length;n<u;n++)r=t.columns[n],r.properties.groupBy&&i.push(n+1);return i},triggerGridPluginHandler:function(){var n=this,t=Array.prototype.slice.call(arguments,0);return n.grid.bizagi_grid_grouped_desktop.apply(n.grid,t)},fetchData:function(n,t,i){var r=this,u=r.properties;r.dataReadyDeferred=new $.Deferred;n=n||u.page||1;t=t||u.sortBy||"id";i=i||u.sortOrder||"asc";u.page=n;u.sortBy=t;u.sortType=i;u.sort=t+" "+i;r.startLoading();$.when(r.getRemoteData()).then(function(n){(r.endLoading(),r.disposed)||n&&(r.loadChanges(n.rows),r.updateData(n),r.triggerRenderChange(),r.dataReadyDeferred.resolve())})}});
bizagi.rendering.search.extend("bizagi.rendering.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,CLEAR_SEARCH_ID:-3,NO_RESULTS_SEARCH_ID:-4,SEARCH_DELAY:750},{initializeData:function(n){var r=this,t,i;this._super(n);t=this.properties;t.searchImage=t.searchImage||this.dataService.getSearchDefaultImage();i=null},postRender:function(){var n=this,t=n.getControl();this._super();n.searchInput=$("input",t);n.advancedSearch=$("button",t);n.isOffline=typeof bizagi.context.isOfflineForm!="undefined"&&bizagi.context.isOfflineForm;n.isOffline?(n.properties.submitOnChange=!1,$(".ui-bizagi-render-icon-search",t).hide()):n.properties.advancedSearch?t.addClass("ui-bizagi-advanced-search"):$(t).find("input").css({width:"100%","padding-right":"25px"});n.applyAutocompletePlugin()},postRenderReadOnly:function(){var n=this,t=this.properties;n.setDisplayValue(t.value)},configureHandlers:function(){var n=this,t;n._super();t=n.searchInput;t.bind("autocompleteselect",function(i,r){if(r.item.id==n.Class.ADVANCED_SEARCH_ID||r.item.id==n.Class.ADVANCED_ADDITION_ID||r.item.id==n.Class.CLEAR_SEARCH_ID||r.item.id==n.Class.NO_RESULTS_SEARCH_ID)return!1;if(n.isOffline&&(r.item.label=r.item.label.replace(/<\/?[^>]+(>|$)/g,"")),n.setValue(r.item),n.selectedValue=r.item.value,document.selection){t.focus();var u=document.selection.createRange();u.moveStart("character",-n.selectedValue.length);u.moveStart("character",0);u.moveEnd("character",n.selectedValue.length);u.select()}return!0});n.bind("onSearchError",function(t,i){var r=n.getFormContainer(),u;r.clearValidationMessages();try{u=n.properties.displayName+": ";u+=JSON.parse(i.responseText).message;r.addValidationMessage(u,"","ui-icon-alert")}catch(t){r.addValidationMessage(i)}n.hideAutocompleteLoading()});!n.properties.advancedSearch;t.click(function(){if(t.autocomplete("widget").is(":visible")){t.autocomplete("close");return}t.autocomplete("search",$(t).val())});n.advancedSearch.click(function(){n.showSearchDialog()})},applyAutocompletePlugin:function(){var n=this,t=n.searchInput,i=n.getFormContainer().properties.orientation,r=i=="rtl"?"right":"left",u=i=="rtl"?" suggest-rtl":"";t.autocomplete({autoFocus:!0,messages:{noResults:null,results:function(){}},search:function(){},source:function(t,i){var f;n.activeRequestTerm=t.term;var e=(new Date).getTime(),r=encodeURIComponent(t.term),o=n.properties.xpath+"_"+r+"_expire",s=n.properties.xpath+"_"+r,u=bizagi.util.getItemLocalStorage(o);if(u&&n.properties.enableLocalStorage&&e<u)try{f=JSON.parse(bizagi.util.getItemLocalStorage(s));i(f);n.hideAutocompleteLoading()}catch(h){n.processRequest(t,i)}else n.processRequest(t,i)},open:function(){var i=t.data("ui-autocomplete").menu.element,f=t.closest(".ui-bizagi-control"),o=f.parent(),e=n.calculateSuggestionWidth(),s=t.data("ui-autocomplete").menu;$("li",i).each(function(){$(this).addClass(u);$(this).index()%2<1&&$(this).addClass("biz-ui-even")});i.css({top:0,left:0});f.addClass("ac-is-visible");o.addClass("ac-is-visible ac-clear-floats");i.appendTo(f).position({my:r+" top",at:r+" bottom",of:this,collision:"flipfit"});i.css("z-index",$.getMaxZindex()+10);i.attr("visible",!0);$(".ui-bizagi-render-search-item",i).width(e);i.width(e);n.hideAutocompleteLoading()},close:function(){t.data("ui-autocomplete").menu.element.attr("visible",!1)},delay:this.Class.SEARCH_DELAY});t.data("ui-autocomplete")._renderItem=function(t,i){return i.id==n.Class.CLEAR_SEARCH_ID?n.renderClearItem(t,i).appendTo(t):i.id==n.Class.ADVANCED_SEARCH_ID?n.renderAdvancedItem(t,i).appendTo(t):i.id==n.Class.ADVANCED_ADDITION_ID?n.renderAddItem(t,i).appendTo(t):n.renderSearchItem(i).appendTo(t)}},renderSearchItem:function(n){var t=this,r=t.properties,u=t.renderFactory.getTemplate("searchItem"),i=$.tmpl(u,{image:r.searchImage,label:n.label,orientation:t.properties.orientation||"lrt"});return i.data("item.autocomplete",n),i},renderAdvancedItem:function(){var n=this,t=n.renderSearchItem({id:n.Class.ADVANCED_SEARCH_ID,label:this.getResource("render-search-advanced-label")});return t.click(function(){n.showSearchDialog()}),t},renderClearItem:function(){var n=this,t=n.renderSearchItem({id:n.Class.CLEAR_SEARCH_ID,label:this.getResource("render-search-clear-label")});return t.click(function(){n.setValue({id:""});n.readyActionExecution().done(function(){n.properties.submitOnChange||n.submitData()})}),t},renderAddItem:function(){var n=this,t=n.renderSearchItem({id:n.Class.ADVANCED_ADDITION_ID,label:this.getResource("render-search-add-label")});return t.click(function(){}),t},processRequest:function(n,t){function e(n,u){var e,f,o,s;r.allowClear&&i.value!==undefined&&n.push({id:i.Class.CLEAR_SEARCH_ID,label:"",value:""});r.advancedSearch&&n.push({id:i.Class.ADVANCED_SEARCH_ID,label:"",value:""});r.allowAdd&&n.push({id:i.Class.ADVANCED_ADDITION_ID,label:"",value:""});e=(new Date).getTime()+i.properties.expireCache;f=encodeURIComponent(u);i.properties.enableLocalStorage&&(o=i.properties.xpath+"_"+f+"_expire",s=i.properties.xpath+"_"+f,bizagi.util.setItemLocalStorage(o,e),bizagi.util.setItemLocalStorage(s,JSON.encode(n)));t(n)}var i=this,r=i.properties,u=[],f;i.properties.allowSuggest&&n.term.length>=i.properties.searchLength?(i.showAutocompleteLoading(),r.term=n.term,i.isOffline?(f=i.properties.data,f&&f.length>0?$.each(f,function(n,t){var i,f;switch(typeof t.value){case"number":i=t.value;break;case"object":i=t.value.toString();break;case"string":i=t.value;break;default:i=t.value}f=i!==undefined&&i.toLowerCase().indexOf(r.term.toLowerCase())!==-1;f&&u.push({id:t.id!==undefined?t.id:"",label:i!==undefined?i.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(r.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1<\/strong>"):"",value:i!==undefined?t.value:""})}):u.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-grid-no-records"),value:""}),e(u),i.hideAutocompleteLoading()):(this.deferredReference&&typeof this.deferredReference.reject=="function"&&this.deferredReference.state()!=="resolved"&&this.deferredReference.reject({hideStatus:!0}),i.deferredReference=this.getData().done(function(t){t&&t.length>0?(t=t.slice(0,r.maxRecords),t.length>50?(t=t.slice(0,50),u.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-search-maximum-records-allowed"),value:""})):t=t.slice(0,r.maxRecords),$.each(t,function(t,i){if(r.maxRecords==0||t<r.maxRecords){var f;switch(typeof i.value){case"number":f=i.value;break;case"object":f=i.value.toString();break;case"string":f=i.value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(n.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1<\/strong>");break;default:f=i.value}u.push({id:i.id,label:f,value:i.value})}})):u.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-grid-no-records"),value:""});e(u,n.term);i.hideAutocompleteLoading()}))):e(u,n.term)},calculateSuggestionWidth:function(){var n=this,t=n.searchInput.data("ui-autocomplete").menu.element;return t.width()},setDisplayValue:function(n){var i=this,u=i.properties,t="",r;n!=undefined&&n!=null&&(u.editable?typeof n.value!="undefined"&&n.value?i.searchInput.val(n.value):n.additionallabel&&n.label?(t=n.label+","+n.additionallabel,i.searchInput.val(t)):typeof n.label!="undefined"?i.searchInput.val(n.label):typeof n.id!="undefined"?i.searchInput.val(n.id):i.searchInput.val(n):(r=i.getControl(),t=n.label,typeof t=="string"?(t=t.replaceAll("&","&amp;"),t=t.replaceAll("<","&lt;").replaceAll(">","&gt;"),t=t.replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")):typeof t=="undefined"&&(t=""),r.html(t)))},getDisplayValue:function(){return this.selectedValue},showAddRecordDialog:function(){var n=this,t=n.properties,i={text:bizagi.localization.getResource("render-form-dialog-box-add"),click:function(){var i=new bizagi.rendering.dialog.form(n.dataService,n.renderFactory,{showSaveButton:t.editable,title:bizagi.localization.getResource("render-dialog-entity"),orientation:n.properties.orientation||"ltr",onSave:function(r){var e=r.idPageCache,u=$.Deferred(),o={action:"SAVE",data:r,idPageCache:e,guidEntity:t.entity,contexttype:"entity"},f={};return $.forceCollectData=!0,i.form.collectRenderValues(f),$.forceCollectData=!1,bizagi.util.isMapEmpty(f)?(bizagi.showMessageBox(n.getResource("render-search-advanced-no-filters"),"","error"),u.resolve()):$.when(n.dataService.submitData(o)).done(function(){function s(t){var i=n.searchDialog.currentSearchForm.getRender(t);return typeof i=="object"&&i!=null?{found:!0,obj:i}:{found:!1,obj:{}}}var e,o;for(e in f)o=s(e),o.found&&(o.obj.setValue(f[e]),n.setDisplayValueToControl(o.obj,i.form,e,f));n.searchDialog.currentSearchForm.performSearch({allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords});u.resolve(r);i.closeDialogBox()}).fail(function(n,t,i){t=="parsererror"?u.resolve({type:"error",message:i.message}):u.reject(arguments)}),u.promise()},close:function(){i.dialog("destroy");i.remove()}});i.render({idRender:t.id,idPageCache:t.idPageCache,requestedForm:"addForm",guidEntity:t.entity,contextType:"entity"}).fail(function(){})}};return{buttons:i}},setDisplayValueToControl:function(n,t,i,r){n.properties.type==="searchSuggest"?n.setDisplayValue(t.getRender(i).getDisplayValue()):n.setDisplayValue(r[i])},showSearchDialog:function(){var t=this,n=t.properties,i,r=n.searchForms.length>0&&n.searchForms[0].type=="searchForm"?"metadata":"entity";n.allowNew&&(i=t.showAddRecordDialog());t.searchDialog=new bizagi.rendering.dialog.search(t.dataService,t.renderFactory,n.searchForms,{allowFullSearch:n.allowFullSearch,maxRecords:n.maxRecords,orientation:n.orientation||"ltr"},i);t.searchDialog.render({idRender:n.id,xpath:n.xpath,xpathContext:n.xpathContext,idPageCache:n.idPageCache,contexttype:r,orientation:n.orientation||"ltr"}).done(function(n){t.setValue(n);t.readyActionExecution().done(function(){t.properties.submitOnChange||t.submitData()})})},showAutocompleteLoading:function(){var n=this,t=n.getControl();$("i",t).addClass("ui-autocomplete-loading")},hideAutocompleteLoading:function(){var n=this,t=n.getControl();$("i",t).removeClass("ui-autocomplete-loading")},cleanData:function(){var n=this,i=n.getControl(),t={id:""};n.setDisplayValue(t);n.setValue(t,!1);n.properties.editable||$(i).html("<label class='readonly-control'><\/label>")}});
bizagi.rendering.letter.extend("bizagi.rendering.letter",{},{postRender:function(){var n=this,t=n.getControl(),i=$(":button",t);i.button()},configureHandlers:function(){var n=this,t=n.getControl(),i=$(":button",t);n._super();i.click(function(){$.when(n.saveForm()).done(function(){n.showLetterDialog()})})},postRenderReadOnly:function(){},configureHandlersReadOnly:function(){var n=this,i=n.getControl(),t=n.properties,r=n.dataService.getLetterNotEditableUrl({idRender:t.id,xpath:n.getXpath(),xpathContext:n.getContextXpath(),idPageCache:t.idPageCache});$(".ui-bizagi-render-letter-readonly",i).click(function(){$.when(n.saveForm()).done(function(){$.when(n.getCanGenerateLetter()).done(function(n){n&&bizagi.util.parseBoolean(n.canGenerate)?window.open(r):bizagi.showMessageBox(bizagi.localization.getResource("render-letter-not-generated"))})})})},showLetterDialog:function(){var n=this,t=new bizagi.rendering.dialog.letter(n.dataService,n.renderFactory);$.when(n.getCanGenerateLetter()).done(function(i){i&&bizagi.util.parseBoolean(i.canGenerate)?$.when(n.getLetterContent()).pipe(function(n){return t.render(n)}).done(function(t){n.saveLetterContent(t)}):bizagi.showMessageBox(bizagi.localization.getResource("render-letter-not-generated"))})}});
bizagi.rendering.button.extend("bizagi.rendering.button",{},{postRender:function(){var t=this,n=t.getControl(),i=$(":button",n);i.button();typeof Windows!="undefined"?$(n.find("input")).addClass("ui-button-windows8"):($(n.find("input")).addClass("ui-button-desktop-ellipsis"),$(n.find("input")).attr("title",$(n.find("input")).val()))},configureHandlers:function(){var n=this,t=n.getControl(),i=$(":button",t);n._super();i.on("click",function(){$("input",n.element).attr("disabled",!0);n.processButton();setTimeout(function(){$("input",n.element).removeAttr("disabled")},1500)})},postRenderReadOnly:function(){var n=this,i=n.getControl(),t;n.postRender();t=$(":button",i);t.button("option","disabled","true")},processButton:function(){var t=this,n=t.properties,r,i;n.editable&&(n.needsUserConfirmation?(r=$("<div>").append(n.userConfirmationMessage),i=$.Deferred(),$(r).dialog({modal:!0,width:500,height:250,draggable:!1,resizable:!0,maximize:!1,title:n.caption||n.displayName,buttons:[{text:bizagi.localization.getResource("confirmation-box-ok"),click:function(){i.resolve();t.triggerRenderChange({pressed:!0});$(this).dialog("close")}},{text:bizagi.localization.getResource("confirmation-box-cancel"),click:function(){i.reject();$(this).dialog("close")}}]}),n.preventDefault||$.when(i.promise()).done(function(){t.runButtonAction()})):(n.preventDefault||t.runButtonAction(),t.triggerRenderChange({pressed:!0})))},runButtonAction:function(){var n=this;n.getFormContainer().clearValidationMessages();n.saveForm().pipe(function(){return n.executeButton()}).done(function(t){if(t==null||t==!0||t.result=="success"||t.type=="success")return n.refreshForm();t.type=="validationMessages"&&n.getFormContainer().addValidationMessage(t.messages)}).fail(function(t,i,r){n.getFormContainer().addErrorMessage(r)})}});
bizagi.rendering.fileprint.extend("bizagi.rendering.fileprint",{},{postRender:function(){var n=this,t=n.getControl(),i=$(":button",t);i.button()},configureHandlers:function(){var n=this,t=n.getControl(),i=$(":button",t);n._super();i.click(function(){n.processButton()})},postRenderReadOnly:function(){var n=this,i=n.getControl(),t;n.postRender();t=$(":button",i);t.button("option","disabled","true")},processButton:function(){var n=this,t=n.properties;t.editable&&n.runButtonAction()},getAbsoluteFilePrintUrl:function(n){var r=this,i=(new Date).getTime(),t=r.getFilePrintUrl(n);return t.indexOf("http")!=-1?t+"&_="+i:(t=t.replace(bizagi.services.ajax.pathToBase,""),bizagi.loader.basePath+t+"&_="+i)},runButtonAction:function(){var n=this,t,u,f,i,r,s;if(n.getFormContainer().clearValidationMessages(),t=n.getControl(),u=$(".fileobj"),!bizagi.util.isIE()||bizagi.util.isIE10()||bizagi.util.isIE11())if($.browser.mozilla)s=window.open(n.getAbsoluteFilePrintUrl("attachment"));else{$("iframe",t).remove();var h="bz-render-fileprint-iframe-"+(new Date).getTime(),l=n.renderFactory.getTemplate("fileprint-iframe"),a=$.tmpl(l,{url:n.getAbsoluteFilePrintUrl("inline"),id:h});t.append(a);r=document.getElementById(h).contentWindow;typeof r.print=="undefined"||bizagi.util.isIE()?s=window.open(n.getAbsoluteFilePrintUrl("attachment")):r.print()}else if(f=n.checkAdobePlugin(),f){var e="",v=n.properties.id,o=0,c=bizagi.localization.getResource("webpart-render-loading");u.remove();e=n.renderFactory.getTemplate("fileprint-object");t.append("<label id='loadingMsg'> "+c+"<\/label>");t.append($.tmpl(e,{url:n.getAbsoluteFilePrintUrl("inline")}));i=setInterval(function(){if(document.all.fileobj&&document.all.fileobj.readyState>0){if($("#loadingMsg").remove(),$(".fileobj:last",t).focus(),typeof $(".fileobj:last",t)[0].print!="undefined")$(".fileobj:last",t)[0].print();else var r=window.open(n.getAbsoluteFilePrintUrl("attachment"));window.clearInterval(i)}else o>=10&&($("#loadingMsg").remove(),$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-print-too-slow"))).done(function(){var t=window.open(n.getAbsoluteFilePrintUrl("inline"));t.onload=function(){if(typeof t.print!="undefined")t.print(),t.close();else var i=window.open(n.getAbsoluteFilePrintUrl("attachment"))}}),n.saveForm(),window.clearInterval(i));o+=1},1e3)}else $.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-acrobat-message"))).done(function(){var t=window.open(n.getAbsoluteFilePrintUrl("inline"))})},checkAdobePlugin:function(){var n;try{n=new ActiveXObject("AcroPDF.PDF")}catch(t){bizagi.log(t)}if(!n)try{n=new ActiveXObject("PDF.PdfCtrl")}catch(t){bizagi.log(t)}return n}});
bizagi.rendering.link.extend("bizagi.rendering.link",{},{postRender:function(){},configureHandlers:function(){var n=this,r=n.getControl(),t=n.properties,i=$(".ui-bizagi-render-link",r);n._super();t.value?(i.attr("href",t.value),i.attr("target","_blank"),i.click(function(){return n.linkSolver({linkType:t.linktarget,url:t.value}),!1})):i.addClass("ui-state-disabled")},linkSolver:function(n){var u,f;n=n||{};var i=this,t=n.url||"",r=n.target||"_blank";t&&t.indexOf("http")===-1&&t.indexOf("\\\\")===-1&&(t="//"+bizagi.util.trim(t));switch(n.linkType){case"newwindow":u="width=%s,height=%s,resizable,scrollbars=yes,status=1,toolbar=yes";f=printf(u,window.screen.width,window.screen.height);i.windowObjReference=window.open(t,r,f);break;case"newtab":i.windowObjReference=window.open(t,r);break;default:i.windowObjReference=window.open(t,r)}},postRenderReadOnly:function(){var n=this;n.postRender();n.configureHandlers()}});
bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutRender",{},{});
bizagi.rendering.layoutImage.extend("bizagi.rendering.layoutImage",{},{getImageUri:function(){var n=this,t={entity:n.value.guid,surrogateKey:n.value.surrogateKey,xpath:n.properties.xpath,width:96,height:96,hash:n.value.value};return n.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(t)}});
bizagi.rendering.layoutLink.extend("bizagi.rendering.layoutLink",{},{postRender:function(){var n=this,t=n.element;if(n._super(),t)$(t).on("click",$.proxy(n.onClickElement,n))},onClickElement:function(){var t=this,n=t.properties||{},i={displayName:n.displayName,reference:n.reference,referenceType:n.referenceType,xpath:n.xpath,contextEvent:t.getFormContainer().getContextEvent()};t.triggerGlobalHandler("DATA-NAVIGATION",i)}});
bizagi.rendering.layoutLabel.extend("bizagi.rendering.layoutLabel",{},{setValue:function(n,t){var r=this,i;r.properties.displayName=n;this._super(n,t);i=r.getControl();i&&$(".ui-bizagi-render-label",i).text(n)}});
bizagi.rendering.layoutText.extend("bizagi.rendering.layoutText",{},{});
bizagi.rendering.layoutDateTime.extend("bizagi.rendering.layoutDateTime",{},{});
bizagi.rendering.layoutNumber.extend("bizagi.rendering.layoutNumber",{},{setValue:function(n,t){var i=this,r=i.getControl();i.getMode()==="execution"&&(n=n===null||n===""?"":i.getDisplayValue(n));i.properties.displayName=n;this._super(n,t);r&&$(".ui-bizagi-render-number",r).text(n)}});
bizagi.rendering.layoutMoney.extend("bizagi.rendering.layoutMoney",{},{setValue:function(n,t){var i=this,r=i.getControl();i.getMode()==="execution"&&(n=n===null||n===""?"":i.getDisplayValue(n));i.properties.displayName=n;this._super(n,t);r&&$(".ui-bizagi-render-number",r).text(n)}});
bizagi.rendering.layoutUpload.extend("bizagi.rendering.layoutUpload",{},{renderControl:function(){var n=this,i=n.properties,t=$.Deferred(),r=n.getMode();return r==="execution"?$.when(n.getValueFilesByData(bizagi.clone(i))).done(function(i,r){n.properties=i;n.files=r.files;t.resolve(n.getHTMLFiles(i))}):(n.files=[],t.resolve(n.getHTMLFiles())),t.promise()},getHTMLFiles:function(){var n=this,t,r;n.filesCount=n.files.length;var u=n.renderFactory.getTemplate("layout-upload"),f=$.fasttmpl(u,{xpath:bizagi.util.encodeXpath(n.getUploadXpath()),noFiles:n.filesCount==0}),i="";for(t=0;t<n.filesCount;t++)r={id:n.files[t][0],fileName:n.files[t][1]},i+=n.renderUploadItem(r);return n.replaceFilesHtml(f,i)},replaceFilesHtml:function(n,t){return n.replace("{{files}}",t)},renderUploadItem:function(n){var t=this,i=t.properties,r=t.getMode(),f=t.renderFactory.getTemplate("layout-uploadItem"),u=t.buildItemUrl(n);return r!="execution"&&(u="javascript:void(0);"),$.fasttmpl(f,{url:u,allowDelete:i.allowDelete,filename:n.fileName,id:n.id,mode:r,editable:i.editable})},buildItemUrl:function(n){var t=this,r=t.properties,i=t.getFormContainer();return t.dataService.getUploadFileEntityUrl({isContextContainerWidgetRender:t.isContextContainerWidgetRender(),xpath:t.getUploadXpath(),fileId:n.id,idRender:i.properties.paramsRender.idRender||"undefined",xpathContext:r.xpathContext,idPageCache:i.properties.paramsRender.idPageCache||"undefined",xpathActions:i.properties.paramsRender.xpathActions||"undefined",sessionId:i.properties.sessionId,surrogatekey:t.properties.value.surrogateKey,guidentity:t.properties.value.guid})}});
bizagi.rendering.formLink.extend("bizagi.rendering.formLink",{},{configureHandlers:function(){var n=this,t=n.getControl(),i=$(".ui-bizagi-render-link",t),r=n.properties;n._super();n.dialog=null;i.click(function(){if(r.hasentryrule){var t=n.getFormContainer();$.when(t.saveForm()).done(function(){n.submitCheckpointRequest();n.openLinkRule("entryrule")})}else n.openLink()})},openLinkRule:function(n){var t=this,i=new $.Deferred,r=t.getFormContainer();return t.getPropertyValue(n,{}).done(function(r){if(r.messages!=null){var u=r.messages[0],f=t.getFormContainer();f.validationController.showErrorMessage(u);i.reject()}else n=="entryrule"&&t.openLink();i.resolve()}).fail(function(){i.reject()}),i.promise()},getPropertyValue:function(n,t){var r=this,i=r.properties,u=new $.Deferred;return r.dataService.multiaction().getPropertyData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,property:n,extra:t,dataType:t?t.dataType:null}).done(function(n){n.type=="error"?(r.getFormContainer().addErrorMessage(n.message),u.reject(n)):u.resolve(n)}).fail(function(n,t,i){r.getFormContainer().addErrorMessage(n.message);u.reject(n,t,i)}),u.promise()},postRenderReadOnly:function(){var n=this,t=n.getMode();t=="execution"&&n.configureHandlers()},submitSaveRequest:function(n){var r=this,t=r.properties,i;return t.editable==!1&&!t.value?null:(i=r.getFormLinkXpath(),r.dataService.saveLinkForm({url:t.saveUrl,idRender:t.id,xpathContext:t.xpathContext==undefined||t.xpathContext==""?i:i?t.xpathContext+"."+i:t.xpathContext,submitData:n}))},closeExitRule:function(){var t=this,i=t.properties,n=new $.Deferred;return i.hasexitrule?$.when(t.openLinkRule("exitrule")).done(function(t){n.resolve(t)}).fail(function(){n.reject()}):n.resolve(),n.promise()},openLink:function(){var n=this,t=n.properties,i;typeof t.canBeSaved=="undefined"&&(t.canBeSaved=!0);i=n.getFormContainer();t.editable===!1&&(t.canBeSaved=!1);i.properties.displayAsReadOnly&&(t.canBeSaved=!1);$.when(n.getFormContainer().properties.editable?i.submitData():undefined).done(function(){$.when(n.submitEditRequest()).done(function(){n.dialog=new bizagi.rendering.dialog.form(n.dataService,n.renderFactory,{showSaveButton:t.canBeSaved,maximized:t.maximized,title:t.displayName,orientation:t.orientation||"ltr",onSave:function(i){var r=new $.Deferred;return n.submitSaveRequest(i,r.promise()).done(function(i){var u=!0;i&&i.type=="validationMessages"&&(u=!1);t.hasexitrule?n.closeExitRule().done(function(){u&&(r.resolve(i),n.submitCommitRequest(),n.submitOnChange({}),t.hasentryrule&&n.submitCommitRequest())}).fail(function(){r.reject()}):u&&u&&(r.resolve(i),n.submitCommitRequest(),n.submitOnChange({}),t.hasentryrule&&n.submitCommitRequest())}),r.promise()},close:function(){}});n.renderFormLinkDialog()})})},renderFormLinkDialog:function(){var n=this,t=n.properties;n.dialog.render({idRender:t.id,xpathContext:n.getFormLinkXpathContext(),idPageCache:t.idPageCache,recordXPath:n.getFormLinkXpath(),requestedForm:"linkform",editable:t.editable,url:t.editPage}).fail(function(){n.submitRollbackRequest();t.hasentryrule&&n.submitRollbackRequest()})},getFormLinkXpathContext:function(){var i=this,n=i.properties.xpathContext,t=i.getXpathContext();return t&&n?n.indexOf(t)===0?n:t+"."+n:n}});
bizagi.rendering.geolocation.extend("bizagi.rendering.geolocation",{},{renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.postRender()},postRender:function(){var n=this,t;this._super();t=n.getControl();n.cordinate=$(".ui-geolocation-cordinate",t)},isValid:function(n){var t=this;return t._super(n)},configureHandlers:function(){var n=this,t;n.getMode()==="execution"&&(t=n.getControl(),n.value==null&&n.setDisplayValue().then(function(){}).fail(function(t){n.cordinate.html("<span style='color: red'>"+t+"<\/span>")}),$(".ui-bizagi-render-geolocation",t).bind("click",function(){n.cordinate.empty();n.setDisplayValue().then(function(){}).fail(function(t){n.cordinate.html("<span style='color: red'>"+t+"<\/span>")})}))},setDisplayValue:function(n){var t=this,i=new $.Deferred;return n!=null&&n!=""?(t.cordinate.html(n),t.setValue(n,!1),i.resolve()):t.getCurrentPosition(function(n){t.cordinate.html(n.coords.latitude.toString()+" "+n.coords.longitude.toString());t.setValue(n.coords.latitude.toString()+" "+n.coords.longitude.toString(),!1);i.resolve()},function(n){t.cordinate.html(t.properties.value);i.reject(n)}),i.promise()}});
bizagi.rendering.hidden.extend("bizagi.rendering.hidden",{},{});
bizagi.rendering.money.extend("bizagi.rendering.money",{},{setDisplayValue:function(n){var t=this,i=t.properties;this._super(n);n!==undefined&&n!==null&&i.editable&&(t.numericInput.val(n),t.executeFormatCurrencyPlugin())}});
bizagi.rendering.money.extend("bizagi.rendering.queryMoney",{},{postRender:function(){var n=this,t,i;n._super();t=n.getControl();i=n.properties;n.numericInput=t.find("input");n.numericInput.numeric(n.properties.decimalSymbol);n.attachFormatCurrency();i.retype=="double"&&n.attachRetypeDouble()},attachFormatCurrency:function(){var t=this,n=t.properties;n.showSymbol&&n.symbol==""&&typeof bizagi!="undefined"&&n.dataType==8&&typeof bizagi.currentUser!="undefined"&&typeof bizagi.currentUser.symbol!="undefined"&&(n.symbol=bizagi.currentUser.symbol);this._super()}});
bizagi.rendering.radio.extend("bizagi.rendering.radio",{},{postRender:function(){var n=this,t=n.getControl();this._super();t.addClass("ui-bizagi-render-display-block");t.addClass("ui-bizagi-render-boolean-yesno");n.properties.unique=Math.ceil(Math.random()*1e3);n.radiogroup=$(".ui-bizagi-render-radio",t);n.radiogroup.optiongroup({orientation:n.properties.orientation});n.selectedValue&&n.radiogroup.optiongroup("setValue",n.selectedValue)},configureHandlers:function(){var n=this;n._super();n.radiogroup.bind("optiongroupchange",function(t,i){n.onOptionGroupChange(i)})},onOptionGroupChange:function(n){var t=this,i={id:n.value,value:n.text};t.selectedValue=i.value;t.setValue(i)},configureDesignView:function(){var n=this,t=n.getControl();t.find("input").unbind("click")},setDisplayValue:function(n){var t=this,i=t.properties;i.editable&&n!==undefined&&n.id!=""&&t.radiogroup.optiongroup("setValue",n.id||n.value)},clearDisplayValue:function(){var n=this,t=n.getControl();n.radiogroup?$.data(n.radiogroup[0])["ui-optiongroup"]?n.radiogroup.optiongroup("setValue",0):$(t).html("<label class='readonly-control'><\/label>"):n.properties.editable||$(t).html("<label class='readonly-control'><\/label>")},getSelectedValue:function(){var n=this;return n.selectedValue}});
bizagi.rendering.radio.extend("bizagi.rendering.queryRadio",{},{postRender:function(){var n=this,t=n.getControl();this._super();t.removeClass("ui-bizagi-render-boolean-yesno")}});
bizagi.rendering.radio.extend("bizagi.rendering.queryState",{},{initializeData:function(n){var i=this,r=typeof n.properties.horizontal!="undefined"?bizagi.util.parseBoolean(n.properties.horizontal):!0,t;this._super(n);t=this.properties;t.horizontal=r;typeof t.defaultValue=="undefined"&&t.value===null&&i.setValue({id:"0"},!1)},getValue:function(){return this.value&&this.value.id&&!isNaN(this.value.id)?{id:parseInt(this.value.id),value:this.value.value}:this.value},setDisplayValue:function(n){n.id=n.id+"";this._super(n)}});
bizagi.rendering.radio.extend("bizagi.rendering.queryCaseState",{},{initializeData:function(n){var i=this,r=typeof n.properties.horizontal!="undefined"?bizagi.util.parseBoolean(n.properties.horizontal):!0,t;this._super(n);t=this.properties;t.horizontal=r;typeof t.defaultValue=="undefined"&&t.value===null&&i.setValue({id:"0"},!1)},getValue:function(){return this.value&&this.value.id&&!isNaN(this.value.id)?{id:parseInt(this.value.id),value:this.value.value}:this.value},setDisplayValue:function(n){n.id=n.id+"";this._super(n)}});
bizagi.rendering.panel.extend("bizagi.rendering.queryGrid",{},{initializeData:function(n){var i=this,t;console.log("sucede initializeData queryGrid");i._super(n);t=i.properties;t.uniqueId=Math.ceil(Math.random()*1e6);t.editable=typeof t.editable!="undefined"?bizagi.util.parseBoolean(t.editable):!0;t.visible=typeof t.visible!="undefined"?bizagi.util.parseBoolean(t.visible):!0;t.orientation=t.orientation||(i.parent?i.parent.properties.orientation:"ltr");this.originalProperties=JSON.parse(JSON.encode(t));this.children=[];this.childrenHash={};n.elements&&$.each(n.elements,function(n,t){t.render.properties.xpath=i.properties.xpath+"."+t.render.properties.xpath;t.render?i.createRenderElement(t):t.container?i.createContainerElement(t):t.form&&i.createFormElement(t)})}});
bizagi.rendering.list.extend("bizagi.rendering.list",{},{postRender:function(){var n=this,t=n.getControl(),i=n.properties,r;if(this._super(),t.addClass("ui-bizagi-render-display-block"),t.addClass("ui-bizagi-render-boolean-yesno"),n.list=$(".ui-bizagi-render-list",t),typeof Windows!="undefined"){n.list.selectable2({closest:!1});$.when(n.ready()).done(function(){var t=n.getControl().find("li[tabindex='0']");t.length>0&&(t=t[0],n.focusSelectedItem(t))});$(".ui-bizagi-render-list li",t).addClass("ui-list-w8");$(".ui-bizagi-render-list li",t).on("click",function(t){if(!t.isPropagationStopped()){var i=this,u=$(i).data("value"),f=$(i).text(),r={id:u,value:f};n.setValue(r);n.selectedValue=r.value;n.focusSelectedItem(i);t.stopPropagation()}})}else n.list.selectable2({closest:!1,select:function(t){if(!t.isPropagationStopped()){var i=$("li[tabindex='0']",this),u=$(i).data("value"),f=$(i).text(),r={id:u,value:f};n.setValue(r);n.selectedValue=r.value;n.focusSelectedItem(i);t.stopPropagation()}}});i.listSize>0&&(r=Number(i.listSize)*23,n.list.height(r+"px"));n.properties.orientation=="rtl"&&$(".ui-bizagi-wrapper-render-list",n.getControl()).addClass("ui-bizagi-rtl")},focusSelectedItem:function(n){var t=this;$.when(t.ready()).done(function(){n.focus(0)})},configureHandlers:function(){var n=this;n._super()},configureDesignView:function(){var n=this,t=n.properties;n._super();t.editable&&(n.list.unbind("mousedown.selectable"),n.list.unbind("focus.selectable"),n.list.unbind("blur.selectable"),n.list.unbind("keydown.selectable"))},setDisplayValue:function(n){var t=this,i=t.properties,r=t.getControl();i.editable&&n!==undefined&&n.id!=""&&t.list.selectable2("select","[id='ui-bizagi-list-"+n.id+"']")},clearDisplayValue:function(){var n=this,t=n.getControl(),i=t.find(".ui-state-active"),r;i.length>0?(r=n.getValue(),n.selectedValue=r.value,i.removeClass("ui-state-focus ui-selected ui-state-active")):n.properties.editable||$(t).html("<label class='readonly-control'><\/label>")},getSelectedValue:function(){var n=this;return n.selectedValue},cleanData:function(){var n=this;n.value=n.properties.value=n.selectedValue={id:"",value:""};n.clearDisplayValue()}});
bizagi.rendering.list.extend("bizagi.rendering.queryList",{},{});
bizagi.rendering.basicUserField.extend("bizagi.rendering.basicUserField",{},{showDialog:function(n,t){var r=this,i=$("<div class='iframeContent'><iframe scrolling='yes' id='innerFrameContent' src='"+n+"' style='width:100%;height:100%;border:0'  /><\/div>"),u=$("#innerFrameContent",i);u.load(function(){u.callInside(function(n){this.BACloseWindow=function(t,i){n.formDialog.dialog("close");n.formDialog.callback(t,i)}},{formDialog:i,container:r});i.callback=function(n,t){$.each(n,function(n,t){t.xpath||bizagi.showMessageBox("Error calling closeWindow, the xpath was not defined.","Userfield error");t.value||bizagi.showMessageBox("Error calling closeWindow, the value was not defined.","Userfield error");r.getFormContainer().getRender(t.xpath).setDisplayValue(t.value)});t&&r.submitOnChange()}});i.dialog({height:t.height,width:t.width,title:t.title})},showPopup:function(n,t){var i=this,r=function(n,t){$.each(n,function(n,t){t.xpath||bizagi.showMessageBox("Error calling closeWindow, the xpath was not defined.","Userfield error");t.value||bizagi.showMessageBox("Error calling closeWindow, the value was not defined.","Userfield error");i.getFormContainer().getRender(t.xpath).setDisplayValue(t.value)});t&&i.submitOnChange()};bizagi.showPopup(n,t,r)}});bizagi.rendering.basicUserField.extend("bizagi.rendering.defaultUserField",{},{getEditableControl:function(){var n=this,t=n.getControl(),i=n.properties,r=i.control;n.input=$("<label>Userfield: "+r+" not found<\/label>").appendTo(t)},collectData:function(){},getDisplayValue:function(){var n=this,t=n.properties,i=t.control;return"Userfield: "+i+" not found"},getReadonlyControl:function(){var n=this,t=n.getControl(),i=n.properties,r=i.control;return $("<label>Userfield: "+r+" not found<\/label>").appendTo(t)}});
bizagi.rendering.document.extend("bizagi.rendering.document",{},{postRender:function(){var n=this;n.applyDocumentTemplatesFormat();n.properties.allowSendInMail&&n.bindEmailDialog()},bindEmailDialog:function(){var n=this,t=n.getControl(),i=n.properties.xpathContext||"",r=n.properties.xpath;$(".ui-bizagi-render-documentgenerator-sendmail",t).bizagiSendEmail({tmpl:n.renderFactory.getTemplate("dialog-send-email"),value:n.value,self:n,dataService:n.dataService,properties:n.properties,xpath:r,xpathContext:i})},applyDocumentTemplatesFormat:function(){var n=this,t=n.getControl(),i;t.addClass("ui-bizagi-render-display-block");i=$(".ui-bizagi-document-upload-item",t);$.each(i,function(t,i){var r,u;$(".ui-bizagi-document-type",i).addClass("ui-bizagi-document-extension");r=$(".ui-bizagi-document-preview",i);r.attr("title",n.resources.getResource("render-document-preview-tooltip"));r.tooltip();u=n.returnCssTypeFile($("a > span",i).html());$(".ui-bizagi-document-type",i).addClass(u);$(".ui-bizagi-button",i).remove();$(".ui-bizagi-document-preview",i).attr("display","none")})},updateControlForPrintMode:function(n){$(".ui-bizagi-render-button",n).each(function(){$(this).remove()});$(".ui-bizagi-div-error-container",n).each(function(){$(this).remove()});$(".ui-bizagi-document-preview",n).each(function(){$(this).remove()});$(".ui-bizagi-document-type",n).each(function(){$(this).remove()});$("a",n).each(function(){$(this).attr("target","_blank").attr("title",$("span",this).html()).css("text-decoration","none")});$("ol",n).each(function(){$(this).removeClass("ui-bizagi-container-documents");$(this).addClass("ui-bizagi-container-documents-print")})},showDocumentPreview:function(n,t){var e,r,i,f,u;n=n+"&h_disposition=inline";e=navigator.userAgent.match("MSIE (.)");navigator.sayswho=function(){var r=navigator.appName,t=navigator.userAgent,i,n=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return n&&(i=t.match(/version\/([\.\d]+)/i))!=null&&(n[2]=i[1]),n?[n[1],n[2]]:[r,navigator.appVersion,"-?"]}();r=this;i=$("<div style='overflow:hidden;'><\/div>");i.empty();i.appendTo("body",window.document);f=$.browser.mozilla||$.browser.msie?r.renderFactory.getTemplate("document-item-preview-object"):r.renderFactory.getTemplate("document-item-preview");i.append($.fasttmpl(f,{url:n}));u={};u[r.getResource("confirmation-box-ok")]=function(){i.dialog("destroy");i.remove()};navigator.sayswho[0]!="Firefox"&&(u[r.getResource("render-actions-print")]=function(){var n=0,t=function(i){!document.getElementById("ui-bizagi-document-pdf-preview")&&n<5?(n+=1,setTimeout(function(){t(i)},1e3)):$.browser.mozilla||$.browser.msie?($(".ui-bizagi-document-pdf-preview").focus(),$(".ui-bizagi-document-pdf-preview")[0].print()):(document.getElementById("ui-bizagi-document-pdf-preview").focus(),document.getElementById("ui-bizagi-document-pdf-preview").contentWindow.print())};t($("#ui-bizagi-document-pdf-preview",i)[0])});i.dialog({width:800,height:600,title:t,maximized:!1,modal:!0,buttons:u,close:function(){i.dialog("destroy");i.remove()}})},redrawDocuments:function(n,t,i){var r=this;r._super(n,t,i);r.applyDocumentTemplatesFormat()},autoOpenDocuments:function(){var t=this,i=t.properties,r=t.getControl(),n;i.autoOpen&&(i.downloadalldocuments?(n=$(".ui-bizagi-document-upload-item[data-joined=true]",r),n&&n.length==1&&t.showDocumentPreview($("> a",n).attr("href"),n.attr("data-filename"))):$.each($(".ui-bizagi-document-upload-item",r),function(){var n=$(this).attr("data-filename").substr($(this).attr("data-filename").lastIndexOf(".")+1);n.toUpperCase()!="PDF"||$(this).attr("data-joined")||t.showDocumentPreview($("> a",this).attr("href"),$(this).attr("data-filename"))}))}});
bizagi.rendering.image.extend("bizagi.rendering.imageNoFlash",{},{postRender:function(){var t=this,n=t.getControl(),o=t.properties,f=t.getMode(),c=t.renderFactory.getTemplate("image-noflash"),r,i=t.properties.width,u=t.properties.height,s,e;if(t.properties.flashVersion=!1,s=$.fasttmpl(c,{xpath:bizagi.util.encodeXpath(t.getUploadXpath()),editable:o.editable,url:t.properties.url,allowDelete:o.allowDelete,mode:f}),$(".image-wrapper",n).empty().append(s),f=="design"||f=="layout"||t.properties.url.length==0){if(setTimeout(function(){var f,e,o,s;u=="auto"&&(t.parent.properties.type=="grid"?(r=$(n).height()+"px",bizagi.util.cssExtended($(".image-wrapper",n),"width:100%!important")):(f=t.parent.properties.type==="panel"?t.parent.parent:t.parent,e=n.height(),r=f.container.height()-17,o=t.parent.getChildreCount(),s=t.parent.getChildrenSumHeight("image"),t.parent.properties.id==t.getFormContainer().properties.id?r=50:o>1&&(r=r-(s-e)),$(".image-wrapper",n).height(r)),u=r);$("a",n).css({width:i,height:u});$(".resizable_img",n).css({width:i,height:u})},150),$(".resizable_img",n).hasClass("background-image")){var l=$(".resizable_img",n).css("background-image").replace(/url\(|\)|"|'/g,""),h=$("<img src="+l+">");h.css({width:i,height:u});$(".resizable_img",n).append(h);$(".resizable_img",n).css({"background-image":"none","border-top-width":"0","border-left-width":"0","border-right-width":"0","border-down-width":"0",padding:"0"})}}else e=!1,controlWidth=n.width(),setTimeout(function(){var r=t.properties.isAutoWidth,u;r&&t.parent.properties.type==="grid"?($(".img",n).width()<controlWidth?i=$(".img",n).width():$(".img",n).width()>=controlWidth&&(i=controlWidth-20,e=!0),$("a",n).css({height:"auto"})):$("a",n).css({width:i,height:"auto"});$(".img, .ui-bizagi-render-image-wrapper .image-file",n).css({width:i,height:"auto"});u=48;(t.properties.width+"").indexOf("px")!==-1&&(u=(t.properties.width+"").replace("px",""));$(".ui-bizagi-render-image-wrapper .image-file",n).addClass("w-size-"+u);$("img",n).css("width",i);$("img",n).css("height","auto");r&&Number($("a",n).css("width").slice(0,-2))>Number($(".img",n).css("width").slice(0,-2))&&$("a",n).css({width:$(".img",n).css("width")});r&&e&&t.parent.properties.type==="grid"&&$("a",n).closest(".ui-bizagi-render").css("text-align","left")},50);t.isPostRendered&&t.isPostRendered.resolve()},isReadyToSave:function(){var n=this;return n.ready()},configureHandlers:function(){var n=this,i=n.getControl(),t=n.properties;n._super();n.deleteHandler();$(".ui-bizagi-render-image-wrapper",i).bizagiUpload({renderReference:this,dialogTemplate:n.renderFactory.getTemplate("image-dialog"),properties:{scriptData:n.buildAddParams(),url:t.addUrl,xpath:t.xpath,validExtensions:t.validExtensions,maxSize:t.maxSize},onUploadFileCompletedCallback:n.onUploadFileCompleted,dialogTitle:n.getResource("render-upload-link-label")});i.delegate(".ui-bizagi-render-upload-item","mouseover",function(){var n=$(this);$(".ui-bizagi-render-upload-icon",n).css("display","inline-block");n.removeClass("ui-state-default").addClass("ui-state-hover")});i.delegate(".ui-bizagi-render-upload-item","mouseout",function(){var n=$(this);$(".ui-bizagi-render-upload-icon",n).css("display","none");n.addClass("ui-state-default").removeClass("ui-state-hover")})},deleteHandler:function(){var t=this,i=t.getControl(),n=t.properties;$(".delete-button",i).bind("click",function(r){r.stopPropagation();$.when(t.dataService.deleteImage({url:n.deleteUrl,idRender:n.id,xpath:n.xpath,xpathContext:n.xpathContext,idPageCache:n.idPageCache,contexttype:n.contexttype})).done(function(){var n=$(".ui-bizagi-render-image-wrapper",i).empty(),r=$.tmpl(t.getTemplateItem());n.append(r);console.log("Deleted")})})},configureDesignView:function(){var n=this,t=n.getControl();n._super();$("*:not(.ui-bizagi-render-control-required)",t).css({padding:"0px",margin:"0px",border:"0px","line-height":"0px",position:"relative",display:"table",top:"0"});$(".image-file",t).css({width:n.properties.width,height:n.properties.height})},renderReadOnly:function(){var n=this;return n.renderControl()},postRenderReadOnly:function(){var n=this,t=n.getControl(),i=n.renderFactory.getTemplate("image-noflash"),r=n.getMode(),u=$.fasttmpl(i,{xpath:bizagi.util.encodeXpath(n.getUploadXpath()),editable:!1,url:n.properties.url,allowDelete:!1,mode:r});$(".ui-bizagi-render-upload-wrapper",t).empty().append(u);$("a,.img, .ui-bizagi-render-image-wrapper .image-file, .ui-bizagi-render-image-wrapper",t).css({width:n.properties.width,height:n.properties.height})},getTemplateItem:function(){var n=this;return n.renderFactory.getTemplate("image-item-noflash")},openUploadDialog:function(){var n=this,t=n.properties,f=window.document,i=n.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),r,u;i.empty();i.appendTo("body",f);r={};r[n.getResource("render-upload-dialog-select")]=function(){n.checkMaxSize()&&n.checkFileTypes()&&$.when(n.processUploadFile()).done(function(t){n.onUploadFileCompleted(t);n.closeUploadDialog()})};r[n.getResource("text-cancel")]=function(){n.closeUploadDialog()};i.dialog({width:500,height:200,title:n.getResource("render-upload-link-label"),modal:!0,buttons:r,close:function(){n.closeUploadDialog()},resizeStop:function(t,i){n.form&&n.form.resize(i.size)}});u=n.renderFactory.getTemplate("image-dialog");$.tmpl(u,{scriptData:n.buildAddParams(),url:t.addUrl,xpath:t.xpath,validExtensions:t.validExtensions.replace(";",","),maxSize:t.maxSize}).appendTo(i);$(".ui-bizagi-loading-message").remove()},closeUploadDialog:function(){var n=this;n.dialogBox.dialog("destroy");n.dialogBox.remove()},onUploadFileCompleted:function(n,t){var r=n,i=r.getControl(),o=$(".ui-bizagi-render-image-wrapper",i),f=JSON.parse(t),u=0,e=i.width(),s=i.find(".img").size()>0,h=i.find(".resizable_img").width();u=r.properties.isAutoWidth?r.properties.type!="image"?i.width():"99%":r.properties.width;$(".uploadifyQueueItem",i).css({width:r.properties.width});f.type!=="error"?$.when(r.renderUploadItem()).done(function(n){$(o).empty();$(o).append(n);r.deleteHandler();r.triggerRenderChange();setTimeout(function(){var f=!1,n=r.properties.isAutoWidth,t;n&&r.parent.properties.type==="grid"?($(".img",i).width()<e?u=$(".img",i).width():$(".img",i).width()>=e&&(u=e-20,f=!0),s||$("a",i).closest("td").css("width",h),$("a",i).css({height:"auto"})):$("a",i).css({width:u,height:"auto"});$(".img, .ui-bizagi-render-image-wrapper .image-file",i).css({width:u,height:"auto"});t=48;(r.properties.width+"").indexOf("px")!==-1&&(t=(r.properties.width+"").replace("px",""));$(".ui-bizagi-render-image-wrapper .image-file",i).addClass("w-size-"+t);$("img",i).css("width",u);$("img",i).css("height","auto");$(".image-wrapper",i).css("height","auto");n&&Number($("a",i).css("width").slice(0,-2))>Number($(".img",i).css("width").slice(0,-2))&&$("a",i).css({width:$(".img",i).css("width")});r.parent.properties.type==="grid"&&n&&(f?$("a",i).closest(".ui-bizagi-render").css("text-align","left"):r.properties.columnAlign?($("a",i).closest(".ui-bizagi-render").css("text-align",r.properties.columnAlign),$(".image-wrapper",i).css("text-align",r.properties.columnAlign)):$("a",i).closest(".ui-bizagi-render").css("text-align","center"))},50);r.setValue([!0])}):f.cause=="iframeW8"?r.getFormContainer().refreshForm():bizagi.showMessageBox(f.message)},buildAddParams:function(){var n=this,i=n.properties,r=n.getFormContainer(),t=[],u="savefile";i.isUserPreference&&(u="SAVEUSERIMAGE",t.push({key:n.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:"entity"}),t.push({key:n.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey",value:n.currentUser}));t.push({key:n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",value:n.getUploadXpath()});t.push({key:n.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",value:i.id});t.push({key:n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",value:i.xpathContext});t.push({key:n.Class.BA_CONTEXT_PARAMETER_PREFIX+n.Class.BA_PAGE_CACHE,value:i.idPageCache});t.push({key:n.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",value:r.properties.sessionId});t.push({key:n.Class.BA_CONTEXT_PARAMETER_PREFIX+"action",value:u});i.contexttype?t.push({key:n.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:i.contexttype}):"";try{BIZAGI_SESSION_NAME!=undefined?t.push({key:BIZAGI_SESSION_NAME,value:r.properties.sessionId}):t.push({key:"JSESSIONID",value:r.properties.sessionId})}catch(f){t.push({key:"JSESSIONID",value:r.properties.sessionId})}return t},checkMaxSize:function(){var n=this,i=n.properties,r=n.dialogBox,t=$("input[type=file]",r).get(0)||{};return t.files!=undefined?t.files.length>0?t.files[0].size>i.maxSize?(n.showError(n.getResource("render-upload-alert-maxsize").replace("{0}",i.maxSize)),!1):!0:(n.showError(n.getResource("render-required-upload").replace("#label#","")),!1):bizagi.util.isIE()?t.value!==""&&t.value?!0:(n.showError(n.getResource("render-required-upload").replace("#label#","")),!1):!0},checkFileTypes:function(){var n=this,t=n.properties,r=n.dialogBox,u=$("input[type=file]",r).val(),i;return t.validExtensions&&t.validExtensions.length>0&&(i=t.validExtensions.replaceAll("*.","").split(";"),!n.stringEndsWithValidExtension(u,i,!0))?(n.showError(n.getResource("render-upload-allowed-extensions")+t.validExtensions),!1):!0},stringEndsWithValidExtension:function(n,t,i){if(i==!1&&n.length==0)return!0;for(var r=0;r<t.length;r++)if(t[r].toLowerCase()=="*"||n.toLowerCase().endsWith(t[r].toLowerCase()))return!0;return!1},showError:function(n){var i=this,t=$("#alert-file-upload",i.dialogBox);t.empty();t.show();t.html(n)},processUploadFile:function(){var t=this,i=new $.Deferred,f=t.dialogBox,r=$("form",f),n=$("iframe",r),u=function(){var r,f;try{r="";n[0].contentWindow&&(f=bizagi.util.isIE8()?$(n[0].contentWindow.document.body):$(n[0].contentWindow.eval("document.body")),r=f.text());r.length>0?i.resolve(r):setTimeout(u,50)}catch(e){t.closeUploadDialog();window.alert(e.toString())}};return u(),r.submit(),i.promise()}});
bizagi.rendering.image.extend("bizagi.rendering.imageHtml5",{},{postRender:function(){var t=this,h,o,f;this.errorDiv=document.createElement("div");this.errorDiv.id="alert-file-upload";var n=t.getControl(),s=t.properties,e=t.getMode(),l=t.renderFactory.getTemplate("image-html5"),r,i=t.properties.width,u=t.properties.height;if(t.properties.flashVersion=!1,h=$.fasttmpl(l,{xpath:bizagi.util.encodeXpath(t.getUploadXpath()),editable:s.editable,url:t.properties.url,allowDelete:s.allowDelete,mode:e}),$(".image-wrapper",n).append(h),e=="design"||e=="layout"||t.properties.url.length==0){if(setTimeout(function(){var f,e,o,s;u=="auto"&&(t.parent.properties.type=="grid"?(r=$(n).height()+"px",bizagi.util.cssExtended($(".image-wrapper",n),"width:100%!important")):(f=t.parent.properties.type==="panel"?t.parent.parent:t.parent,e=n.height(),r=f.container.height()-17,o=t.parent.getChildreCount(),s=t.parent.getChildrenSumHeight("image"),t.parent.properties.id==t.getFormContainer().properties.id?r=50:o>1&&(r=r-(s-e)),$(".image-wrapper",n).height(r)),u=r);$("a",n).css({width:i,height:u});$(".resizable-html5",n).css({width:i,height:u})},150),$(".resizable-html5",n).hasClass("background-image")){var a=$(".resizable-html5",n).css("background-image").replace(/url\(|\)|"|'/g,""),c=$("<img src="+a+">");c.css({width:i,height:u});$(".resizable_img",n).append(c);$(".resizable_img",n).css({"background-image":"none","border-top-width":"0","border-left-width":"0","border-right-width":"0","border-down-width":"0",padding:"0"})}}else o=!1,f=n.width(),setTimeout(function(){var r=t.properties.isAutoWidth,u;r&&t.parent.properties.type==="grid"?($(".img",n).width()<f?i=$(".img",n).width():$(".img",n).width()>=f&&(i=f-20,o=!0),$("a",n).css({height:"auto"})):$("a",n).css({width:i,height:"auto"});$(".img, .ui-bizagi-render-image-wrapper .image-file",n).css({width:i,height:"auto"});u=48;(t.properties.width+"").indexOf("px")!==-1&&(u=(t.properties.width+"").replace("px",""));$(".ui-bizagi-render-image-wrapper .image-file",n).addClass("w-size-"+u);$(".img",n).css({width:i,height:"auto"});$(".img",n).find("img").attr("width",i);r&&Number($("a",n).css("width").slice(0,-2))>Number($(".img",n).css("width").slice(0,-2))&&$("a",n).css({width:$(".img",n).css("width")});r&&o&&t.parent.properties.type==="grid"&&$("a",n).closest(".ui-bizagi-render").css("text-align","left")},50)},configureHandlers:function(){var n=this,t=n.getControl();n._super();$(".ui-bizagi-render-image-wrapper",t).click(function(){n.openUploadDialog()});t.delegate(".ui-bizagi-render-upload-item","mouseover",function(){var n=$(this);$(".ui-bizagi-render-upload-icon",n).css("display","inline-block");n.removeClass("ui-state-default").addClass("ui-state-hover")});t.delegate(".ui-bizagi-render-upload-item","mouseout",function(){var n=$(this);$(".ui-bizagi-render-upload-icon",n).css("display","none");n.addClass("ui-state-default").removeClass("ui-state-hover")})},configureDesignView:function(){var n=this,t=n.getControl();n._super();$("*:not(.ui-bizagi-render-control-required)",t).css({padding:"0px",margin:"0px",border:"0px","line-height":"0px",position:"relative",display:"table",top:"0"});$(".image-file",t).css({width:n.properties.width,height:n.properties.height})},renderReadOnly:function(){var n=this;return n.renderControl()},postRenderReadOnly:function(){var n=this,t=n.getControl(),i=n.renderFactory.getTemplate("image-noflash"),r=n.getMode(),u=$.fasttmpl(i,{xpath:bizagi.util.encodeXpath(n.getUploadXpath()),editable:!1,url:n.properties.url,allowDelete:!1,mode:r});$(".ui-bizagi-render-upload-wrapper",t).append(u);$("a,.img, .ui-bizagi-render-image-wrapper .image-file, .ui-bizagi-render-image-wrapper",t).css({width:n.properties.width,height:n.properties.height})},getTemplateItem:function(){var n=this;return n.renderFactory.getTemplate("image-item-html5")},openUploadDialog:function(){var n=this,u=n.properties,e=window.document,t=n.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),r,f,i;t.appendTo("body",e);r={};r[n.getResource("render-upload-dialog-select")]=function(t){t.stopPropagation();n.checkMaxSize()&&n.checkFileTypes()&&n.processUploadFile()};r[n.getResource("text-cancel")]=function(){n.closeUploadDialog()};t.dialog({width:500,height:250,resizable:!1,maximize:!1,title:n.getResource("render-upload-link-label"),modal:!0,buttons:r,close:function(){n.closeUploadDialog()},resizeStop:function(t,i){n.form&&n.form.resize(i.size)}});f=n.renderFactory.getTemplate("uploadHtml5");$.tmpl(f,{url:u.addUrl,xpath:u.xpath}).appendTo(t);i=n.progress=document.createElement("progress");i.max="100";i.value="0";i.id="determinateProgress";i.style.display="none";$(i).appendTo(t);$("button",t).button();$("button",t).click(function(){$("form",t)[0].reset();n.errorDiv.innerHTML="";$("label",t).text("");$("input[type=file]",t).trigger("click")});$("input[type=file]",t)[0].onchange=function(){if(n.checkFileTypes()&&n.checkMaxSize()){var i=$("input[type=file]",t).val(),r=i.lastIndexOf("\\")>0?i.lastIndexOf("\\")+1:0;i=i.substring(r,i.length);$("label",t).text(i)}}},closeUploadDialog:function(){var n=this;n.dialogBox.dialog("destroy");n.dialogBox.remove()},onUploadFileCompleted:function(n){var i=this,t=i.getControl(),f=$(".ui-bizagi-render-image-wrapper",t),e=JSON.parse(n),r=0,u=t.width(),o=t.find(".img").size()>0,s=t.find(".resizable-html5").width();r=i.properties.isAutoWidth?i.properties.type!="image"?t.width():"99%":i.properties.width;$(".uploadifyQueueItem",t).css({width:i.properties.width});e.type!=="error"?$.when(i.renderUploadItem()).done(function(n){$(f).empty();$(f).append(n);i.triggerRenderChange();setTimeout(function(){var e=!1,n=i.properties.isAutoWidth,f;n&&i.parent.properties.type==="grid"?($(".img",t).width()<u?r=$(".img",t).width():$(".img",t).width()>=u&&(r=u-20,e=!0),o||$("a",t).closest("td").css("width",s),$("a",t).css({height:"auto"})):$("a",t).css({width:r,height:"auto"});$(".img, .ui-bizagi-render-image-wrapper .image-file",t).css({width:r,height:"auto"});f=48;(i.properties.width+"").indexOf("px")!==-1&&(f=(i.properties.width+"").replace("px",""));$(".ui-bizagi-render-image-wrapper .image-file",t).addClass("w-size-"+f);$("img",t).css("width",r);$("img",t).css("height","auto");$(".image-wrapper",t).css("height","auto");n&&Number($("a",t).css("width").slice(0,-2))>Number($(".img",t).css("width").slice(0,-2))&&$("a",t).css({width:$(".img",t).css("width")});i.parent.properties.type==="grid"&&n&&(e?$("a",t).closest(".ui-bizagi-render").css("text-align","left"):i.properties.columnAlign?($("a",t).closest(".ui-bizagi-render").css("text-align",i.properties.columnAlign),$(".image-wrapper",t).css("text-align",i.properties.columnAlign)):$("a",t).closest(".ui-bizagi-render").css("text-align","center"))},50);i.setValue([!0])}):bizagi.showMessageBox(e.message)},checkMaxSize:function(){var n=this,i=n.properties,t=n.dialogBox,r=$("input[type=file]",t).get(0);return r.files.length>0?r.files[0].size>i.maxSize?(n.errorDiv.innerHTML=n.getResource("render-upload-alert-maxsize").replace("{0}",i.maxSize),$(n.errorDiv).appendTo(t),!1):!0:(n.errorDiv.innerHTML=n.getResource("render-required-upload").replace("#label#",""),$(n.errorDiv).appendTo(t),!1)},checkFileTypes:function(){var n=this,t=n.properties,i=n.dialogBox,u=$("input[type=file]",i).val(),r;return t.validExtensions&&t.validExtensions.length>0&&(r=t.validExtensions.replaceAll("*.","").split(";"),!n.stringEndsWithValidExtension(u,r,!0))?(n.errorDiv.innerHTML=n.getResource("render-upload-allowed-extensions")+t.validExtensions,$(n.errorDiv).appendTo(i),!1):!0},stringEndsWithValidExtension:function(n,t,i){if(i==!1&&n.length==0)return!0;for(var r=0;r<t.length;r++)if(t[r].toLowerCase()=="*"||n.toLowerCase().endsWith(t[r].toLowerCase()))return!0;return!1},showError:function(n){var i=this,t=$("#alert-file-upload",i.dialogBox);t.empty();t.show();t.html(n)},processUploadFile:function(){var n=this,e=n.dialogBox,o=$("form",e),f=$("input:file",o),r=n.getFormContainer(),t=new FormData,i,u;t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",n.getUploadXpath());t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",n.properties.id);t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",n.properties.xpathContext);t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+n.Class.BA_PAGE_CACHE,n.properties.idPageCache);t.append(n.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId);t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"action","savefile");t.append(n.properties.xpath,f.get(0).files[0]);n.properties.contexttype?t.append(n.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",n.properties.contexttype):"";try{BIZAGI_SESSION_NAME!=undefined?t.append(BIZAGI_SESSION_NAME,r.properties.sessionId):t.append("JSESSIONID",r.properties.sessionId)}catch(s){t.append("JSESSIONID",r.properties.sessionId)}typeof bizagi.context.isOfflineForm=="undefined"||bizagi.context.isOfflineForm==!1?(i=new XMLHttpRequest,i.onload=function(){try{var t=JSON.parse(this.response);if(t.type!="error"){n.onUploadFileCompleted(this.response);n.closeUploadDialog()}else bizagi.showMessageBox(t.message)}catch(e){bizagi.showMessageBox("Error")}n.progress.style.display="none"},i.onprogress=function(t){t.lengthComputable&&(n.progress.value=t.loaded/t.total*100,n.progress.textContent=n.progress.value)},i.onerror=function(n){bizagi.logError("Error: "+n.message,n)},i.onabort=function(n){bizagi.log("Aborted succeded: ",n,"success")},i.open("POST",n.properties.addUrl,!0),i.send(t),n.progress.style.display="block"):(u=new FileReader,u.onload=function(t){var i=t.target.result,r=n.getControl(),u=$(".ui-bizagi-render-upload-wrapper",r),f=$.fasttmpl(n.getTemplateItem(),{url:i});u.html($(f));n.getControl().find("img").css("width","100%");n.getControl().find("a").css("width","auto");n.getControl().find("a").css("height","auto");n.getControl().find("div.img").css("height","auto");n.getControl().find("div.img").css("width","auto");i=i.replace(/^data:image\/(png|jpg|jpeg);base64,/,"");n.setValue(i);bizagi.log(i);n.canBeSent=function(){return!0};n.triggerRenderChange();n.closeUploadDialog()},u.readAsDataURL(f.get(0).files[0]))}});
bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.combo",{},{postRender:function(n,t,i){var u,f;this._super(n,t,i);var r=this,e=r.getMode(),o=$(".ui-selectmenu-status",t);this.applyColumnStyles(o);this.properties.editable&&i&&i.addClass("ui-bizagi-cell-combo");e=="execution"&&(u=this.getDecorated(n),f=u.getControl(),r.isNewRow=f.parents("tr").data("new-row")?!0:!1)},postRenderReadOnly:function(n,t,i){this._super(n,t,i);var r=$(".ui-selectmenu-status",t);this.applyColumnStyles(r);i&&i.removeClass("ui-bizagi-cell-combo")},applyOverrides:function(n){var t=this;this._super(n);n.getUploadXpath=this.getUploadXpath;n.cleanData=function(){var n=this,i,t;n.value=n.properties.value=n.selectedValue={id:0,value:n.getResource("render-combo-empty-value")};n.setValue(n.value);i=n.getControl();t=i.find("input");t&&t.val(n.getValue().value)}}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.document",{},{applyOverrides:function(n){var t=this,i=t.getMode();t._super(n);n.getControlHtml=t.getControlHtml;i!="design"&&(t.surrogateKey=n.surrogateKey,n.getXpath=this.getXpath,n.getDocumentXpath=this.getDocumentXpath,n.getContextXpath=this.getContextXpath,n.documentTemplateGenerate=this.documentTemplateGenerate,n.preRenderControl=this.preRenderControl,n.deleteDocumentTemplate=this.deleteDocumentTemplate,n.getTemplateItem=this.getTemplateItem,n.properties.xpathContext=t.getContextXpath())},getTemplateItem:function(){return"document-column-item"},documentTemplateGenerate:function(){var n=this,t=n.properties,i;n.startLoading();t.xpathcontext=n.getContextXpath();t.xpath=n.getDocumentXpath(t.xpath);t.buttonExecuted=!0;i=n.parent;$.when(i.submitOnChange("",!1)).done(function(){$.when(n.dataService.generateDocumentTemplate(t)).done(function(){$.when(i.refresh()).done(function(){n.autoOpenDocuments()});n.endLoading()}).fail(function(){n.showErrorMessage();n.endLoading()})}).fail(function(t){n.getFormContainer().addErrorMessage(t);n.endLoading()});t.buttonExecuted=!1},getControlHtml:function(n,t,i,r,u,f){for(var h,e=this,s=!0,o=0;o<e.parent.properties.data.rows.length;o++)if(e.parent.properties.data.rows[o][0]==e.surrogateKey){s=!1;break}return h=$.fasttmpl(n,{noActivateButton:s,editable:t!="execution",downloadalldocuments:i,required:u.required,allowgenerate:r,xpath:e.getXpath(u.xpath),append:u.append?u.append:!1,caption:u.caption,noFiles:f,allowSendInMail:u.allowSendInMail}),h.replace("ui-bizagi-document-upload-item-design","ui-bizagi-document-upload-item-design-column")},getXpath:function(n){var t=n,i=t.indexOf(this.grid.properties.xpath);return i!=-1&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(n){var t=n,i=t.indexOf(this.grid.properties.xpath);return i!=-1&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(n,t,i){this._super(n,t,i)},getContextXpath:function(){var t=this,n=t.getFormContainer(),i=n.properties.xpathContext?n.properties.xpathContext+".":"";return i+this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},preRenderControl:function(){var n=this;n.value!=undefined&&n.properties.value!=undefined&&(n.properties.value=n.value)},deleteDocumentTemplate:function(n){var t=this,r=t.parent,i={};i.xpath=t.properties.xpath+"[fileName='"+n+"']";i.idRender=t.properties.id;i.xpathContext=t.getContextXpath();i.idPageCache=t.properties.idPageCache;$.when(t.dataService.deleteUploadFile(i)).done(function(){r.refresh()})}});
bizagi.rendering.columns.letter.extend("bizagi.rendering.columns.letter",{},{applyOverrides:function(n){var t=this,i=t.properties,r=t.getMode();t._super(n);n.getContextXpath=t.getContextXpath;n.getXpath=t.getXpath;n.getControl=t.getControl;n.setDisplayValue=t.setDisplayValue;n.postRenderReadOnly=function(t){var i=n.renderReadOnly.apply(n),r=$(".ui-bizagi-cell",t);r.append(i)}},getContextXpath:function(){var n=this,i=n.getMode(),t=n.properties;return i==="execution"?t.xpathContext&&t.xpathContext.length>0?t.xpathContext+"."+n.grid.properties.xpath+"[id="+n.surrogateKey+"]":n.grid.properties.xpath+"[id="+n.surrogateKey+"]":""},getXpath:function(){var t=this,r=t.properties,n=r.xpath,i=n.indexOf(t.grid.properties.xpath);return i!=-1&&(n=n.substr(i+t.grid.properties.xpath.length+1)),n},postRender:function(n,t){var r,u,f,i;this._super(n,t);r=this;u=r.getMode();this.setSurrogateKey(n);u=="execution"&&(f=this.getDecorated(n),i=f.getControl(),i.parents("tr").data("new-row")&&i.html(bizagi.localization.getResource("render-grid-column-letter-mandatory-key")))},getControl:function(){var n=this,t=n.properties;return t.editable?$(".ui-bizagi-render-control",n.element):$(".ui-bizagi-cell",n.element)},setDisplayValue:function(n){var t=this;t.setValue(n,!1)}});
bizagi.rendering.columns.search.extend("bizagi.rendering.columns.search",{},{postRender:function(n,t){this._super(n,t);var i=this.getDecorated(n),r=$(".ui-selectmenu-status",i.getControl());this.applyColumnStyles(r);this.properties.editable&&i.getControl().addClass("ui-bizagi-cell-search")},postRenderReadOnly:function(n,t){this._super(n,t);var i=$(".ui-selectmenu-status",t);this.applyColumnStyles(i)}});
bizagi.rendering.columns.date.extend("bizagi.rendering.columns.date",{},{applyOverrides:function(n){var t=this,i=t.getMode();t._super(n);n&&(n.showTime=!1,i==="execution"&&(n.changeMinValue=function(n){var i=this.properties,r=this.getDateControl(),u=t.resolveValue(this,n);n&&i.editable&&(i.minValue=n,r.datepicker("option","minDate",new Date(u)))},n.changeMaxValue=function(n){var i=this.properties,r=this.getDateControl(),u=t.resolveValue(this,n);n&&i.editable&&(i.maxValue=n,r.datepicker("option","maxDate",new Date(u)))}));i!="design"&&(n.getDateControl=function(){var n=this;return n.dateControl=$(".ui-bizagi-render-date",n.getControl())})},resolveValue:function(n,t){var i="";if(bizagi.util.isString(t)&&(i=t),bizagi.util.isArray(t)){var u=n.grid.getIndexes(),f=n.surrogateKey,r=u.indexOf(f);r!==-1&&(i=t[r])}return i},postRender:function(n,t){var r;this._super(n,t);var u=this,f=u.properties,i=this.getDecorated(n);i.properties.showTime=!1;i.properties.showTime=f.showTime;r=$("input",t);this.applyColumnStyles(r)},postRenderReadOnly:function(n,t){this._super(n,t);var i=this,r=i.properties,u=this.getDecorated(n);u.properties.showTime=r.showTime}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.text",{},{postRender:function(n,t){this._super(n,t);var i=$("input, textarea",t);this.applyColumnStyles(i)},postRenderReadOnly:function(n,t){var r=this,u=r.properties,i;u.autoExtend&&(i=t.find(".ui-bizagi-cell-readonly"),i.length>0&&i.css("max-height","none"));r._super(n,t)},attachRetypeDouble:function(){var n=this,i=n.element,t=$("input",i);t&&t.length!=0&&t.blur(function(){var t=$(this),i=n.previousValue,r=n.value;i!=null&&r!=i&&$(this).data("newValue")!=undefined&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=undefined);n.retypeDouble(t)})}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.searchList",{},{init:function(n){this._super(n);var t=this.properties},render:function(n,t,i){var r=this,f=r.getDecorated(n),u=r.properties,e;return u.recalculate&&f.resetData(),e=u.xpathContext.length>0?u.xpathContext+"."+r.grid.properties.xpath+"[id="+n+"]":r.grid.properties.xpath+"[id="+n+"]",f.properties.xpathContext=e,this._super(n,t,i)},setValue:function(n,t){var r=this,i=r.getDecorated(n);i!="undefined"&&i!=null&&(i.properties.originalValue=t,i.properties.previousValue=t,(t===null||t===undefined)&&r.properties.defaultvalue!==undefined&&i.grid!=undefined&&(t=r.setDefaultValue(n,i)),(t===null||t===undefined)&&(t=[]),i.properties.value=t,i.setValue(t,!1))}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.number",{},{postRender:function(n,t){this._super(n,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(n,t){var i=this;return i.renderReadOnly(n,t)},postRenderSummary:function(n,t){var i=this;return i.postRenderReadOnly(n,t),!0}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.numberScientificNotation",{},{postRender:function(n,t){this._super(n,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(n,t){var i=this;return i.renderReadOnly(n,t)},postRenderSummary:function(n,t){var i=this;return i.postRenderReadOnly(n,t),!0}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.upload",{},{applyOverrides:function(n){var r=this,t,i;this._super(n);t=r.getMode();n.getUploadXpath=this.getUploadXpath;t!="design"&&t!="layout"&&(i=n.applyUploadPlugin,n.getXpathContext=function(){var i=this.surrogateKey||"",n=this,t=n.properties;return t.xpathContext.length>0?t.xpathContext+"."+n.grid.properties.xpath+"[id="+n.surrogateKey+"]":n.grid.properties.xpath+"[id="+n.surrogateKey+"]"},n.applyUploadPlugin=function(){var r=this,t=r.getControl();i.apply(n,arguments);t.undelegate(".ui-bizagi-render-upload-item","mouseover");t.undelegate(".ui-bizagi-render-upload-item","mouseout");$(".ui-bizagi-render-upload-icon",t).css("display","inline-block");$(".ui-bizagi-render-upload-wrapper object",t).css({position:"relative"});$(".ui-bizagi-render-upload-queue",t).css({"max-width":"150px"})},n.postRender=function(){var n=this,t=n.getControl();n.properties.allowSendInMail&&n.bindEmailDialog();t.addClass("ui-bizagi-render-display-block");t.addClass("ui-bizagi-render-upload");n.checkMaxFiles()},n.buildItemUrl=function(n){var t=this,i=t.properties,r=t.getFormContainer();return t.dataService.getUploadFileUrl({idRender:i.id,xpath:t.getUploadXpath(),xpathContext:i.xpathContext,idPageCache:i.idPageCache,fileId:n.id,sessionId:r.properties.sessionId,contexttype:i.contexttype})});n.buildItemUrl=function(n){var t=this,i=t.properties,r=t.getFormContainer(),u=t.getXpathContext();return t.dataService.getUploadFileUrl({idRender:i.id,xpath:i.xpath,xpathContext:u,idPageCache:i.idPageCache,fileId:n.id,sessionId:r.properties.sessionId,contexttype:i.contexttype})};n.processUploadFile=function(){var n=this,f=n.dialogBox,u=new $.Deferred,t=$("form",f),i=$("iframe",t),e=n.getXpathContext(),r;return $("[name=h_xpathContext]",t).val(e),r=function(){var t,f;try{t="";i[0].contentWindow&&(f=bizagi.util.isIE8()?$(i[0].contentWindow.document.body):$(i[0].contentWindow.eval("document.body")),t=f.text());t.length>0?u.resolve(t):setTimeout(r,50)}catch(e){n.closeUploadDialog();window.alert(e.toString())}},r(),t.submit(),u.promise()}},renderReadOnly:function(n,t){var r=this,u,i=this.getDecorated(n),f;return r.setValue(n,t),r.setSurrogateKey(n),r.applyOverrides(i),i.grid=this.grid,i.column=this,i.surrogateKey=n,r.readyDeferred=new $.Deferred,i.files.length>0&&(f=this.properties.editable,i.properties.editable=!1,u=i.render("cell.upload"),i.properties.editable=f),r.bind("rendered",function(){r.readyDeferred.resolve()}),u},postRenderReadOnly:function(n,t){var i,r,u,f;this._super(n,t);i=this;r=this.getDecorated(n);r.files.length==0?(u=i.getResource("render-upload-no-files"),$(".ui-bizagi-cell-readonly",t).html(u),f=$(".ui-bizagi-cell-icon",t),f.addClass("ui-bizagi-cell-icon-right")):t&&t.length>0&&i.applyColumnStyles(t)},postRender:function(n,t){var i,u,f,r;this._super(n,t);i=this;u=i.getMode();this.setSurrogateKey(n);u!="design"&&(f=this.getDecorated(n),r=f.getControl(),r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),i.isNewRow=!0):i.isNewRow=!1)},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}});
bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.radio",{},{applyOverrides:function(n){var t=this;this._super(n);n.getUploadXpath=this.getUploadXpath;n.cleanData=function(){var n=this,t={id:"",label:""},i=n.element.find(".ui-radio-state-checked");i.removeClass("ui-radio-state-checked");n.setDisplayValue(t);n.setValue(t)}}});
bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.list",{},{applyOverrides:function(n){var t=this;this._super(n);n.getUploadXpath=this.getUploadXpath;n.cleanData=function(){var n=this,t=n.getControl(),i=t.find(".ui-state-active"),r=n.getValue();n.value=n.properties.value=n.selectedValue={id:"",value:""};n.selectedValue=r.value;i.removeClass("ui-state-focus ui-selected ui-state-active")}}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.uploadHtml5",{},{applyOverrides:function(n){var i=this,t;this._super(n);t=i.getMode();n.processUploadFile=this.processUploadFile;n.getUploadXpath=this.getUploadXpath;t!="design"&&t!="layout"&&(n.getXpathContext=function(){var i=this.surrogateKey||"",n=this,t=n.properties;return t.xpathContext.length>0?t.xpathContext+"."+n.grid.properties.xpath+"[id="+n.surrogateKey+"]":n.grid.properties.xpath+"[id="+n.surrogateKey+"]"},n.buildItemUrl=function(n){var t=this,i=t.properties,r=t.getFormContainer();return t.dataService.getUploadFileUrl({idRender:i.id,xpath:i.xpath,xpathContext:t.getXpathContext(),idPageCache:i.idPageCache,fileId:n.id,sessionId:r.properties.sessionId,contexttype:i.contexttype})})},postRender:function(n,t){var r,u,f,i;this._super(n,t);r=this;u=r.getMode();u!="design"&&(f=this.getDecorated(n),i=f.getControl(),i.parents("tr").data("new-row")?(i.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),r.isNewRow=!0):r.isNewRow=!1);i.addClass("ui-bizagi-render-display-block");i.addClass("ui-bizagi-render-upload")},postRenderReadOnly:function(){var n=this,t=n.getControl();n.isClicked=!1;n.properties.allowSendInMail&&n.bindEmailDialog();t.addClass("ui-bizagi-render-display-block");t.addClass("ui-bizagi-render-upload")},renderReadOnly:function(n,t){var r=this,u,i=this.getDecorated(n),f;return r.setValue(n,t),r.setSurrogateKey(n),r.applyOverrides(i),i.grid=this.grid,i.column=this,i.surrogateKey=n,r.readyDeferred=new $.Deferred,i.files.length>0&&(f=this.properties.editable,i.properties.editable=!1,u=i.render("cell.upload"),i.properties.editable=f),r.bind("rendered",function(){r.readyDeferred.resolve()}),u},processUploadFile:function(){var n=this,r=n.dialogBox,u=$("form",r),f=$("input:file",u),t=new FormData,i;t.append("h_xpath",n.getUploadXpath());t.append("h_idRender",n.properties.idRender);t.append("h_xpathContext",n.properties.xpathContext);t.append("h_pageCacheId",n.properties.idPageCache);t.append("h_sessionId",n.properties.sessionId);t.append(n.getUploadXpath(),f.get(0).files[0]);i=new XMLHttpRequest;i.onload=function(){var t,r,i;control=n.getControl();t=$(".ui-bizagi-render-upload-wrapper",control);try{result=JSON.parse(this.response);result.type!="error"?(r=n.renderUploadItem({id:result.id,fileName:result.fileName}),n.files.push([result.id,result.fileName]),t.after($(r)),n.filesCount=n.filesCount+1,n.filesCount>=n.properties.maxfiles&&t.remove(),i=n.files.slice(),i.push([result.id,result.fileName]),n.setValue(i,!1),$("#no-files",control).css("display","none"),n.triggerRenderChange(),n.closeUploadDialog()):bizagi.showMessageBox(result.message)}catch(e){bizagi.showMessageBox("Error")}n.progress.style.display="none"};i.onprogress=function(t){t.lengthComputable&&(n.progress.value=t.loaded/t.total*100,n.progress.textContent=n.progress.value)};i.onerror=function(n){bizagi.logError("Error: "+n.message,n)};i.onabort=function(n){bizagi.log("Aborted succeded: ",n,"success")};i.open("POST",n.properties.addUrl,!0);i.send(t);n.progress.style.display="block"},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.image",{},{applyOverrides:function(n){var t=this,i=t.properties,e=t.getMode(),r,u,f;this._super(n);n.getUploadXpath=this.getUploadXpath;r=n.applyUploadPlugin;n.properties.flashVersion&&(n.applyUploadPlugin=function(){var i=this,t=i.getControl();r.apply(n,arguments);t.undelegate(".ui-bizagi-render-upload-item","mouseover");t.undelegate(".ui-bizagi-render-upload-item","mouseout");$(".ui-bizagi-render-upload-icon",t).css("display","inline-block");$(".ui-bizagi-render-upload-wrapper object",t).css({position:"relative"})});u=n.renderControl;f=n.internalPostRender;n.renderControl=function(){return""};n.internalPostRender=function(){var i=n.getControl();i.parents("tr").data("new-row")?(i.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),t.isNewRow=!0):(t.isNewRow=!1,$.when(u.apply(n,arguments)).done(function(t){(i.hasClass("ui-bizagi-render-control")||i.hasClass("ui-bizagi-cell-readonly"))&&(i.append(t),f.apply(n,arguments))}))};n.buildAddParams=function(){var t=this,i=t.properties,r=t.getFormContainer(),n=[];n.push({key:t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",value:i.xpath});n.push({key:t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",value:i.id});n.push({key:t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",value:i.xpathContext});n.push({key:t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE,value:i.idPageCache});n.push({key:t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",value:r.properties.sessionId});n.push({key:t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action",value:"savefile"});i.contexttype?n.push({key:t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:i.contexttype}):"";try{BIZAGI_SESSION_NAME!=undefined?n.push({key:BIZAGI_SESSION_NAME,value:r.properties.sessionId}):n.push({key:"JSESSIONID",value:r.properties.sessionId})}catch(u){n.push({key:"JSESSIONID",value:r.properties.sessionId})}return n};e=="execution"&&(n.properties.xpathContext=i.xpathContext.length>0?i.xpathContext+"."+t.grid.properties.xpath+"[id="+n.surrogateKey+"]":t.grid.properties.xpath+"[id="+n.surrogateKey+"]")},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.uploadecm",{},{applyOverrides:function(n){var i=this,t;this._super(n);n.getUploadXpath=this.getUploadXpath;t=n.applyUploadPlugin;n.applyUploadPlugin=function(){var r=this,i=r.getControl();t.apply(n,arguments);i.undelegate(".ui-bizagi-render-upload-item","mouseover");i.undelegate(".ui-bizagi-render-upload-item","mouseout");$(".ui-bizagi-render-upload-icon",i).css("display","inline-block");$(".ui-bizagi-render-upload-wrapper object",i).css({position:"relative"})};n.buildItemUrl=function(n){var t=this,r=t.properties,e=t.getFormContainer(),i=t.getUploadXpath(t.surrigateKey),u,f;return i=i.split("."),u=i[i.length-1],f=t.getXpathContext(t.surrigateKey),t.dataService.getUploadFileUrl({idRender:r.id,xpath:u,xpathContext:f,idPageCache:r.idPageCache,fileId:n.idFileUpload,sessionId:e.properties.sessionId,contexttype:r.contexttype})};n.buildAddParams=function(){var t=this,i=t.properties,f=t.getFormContainer(),n={},r=t.getUploadXpath(t.surrigateKey),e,u;return r=r.split("."),e=r[r.length-1],u=t.getXpathContext(t.surrigateKey),n.url=i.addUrl,n.xpath=i.xpath,n.idAttrib=i.idAttrib,n.xpathContext=u,n.metaValues=[],n.idPageCache=i.idPageCache,n.idSession=f.properties.sessionId,n.contexttype="entity",n.validExtensions=i.validExtensions,n.maxSize=i.maxSize,n};n.getXpathContext=function(){var n=this,t=n.properties;return t.xpathContext.length>0?t.xpathContext+"."+n.grid.properties.xpath+"[id="+n.surrogateKey+"]":n.grid.properties.xpath+"[id="+n.surrogateKey+"]"}},renderReadOnly:function(n,t){var r=this,u,i=this.getDecorated(n),f;return i.setValue(t),r.setValue(n,t),r.setSurrogateKey(n),r.applyOverrides(i),i.grid=this.grid,i.column=this,i.surrogateKey=n,r.readyDeferred=new $.Deferred,i.files.length>0&&(f=this.properties.editable,i.properties.editable=!1,u=i.render("cell.upload")),r.bind("rendered",function(){r.readyDeferred.resolve()}),u},postRenderReadOnly:function(n,t){var i,r,u,f;this._super(n,t);i=this;r=this.getDecorated(n);r.files.length==0?(u=i.getResource("render-upload-no-files"),$(".ui-bizagi-cell-readonly",t).html(u),f=$(".ui-bizagi-cell-icon",t),f.addClass("ui-bizagi-cell-icon-right")):t&&t.length>0&&i.applyColumnStyles(t)},postRender:function(n,t){var i,u,f,r;this._super(n,t);i=this;u=i.getMode();this.setSurrogateKey(n);u=="execution"&&(f=this.getDecorated(n),r=f.getControl(),r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),i.isNewRow=!0):i.isNewRow=!1)},getUploadXpath:function(n){n=this.surrogateKey||n||"";var t=this,i=t.properties;return i.xpathContext.length>0?i.xpathContext+"."+t.grid.properties.xpath+"[id="+t.surrogateKey+"]."+t.properties.xpath:t.grid.properties.xpath+"[id="+t.surrogateKey+"]."+t.properties.xpath}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.link",{},{applyOverrides:function(n){this._super(n);n.getControl=this.getControl;n.properties.type=="columnFormLink"&&(n.getFormLinkXpath=this.getFormLinkXpath);var t=n.renderControl;originalInternalPostRender=n.internalPostRender;n.internalPostRender=function(){var i=n.getControl();i.parents("tr").data("new-row")?(i.html('<label style="font-weight: normal;">'+bizagi.localization.getResource("render-grid-column-button-mandatory-key")+"<\/label>"),self.isNewRow=!0):(self.isNewRow=!1,$.when(t.apply(n,arguments)).done(function(){(i.hasClass("ui-bizagi-render-control")||i.hasClass("ui-bizagi-cell-readonly"))&&originalInternalPostRender.apply(n,arguments)}))}},getControl:function(){var n=this,t=n.properties;return t.editable?$(".ui-bizagi-render-control",n.element):$(".ui-bizagi-cell-readonly",n.element).length>0?$(".ui-bizagi-cell-readonly",n.element):$(".ui-bizagi-render-control",n.element)},render:function(n,t,i,r){var u=this,f=u.getDecorated(n);return f.properties.xpathContext=u.grid.properties.xpath+"[id="+n+"]",u.grid.properties.xpathContext&&f.properties.xpathContext.indexOf(u.grid.properties.xpathContext)==-1&&(f.properties.xpathContext=u.grid.properties.xpathContext+"."+f.properties.xpathContext),this._super(n,t,i,r)},renderReadOnly:function(n,t,i){var r=this;return typeof r.properties.canBeSaved=="undefined"&&(r.properties.canBeSaved=r.properties.editable==!0),this.render(n,t,i,"CALLER_RENDER_READ_ONLY_COLUMNSLINK")},postRenderReadOnly:function(n,t,i){var r=this;this.postRender(n,t,i)},getFormLinkXpath:function(){if(this.properties.maximized=bizagi.util.parseBoolean(this.properties.maximized)!=null?bizagi.util.parseBoolean(this.properties.maximized):!1,this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.button",{},{applyOverrides:function(n){var t=this,i=t.properties,r=t.getMode();this._super(n);n.configureHandlers=function(){var t=this,i=n.getControl(),r=$(":button",i);r.bind("click",function(){n.processButton.apply(t)})}},postRender:function(n,t){var i,u,f,r;this._super(n,t);i=this;u=i.getMode();this.setSurrogateKey(n);u=="execution"&&(f=this.getDecorated(n),r=f.getControl(),r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-button-mandatory-key")),i.isNewRow=!0):i.isNewRow=!1)},postRenderReadOnly:function(n,t){var i=this,r=i.properties;this._super(n,t)},renderReadOnly:function(n){var i=this,r,t=this.getDecorated(n),u;return i.setSurrogateKey(n),i.applyOverrides(t),t.grid=this.grid,t.column=this,t.surrogateKey=n,i.readyDeferred=new $.Deferred,u=this.properties.editable,t.properties.editable=!1,r=t.render("cell.button"),t.properties.editable=u,i.bind("rendered",function(){i.readyDeferred.resolve()}),r}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.actions",{},{postRender:function(n,t){var i=this,u,f,r;this._super(n,t);i.configureHandlersActions(n);i.configureControls(n);u=i.getMode();u=="execution"&&(f=this.getDecorated(n),r=f.getControl(),r.parents("tr").data("new-row")&&r.html(""))},configureControls:function(n){var t=this,i=t.getDecorated(n),r=i.element.find("#ui-icon-action-edit"),u=i.element.find("#ui-icon-action-trash"),f=i.element.find("#ui-icon-action-detail");r.attr("title",t.parent.properties.editLabel);u.attr("title",t.parent.properties.deleteLabel);f.attr("title",t.parent.properties.detailLabel);t.grid.columnActionParams.allowEdit&&t.grid.columnActionParams.withEditForm||r.hide();t.grid.columnActionParams.allowDelete||u.hide();t.grid.columnActionParams.allowDetail||f.hide()},configureHandlersActions:function(n){var t=this,i=t.getDecorated(n),r=i.element.find("#ui-icon-action-edit"),u=i.element.find("#ui-icon-action-trash"),f=i.element.find("#ui-icon-action-detail");r.click(function(){t.grid.editRow(n)});u.click(function(){t.grid.deleteRow(n)});f.click(function(){t.grid.showFormDetails(n)})}});
bizagi.rendering.columns.column.extend("bizagi.rendering.columns.exclusiveCheck",{},{render:function(n,t){var i=this,u,r,e,f;return(i.changed=!1,u=i.properties,r=i.getDecorated(n),r.grid=i.grid,r.column=this,r.surrogateKey=n,e=i.getMode(),i.grid.exclusiveChanges[i.properties.xpath]?i.grid.exclusiveChanges[i.properties.xpath].key===n?i.setValue(n,i.grid.exclusiveChanges[i.properties.xpath].value):i.setValue(n,!1):i.grid.originalEnabledChecks&&i.grid.originalEnabledChecks.length>1?i.setValue(n,!1):i.setValue(n,t),i.overrideDecoratedRenderProperties(n),!u.editable)?i.renderReadOnly.apply(i,arguments):(i.readyDeferred=new $.Deferred,f=r.render("cell"),r.bind("renderchange",function(){var u,r;i.changed=!0;u=i.grid.exclusiveChanges[i.properties.xpath]?i.grid.exclusiveChanges[i.properties.xpath].key:-1;u!==n&&i.clearOtherRows(n,t);r=i.properties.xpath.split(".");i.grid.exclusiveChanges[i.properties.xpath]={xpath:i.properties.xpath,simpleXpath:r[r.length-1],value:i.getValue(n),key:n}}),i.bind("rendered",function(){i.readyDeferred.resolve()}),f)},postRender:function(n,t){var i,u,f,r;this._super(n,t);i=this;u=i.getMode();this.setSurrogateKey(n);u=="execution"&&(f=this.getDecorated(n),r=f.getControl(),r.parents("tr").data("new-row")?(r.html('<input type="checkbox" name="exclusiveCheck" title="'+bizagi.localization.getResource("render-grid-column-button-mandatory-key")+'" disabled="disabled" style="width:16.5px;height:16.5px;">'),i.isNewRow=!0):i.isNewRow=!1)},clearOtherRows:function(n){for(var i,u,t=this,r=0;r<t.grid.properties.data.rows.length;r++)i=t.grid.properties.data.rows[r][0],i!==n&&(u=t.getDecorated(i),u.setDisplayValue(!1),t.setValue(i,!1))}});
$.Class.extend("bizagi.rendering.base.factory",{},{init:function(n){this.templates={};this.dataService=n},initAsyncStuff:function(){return $.when(this.loadTemplates())},loadTemplates:function(){},loadTemplate:function(n,t){var i=this;return bizagi.templateService.getTemplate(t,n).done(function(t){i.templates[n]=t})},getCommonTemplate:function(n){var t=this;return t.templates[n]},getContainer:function(n){var i=n.type,r=n.data,t=$.extend(n,{renderFactory:this,dataService:n.dataService||this.dataService});return i=="form"?new bizagi.rendering.form(t):i=="template"?new bizagi.rendering.formTemplate(t):i=="queryForm"?new bizagi.rendering.queryForm(t):i=="layout"?new bizagi.rendering.layout(t):i=="usersForm"?new bizagi.rendering.usersForm(t):i=="panel"?new bizagi.rendering.panel(t):i=="contentPanel"?new bizagi.rendering.contentPanel(t):i=="nestedForm"?new bizagi.rendering.nestedForm(t):i=="tab"?new bizagi.rendering.tab(t):i=="tabItem"?new bizagi.rendering.tabItem(t):i=="horizontal"?new bizagi.rendering.horizontal(t):i=="accordion"?new bizagi.rendering.accordion(t):i=="accordionItem"?new bizagi.rendering.accordionItem(t):i=="group"?new bizagi.rendering.group(t):i=="searchForm"?(t.context="search",t.contexttype="metadata",new bizagi.rendering.searchForm(t)):(bizagi.log(i+" not supported in render factory",r,"error"),null)},getRender:function(n){var t=n.type,r=n.data,i=$.extend(n,{renderFactory:this,dataService:n.dataService||this.dataService}),u,f;return(t||(t="label"),t=="text")?(u=bizagi.util.parseBoolean(r.properties.isExtended)||!1,u)?new bizagi.rendering.extendedText(i):new bizagi.rendering.text(i):t=="association"?new bizagi.rendering.association(i):t=="label"?new bizagi.rendering.label(i):t=="hidden"?new bizagi.rendering.hidden(i):t=="number"?new bizagi.rendering.number(i):t=="money"?new bizagi.rendering.money(i):t=="date"?new bizagi.rendering.date(i):t=="boolean"?(f=r.properties.display||"option",f=="check")?new bizagi.rendering.check(i):new bizagi.rendering.yesno(i):t=="combo"?new bizagi.rendering.combo(i):t=="cascadingCombo"?new bizagi.rendering.cascadingCombo(i):t=="list"?new bizagi.rendering.list(i):t=="radio"?new bizagi.rendering.radio(i):t=="image"?new bizagi.rendering.image(i):t=="uploadecm"?new bizagi.rendering.ecm(i):t=="upload"?new bizagi.rendering.upload(i):t=="grid"?new bizagi.rendering.grid(i):t=="groupedgrid"?new bizagi.rendering.grid(i):t=="search"?new bizagi.rendering.search(i):t=="searchList"?new bizagi.rendering.searchList(i):t=="letter"?new bizagi.rendering.letter(i):t=="button"?new bizagi.rendering.button(i):t=="formLink"?new bizagi.rendering.formLink(i):t=="link"?new bizagi.rendering.link(i):t=="layoutImage"?new bizagi.rendering.layoutImage(i):t=="layoutLink"?new bizagi.rendering.layoutLink(i):t=="layoutLabel"?new bizagi.rendering.layoutLabel(i):t=="layoutText"?new bizagi.rendering.layoutText(i):t=="layoutDateTime"?new bizagi.rendering.layoutDateTime(i):t=="layoutNumber"?new bizagi.rendering.layoutNumber(i):t=="layoutMoney"?new bizagi.rendering.layoutMoney(i):t=="layoutPlaceholder"?new bizagi.rendering.layoutPlaceholder(i):t=="actionLauncher"?new bizagi.rendering.actionLauncher(i):t=="layoutBoolean"?new bizagi.rendering.layoutBoolean(i):t=="layoutUpload"?new bizagi.rendering.layoutUpload(i):t=="entityTemplate"?new bizagi.rendering.entityTemplate(i):t=="polymorphicLauncher"?new bizagi.rendering.polymorphicLauncher(i):t=="userfield"?new bizagi.rendering.userfieldWrapper(i):t.indexOf("search")==0?this.getSearchRender(n):t.indexOf("query")==0?this.getQueryRender(n):t=="document"?new bizagi.rendering.document(i):t=="image"?new bizagi.rendering.image(i):t=="fileprint"?new bizagi.rendering.fileprint(i):t=="geolocation"?new bizagi.rendering.geolocation(i):t=="collectionnavigator"?new bizagi.rendering.collectionnavigator(i):t=="getUser"?new bizagi.rendering.getUser(i):t=="rangeDate"?new bizagi.rendering.rangeDate(i):t=="rangeMoney"?new bizagi.rendering.rangeMoney(i):t=="rangeNumber"?new bizagi.rendering.rangeNumber(i):t=="activityCheckList"?new bizagi.rendering.activityCheckList(i):(bizagi.log(t+" not supported in render factory",r,"error"),null)},getColumn:function(n){var i=n.type,r=n.data,t=$.extend(n,{renderFactory:this,dataService:n.dataService||this.dataService,singleInstance:bizagi.util.isEmpty(n.singleInstance)?!0:n.singleInstance}),u,f;if(i=="columnText")return u=bizagi.util.parseBoolean(r.properties.isExtended)||!1,t.decorated=u?bizagi.rendering.extendedText:bizagi.rendering.text,new bizagi.rendering.columns.text(t);if(i=="columnSearchList")return t.decorated=bizagi.rendering.searchList,new bizagi.rendering.columns.searchList(t);if(i=="columnNumber")return t.decorated=bizagi.rendering.number,new bizagi.rendering.columns.number(t);if(i=="columnMoney")return t.decorated=bizagi.rendering.money,new bizagi.rendering.columns.number(t);if(i=="columnDate")return t.decorated=bizagi.rendering.date,new bizagi.rendering.columns.date(t);if(i=="columnBoolean"){if(f=r.properties.display||"option",f=="check"){if(t.decorated=bizagi.rendering.check,n.data.properties.isExclusive)return new bizagi.rendering.columns.exclusiveCheck(t)}else t.decorated=bizagi.rendering.yesno;return new bizagi.rendering.columns.column(t)}return i=="columnCombo"?(t.decorated=bizagi.rendering.combo,new bizagi.rendering.columns.combo(t)):i=="columnRadio"?(t.decorated=bizagi.rendering.radio,new bizagi.rendering.columns.radio(t)):i=="columnList"?(t.decorated=bizagi.rendering.list,new bizagi.rendering.columns.list(t)):i=="columnHidden"?(t.decorated=bizagi.rendering.hidden,new bizagi.rendering.columns.column(t)):i=="columnUpload"?(t.decorated=bizagi.rendering.upload,new bizagi.rendering.columns.upload(t)):i=="columnImage"?(t.decorated=bizagi.rendering.image,new bizagi.rendering.columns.image(t)):i=="columnUploadEcm"?(t.decorated=bizagi.rendering.ecm,new bizagi.rendering.columns.uploadecm(t)):i=="columnLink"?(t.decorated=bizagi.rendering.link,new bizagi.rendering.columns.link(t)):i=="columnFormLink"?(t.decorated=bizagi.rendering.formLink,new bizagi.rendering.columns.link(t)):i=="columnUserfield"?(t.decorated=bizagi.rendering.userfieldWrapper,new bizagi.rendering.columns.column(t)):i=="columnSearch"?(t.decorated=bizagi.rendering.search,new bizagi.rendering.columns.search(t)):i=="columnLabel"?(t.decorated=bizagi.rendering.label,new bizagi.rendering.columns.column(t)):i=="columnReadonly"?(t.decorated=bizagi.rendering.label,new bizagi.rendering.columns.readonly(t)):i=="columnDocument"?(t.decorated=bizagi.rendering.document,new bizagi.rendering.columns.document(t)):i=="columnLetter"?(t.decorated=bizagi.rendering.letter,new bizagi.rendering.columns.letter(t)):i=="columnButton"?(t.decorated=bizagi.rendering.button,new bizagi.rendering.columns.button(t)):(bizagi.log(i+" not supported in render factory",r,"error"),null)},getSearchRender:function(n){var i=n.type,r=n.data,t=$.extend(n,{renderFactory:this,dataService:n.dataService||this.dataService}),u,f;return i=="searchText"?(u=bizagi.util.parseBoolean(r.properties.isExtended)||!1,u)?new bizagi.rendering.extendedText(t):new bizagi.rendering.text(t):i=="searchBoolean"?(f=r.properties.display||"option",f=="check")?new bizagi.rendering.check(t):new bizagi.rendering.yesno(t):i=="searchNumber"?r.properties.dataType==29?new bizagi.rendering.numberScientificNotation(t):new bizagi.rendering.number(t):i=="searchMoney"?new bizagi.rendering.money(t):i=="searchDate"?new bizagi.rendering.date(t):i=="searchCombo"?new bizagi.rendering.combo(t):i=="searchSuggest"?new bizagi.rendering.search(t):i=="searchLabel"?new bizagi.rendering.label(t):(bizagi.log(i+" not supported in render factory",r,"error"),null)},getQueryRender:function(n){var i=n.type,r=n.data,t=$.extend(n,{renderFactory:this,dataService:n.dataService||this.dataService}),u,f;return i=="queryText"?(u=bizagi.util.parseBoolean(r.properties.isExtended)||!1,u)?new bizagi.rendering.queryExtendedText(t):new bizagi.rendering.queryText(t):i=="queryBoolean"?(f=r.properties.display||"option",f=="check")?new bizagi.rendering.queryCheck(t):new bizagi.rendering.queryYesNo(t):i=="queryNumber"?new bizagi.rendering.queryNumber(t):i=="queryMoney"?new bizagi.rendering.queryMoney(t):i=="queryDate"?new bizagi.rendering.queryDate(t):i=="queryCombo"?new bizagi.rendering.queryCombo(t):i=="queryCascadingCombo"?new bizagi.rendering.queryCascadingCombo(t):i=="querySuggest"?new bizagi.rendering.querySuggest(t):i=="queryLabel"?new bizagi.rendering.queryLabel(t):i=="queryList"?new bizagi.rendering.queryList(t):i=="querySearch"?new bizagi.rendering.querySearch(t):i=="queryRadio"?new bizagi.rendering.queryRadio(t):i=="queryState"?new bizagi.rendering.queryState(t):i=="queryCaseState"?new bizagi.rendering.queryCaseState(t):i=="queryProcess"?new bizagi.rendering.queryProcess(t):i=="querySearchUser"?new bizagi.rendering.querySearchUser(t):i=="queryHidden"?new bizagi.rendering.hidden(t):(bizagi.log(i+" not supported in render factory",r,"error"),null)},getTemplate:function(n){var t=this;return t.templates[n]}});
bizagi.rendering.base.factory.extend("bizagi.rendering.desktop.factory",{},{init:function(n){var t=this;t._super(n);this.printVersion=!1},loadTemplates:function(){var n=this,t=new $.Deferred;return $.when(n.loadTemplate("form-error",bizagi.getTemplate("bizagi.rendering.desktop.form-error")),n.loadTemplate("form-waiting",bizagi.getTemplate("bizagi.rendering.desktop.form-waiting")),n.loadTemplate("info-message",bizagi.getTemplate("common.bizagi.desktop.info-message")),n.loadTemplate("form",bizagi.getTemplate("bizagi.rendering.desktop.form")+"#ui-bizagi-render-form"),n.loadTemplate("form-process-path",bizagi.getTemplate("bizagi.rendering.desktop.form")+"#ui-bizagi-render-form-process-path"),n.loadTemplate("panel",bizagi.getTemplate("bizagi.rendering.desktop.panel")),n.loadTemplate("contentPanel",bizagi.getTemplate("bizagi.rendering.desktop.contentPanel")),n.loadTemplate("tab",bizagi.getTemplate("bizagi.rendering.desktop.tab")),n.loadTemplate("tabItem",bizagi.getTemplate("bizagi.rendering.desktop.tabItem")),n.loadTemplate("collectionnavigator",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator"),n.loadTemplate("collectionnavigator-form-button",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-form-button"),n.loadTemplate("collectionnavigator-control",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-control"),n.loadTemplate("collectionnavigator-actions",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-actions"),n.loadTemplate("collectionnavigator-control-rtl",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-control-rtl"),n.loadTemplate("collectionnavigator-actions-rtl",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-actions-rtl"),n.loadTemplate("collectionnavigator-preview",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-preview"),n.loadTemplate("collectionnavigator-execution",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-execution"),n.loadTemplate("horizontal",bizagi.getTemplate("bizagi.rendering.desktop.horizontal")),n.loadTemplate("accordion",bizagi.getTemplate("bizagi.rendering.desktop.accordion")),n.loadTemplate("accordionItem",bizagi.getTemplate("bizagi.rendering.desktop.accordionItem")),n.loadTemplate("group",bizagi.getTemplate("bizagi.rendering.desktop.group")),n.loadTemplate("searchForm",bizagi.getTemplate("bizagi.rendering.desktop.searchForm")),n.loadTemplate("render",bizagi.getTemplate("bizagi.rendering.desktop.render")),n.loadTemplate("render-layout",bizagi.getTemplate("bizagi.rendering.desktop.render.layout")),n.loadTemplate("render-userPassword",bizagi.getTemplate("bizagi.rendering.desktop.userPassword")+"#bz-rendering-userPassword"),n.loadTemplate("render-getUser",bizagi.getTemplate("bizagi.rendering.desktop.getUser")+"#bz-rendering-getUser"),n.loadTemplate("render-user-email",bizagi.getTemplate("bizagi.rendering.desktop.userEmail")+"#bz-rendering-user-email"),n.loadTemplate("render-comboSelected",bizagi.getTemplate("bizagi.rendering.desktop.comboSelected")+"#bz-rendering-comboSelected"),n.loadTemplate("render-comboSelectedReadOnly",bizagi.getTemplate("bizagi.rendering.desktop.comboSelected")+"#bz-rendering-comboSelected-ReadOnly"),n.loadTemplate("render-querySearchUser",bizagi.getTemplate("bizagi.rendering.desktop.querySearchUser")+"#ui-bizagi-render-querySearchUser"),n.loadTemplate("text",bizagi.getTemplate("bizagi.rendering.desktop.text")+"#ui-bizagi-render-text"),n.loadTemplate("text-read-only",bizagi.getTemplate("bizagi.rendering.desktop.text")+"#ui-bizagi-render-text-read-only"),n.loadTemplate("extendedText",bizagi.getTemplate("bizagi.rendering.desktop.extendedText")),n.loadTemplate("number",bizagi.getTemplate("bizagi.rendering.desktop.number")),n.loadTemplate("numberScientificNotation",bizagi.getTemplate("bizagi.rendering.desktop.numberScientificNotation")+"#bz-rendering-numberScientificNotation"),n.loadTemplate("date",bizagi.getTemplate("bizagi.rendering.desktop.date")),n.loadTemplate("yesno",bizagi.getTemplate("bizagi.rendering.desktop.yesno")),n.loadTemplate("check",bizagi.getTemplate("bizagi.rendering.desktop.check")),n.loadTemplate("combo",bizagi.getTemplate("bizagi.rendering.desktop.combo")),n.loadTemplate("list",bizagi.getTemplate("bizagi.rendering.desktop.list")),n.loadTemplate("geolocation",bizagi.getTemplate("bizagi.rendering.desktop.geolocation")),n.loadTemplate("radio",bizagi.getTemplate("bizagi.rendering.desktop.radio")),n.loadTemplate("image",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-image"),n.loadTemplate("image-noflash",bizagi.getTemplate("bizagi.rendering.desktop.image.noflash")+"#ui-bizagi-render-image-noflash"),n.loadTemplate("image-html5",bizagi.getTemplate("bizagi.rendering.desktop.image.html5")+"#ui-bizagi-render-image-html5"),n.loadTemplate("image-dialog",bizagi.getTemplate("bizagi.rendering.desktop.image.noflash")+"#ui-bizagi-render-image-dialog-noflash"),n.loadTemplate("image-item",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-image-item"),n.loadTemplate("image-item-noflash",bizagi.getTemplate("bizagi.rendering.desktop.image.noflash")+"#ui-bizagi-render-image-item-noflash"),n.loadTemplate("image-item-html5",bizagi.getTemplate("bizagi.rendering.desktop.image.html5")+"#ui-bizagi-render-image-item-html5"),n.loadTemplate("upload-ecm-view-default",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default"),n.loadTemplate("upload-ecm-view-default-metadata",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-metadata"),n.loadTemplate("upload-ecm-view-default-yesno",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-yesno"),n.loadTemplate("upload-ecm-view-default-edit-buttons",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-edit-buttons"),n.loadTemplate("document",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator"),n.loadTemplate("document-item",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item"),n.loadTemplate("document-column-item",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-column-item"),n.loadTemplate("document-item-preview",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item-preview"),n.loadTemplate("document-item-preview-object",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item-preview-object"),n.loadTemplate("upload",bizagi.getTemplate("bizagi.rendering.desktop.upload")),n.loadTemplate("uploadItem",bizagi.getTemplate("bizagi.rendering.desktop.uploadItem")),n.loadTemplate("upload.noFlash",bizagi.getTemplate("bizagi.rendering.desktop.upload.noFlash")),n.loadTemplate("uploadHtml5",bizagi.getTemplate("bizagi.rendering.desktop.upload.html5")),n.loadTemplate("upload.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.dialog")),n.loadTemplate("upload.template.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.template.dialog")),n.loadTemplate("upload.ecm.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.ecm.dialog")),n.loadTemplate("dialog-send-email",bizagi.getTemplate("bizagi.rendering.desktop.dialog-sendEmail")+"#dialog-send-email"),n.loadTemplate("dialog-send-email-rtl",bizagi.getTemplate("bizagi.rendering.desktop.dialog-sendEmail")+"#dialog-send-email-rtl"),n.loadTemplate("grid",bizagi.getTemplate("bizagi.rendering.desktop.grid")),n.loadTemplate("cell",bizagi.getTemplate("bizagi.rendering.desktop.cell")),n.loadTemplate("cell.readonly",bizagi.getTemplate("bizagi.rendering.desktop.cell.readonly")),n.loadTemplate("cell.summary",bizagi.getTemplate("bizagi.rendering.desktop.cell.summary")),n.loadTemplate("cell.upload",bizagi.getTemplate("bizagi.rendering.desktop.cell.upload")),n.loadTemplate("cell.button",bizagi.getTemplate("bizagi.rendering.desktop.cell.button")),n.loadTemplate("search",bizagi.getTemplate("bizagi.rendering.desktop.search")),n.loadTemplate("searchItem",bizagi.getTemplate("bizagi.rendering.desktop.searchItem")),n.loadTemplate("searchList",bizagi.getTemplate("bizagi.rendering.desktop.searchList")),n.loadTemplate("letter",bizagi.getTemplate("bizagi.rendering.desktop.letter")),n.loadTemplate("letter.readonly",bizagi.getTemplate("bizagi.rendering.desktop.letter.readonly")),n.loadTemplate("letter.dialog",bizagi.getTemplate("bizagi.rendering.desktop.dialog-letter")),n.loadTemplate("button",bizagi.getTemplate("bizagi.rendering.desktop.button")),n.loadTemplate("fileprint",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint"),n.loadTemplate("fileprint-object",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint-object"),n.loadTemplate("fileprint-iframe",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint-iframe"),n.loadTemplate("link",bizagi.getTemplate("bizagi.rendering.desktop.link")),n.loadTemplate("association",bizagi.getTemplate("bizagi.rendering.desktop.association")),n.loadTemplate("stakeholder",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder"),n.loadTemplate("stakeholder-grid",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder-grid"),n.loadTemplate("stakeholder-paginator",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder-paginator"),n.loadTemplate("queryProcess",bizagi.getTemplate("bizagi.rendering.desktop.queryProcess")+"#ui-bizagi-render-query-process"),n.loadTemplate("checkList",bizagi.getTemplate("bizagi.rendering.desktop.checkList")),n.loadTemplate("layout-link",bizagi.getTemplate("bizagi.rendering.desktop.layout.link")),n.loadTemplate("layout-image",bizagi.getTemplate("bizagi.rendering.desktop.layout.image")+"#ui-bizagi-render-layout-image"),n.loadTemplate("layout-image64",bizagi.getTemplate("bizagi.rendering.desktop.layout.image")+"#ui-bizagi-render-layout-image64"),n.loadTemplate("layout-label",bizagi.getTemplate("bizagi.rendering.desktop.layout.label")),n.loadTemplate("layout-text",bizagi.getTemplate("bizagi.rendering.desktop.layout.text")),n.loadTemplate("layout-upload",bizagi.getTemplate("bizagi.rendering.desktop.layout.upload")),n.loadTemplate("layout-uploadItem",bizagi.getTemplate("bizagi.rendering.desktop.layout.uploadItem")),n.loadTemplate("layout-date-time",bizagi.getTemplate("bizagi.rendering.desktop.layout.dateTime")),n.loadTemplate("layout-number",bizagi.getTemplate("bizagi.rendering.desktop.layout.number")),n.loadTemplate("layout-money",bizagi.getTemplate("bizagi.rendering.desktop.layout.money")),n.loadTemplate("layout-placeholder",bizagi.getTemplate("bizagi.rendering.desktop.layout.placeholder")),n.loadTemplate("layout-boolean",bizagi.getTemplate("bizagi.rendering.desktop.layout.yesno")),n.loadTemplate("render-actionLauncher",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher"),n.loadTemplate("render-actionLauncher-horizontal",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),n.loadTemplate("render-actionLauncher-horizontal-more",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-horizontal-more"),n.loadTemplate("render-actionLauncher-vertical",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),n.loadTemplate("render-actionLauncher-actions-to-execute",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),n.loadTemplate("render-actionLauncher-design",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-design"),n.loadTemplate("render-actionLauncher-confirm",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-confirm"),n.loadTemplate("render-polymorphicLauncher",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),n.loadTemplate("render-polymorphicLauncher-vertical-tree",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),n.loadTemplate("render-polymorphicLauncher-vertical-tree-item",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),n.loadTemplate("render-polymorphicLauncher-actions-to-execute",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),n.loadTemplate("render-polymorphicLauncher-design",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-design"),n.loadTemplate("render-polymorphicLauncher-confirm",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),bizagi.override.enablePrintFromEditForm?n.loadTemplate("print-frame",bizagi.getTemplate("bizagi.workportal.desktop.widget.print")+"#bz-wp-widget-print-frame"):null,bizagi.override.enablePrintFromEditForm?n.loadTemplate("print-frame-header",bizagi.getTemplate("bizagi.workportal.desktop.widget.print")+"#bz-wp-widget-print-frame-header"):null,n.loadTemplate("grid.bizagi",bizagi.getTemplate("bizagi.rendering.desktop.grid.component")),n.loadTemplate("bizagi.grid.grid",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid"),n.loadTemplate("bizagi.grid.grid.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-rtl"),n.loadTemplate("bizagi.grid.waiting",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-waiting"),n.loadTemplate("bizagi.grid.table",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-table"),n.loadTemplate("bizagi.grid.table.empty",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-table-empty"),n.loadTemplate("bizagi.grid.column",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-column"),n.loadTemplate("bizagi.grid.column.special",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-column-special"),n.loadTemplate("bizagi.grid.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row"),n.loadTemplate("bizagi.grid.row.buttons",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row-buttons"),n.loadTemplate("bizagi.grid.row.buttons.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row-buttons-rtl"),n.loadTemplate("bizagi.grid.cell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-cell"),n.loadTemplate("bizagi.grid.cell.special",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-cell-special"),n.loadTemplate("bizagi.grid.pagination",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-pagination"),n.loadTemplate("bizagi.grid.pager",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-pager"),n.loadTemplate("bizagi.grid.buttons",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-buttons"),n.loadTemplate("bizagi.grid.buttons.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-buttons-rtl"),n.loadTemplate("bizagi.grid.dynamicpager",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-dynamic-pager"),n.loadTemplate("bizagi.grid.summary",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-summary"),n.loadTemplate("bizagi.grid.summaryCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-summary-cell"),n.loadTemplate("bizagi.grid.grouped.table",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-table"),n.loadTemplate("bizagi.grid.grouped.column",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-column"),n.loadTemplate("bizagi.grid.grouped.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-row"),n.loadTemplate("bizagi.grid.grouped.header.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-header-row"),n.loadTemplate("bizagi.grid.grouped.summary",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-summary"),n.loadTemplate("bizagi.grid.grouped.summaryCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-summary-cell"),n.loadTemplate("bizagi.grid.grouped.emptyCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-empty-cell"),n.loadTemplate("bizagi.plugin.search.user",bizagi.getTemplate("bizagi.plugin.searchuser")+"#ui-bizagi-plugin-search-user"),n.loadTemplate("gridActions",bizagi.getTemplate("bizagi.rendering.desktop.gridActions")),n.loadTemplate("render-range",bizagi.getTemplate("bizagi.rendering.desktop.range")+"#bz-rendering-range"),n.loadTemplate("bizagi.grid.exportOptions",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-export-options")).done(function(){t.resolve()}),t.promise()},getRender:function(n){var u=this,i=n.type,f=n.data,t=$.extend(n,{renderFactory:this,dataService:n.dataService||this.dataService}),r;return i=="image"?u.enableFlashControls&&u.hasFlash?new bizagi.rendering.image(t):typeof Windows=="undefined"?new bizagi.rendering.imageNoFlash(t):new bizagi.rendering.imageHtml5(t):i=="upload"?typeof Windows=="undefined"?new bizagi.rendering.uploadNoFlash(t):typeof bizagi.context.isOfflineForm!="undefined"&&bizagi.context.isOfflineForm?new bizagi.rendering.upload.offline(t):new bizagi.rendering.uploadHtml5(t):i=="uploadecm"?new bizagi.rendering.ecm(t):i=="grid"?(r=f.properties,typeof bizagi.context.isOfflineForm!="undefined"&&bizagi.context.isOfflineForm?new bizagi.rendering.grid.offline(t):new bizagi.rendering.grid.bizagi(t)):i=="groupedgrid"?(r=f.properties,new bizagi.rendering.grid.grouped(t)):i=="collectionnavigator"?new bizagi.rendering.collectionnavigator(t):i=="querySearchUser"?new bizagi.rendering.querySearchUser(t):i=="comboSelected"?new bizagi.rendering.comboSelected(t):i=="userPassword"?new bizagi.rendering.userPassword(t):i=="stakeholder"?new bizagi.rendering.stakeholder(t):i=="number"&&(r=f.properties,r&&r.dataType===29)?new bizagi.rendering.numberScientificNotation(t):u._super(n)},getColumn:function(n){var i=this,r=n.type,t=$.extend(n,{renderFactory:this,dataService:n.dataService||this.dataService,singleInstance:bizagi.util.isEmpty(n.singleInstance)?!0:n.singleInstance}),f,u;return r=="columnUpload"?typeof Windows=="undefined"?(t.decorated=i.enableFlashControls&&i.hasFlash?bizagi.rendering.upload:bizagi.rendering.uploadNoFlash,new bizagi.rendering.columns.upload(t)):(t.decorated=bizagi.rendering.uploadHtml5,new bizagi.rendering.columns.uploadHtml5(t)):r=="columnImage"?(t.decorated=i.enableFlashControls&&i.hasFlash?bizagi.rendering.image:bizagi.rendering.imageNoFlash,new bizagi.rendering.columns.image(t)):r=="columnNumber"&&(f=n.data,u=f.properties,u&&u.dataType===29)?(t.decorated=bizagi.rendering.numberScientificNotation,new bizagi.rendering.columns.numberScientificNotation(t)):r=="columnNumberScientificNotation"?(t.decorated=bizagi.rendering.numberScientificNotation,new bizagi.rendering.columns.numberScientificNotation(t)):r=="columnActions"?(t.decorated=bizagi.rendering.gridActions,new bizagi.rendering.columns.actions(t)):i._super(n)}});
bizagi.rendering.searchList.extend("bizagi.rendering.searchList",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,CLEAR_SEARCH_ID:-3,SEARCH_MIN_LENGTH:2},{postRender:function(){var n=this,t=n.getControl();this._super();n.searchInput=$("input",t);n.advancedSearch=$("button",t);n.isOffline=typeof bizagi.context.isOfflineForm!="undefined"&&bizagi.context.isOfflineForm;n.isOffline?(n.properties.submitOnChange=!1,$(".ui-bizagi-render-icon-search",t).hide()):n.properties.advancedSearch?t.addClass("ui-bizagi-advanced-search"):$(t).find("input").css({width:"100%","padding-right":"25px"});n.applyAutocompletePlugin();n.attachKeyEvents()},attachKeyEvents:function(){var n=this;n.element.keydown(function(t){var i,r;if(t=window.event||t,i=t.charCode||t.keyCode,t!==undefined)switch(i){case 8:r=$("input:first",n.element)[0].selectionStart;r===0&&(n.removeLastElement(),$("li:nth-last-child(2)",n.element).remove(),$(".biz-render-input-search",n.getControl()).focus())}})},applyAutocompletePlugin:function(){var n=this,i=n.getControl(),t=n.searchInput;t.autocomplete({autoFocus:!0,messages:{noResults:null,results:function(){}},source:function(t,i){var f;n.activeRequestTerm=t.term;var e=(new Date).getTime(),r=encodeURIComponent(t.term),o=n.properties.xpath+"_"+r+"_expire",s=n.properties.xpath+"_"+r,u=bizagi.util.getItemLocalStorage(o);if(u&&n.properties.enableLocalStorage&&e<u)try{f=JSON.parse(bizagi.util.getItemLocalStorage(s));i(f);n.hideAutocompleteLoading()}catch(h){n.processRequest(t,i)}else n.processRequest(t,i)},select:function(i,r){var f=JSON.parse(n.getValue()).value,u=!0;$.each(f,function(n,t){if(r.item.id==t.id)return u=!1});u&&n.appendFoundItem(i,r);t.autocomplete("close");r.item.value=""},open:function(){var i=t.data("ui-autocomplete").menu.element,r=t.closest(".ui-bizagi-control"),f=r.parent(),u=n.calculateSuggestionWidth(),e=t.data("ui-autocomplete").menu;$("li",i).each(function(){$(this).index()%2<1&&$(this).addClass("biz-ui-even")});i.css({top:0,left:0});r.addClass("ac-is-visible");f.addClass("ac-is-visible ac-clear-floats");i.appendTo(r).position({my:"left top",at:"left bottom",of:this,collision:"flipfit"});i.css("z-index",$.getMaxZindex()+10);i.attr("visible",!0);$(".ui-bizagi-render-search-item",i).width(u);i.width(u);n.hideAutocompleteLoading()},close:function(){t.data("ui-autocomplete").menu.element.attr("visible",!1)},delay:this.Class.SEARCH_DELAY,minLength:n.Class.SEARCH_MIN_LENGTH});t.data("ui-autocomplete")._renderItem=function(t,i){return i.id==n.Class.CLEAR_SEARCH_ID?n.renderClearItem(t,i).appendTo(t):i.id==n.Class.ADVANCED_SEARCH_ID?n.renderAdvancedItem(t,i).appendTo(t):i.id==n.Class.ADVANCED_ADDITION_ID?n.renderAddItem(t,i).appendTo(t):n.renderSearchItem(i).appendTo(t)};$(".closebutton",i).click(function(){n.deleteItem($(this))});$(".button-search",i).click(function(){n.showSearchDialog()})},appendFoundItem:function(n,t){var u=this;if(u.properties.orientation=="rtl"){var i=this.getControl(),r=$(".biz-render-input-search",i).closest("ul"),f=$("li:last",r),e=$('<li style="float:right;" "data-id="'+t.item.id+'"><label class= "biz-render-searchlist label">'+t.item.value+'<\/label><a class="closebuttonRtl"><\/a><\/li>');$(f).before(e);$(".closebuttonRtl:last",r).click(function(){u.deleteItem($(this))});$(".biz-render-input-search",i).data("selected","1");$(".biz-render-input-search",i).focus();$("li",r).removeClass("selected");this.addElement({id:t.item.id,value:t.item.value})}else{var i=this.getControl(),r=$(".biz-render-input-search",i).closest("ul"),f=$("li:last",r),e=$('<li data-id="'+t.item.id+'"><label>'+t.item.value+'<\/label><a class="closebutton"><\/a><\/li>');$(f).before(e);$(".closebutton:last",r).click(function(){u.deleteItem($(this))});$(".biz-render-input-search",i).data("selected","1");$(".biz-render-input-search",i).focus();$("li",r).removeClass("selected");this.addElement({id:t.item.id,value:t.item.value})}},deleteItem:function(n){var t=this,r=t.getControl(),i=n.parent("li");t.removeElement({id:i.data("id")});i.remove();$(".biz-render-input-search",r).focus()},renderSearchItem:function(n){var t=this,r=t.properties,u=t.renderFactory.getTemplate("searchItem"),i=$.tmpl(u,{image:r.searchImage,label:n.label,orientation:t.properties.orientation||"lrt"});return i.data("item.autocomplete",n),i},renderAdvancedItem:function(){var n=this,t=n.renderSearchItem({id:n.Class.ADVANCED_SEARCH_ID,label:this.getResource("render-search-advanced-label")});return t.click(function(){n.showSearchDialog()}),t},renderClearItem:function(){var n=this,t=n.renderSearchItem({id:n.Class.CLEAR_SEARCH_ID,label:this.getResource("render-search-clear-label")});return t.click(function(){n.setValue(null);n.submitData()}),t},renderAddItem:function(){var n=this,t=n.renderSearchItem({id:n.Class.ADVANCED_ADDITION_ID,label:this.getResource("render-search-add-label")});return t.click(function(){}),t},processRequest:function(n,t){var i=this,r=i.properties,u;i.showAutocompleteLoading();u=[];n.term.length>=this.Class.SEARCH_MIN_LENGTH&&(r.term=n.term,$.when(this.getData()).done(function(f){function e(n,u){var e,f,o,s;r.allowClear&&i.value!==undefined&&n.push({id:i.Class.CLEAR_SEARCH_ID,label:"",value:""});r.advancedSearch&&n.push({id:i.Class.ADVANCED_SEARCH_ID,label:"",value:""});r.allowAdd&&n.push({id:i.Class.ADVANCED_ADDITION_ID,label:"",value:""});e=(new Date).getTime()+i.properties.expireCache;f=encodeURIComponent(u);i.properties.enableLocalStorage&&(o=i.properties.xpath+"_"+f+"_expire",s=i.properties.xpath+"_"+f,bizagi.util.setItemLocalStorage(o,e),bizagi.util.setItemLocalStorage(s,JSON.encode(n)));t(n)}f=f.slice(0,r.maxRecords);f.length>50?(f=f.slice(0,50),u.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-search-maximum-records-allowed"),value:""})):f=f.slice(0,r.maxRecords);f&&f.length>0?$.each(f,function(t,i){if(r.maxRecords==0||t<r.maxRecords){var f;switch(typeof i.value){case"number":f=i.value;break;case"object":f=i.value.toString();break;case"string":f=i.value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(n.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1<\/strong>");break;default:f=i.value}u.push({id:i.id,label:f,value:i.value})}}):u.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-grid-no-records"),value:""});e(u,n.term);i.hideAutocompleteLoading()}))},showAutocompleteLoading:function(){var n=this,t=n.getControl();$("i",t).addClass("ui-autocomplete-loading")},hideAutocompleteLoading:function(){var n=this,t=n.getControl();$("i",t).removeClass("ui-autocomplete-loading")},calculateSuggestionWidth:function(){var n=this,t=n.searchInput.data("ui-autocomplete").menu.element;return t.width()},setDisplayValue:function(n){var t=this,i=t.properties;n!==undefined&&i.editable&&t.searchInput.val(n.label)},getDisplayValue:function(){return this.selectedValue},showAddRecordDialog:function(){var t=this,n=t.properties,i={text:bizagi.localization.getResource("render-form-dialog-box-add"),click:function(){var i=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{showSaveButton:n.editable,title:bizagi.localization.getResource("render-dialog-entity"),onSave:function(i){var r=i.idPageCache,u={action:"SAVE",data:i,idPageCache:r,guidEntity:n.entity,contexttype:"entity"};$.when(t.dataService.submitData(u)).done(function(){})}});i.render({idRender:n.id,idPageCache:n.idPageCache,requestedForm:"addForm",guidEntity:n.entity,contextType:"entity"}).fail(function(){})}};return{buttons:i}},showSearchDialog:function(){var t=this,f=t.getControl(),n=t.properties,e=$("li:[data-id]",f),i=!0,r,u;n.allowNew&&(r=t.showAddRecordDialog());u=new bizagi.rendering.dialog.search(t.dataService,t.renderFactory,n.searchForms,{allowFullSearch:n.allowFullSearch,maxRecords:n.maxRecord,multiSelect:!0},r);u.render({idRender:n.id,xpath:n.xpath,xpathContext:n.xpathContext,idPageCache:n.idPageCache}).done(function(n){var r=[];$.each(n.label,function(n,t){n!="id"&&r.push($(t).text())});$.each(e,function(t,r){$(r).data("id")==n.id&&(i=!1)});i&&t.appendFoundItem("",{item:{id:n.id,value:r.join(",")}})})},postRenderReadOnly:function(){var n=this,t=n.getControl(),i=n.properties,r=n.renderFactory.getTemplate("searchList");return t.empty(),$.tmpl(r,{value:i.value,hasSearchForm:i.searchForms?!0:!1,editable:!1}).appendTo(t)}});
bizagi.rendering.render.extend("bizagi.rendering.association",{},{initializeData:function(n){var i=this,t;i._super(n);t=i.properties;t.property="flipped";t.idRender=i.properties.id;t.allowFlip=typeof t.allowFlip!="undefined"?bizagi.util.parseBoolean(t.allowFlip):!0;t.flipped=typeof t.flipped!="undefined"?bizagi.util.parseBoolean(t.flipped):!1;t.flipstate=t.flipped;t.leftData=t.leftData||[];t.rightData=t.rightData||[];t.value&&i.processPropertyValue()},renderControl:function(){var n=this,i=n.renderFactory.getTemplate("association"),t=new $.Deferred;return n.properties.property="flipped",n.properties.idRender=n.properties.id,$.when(n.getFlipAssociation()).done(function(r){n.makeJsonBase();n.properties.flipped=bizagi.util.parseBoolean(r)||!1;var u=$.fasttmpl(i,n.properties,{getColumnData:n.getColumnData,getRightAssociation:n.getRightAssociation});n.setValue(JSON.encode(n.properties.formatJson));t.resolve(u)}),t.promise()},getFlipAssociation:function(){var n=this,t=n.getMode();return t=="execution"?n.dataService.getFlipAssociation(n.properties):!1},getDisplayValue:function(){var n=this;return n.getValue()},getTemplateName:function(){return"association"},getColumnData:function(){var i=this,n=i.data,t=[];return n.flipped?$.each(n.rightData,function(n,i){t.push({id:i.id,value:i.value})}):$.each(n.leftData,function(n,i){t.push({id:i.id,value:i.value})}),t},getRightAssociation:function(n){var u=this,t=u.data,i=[],r=function(n,i){var r=!1;return $.each(t.formatJson.value,function(t,u){!r&&u.id==n&&u.value.indexOf(i)>=0&&(r=!0)}),r};return t.flipped?$.each(t.leftData,function(t,u){i.push({id:u.id,name:u.value,checked:r(u.id,n)})}):$.each(t.rightData,function(t,u){i.push({id:u.id,name:u.value,checked:r(n,u.id)})}),i},removeElement:function(n,t){var i=this;$.each(i.properties.formatJson.value,function(r,u){i.properties.flipped?u.id==t&&$.each(i.properties.formatJson.value[r].value,function(t,u){n==u&&i.properties.formatJson.value[r].value.splice(t,1)}):u.id==n&&$.each(i.properties.formatJson.value[r].value,function(n,u){t==u&&i.properties.formatJson.value[r].value.splice(n,1)})});i.setValue(JSON.encode(i.properties.formatJson))},addElement:function(n,t){var i=this;$.each(i.properties.formatJson.value,function(r,u){i.properties.flipped?u.id==t&&i.properties.formatJson.value[r].value.push(n):u.id==n&&i.properties.formatJson.value[r].value.push(t)});i.setValue(JSON.encode(i.properties.formatJson))},makeJsonBase:function(){var n=this;n.properties.formatJson=n.properties.formatJson||{leftXpath:n.properties.leftXpath,rightXpath:n.properties.rightXpath,leftFactName:n.properties.leftFactName,rightFactName:n.properties.rightFactName,value:n.properties.value}},hasValue:function(){var t=this,i,n,u,r;for(i=t.properties.formatJson?t.properties.formatJson.value:t.properties.value,n=0,u=i.length;n<u;n++)if(r=i[n],r&&r.value.length>0)return!0;return!1},processPropertyValue:function(){for(var t,f=this,i=f.properties,r=i.value,u=[],n=0,e=r.length;n<e;n++)t=r[n],u.push({id:t[0],value:t[1]});i.value=u}});
bizagi.rendering.association.extend("bizagi.rendering.association",{},{postRender:function(){var n=this},configureHandlers:function(){var n=this,i=n.renderFactory.getTemplate("association"),t=n.getControl();n._super();$("ol .deleteBotton",t).bind("click",function(){n.closeElement($(this).parent("li"))});$(".bz-render-association-accordion",t).togglepanels({header:"> div > h3",autoHeight:!1,animated:!1});$.when(n.isRendered()).done(function(){var n=$(".bz-render-association-accordion h3",t).first();n.click()});n.properties.allowFlip&&$(".bz-render-association .flip-arrow",t).bind("click",function(){$(t).empty();n.properties.flipped=!n.properties.flipped;n.properties.flipstate=n.properties.flipped;n.dataService.getFlipAssociation(n.properties);$.tmpl(i,n.properties,{getColumnData:n.getColumnData,getRightAssociation:n.getRightAssociation}).appendTo(t);n.internalPostRender()});$(".bz-render-association bz-render-association-check-mask, .bz-render-association .bz-render-association-check",t).bind("click",function(t){t.stopPropagation();var i=$(this),r=$(this).parents("ol").data("id"),u=$(this).data("id");i.prop("checked")?(i.prop("checked",!0),n.addElement(r,u)):(i.prop("checked",!1),n.removeElement(r,u))});$(".bz-render-association .bz-render-association-left-container li",t).bind("click",function(t){t.stopPropagation();var r=$(this).find("input").length>0?$(this).find("input"):$(this),i=$(".bz-render-association-check-mask",$(this)),u=$(this).parent("ol").data("id"),f=$(this).data("id")||$(this).parents("li").data("id");r.prop("checked")?(r.removeAttr("checked"),i.removeClass("checked"),i.addClass("unchecked"),n.removeElement(u,f)):(r.prop("checked",!0),i.removeClass("unchecked"),i.addClass("checked"),n.addElement(u,f))})},setBindToClose:function(n){var t=this;n.find(".deleteBotton").bind("click",function(){t.closeElement($(this).parent("li"))})},closeElement:function(n){var t=this,i=n.parent("ol");t.removeElement($(i).data("id"),n.data("id"));n.hide("highlight",1e3,function(){$(this).remove()})},postRenderReadOnly:function(){var n=this,t=n.getControl(),i=n.renderFactory.getTemplate("association");n.properties.classCss="read-only";n.makeJsonBase();$.tmpl(i,n.properties,{getColumnData:n.getColumnData,getRightAssociation:n.getRightAssociation,getLeftName:n.getLeftName}).appendTo(t);$(".bz-render-association-accordion",t).togglepanels({header:"> div > h3",autoHeight:!1});$.when(n.isRendered()).done(function(){var n=$(".bz-render-association-accordion h3",t).first();n.click()});n.properties.allowFlip&&$(".bz-render-association .flip-arrow",t).bind("click",function(){$(t).empty();n.properties.flipped=!n.properties.flipped;n.postRenderReadOnly()})},collectData:function(n){var t=this;t._super(n)}});
bizagi.rendering.render.extend("bizagi.rendering.getUser",{},{init:function(n){this._super(n)},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("render-getUser");return $.fasttmpl(t,{})},renderReadOnly:function(){var n=this;return this.properties.value.length?n.properties.value[0].value:""},isValid:function(n){var t=this,r=t.properties,i=this._super(n),u=t.getValue();return i}});
bizagi.rendering.getUser.extend("bizagi.rendering.getUser",{},{postRender:function(){var n=this;n.input=$(".ui-bizagi-render-text",n.getControl());n.properties.value!=null&&n.properties.value.length>0&&n.setDisplayValue(n.properties.value[0]);this._super()},configureHandlers:function(){var n=this,t=n.getControl();n.bindSearchUserPlugin(t);$("#btn-clear-user",t).on("click",function(){n.clearValue()})},setDisplayValue:function(n){var t=this,r=t.getControl(),i=typeof n!="undefined"?n.value:null;t.properties.editable&&t.input.val(i);t.setValue(n,!1)},clearValue:function(){var n=this,t=n.getControl();n.input&&n.setDisplayValue("")},bindSearchUserPlugin:function(n){var t=this,i={title:t.getResource("render-plugin-search-users-title"),maximize:!1,filters:["domain","userName","fullName"],displayNames:[t.getResource("render-plugin-search-users-domain"),t.getResource("render-plugin-search-users-user-name"),t.getResource("render-plugin-search-users-full-name")],searchButtonName:t.getResource("render-plugin-search-users-search-button-name"),clearButtonName:t.getResource("render-plugin-search-users-clear-button-name"),valuesToSelect:["iduser","user"],selectItem:function(){var n=$.Deferred();return n.done(function(n){t.onItemSelectedSuccess(n)}).fail(function(n){bizagi.log(n)}),n},searchUsers:function(n){return t.dataService.getUsersList(n)},getTableTemplate:function(n,i,r,u){var f=t.renderFactory.getTemplate("bizagi.plugin.search.user");return $.tmpl(f,{users:n,links:[t.getResource("render-plugin-search-users-select-link")],page:i,pagination:r,pagesArray:u})},showError:function(n){bizagi.log(n)},showMessageBox:function(n){bizagi.showMessageBox(bizagi.localization.getResource(n),"Bizagi","warning")}},r;t.properties.xpath==="idDelegate"&&(i.editingUser=t.properties.idUser);opt=i;r=t.getParams();typeof r.isEntityForm!="undefinded"&&r.isEntityForm&&(i.allowAddUser=!0,i.dataService=t.dataService,i.renderFactory=t.renderFactory);$("#btn-get-user",n).bizagiSearchUser(i)},getOptions:function(){return opt},onItemSelectedSuccess:function(n){var t=this,r=t.getControl(),i={id:n.iduser,value:n.user};t.setDisplayValue(i)}});
bizagi.rendering.render.extend("bizagi.rendering.queryProcess",{},{init:function(n){this._super(n)},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("queryProcess");return $.fasttmpl(t,{})},loadtemplates:function(){}});
bizagi.rendering.queryProcess.extend("bizagi.rendering.queryProcess",{},{postRender:function(){var n=this,t,i;this._super();t=n.renderFactory.getTemplate("queryProcessWrapper");i=n.getControl();n.getElement("row").bind("click",function(){var t=n.getWrapper(),i;t.properties.visible?(t.element.hide(),t.element.css("visibility","hidden"),t.element.empty()):(t.element.show(),t.element.css("visibility","visible"),i=n.loadData("aplications"),n.renderData(i,t.element))})},getWrapper:function(){var i=this,n=i.getElement("wrapper"),t={element:n,properties:{}};return t.properties.visible=n.css("visibility")==="visible"?!0:!1,t},getElement:function(n){var t=this.getControl(),i={row:$(".ui-selectmenu-btn , .ui-bizagi-container-query-process :input[type=text]",t),wrapper:$(".ui-selectmenu-wrapper",t),linkApplication:$(".linkApplication",t)};return i[n]},loadData:function(n){var t;return n=="aplications"&&(t={items:[{id:1,displayName:"My App 1"},{id:2,displayName:"My App 2"},{id:3,displayName:"My App 3"}]}),n=="process"&&(t={items:[{id:4,displayName:"My Category 1",process:!1},{id:5,displayName:"My Process 1",process:!0},{id:6,displayName:"My Category 2",process:!1}]}),t},renderData:function(n,t){var i=this;$(t).empty();n.items[0].process===undefined&&t.append('<a class="linkApplication" data-idcategory="0" data-typeitem="process"><i class="biz-ico biz-wp-tree-icon biz-wp-tree-image-process"><\/i>All process <\/a>');$.each(n.items,function(n,i){var r,f,e,o,u,s;t.append('<a class="linkApplication" data-idCategory="'+i.id+'"><i  name="app" class="biz-wp-tree-icon biz-wp-tree-expand-icon"><\/i><i class="biz-ico biz-wp-tree-icon"><\/i>'+i.displayName+"<\/a>");r=$("[data-idCategory="+i.id+"]",t);i.process?(f=r.find("i").last(),f.addClass("biz-wp-tree-image-process"),r.find("i").first().remove(),r.css("margin-left","25px"),r.attr("data-typeItem","process")):(i.process==!1?(e=r.find("i").last(),e.addClass("biz-wp-tree-image-category"),r.attr("data-typeItem","category")):(o=r.find("i").last(),o.addClass("biz-wp-tree-image-application"),r.attr("data-typeItem","app")),u=$(t).attr("class")!="ui-selectmenu-wrapper"?$(t).attr("id").replace("category_",""):"",s=u!=""?"category_"+u+"-"+i.id:"category_"+i.id,t.append("<div class='ui-bizagi-contCategory' id='"+s+"'><\/div>"))});i.setupLinks(t)},setupLinks:function(n){var t=this;$(".linkApplication",n).on("click",function(){var h=$(this).attr("data-idCategory"),c=$(n).attr("class")!="ui-selectmenu-wrapper"?$(n).attr("id").replace("category_",""):"",i=c!=""?$("#category_"+c+"-"+h):$("#category_"+h),o,f,u,l;if($(this).attr("data-typeItem")=="process"){o=$(this).text();f=t.getWrapper();f.element.hide();f.element.css("visibility","hidden");var s="",e=this,r=[];if($(this).attr("data-idcategory")>0)while(s!="app"||s==null)e=$(e).closest("div").prev(),s=e[0].getAttribute("data-typeItem"),r.push(e.text());f.element.empty();r=r.reverse().join(" > ");r=r==""?o:r+=" > "+o;$(".ui-bizagi-container-query-process :input[type=text]").val(r)}else u=$(this).find("i").first(),i.css("visibility")==="visible"?(u.addClass("biz-wp-tree-expand-icon"),u.removeClass("biz-wp-tree-collapse-icon"),i.hide(),i.css("visibility","hidden"),i.empty()):(l=t.loadData("process"),u.removeClass("biz-wp-tree-expand-icon"),u.addClass("biz-wp-tree-collapse-icon"),i.show(),i.css("visibility","visible"),t.renderData(l,i))})}});
bizagi.rendering.render.extend("bizagi.rendering.querySearchUser",{},{init:function(n){this._super(n)},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("render-querySearchUser");return $.fasttmpl(t,{})},getUserData:function(n){var t=this,r=t.properties,i=new $.Deferred,e=t.getFormContainer(),u=e.getContextType()||!1,f;return n=n||{},t.properties.contexttype?n.h_contexttype=t.properties.contexttype:u&&(n.h_contexttype=u),f=[{id:1,value:"user1"},{id:2,value:"user2"},{id:3,value:"user3"},{id:4,value:"user4"},{id:5,value:"user5"},{id:6,value:"user6"},{id:7,value:"user7"},{id:8,value:"user8"},{id:9,value:"user9"},{id:10,value:"user10"}],r.data=f,i.resolve(r.data),i.promise(i)},setDisplayValue:function(n){var i=this,r=i.getControl(),u=i.getDisplayValue(),f=bizagi.util.decodeURI(n),e=bizagi.util.decodeURI(u),t;i.properties.editable==!1&&typeof n=="string"&&(t=e.replaceAll("&","&amp;"),t=t.replaceAll("<","&lt;").replaceAll(">","&gt;"),t=t.replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;"),t=t.replaceAll("\\n","<br/>"),t=t.replaceAll("\n","<br/>"),r.html(t));i.setValue(f,!1)},setValue:function(n){var t=this;t._super(n)}});
bizagi.rendering.querySearchUser.extend("bizagi.rendering.querySearchUser",{initializeData:function(n){this._super(n)},postRender:function(){var n=this;n.input=$(".ui-bizagi-render-text",n.getControl());this._super()},setDisplayValue:function(n){n=typeof n=="object"?typeof n[0]=="object"&&n[0].label!==undefined?n[0].label:n.label:"";var t=this,i=t.properties;this._super(n);!bizagi.util.isEmpty(n)&&i.editable&&t.input.val(n)},configureHandlers:function(){var n=this,t=n.getControl();n.bindSearchUserPlugin(t)},bindSearchUserPlugin:function(n){var t=this,i={title:t.getResource("render-plugin-search-users-title"),filters:["domain","userName","fullName"],displayNames:[t.getResource("render-plugin-search-users-domain"),t.getResource("render-plugin-search-users-user-name"),t.getResource("render-plugin-search-users-full-name")],searchButtonName:t.getResource("render-plugin-search-users-search-button-name"),clearButtonName:t.getResource("render-plugin-search-users-clear-button-name"),valuesToSelect:["iduser","username"],selectItem:function(){var n=$.Deferred();return n.done(function(n){t.onItemSelectedSuccess(n)}).fail(function(n){bizagi.log(n)}),n},searchUsers:function(n){return t.dataService.getUsersList(n)},getTableTemplate:function(n,i,r,u){var f=t.renderFactory.getTemplate("bizagi.plugin.search.user");return $.tmpl(f,{users:n,links:[t.getResource("render-plugin-search-users-select-link")],page:i,pagination:r,pagesArray:u})},showError:function(n){bizagi.log(n)},showMessageBox:function(n){bizagi.showMessageBox(bizagi.localization.getResource(n),"Bizagi","warning")}};opt=i;$("#btn-get-user",n).bizagiSearchUser(i)},getOptions:function(){return opt},onItemSelectedSuccess:function(n){var i=this,r=i.getControl(),t;$(".ui-bizagi-render-text",r).val(n.username);t={};t.id=n.iduser;t.label=n.username;t.value=n.username;i.setValue(t)}});
$.Class.extend("bizagi.rendering.device.factory",{},{init:function(){this.device=bizagi.util.detectDevice();this.cachedFactory=null},getRenderFactory:function(n,t){var i=this,r=new $.Deferred;if(i.cachedFactory!=null&&t=="")i.cachedFactory.printVersion=!1,r.resolve(i.cachedFactory);else{if(t==="print")return i.cachedFactory=new bizagi.rendering.print.factory(n),i.cachedFactory.initAsyncStuff().done(function(){r.resolve(i.cachedFactory)}),r.promise();if(this.device==="desktop")return i.cachedFactory=new bizagi.rendering.desktop.factory(n),i.cachedFactory.initAsyncStuff().done(function(){r.resolve(i.cachedFactory)}),r.promise();bizagi.util.isTabletDevice()?(i.cachedFactory=new bizagi.rendering.tablet.factory(n),i.cachedFactory.initAsyncStuff().done(function(){r.resolve(i.cachedFactory)})):bizagi.util.isSmartphoneDevice()?(i.cachedFactory=new bizagi.rendering.smartphone.factory(n),i.cachedFactory.initAsyncStuff().done(function(){r.resolve(i.cachedFactory)})):(alert("Not supported device: "+this.device),r.resolve(""))}return r.promise()},getDataService:function(){return this.dataService}});
bizagi.rendering=bizagi.rendering||{};$.Class.extend("bizagi.rendering.facade",{form:undefined,executionDeferred:new $.Deferred},{init:function(n){n=n||{};this.observableElement=$({});var t=n.device||"";this.deviceFactory=new bizagi.rendering.device.factory;this.dataService=new bizagi.render.services.service(n);this.renderFactory=this.deviceFactory.getRenderFactory(this.dataService,t)},getFactory:function(){var n=this;return{deviceFactory:n.deviceFactory,dataService:n.dataService,renderFactory:n.renderFactory}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)},update:function(n){var t=this;return n.mode&&(t.mode=n.mode),t.execute($.extend(n,{canvas:t.canvas,mode:t.mode}))},execute:function(n){var t=this,u=this.ownerDocument,f=$("body",u),r,i;return n=n||{},t.executionDeferred&&t.executionDeferred.state?t.executionDeferred.state()=="resolved"&&(t.executionDeferred=$.Deferred()):t.executionDeferred=$.Deferred(),bizagi.chrono.initAndStart("rendering+data",!0),bizagi.rendering.render.startOptimization(),typeof n.mode=="undefined"&&(bizagi.util.isEmpty(window.location.search)||(r=bizagi.util.getQueryString(),n.mode=r.mode)),i=t.canvas=n.canvas=n.canvas||$("<div />").appendTo(f),t.mode=n.mode,t.process(n).done(function(r){n.refreshing||i.empty();i.append(r.container);$(r.pathProcess).insertBefore(r.container);t.form=r;t.form.setSize({width:t.lastWidth,height:t.lastHeight});setTimeout(function(){t.lastWidth=$(window).width();t.lastHeight=$(window).height();window.self!==window.top&&t.resizeInPopUpHTML()},2e3);r.triggerHandler("ondomincluded");t.publish("rendering-formRendered",{});t.configureRefresh(r,i);t.configureRouting(r,i);t.configureRenderError(r,i);t.configureResize(r);t.configureGlobalHandlers(r);n.summaryForm&&r.container.addClass("ui-bizagi-summary-form");bizagi.chrono.stopAndLog("rendering");bizagi.chrono.stopAndLog("rendering+data");bizagi.chrono.stopAndLog("submitForm");bizagi.chrono.stopAndLog("submitForm-ajax");bizagi.chrono.stopAndLog("waiting");bizagi.rendering.render.stopOptimization();bizagi.override.enableE2EInterface&&(t.Class.form=t.form,t.Class.executionDeferred.resolve(t.form));t.executionDeferred.resolve(t.form)}).fail(function(n){$.when(t.renderFactory).done(function(r){(typeof n=="undefined"||n==="")&&(n=bizagi.localization.getResource("render-error-unknown"));var u=r.getCommonTemplate("form-error");i.empty();i.append($.tmpl(u,{message:n}));t.canvas.triggerHandler("errorform",n);bizagi.chrono.stopAndLog("rendering");bizagi.chrono.stopAndLog("rendering+data");t.executionDeferred.reject()})}),t.executionDeferred.promise()},ready:function(){return this.executionDeferred.promise()},process:function(n){var t=this,i=new $.Deferred,u=t.dataService.getFormData(n),r=t.canvas||n.canvas;return bizagi.showErrorAlertDialog=!1,$.when(u,t.renderFactory).done(function(u,f){var e;if(bizagi.showErrorAlertDialog=!0,bizagi.util.isEmpty(u)){t.publish("no-data-found");i.fail();return}if(u&&u.type=="reload")e=t.form,e&&(e.endLoading(),e.dispose()),r.triggerHandler("routing");else if(u&&u.type=="suspended"){var o=f.getTemplate("info-message"),s=bizagi.localization.getResource("render-case-suspended"),h=$.tmpl(o,{message:s});h.appendTo(r);i.fail()}else u&&u.type!="error"?(n.hasOwnProperty("printversion")&&(u=t.transformGridControl(u),u.form.properties.editable="False"),bizagi.chrono.initAndStart("rendering"),n.type=u.form&&u.form.properties.type||n.type,e=t.processForm(u.form,f,n),i.resolve(e)):t.getFailDeferred(u,i)}).fail(function(n){t.getFailDeferred(n,i)}),i.promise()},transformGridControl:function(n){var t=this;return n==null?n:(n.hasOwnProperty("type")&&n.type=="grid"?(n.id=n.id+"-print",n.allowAdd="False",n.allowDelete="False",n.allowEdit="False",n.allowGrouping="False",n.allowMore="False",n.allowSearch="False"):$.each(n,function(i,r){typeof r=="object"&&(n[i]=t.transformGridControl(n[i]))}),n)},getFailDeferred:function(n,t){var u=this,r="",i={};try{i=JSON.parse(n.responseText)}catch(f){i={message:n.responseText,errorType:"ERRORUNKNOWN"}}i.message?(r+="<br>Error Type: "+i.errorType,r+="<br>Error Message: "+i.message):i.errorType=="JSharpNotSupportedException"&&(r+="<br>Error Message: "+bizagi.localization.getResource("jsharp-required"));i.errorType=="ERRORUNKNOWN"?t.reject(r,i.errorType):t.reject(r)},processForm:function(n,t,i){var r=t.getContainer($.extend(i,{type:i.type||"form",data:n})),u;return typeof BIZAGI_ORIENTATION!="undefined"&&(r.properties.orientation=="rtl"||BIZAGI_ORIENTATION=="rtl")&&r.buttons.length>0&&(u=r.buttons[0],r.buttons.splice(0,1),r.buttons.push(u)),r.render(),r},resize:function(n){var t=this;t.form&&t.form.trigger("renderresize",n)},configureRefresh:function(n,t){var i=this;n.bind("refresh",function(r,u){var f=n.container.parent(),s,e,o;return f=bizagi.util.scrollTop(f),s=f.scrollTop(),$(i.form).trigger("onRefreshStarted"),n.dispose(u),t.fastEmpty(),e=t.parent(),e.find(".ui-bizagi-button-container").length>0&&e.find(".ui-bizagi-button-container").remove(),i.executionDeferred&&i.executionDeferred.state&&i.executionDeferred.state()=="resolved"&&(i.executionDeferred=$.Deferred()),o=i.form.getParams(),$.when(i.execute($.extend(u,{canvas:t,refreshing:!0,idCase:o.idCase,displayName:o.displayName}))).done(function(){setTimeout(function(){f.scrollTop(s);$(i.form).trigger("onRefreshFinished")},100)}),i.executionDeferred.promise()})},configureResize:function(n){var t=this;n.bind("renderresize",function(i,r){if(r=r||{},!t.resizeTimeout){var u=function(){var i=$(window).width(),u=$(window).height();(r.forceResize||i!=t.lastWidth)&&(bizagi.chrono.initAndStart("resize"),n.resize({width:i,height:u}),t.lastWidth=i,t.lastHeight=u,bizagi.chrono.stopAndLog("resize"),bizagi.chrono.log("resize"));t.resizeTimeout=null};t.resizeTimeout=setTimeout(u,0)}});t.resize()},configureRouting:function(n,t){n.bind("routing",function(i,r){n.dispose();t.triggerHandler("routing",r)})},configureGlobalHandlers:function(n){var t=this;n.bind("globalHandler",function(n,i){return t.publish(i.eventType,i.data)})},configureRenderError:function(n,t){var i=this;n.bind("formRenderingError",function(n,r){$.when(i.renderFactory).done(function(n){var f="<br>Error: ",u,e;r=r.replace(/(\r\n|\n|\r)/gm,"");u=JSON.parse(r);u.message&&(f+=u.message,f+="<br>Error Type: "+u.errorType);e=n.getCommonTemplate("form-error");t.empty();t.append($.tmpl(e,{message:f}));i.canvas.triggerHandler("errorform","renderItemError");bizagi.chrono.stopAndLog("rendering+data");bizagi.chrono.stopAndLog("rendering")})})},dispose:function(){var n=this;n.form&&n.form.dispose();bizagi.util.dispose(n)},resizeInPopUpHTML:function(){var u;if($(".activitiFormContainer").length>0&&bizagi.util.getQueryString().type!="cases"){var f=$(".activitiFormContainer").height()||0,i=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),n=$(".ui-bizagi-button-container",".activitiFormContainer"),r=n.outerHeight()||0,t=bizagi.util.getQueryString().renderBehavior||"";t=t.replace("#","");t=="PopUp"&&(typeof self.postMessageSocket=="undefined"?(u=$(".activitiFormContainer").height()-50||396,$("#render-canvas").height(u),$("#render-canvas").css("overflowY","scroll")):$(".activitiFormContainer").height($(".activitiFormContainer").height()+$(".ui-bizagi-button-container").height()+30),$(".ui-bizagi-button-container").css("position","absolute"),$(".ui-bizagi-button-container").appendTo(".activitiFormContainer"),$(".ui-bizagi-button-container").length>1&&($(".ui-bizagi-button-container:first").hide(),i.css("marginTop","-17px")));n.length>0&&i.height(f-97-r);$(".ui-bizagi-button-container").children().length==0?$("#render-canvas").height($("#render-canvas").height()+r):(n.width("100%"),n.css("marginLeft",0),n.css("bottom",0))}else bizagi.util.getQueryString().type=="render"&&($("html").css("overflowX","hidden"),$("#render").height()<=window.innerHeight+5?$("html").css("overflowY","hidden"):$("html").css("overflowY","scroll"),$(".ui-widget-overlay").height(650))}});
$.Class("bizagi.workportal.command.printform",{},{init:function(n){var t=this;t.renderFactory=n},print:function(n){var t=this,i=$.extend({},n);$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PRINT,modalParameters:{title:bizagi.localization.getResource("render-actions-print"),refreshInbox:!1},params:i,referrer:bizagi.hasOwnProperty("referrerParams")&&bizagi.referrerParams.hasOwnProperty("referrer")?bizagi.referrerParams.referrer:"inboxGrid",buttons:[{text:bizagi.localization.getResource("workportal-widget-dialog-box-print"),click:function(){var n=$(this),r=t.renderFactory.getTemplate("print-frame"),u=t.renderFactory.getTemplate("print-frame-header"),i=function(){var s="printer-"+(new Date).getTime(),h=$.tmpl(r,{printID:s}),l=$.tmpl(u,{environment:bizagi.loader.environment,productBuild:bizagi.loader.productBuildToAbout,build:bizagi.loader.build}),o,f,i,t,e,c;h.appendTo($("body:first"));o=window.frames[s];f=o.document;f.open();i='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';i+="<html style='overflow: visible !important'> <head> <title> <\/title>";i+=l[0].innerHTML;i+="<\/head> <body class='bz-wp-widget-print bz-wp-widget-print-load' style='overflow: visible !important'>";i+=$(".bz-wp-widget-print").html();i+="<\/body><\/html>";f.write(i);f.close();$(".ui-bizagi-cell-readonly",f).css("maxHeight","100%");bizagi.util.isIE()?(t=window.open("","","top=0,left=0,width=10,height=10"),e="",e+="<style>",e+="html{background:#293f55; color:#fff; text-align:center;}",e+="<\/style>",c="padding:10px auto; width:100%; text-align:center; font-family:Arial; font-size:12px;",t.document.open(),t.document.write(e+'<div id="loading-emp" style="'+c+'">'+bizagi.localization.getResource("webpart-render-loading")+"<\/div>"),t.document.close(),t.document.open(),t.document.write(i),t.document.close(),t.print(),t.close()):(o.focus(),setTimeout(function(){o.print()},500));setTimeout(function(){h.remove()},1e3);n.removeAttr("disabled")};n.attr("disabled","disabled");$("#bz-wp-widget-print").length===0?setTimeout(function(){i()},1e3):i()}}]})}});
bizagi.override.enableDeprecatedProperties=!0;
;
var renderInterface=function(){var n=this,t=function(){return{isRequired:function(){var n=this;return n.properties.required},getControl:function(){var n=this;return n.control},getDisplayNameObj:function(){var n=this;return n.getLabel()},getDisplayNameText:function(){var n=this;return n.properties.displayName},getValue:function(){var n=this;return n.value},getDisplayValueText:function(){var n=this;return n.getDisplayValue()},getFocus:function(){var n=this;return n.focus()?!0:!1},find:function(n){var t=this,i=t.getControl();return i.find(n)},getType:function(){var n=this;return n.properties.type},setControlValue:function(n){var t=this;t.setValue(n)},setControlDisplayValue:function(n){var t=this;t.setDisplayValue(n)}}}(),i=function(){return{getColumnByXpath:function(n){var t=this;return typeof n=="undefined"?{}:this.getColumn(n)},getColumnByName:function(n){var i=this,t={};return $.each(i.columns,function(i,r){r.properties.displayName===n&&(t=r)}),t},getRecord:function(n){var t=this;return $('[data-business-key="'+n+'"]',t.getControl())},getNewRows:function(){var n=this;return $('[data-new-row="true"]',n.getControl())},getCell:function(n,t){var i=this,r=i.getControlCell(n,t);return renderInterface.extendControlInterface(r)},getGridButtonsPanel:function(){var n=this;return $('[data-bizagi-component="buttons"]',n.getControl())},getGridPaginationPanel:function(){var n=this;return $('[data-bizagi-component="pager"]',n.getControl())},getGridHeaderPanel:function(){var n=this;return $('[data-bizagi-component="columns"]',n.getControl())}}}(),r=function(){return{getFiles:function(){var n=this,t=[];return n.files&&$.each(n.files,function(n,i){t.push(i[1])}),t},hasFile:function(n){var r=this,t=r.getFiles(),i=!1;return t.length>0&&$.each(t,function(t,r){r.indexOf(n)>=0&&(i=!0)}),i}}}(),u=function(){return{checkByName:function(n){var t=this,i=t.getControl(),r=$(".ui-bizagi-render-boolean-yesno label",i);$.each(r,function(t,i){i&&$.trim($(i).text())==n&&i.click()})},isChecked:function(n){var r=this,u=r.getControl(),t=$("label.ui-radio-state-checked",u),i=!1;return t.length>0&&$.each(t,function(t,r){r&&$.trim($(r).text())==n&&(i=!0)}),i}}}(),f=function(){return{getComboArrow:function(){var n=this;return $(".ui-selectmenu-btn",n.getControl())},getComboOptions:function(){var n=this;return $(".ui-select-dropdown ul",n.getControl().parent())}}}();return n._getInterface=function(n){var e;switch(n){case"generic":e=t;break;case"grid":e=i;break;case"upload":e=r;break;case"boolean":e=u;break;case"combo":e=f}return e},n._getExtendedInterfaceByControl=function(t){var f=typeof t!="undefined"&&t.properties&&t.properties.type?t.properties.type:"",r,i=[],u=function(n,t){return t.length>0&&$.each(t,function(t,i){typeof i=="object"&&$.each(i,function(t,i){n[t]=i})}),n};switch(f){case"grid":i=[n._getInterface("generic"),n._getInterface("grid")];r=u(t,i);break;case"upload":case"columnUpload":i=[n._getInterface("generic"),n._getInterface("upload")];r=u(t,i);break;case"boolean":case"columnBoolean":i=[n._getInterface("generic"),n._getInterface("boolean")];r=u(t,i);break;case"combo":case"columnCombo":i=[n._getInterface("generic"),n._getInterface("combo")];r=u(t,i);break;default:i=[n._getInterface("generic")];r=u(t,i)}return r},n._extendControlInterface=function(t){var i;if(t)return t.length&&t.length>1?(i=[],$.each(t,function(t,r){i.push(n._getExtendedInterfaceByControl(r))})):i=t.length&&t.length==1?n._getExtendedInterfaceByControl(t[0]):n._getExtendedInterfaceByControl(t),typeof i.focus=="function"?i.focus():"",i},{getInterface:n._getInterface,extendControlInterface:n._extendControlInterface}}();bizagi.e2e=function(){var n=this,i=!1,t=function(){i||(n.form=bizagi.rendering.facade.form,n.formReady=bizagi.rendering.facade.executionDeferred.promise(),n.form||$.when(n.formReady).done(function(t){n.form=t}).fail(function(n){console.log("Error: "+n.toString())}))};return bizagi.rendering.dialog.form.extend("bizagi.rendering.dialog.form",{},{renderDialogBox:function(t,r){$.when(this._super(t,r)).done(function(t){i=!0;n.form=t})},closeDialogBox:function(){i=!1;this._super()}}),bizagi.rendering.searchForm.extend("bizagi.rendering.searchForm",{},{configureHandlers:function(t){$.when(this._super(t)).done(function(t){i=!0;n.form=t.getFormContainer()})},closeDialogBox:function(){i=!1;this._super()}}),bizagi.rendering.dialog.search.extend("bizagi.rendering.dialog.search",{},{closeDialogBox:function(){i=!1;this._super()}}),n._getAllrenders=function(){return{rendersById:n.form.rendersById,rendersByXpath:n.form.rendersByXpath,rendersByType:n.form.rendersByType}},n._findRenderByProperty=function(t,i){var r=[],u=n._getAllrenders()||{};return t&&$.each(u.rendersById,function(n,u){u.properties.hasOwnProperty(t)&&u.properties[t]==i&&r.push(u)}),r},n.getRenderById=function(i){return t(),i=i||"",renderInterface.extendControlInterface(n.form.getRenderById(i))},n.getRenderByType=function(i){return t(),i=i||"",renderInterface.extendControlInterface(n.form.getRenderByType(i))},n.getRenderByXpath=function(i){return t(),i=i||"",renderInterface.extendControlInterface(n.form.getRender(i))},n.getRenderByDisplayName=function(i){return t(),renderInterface.extendControlInterface(n._findRenderByProperty("displayName",i))},n.getRenderByValue=function(i){return t(),renderInterface.extendControlInterface(n._findRenderByProperty("value",i))},n.getNotificationPanel=function(){return t(),function(){var t=function(){return $(".ui-bizagi-notifications-container-bottom .ui-bizagi-notifications-content")},n=function(){var n=[],i=$(".ui-bizagi-notification-item",t());return i.length>0&&$.each(i,function(t,i){n.push($.trim($(i).find("label").text()))}),n},i=function(t){var i=n(),r=!1;return t!==""&&i.length>0&&$.each(i,function(n,i){i.indexOf(t)>=0&&(r=!0)}),r};return{getMessages:n,hasMessage:i}}()},n.getFormButtonByCaption=function(i){t();var u=n.form.getButtons(),r=$("<button>");return $.each(u,function(n,t){t.value===i&&(r=t)}),r},n.getFormButtons=function(){return t(),n.form.getButtons()},n.ready=function(){return bizagi.rendering.facade.executionDeferred.state()==="resolved"?!0:!1},{getRenderById:n.getRenderById,getRenderByType:n.getRenderByType,getRenderByXpath:n.getRenderByXpath,getRenderByDisplayName:n.getRenderByDisplayName,getRenderByValue:n.getRenderByValue,getNotificationPanel:n.getNotificationPanel(),getFormButtonByCaption:n.getFormButtonByCaption,getFormButtons:n.getFormButtons,ready:n.ready}}();
bizagi.rendering.search.extend("bizagi.rendering.querySuggest",{},{getData:function(n){var i=this,t=i.properties,r=new $.Deferred,u=i.getFormContainer(),f=u.getContextType()||u.params.contexttype||!1;return n=n||{},i.properties.contexttype?n.h_contexttype=i.properties.contexttype:f&&(n.h_contexttype=f),n&&n.h_contexttype&&n.h_contexttype==="metadata"&&(t.xpathContext=""),i.dataService.multiaction().getSearchData({url:t.dataUrl,contexttype:"metadata",xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,term:t.allowFullSearch?"%"+t.term:t.term,extra:n}).done(function(n){t.data=n;r.resolve(t.data)}).fail(function(n){var t=n.hideStatus||!1;r.resolve({});t||i.trigger("onSearchError",n)}),r.promise(r)},renderClearItem:function(){var n=this,t=n.renderSearchItem({id:n.Class.CLEAR_SEARCH_ID,label:this.getResource("render-search-clear-label")});return t.click(function(){n.setValue({id:""});n.setDisplayValue("")}),t}});
bizagi.rendering.extendedText.extend("bizagi.rendering.queryExtendedText",{},{});
bizagi.rendering.text.extend("bizagi.rendering.queryText",{},{});
bizagi.rendering.check.extend("bizagi.rendering.queryCheck",{},{getValue:function(){return bizagi.util.parseBoolean(this.value)}});
bizagi.rendering.yesno.extend("bizagi.rendering.queryYesNo",{},{getValue:function(){return bizagi.util.parseBoolean(this.value)}});
bizagi.rendering.search.extend("bizagi.rendering.querySearch",{},{showSearchDialog:function(){var t=this,n=t.properties,i,r=n.searchForms.length>0&&n.searchForms[0].type=="searchForm"?"metadata":"entity";n.allowNew&&(i=t.showAddRecordDialog());t.searchDialog=new bizagi.rendering.dialog.search(t.dataService,t.renderFactory,n.searchForms,{allowFullSearch:n.allowFullSearch,maxRecords:n.maxRecords},i);t.searchDialog.render({idRender:n.id,xpath:n.xpath,xpathContext:n.xpathContext,idPageCache:n.idPageCache,contexttype:r}).done(function(n){data={id:n.id,value:n.id};t.setDisplayValue(data);t.setValue(data)})}});
bizagi.rendering.form.extend("bizagi.rendering.queryForm",{postRenderContainer:function(n){var t=this,i=[],r=t.container.find(".ui-bizagi-render-control-included-all");t._super(n);i=t.container.find(".ui-bizagi-render-control-included");i.length<=0&&r.parent().hide()},collectRenderValuesForSubmit:function(n){var i=this,t=[];return i.collectRenderValuesQueryForm(t),$.each(t,function(n,t){var r=i.getRenders(t.xpath);$.each(r,function(n,t){t.updateOriginalValue()})}),n.parameters=t,n},getSearchParams:function(n){var t=this,i;return t.validationController=new bizagi.command.controllers.validation(t,t.validations),i=t.validationController.performValidations(),i?t.collectRenderValuesForSubmit(n):(t.validationController.expandNotificationBox(),null)},configureHandlers:function(){var t=this,n;t._super();n=t.container.find(".ui-bizagi-render-control-included-all");n.tooltip({position:{my:"right-20 center",at:"right center"},tooltipClass:"bz-wp-queryForm-check-all"});n.change(function(){var i=n.is(":checked"),r=function(n){$.each(n.children,function(n,t){if(t.element){if(t.properties.visible===!0&&t.properties.includedInResult===!0){t.properties.included=i;var u=t.element.find(".ui-bizagi-render-control-included");u.prop("checked",i)}}else t.children&&r(t)})};r(t)})}});
bizagi.rendering.render.extend("bizagi.rendering.comboSelected",{},{init:function(n){this._super(n);self.properties=this.properties},renderControl:function(){var n=this,i=n.renderFactory.getTemplate("render-comboSelected"),t=n.filterData();return t=n.orderArraySelected(t),$.fasttmpl(i,{dataList:t})},orderArraySelected:function(n){var i=this,t=n;return t.sort(function(n,t){var i=n.value.toLowerCase(),r=t.value.toLowerCase();return i<r?-1:i>r?1:0})},filterData:function(){var n=this,t=[];return $.each(n.properties.data,function(i,r){var u=$.grep(n.properties.value,function(t){return n.properties.xpath=="Organizations"?t.id==r.id:t.id===r.id});u.length||t.push(r)}),t},renderControlReadOnly:function(){var n=this,t=n.renderFactory.getTemplate("render-comboSelectedReadOnly");return $.fasttmpl(t,{})}});
bizagi.rendering.comboSelected.extend("bizagi.rendering.comboSelected",{},{postRender:function(){var n=this,t=n.getControl();this._super();n.showInitialData(n.properties.value);n.selectedItemsToUpdate.length>=0&&$.each(n.selectedItemsToUpdate,function(n,i){$("#listBoxComboData",t).append("<option value='"+i.id+"'>"+i.value+" <\/option>")})},orderArrayList:function(){var n=this,t=n.properties.value,i=t.sort(function(n,t){var i=n.value!==undefined&&n.value!==null?n.value.toLowerCase():"",r=t.value!==undefined&&t.value!==null?t.value.toLowerCase():"";return i<r?-1:i>r?1:0});n.properties.value=i},configureHandlers:function(){var n=this,t=n.getControl();$("#move_right",t).click(function(){n.addItem()});$("#move_left",t).click(function(){n.removeItem()})},setDisplayValue:function(n){var t=this,i=t.getControl();t.setValue(n,!1)},addItem:function(){var n=this,t=n.getControl(),i=$("#selectionData option:selected",t),r=$("#listBoxComboData",t);$.each(i,function(t,i){var u={id:parseInt(i.value),value:i.text},f=$.grep(n.selectedItemsToUpdate,function(n){return n.id==u.id});f.length<=0&&(r.append("<option value='"+u.id+"'>"+u.value+" <\/option>"),n.selectedItemsToUpdate.push(u))});i.remove();n.setValue(n.selectedItemsToUpdate)},removeItem:function(){var n=this,t=n.getControl(),i=$("#listBoxComboData option:selected",t),r=$("#selectionData",t);$.each(i,function(t,i){var u={id:parseInt(i.value),value:i.text},f=$.grep(r,function(n){return n.id==u.id});f.length<=0&&(r.append("<option value='"+u.id+"'>"+u.value+" <\/option>"),n.selectedItemsToUpdate=$.grep(n.selectedItemsToUpdate,function(n){return n.id!=u.id}))});i.remove();n.setValue(n.selectedItemsToUpdate)},showListBoxComboData:function(){var t=this,n=t.getControl();$("#move_left",n).show();$("#bz-render-comboSelected-listBoxResults",n).show()},showInitialData:function(n){var t=this;t.orderArrayList();t.selectedItemsToUpdate=[];!n||$.each(n,function(n,i){t.selectedItemsToUpdate.push({id:i.id,value:i.value})})},postRenderReadOnly:function(){var n=this,t=n.getControl(),u=n.renderControlReadOnly(),i,r;t.append(u);n.showInitialData(n.properties.value);i="<ul>{{each datasource}}<li data-value='${id}'>${value}<\/li>{{/each}}<\/ul>";r=$.tmpl(i,{datasource:n.selectedItemsToUpdate});$("#bz-render-comboSelected-listBoxResults-ReadOnly",t).append(r)},hasValue:function(){var n=this,t=typeof n.value=="string"?JSON.parse(n.value).value:n.value;return!bizagi.util.isEmpty(t)},setValue:function(n,t){var i=this;t=t!==undefined?t:!0;i.properties.previousValue=i.properties.originalValue=JSON.stringify({value:i.value});i.value=i.properties.value=JSON.stringify({value:n});i.properties.required&&i.getMode()=="execution"&&(i.checkRequired([])?i.changeRequiredLabel(!1):i.changeRequiredLabel(!0));t&&!i.internalSetInitialValueFlag&&(i.triggerRenderChange(),i.triggerRenderValidate())}});
bizagi.rendering.form.extend("bizagi.rendering.usersForm",{init:function(n){var t=this;this.form=this.getFormContainer();this.observableElement=$({});this.collectedValues={};t._super(n)},startLoading:function(){var n=this,r=n.renderFactory.getTemplate("form-waiting"),t,i;n.waitingOverlay&&n.waitingMessage||(t=$(n.params.canvas).closest(".ui-dialog"),i=t.offset(),n.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(t),n.waitingMessage=$.tmpl(r).appendTo($("body",$(document))),n.waitingMessage.css({top:i.top+Math.ceil((t.height()-n.waitingMessage.outerHeight())/2)+"px",left:i.left+Math.ceil((t.width()-n.waitingMessage.outerWidth())/2)+"px"}))},processButtons:function(){var n=this,t=n.getButtons();t&&t.length!=0&&(n.properties.orientation=="rtl"&&n.buttons.reverse(),t.click(function(){var t=$(this),i=t.attr("ordinal"),r=n.buttons[i];n.processButton(r)}))},processButton:function(n){var t=this,i=t.properties;t.validationController.clearValidationMessages();$.when(t.ready()).done(function(){var i={formAction:"cancel",sendMail:!1};switch(n.action){case"save":var u=t.form.getRender("sendMail"),r=t.form.getRender("password"),i={formAction:"save",sendMail:u&&u.getValue()||!1,password:r===null?"":r.getValue()};u&&r&&i.sendMail&&i.password===""?$.when(t.dataService.getConfiguration()).done(function(n){var u=n.passwordMinLength,f=n.passwordMaxLength;t.generateRandomPassword(r,u,f);i.password=r.getValue();t.processSave(i)}).fail(function(n){t.generateRandomPassword(r,8,12);i.password=r.getValue();t.processSave(i);var u=JSON.parse(n.responseText);t.validationController.showValidationMessage(u.message)}):t.processSave(i);break;case"cancel":t.triggerHandler("endUsersForm",i)}})},processSave:function(n){var t=this,u=t.validationController.performValidations(),r,i;u?(t.startLoading(),$.extend(t.collectedValues,t.collectRenderValuesForSubmit()),i={action:"SAVEUSER",contexttype:"entity",data:{},idPageCache:t.idPageCache},delete t.collectedValues.sendMail,delete t.collectedValues["@Metadata.Stakeholders"],t.params.action==="add"?r=t.createUser(i,n):t.params.action==="edit"&&(r=t.updateUser(i)),$.extend(n,i.data),$.when(r).done(function(){t.triggerHandler("endUsersForm",n)}).fail(function(i){var r=JSON.parse(i.responseText);t.endLoading();t.validationController.showValidationMessage(r.message);t.triggerHandler("endUsersForm",$.extend(n,{error:r}))})):t.validationController.expandNotificationBox()},generateRandomPassword:function(n,t,i){for(var r,o=this,s=o.getLengthPassword(t,i),u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz",f="",e=0;e<s;e++)r=Math.floor(Math.random()*u.length),f+=u.substring(r,r+1);n.saveValue(f)},getLengthPassword:function(n,t){return n=n&&t?n:8,t=t&&n?t:12,Math.floor(Math.random()*(t-(n-1)))+n},createUser:function(n,t){var r=this,i=r.collectedValues,u=r.form.getRender("expiredAccount"),f=r.form.getRender("lockedAccount"),e=r.form.getRender("domain");return i.expiredAccount=u?u.getValue():null,i.lockedAccount=f?f.getValue():null,i.domain=e?e.getValue():"",$.extend(n,{data:{domain:i.domain,fullName:i.fullName,userName:i.userName}}),$.when(r.dataService.submitData(n)).pipe(function(u){return r.params.action="edit",r.params.userId=u.idEntity,delete i.userName,delete i.domain,$.extend(n,{data:i,surrogatekey:u.idEntity}),$.extend(t,{userId:u.idEntity}),r.dataService.submitData(n)})},updateUser:function(n){var t=this,i=t.collectedValues;return $.extend(n,{surrogatekey:t.params.userId,data:i}),t.dataService.submitData(n)}});
bizagi.rendering.render.extend("bizagi.rendering.userPassword",{},{init:function(n){this._super(n);this.properties.value=null;self.properties=this.properties},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("render-userPassword");return $.fasttmpl(t,{valuePassword:n.properties.value})},isValid:function(n){var t=this,r=t.properties,i=this._super(n),u=t.getValue();return i}});
bizagi.rendering.render.extend("bizagi.rendering.stakeholder",{},{init:function(n){this._super(n);typeof this.properties.value=="undefined"&&(this.properties.value=[]);typeof this.properties.data=="undefined"&&(this.properties.data=[]);self.properties=this.properties},renderControl:function(){var n=this,t=n.renderFactory.getTemplate("stakeholder"),i={currentUser:bizagi.currentUser.userName,userNames:typeof n.properties.value=="string"?JSON.parse(n.properties.value).value:n.properties.value,entities:n.properties.data};return $.fasttmpl(t,i)},getData:function(n,t,i,r,u){var f=this,e;return(typeof t=="undefined"||t==null)&&(t="1"),e={pxpath:n,prows:"10",ppage:t.toString(),xpath:n,idRender:f.properties.id,xpathContext:f.properties.xpathContext,idPageCache:f.properties.idPageCache,property:"dataxpath",contexttype:"entity",pfilter:i,psort:r},u&&(e.porder=u),f.dataService.multiaction().getPropertyData(e)},associatedUser:function(n,t,i){var r=this;return r.dataService.associateStakeholder({idPageCache:r.properties.idPageCache,contexttype:"entity",surrogateKey:parseInt(n),associatedUser:JSON.encode({dataType:"Int",value:i=="null"?i:parseInt(i)}),guidentity:t})},refreshStakeholderList:function(){var n=this;return n.dataService.refreshAssociateStakeholder({idRender:n.properties.id,contexttype:"entity",property:"value",idPageCache:n.properties.idPageCache})}});
bizagi.rendering.stakeholder.extend("bizagi.rendering.stakeholder",{},{postRender:function(){var n=this,i=n.getControl(),t=$(".ui-bizagi-render-stakeholder-container").closest(".ui-bizagi-control.ui-bizagi-render-align-left ");t.css("width","100%");t.prev().css("display","none");n.maxElemShow=10;n.maxPageToShow=5;n.selectedItems=[];n.valueXpath;n.guidEntity;n.currentPage;this._super()},configureHandlers:function(){var n=this,t=n.getControl();$("#ui-bizagi-render-stakeholder-add",t).click($.proxy(n.addInstance,n));$(".ui-bizagi-render-stakeholder-entity-row",t).click($.proxy(n.addGrid,n));$(".ui-bizagi-render-stakeholder-back",t).click($.proxy(n.goToBack,n));$(".ui-bizagi-render-stakeholder-link",t).click($.proxy(n.removeAssociated,n));$(".ui-bizagi-render-stakeholder-search",t).keyup($.proxy(n.onKeyUpFilter,n));t.on("click","table .sortColumnsData-stakeholder",function(t){var i=$(t.currentTarget),r=i.data("orderfield"),u=i.data("ordertype");n.gridDataService(n.currentPage,null,r,u==="DESC"?"ASC":"DESC")})},goToBack:function(){var t=this,n=t.getControl();t.status==="step1"?($("#ui-bizagi-render-stakeholder-entity-list",n).hide(),$("#ui-bizagi-render-stakeholder-add-instance",n).hide(),$("#ui-bizagi-render-stakeholder-associated-list",n).show(),$(".ui-bizagi-render-stakeholder-associated",n).show(),$("#ui-bizagi-render-stakeholder-add",n).show(),$(".ui-bizagi-render-stakeholder-back",n).hide(),t.status=null):t.status==="step2"&&($("#ui-bizagi-render-stakeholder-grid",n).hide(),$("#ui-bizagi-render-stakeholder-add-instance",n).show(),t.status="step1")},addInstance:function(){var t=this,n=t.getControl();t.status="step1";$("#ui-bizagi-render-stakeholder-associated-list",n).hide();$(".ui-bizagi-render-stakeholder-associated",n).hide();$("#ui-bizagi-render-stakeholder-add",n).hide();$("#ui-bizagi-render-stakeholder-entity-list",n).show();$("#ui-bizagi-render-stakeholder-add-instance",n).show();$(".ui-bizagi-render-stakeholder-back",n).show();$(".ui-bizagi-render-stakeholder-entity-row").removeClass("ui-bizagi-render-stakeholder-selected")},addGrid:function(n){var t=this,i=t.getControl();t.valueXpath=$(n.currentTarget).attr("data-value");t.guidEntity=$(n.currentTarget).attr("guid-entity");t.status="step2";$(".ui-bizagi-render-stakeholder-entity-row").removeClass("ui-bizagi-render-stakeholder-selected");$(n.currentTarget).addClass("ui-bizagi-render-stakeholder-selected");$("#ui-bizagi-render-stakeholder-add-instance",i).hide();$("#ui-bizagi-render-stakeholder-grid",i).show();$(".ui-bizagi-render-stakeholder-search",i).val("");t.gridDataService(null,"","","DESC")},gridDataService:function(n,t,i,r){var u=this;u.getData(u.valueXpath,n,t,i,r).done(function(n){u.onGetData(n,r)}).fail(function(n){u.onGetDataFail(n)})},onGetData:function(n,t){var i=this,e=i.getControl(),nt=i.renderFactory.getTemplate("stakeholder-grid"),b,l,v,r,o,s,h,u,k,d,g,f,c,y;if(i.currentPage=n.page,n.rows.length>0){var p=n.rows[0][1],a=p.slice(1,p.length),w=[];for(u=0;u<a.length;u++)b={name:a[u][0],displayName:a[u][1],orderType:t},w.push(b);for(l=i.selectedItems[i.valueXpath],$.each(n.rows,function(n,t){var r=t[2][0][0];if(!l&&r!=undefined||l&&r==l.id){i.selectedItems[i.valueXpath]={id:t[0],idInstance:r,nameInstance:t[2][0][1]};return}}),i.selectedItems[i.valueXpath]&&i.selectedItems[i.valueXpath].idUser=="null"&&delete i.selectedItems[i.valueXpath],v=[],r=0;r<n.rows.length;r++){for(o="",s="",n.rows[r][2][0][0]&&n.rows[r][2][0][0]!=i.properties.idUser?(o="associatedWithAnotherUser",s=bizagi.localization.getResource("render-stakeholder-link-tooltip-associate-another-user").replace("{0}",n.rows[r][2][0][1])):n.rows[r][2][0][0]==i.properties.idUser?(o="associateMe",s=bizagi.localization.getResource("render-stakeholder-link-tooltip-associate")):(o="unassociated",s=bizagi.localization.getResource("render-stakeholder-link-tooltip-unassociate")),h={},h.columns=[],h.columns.push({stateInstance:o,value:n.rows[r][0],tooltipLink:s}),u=0;u<n.rows[r][2].length;u++)u>0&&h.columns.push({value:n.rows[r][2][u]});v.push(h)}for(k=$.tmpl(nt,{datasource:v,columns:w,tooltipUnassociated:bizagi.localization.getResource("render-stakeholder-link-tooltip-unassociate")}),$(".ui-bizagi-render-stakeholder-items-grid-content",e).empty().append(k),d=i.renderFactory.getTemplate("stakeholder-paginator"),i.totalRecords=n.records,i.totalPages=n.total,g=i.maxPageToShow>i.totalPages?i.totalPages:i.maxPageToShow,f={},f.pagination=i.totalPages>1,f.page=n.page,f.pages={},c=1;c<=g;c++)f.pages[c]={pageNumber:c};paginationHtml=$.tmpl(d,f).html();$(".ui-bizagi-render-stakeholder-paginator",e).empty().append(paginationHtml);y=$(".ui-bizagi-render-stakeholder-paginator ul",e);y.bizagiPagination({maxElemShow:i.maxPageToShow,totalPages:i.totalPages,actualPage:i.currentPage,listElement:y,clickCallBack:function(n){i.gridDataService(n.page)}});i.setRowsEvents()}else $(".ui-bizagi-render-stakeholder-items-grid-content",e).empty(),$(".ui-bizagi-render-stakeholder-paginator",e).empty()},onGetDataFail:function(n){console.log("process property value error: "+n)},setRowsEvents:function(){var n=this;$(".ui-bizagi-render-stakeholder-table-link").click($.proxy(n.onLinkClick,n))},onLinkClick:function(n){function u(n){$(n.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-link-close")?($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-link-close"),i="null"):($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-link-close"),$(n.currentTarget).addClass("ui-bizagi-render-stakeholder-table-link-close"),i=t.properties.idUser);t.selectedItems[t.valueXpath]={id:r,idUser:i};t.associatedUser(r,t.guidEntity,i).done(function(){t.refreshStakeholderValue();$(n.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user")&&($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user"),$(n.currentTarget).addClass("ui-bizagi-render-stakeholder-table-link-close"),i=t.properties.idUser,t.associatedUser(r,t.guidEntity,i).done(function(){t.refreshStakeholderValue()}).fail(function(n){t.onStakeAssociatedFail(n)}))}).fail(function(n){t.onStakeAssociatedFail(n)})}var t=this,i,r=$(n.currentTarget).attr("data-value"),f;$(n.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-link-close")&&$(n.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user")?(f=bizagi.localization.getResource("render-stakeholder-delete-associate-instance-other-user-confirm-msg"),$.when(bizagi.showConfirmationBox(f,"Bizagi","warning")).done(function(){u(n)})):u(n)},removeAssociated:function(n){var t=this,r=$(n.currentTarget).attr("data-value"),i;t.guidEntity=$(n.currentTarget).attr("guid-entity");i="null";t.selectedItems[t.valueXpath]={id:r,idUser:i};t.associatedUser(r,t.guidEntity,i).done(function(){t.refreshStakeholderValue()}).fail(function(n){t.onStakeAssociatedFail(n)})},onKeyUpFilter:function(n){var i=this,t;n.keyCode==13&&(t=$(n.target).val(),i.gridDataService(null,t))},refreshStakeholderValue:function(){var n=this,t=n.getControl();n.refreshStakeholderList().done(function(i){n.setValue(i);t.empty().append(n.renderControl());n.configureHandlers()}).fail(function(t){n.onStakeAssociatedFail(t)})},onStakeAssociatedFail:function(n){console.log("stakeholder associated error: "+n)},setDisplayValue:function(n){var t=this;t.setValue(n)},setValue:function(n){var t=this;t.properties.previousValue=t.properties.originalValue=JSON.stringify({value:t.value});t.value=t.properties.value=JSON.stringify({value:n})}});
bizagi.rendering.userPassword.extend("bizagi.rendering.userPassword",{},{postRender:function(){var n=this,t=n.getControl();this._super();n.input=t.find("input");n.properties.maxLength>0&&n.input.attr("maxlength",n.properties.maxLength)},configureHandlers:function(){var n=this,t=n.getControl();n.input.bind("change",function(){var t=n.input.val();t!==""?n.saveValue(t):n.setValue(t)}).keypress(function(n){n=window.event||n;var t=n.charCode||n.keyCode;n!==undefined&&t==13&&$(this).trigger("change")})},saveValue:function(n){var i=this,t=CryptoJS,r=t.enc.Utf8.parse("pc30n84e15lvdD68"),u=CryptoJS.enc.Latin1.parse("1v00628X62bJE2mi"),f=t.algo.AES.createEncryptor(r,{mode:t.mode.CBC,padding:t.pad.Pkcs7,iv:u}),e=f.finalize(n),o=t.enc.Base64.stringify(e);i.setValue(o)},postRenderReadOnly:function(){var n=this,t=n.getControl(),i=$.tmpl("<label class='readonly-control'><\/label>",{});t.append(i)}});
bizagi.rendering.render.extend("bizagi.rendering.gridActions",{},{renderControl:function(){var n=this,i=n.properties,t=n.renderFactory.getTemplate("gridActions");return $.fasttmpl(t,{})}});
bizagi.rendering.numberScientificNotation.extend("bizagi.rendering.numberScientificNotation",{},{postRender:function(){var n=this;n._super();n.attachFormatScientificNotation()},setDisplayValue:function(n){var t=this;n=bizagi.util.scientificNotationFormat(n.replace(t.properties.decimalSymbol,"."));n!=null&&t.properties.editable&&(t.numericInput.val(n.replace(".",t.properties.decimalSymbol)),t.setValue(n));this._super(n.replace(".",t.properties.decimalSymbol))},attachFormatScientificNotation:function(){var n=this;n.numericInput.blur(function(){var i=n.numericInput.val(),t=bizagi.util.scientificNotationFormat(i,n.properties.decimalSymbol);n.setValue(t);n.numericInput.val(t)})}});
bizagi.rendering.render.extend("bizagi.rendering.actionLauncher",{},{init:function(n){this._super(n)},initializeData:function(n){var t=this,i,u,r,f;this._super(n);i=t.getFormContainer();this.typeForm=i.properties.typeForm||"";u=t.getMode();r=t.properties;t.deferredActions=new $.Deferred;t.deferredActions.promise();u=="execution"&&(t.engine=new bizagi.templateEngine({renderFactory:t.renderFactory,cache:!0,autoGenerateData:!1,templateGuid:r.selecttemplate}));t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",psurrogatedKey:t.properties.surrogatedKey,ptags:t.properties.tagslist||[],pmaxitems:t.properties.maxItems,pactionXpath:t.properties.xpathActions};t.processPropertyValueDataTmplArgs={pactionXpath:t.properties.xpathActions,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,ptemplateGuid:r.selecttemplate,property:"dataTemplate",xpathActions:t.properties.xpathActions};t.properties.valueWidth=100;t.properties.displayType="value";f=n.properties.type==="entityTemplate"?!1:!0;t.properties.allowactions=typeof n.properties.allowactions=="undefined"?f:n.properties.allowactions;t.properties.isHorizontal=typeof n.properties.isHorizontal=="undefined"?!0:n.properties.isHorizontal;t.properties.allowSearch=typeof n.properties.allowSearch=="undefined"?!1:n.properties.allowSearch;t.properties.selecttemplate=typeof n.properties.selecttemplate=="undefined"?"":n.properties.selecttemplate;t.properties.templatetype=typeof r.templatetype!="undefined"?r.templatetype:"none";t.properties.value?typeof t.properties.value=="string"&&(t.properties.value=t.value=JSON.parse(t.properties.value)):(t.properties.value=t.value=[],t.properties.originalValue=[])},executeActionImmediately:function(n){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeAction",psurrogatedKey:t.properties.surrogatedKey,pguidAction:n.guidAction,pparameters:JSON.encode({idStartScope:n.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:n.idPageCache})};t.dataService.executeActions(r).done(function(i){t.notifyExecution(i,n)}).fail(function(){t.notifyExecution("Error",n)})},notifyExecution:function(){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0;this.postRender()},renderControl:function(){var t=this,n=t.properties,f=t.getMode(),i,r="",u;return f=="design"?(i=t.renderFactory.getTemplate("render-actionLauncher-design"),u={type:n.type,isHorizontal:n.isHorizontal,allowSearch:n.allowSearch,templateDefined:n.templatetype!="none",allowactions:n.allowactions},r=$.fasttmpl(i,u)):n.surrogatedKey&&(i=t.renderFactory.getTemplate("render-actionLauncher"),r=$.fasttmpl(i,{allowactions:t.properties.allowactions})),r},isValid:function(n){var t=this,i=t.properties,r=t.getValue();return bizagi.util.parseBoolean(i.visible)==!1?!0:bizagi.util.parseBoolean(i.editable)==!1?!0:i.required&&t.value?t.value.length>0?!0:(message=t.getResource("render-required-register-action"),n.push({xpath:i.xpath,message:message}),!1):!1},setDisplayValue:function(n){var t=this,i=t.getControl();t.setValue(n,!1)},actionManager:function(n){var t=this,r=n.guidProcess||"",i=new $.Deferred,u;n.recordXpath=t.getFormContainer().properties.recordXpath;switch(n.actionType){case"Process":u={guidWFClass:r};$.when(t.dataService.hasStartForm(u)).done(function(u){u.hasStartForm?$.when(t.processStartForm({guidprocess:r,title:n.displayName,recordXpath:n.recordXpath})).done(function(t){n.idStartScope=t;i.resolve(n)}):i.resolve(n)});break;case"Rule":i.resolve(n);break;case"Form":n.xpathContext?$.when(t.processActionFormCollection(n)).done(function(t){n.idStartScope=t;i.resolve(n)}):(n.actionType==="Form"&&(n.xpathContext=undefined,n.contextType="entitytemplate",n.guidEntity=n.guidEntity||t.properties.guidEntity),$.when(t.processActionForm(n)).done(function(t){n.idStartScope=t;i.resolve(n)}))}return i.promise()},addActionToQueue:function(n){var t=this,f=t.getValue(),u=t.getFormContainer().getParams(),r,i;n.params=n.params||{};r=t.properties.xpathContext;switch(n.actionType){case"Process":n.params={idStartScope:n.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),idParentWorkitem:u.idWorkitem||bizagi.context.idWorkItem,recordXpath:r};break;case"Form":n.params={idStartScope:n.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),entityXpath:t.properties.xpathActions,idParentWorkitem:u.idWorkitem||bizagi.context.idWorkItem,idEntity:n.idEntity};break;case"Rule":n.params={xpathActions:n.xpathActions||"",recordXpath:r}}i=bizagi.clone(f);i.push(n);t.setValue(i);t.setDisplayValue(i)},removeActionToQueue:function(n){var t=this,i=bizagi.clone(t.getValue());i.splice(n,1);t.setValue(i);t.setDisplayValue(i)},collectData:function(n){var t=this;if(t.controlValueIsChanged()){var r=t.properties,u=r.xpath,f=t.getValue(),i=[];$.each(f,function(n,t){var r={};r.params=t.params||{};r.guidAction=t.guidAction;i.push(r)});n[u]=i.length==0?"":JSON.encode(i)}},countSameActions:function(n){var i=this,r=i.getValue(),t=0;return $.each(r,function(i,r){r.guidAction==n.guidAction&&t++}),t},getPropertiesActionLaucher:function(n){for(var r=this,i=r.getFormContainer(),t=0,u=n.length,f=u;t<f;t+=1)n[t].length===6&&(n[t].splice(5,0,""),n[t][3]=="Process"&&i.properties.xpathContext&&(n[t][5]=i.properties.xpathContext));return n}});
bizagi.rendering.render.extend("bizagi.rendering.range",{},{init:function(n){this._super(n)},initializeData:function(n){var t=this;this._super(n)},renderControl:function(){var n=this,i=n.properties,t;return t=n.renderFactory.getTemplate("render-range"),$.fasttmpl(t,{})},setRanageControls:function(n,t){var i=this;i.minControl=n||null;i.maxControl=t||null;var r=i.getControl(),u=$(".bz-range-maximum",r),f=$(".bz-range-minimum",r);i.renderRangeControl(f,n);i.renderRangeControl(u,t)},getValue:function(){var n=this,t=n.minControl.getValue(),i=n.maxControl.getValue();return{min:t,max:i}},renderRangeControl:function(n,t){$.when(t.render("render")).done(function(i){n.empty().append(i);t.postRenderElement(n)})}});
bizagi.rendering.range.extend("bizagi.rendering.rangeDate",{},{defineRangeControl:function(){var n=this,r=bizagi.rendering.date.extend({suscribe:function(n){this.observer=this.observer||[];this.observer.push(n)},notify:function(n){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(n)},setValue:function(n){n=n||"";this._super(n);this.notify(n)}}),u=bizagi.rendering.date.extend({suscribe:function(n){this.observer=this.observer||[];this.observer.push(n)},notify:function(n){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(n)},setValue:function(n){n=n||"";this._super(n);this.notify(n)}}),t=new r(n.getRenderProperties("min")),i=new u(n.getRenderProperties("max"));t.suscribe(i);i.suscribe(t);n.setRanageControls(t,i)},getRenderProperties:function(n){var t=this,u=t.getFormContainer(),i=t.properties,r={data:{properties:{id:i.id,xpath:i.xpath+"_"+n,displayType:"value"}},mode:"execute",parent:u,renderFactory:t.renderFactory,resources:bizagi.localization,dataService:t.dataService};return r.data.properties.displayName=n==="min"?"From":"To",r}});
bizagi.rendering.range.extend("bizagi.rendering.rangeMoney",{},{defineRangeControl:function(){var n=this,r=bizagi.rendering.money.extend({suscribe:function(n){this.observer=this.observer||[];this.observer.push(n)},notify:function(n){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(n)},setValue:function(n){n=n||"";this._super(n);this.notify(n)}}),u=bizagi.rendering.money.extend({suscribe:function(n){this.observer=this.observer||[];this.observer.push(n)},notify:function(n){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(n)},setValue:function(n){n=n||"";this._super(n);this.notify(n)}}),t=new r(n.getRenderProperties("min")),i=new u(n.getRenderProperties("max"));t.suscribe(i);i.suscribe(t);n.setRanageControls(t,i)},getRenderProperties:function(n){var t=this,r=t.getFormContainer(),i=t.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+n,displayType:"value"}},mode:"execute",parent:r,renderFactory:t.renderFactory,resources:bizagi.localization,dataService:t.dataService}}});
bizagi.rendering.range.extend("bizagi.rendering.rangeNumber",{},{defineRangeControl:function(){var n=this,r=bizagi.rendering.number.extend({suscribe:function(n){this.observer=this.observer||[];this.observer.push(n)},notify:function(n){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(n)},setValue:function(n){n=n||"";this._super(n);this.notify(n)}}),u=bizagi.rendering.number.extend({suscribe:function(n){this.observer=this.observer||[];this.observer.push(n)},notify:function(n){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(n)},setValue:function(n){n=n||"";this._super(n);this.notify(n)}}),t=new r(n.getRenderProperties("min")),i=new u(n.getRenderProperties("max"));t.suscribe(i);i.suscribe(t);n.setRanageControls(t,i)},getRenderProperties:function(n){var t=this,r=t.getFormContainer(),i=t.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+n,displayType:"value"}},mode:"execute",parent:r,renderFactory:t.renderFactory,resources:bizagi.localization,dataService:t.dataService}}});
bizagi.rendering.actionLauncher.extend("bizagi.rendering.actionLauncher",{},{postRender:function(){function u(t,i){var e=n.getControl(),u=$(".bz-action-launcher-actions-container",e);f=$.fasttmpl(t,i);u.append(f);i.template&&u.find(".actions-container.actions-container-template").append(i.template);n.configureHandlers();r.resolve(u)}var n=this,t=n.properties,o=n.getMode(),f,i,e={},r=new $.Deferred;return o=="design"||!n.properties.surrogatedKey?"":(n.configureQueueVisibility(),$.when(n.dataService.multiaction().getActions(n.processPropertyValueArgs)).pipe(function(i){return i=n.getPropertiesActionLaucher(i),e.actions=i,t.templatetype!="none"?n.dataService.multiaction().getPropertyData(n.processPropertyValueDataTmplArgs):null}).done(function(r){var h=e.actions,l;n.deferredActions.resolve(h);n.totalActions=bizagi.clone(h);var o=bizagi.clone(h),f={},c=n.moreActionsManager(o),s=c.isMoreActions;o=c.actions;n.lessActions=bizagi.clone(o);t.isHorizontal?t.templatetype!="none"?$.when(n.engine.render($.extend(r,{isDefaultTemplate:t.templatetype=="default"}),n.processPropertyValueDataTmplArgs)).done(function(i){f={actions:n.getPropertiesActionLaucher(o),template:i,isMoreActions:s,moreActions:n.moreActions,allowactions:t.allowactions};i=n.renderFactory.getTemplate("render-actionLauncher-horizontal");u(i,f)}):(f={actions:n.getPropertiesActionLaucher(o),isMoreActions:s,template:!1,moreActions:n.moreActions,allowactions:t.allowactions},i=n.renderFactory.getTemplate("render-actionLauncher-horizontal"),u(i,f)):(l=s?n.lessActions:n.totalActions,f={actions:n.getPropertiesActionLaucher(l),allowSearch:t.allowSearch,isMoreActions:s,isExpanded:!1,moreButtonTitle:n.getResource("render-action-launcher-more-actions")},i=n.renderFactory.getTemplate("render-actionLauncher-vertical"),u(i,f))}).fail(function(n){r.fail(n)}),n.engine.subscribe("onLoadDataNavigation",function(n,t){bizagi.loader.start("entity-engine-view").then(function(){$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_DIALOGNAV,data:t,modalParameters:{title:t.data.displayName,refreshInbox:!1},maximizeOnly:!1})})}),r.promise())},moreActionsManager:function(n){var t=this,i=t.properties,r=n.length>i.maxItems||!1,u;return r&&(u=n.splice(0,i.maxItems),t.moreActions=bizagi.clone(n),n=u),{isMoreActions:r,actions:n}},configureHandlers:function(){var n=this,r=n.getFormContainer();if(typeof r.params.printversion=="undefined"||r.params.printversion==!1){var t=n.getControl(),u=$(".action-launcher-control",t),i=$(".action-launcher-more-vertical",t),f=n.properties;n.configureMoreActionsHandler();i.on("click",function(){function s(t,i){var f=n.getControl(),r=$(".bz-action-launcher-actions-container",f),u;r.empty();u=$.fasttmpl(t,i);r.append(u);n.configureHandlers()}var o=$(this),t=!1,i="",r={},u,e;o.hasClass("expanded")?(t=!1,r=n.lessActions,i=n.getResource("render-action-launcher-more-actions")):(t=!0,r=n.totalActions,i=n.getResource("render-action-launcher-less-actions"));u={actions:n.getPropertiesActionLaucher(r),allowSearch:f.allowSearch,isMoreActions:!0,isExpanded:t,moreButtonTitle:i};e=n.renderFactory.getTemplate("render-actionLauncher-vertical");s(e,u)});u.on("click",function(){var t={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),readOnlyForm:$(this).data("readonlyform")||!1,guidEntity:n.properties.guidEntity,xpathActions:n.properties.xpathActions||""};n.onActionClicked(t)});$.expr[":"].FilterAction=function(n,t,i){var r=i[3];return r?new RegExp(r,"i").test($(n).text()):!1};$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup(function(){var n=$(this).val();$(".ui-bizagi-render-actionLauncher-vertical-item",t).show(0);i.hasClass("expanded")||(i.trigger("click"),$("input#ui-bizagi-render-action-launcher-filter-input").val(n),$("input#ui-bizagi-render-action-launcher-filter-input").focus());n&&$(".ui-bizagi-render-actionLauncher-vertical-item",t).not(":FilterAction("+n+")").hide(0)})}},configureMoreActionsHandler:function(){var n=this,t=n.getControl(),i=$(".action-launcher-more",t);bizagi.loader.startAndThen("kendo").then(function(){n.tooltip=i.kendoTooltip({autoHide:!1,content:function(){var t=n.renderFactory.getTemplate("render-actionLauncher-horizontal-more");return $.fasttmpl(t,{actions:n.getPropertiesActionLaucher(n.moreActions)})},show:function(){$("div[role='tooltip']").addClass("bizagi-custom-tooltip-more-actions");$(".action-launcher-control-more").off("click").on("click",function(){var t={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),readOnlyForm:$(this).data("readonlyform")||!1,xpathActions:n.properties.xpathActions||""};n.onActionClicked(t);n.tooltip.hide()})},width:185}).data("kendoTooltip")})},onActionClicked:function(n){var t=this,r=t.getControl(),i=t.properties,u=typeof i.multipleSelection=="undefined"?!0:i.multipleSelection;u?n.actionType=="Form"&&t.countSameActions(n)>=1&&!n.xpathContext?$(".action-to-execute-control[data-guidaction='"+n.guidAction+"'] label",r).click():$.when(t.actionManager(n)).done(function(n){t.executeAction(n)}):t.getValue().length>0?t.showConfirmationDialog(n):$.when(t.actionManager(n)).done(function(n){t.executeAction(n)})},notifyExecution:function(n,t){var i=this,r=new bizagi.INotifications;n.response=="success"?r.showSucessMessage(printf(i.getResource("render-action-launcher-success-excecution"),t.displayName),null,{}):r.showErrorMessage(printf(i.getResource("render-action-launcher-failed-excecution"),t.displayName),null,{})},processActionForm:function(n){var t=this,f=t.properties,e=t.getFormContainer(),o=t.properties.additionalXpath.join(","),s=n.xpathContext?t.properties.xpathActions+"."+n.xpathContext:t.properties.xpathActions,u=new $.Deferred,r=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:f.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:r.form.properties.xpathContext,idPageCache:r.form.properties.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe(function(i){n.editMode||t.countSameActions(n)!=0||(n.idStartScope=i.IdScope);u.resolve(i.IdScope)})},onCancel:function(){}}),i={idForm:n.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:e.properties.typeForm!="SummaryForm"?bizagi.context.idWorkitem:undefined,additionalXpaths:o,xpathContext:s,idStartScope:n.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:n.readOnlyForm,recordXpath:n.recordXpath};return n.actionType==="Form"&&(i.contextType="entitytemplate",i.xpathContext=undefined,i.guidEntity=n.guidEntity,i.rewriteContextType=!0),r.render(i),u.promise()},processActionFormCollection:function(n){var t=this,u=t.properties,h=t.getFormContainer(),e=t.properties.additionalXpath.join(","),r=new $.Deferred,i=n.xpathContext?t.properties.xpathActions+"."+n.xpathContext:t.properties.xpathActions,f=i!=""?printf("%s[id=%s]",i,n.idEntity):i,o=i!=""?printf("%s[]",i):i,s=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:u.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(e){return n.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:f,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe(function(n){r.resolve(n.IdScope)}):t.dataService.addGridRecordData({idRender:u.id,xpathContext:i,contexttype:"start",idPageCache:e.idPageCache,submitData:e}).pipe(function(i){n.idStartScope=i.IdScope;n.idEntity=i.IdEntity;t.addActionToQueue(n);r.resolve(i.IdScope)})},onCancel:function(){}});return s.render({idForm:n.guidProcess,contextType:"start",idCase:bizagi.context.idCase,additionalXpaths:e,xpathContext:n.editMode?f:o,idStartScope:n.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:n.readOnlyForm,recordXpath:n.recordXpath}),r.promise()},processStartForm:function(n){var t=this,f=t.properties,i=t.getFormContainer(),r=new $.Deferred,u;return n=n||{},u=new bizagi.rendering.dialog.startForm(t.dataService,t.renderFactory,{maximized:f.maximized,title:n.title||"",saveButtonLabel:t.typeForm=="GlobalForm"||this.typeForm=="SummaryForm"?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(n){return i.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:n,xpathContext:t.properties.xpathContext,idPageCache:n.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe(function(n){i.endLoading();r.resolve(n.IdScope)})}}),u.render({guidprocess:n.guidprocess,idStartScope:n.idStartScope,idCase:t.properties.caseId,idWorkitem:i.properties.typeForm!="SummaryForm"?bizagi.context.idWorkitem:undefined,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:n.recordXpath,mappingstakeholders:!0}),r.promise()},executeAction:function(n){var t=this;t.typeForm=="GlobalForm"||t.typeForm=="SummaryForm"?$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation"),null,!1)).done(function(){t.executeActionImmediately(n)}):t.addActionToQueue(n)},showConfirmationDialog:function(n){var t=this;t.confirmTemplate=t.renderFactory.getTemplate("render-actionLauncher-confirm");var r=bizagi.localization.getResource("render-action-launcher-single-action-confirmation"),u=$.tmpl(t.confirmTemplate,{confirmationMessage:r}),i={resizable:!1,modal:!0,title:"Bizagi",buttons:[]};i.buttons=[{text:bizagi.localization.getResource("render-boolean-yes"),click:function(){t.setValue([]);$.when(t.actionManager(n)).done(function(n){t.executeAction(n)});$(this).dialog("close")}},{text:bizagi.localization.getResource("render-boolean-no"),click:function(){$(this).dialog("close")}}];$(u).dialog(i)},setDisplayValue:function(n){var t=this,r=t.getControl(),i=$(".bz-action-launcher-actions-to-execute-container",r),u=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility();$.when(t.deferredActions).done(function(r){var f=function(n){var t=[];return $.each(r,function(i,r){r[4]==n&&(t=r)}),t};$.each(n,function(t,i){var r=f(i.guidAction);n[t].displayName=r[1];n[t].guidProcess=r[0];n[t].actionType=r[3];n[t].xpathContext=r[5];n[t].readOnlyForm=r[6];n[t].params&&n[t].params.idStartScope&&(n[t].idStartScope=n[t].params.idStartScope);n[t].params&&n[t].params.idPageCache&&(n[t].idPageCache=n[t].params.idPageCache);n[t].params&&n[t].params.idEntity&&(n[t].idEntity=n[t].params.idEntity)});$.when($.fasttmpl(u,{actions:n})).done(function(n){i.empty();i.append(n);var r=$(".action-to-execute-control i",i),u=$(".action-to-execute-control label",i);r.bind("click",function(){var n=$(this).parent().data("index");t.removeActionToQueue(n)});u.bind("click",function(){var n=$(this).parent(),h=n.data("actiontype"),o=n.data("guidprocess"),r=n.data("idstartscope"),c=n.data("title"),u=n.data("xpathcontext"),l=n.data("readonlyform")||!1,a=n.data("identity")||"",v=n.data("guidaction"),s=u||t.properties.xpathContext,i,f,e;switch(h){case"Process":r&&t.processStartForm({guidprocess:o,idStartScope:r,title:c,xpathContext:u,recordXpath:s});break;case"Form":i={guidProcess:o,idStartScope:r,editMode:!0,xpathContext:u,readOnlyForm:l,idEntity:a,recordXpath:s};i.xpathContext?t.processActionFormCollection(i):(f={},e=t.value.filter(function(n){return n.guidAction==v}),e.length>0&&(f={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||e[0].guidEntity}),t.processActionForm($.extend(i,f)))}})})})},configureQueueVisibility:function(){var n=this,t=n.getControl(),i=$(".bz-action-launcher-actions-to-execute-container",t),r=$(".actions-to-execute-title",t);n.getValue().length>0?(i.show(),r.show()):(i.hide(),r.hide())}});
bizagi.rendering.range.extend("bizagi.rendering.range",{},{postRender:function(){var n=this,t=n.properties},setDisplayValue:function(){var n=this,t=n.getControl()}});
bizagi.rendering.rangeDate.extend("bizagi.rendering.rangeDate",{},{postRender:function(){var n=this;n.defineRangeControl()}});
bizagi.rendering.rangeMoney.extend("bizagi.rendering.rangeMoney",{},{postRender:function(){var n=this;n.defineRangeControl()},setDisplayValue:function(){var n=this,t=n.getControl()}});
bizagi.rendering.rangeNumber.extend("bizagi.rendering.rangeNumber",{},{postRender:function(){var n=this;n.defineRangeControl()}});
bizagi.rendering.render.extend("bizagi.rendering.entityTemplate",{},{init:function(n){this._super(n)},initializeData:function(n){var t=this,i;this._super(n);i=t.getFormContainer();t.deferredActions=new $.Deferred;t.deferredActions.promise();t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",psurrogatedKey:t.properties.surrogatedKey};t.properties.valueWidth=100;t.properties.displayType="value";t.properties.allowactions=typeof n.properties.allowactions=="undefined"?!0:n.properties.allowactions;t.properties.value?typeof t.properties.value=="string"&&(t.properties.value=t.value=JSON.parse(t.properties.value)):t.properties.value=t.value=[]},renderControl:function(){var n=this,r=n.getMode(),t,i="";return r=="design"?(t=n.renderFactory.getTemplate("render-entityTemplate-design"),i=$.fasttmpl(t,{})):n.properties.surrogatedKey&&(t=n.renderFactory.getTemplate("render-entityTemplate"),i=$.fasttmpl(t,{allowactions:n.properties.allowactions})),i},isValid:function(n){var t=this,r=t.properties,i=this._super(n),u=t.getValue();return i},setDisplayValue:function(n){var t=this,i=t.getControl();t.setValue(n,!1)}});
bizagi.rendering.actionLauncher.extend("bizagi.rendering.entityTemplate",{},{initializeData:function(n){var i=this,n=n||{},t=n.properties||{};i._super(n);i.properties.allowactions=typeof t.allowactions!="undefined"?bizagi.util.parseBoolean(t.allowactions):!1;i.properties.templatetype=typeof t.templatetype!="undefined"?t.templatetype:"default"},postRender:function(){var n=this,t=n.properties,i=n.getMode(),r=n.getControl();if(i=="design"||!n.properties.surrogatedKey)return"";n.configureQueueVisibility();$.when(n.dataService.multiaction().getPropertyData(n.processPropertyValueDataTmplArgs)).done(function(i){typeof i.templateGuid!="undefined"&&i.templateGuid&&(i.isDefaultTemplate=!1,i.guidTemplate=i.templateGuid,delete i.templateGuid);$.when(n.engine.render(i,n.processPropertyValueDataTmplArgs)).done(function(i){var f=i,u=$(".bz-action-launcher-actions-container",r),e;i=n.renderFactory.getTemplate("render-actionLauncher-horizontal");t.allowactions?$.when(n.dataService.multiaction().getActions(n.processPropertyValueArgs)).done(function(r){var s;n.deferredActions.resolve(r);var e=bizagi.clone(r),o=n.moreActionsManager(e),h=o.isMoreActions;e=o.actions;s=$.fasttmpl(i,{actions:e,template:!0,isMoreActions:h,allowactions:t.allowactions});u.append(s);u.find(".actions-container.actions-container-template").append(f);n.configureHandlers()}).fail(function(){}):(e=$.fasttmpl(i,{template:!0,allowactions:t.allowactions}),u.append(e),u.find(".actions-container.actions-container-template").append(f))})}).fail(function(){});n.engine.subscribe("onLoadDataNavigation",function(n,t){bizagi.loader.start("entity-engine-view").then(function(){$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_DIALOGNAV,data:t,modalParameters:{refreshInbox:!1,title:t.data.displayName},maximizeOnly:!1})})})},configureHandlers:function(){var n=this,t=n.getFormContainer();if(typeof t.params.printversion=="undefined"||t.params.printversion==!1){var i=n.getControl(),u=n.properties,r=$(".action-launcher-control",i);n.configureMoreActionsHandler();r.on("click",function(){var t={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),xpathActions:n.properties.xpathActions||""};t.actionType==="Form"&&(t.xpathContext=undefined,t.contextType="entitytemplate",t.guidEntity=n.properties.guidEntity);n.onActionClicked(t)})}}});
bizagi.rendering.checkList.extend("bizagi.rendering.checkList",{},{postRender:function(){var n=this,t=n.getControl();this._super();t.addClass("ui-bizagi-render-display-block");n.properties.unique=Math.ceil(Math.random()*1e3);$(".ui-bizagi-render-checkList-label",n.checkListGroup).check()},configureHandlers:function(){var n=this;n._super();bizagi.util.isIE()?$("input[type=checkbox]",n.checkListGroup).bind("change",function(){var i=$(this).data("item-guid"),t=$(this).is(":checked");n.updateDisplay($(this),t);n.onCheckListGroupChange(i,t)}):$("input[type=checkbox]",n.checkListGroup).bind("change",function(){var i=$(this).data("item-guid"),t=$(this).is(":checked");n.updateDisplay($(this),t);n.onCheckListGroupChange(i,t)})},updateDisplay:function(n,t){var r=this,i=n.closest(".ui-bizagi-render-checkList-item");t?i.addClass("checked"):i.removeClass("checked")},onCheckListGroupChange:function(n,t){var u=this,r,i=$.grep(u.properties.items,function(t){return t.guid===n});i&&i.length>0&&(r=i[0]);r.checked=t},clearDisplayValue:function(){var n=this;bizagi.util.isIE()?$("input[type=checkbox]",n.checkListGroup).removeAttr("checked"):$("input[type=checkbox]",n.checkListGroup).check("uncheckItem")},setDisplayValue:function(){var n=this}});
bizagi.rendering.checkList.extend("bizagi.rendering.activityCheckList",{},{postRender:function(){var n=this,t=n.getControl();this._super();n.addButton=$(".ui-bizagi-render-checkList-add-item",n.element);n.newItemName=$(".ui-bizagi-render-checkList-input-name",n.control);n.separator=$(".ui-bizagi-render-checkList-separator",n.element);n.goalActivity=$(".ui-bizagi-render-checkList-goal-activity",n.element);n.additionalElements();n.notifyLoadItems()},additionalElements:function(){var n=this,i=n.getControl(),r=this.getResource("render-activity-check-list-activitywork")+" ("+n.properties.activityWork+"%)",u=this.getResource("render-activity-check-list-form"),t;n.addButton&&n.addButton.length>0||(t=$("<div/>").addClass("ui-bizagi-render-checkList-add-item"),t.append($("<h4 />").text(bizagi.localization.getResource("workportal-project-plan-activity-work-title"))),t.append($("<button class=''/>").text("+ "+bizagi.localization.getResource("workportal-project-plan-activity-action-add"))),n.element.prepend(t));n.separator&&n.separator.length>0||n.element.append($("<div/>").addClass("ui-bizagi-render-checkList-separator").append($("<span/>")));n.goalActivity&&n.goalActivity.length>0||n.properties.activityDescription&&n.properties.activityDescription!==""&&n.element.prepend($("<div/>").addClass("ui-bizagi-render-checkList-goal-activity").append("<h3><span class='ui-bizagi-wp-bold'>"+bizagi.localization.getResource("workportal-project-plan-activity-goal")+": <\/span><span>"+n.properties.activityDescription+"<\/span><\/h3>"))},notifyLoadItems:function(){var n=this;setTimeout(function(){n.triggerGlobalHandler("onLoadDataItemsFromFormActivityPlan",{items:n.properties.items,activityWork:n.properties.activityWork})},100)},configureHandlers:function(){var n=this,t=n.getControl();this._super();$(".ui-bizagi-render-checkList-add-item button",n.element).unbind("click").click(function(){var t=$(".ui-bizagi-render-checkList-item.selected",n.control);t.length<=0?n.prepareNewItem():$(".ui-bizagi-render-checkList-input-name",t).focus()});$(".item-button.delete",n.checkListGroup).bind("click",function(){var t=$(this).closest(".ui-bizagi-render-checkList-item").data("item-guid");n.deleteItem(t)});$("label.item-name",n.checkListGroup).bind("click",function(){var t=$(this).closest(".ui-bizagi-render-checkList-item"),i=t.data("item-guid");n.selectItem(i)})},selectItem:function(n){for(var t=this,i=0;i<t.properties.items.length;i++)t.properties.items[i].selected=t.properties.items[i].guid===n?!0:!1;t.repaintControl();var f=$(".ui-bizagi-render-checkList-item.selected"),r=$(".ui-bizagi-render-checkList-input-name",f),u=r.val();r.focus();r[0].setSelectionRange(u.length,u.length);t.configureHandlers();t.addSelectedHandlers()},deleteItem:function(n){for(var t=this,i=0;i<t.properties.items.length;i++)if(t.properties.items[i].guid===n){t.properties.items.splice(i,1);break}t.setValue(t.properties.items);t.repaintControl();t.configureHandlers();t.refreshValue(t.properties.items)},prepareNewItem:function(){var n=this,t={guid:Math.guid(),resolved:!1,name:"",selected:!0};n.properties.items.push(t);n.repaintControl();n.configureHandlers();n.addSelectedHandlers()},addSelectedHandlers:function(){var n=this,i=$(".ui-bizagi-render-checkList-item.selected",n.control),t=$(".ui-bizagi-render-checkList-input-name",i);t.focus();t.blur(function(){var i=t.val();i&&i!==""?n.addItem():(n.properties.items.splice(n.properties.items.length-1,1),n.setValue(n.properties.items),n.repaintControl(),n.configureHandlers())});t.keypress(function(i){if(i.which==13){i.preventDefault();var r=t.val();r&&r!==""&&(n.addItem(),n.prepareNewItem())}})},addItem:function(){var n=this,u=n.getControl(),t=$(".ui-bizagi-render-checkList-item.selected",n.control),i=$(".ui-bizagi-render-checkList-input-name",t),r=i.val();n.addButton.show();$.each(n.properties.items,function(n,t){t.selected&&(t.name=r,t.selected=!1)});n.updateOriginalValue();n.setValue(n.properties.items);n.repaintControl();n.configureHandlers();n.refreshValue(n.properties.items)},repaintControl:function(){var n=this,i=n.getControl(),t=n.renderControl();$(".ui-bizagi-render-checkList",n.control).replaceWith(t);n.postRender()},onCheckListGroupChange:function(n,t){var i=this,u,r=$.grep(i.properties.items,function(t){return t.guid===n});r&&r.length>0&&(u=r[0]);u.resolved=t;i.setValue(i.properties.items);i.refreshValue(i.properties.items)},refreshValue:function(n){for(var f,t=this,e=t.getControl(),i=n.length,u=0,r=0;r<i;r++)n[r].resolved&&(u+=1);t.properties.activityWork=i>0?Math.floor(100*u/i):100;f=this.getResource("render-activity-check-list-activitywork")+" ("+t.properties.activityWork+"%)";$(".ui-bizagi-render-checkList-activity-work span",t.element).html(f);t.triggerGlobalHandler("onLoadDataItemsFromFormActivityPlan",{items:t.properties.items,activityWork:t.properties.activityWork})},getValue:function(){var n=this;return n.value||[]},controlValueIsChanged:function(){var n=this,t=JSON.stringify(n.properties.originalValue),i=JSON.stringify(n.value);return t!==i},allCheckedItems:function(){var n=this,t=!1;return Array.isArray(n.value)&&(t=n.value.every(function(n){return n.resolved==!0})),t},updateOriginalValue:function(){var n=this;n.properties.originalValue=bizagi.clone(n.value)},collectData:function(n){var t=this,i=t.properties,s=i.xpath,r=t.getValue(),u=t.properties.idActivity,f=!0,e=t.getFormContainer().getLastActionButton(),o;e&&e.action=="next"&&(f=t.allCheckedItems());t.controlValueIsChanged()&&f&&(bizagi.util.isEmpty(s)||bizagi.util.isEmpty(u)||(Array.isArray(r)?(o={idActivity:u,items:r},n[i.xpath]=JSON.stringify(o)):r===""&&(n[i.xpath]="")))},isValid:function(n){for(var i=this,o=i.properties,u=i.getValue(),f=!0,e,r=i.getResource("render-activity-check-list-validation"),t=0;t<u.length;t+=1)if(e=u[t],!e.resolved){n.push({xpath:o.xpath,message:r});f=!1;break}return f}});
bizagi.rendering.render.extend("bizagi.rendering.polymorphicLauncher",{},{init:function(n){this._super(n)},initializeData:function(n){var t=this,i,r;this._super(n);i=t.getFormContainer();this.typeForm=i.properties.typeForm||"";r=t.getMode();t.deferredActions=new $.Deferred;t.deferredActions.promise();t.properties.valueWidth=100;t.properties.displayType="value";t.properties.allowSearch=typeof n.properties.allowSearch=="undefined"?!1:n.properties.allowSearch;t.properties.additionalXpath=t.properties.additionalXpath||[];t.properties.value?typeof t.properties.value=="string"&&(t.properties.value=t.value=JSON.parse(t.properties.value)):(t.properties.value=t.value=[],t.properties.originalValue=[]);t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",ptags:t.getTagList(t.properties.tagslist),additionalXpaths:t.properties.additionalXpath}},executeActionImmediately:function(n){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeConstructor",psurrogatedKey:t.properties.surrogatedKey,pguidConstructor:n.guidConstructor,pparameters:JSON.encode({idStartScope:n.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:n.idPageCache})};t.dataService.executeActions(r).done(function(i){t.notifyExecution(i.response,n)}).fail(function(){t.notifyExecution("Error",n)})},notifyExecution:function(){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0;this.postRender()},renderControl:function(){var n=this,i=n.properties,f=n.getMode(),t,r="",u;return f=="design"?(t=n.renderFactory.getTemplate("render-polymorphicLauncher-design"),u={type:i.type,allowSearch:i.allowSearch},r=$.fasttmpl(t,u)):i.surrogatedKey&&(t=n.renderFactory.getTemplate("render-polymorphicLauncher"),r=$.fasttmpl(t)),r},isValid:function(n){var t=this,r=t.properties,i=this._super(n),u=t.getValue();return i},setDisplayValue:function(n){var t=this;t.setValue(n,!1)},actionManager:function(n){var i=this,r=n.guidObject||"",t=new $.Deferred,u;n.recordXpath=i.getFormContainer().properties.recordXpath;switch(n.actionType){case"Process":u={guidWFClass:r};$.when(i.dataService.hasStartForm(u)).done(function(u){u.hasStartForm?$.when(i.processStartForm({guidprocess:r,title:n.displayNamee,recordXpath:n.recordXpath})).done(function(i){n.idStartScope=i;t.resolve(n)}):t.resolve(n)});break;case"Rule":t.resolve(n);break;case"Form":$.when(i.processActionForm(n)).done(function(i){n.idStartScope=i;t.resolve(n)})}return t.promise()},addActionToQueue:function(n){var t=this,i=t.getValue(),r=t.getFormContainer().getParams(),u;n.params=n.params||{};u=t.properties.xpathContext;switch(n.actionType){case"Process":n.params={additionalXpaths:t.properties.additionalXpath.join(","),idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,recordXpath:u};typeof n.idStartScope!="undefined"&&(n.params.idStartScope=n.idStartScope);break;case"Form":n.params={idStartScope:n.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),entityXpath:t.properties.xpathActions,idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,idEntity:n.idEntity,guidEntity:n.guidEntity}}i.push(n);t.setValue(i);t.setDisplayValue(i)},removeActionToQueue:function(n){var t=this,i=t.getValue();i.splice(n,1);t.setValue(i);t.setDisplayValue(i)},collectData:function(n){var t=this;if(t.controlValueIsChanged()){var r=t.properties,u=r.xpath,f=t.getValue(),i=[];$.each(f,function(n,t){var r={};r.params=t.params||{};r.guidAction=t.guidObject||t.guidAction;r.displayName=t.displayName;r.guidConstructor=t.guidConstructor;r.actionType=t.actionType;r.xpathContext=t.xpathContext;r.guidEntity=t.guidEntity;i.push(r)});n[u]=i.length==0?"":JSON.encode(i)}},countSameActions:function(n){var i=this,r=i.getValue(),t=0;return $.each(r,function(i,r){r.guidAction==n.guidAction&&t++}),t},getTagList:function(n){var t,i;for(n=n||[],t=[],i=n.length;i>0;i--)t.push(n[i-1].value);return t.length>0?t:""}});
bizagi.rendering.polymorphicLauncher.extend("bizagi.rendering.polymorphicLauncher",{},{postRender:function(){function e(r,u){var e=n.getControl(),f=$(".bz-action-launcher-actions-container",e);i=$.fasttmpl(r,u);f.append(i);n.properties.readOnly!==!0&&n.configureHandlers();t.resolve(f)}var n=this,u=n.properties,f=n.getMode(),i,r,t=new $.Deferred;return f=="design"||!n.properties.surrogatedKey?"":(n.configureQueueVisibility(),$.when(n.dataService.multiaction().getPolymorphicActions(n.processPropertyValueArgs)).done(function(t){var i,f;t=n.dataService.serializePolymorphicActions(t);n.totalActions=bizagi.clone(t);i=bizagi.clone(t);n.lessActions=bizagi.clone(i);f={actions:i,allowSearch:u.allowSearch,treeActionsList:n.getTreeItems(i)};r=n.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree");e(r,f)}).fail(function(n){t.fail(n)}),t.promise())},getTreeItems:function(n,t){var r=this,i="<ul>",u=r.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return n=n||{},t=t||1,$.each(n,function(n,f){i+=$.fasttmpl(u,f);f.children&&(i+=r.getTreeItems(f.children,t+1))}),i+="<\/ul>"},configureHandlers:function(){var t=this,n=t.getControl(),i=t.getFormContainer(),r;if(typeof i.params.printversion=="undefined"||i.params.printversion==!1){r=$(".ui-bizagi-render-polymorphicLauncher-list li>span",n);r.on("click",function(){var n=$(this).parent(),i={guidEntity:n.data("guidentity"),guidObject:n.data("guidobject"),guidConstructor:n.data("guidconstructor"),displayName:n.data("display-name"),actionType:n.data("action-type"),xpathContext:n.data("xpathcontext")};t.onActionClicked(i)});$.expr[":"].FilterAction=function(n,t,i){var r=i[3];return r?new RegExp(r,"i").test($(n).text()):!1};$("input#ui-bizagi-render-action-launcher-filter-input",n).keyup(function(){var t=$(this).val();t?($("li",n).hide(0),$("li[data-hasconstructor='true']",n).filter(":FilterAction("+t+")").show(0,function(){var t=$("label",this).html(),n=$(this),i=n.data("parents")+n.data("title");n.data("cachedvalue")||n.data("cachedvalue",t);$("label",this).html(i)})):$("li",n).show(0,function(){var n=$(this).data("cachedvalue");$("label",this).html(n)})})}},onActionClicked:function(n){var t=this;$.when(t.actionManager(n)).done(function(n){t.executeAction(n)})},notifyExecution:function(n,t){var i=this,r=new bizagi.INotifications;n=="success"?r.showSucessMessage(printf(i.getResource("render-action-launcher-success-excecution"),t.displayName),null,{}):r.showErrorMessage(printf(i.getResource("render-action-launcher-failed-excecution"),t.displayName),null,{})},processActionForm:function(n){var t=this,e=t.properties,o=t.getFormContainer(),s=t.properties.additionalXpath.join(","),r=new $.Deferred,h=n.xpathContext||"",u,f,i;return t.properties.type!=="polymorphicLauncher"&&(u=typeof t.properties.surrogatedKey=="object"&&t.properties.surrogatedKey.length>1?t.properties.surrogatedKey:t.properties.surrogatedKey[0]),f=t.properties.recordXpath,i=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:e.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(u){var f=u.idPageCache;return u.idPageCache=null,t.dataService.multiaction().submitData({action:"SAVE",data:u,xpathContext:i.form.properties.xpathContext,idPageCache:f,isOfflineForm:!1,isActionStartForm:!0}).pipe(function(i){n.editMode||t.countSameActions(n)!=0||(n.idStartScope=i.IdScope);r.resolve(i.IdScope)})},onCancel:function(){}}),i.render({idForm:n.guidObject,contextType:"entity",guidEntity:n.guidEntity,idCase:t.properties.caseId,idWorkitem:o.properties.typeForm!="SummaryForm"?bizagi.context.idWorkitem:undefined,additionalXpaths:s,idStartScope:n.idStartScope,surrogateKey:u,recordXpath:f}),r.promise()},processStartForm:function(n){var t=this,e=t.properties,i=t.getFormContainer(),r=new $.Deferred,u,f;return t.properties.type!=="polymorphicLauncher"&&(u=typeof t.properties.surrogatedKey=="object"&&t.properties.surrogatedKey.length>1?t.properties.surrogatedKey:t.properties.surrogatedKey[0]),n=n||{},f=new bizagi.rendering.dialog.startForm(t.dataService,t.renderFactory,{maximized:e.maximized,title:n.title||"",saveButtonLabel:t.typeForm=="GlobalForm"||this.typeForm=="SummaryForm"?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(n){return i.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:n,xpathContext:t.properties.xpathContext,idPageCache:n.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe(function(n){i.endLoading();r.resolve(n.IdScope)})}}),f.render({guidprocess:n.guidprocess,idStartScope:n.idStartScope,idCase:t.properties.caseId,idWorkitem:i.properties.typeForm!="SummaryForm"?bizagi.context.idWorkitem:undefined,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:u,recordXpath:n.recordXpath,mappingstakeholders:!0}),r.promise()},executeAction:function(n){var t=this;t.typeForm=="GlobalForm"||t.typeForm=="SummaryForm"?$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation"),null,!1)).done(function(){t.executeActionImmediately(n)}):t.addActionToQueue(n)},showConfirmationDialog:function(n){var t=this;t.confirmTemplate=t.renderFactory.getTemplate("render-polymorphicLauncher-confirm");var r=bizagi.localization.getResource("render-action-launcher-single-action-confirmation"),u=$.tmpl(t.confirmTemplate,{confirmationMessage:r}),i={resizable:!1,modal:!0,title:"Bizagi",buttons:[]};i.buttons=[{text:bizagi.localization.getResource("render-boolean-yes"),click:function(){t.setValue([]);$.when(t.actionManager(n)).done(function(n){t.executeAction(n)});$(this).dialog("close")}},{text:bizagi.localization.getResource("render-boolean-no"),click:function(){$(this).dialog("close")}}];$(u).dialog(i)},setDisplayValue:function(n){var t=this,r=t.getControl(),i=$(".bz-action-launcher-actions-to-execute-container",r),u=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility();$.when($.fasttmpl(u,{actions:n})).done(function(n){i.empty();i.append(n);var r=$(".action-to-execute-control i",i),u=$(".action-to-execute-control label",i);r.bind("click",function(){var n=$(this).parent().data("index");t.removeActionToQueue(n)});u.bind("click",function(){var n=$(this).parent(),e=n.data("actiontype"),i=n.data("guidprocess"),r=n.data("idstartscope"),o=n.data("title"),u=n.data("xpathcontext"),s=n.data("identity")||"",h=n.data("guidentity"),c=u||t.properties.xpathContext,f;switch(e){case"Process":r&&t.processStartForm({guidprocess:i,idStartScope:r,title:o,xpathContext:u,recordXpath:c});break;case"Form":f={guidProcess:i,idStartScope:r,editMode:!0,xpathContext:u,idEntity:s,guidEntity:h,guidObject:i};t.processActionForm(f)}})})},configureQueueVisibility:function(){var n=this,t=n.getControl(),i=$(".bz-action-launcher-actions-to-execute-container",t),r=$(".actions-to-execute-title",t);n.getValue().length>0?(i.show(),r.show()):(i.hide(),r.hide())}});
