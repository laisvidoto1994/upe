bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.activities.sidebar",{},{init:function(n,t,i){var r=this;r._super(n,t,i);i=i||{};r.loadTemplates({"project-plan-activities-sidebar":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activities.sidebar").concat("#project-plan-activities-sidebar")})},renderContent:function(){var n=this,t=n.getTemplate("project-plan-activities-sidebar");return n.content=t.render({}),n.content}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.activities.sidebar",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.activities.sidebar],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.create",{},{init:function(n,t,i,r){var u=this;u.params=r;u.contextualized;u._super(n,t,r);u.notifier=i;u.loadTemplates({"plan-create":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.plan.create").concat("#plan-create")});u.dialogBox={}},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.initPlugins()},initPlugins:function(){var n=this,t=n.getTemplate("plan-create");n.dialogBox.formContent=t.render({});n.dialogBox.elements={inputName:$("#input-name-plan",n.dialogBox.formContent),inputTemplate:$("#templates-plan",n.dialogBox.formContent),buttonSave:$("#button-accept-create-plan",n.dialogBox.formContent),buttonCancel:$("#button-cancel-create-plan",n.dialogBox.formContent)};n.dialogBox.elements.buttonSave.on("click",$.proxy(n.onClickSavePlan,n));n.dialogBox.elements.buttonCancel.on("click",$.proxy(n.closeDialogBox,n));n.notifier=bizagi.injector.get("notifier")},closeDialogBox:function(){var n=this;n.dialogBox.formContent.dialog("destroy");n.dialogBox.formContent.detach();n.dialogBox.templateGuid=""},showPopupAddPlan:function(n,t,i){var r=this;r.params=n;r.dataService=t;r.contextualized=i;r.content=$("<div><\/div>");r.initPlugins();r.dialogBox.elements.inputTemplate.html("");r.dataService.getTemplatesByParentWorkItem({parentWorkItem:n.guidWorkItem}).done(function(n){var t={combo:[],id:"templates"};t.combo=n;r.dialogBox.elements.inputTemplate.uicombo({isEditable:!1,data:t,itemValue:function(n){return n.id},itemText:function(n){return n.name},onChange:function(n){var t=n.ui.data("value");r.dialogBox.elements.inputTemplate.val(t);r.dialogBox.templateGuid=t},css:"display: none"});r.dialogBox.elements.inputTemplate.keydown(function(){(event.keyCode==8||event.keyCode==46)&&(event.preventDefault(),r.dialogBox.templateGuid="",r.dialogBox.elements.inputTemplate.val(""),$("input",r.dialogBox.elements.inputTemplate).val(""))});n.length>0?$(".field-template",r.dialogBox.formContent).show():$(".field-template",r.dialogBox.formContent).hide()}).fail(function(){$(".field-template",r.dialogBox.formContent).hide()});r.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-project-plan-popup-title-add-plan"),maximize:!1,close:function(){r.dialogBox.formContent.dialog("destroy");r.dialogBox.formContent.detach()}})},onClickSavePlan:function(n){n.preventDefault();var t=this;t.validateParams()&&t.createNewPlan()},createNewPlan:function(){var n=this,i=n.params.guidWorkItem||null,t={idUserCreator:bizagi.currentUser.idUser,id:undefined,startDate:null,creationDate:null,parentWorkItem:i,description:null,currentState:"PENDING",name:n.dialogBox.elements.inputName.val(),waitForCompletion:!0,dueDate:null,contextualized:n.contextualized,idTemplate:n.dialogBox.templateGuid};$.when(n.sendDataInsertPlan(t)).then(function(i){t=$.extend(t,{id:i.id});t.activities=[];t.users=[];var r=new bizagi.workportal.services.behaviors.projectDashboard(n.dataService);n.params.menuPlanDashboard={};n.params.menuPlanDashboard.showCommentsOptionMenu=r.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonComments;n.params.menuPlanDashboard.showFilesOptionMenu=r.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonFiles;n.params.menuPlanDashboard.showTimeLineOptionMenu=r.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonTimeLine;$.when(r.getRadNumberForPlanDashboard(t.id,t.contextualized)).done(function(i){n.pub("planCreated",{paramsNewPlan:t,radNumber:i});n.closeDialogBox();n.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-project-plan-created"),""))})})},validateParams:function(){var i=this,n=i.dialogBox.elements.inputName,t;return n.val()&&n.val()!==""?!0:(t=bizagi.localization.getResource("workportal-project-plan-popup-field-name-required"),n.next().find("span").html(t),!1)},sendDataInsertPlan:function(n){var i=this,t=$.Deferred();return $.when(i.dataService.postPlan(n)).always(function(n,i,r){r.status===201?t.resolve(n):t.reject()}),t.promise()}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.create",["workportalFacade","dataService","notifier",bizagi.workportal.widgets.project.plan.create]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.edit",{},{init:function(n,t,i,r){var u=this;u.params=r;u.planToEdit;u._super(n,t,r);u.notifier=i;u.loadTemplates({"plans.manager.popup.edit.plan":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.plan.edit").concat("#plans-manager-popup-edit-plan")});u.editDialogBox={}},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this},closeEditDialogBox:function(){var n=this;n.editDialogBox.elements.inputDueDate.datepicker("destroy");n.editDialogBox.formContent.dialog("destroy");n.editDialogBox.formContent.detach()},showPopup:function(n,t,i){var r=this;r.planToEdit=i;r.initEditDialogBox(i);r.editDialogBox.elements.inputName.val(i.name);r.editDialogBox.elements.inputDesc.val(i.description);r.editDialogBox.elements.inputWaitForCompletion.prop("checked",i.waitForCompletion);r.editDialogBox.elements.inputDueDate.datepicker();r.editDialogBox.elements.inputDueDate.datepicker("option","dateFormat",bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());i.dueDate&&r.editDialogBox.elements.inputDueDate.datepicker("setDate",new Date(i.dueDate));r.editDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-project-plan-editplan"),maximize:!0,close:function(){r.editDialogBox.elements.inputDueDate.datepicker("destroy");r.editDialogBox.formContent.dialog("destroy");r.editDialogBox.formContent.detach()}})},initEditDialogBox:function(n){var t=this,i=t.getTemplate("plans.manager.popup.edit.plan");t.editDialogBox.formContent=i.render(n);t.editDialogBox.elements={inputName:$("#input-name-plan",t.editDialogBox.formContent),inputDesc:$("#input-desc-plan",t.editDialogBox.formContent),inputDueDate:$("#input-dueDate-plan",t.editDialogBox.formContent),inputWaitForCompletion:$("#input-waitForCompletion",t.editDialogBox.formContent),buttonSave:$("#button-accept-edit-plan",t.editDialogBox.formContent),buttonCancel:$("#button-cancel-edit-plan",t.editDialogBox.formContent)};t.editDialogBox.elements.buttonSave.on("click",$.proxy(t.saveEditedPlan,t));t.editDialogBox.elements.buttonCancel.on("click",$.proxy(t.closeEditDialogBox,t))},saveEditedPlan:function(n){n.preventDefault();var t=this;t.validateEditDialogBoxParams()&&$.when(t.getParamsUpdatePlan()).done(function(n){$.when(t.dataService.updatePlan(n)).done(function(){t.closeEditDialogBox();t.pub("planEditedSuccess",{paramsEditPlan:n})}).fail(function(){t.pub("planEditedFailed")})})},getParamsUpdatePlan:function(){var n=this,i=$.Deferred(),t={},r,u;return t=n.planToEdit,t.name=n.editDialogBox.elements.inputName.val(),t.description=n.editDialogBox.elements.inputDesc.val(),n.editDialogBox.elements.inputWaitForCompletion.length!==0&&(t.waitForCompletion=n.editDialogBox.elements.inputWaitForCompletion.prop("checked")),r=n.editDialogBox.elements.inputDueDate.datepicker("getDate"),r?(u={idUser:bizagi.currentUser.idUser,date:r.getTime()},$.when(n.dataService.getEndHourWorkingByDate(u)).done(function(n){t.dueDate=n.dateTime;i.resolve(t)})):i.resolve(t),i.promise()},validateEditDialogBoxParams:function(){var i=this,n=i.editDialogBox.elements.inputName,t;return n.val()&&n.val()!==""?!0:(t=bizagi.localization.getResource("workportal-project-plan-popup-field-name-required"),n.next().find("span").html(t),!1)}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.edit",["workportalFacade","dataService","notifier",bizagi.workportal.widgets.project.plan.edit]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.template.create",{},{init:function(n,t,i){var r=this;r.params=i;r.contextualized;r.idPlanSelected;r._super(n,t,i);r.loadTemplates({"plan-template-create":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.plan.template.create").concat("#plan-template-create")});r.dialogBox={}},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.initPlugins()},initPlugins:function(){var n=this,t=n.getTemplate("plan-template-create");n.dialogBox.formContent=t.render({});n.dialogBox.elements={inputName:$("#input-name-template",n.dialogBox.formContent),buttonSave:$("#button-accept-create-template",n.dialogBox.formContent),buttonCancel:$("#button-cancel-create-template",n.dialogBox.formContent)};n.dialogBox.elements.buttonSave.on("click",$.proxy(n.onClickSaveTemplate,n));n.dialogBox.elements.buttonCancel.on("click",$.proxy(n.closeDialogBox,n))},closeDialogBox:function(){var n=this;n.dialogBox.formContent.dialog("destroy");n.dialogBox.formContent.detach()},showPopupAddTemplatePlan:function(n,t,i,r){var u=this;u.params=n;u.dataService=t;u.contextualized=i;u.idPlanSelected=r;u.content=$("<div><\/div>");u.initPlugins();u.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-project-plan-action-popup-save-as-template"),maximize:!1,close:function(){u.dialogBox.formContent.dialog("destroy");u.dialogBox.formContent.detach()}})},onClickSaveTemplate:function(n){var t,i;n.preventDefault();t=this;t.validateSaveDialogBoxParams()&&(i={idPlan:t.idPlanSelected,name:t.dialogBox.elements.inputName.val()},$.when(t.dataService.createTemplateByPlan(i)).done(function(){t.closeDialogBox();t.pub("planTemplateCreatedSuccess",{})}).fail(function(){t.pub("planTemplateCreatedFailed",{})}))},validateSaveDialogBoxParams:function(){var i=this,n=i.dialogBox.elements.inputName,t;return n.val()&&n.val()!==""?!0:(t=bizagi.localization.getResource("workportal-project-plan-popup-field-name-required"),n.next().find("span").html(t),!1)}});bizagi.injector.register("bizagi.workportal.widgets.project.plan.template.create",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.template.create]);
bizagi.workportal.widgets.admin.caseSearch.extend("bizagi.workportal.widgets.reassigncase",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"admin.case.search":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search"),"admin.case.search.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-fields"),"admin.case.search.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-buttons"),"admin.case.search.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-result"),"admin.case.search.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-pagination"),"admin.case.search.invalidate":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-invalidate"),"admin.case.search.reassign":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign"),"admin.case.search.reassign.form":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign-form"),"admin.case.search.action.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-action-result"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE},renderContent:function(){var n=this,i=n.getTemplate("admin.case.search"),t;return t=n.content=$.tmpl(i,{}),n.loadtemplates(),t},loadtemplates:function(){var n=this;n.generalContentTmpl=n.getTemplate("admin.case.search");n.fieldsContentTmpl=n.getTemplate("admin.case.search.fields");n.buttonContentTmpl=n.getTemplate("admin.case.search.button");n.resultContentTmpl=n.getTemplate("admin.case.search.result");n.paginationTmpl=n.getTemplate("admin.case.search.pagination");n.invalidateContentTmpl=n.getTemplate("admin.case.search.invalidate");n.reassignContentTmpl=n.getTemplate("admin.case.search.reassign");n.reassignFormTmpl=n.getTemplate("admin.case.search.reassign.form");n.actionResultContentTmpl=n.getTemplate("admin.case.search.action.result")},postRender:function(){var n=this;n.maxElemShow=10;n.maxPageToShow=5;n.processNavigation=[];n.setupData()},setupData:function(){var n=this,t={cases:[]},i=[];n.setupInitialData();n.setupDatePicker();n.setupProcessTree();n.setupMainButtons();t.cases.push({idCase:n.params.data.idCase,idWorkItem:n.params.data.idWorkItem});i.push({taskItem:n.params.data.idCase+": "+n.params.data.idtask,idWorkItem:n.params.data.idWorkItem});n.selectedTasks=t;n.selectedTasksToShow=i;n.showReassignForm(n.content,n.selectedTasksToShow)},setupInitialData:function(){var n=this,t=n.getContent(),i;n.buttonBackAction="backToMainForm";n.selectedUserId="";n.selectedUserName="";n.selectedTasks="";n.selectedTasksToShow="";n.searchParams="";n.processTree="";$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle"));$("#mainForm",t).remove();$("#dinamicContent",t).remove();$("#case-search-log-data-buttonset",t).remove();i=$.tmpl(n.reassignFormTmpl,{});t.append(i)},setupDatePicker:function(){var n=this,t=n.getContent();$(".biz-wp-form-datepicker",t).datepicker({controlType:"select",dateFormat:"dd/mm/yy"})},setupProcessTree:function(){var n=this,t=n.getContent();bizagi.treeRoutSelected=[];$("#treeLinksId").remove();n.processTree=new bizagi.workportal.widgets.processtree(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#processTree",t)}));n.processTree.render()},setupUsersSearchForm:function(){var n=this,i=n.getContent(),t=$.Deferred();$("#biz-wp-users-table-form").html("");n.usersTable=new bizagi.workportal.widgets.userstable(n.workportalFacade,n.dataService,$.extend(n.params,{canvas:$("#biz-wp-users-table-form",i),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admincasesearch-reassign")],parentDef:t}));n.usersTable.render();$.when(t).done(function(t,i){n.assignEventReassignLinks(t,i)})},findResults:function(n,t,i){var r=this;t.Page=i?i:1;$.when(r.dataService.getAdminCasesList(t)).done(function(i){var f;if($(".biz-wp-table").remove(),$(".case-search-action-wrapper").remove(),$("#biz-wp-table-summary-wrapper").remove(),r.totalRecords=i.records,r.totalPages=i.total,i.rows.length>0){r.showCasesSearchResultFrame(n,i);r.setupActionsButton(n);var o=r.maxPageToShow>r.totalPages?r.totalPages:r.maxPageToShow,s=$("#biz-wp-table-pager-wrapper"),u={},e;for(u.pagination=r.totalPages>1?!0:!1,u.page=i.page,u.pages={},f=1;f<=o;f++)u.pages[f]={pageNumber:f};e=$.tmpl(r.paginationTmpl,u).html();s.append(e);$("ul").bizagiPagination({maxElemShow:r.maxElemShow,totalPages:r.totalPages,actualPage:i.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(i){r.findResults(n,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),"Bizagi","warning")}).fail(function(n){bizagi.log(n)})},showCasesSearchResultFrame:function(n,t){var i=this,r=i.preprocessResultList(t.headers,t),u=$.tmpl(i.resultContentTmpl,{headers:t.headers,rows:r}),f=$.tmpl(i.invalidateContentTmpl,{}),e=$.tmpl(i.reassignContentTmpl,{});$("#mainForm",n).hide();$("#dinamicContent",n).html(u);$(".case-search-action-wrapper",n).append(f);$(".case-search-action-wrapper",n).append(e);$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title"));$("#btn-admin-case-search-clear",n).hide();$("#btn-admin-case-search",n).hide();$("#btn-admin-case-back",n).css("display","inline");i.setupActivitiesLink(n);i.setupGraphicQueryEvent(n)},preprocessResultList:function(n,t){for(var u=this,r=[],f=t.rows.length,i=0;i<f;i++)r.push(u.processResultItem(n,t.rows[i]));return r},processResultItem:function(n,t){var i=this,e=t.data,l=t.idCase,k=t.idWorkFlow,p=[],r=[],h,v,y,u=[],w,o=-1,f=0,b=!1,c,a,s;for(r.push({id:"checkCaseAdmin",value:l});o++<n.length-1;)switch(n[o].fieldName){case i.columnsID.caseNumber:r.push({id:"caseNumber",value:{idCase:l,caseNumber:e[f]}});f++;break;case i.columnsID.process:r.push({id:"idWorkItem",value:e[f]});f++;break;case i.columnsID.userName:case i.columnsID.task:case i.columnsID.taskDueDate:if(h===undefined){for(s=e.length;s-->0;)if(Array.isArray(e[s])){h=e[s];b=!0;break}f++}b?(n[o].fieldName==i.columnsID.taskDueDate&&e.splice(o,1),y=h[0],i.columnsID.userName==n[o].fieldName?(r=r.concat(i.processTaskObjectUser(y)),u.indexOf(i.columnsID.userName)==-1&&u.push(i.columnsID.userName)):i.columnsID.task==n[o].fieldName?(r=r.concat(i.processTaskObject(y,l)),u.indexOf(i.columnsID.task)==-1&&u.push(i.columnsID.task)):i.columnsID.taskDueDate==n[o].fieldName&&(r=r.concat(i.processTaskObjectDate(y)),u.indexOf(i.columnsID.taskDueDate)==-1&&u.push(i.columnsID.taskDueDate))):n[o].fieldName==i.columnsID.taskDueDate&&(r=r.concat({estimatedSolutionDate:e[o]}),u.indexOf(i.columnsID.taskDueDate)==-1&&u.push(i.columnsID.taskDueDate));break;case i.columnsID.processCreationDate:r.push({id:"processCreationDate",value:e[f]});f++;break;case i.columnsID.processDueDate:r.push({id:"processDueDate",value:e[f]});f++;break;default:r.push({id:"customField",value:e[f]});f++}if(r.push({id:"viewProcess",value:{idCase:l,idworkflow:k}}),p.push({attr:"first_row",data:r}),v=h?h.length:0,v>1)for(w=u.length,c=1;c<v;c++){for(a=[],s=-1;s++<w-1;)u[s]==i.columnsID.task?a.push(i.processTaskObject(h[c],l)):u[s]==i.columnsID.taskDueDate?a.push(i.processTaskObjectDate(h[c])):u[s]==i.columnsID.userName&&a.push(i.processTaskObjectUser(h[c]));p.push({attr:"next_row",data:a})}return{data:p,totalTask:v}},processTaskObject:function(n,t){return{taskName:n.taskName,colorState:n.colorState,idCase:t,idWorkItem:n.idWorkItem,idTask:n.idTask}},processTaskObjectDate:function(n){var t={};return t.estimatedSolutionDate=n.estimatedSolutionDate?n.estimatedSolutionDate:"",t},processTaskObjectUser:function(n){var t={};return t.userName=n.assignee?n.assignee:"",t},invalidateCases:function(n){var i=this,t={cases:[]};$("input:checkbox[name=CaseAdmin]:checked",n).each(function(){var n=$(this).val();t.cases.push({idCase:n})});t.cases.length==0?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-empty-msg"),"Bizagi","warning"):$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-confirm-msg"),"Bizagi","warning")).done(function(){var r=$("#txtReason",n).val(),u={action:"abort",cases:JSON.stringify(t),reason:r};$.when(i.dataService.abortReassignItems(u)).done(function(t){i.showActionResultFrame(n,t.response,"invalidate")}).fail(function(n){bizagi.log(n)})})},showReassignTasksFrame:function(n){var i=this,r={cases:[]},t=[];$("input:checkbox[name=workItemAdmin]:checked",n).each(function(){var n=$(this).val();n=n.split("|");r.cases.push({idCase:n[0],idWorkItem:n[1]});t.push({taskItem:n[0]+": "+n[2],idWorkItem:n[1]})});t.length==0?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-empty-msg"),"Bizagi","warning"):(i.selectedTasks=r,i.selectedTasksToShow=t,i.showReassignForm(n,t))},showReassignForm:function(n,t){var i=this,r;i.buttonBackAction="backToCases";r=$.tmpl(i.reassignFormTmpl,{tasks:t});$("#dinamicContent",n).hide();$("#dinamicContent2",n).html(r);$("#btn-admin-case-search-clear",n).hide();$("#btn-admin-case-search",n).hide();$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-title"));i.setupUsersSearchForm()},reassignTasks:function(){var n=this,t=n.getContent(),i={action:"reassignItems",cases:JSON.stringify(n.selectedTasks),idNewUser:n.selectedUserId};$.when(n.dataService.abortReassignItems(i)).done(function(i){n.showActionResultFrame(t,i.response,"reassign")}).fail(function(n){bizagi.log(n)})},showActionResultFrame:function(n,t,i){var h=this,s=t.length>1?"-several":"",u="",f="",e=[],r,o;if(s=i+s,s=="invalidate")for(r=0;r<t.length;r++)t[r].deleted==!0?(u=t[r].idCase,u+=r+1<t.length?", ":"",e[0]=!0):(f=t[r].idCase,f+=r+1<t.length?", ":"",e[1]=!1);else if(s=="invalidate-several")for(r=0;r<t.length;r++)t[r].deleted==!0?(u+=t[r].idCase,u+=r+1<t.length?", ":"",e[0]=!0):(f+=t[r].idCase,f+=r+1<t.length?", ":"",e[1]=!1);else if(s=="reassign")for(r=0;r<t.length;r++)t[r].reassigned==!0?(u+=t[r].idCase,u+=r+1<t.length?", ":"",e[0]=!0):(f=t[r].idCase,f+=r+1<t.length?", ":"",e[1]=!1);else if(s=="reassign-several"){for(u+="<br/><br/>",f+="<br/><br/>",r=0;r<t.length;r++)t[r].reassigned==!0?(u+=t[r].idCase+"<br/>",e[0]=!0):(f+=t[r].idCase+"<br/>",e[1]=!1);u+="<br/>";f+="<br/>"}o=$.tmpl(h.actionResultContentTmpl,{action:s,resultStatus:e});o=o[0].innerHTML.replace("{0}","<strong>"+u+"<\/strong>");o=o.replace("{3}","<strong>"+f+"<\/strong>");o=o.replace("{1}",h.selectedUserName);o=o.replace("{1}",h.selectedUserName);i=="invalidate"&&$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-result-title"));$("#mainForm",n).html("");$("#dinamicContent",n).css("display","inline");$("#dinamicContent",n).html(o);$("#dinamicContent2",n).remove();$("#usersTable",n).remove();$("#btn-admin-case-back",n).css("display","none");$("#btn-admin-case-search-clear",n).css("display","none");$("#btn-admin-case-search",n).css("display","none");$("#btn-admin-case-finish",n).css("display","inline");$("#biz-wp-userstable-wrapperform").hide();$("#biz-wp-userstable-wrapperlist").hide();h.usersTable.resultStatus=e.indexOf(!1)==-1},setupMainButtons:function(){var n=this,t=n.getContent(),r=$.tmpl(n.buttonContentTmpl,{}),i;t.append(r);i=$("#case-search-log-data-buttonset",t);$("#btn-admin-case-search-clear",i).click(function(){$(".biz-wp-input-text",t).val("");$(".biz-wp-form-datepicker",t).val("");n.setupProcessTree()});$("#btn-admin-case-search",i).click(function(){var f="",e="",o="",i="",u="",r=n.processTree.getTreeRouteSelected(),s;r.length>0&&(r.length==2?(f=r[1],o=r[0],e=""):(f=r[r.length-1],e=r[1],o=r[0]));s={h_action:"getCases",I_ProcessState:"Running",h_idApp:"",I_Users:"ALL",eventAsTask:!0,orderType:1,order:"",orderField:"",I_radNumber:$("#caseInput").val(),I_idWFClass:o,I_USERFULLNAME:$("#userNameInput").val(),I_USERPOSITION:$("#userPositionInput").val(),I_From__CreationDate:$("#sinceDate").val(),I_To__CreationDate:$("#toDate").val(),h_idWFClassAuth:"",I_idCategory:e,I_idApplication:f,PageSize:n.maxElemShow};$("#sinceDate").val()==""||bizagi.util.isDate($("#sinceDate").val())?$("#toDate").val()==""||bizagi.util.isDate($("#toDate").val())?(n.searchParams=s,n.findResults(t,s)):(i=bizagi.localization.getResource("workportal-general-invalid-date"),u=bizagi.localization.getResource("workportal-widget-admincasesearch-to-date"),i=i.replace("{0}",u),bizagi.showMessageBox(i,"Bizagi","warning")):(i=bizagi.localization.getResource("workportal-general-invalid-date"),u=bizagi.localization.getResource("workportal-widget-admincasesearch-date-since"),i=i.replace("{0}",u),bizagi.showMessageBox(i,"Bizagi","warning"))});$("#btn-admin-case-back",i).click(function(){n.buttonBackAction=="backToMainForm"?n.backToMainForm():n.buttonBackAction=="backToCases"&&n.backToCases()});$("#btn-admin-case-finish",i).click(function(){n.publish("closeCurrentDialog")})},backToCases:function(){var t=this,n=t.getContent();t.buttonBackAction="backToMainForm";$("#dinamicContent",n).show();$("#dinamicContent2",n).html("");$("#usersTable").remove();$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title"));$("#btn-admin-case-search-clear",n).hide();$("#btn-admin-case-search",n).hide()},backToMainForm:function(){var t=this,n=t.getContent();$("#mainForm",n).show();$("#dinamicContent",n).html("");$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle"));$("#btn-admin-case-search-clear",n).show();$("#btn-admin-case-search",n).show();$("#btn-admin-case-back",n).css("display","none")},assignEventReassignLinks:function(n,t){var i=this;i.selectedUserId=n;i.selectedUserName=t;i.reassignTasks()},setupActionsButton:function(n){var t=this;$("#btn-admin-case-invalidate",n).click(function(){t.invalidateCases(n)});$("#btn-admin-case-reassign",n).click(function(){t.showReassignTasksFrame(n)})},setupActivitiesLink:function(n){var t=this;$(".activityClicked",n).click(function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:$(this)[0].getAttribute("data-idworkItem"),idTask:$(this)[0].getAttribute("data-idTask")});t.publish("closeCurrentDialog")});$(".caseClicked",n).click(function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:"",idTask:""});t.publish("closeCurrentDialog")});$(".cases-column-header",n).click(function(){var r=$(this)[0].getAttribute("data-columnorder"),i=$(this)[0].getAttribute("data-ordertype"),u=$(this)[0].getAttribute("data-columnOrderName");i=i=="1"?0:1;t.searchParams.order=r;t.searchParams.orderType=i;t.searchParams.orderField=u;t.findResults(n,t.searchParams,t.searchParams.Page)})},setupGraphicQueryEvent:function(n){var t=this;$(".biz-wp-diagram-view-icon",n).click(function(){var n=$(this).data("idcase"),i=$(this).data("idworkflow");t.showGraphicQuery({idCase:n,idWorkflow:i})})}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var n=this,t=n.getTemplate("project-content-dashboard");return n.content=t.render({}),n.content},postRender:function(){var n=this;setTimeout(function(){$(window).trigger("resize")},1e3)}});bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(n,t,i){var r=this;r.params=i||{};r._super(n,t,i);r.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.params.contextsLeftSidebarCaseDashboard.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,r,u,f;i.params=$.extend(i.params,t.args);i.params.plan.idActivitySelected=undefined;i.clean();r=i.getContent().empty();typeof n.type!="undefined"&&(i.params.showContextByMenuDashboard=n.type);u={showFormOverview:i.params.menuDashboard.showFormOverview,showFormActivity:i.params.menuDashboard.showFormActivity,showCommentsOptionMenu:i.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:i.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:i.params.menuDashboard.showTimeLineOptionMenu,showPlanOptionMenu:i.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:i.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:i.params.menuDashboard.contextFormActivityOptionMenu};f=i.getTemplate("project-dashboard-menu");f.render(u).appendTo(r);i.params.showContextByMenuDashboard&&$("li[data-context='"+i.params.showContextByMenuDashboard.toUpperCase()+"']",i.content).addClass("active").siblings().removeClass("active");i.handlerEvents()},loadContentById:function(n){var t=this,r,i;n.preventDefault();r=$(n.target).closest("li");r.hasClass("active")||(i=r.data("context"),i&&$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var f=t.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),n=parseInt(f[0]),r="",u=n;i=="PLANACTIVITIES"&&(u=n+1,r=bizagi.localization.getResource("workportal-project-casedashboard-plan"));t.params.refreshLastItemBreadcrumb=!1;t.pub("notify",{type:i.toUpperCase(),args:$.extend(t.params,{showContextByMenuDashboard:i,histName:r,level:u})});$("li[data-context='"+t.params.showContextByMenuDashboard.toUpperCase()+"']",t.content).addClass("active").siblings().removeClass("active")}))},subMenuHandler:function(){var t=this,n=t.getContent(),i=$("[data-context='COMMENTS']",n),r=$("[data-context='FILES']",n),u=$("[data-context='TIMELINE']",n);$(".ui-bizagi-wp-project-tab-submenu a",n).on("click",function(){i.toggle();r.toggle();u.toggle()})},handlerEvents:function(){var n=this,t=n.getContent();n.subMenuHandler();$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(n.loadContentById,n));$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:n.params.idCase,idTask:n.params.idTask,idWorkflow:n.params.idWorkflow,idWorkItem:n.params.idWorkitem,referrer:n.params.referrer||"inboxGrid"};n.publish("executeAction",t)})},clean:function(){var n=this,t=n.getContent();n.params&&n.params.contextsLeftSidebarCaseDashboard&&n.params.contextsLeftSidebarCaseDashboard.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))});$(".ui-bizagi-wp-project-tab-links a",t).off();$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}});bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0);
bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.activity",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({"project-activity":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity").concat("#project-activity-wrapper")})},renderContent:function(){var n=this,t=n.getTemplate("project-activity");return n.content=t.render({}),n.content},postRender:function(){var n=this;n.renderForm({idCase:n.params.idCase,idWorkitem:n.params.idWorkitem,idTask:n.params.idTask,radNumber:n.params.radNumber,withOutGlobalForm:n.params.withOutGlobalForm||!1,isClosed:n.params.isClosed,belongCurrentUser:n.params.belongCurrentUser,hasGlobalForm:bizagi.util.parseBoolean(n.params.hasGlobalForm),showForm:bizagi.util.parseBoolean(n.params.showForm),isOfflineForm:n.params.isOfflineForm||!1,messageForm:n.params.messageForm||""})},renderForm:function(n){var t=this,r=t.getContent(),f=!n.isClosed&&!n.belongCurrentUser,i,o,u,s;if(f&&(f=!0,n.withOutGlobalForm=n.hasGlobalForm?!1:!0),n.withOutGlobalForm)o=t.workportalFacade.getTemplate("info-message"),u=n.messageForm!==""?n.messageForm:t.resources.getResource("render-without-globalform"),typeof t.params!="undefined"&&typeof t.params.isOfflineForm!="undefined"&&t.params.isOfflineForm==!0&&(u=t.resources.getResource("render-without-globalform-offline")),s=$.tmpl(o,{message:u}),s.appendTo(r),i=$.Deferred(),i.fail();else{var h=typeof t.dataService.serviceLocator.proxyPrefix!=undefined?t.dataService.serviceLocator.proxyPrefix:"",c=typeof t.dataService.database!=undefined?t.dataService.database:"",e=t.rendering=new bizagi.rendering.facade({proxyPrefix:h,database:c});bizagi.util.setContext(n);t.rendering.subscribe("onLoadDataItemsFromFormActivityPlan",function(n,i){t.pub("notify",{type:"UPDATE_ITEMS_FROM_FORMRENDER",args:i})});i=e.execute($.extend(n,{canvas:r,menu:t.menu}));r.bind("routing",function(n,i){var r={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.params.idCase,fromTask:t.params.fromTask||t.params.idTask,fromWorkItemId:t.params.fromWorkItemId||t.params.idWorkitem,isOfflineForm:t.params.isOfflineForm,formsRenderVersion:t.params.formsRenderVersion,onClose:function(){t.publish("changeWidget",{widgetName:bizagi.cookie("bizagiDefaultWidget")})}};r=$.extend(r,i);t.publish("executeAction",r)})}t.renderingFacade=e;t.resizeLayout()},clean:function(){}});bizagi.injector.register("bizagi.workportal.widgets.project.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.plan.sidebar",{},{init:function(n,t,i){var r=this;r._super(n,t,i);i=i||{};i.supportNav=!1;r.loadTemplates({"project-activity-plan-sidebar":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.plan.sidebar").concat("#project-activity-plan-sidebar")})},renderContent:function(){var n=this,t=n.getTemplate("project-activity-plan-sidebar");return n.content=t.render({hasRelatedPlan:n.params.planChild,showPlanAction:n.params.menuDashboard.showPlanOptionMenu}),n.content},postRender:function(){var n=this,t=n.getContent();$(".ui-bizagi-wp-project-activity-plan-sidebar-action-add > a",t).on("click",$.proxy(n.loadPlanForm,n))},loadPlanForm:function(){var n=this;$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var t=n.params.planChild&&(n.params.planChild.currentState==="EXECUTING"||n.params.planChild.currentState==="CLOSED"||n.params.planChild.currentState==="PENDING")?"PLANACTIVITIES":n.params.menuDashboard.contextPlanOptionMenu,f=n.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),i=parseInt(f[0]),r="",u=i;(t==="PLANOVERVIEW"||t==="PLANACTIVITIES")&&(u=i+1,r=bizagi.localization.getResource("workportal-project-casedashboard-plan"));n.params.refreshLastItemBreadcrumb=!1;n.pub("notify",{type:t.toUpperCase(),args:$.extend(n.params,{showContextByMenuDashboard:t,histName:r,level:u})})})},clean:function(){var n=this;$(".ui-bizagi-wp-project-activity-plan-sidebar-action-add > a",n.getContent()).off("click",$.proxy(n.loadPlanForm,n))}});bizagi.injector.register("bizagi.workportal.widgets.project.activity.plan.sidebar",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.plan.sidebar],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.datePickerRegional=bizagi.localization.getResource("datePickerRegional");r.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-popup-release":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-popup-release"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")});r.releaseDialogBox={}},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.releaseDialogBox.formContent=n.getTemplate("project-caseState-popup-release").render({}),n.content},postRender:function(){var n=this,t=n.contextsSidebarActivity||[];t.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))});n.plugins={};n.plugins.popupRelease={form:{buttonAccept:$("#button-accept-release",n.releaseDialogBox.formContent),buttonCancel:$("#button-cancel-release",n.releaseDialogBox.formContent)}};n.plugins.popupRelease.form.buttonAccept.on("click",$.proxy(n.onClickAcceptRelease,n));n.plugins.popupRelease.form.buttonCancel.on("click",$.proxy(n.onClickCancelRelease,n))},updateView:function(n,t){var i=this,r,u,f,s;if($.extend(i.params,t.args),r=t.args,i.getContent().empty(),u={},u.isFavoriteCase="off",u.isFavoriteCase=r.isFavorite&&JSON.parse(r.isFavorite)?"bz-icon-star":"bz-icon-star-outline",i.showCaseNumber(r,u),r.creationDate){var e="MM/dd/yyyy H:mm",h=r.creationDate,o=bizagi.util.dateFormatter.getDateFromFormat(h,e);u.creationDateFormat=i.getFormattedDate(o);f=bizagi.util.dateFormatter.getDateFromFormat(r.solutionDate,e);u.solutionDateFormat=i.getFormattedDate(f);s=new Date;i.calculateDataForTemplate(u,o,s,f,r)}$(i.getContent()).on("click",".show-diagram-case",function(){i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkflow})})},calculateDataForTemplate:function(n,t,i,r,u){var e=this,o=e.getContent(),f={};f.idUser=bizagi.currentUser.idUser;bizagi.util.parseBoolean(u.isOpen)?(f.fromDate=t.getTime(),f.toDate=i.getTime()):(f.fromDate=r.getTime(),f.toDate=i.getTime());$.when(e.callGetEffectiveDuration(f)).done(function(t){var i=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-t.minutes*6e4),null,!1),r;bizagi.util.parseBoolean(u.isOpen)?(n.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",i),n.colorStateCase="Opened"):(n.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",i),n.colorStateCase="Closed");n.percentCompleteBar=100;n.isOpen=bizagi.util.parseBoolean(u.isOpen);r=e.getTemplate("project-caseState-remaining");r.render($.extend(u,n)).appendTo($("#ui-bizagi-remaining",o));u.currentState.length>0&&e.initilizeActionMenu(u.currentState)})},showCaseNumber:function(n,t){var i=this,r=i.getContent(),u=i.getTemplate("project-caseState");u.render($.extend(n,t,{security:bizagi.menuSecurity})).appendTo(r);$(".case-summary-favorite",r).on("click",$.proxy(i.onClickFavorite,i));$(".case-summary-back",i.content).on("click",$.proxy(i.goToCase,i,"back"));$(".case-summary-next",i.content).on("click",$.proxy(i.goToCase,i,"next"));i.showBackNextNavigation()},getFormattedDate:function(n){var t=this,i=t.datePickerRegional.monthNames,r=n.getMonth();return i[r]+" "+$.datepicker.formatDate("dd",n)},onClickFavorite:function(n){n.preventDefault();var t=this,i={};$(n.target).hasClass("bz-icon-star-outline")?(i={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(i)).done(function(i){t.params.guidFavorite=i.idFavorites;$(n.target).removeClass("bz-icon-star-outline");$(n.target).addClass("bz-icon-star")})):(i={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(i)).done(function(){$(n.target).addClass("bz-icon-star-outline");$(n.target).removeClass("bz-icon-star")}))},initilizeActionMenu:function(n){var t=this,i=bizagi.util.parseBoolean(n[0].allowsReassign)||!1,r=bizagi.util.parseBoolean(n[0].allowReleaseActivity)||!1,u=$("#bt-case-action-reassing",t.content),f=$("#bt-case-action-release",t.content);i&&u.show();r&&f.show();(i||r)&&($(".ui-bizagi-wp-project-plan-action-menu",t.content).show(),$(".ui-bizagi-wp-project-plan-action-menu",t.content).menu({select:$.proxy(t.onSelectMenu,t)}).removeClass("ui-widget-content"))},onSelectMenu:function(n,t){var i=this,r;if($(n.currentTarget).find("i").length===0){r=$(t.item).data("item");switch(r){case"reassing":i.onClickMenuReasign();break;case"release":i.onClickMenuRelease()}}},onClickMenuReasign:function(){var n=this,t=n.params.idCase,i=n.params.idWorkitem;$.when(n.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:t,idWorkItem:i},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))},onClickMenuRelease:function(){var n=this;n.releaseDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"660px",modal:!0,title:bizagi.localization.getResource("workportal-widget-dialog-box-release-ok"),maximize:!0,close:function(){n.releaseDialogBox.formContent.dialog("destroy");n.releaseDialogBox.formContent.detach()}})},onClickAcceptRelease:function(){var n=this,t={idCase:n.params.idCase,idWorkItem:n.params.idWorkitem};$.when(n.dataService.releaseActivity(t)).done(function(i){var u=i.status?i.status:"",r;switch(u){case"Success":n.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView});break;case"ConfigurationError":r=n.getResource("workportal-widget-dialog-box-release-configuration-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(r,n.getResource("workportal-widget-dialog-box-release-error"),"error",!1);break;default:r=n.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(r,n.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}}).fail(function(){var i=n.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(i,n.getResource("workportal-widget-dialog-box-release-error"),"error",!1)});n.releaseDialogBox.formContent.dialog("destroy");n.releaseDialogBox.formContent.detach()},onClickCancelRelease:function(){var n=this;n.releaseDialogBox.formContent.dialog("destroy");n.releaseDialogBox.formContent.detach()},callGetEffectiveDuration:function(n){var i=this,t=$.Deferred();return n.fromDate?$.when(i.dataService.getEffectiveDuration(n)).done(function(n){t.resolve(n)}):t.resolve(null),t.promise()},clean:function(){var n=this,t;$(".show-diagram-case",n.getContent()).off();t=n.contextsSidebarActivity||[];this.params={};t.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})},goToCase:function(n){var t=this,i=n=="back"?t.getBackCase():t.getNextCase();i>0&&t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i})},getListKey:function(){var t=this,n;if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(n=0;n<bizagi.lstIdCases.length;n++)if(t.params.idCase==bizagi.lstIdCases[n])return n;return-1},getNextCase:function(){var t=this,n=t.getListKey();return bizagi.lstIdCases.length==n+1||bizagi.lstIdCases.length==1?-1:bizagi.lstIdCases[n+1]},getBackCase:function(){var t=this,n=t.getListKey();return n==0?-1:bizagi.lstIdCases[n-1]||-1},showBackNextNavigation:function(){var n=this,t=n.getNextCase(),i=n.getBackCase();t<=0?$(".case-summary-next").hide():$(".case-summary-next").show();i<=0?$(".case-summary-back").hide():$(".case-summary-back").show();t<=0&&i<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}});bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.datePickerRegional=bizagi.localization.getResource("datePickerRegional");r.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var u=this,e=t.args,o,f,h,s;u.params=e;u.getContent();var r={},c=e.currentState||[],i=c.filter(function(n){return n.idWorkItem===e.idWorkitem})[0];i&&(r.activityName=i.state,r.activityIsEvent=bizagi.util.parseBoolean(i.isEvent),o="MM/dd/yyyy H:mm",f=bizagi.util.dateFormatter.getDateFromFormat(i.entryDateWorkItem,o),f.getTime&&(r.initDateFormat=u.getFormattedDate(f)),h=new Date,s=bizagi.util.dateFormatter.getDateFromFormat(i.estimatedSolutionDate,o),r.estimatedSolutionDateFormat="",f.getTime&&s.getTime&&i?u.calculateDataForTemplate(i,r,f,h,s):u.updateTemplateWidget(r))},calculateDataForTemplate:function(n,t,i,r,u){var f=this,a=new Date(Date.now()-i.getTime()),h=r.getTime()-u.getTime(),c=i.getTime()-u.getTime(),l={idUser:bizagi.currentUser.idUser,fromDate:i.getTime(),toDate:Date.now()},s=!1,o={idUser:bizagi.currentUser.idUser,fromDate:r.getTime(),toDate:u.getTime()},e={};h>0?(o.fromDate=u.getTime(),o.toDate=r.getTime(),s=!0):(e.idUser=bizagi.currentUser.idUser,e.fromDate=i.getTime(),e.toDate=u.getTime());$.when(f.callGetEffectiveDuration(l),f.callGetEffectiveDuration(o),f.callGetEffectiveDuration(e)).done(function(i,r,e){var h=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-i.minutes*6e4),null,!1),o;t.colorState=n.colorState;t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",h);t.percentCompleteBar=100;c===0?t.showEstimatedSolutionDate=!1:(t.showEstimatedSolutionDate=!0,s===!1&&(o=f.getPercentBar(e.minutes,r.minutes),t.percentCompleteBar=o.percent));n&&(t.isEvent=bizagi.util.parseBoolean(n.isEvent));t.estimatedSolutionDateFormat=f.getFormattedDate(u);f.updateTemplateWidget(t)})},getPercentBar:function(n,t){var i={};return i.percent=Math.round((1-t/n)*100),i},updateTemplateWidget:function(n){var t=this,i=t.getContent().empty(),r=t.getTemplate("project-activityState-wrapper");r.render(n).appendTo(i)},getFormattedDate:function(n){var t=this,i=t.datePickerRegional.monthNames,r=n.getMonth();return i[r]+" "+$.datepicker.formatDate("dd",n)},clean:function(){var n=this,t=n.contextsSidebarActivity||[];this.params={};t.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})},callGetEffectiveDuration:function(n){var i=this,t=$.Deferred();return setTimeout(function(){n.fromDate?$.when(i.dataService.getEffectiveDuration(n)).done(function(n){t.resolve(n)}):t.resolve(null)},200),t.promise()}});bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var n=this,t=n.getTemplate("project-process-state");return n.content=t.render({}),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var r=this,i=t.args,f=r.getContent().empty(),u,e;r.params=i;u={};u.showParentProcess=i.idParentCase>=1?!0:!1;u.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase,idWorkItem:i.idWorkItem,idTask:i.idTask=="0"?"":i.idTask,idWorkflow:i.idWorkflowParentCase};e=r.getTemplate("project-process-state");e.render($.extend(i,u)).appendTo(f);$("#go-to-parent-case",f).on("click",$.proxy(r.onClickGoToParentCase,r))},onClickGoToParentCase:function(n){n.preventDefault();var t=this;t.routingExecute($(n.target).closest("#go-to-parent-case"))},clean:function(){var n=this;n.params={};n.contextsSidebarActivity.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})}});bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(n,t,i,r){var u=this;u.relatedusers=i;u._super(n,t,r);u.contextsSidebarActivity=r.contextsSidebarActivity;u.plugins={};u.users=[];u.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,r=t.args,f=i.getContent().empty(),e=i.getTemplate("project-users"),u;e.render().appendTo(f);u=[{id:r.createdBy.userId,typeName:"owner"}];i.relatedusers.render(i.content,".relatedusers-wrapper",r.idCase,u)},clean:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})}});bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.events",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var n=this,t=n.getTemplate("project-events");return n.content=t.render({}),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,r=t.args,u=i.getContent().empty();i.params=r;$.when(i.getArgsTemplate(r)).done(function(n){var t=i.getTemplate("project-events");t.render($.extend(r,n)).appendTo(u);$(".list-events li.event a",u).on("click",$.proxy(i.onClickGoEvent,i))})},getArgsTemplate:function(n){var r=$.Deferred(),t={},u=this,i;if(n.countEvents>=1)for(i=0;i<n.currentState.length;i++)n.currentState[i].isEvent=="true"&&n.currentState[i].idWorkItem==n.idWorkitem&&(n.countEvents=n.countEvents-1);return t.showEvents=n.countEvents>=1?!0:!1,t.showEvents?$.when(u.callSummaryCaseEvents(n.idCase)).done(function(i){n.showEvents=i.events.length>=1?!0:!1;n.showEvents&&(t.events=[],i.events.forEach(function(n){t.events.push($.extend(n[Object.keys(n)[0]],{idWorkFlow:i.idWorkFlow}))}));r.resolve(t)}):r.resolve(t),r.promise()},onClickGoEvent:function(n){n.preventDefault();var t=this;$("[data-bizagi-component='workarea']").empty();t.routingExecute($(n.target).closest("li"))},callSummaryCaseEvents:function(n){var i=this,t=$.Deferred();return $.when(i.dataService.summaryCaseEvents({idCase:n})).done(function(n){t.resolve(n)}),t.promise()},clean:function(){var n=this;this.params={};n.contextsSidebarActivity.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})}});bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.contextsSidebarActivity=i.contextsSidebarActivity;r.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper"),"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},renderContent:function(){var n=this;return n.content=$("<div><\/div>"),n.content},postRender:function(){var n=this;n.contextsSidebarActivity.forEach(function(t){n.sub(t,$.proxy(n.updateView,n))})},updateView:function(n,t){var i=this,u=t.args,r=i.getContent().empty();i.params=u;$.when(i.dataService.summarySubProcess({idCase:i.params.idCase})).done(function(n){var o,e,f,t,s,h;if(n.showSubProcess){for($.each(n.subProcesses,function(t){var i=n.subProcesses[t].custData,r;if(i&&i.length)for(r=0;r<i.length;r+=1)i[r]===null&&(i[r]="")}),o=n.subProcesses||n.subProcPersonalized,e=[],f=0;f<Object.keys(o).length;f+=1)t=o[f],e.push({isOpen:t.isOpen,radNumber:t.radNumber,displayName:t.displayName,idCase:t.idCase,indexSubprocess:f,idCustData:t.idCustData}),t.subProcesses&&Object.keys(t).forEach(function(n){e.push({isOpen:t[n].isOpen,radNumber:t[n].radNumber,displayName:t[n].displayName,idCase:t[n].idCase,indexSubprocess:f,idCustData:t[n].idCustData})});s=i.getTemplate("project-subprocesses");s.render($.extend(u,{auxArrayListSubprocesses:e})).appendTo(r);$(".list-subprocesses a",r).on("click",$.proxy(i.onClickGoSubprocess,i));h=".list-subprocesses li";$(h,r).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){return i.getContentTooltip($(this),n,i.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(n,t){if(typeof n.originalEvent=="undefined")return!1;var i=$(t.tooltip).attr("id");$("div.ui-tooltip").not("#"+i).remove()},close:function(n,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})}})},getContentTooltip:function(n,t,i){var y=this,p=$(n).closest("li").find("#indexSubprocess").val(),s=$(n).closest("li").find("#idCustData").val(),u,o,v,l;s=="-1"&&(s="0");var a=function(n,t){return{nameProperty:n,valueProperty:t}},h=[],r="",e=y.getSubprocessData(t,p,s),c=e.custData,f=e.custDataTypes,w=e.custFields,b=e.displayName;if(h.push(new a("subproceso",b)),c.length)for(u=0;u<c.length;u+=1)r=c[u],f&&(f[u]=="Money"?r=bizagi.util.formatMonetaryCell(r):f[u]=="Boolean"?r=bizagi.util.formatBoolean(r):f[u]=="Float"||f[u]=="Real"?r=bizagi.util.formatDecimalCell(r):typeof r=="function"&&(r="")),h.push(new a(w[u],r));return o={},o.arrayCustomsProperties=h,o.nameSubprocess=$(n).text(),v=i,l=$('<div class="bizagi-custom-tooltip-subprocesses"><\/div>'),v.render(o).appendTo(l),l.html()},getSubprocessData:function(n,t,i){var r={},f=n.subProcesses,u=n.subProcPersonalized,e;return f&&f.length>0?(r.custData=f[t].custData,r.custDataTypes=f[t].custDataTypes,e=n.CustFields[i],r.custFields=e[Object.keys(e)[0]],r.displayName=f[t].displayName):u&&Object.keys(u).length>0&&(r.custData=u[0].subProcesses[t].custData,r.custDataTypes=u[0].subProcesses[t].custDataTypes,r.custFields=u[0].CustFields[0],r.displayName=u[0].subProcesses[t].displayName),r},onClickGoSubprocess:function(n){n.preventDefault();var t=this;t.routingExecute($(n.target).closest("li"))},clean:function(){var n=this;n.params={};n.pluginTooltip=null;n.contextsSidebarActivity.forEach(function(t){n.unsub(t,$.proxy(n.updateView,n))})}});bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]);
