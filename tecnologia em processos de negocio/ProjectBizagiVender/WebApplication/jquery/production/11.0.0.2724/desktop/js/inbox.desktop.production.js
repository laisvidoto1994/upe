(function(n){n.fn.bizagiPagination=function(t){function e(){if(i.totalElements=n("li."+i.liClass,i.listElement).length,i.totalPages>i.totalElements&&i.totalElements>1&&o(),s(),i.selectedFocus&&i.actualPage>=i.totalElements&&i.totalPages>i.totalElements){var t,r=i.actualPage-Math.round(i.totalElements/2);r<1?t=1:r+i.totalElements>i.totalPages?(t=i.totalPages-i.totalElements,t=t<1?1:t):t=r;i.listElement.find("li.active").length==0&&f(t,1)}}function o(){i.listElement.prepend("<li/>").find("li:first").addClass(i.prevClass).data("page",r.previousPage).html(i.prev);i.listElement.prepend("<li/>").find("li:first").addClass(i.arrowClass+" "+i.firstClass).data("page","1").html(i.first);i.listElement.append("<li/>").find("li:last").addClass(i.nextClass).data("page",r.nextPage).html(i.next);i.listElement.append("<li/>").find("li:last").addClass(i.arrowClass+" "+i.lastClass).data("page",i.totalPages).html(i.last)}function s(){var t={};n("li."+i.liClass+", li."+i.arrowClass,i.listElement).click(function(){t.page=n(this).hasClass(i.lastClass)?i.totalPages:n.trim(n(this).data("page")+" ");t.parent=n(this).parent();t.self=n(this);i.clickCallBack(t)});c();h()}function h(){n("li."+i.prevClass,i.listElement).hover(function(){back=setInterval(function(){u(-1)},300)},function(){clearInterval(back)})}function c(){n("li."+i.nextClass,i.listElement).hover(function(){next=setInterval(function(){u(1)},300)},function(){clearInterval(next)})}function u(t){t=t||1;var r=!1,u=n("li."+i.liClass+":first",i.listElement).data("page"),e=n("li."+i.liClass+":last",i.listElement).data("page");t<0&&u>1?r=!0:t>0&&e<i.totalPages&&(r=!0);r&&f(u,t)}function f(t,r){t=t||1;r=r||0;var u;if(r>0)u=t;else if(r<0)u=t-2;else return;n.each(n("li."+i.liClass,i.listElement),function(){u++;n(this).data("page",u);n(this).find("span").html(u);n(this).attr("data-page",u);i.actualPage!=u||n(this).hasClass("active")?n(this).removeClass("active"):n(this).addClass("active")});n(i.listElement).find(".active").length==1?n(i.listElement).parent().find("#tooltipPagination").css("visibility","hidden"):n(i.listElement).parent().find("#tooltipPagination").css("visibility","visible")}var i,r;t=t||{};i={limInf:0,totalPages:1,actualPage:1,listElement:n("ul"),first:"&lt;&lt;",firstClass:"first",prev:"&lt;",prevClass:"prev",next:"&gt;",nextClass:"next",last:"&gt;&gt;",lastClass:"last",liClass:"bz-page",arrowClass:"bz-pageArrow",selectedFocus:!0,clickCallBack:function(){}};t.actualPage>t.totalPages&&(t.actualPage=t.totalPages);r={previousPage:i.actualPage>1?i.actualPage-1:1,nextPage:i.actualPage<i.totalPages?i.actualPage+1:i.totalPages};n.extend(i,i,t);e()}})(jQuery);
(function(n){n.fn.bizagiPagination=function(t){function e(){if(i.totalElements=n("li."+i.liClass,i.listElement).length,i.totalPages>i.totalElements&&i.totalElements>1&&o(),s(),i.selectedFocus&&i.actualPage>=i.totalElements&&i.totalPages>i.totalElements){var t,r=i.actualPage-Math.round(i.totalElements/2);r<1?t=1:r+i.totalElements>i.totalPages?(t=i.totalPages-i.totalElements,t=t<1?1:t):t=r;i.listElement.find("li.active").length==0&&f(t,1)}}function o(){i.listElement.prepend("<li/>").find("li:first").addClass(i.prevClass).data("page",r.previousPage).html(i.prev);i.listElement.prepend("<li/>").find("li:first").addClass(i.arrowClass+" "+i.firstClass).data("page","1").html(i.first);i.listElement.append("<li/>").find("li:last").addClass(i.nextClass).data("page",r.nextPage).html(i.next);i.listElement.append("<li/>").find("li:last").addClass(i.arrowClass+" "+i.lastClass).data("page",i.totalPages).html(i.last)}function s(){var t={};n("li."+i.liClass+", li."+i.arrowClass,i.listElement).click(function(){t.page=n(this).hasClass(i.lastClass)?i.totalPages:n.trim(n(this).data("page")+" ");t.parent=n(this).parent();t.self=n(this);i.clickCallBack(t)});c();h()}function h(){n("li."+i.prevClass,i.listElement).hover(function(){back=setInterval(function(){u(-1)},300)},function(){clearInterval(back)})}function c(){n("li."+i.nextClass,i.listElement).hover(function(){next=setInterval(function(){u(1)},300)},function(){clearInterval(next)})}function u(t){t=t||1;var r=!1,u=n("li."+i.liClass+":first",i.listElement).data("page"),e=n("li."+i.liClass+":last",i.listElement).data("page");t<0&&u>1?r=!0:t>0&&e<i.totalPages&&(r=!0);r&&f(u,t)}function f(t,r){t=t||1;r=r||0;var u;if(r>0)u=t;else if(r<0)u=t-2;else return;n.each(n("li."+i.liClass,i.listElement),function(){u++;n(this).data("page",u);n(this).find("span").html(u);n(this).attr("data-page",u);i.actualPage!=u||n(this).hasClass("active")?n(this).removeClass("active"):n(this).addClass("active")});n(i.listElement).find(".active").length==1?n(i.listElement).parent().find("#tooltipPagination").css("visibility","hidden"):n(i.listElement).parent().find("#tooltipPagination").css("visibility","visible")}var i,r;t=t||{};i={limInf:0,totalPages:1,actualPage:1,listElement:n("ul"),first:"&lt;&lt;",firstClass:"first",prev:"&lt;",prevClass:"prev",next:"&gt;",nextClass:"next",last:"&gt;&gt;",lastClass:"last",liClass:"bz-page",arrowClass:"bz-pageArrow",selectedFocus:!0,clickCallBack:function(){}};t.actualPage>t.totalPages&&(t.actualPage=t.totalPages);r={previousPage:i.actualPage>1?i.actualPage-1:1,nextPage:i.actualPage<i.totalPages?i.actualPage+1:i.totalPages};n.extend(i,i,t);e()}})(jQuery);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.inbox",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX},renderContent:function(){var n=this,r=n.getTemplate("inbox"),t={},i;return t.enableFolders=bizagi.override!=undefined&&bizagi.override.enableFolder?!0:!1,t.enableSmartFolders=bizagi.override!=undefined&&bizagi.override.enableSmartFolders?!0:!1,i=n.content=$.tmpl(r,t),bizagi.workportal.currentInboxView=n.getWidgetName(),i},renderSummaryForm:function(n){var t=this,i=new $.Deferred,r=typeof t.dataService.serviceLocator.proxyPrefix!="undefined"?t.dataService.serviceLocator.proxyPrefix:"";return bizagi.loader.start("rendering").then(function(){var u=new bizagi.rendering.facade({proxyPrefix:r});u.execute({canvas:n,summaryForm:!0,idCase:t.idCase});t.renderingFacade=u;setTimeout(function(){t.resizeLayout()},1e3);$.when(u.ready()).done(function(){i.resolve()})}),i.promise()},routingExecute:function(n){if(n==undefined)return!1;var t=this,i=n.find("#idCase").val(),r=n.find("#idWorkflow").val(),u=n.find("#idWorkItem").val(),f=n.find("#idTask").val(),e=n.find("#eventAsTasks").val()||!1;t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i,idWorkflow:r,idWorkItem:u,idTask:f,eventAsTasks:e})}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.inboxGrid",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID},renderContent:function(){var n=this,r=n.getTemplate("inbox-grid"),t={},i;return t.enableFolders=bizagi.override!=undefined&&bizagi.override.enableFolder?!0:!1,t.enableSmartFolders=bizagi.override!=undefined&&bizagi.override.enableSmartFolders?!0:!1,i=n.content=$.tmpl(r,$.extend(t,{security:bizagi.menuSecurity})),bizagi.workportal.currentInboxView=n.getWidgetName(),i},renderSummaryForm:function(n){var t=this,i=typeof t.dataService.serviceLocator.proxyPrefix!="undefined"?t.dataService.serviceLocator.proxyPrefix:"";bizagi.loader.start("rendering").then(function(){var r=new bizagi.rendering.facade({proxyPrefix:i});r.execute({canvas:n,summaryForm:!0,idCase:t.idCase});t.renderingFacade=r;setTimeout(function(){t.resizeLayout()},1e3)})},routingExecute:function(n){var t=this;if(n==undefined)return!1;var i=n.find("#idCase").val(),r=n.find("#idWorkItem").val(),u=n.find("#idTask").val(),f=n.find("#eventAsTasks").val()||!1;t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i,idWorkItem:r,idTask:u,eventAsTasks:f})}});
bizagi.workportal.widgets.inbox.extend("bizagi.workportal.widgets.inbox",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.taskState="all";r.icoTaskState="";r.idWorkflow=0;r.idCase=0;r.loadTemplates({inbox:bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox"),"inbox-cases":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases"),"inbox-cases-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases-list"),"inbox-cases-personalized-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases-personalized-list"),"inbox-common-processes":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-processes"),"inbox-common-noresults":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-noresults"),"inbox-common-header-view":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-header-view"),"inbox-common-case-summary":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description"),"inbox-common-case-summary-form":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-form"),"inbox-common-case-summary-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess"),"inbox-common-case-summary-assignees":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-assignees"),"inbox-common-case-summary-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-events"),"inbox-common-case-summary-oldrender":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-oldrender"),useNewEngine:!1})},postRender:function(){var n=this;bizagi.referrerParams=n.params.restoreStatus?bizagi.referrerParams||{}:{};n.params.taskState=n.params.taskState||bizagi.referrerParams.taskState||"all";n.processesTemplate=n.getTemplate("inbox-common-processes");n.casesTemplate=n.getTemplate("inbox-cases");n.casesTemplateList=n.getTemplate("inbox-cases-personalized-list");n.caseSummaryTemplate=n.getTemplate("inbox-common-case-summary");n.caseSummaryTemplateForm=n.getTemplate("inbox-common-case-summary-form");n.caseSummaryTemplateSubprocess=n.getTemplate("inbox-common-case-summary-subprocess");n.caseSummaryTemplateAssigness=n.getTemplate("inbox-common-case-summary-assignees");n.caseSummaryTemplateEvents=n.getTemplate("inbox-common-case-summary-events");n.noResults=n.getTemplate("inbox-common-noresults");n.paginationTemplate=n.workportalFacade.getTemplate("inbox-common-pagination-inbox");$.when(n.dataService.getInboxSummary()).done(function(t){n.updateSummary(t);n.changeTaskState(n.params.taskState)});n.configureViewControl();bizagi.override.enableSmartFolders&&n.configureSmartFolders()},configureSmartFolders:function(){var n=this,t=n.getContent(),i=$("#innerContentInbox>h2, #innerContentInbox .smartfolders",t);i.click(function(){if(n.currentPopup=="folders"){bizagi.workportal.desktop.popup.closePopupInstance();return}n.popupOpened=!0;n.currentPopup="folders";n.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS,options:{sourceElement:"#innerContentInbox>h2",modalClass:"folders","max-height":"346",height:"auto",width:"110",offset:"88 0",activeScroll:!0,foldersView:"inboxdetails",closed:function(){n.currentPopup=null}}})})},configureViewControl:function(){var n=this,t=n.getContent(),r=$("#ui-bizagi-wp-app-inbox-bt-eye",t),i=$("#ui-bizagi-wp-app-inbox-bt-eye",t).parent();r.click(function(){var r;bizagi.workportal.desktop.popup.closePopupInstance();n.popupOpened=!1;i.addClass("active");n.currentPopup="eyeDetails";var t=new bizagi.workportal.desktop.popup(n.dataService,n.workportalFacade,{sourceElement:"#ui-bizagi-wp-app-inbox-bt-eye",offset:"0 0",at:"left bottom",height:60,width:129,arrowPosition:{left:"64%"}}),u=n.getTemplate("inbox-common-header-view");t.render($.tmpl(u));$.when(t.closed()).done(function(){n.popupOpened=!1;i.removeClass("active")});r=t.getContent();$("#viewDetailsEvent",r).click(function(){n.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX});t.close()});$("#viewGridEvent",r).click(function(){n.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID});t.close()})})},updateSummary:function(n){var i=this,t=i.getContent();$(".ui-bizagi-wp-app-inbox-tab#red",t).data("taskState","Red");$(".ui-bizagi-wp-app-inbox-tab#green",t).data("taskState","Green");$(".ui-bizagi-wp-app-inbox-tab#yellow",t).data("taskState","Yellow");$(".ui-bizagi-wp-app-inbox-tab#favourites",t).data("taskState","Favorites");i.params.taskState!="all"&&$(".ui-bizagi-wp-app-inbox-tab",t).each(function(n,t){$(t).data("taskState")==i.params.taskState?$(t).addClass("active"):$(t).removeClass("active")});$(".ui-bizagi-wp-app-inbox-tab#all",t).find(".toolTip").html(n.All);$(".ui-bizagi-wp-app-inbox-tab#red",t).find(".toolTip").html(n.Red);$(".ui-bizagi-wp-app-inbox-tab#green",t).find(".toolTip").html(n.Green);$(".ui-bizagi-wp-app-inbox-tab#yellow",t).find(".toolTip").html(n.Yellow);$(".ui-bizagi-wp-app-inbox-tab",t).click(function(){$(".ui-bizagi-wp-app-inbox-tab",t).removeClass("active");$(this).addClass("active");i.changeTaskState($(this).data("taskState"))})},changeTaskState:function(n){var t=this,u=t.getContent(),i=$("#contentProc",u),r="",f;t.params.smartfoldersParameters&&t.params.smartfoldersParameters.urlParameters&&(r=t.params.smartfoldersParameters.urlParameters);f=t.params.taskState;t.params.taskState=n;n=="Favorites"?(t.taskState="all",t.onlyFavorites="true",f!==n&&(bizagi.referrerParams.page="1")):(t.taskState=n,t.onlyFavorites="");$("#ui-bizagi-wp-app-inbox-tap-selector",u).removeClass().addClass(n);i.empty();$.when(t.dataService.getAllProcesses({taskState:t.taskState||"all",onlyFavorites:t.onlyFavorites,smartfoldersParameters:r})).done(function(n){n.categories.length>0&&(n.categories[0].name="");$.tmpl(t.processesTemplate,n).appendTo(i);$.when(t.dataService.getStoredQueryFormList()).done(function(n){n.storedQueryForms.length>0&&$.when(t.workportalFacade.getWidget("queriesShortcut",{})).pipe(function(n){return widget=n,widget.render()}).done(function(){var n=widget.getContent();$("#queryFormShortcut").html(n)})});$("li",i).click(function(n){var u=$(this),f,e;$(".selected",i).removeClass("selected");u.addClass("selected");n.currentTarget&&n.currentTarget.tagName&&(bizagi.referrerParams.page="1");f=$("#idWorkflow",u).val();e=$(".ui-bizagi-wp-app-inbox-processes-name",u).text();t.changeProcess({idWorkflow:f,workflowName:e,smartfoldersParameters:r,page:bizagi.referrerParams?bizagi.referrerParams.page:undefined})});$(".ui-bizagi-wp-app-inbox-processes-start",i).click(function(n){n.stopPropagation();var r,i=this,u=$("#idWorkflow",$(i).parent()).val();$(i).removeClass("ui-bizagi-wp-app-inbox-processes-start").addClass("ui-bizagi-wp-app-inbox-processes-start-wait");$(i).parent().find("#isFavorite").val()=="false"?(r={idObject:$(i).parent().find("#guidWFClass").val(),favoriteType:"WFCLASS"},$.when(t.dataService.addFavorite(r)).done(function(n){$(i).parent().find("#guidFavorite").val(n.idFavorites);$(i).removeClass("bz-icon-star-outline").addClass("bz-icon-star");$(i).parent().find("#isFavorite").val("true");$(i).removeClass("ui-bizagi-wp-app-inbox-processes-start-wait").addClass("ui-bizagi-wp-app-inbox-processes-start");t.updateCountProcess(u,!0)})):(r={idObject:$(i).parent().find("#guidFavorite").val(),favoriteType:"WFCLASS"},$.when(t.dataService.delFavorite(r)).done(function(n){(n.deleted=="true"||n.deleted==!0)&&($(i).parent().find("#guidFavorite").val(""),$(i).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(i).parent().find("#isFavorite").val("false"),$(i).removeClass("ui-bizagi-wp-app-inbox-processes-start-wait").addClass("ui-bizagi-wp-app-inbox-processes-start"),t.updateCountProcess(u,!1))}));t.params.taskState=="Favorites"&&$(i).parent().hasClass("selected")&&$(i).parent().trigger("click")});$(".ui-bizagi-wp-app-inbox-processes-title",i).click(function(){var t=$(this).next("ul"),n=$(this).find("span"),i=t.is(":hidden")?!0:!1;i?(t.show(),n.removeClass("Right"),n.addClass("Down")):(t.hide(),n.removeClass("Down"),n.addClass("Right"))});var u=!0;t.params.restoreStatus?($.each($(".ui-bizagi-wp-app-inbox-processes-title",i),function(n,r){$.each($("li",$(r,i).next()),function(n,f){$(f).find("#idWorkflow").val()==bizagi.referrerParams.idWorkflow&&$.when($(r,i).trigger("click")).done(function(){$(f,i).addClass("selected");t.changeProcess({page:bizagi.referrerParams.page,idWorkflow:bizagi.referrerParams.idWorkflow,workflowName:$(".ui-bizagi-wp-app-inbox-processes-name",$(f,i)).text()});u=!1})})}),t.params.restoreStatus=!1):($(".ui-bizagi-wp-app-inbox-processes-title:first",i).trigger("click"),$("li:first",i).addClass("selected").trigger("click"),u=!1);u&&($(".ui-bizagi-wp-app-inbox-processes-title:first",i).trigger("click"),$("li:first",i).addClass("selected").trigger("click"));$(i).bizagiScrollbar();n.categories.length==0&&t.changeProcess()})},changeProcess:function(n){var t=this,u=t.getContent(),i=$("#contentCases",u),f=$("#footer #casesPagination"),o=$("#contentDesc",u),s=14,h="",e,r;t.params.smartfoldersParameters&&t.params.smartfoldersParameters.urlParameters&&(h=t.params.smartfoldersParameters.urlParameters);n=n||{};e=n.page||1;bizagi.referrerParams.page=e;r=n.idWorkflow;t.idWorkflow=r;i.empty();o.empty();f.empty();bizagi.showErrorAlertDialog=!1;$.when(t.dataService.getCasesByWorkflow({idWorkflow:t.idWorkflow,taskState:t.taskState,onlyFavorites:eval(t.onlyFavorites),page:e,smartfoldersParameters:h})).done(function(e){var l,c,h,a,v;if(bizagi.showErrorAlertDialog=!0,bizagi.lstIdCases=e.lstIdCases,e.idWorkflow=r,!e.rows.length){i.append("&nbsp;");o.append("&nbsp;");return}for(e.processName=n.workflowName||"",e.pagination=e.totalPages>1?!0:!1,e.pages={},l=e.totalPages,c=s>e.totalPages?e.totalPages:s,l>9&&c--,l>99&&c--,h=1;h<=c;h++)e.pages[h]={pageNumber:h};a=new bizagi.workportal.command.security(t.dataService);e.graphicQuery=a.checkSecurityPerm("GraphicQuery");e.enableFolders=bizagi.override.enableFolder||!1;v=$.tmpl(t.paginationTemplate,e).html();$(f).append(v);$.tmpl(t.casesTemplate,e,{replaceLineBreak:function(n){return typeof n=="string"?n.search(/\n/)!==-1?n.replaceAll("\n","<br/>"):n:n},formatMonetaryCell:function(n){return bizagi.util.formatMoney(n,BIZAGI_DEFAULT_CURRENCY_INFO)},formatDecimalCell:function(n){var t,i={decimalSymbol:BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,digitGroupSymbol:BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator,roundToDecimalPlace:BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits};return t=$.extend({colorize:!1,decimalSymbol:".",digitGroupSymbol:",",groupDigits:!0,negativeFormat:"(%s%n)",positiveFormat:"%s%n",roundToDecimalPlace:"2",symbol:""},i),bizagi.util.formatDecimal(n,t)},formatBoolean:function(n){return bizagi.util.parseBoolean(n)==!0?t.getResource("render-boolean-yes"):bizagi.util.parseBoolean(n)==!1?t.getResource("render-boolean-no"):""}}).appendTo(i);bizagi.util.formatInvariantDate(u,t.getResource("dateFormat")+" "+t.getResource("timeFormat"));$(".scrollCases").data("totalPage",e.totalPages);$(".scrollCases").data("page",1);$("ul").bizagiPagination({totalPages:e.totalPages,actualPage:e.page,listElement:$("ul",f),clickCallBack:function(n){t.changeProcess({idWorkflow:r,page:n.page})}});$("li",i).click(function(){var n=$(this),r,u;t.icoTaskState=$(this).children("#caseName").children("#taskState").val();$(".selected",i).removeClass("selected");n.addClass("selected");r=$("#idCase",n).val();u=$("#idWorkflowGQ",n).val();t.changeCase(r,u)});$(".ui-bizagi-inbox-folder",i).click(function(n){n.stopPropagation();var i=$(this).data("idcase");if(t.currentPopup=="folders"){bizagi.workportal.desktop.popup.closePopupInstance();return}bizagi.workportal.desktop.popup.closePopupInstance();t.popupOpened=!1;t.currentPopup="folders";t.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS,options:{sourceElement:$(this),modalClass:"folders","max-height":"146",height:"auto",width:"110",offset:"88 0",activeScroll:!0,onlyFolderMode:!0,idCase:i,closed:function(){t.currentPopup=null}}})});$(".ui-bizagi-wp-app-inbox-cases-start",i).click(function(n){n.stopPropagation();var u,i=this;$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start").addClass("ui-bizagi-wp-app-inbox-cases-start-wait");$(i).parent().find("#isFavorite").val()=="false"?(u={idObject:$(i).parent().parent().find("#idCase").val(),favoriteType:"CASES"},$.when(t.dataService.addFavorite(u)).done(function(n){$(i).parent().find("#guidFavorite").val(n.idFavorites);$(i).removeClass("bz-icon-star-outline").addClass("bz-icon-star");$(i).parent().find("#isFavorite").val("true");$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start");t.updateCountProcess(r,!0)})):(u={idObject:$(i).parent().find("#guidFavorite").val(),favoriteType:"CASES"},$.when(t.dataService.delFavorite(u)).done(function(n){(n.deleted=="true"||n.deleted==!0)&&($(i).parent().find("#guidFavorite").val(""),$(i).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(i).parent().find("#isFavorite").val("false"),$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),t.updateCountProcess(r,!1))}))});e.rows.length>0?(t.icoTaskState=$("li:first",i).children("#taskState").val(),$("li:first",i).addClass("selected").trigger("click")):t.changeCase(0);$(i).bizagiScrollbar()}).fail(function(n){n=JSON.parse(n.responseText)||{};var r=$("#contentDesc",u),f=t.workportalFacade.getTemplate("info-message"),e=n.message||n,o=$.tmpl(f,{message:e,css:"ui-bizagi-info-inbox-detail"});r.append("&nbsp;");o.appendTo(i)})},changeCase:function(n,t){var i=this,e=i.getContent(),f=$("#contentDesc",e),u={},r="";(f.empty(),i.idCase=n,i.idCase!=0)&&$.when(i.dataService.summaryCaseDetails({idCase:i.idCase})).done(function(o){var s,h;o.hasComments=o.hasComments=="true"?!0:!1;s=new bizagi.workportal.command.security(i.dataService);o.graphicQuery=s.checkSecurityPerm("GraphicQuery");typeof o.contextualized=="undefined"&&(o.contextualized=!0);o.currentState&&o.currentState.length>0&&o.currentState.forEach(function(n){n.idTask||(n.idTask=0);n.state||(n.state=n.displayName||" ")});(o.process==="undefined"||o.process===""||typeof o.process=="undefined")&&(o.process=!1);(o.processPath==="undefined"||o.processPath===""||typeof o.processPath=="undefined")&&(o.processPath=!1);h=$.tmpl(i.caseSummaryTemplate,$.extend(o,{security:bizagi.menuSecurity})).appendTo(f);bizagi.util.formatInvariantDate(e,i.getResource("dateFormat")+" "+i.getResource("timeFormat"));$("#details",h).delegate(".summaryLink","click",function(){i.routingExecute($(this))});$("#ui-bizagi-details-tabs",e).tabs({active:-1,create:function(){$(this).tabs("option","active",0)},activate:function(n,t){var h=t==undefined?"formSummary":t.newPanel.attr("id"),e,s;switch(h){case"comments":u.comments==undefined&&($.extend(i,{},bizagi.workportal.comments),o.canvas=$("#comments",f),o.readOnly=!0,$.when(i.renderComments(o)).done(function(n){u.comments=n}));bizagi.util.setContext({commentsFocus:!0});break;case"formSummary":u.formSummary==undefined&&(e=$("#formSummary",f),e.bind("oldrenderintegration",function(n){var r,t;if(!n.isPropagationStopped()){n.stopPropagation();r=i.getTemplate("inbox-common-case-summary-oldrender");t={};bizagi.oldrenderevent=!0;var u=window.addEventListener?"addEventListener":"attachEvent",f=window[u],o=u=="attachEvent"?"onmessage":"message";f(o,function(n){n.stopPropagation();i.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:n.data})},!1);$.when(i.dataService.getWorkitems({idCase:i.idCase,onlyUserWorkItems:!0})).done(function(n){if(typeof n.workItems=="object"&&n.workItems.length>=1){var u=n.workItems[0].idWorkItem,f=n.workItems[0].idTask;t.url=i.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+i.idCase+"&idWorkitem="+u+"&idTask="+f+"&isSummary=1"}else t.url=i.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+i.idCase+"&isSummary=1";e.empty();$.tmpl(r,t).appendTo(e);i.iframeOldRender($("iframe",e));i.performResizeLayout()})}}),s={idCase:i.idCase},$.when(i.dataService.getCaseFormsRenderVersion(s)).done(function(n){n.formsRenderVersion==1?e.trigger("oldrenderintegration"):$.when(i.renderSummaryForm(e)).done(function(){r=$("#formSummary",f).html();u.formSummary=r})}));break;case"subprocess":u.subprocess==undefined&&$.when(i.dataService.summarySubProcess({idCase:i.idCase})).done(function(n){r=$.tmpl(i.caseSummaryTemplateSubprocess,n);r.appendTo($("#subprocess",f));u.subprocess=r;r.delegate(".summaryLink","click",function(){i.routingExecute($(this))})});break;case"assignees":u.assignees==undefined&&$.when(i.dataService.summaryAssigness({idCase:i.idCase})).done(function(n){var e=[],t;$.each(n.events.split(", "),function(n,t){$.inArray(t,e)===-1&&e.push(t)});n.events=e.join(", ");t=[];$.each(n.activities.split(", "),function(n,i){$.inArray(i,t)===-1&&t.push(i)});n.activities=t.join(", ");r=$.tmpl(i.caseSummaryTemplateAssigness,n);r.appendTo($("#assignees",f));u.assignees=r});break;case"events":u.events==undefined&&$.when(i.dataService.summaryCaseEvents({idCase:i.idCase})).done(function(n){r=$.tmpl(i.caseSummaryTemplateEvents,n);r.appendTo($("#events",f));u.events=r;r.delegate(".summaryLink","click",function(){i.routingExecute($(this))})})}}});$.each($("#ui-bizagi-wp-app-inbox-processes-container li:even, #ui-bizagi-wp-app-inbox-cases-container li:even"),function(){$(this).addClass("ui-bizagi-wp-app-inbox-evenColor")});$(".ui-bizagi-wp-app-inbox-cases-ico-view",e).click(function(){i.showGraphicQuery({idCase:n,idWorkflow:t})});$(".workonitRow",e).button();$(".workonitRow",e).click(function(){var n=$(this).parent().find("#idWorkItem").val(),r={taskState:i.params.taskState,idWorkItem:n,idCase:i.idCase,idTask:$(this).parent().find("#idTask").val(),onlyFavorites:i.onlyFavorites,idWorkflow:i.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX};$.extend(bizagi.referrerParams,bizagi.referrerParams,r);i.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i.idCase,idTask:$(this).parent().find("#idTask").val(),idWorkItem:n,idWorkflow:t})});i.resizeLayout();$(".scrollProcess").bizagiScrollbar();$(".scrollSummary").bizagiScrollbar({autohide:!1})})},casesPagination:function(n){var t=this,u=t.getContent(),i=$("#contentCases",u),f=$("#contentCases .scrollCases ul",u),r=new $.Deferred;return t.idWorkflow=n.idWorkflow,t.page=n.page||2,bizagi.showErrorAlertDialog=!1,$.when(t.dataService.getCasesByWorkflow({idWorkflow:t.idWorkflow,taskState:t.taskState,page:t.page})).done(function(n){bizagi.showErrorAlertDialog=!0;n.processName="";$.tmpl(t.casesTemplateList,n).appendTo(f);$("li",i).click(function(){var n=$(this),r,u;$(".selected",i).removeClass("selected");n.addClass("selected");r=$("#idCase",n).val();u=$("#idWorkflowGQ",n).val();t.changeCase(r,u)});r.resolve()}).fail(function(n){n=JSON.parse(n.responseText)||{};var f=t.workportalFacade.getTemplate("info-message"),e=n.message||n,u=$.tmpl(f,{message:e});$(".ui-bizagi-error",u).width("50%");u.appendTo(i);r.resolve()}),r.promise()},performResizeLayout:function(){var n=this;this._super();n.renderingFacade&&n.renderingFacade.resize({forceResize:!0})},updateCountProcess:function(n,t){var i=this,f=i.getContent(),r=$("#contentProc",f),u=!1;if(t=t?!0:!1,i.params.taskState!="Favorites"||n=="")return!0;$.when(i.dataService.getAllProcesses({taskState:i.taskState,onlyFavorites:i.onlyFavorites})).done(function(i){i.categories=i.categories||{};$.each(i.categories,function(t,i){$.each(i.workflows,function(t,i){i.idworkflow==n&&($('li > input[value="'+n+'"][id="idWorkflow"]',r).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(i.count),u=!0)})});i.categories[bizagi.localization.getResource("workportal-widget-inbox-all-processes")].key="";u||(t?$('li > input[value="'+n+'"][id="idWorkflow"]',r).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(1):$('li > input[value="'+n+'"][id="idWorkflow"]',r).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(0))})},iframeOldRender:function(n){var i=this,t,f=i.getContent(),r="bizagiDefault",u=bizagi.readQueryString();$.each(n,function(){$(this).is("iframe")&&(t=$(this))});t.load(function(){var t=$(this).contents(),n=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";$("head",t).append("<script type='text/javascript' src='../../js/renderintegration.js'><\/script>");n=n.replace("%theme%",u.theme||r);$("body",t).append("<link type='text/css' rel='stylesheet' href='"+n+"'>")})}});
bizagi.workportal.widgets.inboxGrid.extend("bizagi.workportal.widgets.inboxGrid",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.taskState="all";r.icoTaskState="";r.idWorkflow=0;r.idCase=0;r.page=0;r.loadTemplates({"inbox-grid":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid"),"inbox-grid-rubik":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid-rubik"),"inbox-grid-cases":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid-cases"),"inbox-common-processes":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-processes"),"inbox-common-header-view":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-header-view"),"inbox-common-case-summary":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description"),"inbox-common-case-summary-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess"),"inbox-common-case-summary-assignees":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-assignees"),"inbox-common-case-summary-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-events"),"inbox-common-case-summary-oldrender":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-oldrender"),useNewEngine:!1})},postRender:function(){var n=this,t;bizagi.referrerParams=n.params.restoreStatus?bizagi.referrerParams||{}:{};n.params.taskState=n.params.taskState||bizagi.referrerParams.taskState||"all";n.processesTemplate=n.getTemplate("inbox-common-processes");n.casesTemplate=n.getTemplate("inbox-grid-cases");n.caseSummaryTemplate=n.getTemplate("inbox-common-case-summary");n.caseSummaryTemplateSubprocess=n.getTemplate("inbox-common-case-summary-subprocess");n.caseSummaryTemplateAssigness=n.getTemplate("inbox-common-case-summary-assignees");n.caseSummaryTemplateEvents=n.getTemplate("inbox-common-case-summary-events");n.paginationTemplate=n.workportalFacade.getTemplate("inbox-common-pagination-grid");t=new bizagi.workportal.command.security(n.dataService);t.checkSecurityPerm("Inbox").done(function(t){t?($.when(n.dataService.getInboxSummary()).done(function(t){n.updateSummary(t);n.resizeLayout();n.changeTaskState(n.params.taskState)}),n.configureViewControl(),bizagi.override.enableSmartFolders&&n.configureSmartFolders()):($("#contentInbox").remove(),$("#contentFramework").remove(),$("#footer").remove(),n.content=$('<div class="wp-empty"><\/div>'))})},configureSmartFolders:function(){var n=this,t=n.getContent(),i=$("#innerContentInbox>h2, #innerContentInbox .smartfolders",t);i.click(function(){if(n.currentPopup=="folders"){bizagi.workportal.desktop.popup.closePopupInstance();return}n.popupOpened=!0;n.currentPopup="folders";n.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS,options:{sourceElement:"#innerContentInbox>h2",modalClass:"folders","max-height":"346",height:"auto",width:"110",offset:"88 0",activeScroll:!0,foldersView:"inboxgrid",closed:function(){n.currentPopup=null}}})})},configureViewControl:function(){bizagi.workportal.widgets.inbox.prototype.configureViewControl.apply(this,arguments)},updateSummary:function(){bizagi.workportal.widgets.inbox.prototype.updateSummary.apply(this,arguments)},changeTaskState:function(){var n=this,t=n.getContent(),i=$("#contentProc",t);bizagi.workportal.widgets.inbox.prototype.changeTaskState.apply(this,arguments);$(i).bizagiScrollbar()},changeProcess:function(n){var t=this,r=t.getContent(),i=$("#contentCases",r),a=$("#contentProc",r),u=$("#footer #casesPagination"),o=14,e;n=n||{};var f=n.idWorkflow||"",s=n.page||1,v=n.taskState||t.taskState;bizagi.referrerParams.page=s;e="";t.params.smartfoldersParameters&&t.params.smartfoldersParameters.urlParameters&&(e=t.params.smartfoldersParameters.urlParameters);var h=n.orderFieldName||"",c=n.orderType||"0",l=n.order||"";t.idWorkflow=f;i.empty();u.empty();bizagi.showErrorAlertDialog=!1;$.when(t.dataService.getCustomizedColumnsData({idWorkflow:f,taskState:v,onlyFavorites:eval(t.onlyFavorites),order:l,orderFieldName:h,orderType:c,page:s,smartfoldersParameters:e,group:bizagiConfig.groupByCaseNumber?"T_RADNUMBER":null})).done(function(n){var s,e,v,y,p;for(bizagi.showErrorAlertDialog=!0,bizagi.lstIdCases=n.cases.lstIdCases,s=0,$(n.cases.columnTitle).each(function(i,r){r.order=="T_idTask"&&$(n.cases.rows).each(function(i,r){t.isArray(r.fields[s])||(n.cases.rows[i].fields[s]={workitems:[{TaskName:r.fields[s],State:n.cases.rows[i].taskState}]})});s++}),e={},e.pagination=n.cases.totalPages>1?!0:!1,e.page=bizagi.referrerParams.page||n.cases.page,e.pages={},v=o>n.cases.totalPages?n.cases.totalPages:o,s=1;s<=v;s++)e.pages[s]={pageNumber:s};e.gridPagination="gridCasePagination";e.previousPage=n.cases.page>1?n.cases.page-1:1;e.nextPage=n.cases.page<n.cases.totalPages?n.cases.page+1:n.cases.totalPages;e.totalPages=n.cases.totalPages;y=$.tmpl(t.paginationTemplate,e).html();$(u).append(y);n.cases.enableFolders=bizagi.override.enableFolder||!1;n.cases=bizagi.util.formatDecimalAndMoneyCell(n.cases,BIZAGI_DEFAULT_CURRENCY_INFO);p=new bizagi.workportal.command.security(t.dataService);p.checkSecurityPerm("GraphicQuery").done(function(o){var s,v,y;n.cases.graphicQuery=o;n.cases.groupByCaseNumber=bizagiConfig.groupByCaseNumber;s=$.tmpl(t.casesTemplate,n.cases,{setFormat:t.formatValue,isArray:t.isArray,formatCategories:t.formatCategories,isDate:bizagi.util.isDate,replaceLineBreak:function(n){return typeof n=="string"?n.search(/\n/)!==-1?n.replaceAll("\n","<br/>"):n:n},getRadNumberColumnIndex:function(){for(var t=this.data,i=-1,n=0,r=t.columnTitle.length;n<r;n++)t.columnTitle[n].fieldName=="I_RadNumber"&&(i=n);return i},showColumn:function(n){var t=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&t==n?" style=display:none; ":""},createGroupedHeader:function(n){var t=this.data,i=!1,u=this.getRadNumber(t.rows[n]),r;return t.groupByCaseNumber&&(n==0?i=!0:(r=this.getRadNumber(t.rows[n-1]),u!=r&&(i=!0))),i},getRadNumber:function(n){var t=this.getRadNumberColumnIndex();return t>=0?n.fields[t]:""}}).appendTo(i);bizagi.util.isIE9()&&(v=new RegExp('>[ \t\r\n\v\f]*<',"g"),y=$("#ui-bizagi-wp-app-inbox-grid-cases",i).html(),$("#ui-bizagi-wp-app-inbox-grid-cases",i).html(y.replace(v,"><")));bizagi.override.ShowTimeInInboxDates==1||bizagi.override.ShowTimeInInboxDates==undefined?bizagi.util.formatInvariantDate(r,t.getResource("dateFormat")+" "+t.getResource("timeFormat")):bizagi.util.formatInvariantDate(r,t.getResource("dateFormat"));$("li",u).parent().data("order",l);$("li",u).parent().data("orderFieldName",h);$("li",u).parent().data("orderType",c);$("ul").bizagiPagination({maxElemShow:50,totalPages:e.totalPages,actualPage:e.page,listElement:$("ul",u),clickCallBack:function(n){t.changeProcess({idWorkflow:f,page:n.page,order:n.parent.data("order"),orderFieldName:n.parent.data("orderFieldName"),orderType:n.parent.data("orderType")})}});$(".workonitRow",r).button();$(".inbox-grid-tooltip-button",r).tooltip();$("#ui-bizagi-wp-app-inbox-grid-cases tr:nth-child(even)",s).addClass("event");$(".ui-bizagi-wp-app-inbox-activity-name",s).click(function(){var n={taskState:t.params.taskState,idWorkItem:$(this).find("#idWorkItem").val(),idCase:$(this).find("#idCase").val(),idTask:$(this).find("#idTask").val(),onlyFavorites:t.onlyFavorites,idWorkflow:t.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID};$.extend(bizagi.referrerParams,bizagi.referrerParams,n);var i=$(this).find("#idCase").val(),r=$(this).find("#idTask").val(),u=$(this).find("#idWorkItem").val(),f=$(this).closest("tr").data("idworkflow");t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i,idWorkItem:u,idTask:r,idWorkflow:f})});$(".ui-bizagi-wp-app-inbox-grouped",s).bind("click",function(){var r=$(this).data("radnumber"),i={taskState:t.params.taskState,idWorkItem:$(this).find("#idWorkItem").val(),idCase:$(this).find("#idCase").val(),idTask:$(this).find("#idTask").val(),onlyFavorites:t.onlyFavorites,idWorkflow:t.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID},n;$.extend(bizagi.referrerParams,bizagi.referrerParams,i);n=$(this).find("#idCase").val();t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:n})});$(s).delegate(".ui-bizagi-wp-app-inbox-cases-start","click",function(n){n.stopPropagation();var r,i=this;$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start").addClass("ui-bizagi-wp-app-inbox-cases-start-wait");$(i).parent().find("#isFavorite").val()=="false"?(r={idObject:$(i).parent().find("#idCase").val(),favoriteType:"CASES"},$.when(t.dataService.addFavorite(r)).done(function(n){$(i).parent().find("#guidFavorite").val(n.idFavorites);$(i).removeClass("bz-icon-star-outline").addClass("bz-icon-star");$(i).parent().find("#isFavorite").val("true");$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start");t.updateCountProcess(f,!0)})):(r={idObject:$(i).parent().find("#guidFavorite").val(),favoriteType:"CASES"},$.when(t.dataService.delFavorite(r)).done(function(n){(n.deleted=="true"||n.deleted==!0)&&($(i).parent().find("#guidFavorite").val(""),$(i).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(i).parent().find("#isFavorite").val("false"),$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),t.updateCountProcess(f,!1))}))});$(".workonitRow.showDesc",s).click(function(){var n=$(this).parents("td").first().find("#idCase").val(),i=$(this).closest("tr").data("idworkflow");t.showCase(n,i)});$(".ui-bizagi-wp-app-inbox-cases-ico-view",s).click(function(n){var i=$(this).parent().children("#idCase").val(),r=$(this).closest("tr").data("idworkflow");t.showGraphicQuery({idCase:i,idWorkflow:r});n.preventDefault()});$(".sortColumnsData",i).click(function(){t.changeProcess({idWorkflow:f,orderFieldName:$(this).find("#orderFieldName").val(),orderType:$(this).find("#orderType").val()==0?1:0,order:$(this).find("#order").val()})});$(i).bizagiScrollbar({autohide:!1});$(".ui-bizagi-inbox-folder",s).click(function(n){n.stopPropagation();var i=$(this).data("idcase");if(t.currentPopup=="folders"){bizagi.workportal.desktop.popup.closePopupInstance();return}t.popupOpened=!0;t.currentPopup="folders";t.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS,options:{sourceElement:$(this),modalClass:"folders","max-height":"146",height:"auto",width:"110",offset:"88 0",activeScroll:!0,onlyFolderMode:!0,idCase:i,closed:function(){t.currentPopup=null}}})});$(a).bizagiScrollbar()})}).fail(function(n){n=JSON.parse(n.responseText)||{};var r=t.workportalFacade.getTemplate("info-message"),u=n.message||n,f=$.tmpl(r,{message:u});f.appendTo(i)})},showCase:function(n,t){var r=this,e=r.getContent(),o=$("#contentDesc",e),f={},u="";(r.idCase=n,o.empty(),r.idCase!=0)&&$.when(r.dataService.summaryCaseDetails({idCase:r.idCase})).done(function(s){var a,h,c,l,v;s.hasComments=s.hasComments=="true"?!0:!1;a=new bizagi.workportal.command.security(r.dataService);s.graphicQuery=a.checkSecurityPerm("GraphicQuery");s.currentState&&s.currentState.length>0&&s.currentState.forEach(function(n){n.idTask||(n.idTask=0);n.state||(n.state=n.displayName||" ")});(s.process==="undefined"||s.process===""||typeof s.process=="undefined")&&(s.process=!1);(s.processPath==="undefined"||s.processPath===""||typeof s.processPath=="undefined")&&(s.processPath=!1);h=$.tmpl(r.caseSummaryTemplate,$.extend(s,{security:bizagi.menuSecurity})).appendTo(o);bizagi.util.formatInvariantDate(e,r.getResource("dateFormat")+" "+r.getResource("timeFormat"));$("#details",h).delegate(".summaryLink","click",function(){r.routingExecute($(this));c.dialog("close")});c=h;$("#ui-bizagi-details-tabs",e).tabs({active:-1,create:function(){$(this).tabs("option","active",0)},activate:function(n,t){var a=t==undefined?"formSummary":t.newPanel.attr("id"),e,l;switch(a){case"comments":f.comments==undefined&&($.extend(r,{},bizagi.workportal.comments),s.canvas=$("#comments"),s.readOnly=!0,$.when(r.renderComments(s)).done(function(n){f.comments=n}));bizagi.util.setContext({commentsFocus:!0});break;case"formSummary":f.formSummary==undefined&&(e=$("#formSummary",o),e.bind("oldrenderintegration",function(n){var u,t;if(!n.isPropagationStopped()){n.stopPropagation();u=r.getTemplate("inbox-common-case-summary-oldrender");t={};bizagi.oldrenderevent=!0;var f=window.addEventListener?"addEventListener":"attachEvent",o=window[f],s=f=="attachEvent"?"onmessage":"message";o(s,function(n){n.stopPropagation();r.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:n.data})},!1);$.when(r.dataService.getWorkitems({idCase:r.idCase,onlyUserWorkItems:!0,eventAsTasks:!0})).done(function(n){if(typeof n.workItems=="object"&&n.workItems.length>=1){var f=n.workItems[0].idWorkItem,o=n.workItems[0].idTask;for(i=0;i<n.workItems.length;i++)if(n.workItems[i].idCase==r.idCase){f=n.workItems[i].idWorkItem;o=n.workItems[i].idTask;break}t.url=r.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+r.idCase+"&idWorkitem="+f+"&idTask="+o+"&isSummary=1"}else t.url=r.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+r.idCase+"&isSummary=1";e.empty();$.tmpl(u,t).appendTo(e);r.iframeOldRender($("iframe",e))})}}),l={idCase:r.idCase},$.when(r.dataService.getCaseFormsRenderVersion(l)).done(function(n){n.formsRenderVersion==1?e.trigger("oldrenderintegration"):$.when(r.renderSummaryForm($("#formSummary",h))).done(function(){u=$("#formSummary",h).html();f.formSummary=u})}));break;case"subprocess":f.subprocess==undefined&&$.when(r.dataService.summarySubProcess({idCase:r.idCase})).done(function(n){u=$.tmpl(r.caseSummaryTemplateSubprocess,n);u.appendTo($("#subprocess",h));f.subprocess=u;u.delegate(".summaryLink","click",function(){r.routingExecute($(this));c.dialog("close")})});break;case"assignees":f.assignees==undefined&&$.when(r.dataService.summaryAssigness({idCase:r.idCase})).done(function(n){var t=[];$.each(n.events.split(", "),function(n,i){$.inArray(i,t)===-1&&t.push(i)});n.events=t.join(", ");u=$.tmpl(r.caseSummaryTemplateAssigness,n);u.appendTo($("#assignees",h));f.assignees=u});break;case"events":f.events==undefined&&$.when(r.dataService.summaryCaseEvents({idCase:r.idCase})).done(function(n){u=$.tmpl(r.caseSummaryTemplateEvents,n);u.appendTo($("#events",h));f.events=u;u.delegate(".summaryLink","click",function(){r.routingExecute($(this));c.dialog("close")})})}}});$(".workonitRow",e).button();$("#ui-bizagi-wp-app-inbox-description-container .ui-bizagi-wp-app-inbox-cases-ico-view",e).click(function(){r.showGraphicQuery({idCase:n,idWorkflow:t})});$(".workonitRow",h).click(function(){var n={taskState:r.params.taskState,idWorkItem:$(this).parent().find("#idWorkItem").val(),idCase:s.idCase,idTask:$(this).parent().find("#idTask").val(),onlyFavorites:r.onlyFavorites,idWorkflow:r.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID};$.extend(bizagi.referrerParams,bizagi.referrerParams,n);c.dialog("close");r.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:s.idCase,idWorkflow:t,idTask:$(this).parent().find("#idTask").val(),idWorkItem:$(this).parent().find("#idWorkItem").val()})});l={};l[bizagi.localization.getResource("workportal-case-dialog-box-close")]=function(){o.empty();h.remove();$("#ui-bizagi-wp-app-inbox-description-container").remove()};v=bizagi.override.maximizedSummary===!0;c.dialog({modal:!0,title:s.process,width:1e3,height:600,maximized:v,draggable:!0,resizable:!0,buttons:l,close:function(){o.empty();h.remove();$("#ui-bizagi-wp-app-inbox-description-container").remove()}})})},formatRequest:function(n){return n},formatCategories:function(n){return n},isArray:function(n){return typeof n=="object"?!0:!1},updateCountProcess:function(n,t){var i=this,f=i.getContent(),r=$("#contentProc",f),u=!1;if(t=t?!0:!1,i.params.taskState!="Favorites"||n=="")return!0;$.when(i.dataService.getAllProcesses({taskState:i.taskState,onlyFavorites:i.onlyFavorites})).done(function(i){i.categories=i.categories||{};$.each(i.categories,function(t,i){$.each(i.workflows,function(t,i){i.idworkflow==n&&($('li > input[value="'+n+'"][id="idWorkflow"]',r).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(i.count),u=!0)})});u||(t?$('li > input[value="'+n+'"][id="idWorkflow"]',r).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(1):$('li > input[value="'+n+'"][id="idWorkflow"]',r).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(0))})},iframeOldRender:function(n){var i=this,t,f=i.getContent(),r="bizagiDefault",u=bizagi.readQueryString();$.each(n,function(){$(this).is("iframe")&&(t=$(this))});t.load(function(){var t=$(this).contents(),n=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";n=n.replace("%theme%",u.theme||r);$("body",t).append("<link type='text/css' rel='stylesheet' href='"+n+"'>")})},dispose:function(){var n=this;n._super()}});bizagi.workportal.widgets.inboxGrid.extend("bizagi.workportal.widgets.inboxGridRubik",{},{renderContent:function(){var n=this,t=n.getTemplate("inbox-grid-rubik"),i=n.content=$.tmpl(t,{});return bizagi.workportal.currentInboxView=n.getWidgetName(),i},postRender:function(){var n=this;bizagi.referrerParams=n.params.restoreStatus?bizagi.referrerParams||{}:{};n.changeProcess({idWorkflow:"",workflowName:"All Cases ",smartfoldersParameters:""});n.getEventListener().on("PROCESS-VIEW-UPDATE",function(t,i){n.changeProcess(i)})}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.folders",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS},init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({folders:bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders"),"folders-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-elements"),"folders-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-empty-elements"),"folders-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-query-tree"),"folders-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-confirm"),"folders-default":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-default"),"folders-input-new":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-input-new"),"folders-add-case":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-add-case"),"folders-elements-node":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-element-node"),"folders-query-edit":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-edit"),useNewEngine:!1})},renderContent:function(){var n=this,t=n.getTemplate("folders");return n.content=$.tmpl(t)}});
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.smartfolders",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS},init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({smartfolders:bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders"),"smartfolders-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-elements"),"smartfolders-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-empty-elements"),"smartfolders-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-confirm"),"smartfolders-default":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-default"),"smartfolders-add-case":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-add-case"),"smartfolders-elements-node":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-element-node"),"smartfolders-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-query-tree"),"smartfolders-query-edit":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-edit"),"smartfolders-input-new":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-input-new"),useNewEngine:!1})},renderContent:function(){var n=this,t=n.getTemplate("smartfolders");return n.content=$.tmpl(t)}});
bizagi.workportal.widgets.folders.extend("bizagi.workportal.widgets.folders",{},{postRender:function(){var n=this;n.params.options.onlyFolderMode=n.params.options.onlyFolderMode||!1;n.configureTreeNavigation();n.configureBackButton();n.renderFolders(n.params.options.onlyFolderMode?"-1":"");n.scrollVertical({autohide:!1})},renderDefaultFolders:function(){var n=this,i=n.getContent(),r=n.getTemplate("folders-default"),t=$("#queries",i);t.empty();$.tmpl(r).appendTo(t)},renderFolders:function(n,t){var i=this,s=i.getContent(),o=i.params.options.onlyFolderMode!=undefined&&i.params.options.onlyFolderMode?i.getTemplate("folders-add-case"):i.getTemplate("folders-elements"),h=i.getTemplate("folders-empty-elements"),e=$("#queries",s),f,r,u={};n=n||"";$.when(i.dataService.getFolders(n)).done(function(s){e.empty();s=s||undefined;var c="";try{s.folders!=undefined&&s.folders.length>0&&(c=s.folders[0].idParent)}catch(l){}s.folders!=undefined&&s.folders!=""?(r=t!=undefined?{folders:s!=undefined?t.concat(s.folders):t}:s,$.each(r.folders,function(n,t){r.folders[n].countChilds=t!=undefined&&t.childs.folders!=undefined?r.folders[n].childs.folders.length:0}),n==""||i.params.options.onlyFolderMode?u=r:u.folders=r.folders.concat({name:i.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:c,childs:[],categoryWithLink:"true",countChilds:0}),f=$.tmpl(o,u)):i.params.options.onlyFolderMode?f=$.tmpl(h):(u.folders=[{name:i.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:c,childs:[],categoryWithLink:"true",countChilds:0}],f=$.tmpl(o,u));f.appendTo(e);i.configureNavTree(e)})},configureNavTree:function(){var n=this,t=n.getTemplate("folders-query-confirm");$("li","#queries").click(function(t){t.stopPropagation();var i=$(this).data("id"),f=$(this).data("childslength"),r=$(this).data("name"),u=$(this).data("urlparameters"),e=$(this).data("idparent"),o=n.getTemplate("folders-query-tree"),s=$("#categoryTree"),h=$(".queriesListDisplay li");f==0&&n.params.options.onlyFolderMode||(i=="-1"?($.tmpl(o,{idParentQuery:-1,queryDisplayName:r}).appendTo(s),n.configureTreeNavigation(e),n.renderFolders(i)):i=="newFolder"?n.makeFolder({listElements:h,idParent:e}):f>0?($.tmpl(o,{idParentQuery:i,queryDisplayName:r}).appendTo(s),n.configureTreeNavigation(e),n.renderFolders(i,n.params.options.onlyFolderMode?[]:[{name:r,id:i,idParent:"",childs:[],categoryWithLink:!0,urlParameters:u}])):(bizagi.workportal.desktop.popup.closePopupInstance(),f==0&&u&&$.when(n.dataService.getCasesByFolder(u)).done(function(t){bizagi.lstIdCases=t.lstIdCases;bizagi.referrerParams=bizagi.referrerParams||{};bizagi.referrerParams.radNumber="";bizagi.referrerParams.page="";bizagi.referrerParams.referrer="folders";bizagi.referrerParams.urlParameters=u;bizagi.referrerParams.name=r;bizagi.referrerParams.id=i;t.customized=!0;t.urlParameters=u;t.title=r;t.casesGroupedByFolder=!0;t.idFolder=i;n.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SEARCH,data:t,referrerParams:{}})})))});$(".addButton","#queries").click(function(t){t.stopPropagation();var i=$(".queriesListDisplay li"),r=$(this).data("id"),u=$(this).data("idparent");n.makeFolder({listElements:i,idParent:r,beforeElement:$(this).parent(),style:"newSubFolder",idParentDone:u})});$(".editButton","#queries").click(function(t){t.stopPropagation();n.editFolder($(this).parent())});$(".deleteButton","#queries").click(function(i){i.stopPropagation();var r=$.tmpl(t),u=$(this).data("id"),f=$(this).data("idparent");$(r).dialog({resizable:!0,modal:!0,title:n.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:n.getResource("workportal-widget-queries-confirm-delete"),click:function(){n.dataService.deleteFolder({idCustomFolder:u});$(this).dialog("close");n.renderFolders(f)}},{text:n.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})});$(".addIco","#queries").click(function(t){t.stopPropagation();var i=$(this),r=i.parent(),u=i.data("id");i.addClass("wait");$.when(n.dataService.associateCaseToFolder({idCustomFolder:u,idCase:n.params.options.idCase})).done(function(n){n.message==""?bizagi.workportal.desktop.popup.closePopupInstance():(i.removeClass("wait"),$(".errorMessage",r).text()==""&&(r.append($("<div class='errorMessage'><\/div>").html(n.message)),setTimeout(function(){$(".errorMessage",r).hide("blind","slow",function(){$(this).remove()})},5e3)))})})},configureBackButton:function(){var n=this,t=n.getContent(),r=$("#bt-back",t),i=$("#categoryTree",t);r.click(function(){if($("li",i).length>1){$("li:last-child",i).remove();var t=$("li:last-child").children("#idParent").val();n.renderFolders(t)}})},makeFolder:function(n){var i=this,r=n.template||i.getTemplate("folders-input-new"),t;n.beforeElement=n.beforeElement!=undefined&&n.beforeElement.length>=1?n.beforeElement:n.listElements;t=$.tmpl(r,{name:"",idParent:n.idParent,style:n.style}).insertAfter(n.beforeElement.length==1?n.beforeElement:n.beforeElement.last().prev());$(".newInput",t).focus();$(".checkico",t).click(function(){var u=$(".newInput",t).val(),r=$(this).parent();$.when(i.checkRepeatFolderName({parent:r,options:n,folderName:u})).done(function(t){t?$.when(i.dataService.makeFolder({idParentFolder:n.idParent,folderName:u})).done(function(){i.renderFolders(n.idParentDone||n.idParent)}):(r.append($("<div class='errorMessage'><\/div>").html(i.getResource("workportal-widget-folders-name-repeated"))),setTimeout(function(){$(".errorMessage",r).hide("blind","slow",function(){$(".errorMessage",r).remove()})},5e3))})});$(".newInput",t).bind("keypress",function(n){n.keyCode==13&&$(".checkico",t).click()})},checkRepeatFolderName:function(n){var i=new $.Deferred,r=this,t;return n=n||{},t=!0,n.parent.hasClass("newSubFolder")?$.when(r.dataService.getFolders(n.options.idParent)).done(function(r){r.folders!=undefined&&$.each(r.folders,function(r,u){u.name!=undefined&&n.folderName==u.name&&(t=!1,i.resolve(t))});i.resolve(t)}):($(".queriesListDisplay li").not(":last-child").each(function(){n.folderName==$(this).data("name")&&(t=!1)}),i.resolve(t)),i.promise()},editFolder:function(n){var i=this,r=$(n).data("idparent"),u=$(n).find("h3").html(),f=$(n).data("id"),e=i.getTemplate("folders-input-new"),t=$.tmpl(e,{name:u,idParent:r});n.replaceWith(t);$(".newInput",t).focus();$(".checkico",t).click(function(){var n=$(".newInput",t).val();$.when(i.dataService.updateFolder({idFolder:f,folderName:n})).done(function(){i.renderFolders(r)})});$(".newInput",t).bind("keypress",function(n){n.keyCode==13&&$(".checkico",t).click()})},configureTreeNavigation:function(n){var t=this,i=t.getContent(),r=$("#categoryTree",i);$("li:last-child",r).click(function(){n=n||$(this).children("#idParent").val();t.params.options.onlyFolderMode&&n==""&&t.renderFolders(-1);$(this).nextAll().remove();t.renderFolders(n)})},scrollVertical:function(){var n=this,t=n.getContent();$("#queries",t).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(n){var t=this,i=n.idQuery||"",r=n.idStoredQuery||"",u=n.queryFormAction||"",f=n.title||"";if(t.currentPopup=="queryform"){bizagi.workportal.desktop.popup.closePopupInstance();return}t.currentPopup="queryform";t.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,idQueryForm:i,idStoredQuery:r,queryFormAction:u,modalParameters:{title:f}})}});
bizagi.workportal.widgets.smartfolders.extend("bizagi.workportal.widgets.smartfolders",{},{postRender:function(){var n=this;n.params.options.onlyFolderMode=n.params.options.onlyFolderMode||!1;n.configureTreeNavigation();n.configureBackButton();n.renderFolders(n.params.options.onlyFolderMode?"-1":"");n.scrollVertical({autohide:!1})},renderDefaultFolders:function(){var n=this,i=n.getContent(),r=n.getTemplate("smartfolders-default"),t=$("#queries",i);t.empty();$.tmpl(r).appendTo(t)},renderFolders:function(n,t){var i=this,s=i.getContent(),e=i.params.options.onlyFolderMode!=undefined&&i.params.options.onlyFolderMode?i.getTemplate("smartfolders-add-case"):i.getTemplate("smartfolders-elements"),h=i.getTemplate("smartfolders-empty-elements"),o=$("#queries",s),f,r,u={};n=n||"";$.when(i.dataService.getSmartFolders(n)).done(function(n){o.empty();n=n||undefined;var s="";try{n.folders!=undefined&&n.folders.length>0&&(s=n.folders[0].idParent)}catch(c){}n.folders!=undefined&&n.folders!=""?(r=t!=undefined?{folders:n!=undefined?t.concat(n.folders):t}:n,$.each(r.folders,function(n,t){r.folders[n].countChilds=t!=undefined&&t.childs.folders!=undefined?r.folders[n].childs.folders.length:0}),i.params.options.onlyFolderMode?u=r:u.folders=r.folders.concat({name:i.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:s,childs:[],categoryWithLink:"true",countChilds:0}),f=$.tmpl(e,u)):i.params.options.onlyFolderMode?f=$.tmpl(h):(u.folders=[{name:i.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:s,childs:[],categoryWithLink:"true",countChilds:0}],f=$.tmpl(e,u));f.appendTo(o);i.configureNavTree()})},configureNavTree:function(){var n=this,t=n.getTemplate("smartfolders-query-confirm");$("li","#queries").click(function(t){var o;t.stopPropagation();var r=$(this).data("id"),u=$(this).data("childslength"),f=$(this).data("name"),i=$(this).data("urlparameters"),e=$(this).data("idparent"),s=$(".queriesListDisplay li");u==0&&n.params.options.onlyFolderMode||(r=="-1"?(n.configureTreeNavigation(e),n.renderFolders(r)):r=="newFolder"?n.makeFolder({listElements:s,idParent:e}):u>0?(n.configureTreeNavigation(e),n.renderFolders(r,n.params.options.onlyFolderMode?[]:[{name:f,id:r,idParent:"",childs:[],categoryWithLink:!0,urlParameters:i}])):(bizagi.workportal.desktop.popup.closePopupInstance(),u==0&&i&&(bizagi.override.viewSmartFoldersAsSearch?$.when(n.dataService.getCustomizedColumnsData({smartfoldersParameters:i})).done(function(t){bizagi.lstIdCases=t.lstIdCases;bizagi.referrerParams=bizagi.referrerParams||{};bizagi.referrerParams.radNumber="";bizagi.referrerParams.page="";bizagi.referrerParams.referrer="folders";bizagi.referrerParams.urlParameters=i;bizagi.referrerParams.name=f;bizagi.referrerParams.id=r;t.customized=!0;t.urlParameters=i;t.title=f;t.casesGroupedByFolder=!0;t.idFolder=r;n.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SEARCH,data:t,referrerParams:{}})}):(bizagi.referrerParams=bizagi.referrerParams||{},n.params.options.foldersView=="inboxgrid"?(o=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID,bizagi.referrerParams={urlParameters:i,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID}):(o=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX,bizagi.referrerParams={urlParameters:i,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX}),n.publish("changeWidget",{widgetName:o,smartfoldersParameters:{urlParameters:i},referrerParams:{}})))))});$(".editButton","#queries").click(function(t){t.stopPropagation();n.editFolder($(this).parent())});$(".deleteButton","#queries").click(function(i){i.stopPropagation();var r=$.tmpl(t),u=$(this).data("id"),f=$(this).data("idparent");$(r).dialog({resizable:!0,modal:!0,title:n.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:n.getResource("workportal-widget-queries-confirm-delete"),click:function(){n.dataService.deleteSmartFolder({idSmartFolder:u,idUser:bizagi.currentUser.idUser||0});$(this).dialog("close");n.renderFolders(f)}},{text:n.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})})},configureBackButton:function(){var n=this,t=n.getContent(),r=$("#bt-back",t),i=$("#categoryTree",t);r.click(function(){if($("li",i).length>1){$("li:last-child",i).remove();var t=$("li:last-child").children("#idParent").val();n.renderFolders(t)}})},makeFolder:function(){var n=this,t=n.dataService.getUrl({endPoint:"smartfolders-integration"})+"?ParentQueryId=-1";n.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:t,modalParameters:{title:n.getResource("workportal-widget-folders-new"),width:"1020px"}})},editFolder:function(n){var t=this,i=$(n).find("h3").html(),r=$(n).data("id"),u=t.dataService.getUrl({endPoint:"smartfolders-integration"})+"?iQueryFormId="+r;t.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:u,modalParameters:{title:i,width:"1020px"}})},configureTreeNavigation:function(n){var t=this,i=t.getContent(),r=$("#categoryTree",i);$("li:last-child",r).click(function(){n=n||$(this).children("#idParent").val();t.params.options.onlyFolderMode&&n==""&&t.renderFolders(-1);$(this).nextAll().remove();t.renderFolders(n)})},scrollVertical:function(){var n=this,t=n.getContent();$("#queries",t).bizagiScrollbar({autohide:!1})}});
