bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.casestemplate",{},{init:function(n,t,i,r,u,f,e,o){var s=this;s._super(n,t,o);s.loadTemplates({"casestemplate-container":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-wrapper"),"casestemplate-item":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-item"),"casestemplate-empty-data":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-empty-message")});s.selectorCheckboxItems=".casetemplate-box-check-selector input:checkbox";s.actionService=i;s.casetoolbar=r;s.usersCasesService=u;s.actionsEventsService=f;s.sequenceCall=0;s.accumulatedcontext=e},renderContent:function(){var n=this,t=n.getTemplate("casestemplate-container");return n.content=t.render({}),n.content},postRender:function(){var n=this,r=n.getContent(),t,i;n.sub("CASES-TEMPLATE-VIEW",$.proxy(n.updateCases,n));n.sub("UPDATE-DATATEMPLATE-VIEW",$.proxy(n.updateCases,n));n.sub("GET-COMMON-ACTIONS",$.proxy(n.getCommonActions,n));n.sub("SET-RECORDS",$.proxy(n.updateCases,n));n.sub("SET-VALUES",function(t,i){return n.setValues(i)});n.actionService.subscribe("onFormActionExecuted",$.proxy(n.onFormActionExecuted,n));n.actionService.subscribe("onFormRuleExecuted",$.proxy(n.onFormRuleExecuted,n));r.find("#casestemplate-dataviewer-list").on("click",n.selectorCheckboxItems,$.proxy(n.onCaseChecked,n));t=$("#home-navbar").outerHeight();i=$("#ui-bizagi-wp-menu").height()-t;$("#content-wrapper").scroll(function(){var n=$(".template-sticky-header-tools"),t=n.height(),r=$("#content-wrapper").scrollTop();r>=i?(n.addClass("fixed-header-tools"),$(this).css("padding-top",t+"px")):(n.removeClass("fixed-header-tools"),$(this).css("padding-top",""))})},clean:function(){var n=this,t=n.getContent();n.checkAll=!1;n.sequenceCall=0;$("#content-wrapper").unbind("scroll");t&&(n.actionService.unsubscribe("onFormActionExecuted"),n.actionService.unsubscribe("onFormRuleExecuted"),n.unsub("CASES-TEMPLATE-VIEW"),n.unsub("UPDATE-DATATEMPLATE-VIEW"),n.unsub("GET-COMMON-ACTIONS"),n.sub("SET-VALUES"),t.find("#casestemplate-dataviewer-list").off("click",n.selectorCheckboxItems))},updateCases:function(n,t){var i=this,r=t.args,u=new $.Deferred,f=$("#casestemplate-dataviewer-list",i.getContent());return f.empty(),i.actionService.init(),i.casesSelected={},i.sequenceCall++,i.page=r.page||i.page,i.idworkflow=r.idworkflow==undefined?i.idworkflow:r.idworkflow,i.route=r.route||i.route,i.filter=r.filter||i.filter,i.pageSize=r.pageSize||i.pageSize,function(n){$.when(i.getCasesData({page:i.page,idworkflow:i.idworkflow,pageSize:i.pageSize})).pipe(function(f){return i.sequenceCall!==n?(u.resolve(),[]):(i.pub("notify",{type:"PAGINATOR-UPDATE",args:$.extend(f,r,{event:t.type})}),i.getCasesTemplates(f))}).done(function(t){for(var s=i.casesLength=t.length,h=s>0?"":i.getEmptyDataMessage(),o=null,r=$(),e=0,c=t.length;e<c;e++){if(i.sequenceCall!==n){u.resolve();return}o=i.renderCase(t[e],!1,n);r.push.apply(r,o)}r.length>0?f.append(r):f.append(h);i.checkAll=!1;i.pub("notify",{type:"ENABLE-BATCHS-ACTIONS",args:{commonActions:i.setValues({args:{value:i.checkAll}})}});u.resolve(t)})}(i.sequenceCall),u.promise()},renderCase:function(n,t,i){var r=this,f=n.actionData,u=f.idCase,o=f.surrogateKey,s=f.guidEntity,h=r.getTemplate("casestemplate-item"),e=h.render({idCase:u,guidEntity:s,surrogateKey:o});return e.find("#template").append(n.tmpl),setTimeout(function(){var t=r.casetoolbar.getCaseToolbar({casetoolbarData:$.extend(n.casetoolbarData,{referrer:"CasesTemplate"})}),f=r.getContent().find("#casetemplate-box-wrapper-"+u+" .casetemplate-box-element");i===r.sequenceCall&&f.append(t)},0),setTimeout(function(){var f=r.getContent().find("#casetemplate-box-wrapper-"+u+" .casetemplate-box-footer");f.startLoading({delay:0,overlay:!0});$.when(r.actionService.getActionsView({actionData:n.actionData,loadEvents:!0,isRefresh:t})).done(function(n){var e=n.actionsView,o=n.actionsData,t=r.getContent().find("#casetemplate-box-wrapper-"+u+" .casetemplate-box-element .casetemplate-box-footer");e&&i===r.sequenceCall?(t.append(e),o.length>0&&r.getCheckBox(t).data("surrogatekey")!=-1?(r.showCheckItem(t),r.pub("notify",{type:"SOME-ITEM-ALLOW-SELECT",args:{}})):r.removeCheckItem(t)):r.removeCheckItem(t);f.endLoading()})},0),setTimeout(function(){$.when(r.usersCasesService.getAssignees(u)).done(function(n){if(n&&i===r.sequenceCall){var t=r.getContent().find("#casetemplate-box-wrapper-"+u+" .casetemplate-box-element .casetemplate-box-footer");t.append(n)}})},0),e},getCheckBox:function(n){var t=this;return n.closest(".casetemplate-box-element").find(t.selectorCheckboxItems)},removeCheckItem:function(n){var t=this;t.getCheckBox(n).remove()},showCheckItem:function(n){var t=this;t.getCheckBox(n).show()},onFormActionExecuted:function(n,t){var i=this;t=t||{};t.refresh&&i.refreshCase(t.idCase)},onFormRuleExecuted:function(n,t){var i=this;t=t||{};t.refresh&&i.refreshCase(t.idCase)},refreshCase:function(n){var i=this,r="#casetemplate-box-wrapper-"+n,t=$(r),u=t.find(".casetemplate-box-check-selector > input").is(":checked");t.startLoading({delay:250,overlay:!0});$.when(i.getCasesData({idCase:n})).then(function(n){return i.getCasesTemplates(n,!0)}).done(function(n){var f=i.renderCase(n[0],!0,i.sequenceCall);t.replaceWith(f);t.endLoading();u&&(t=$(r),t.find(".casetemplate-box-check-selector > input").prop("checked",!0))})},getCasesData:function(n){var t=this;return t.route=="following"?t.dataService.getActivitiesData(n):t.route=="pendings"?t.dataService.getPendingsData(n):t.route=="Green"||t.route=="Yellow"||t.route=="Red"?($.extend(n,{taskState:t.route}),t.dataService.getPendingsData(n)):void 0},getCasesTemplates:function(n,t){var i=this,r=[],u=new $.Deferred;return $.when(i.getTemplateEngine()).then(function(t){return $.when.apply($,$.map(n.entities,function(n){return t.render(n)}))}).done(function(){for(var c,e,s=$.makeArray(arguments),o=[],h=n.entities.length,f=0;f<h;f++)c=h===1?s[f]:s[f][0],e=n.entities[f],r.push({tmpl:c,casetoolbarData:{guidFavorite:n.entities[f].guidFavorite,idcase:n.entities[f].idCase,idWorkflow:n.entities[f].idWorkflow},actionData:{guidEntity:e.guid,idCase:e.idCase,radNumber:e.radNumber,surrogateKey:e.surrogateKey}}),o.push(e.idCase);t||(i.usersCasesService.render(o),i.actionsEventsService.render(o));u.resolve(r)}),u.promise()},getTemplateEngine:function(){var n=this,t;if(n.templateEngine)return n.templateEngine;t={};t.proxyPrefix=bizagi.RPproxyPrefix;var u=new bizagi.render.services.service(t),i=new bizagi.rendering.desktop.factory(u),r=new $.Deferred;return $.when(i.initAsyncStuff()).done(function(){n.templateEngine=new bizagi.templateEngine({renderFactory:i,cache:!0,forcePersonalizedColumns:!0});n.templateEngine.subscribe("onLoadDataNavigation",function(t,i){var r=i.data||{},u={reference:r.reference,surrogateKey:r.surrogateKey,referenceType:r.referenceType,fromActionLauncher:!1,histName:r.displayName,guidEntityCurrent:r.guidEntityCurrent,page:1};typeof r.xpath!="undefined"&&r.xpath&&(u.xpath=r.xpath);n.accumulatedcontext.clean();n.pubDeadLockDetection("notify",{type:"TEMPLATEENGINE-VIEW",args:u})});r.resolve(n.templateEngine)}),r.promise()},getEmptyDataMessage:function(){var n=this,t=n.getTemplate("casestemplate-empty-data");return t.render()[0].outerHTML},onCaseChecked:function(n){var t=this,i=$(n.target),u=i.data("surrogatekey"),r=i.data("idcase"),f=i.data("guidentity"),e=i.is(":checked");t.casesSelected[r]={surrogateKey:u,guidEntity:f,idCase:r};e||delete t.casesSelected[r];t.pub("notify",{type:"ENABLE-BATCHS-ACTIONS",args:{commonActions:t.getCommonActions()}})},getCommonActions:function(){var t=this,n={},i,r;n.actions=t.actionService.getCommonActions(t.casesSelected);n.surrogateKeys=[];n.parentsid=[];for(i in t.casesSelected)r=t.casesSelected[i],r.surrogateKey!==-1&&(n.surrogateKeys.push(r.surrogateKey),n.parentsid.push(r.idCase));return n.guidEntity=i!==undefined?t.casesSelected[i].guidEntity:"",n.surrogateKeys.length==0?(t.checkAll=!1,n.checkAll=!1):n.surrogateKeys.length==t.casesLength&&(t.checkAll=!0,n.checkAll=!0),n.itemsSelected=t.casesSelected,n},setValues:function(n){var t=this,r=t.getContent(),f=n.args||{},i=f.value,u;if(r)return t.casesSelected={},u=r.find(t.selectorCheckboxItems),$.map(u,function(n){if($(n).prop("checked",i),i){var u=$(n).data("surrogatekey"),r=$(n).data("idcase"),f=$(n).data("guidentity");t.casesSelected[r]={surrogateKey:u,guidEntity:f,idCase:r}}}),t.checkAll=i,t.getCommonActions()}});bizagi.injector.register("bizagi.workportal.widgets.casestemplate",["workportalFacade","dataService","actionService","casetoolbar","usersCasesService","actionsEventsService","accumulatedcontext",bizagi.workportal.widgets.casestemplate]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.filtercases",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.lastIdworkflow;r.loadTemplates({filtercases:bizagi.getTemplate("bizagi.workportal.desktop.widget.filtercases").concat("#filtercases-wrapper")})},renderContent:function(){var n=this,t=n.getTemplate("filtercases");return n.content=t.render({}),n.content},postRender:function(){var n=this,t=n.getContent();$("li.ui-bizagi-wp-app-inbox-tab",t).on("click",$.proxy(n.onClickButtonFilter,n));n.sub("CASES-TEMPLATE-VIEW",$.proxy(n.updateUI,n))},onClickButtonFilter:function(n){var t=this,i=$(n.currentTarget),e;if(!i.hasClass("active")){var r=i.attr("id"),f=t.pub("notify",{type:"GETIDWORKFLOW_FROM_PROCESSESLIST"})[0],u;i.addClass("active").siblings().removeClass("active");r==="pendings"?u=t.pub("notify",{type:"GETHISTNAME_FROM_PROCESSESLIST"})[0]:(e="workportal-widget-inboxcommon-filter-"+r.toLowerCase(),u=bizagi.localization.getResource(e));t.lastIdworkflow=f;t.pub("notify",{type:"CASES-TEMPLATE-VIEW",args:{histName:u,page:1,refreshLastItemBreadcrumb:!1,route:r,idworkflow:f||""}})}},updateUI:function(n,t){var i=this;t.args.route==="following"?$(i.content).hide():$(i.content).show();t.args.idworkflow!=(i.lastIdworkflow||"")&&$(".ui-bizagi-wp-app-inbox-tab:first-child").addClass("active").siblings().removeClass("active")},clean:function(){var n=this;n.unsub("CASES-TEMPLATE-VIEW")}});bizagi.injector.register("bizagi.workportal.widgets.filtercases",["workportalFacade","dataService",bizagi.workportal.widgets.filtercases]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.paginator",{},{init:function(n,t,i){var r=this;r._super(n,t,i);r.loadTemplates({paginator:bizagi.getTemplate("bizagi.workportal.desktop.widget.paginator").concat("#paginator-wrapper"),content:bizagi.getTemplate("bizagi.workportal.desktop.widget.paginator").concat("#paginator-content")})},renderContent:function(){var n=this,t=n.params.referenceType==="ENTITY",i=n.getTemplate("paginator"+n.getSuffixWidget());return n.content=i.render({hide:t}),n.content},postRender:function(){var n=this;n.sub("PAGINATOR-UPDATE",$.proxy(n.updateView,n));n.configureHandlers()},getSuffixWidget:function(){return""},updateView:function(n,t){function f(){var n=i.getTemplate("content"+i.getSuffixWidget());n.render({totalRecords:i.totalRecords,totalPages:i.totalPages,displayName:i.displayName,currentPage:i.currentPage,hide:e}).appendTo(u)}var i=this,r=t.args,e=r.referenceType==="ENTITY",u=i.getContent();i.setModel(r);u.empty();r.fromActionLauncher?i.totalRecords>1?f():i.clean():f()},setModel:function(n){var t=this;t.totalRecords=typeof n.totalRecords=="undefined"?t.totalRecords:n.totalRecords;t.totalPages=n.totalPages||t.totalPages;t.displayName=n.histName||t.displayName;t.currentPage=n.currentPage||t.currentPage;t.action=n.action;t.reference=n.reference||t.reference;t.surrogateKey=n.surrogateKey||t.surrogateKey;t.referenceType=n.referenceType||t.referenceType;t.event=n.event},getModel:function(){var n=this;return{page:n.currentPage,totalRecords:n.totalRecords,action:n.action,reference:n.reference,surrogateKey:n.surrogateKey,referenceType:n.referenceType,stopNavigation:!0}},configureHandlers:function(){var n=this,t=n.getContent();t.on("click",$.proxy(n.onPageBreak,n))},onPageBreak:function(n){var t=this,r=$(n.target),i;r.hasClass("control-icon")&&!r.hasClass("ui-state-disabled")&&(i=r.data("type"),i=="forward"?t.currentPage+=1:i=="rewind"?t.currentPage-=1:t.currentPage=i=="fastrewind"?1:t.totalPages,t.pub("notify",{type:"UPDATE-DATATEMPLATE-VIEW",args:t.getModel()}))},clean:function(){var t=this,n=t.getContent();n&&n.empty()}});bizagi.injector.register("bizagi.workportal.widgets.paginator",["workportalFacade","dataService",bizagi.workportal.widgets.paginator]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.sortbar",{},{init:function(n,t,i,r,u){var f=this;f._super(n,t,u);f.loadTemplates({sortbar:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-wrapper"),content:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content"),"right-content":bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-right"),addButton:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content-add-button"),sortMenu:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-sort-menu"),actions:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content-actions"),recordsPerPage:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-records-per-page"),recordsMenu:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-records-menu")});f.processActionService=i;f.accumulatedcontext=r},renderContent:function(){var n=this,t=n.getTemplate("sortbar");return n.content=t.render({enableFilter:!0}),n.$checkAll=n.content.find(".sortbar-left-check-uncheck input"),n.content},postRender:function(){var n=this,t=n.getTemplate("right-content");n.configureHandlers();$(".sortbar-right",n.content).append(t.render());n.configureAfterPaintHandlers()},configureHandlers:function(){var n=this,t=n.getContent();n.sub("TEMPLATEENGINE-VIEW",$.proxy(n.initializeAndProcessFilterButton,n));n.sub("SEARCH-ENGINE-VIEW",$.proxy(n.initializeAndProcessFilterButton,n));n.sub("SET-FILTERS-DATA",$.proxy(n.setFiltersSortData,n));n.sub("HIDE-FILTER-BUTTONANDBAR",$.proxy(n.hideFilterButtonAndBar,n));n.sub("HIDE-SORT-BUTTONS",$.proxy(n.hideSortButtons,n));n.sub("ENABLE-BATCHS-ACTIONS",function(t,i){return n.enableBatchActions(i)});n.sub("UPDATE-COUNTER-FILTERS-APPLIED",function(t,i){return n.updateCounterByFilterApplied(i)});n.sub("CASES-TEMPLATE-VIEW",function(){n.showingFiltering=!1;n.setVisibleCheckAll(!1)});n.sub("SOME-ITEM-ALLOW-SELECT",function(){n.setVisibleCheckAll(!0)});t.find(".wgd-sortbar-add-button").tooltip();n.$checkAll.on("click",$.proxy(n.onCheckUncheck,n))},configureAfterPaintHandlers:function(){var n=this,t=n.getContent();t.find(".right-menu").on("click",function(t){n.showSortMenu(t,$(this))});t.find(".records-menu").on("click",function(t){n.showRecordsMenu(t,$(this))});t.find(".sortbar-az").on("click",function(){n.sortSelection.attribute&&(n.setIconSortType($(this),n._sortType),n.pub("notify",{type:"SET-ORDERBY",args:{properties:{xpath:n.sortSelection.attribute,orderType:n._sortType,typeSearch:"none"}}}))});t.find(".filter-icon").on("click",function(){n.pub("notify",{type:"OPENCLOSE-MYSEARCHFILTER",args:{guidSearch:n.params.guidSearch,target:$(this)}})});$(".remove-selected-items-collections",t).on("click",$.proxy(n.onRemoveSelectedItemsCollections,n))},behaviorVisibleSortbar:function(){var n=this;n.showingFiltering||n.showingSorting||n.showingCheckAll||n._haveAddButton?n.setVisibleSortbar(!0):n.setVisibleSortbar(!1)},setVisibleSortbar:function(n){var i=this,t=i.getContent();n?t.show():t.hide()},setVisibleCheckAll:function(n){var t=this;n?(t.$checkAll.closest(".border-check-uncheck").show(),t.showingCheckAll=!0):(t.$checkAll.closest(".border-check-uncheck").hide(),t.showingCheckAll=!1);t.behaviorVisibleSortbar()},showSelectedItems:function(n){var t=this,i;n&&n>0?(t.content.addClass("there-are-actions"),i=t.getResource("workportal-general-word-selected-singular"),n>1&&(i=t.getResource("workportal-general-word-selected-plural")),$(".actions-count-selected",t.content).text(n+" "+i+" ")):t.content.removeClass("there-are-actions")},setIconSortType:function(n,t){var i=this;t==="asc"?(i._sortType="desc",n.removeClass("bz-icon-order-ascendant-outline").addClass("bz-icon-order-descendant-outline")):(i._sortType="asc",n.removeClass("bz-icon-order-descendant-outline").addClass("bz-icon-order-ascendant-outline"))},onClickBatchAction:function(n){var t=this,i=$(n.target).closest("li"),r=i.data("guid"),u=t.getAction(r);t.requestsInProgressActionGuid[r]||(t.requestsInProgressActionGuid[r]=!0,t.addLoadingButtonAction(i),$.when(t.processActionService.executeBatchAction({action:u,commonActionsmodel:t.commonActionsmodel})).always(function(){i.find(".wdg-tple-button").removeClass("state-loading");i.find(".ui-bizagi-loading-button").remove();i.find("i").show();t.requestsInProgressActionGuid[r]=undefined}))},addLoadingButtonAction:function(n){n.find(".wdg-tple-button").addClass("state-loading");n.find(".wdg-tple-button").prepend('<div class="ui-bizagi-loading-icon ui-bizagi-loading-button"><\/div>').find("i").hide()},onRemoveSelectedItemsCollections:function(){var n=this,t=n.pub("notify",{type:"SET-VALUES",args:{value:!1}})[0];n.enableBatchActions({args:{commonActions:t}})},showSortMenu:function(n,t){var i=this,u=i.getContent(),f=i.getTemplate("sortMenu"),r=f.render({filters:i._filters},{displayValue:function(n){return n}});$(".sortbar-box-menu",t).length&&$(".sortbar-box-menu",t).remove();t.append(r);r.show("fast",function(){r.click(function(n){n.stopPropagation()});$(document).one("click",function(){r.hide("fast");r.remove()})});u.find(".sortbar-option").on("click",function(n){var e=$(n.currentTarget).data(),f=i._filters[e.index];u.find(".sortbar-az").removeClass("disabled");i.sortSelection!=f&&(i.sortSelection=f,$(".sortbar-selected",t).text(i.sortSelection.display.split(".").pop()),i.pub("notify",{type:"SET-ORDERBY",args:{properties:{xpath:f.attribute,orderType:i._sortType,typeSearch:"none"}}}));r.hide("fast")})},showRecordsMenu:function(n,t){var r=this,u=r.getContent(),f=r.getTemplate("recordsMenu"),i=f.render({});$(".sortbar-records-box-menu",t).length&&$(".sortbar-records-box-menu",t).remove();t.append(i);i.show("fast",function(){i.click(function(n){n.stopPropagation()});$(document).one("click",function(){i.hide("fast");i.remove()})});u.find(".sortbar-records-option").on("click",function(){var n=Number(bizagi.util.trim(this.textContent));$(".sortbar-records-selected",t).text(n);r.pub("notify",{type:"SET-RECORDS",args:{pageSize:n}});i.hide("fast")})},initializeAndProcessFilterButton:function(n,t){var i=this;i.showingFiltering=!1;i.setVisibleCheckAll(!1);i.restoreOrderSelected();i.setIconSortType($(".sortbar-az",i.content),"desc");i.params=t.args;i.sortSelection={};i.processAddButton(n,t)},processAddButton:function(n,t){var i=this,f=i.getContent(),u=t.args,e=u.action,r=f.find(".sortbar-left .add-button");i._lastReferenceEntity=u.reference;r.children().remove();$(".wrapper-sortbar-actions",f).remove();i._haveAddButton=!1;u.reference&&u.referenceType!=="ENTITY"?(r.startLoading({delay:0,overlay:!0}),i.dataService.getProcessAddAction(t).done(function(n){i._lastReferenceEntity===n.referenceEntity&&typeof n!="undefined"&&Object.getOwnPropertyNames(n).length>1&&n.guidEntity&&n.id&&i.renderButton(r,n)}).always(function(){r.endLoading()})):e&&i.renderButton(r,e)},renderButton:function(n,t){var i=this,u=i.getTemplate("addButton"),r=u.render({action:t});n.empty();r.appendTo(n);i._haveAddButton=!0;i.behaviorVisibleSortbar();r.on("click",function(){i.clickAddButton(t)})},clickAddButton:function(n){var t=this;$.when(t.dataService.getMapping({guidEntity:n.guidEntity,accumulatedContext:t.accumulatedcontext.getContext({}),xpathContext:n.type==="Process"?n.xpathContext:""})).done(function(i){if(n.type==="Process")t.onExecuteProcess(n,i);else t.onExecuteForm(n,i)})},onCheckUncheck:function(n){var t=this,i=$(n.target),r=i.is(":checked"),u=t.pub("notify",{type:"SET-VALUES",args:{value:r}})[0];t.enableBatchActions({args:{commonActions:u}})},enableBatchActions:function(n){var t=this,u=n.args,i=t.commonActionsmodel=u.commonActions,r=t.validActions(i.actions);(r.length>0||t._haveAddButton)&&$(t.getContent()).show();t.showBatchActions(r,i,"batchAction");i.checkAll!==undefined&&t.$checkAll.prop("checked",i.checkAll)},showBatchActions:function(n,t,i){var r=this,f=r.getContent(),o=r.getTemplate("actions"),u,e;r.showSelectedItems(Object.keys(t.itemsSelected).length);u=n.slice(3,9999);e=o.render({actions:n.slice(0,3),moreActions:u,typeActions:i});$(".wdg-tple-button.batchAction",r.content).off("click",$.proxy(r.onClickBatchAction,r));$(".wrapper-sortbar-actions",f).remove();$(".sortbar-left .sortbar-menu",f).append(e);$(".wdg-tple-button.batchAction",r.content).on("click",$.proxy(r.onClickBatchAction,r));u.length>0&&(r.content.data("ui-tooltip")&&$(r.content).tooltip("destroy"),$(r.content).tooltip({tooltipClass:"sortbar-tooltip-more-actions",items:".bz-actions-showmore",content:$(".template-box-tooltip",r.content).html(),open:function(n,t){var i,f,u,e;$(".wdg-tple-button.batchAction",t.tooltip).on("click",$.proxy(r.onClickBatchAction,r));if(i=$("div.ui-tooltip"),typeof n.originalEvent=="undefined")return i.remove(),!1;f=$(t.tooltip).attr("id");i.not("#"+f).remove();for(u in r.requestsInProgressActionGuid)r.requestsInProgressActionGuid[u]&&(e=$("li[data-guid='"+u+"']",t.tooltip),r.addLoadingButtonAction(e))},close:function(n,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(".wdg-tple-button.batchAction",this).off("click",$.proxy(r.onClickBatchAction,r));$(this).remove()})})}}))},setFiltersSortData:function(n,t){var i=this,u=t.args.filtersAppliedCounter,o=t.args.totalRecords;if(i._filters=t.args.calculateFilters?t.args.filters:i._filters,t.args.calculateFilters){for(var s=-1,r,f=0,e=0;r=i._filters[++s];)r.type!="Text"&&r.type!=="Link"&&r.data&&(r.data.defaultValues&&r.data.defaultValues.length>0||r.data.min&&r.data.max)&&f++,r.display!==""&&e++;o>0?(f>0?i.showFilterButton():i.hideFilterButton(),e>0?i.showSortButtons():i.hideSortButtons()):u===0&&(i.hideFilterButton(),i.hideSortButtons())}i.updateCounter(u)},showFilterButton:function(){var n=this;$(".filter-icon",n.getContent()).show()},hideFilterButton:function(){var n=this;$(".filter-icon",n.getContent()).hide();n.showingFiltering=!1;n.behaviorVisibleSortbar()},showSortButtons:function(){var n=this;$(".sortbar-text",n.getContent()).show();$(".sortbar-icon",n.getContent()).show();$(".sortbar-az",n.getContent()).show();n.showingSorting=!0;n.showingFiltering=!0;n.behaviorVisibleSortbar()},hideSortButtons:function(){var t=this,n=$(".sortbar-az",t.getContent());$(".sortbar-text",t.getContent()).hide();n.addClass("disabled");n.removeClass("bz-icon-order-ascendant-outline");n.removeClass("bz-icon-order-descendant-outline");n.addClass("bz-icon-order-ascendant-outline");n.hide();t.showingSorting=!1;t.behaviorVisibleSortbar()},restoreOrderSelected:function(){var n=this;$(".sortbar-selected",n.getContent()).text(n.getResource("workportal-my-search-order-by"))},updateCounterByFilterApplied:function(n){var t=this;n.args.filtersApplied&&t.updateCounter(n.args.filtersApplied.length)},updateCounter:function(n){var i=this,r=i.getContent(),t=$(".counter-filters-applied",r);n>0?(t.html(n),t.show()):t.hide()},hideFilterButtonAndBar:function(){var n=this;n.showingFilter=!1;$(".filter-icon",n.getContent()).hide();n.pub("notify",{type:"CLOSE-MYSEARCHFILTER",args:{show:!1,$target:null}})},onExecuteProcess:function(n,t){var i=this;n.startForm&&(n.hasStartForm=n.startForm);$.when(i.processActionService.executeProcessAction({action:n,mappingData:t})).done(function(){i.loadTemplateData(n)})},loadTemplateData:function(n){var t=this;t.pub("notify",{type:"TEMPLATEENGINE-VIEW",args:{action:n,isRefresh:!0}})},onExecuteForm:function(n,t){var i=this;$.when(i.processActionService.executeFormAction({action:n,mappingData:t})).done(function(t){t.refresh&&i.pub("notify",{type:"UPDATE-DATATEMPLATE-VIEW",args:{action:n,isRefresh:!0,calculateFilters:!0}})})},getAction:function(n){var t=this;return t.commonActionsmodel.actions.filter(function(t){return t.id==n})[0]},validActions:function(n){return $.grep(n,function(n){return n.multiplicity==2?!0:n.mode=="Collection"?!1:n.type=="Form"?!1:n.isEvent?!1:n.type=="Process"&&n.hasStartForm?!1:!0})},clean:function(){var n=this,t=n.getContent();n.requestsInProgressActionGuid={};t&&(n.unsub("TEMPLATEENGINE-VIEW"),n.unsub("ENABLE-BATCHS-ACTIONS"),n.unsub("SEARCH-ENGINE-VIEW"),n.unsub("SET-FILTERS-DATA"),n.unsub("HIDE-FILTER-BUTTONANDBAR"),n.unsub("HIDE-SORT-BUTTONS"),n.$checkAll.off("click"),t.find(".right-menu").off("click"),t.find(".sortbar-az").off("click"),t.find(".filter-icon").off("click"),t.find(".sortbar-action").off("click"),$(".wdg-tple-button.batchAction",t).off("click",$.proxy(n.onClickBatchAction,n)),$(".remove-selected-items-collections",t).off("click",$.proxy(n.onRemoveSelectedItemsCollections,n)))}});bizagi.injector.register("bizagi.workportal.widgets.sortbar",["workportalFacade","dataService","processActionService","accumulatedcontext",bizagi.workportal.widgets.sortbar]);
bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.processeslist",{},{init:function(n,t,i){var r=this;r.params=i;r._super(n,t,i);r.idworkflow=i.idworkflow;r.histName=i.histName;r.loadTemplates({processeslist:bizagi.getTemplate("bizagi.workportal.desktop.widget.processeslist").concat("#processeslist-wrapper"),processeslistEmptyData:bizagi.getTemplate("bizagi.workportal.desktop.widget.processeslist").concat("#processeslist-empty-message")})},renderContent:function(){var n=this,t=n.getTemplate("processeslist");return $.when(n.getData()).done(function(i){n.content=i.length>0?t.render({processes:i}):n.getEmptyDataMessage().render({});n.setSelectedList($(".wdg-process-card:first",n.getContent()))})},postRender:function(){var n=this;n.configureHandlers();n.sub("GETIDWORKFLOW_FROM_PROCESSESLIST",function(){return n.getIdworkflow()});n.sub("GETHISTNAME_FROM_PROCESSESLIST",function(){return n.getHistname()})},configureHandlers:function(){var n=this,t=n.getContent();$(".wdg-process-card",t).on("click",$.proxy(n.onClickProcess,n))},getData:function(){var t=this,n={},i=t.params.route;switch(i){case"pendings":n={taskState:"all",myPendings:!0};break;case"following":n={taskState:"all",myActivities:!0,onlyFavorites:!0};break;case"Green":case"Red":case"Yellow":n={taskState:i}}return t.dataService.getAllProcesses(n).then(function(n){return t.getInfoToProcessesList(n)})},getInfoToProcessesList:function(n){for(var t,e,u=n.categories,i=[],f=[],r=0,o=u.length;r<o;r++)for(i=u[r].workflows,t=0,e=i.length;t<e;t++)f.push({process:i[t].name,idworkflow:i[t].idworkflow});return f},onClickProcess:function(n){var t=this,r=bizagi.clone(t.params),i=$(n.target).closest(".wdg-process-card");t.setSelectedList(i);t.idworkflow=i.data("idworkflow");t.histName=i.data("title");t.pubDeadLockDetection("notify",{type:"CASES-TEMPLATE-VIEW",args:$.extend(r,{histName:t.histName,level:3,idworkflow:t.idworkflow})})},getIdworkflow:function(){var n=this;return n.idworkflow},getHistname:function(){var n=this;return n.histName},setSelectedList:function(n){var t=this;$(n).addClass("wdg-plst-selected").siblings().removeClass("wdg-plst-selected")},getEmptyDataMessage:function(){var n=this;return n.getTemplate("processeslistEmptyData")},clean:function(){var n=this,t=n.getContent();t&&$(".wdg-process-card",t).off("click");n.unsub("GETIDWORKFLOW_FROM_PROCESSESLIST");n.unsub("GETHISTNAME_FROM_PROCESSESLIST")}});bizagi.injector.register("bizagi.workportal.widgets.processeslist",["workportalFacade","dataService",bizagi.workportal.widgets.processeslist],!0);
